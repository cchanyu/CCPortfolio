/*! For license information please see 2.a8732ffc.chunk.js.LICENSE.txt */
(this["webpackJsonpcchanyu.github.io"]=this["webpackJsonpcchanyu.github.io"]||[]).push([[2],[function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(27);function i(){i=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(M){l=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var i=t&&t.prototype instanceof p?t:p,o=Object.create(i.prototype),s=new A(r||[]);return a(o,"_invoke",{value:k(e,n,s)}),o}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(M){return{type:"throw",arg:M}}}e.wrap=h;var f={};function p(){}function v(){}function m(){}var g={};l(g,s,(function(){return this}));var y=Object.getPrototypeOf,b=y&&y(y(j([])));b&&b!==t&&n.call(b,s)&&(g=b);var w=m.prototype=p.prototype=Object.create(g);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function i(a,o,s,u){var c=d(e[a],e,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==Object(r.a)(h)&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){i("next",e,s,u)}),(function(e){i("throw",e,s,u)})):t.resolve(h).then((function(e){l.value=e,s(l)}),(function(e){return i("throw",e,s,u)}))}u(c.arg)}var o;a(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function k(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return T()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=_(o,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=d(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function _(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,f;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function j(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:T}}function T(){return{value:void 0,done:!0}}return v.prototype=m,a(w,"constructor",{value:m,configurable:!0}),a(m,"constructor",{value:v,configurable:!0}),v.displayName=l(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,c,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},x(O.prototype),l(O.prototype,u,(function(){return this})),e.AsyncIterator=O,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new O(h(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},x(w),l(w,c,"Generator"),l(w,s,(function(){return this})),l(w,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=j,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:j(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},e}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(47);function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Object(r.a)(i.key),i)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}},function(e,t,n){"use strict";function r(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,u,"next",e)}function u(e){r(o,i,a,s,u,"throw",e)}s(void 0)}))}}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(30);function i(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Object(r.a)(e,t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(13),i=n(41),a=n(35);function o(e){var t=Object(i.a)();return function(){var n,i=Object(r.a)(e);if(t){var o=Object(r.a)(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return Object(a.a)(this,n)}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(8);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(31);function i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Object(r.a)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(47);function i(e,t,n){return(t=Object(r.a)(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";n.d(t,"a",(function(){return gn})),n.d(t,"b",(function(){return k})),n.d(t,"c",(function(){return S})),n.d(t,"d",(function(){return Xe})),n.d(t,"e",(function(){return Ze})),n.d(t,"f",(function(){return kt})),n.d(t,"g",(function(){return Te})),n.d(t,"h",(function(){return Dt})),n.d(t,"i",(function(){return Lt})),n.d(t,"j",(function(){return Oi})),n.d(t,"k",(function(){return Nt})),n.d(t,"l",(function(){return ci})),n.d(t,"m",(function(){return Bt})),n.d(t,"n",(function(){return Rt})),n.d(t,"o",(function(){return zt})),n.d(t,"p",(function(){return Vt})),n.d(t,"q",(function(){return Yt})),n.d(t,"r",(function(){return cn})),n.d(t,"s",(function(){return hn})),n.d(t,"t",(function(){return fn})),n.d(t,"u",(function(){return kr})),n.d(t,"v",(function(){return On})),n.d(t,"w",(function(){return _n})),n.d(t,"x",(function(){return En})),n.d(t,"y",(function(){return jn})),n.d(t,"z",(function(){return Mn})),n.d(t,"A",(function(){return Dn})),n.d(t,"B",(function(){return Pn})),n.d(t,"C",(function(){return Rn})),n.d(t,"D",(function(){return Nn})),n.d(t,"E",(function(){return Bn})),n.d(t,"F",(function(){return Me})),n.d(t,"G",(function(){return ra})),n.d(t,"H",(function(){return qi})),n.d(t,"I",(function(){return Wi})),n.d(t,"J",(function(){return qe})),n.d(t,"K",(function(){return Er})),n.d(t,"L",(function(){return Ft})),n.d(t,"M",(function(){return Vn})),n.d(t,"N",(function(){return Hn})),n.d(t,"O",(function(){return qn})),n.d(t,"P",(function(){return Qn})),n.d(t,"Q",(function(){return Jn})),n.d(t,"R",(function(){return $n})),n.d(t,"S",(function(){return Jt})),n.d(t,"T",(function(){return ur})),n.d(t,"U",(function(){return dr})),n.d(t,"V",(function(){return mr})),n.d(t,"W",(function(){return N})),n.d(t,"X",(function(){return Ue})),n.d(t,"Y",(function(){return Ne})),n.d(t,"Z",(function(){return M})),n.d(t,"ab",(function(){return Na})),n.d(t,"bb",(function(){return la})),n.d(t,"cb",(function(){return ze})),n.d(t,"db",(function(){return C})),n.d(t,"eb",(function(){return R})),n.d(t,"fb",(function(){return sa})),n.d(t,"gb",(function(){return F})),n.d(t,"hb",(function(){return xr})),n.d(t,"ib",(function(){return Ci})),n.d(t,"jb",(function(){return Ri})),n.d(t,"kb",(function(){return Ii})),n.d(t,"lb",(function(){return Ki})),n.d(t,"mb",(function(){return $i})),n.d(t,"nb",(function(){return Zi})),n.d(t,"ob",(function(){return Yr})),n.d(t,"pb",(function(){return ta})),n.d(t,"qb",(function(){return Ua})),n.d(t,"rb",(function(){return pi})),n.d(t,"sb",(function(){return Va})),n.d(t,"tb",(function(){return Qa})),n.d(t,"ub",(function(){return O})),n.d(t,"vb",(function(){return mi})),n.d(t,"wb",(function(){return di})),n.d(t,"xb",(function(){return wi})),n.d(t,"yb",(function(){return cr}));var r,i=n(14),a=n(13),o=n(22),s=n(4),u=n(5),c=n(7),l=n(0),h=n(15),d=n(3),f=n(1),p=n(2),v=n(10),m=n(8),g=n(11),y=n(21),b=n(25),w=n(34),x=n(24),O={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},k={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function _(){return Object(m.a)({},"dependent-sdk-initialized-before-auth","Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.")}var S=function(){var e;return e={},Object(m.a)(e,"admin-restricted-operation","This operation is restricted to administrators only."),Object(m.a)(e,"argument-error",""),Object(m.a)(e,"app-not-authorized","This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console."),Object(m.a)(e,"app-not-installed","The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device."),Object(m.a)(e,"captcha-check-failed","The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains."),Object(m.a)(e,"code-expired","The SMS code has expired. Please re-send the verification code to try again."),Object(m.a)(e,"cordova-not-ready","Cordova framework is not ready."),Object(m.a)(e,"cors-unsupported","This browser is not supported."),Object(m.a)(e,"credential-already-in-use","This credential is already associated with a different user account."),Object(m.a)(e,"custom-token-mismatch","The custom token corresponds to a different audience."),Object(m.a)(e,"requires-recent-login","This operation is sensitive and requires recent authentication. Log in again before retrying this request."),Object(m.a)(e,"dependent-sdk-initialized-before-auth","Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."),Object(m.a)(e,"dynamic-link-not-activated","Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions."),Object(m.a)(e,"email-change-needs-verification","Multi-factor users must always have a verified email."),Object(m.a)(e,"email-already-in-use","The email address is already in use by another account."),Object(m.a)(e,"emulator-config-failed",'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.'),Object(m.a)(e,"expired-action-code","The action code has expired."),Object(m.a)(e,"cancelled-popup-request","This operation has been cancelled due to another conflicting popup being opened."),Object(m.a)(e,"internal-error","An internal AuthError has occurred."),Object(m.a)(e,"invalid-app-credential","The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired."),Object(m.a)(e,"invalid-app-id","The mobile app identifier is not registed for the current project."),Object(m.a)(e,"invalid-user-token","This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key."),Object(m.a)(e,"invalid-auth-event","An internal AuthError has occurred."),Object(m.a)(e,"invalid-verification-code","The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user."),Object(m.a)(e,"invalid-continue-uri","The continue URL provided in the request is invalid."),Object(m.a)(e,"invalid-cordova-configuration","The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme."),Object(m.a)(e,"invalid-custom-token","The custom token format is incorrect. Please check the documentation."),Object(m.a)(e,"invalid-dynamic-link-domain","The provided dynamic link domain is not configured or authorized for the current project."),Object(m.a)(e,"invalid-email","The email address is badly formatted."),Object(m.a)(e,"invalid-emulator-scheme","Emulator URL must start with a valid scheme (http:// or https://)."),Object(m.a)(e,"invalid-api-key","Your API key is invalid, please check you have copied it correctly."),Object(m.a)(e,"invalid-cert-hash","The SHA-1 certificate hash provided is invalid."),Object(m.a)(e,"invalid-credential","The supplied auth credential is malformed or has expired."),Object(m.a)(e,"invalid-message-payload","The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console."),Object(m.a)(e,"invalid-multi-factor-session","The request does not contain a valid proof of first factor successful sign-in."),Object(m.a)(e,"invalid-oauth-provider","EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers."),Object(m.a)(e,"invalid-oauth-client-id","The OAuth client ID provided is either invalid or does not match the specified API key."),Object(m.a)(e,"unauthorized-domain","This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console."),Object(m.a)(e,"invalid-action-code","The action code is invalid. This can happen if the code is malformed, expired, or has already been used."),Object(m.a)(e,"wrong-password","The password is invalid or the user does not have a password."),Object(m.a)(e,"invalid-persistence-type","The specified persistence type is invalid. It can only be local, session or none."),Object(m.a)(e,"invalid-phone-number","The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code]."),Object(m.a)(e,"invalid-provider-id","The specified provider ID is invalid."),Object(m.a)(e,"invalid-recipient-email","The email corresponding to this action failed to send as the provided recipient email address is invalid."),Object(m.a)(e,"invalid-sender","The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console."),Object(m.a)(e,"invalid-verification-id","The verification ID used to create the phone auth credential is invalid."),Object(m.a)(e,"invalid-tenant-id","The Auth instance's tenant ID is invalid."),Object(m.a)(e,"login-blocked","Login blocked by user-provided method: {$originalMessage}"),Object(m.a)(e,"missing-android-pkg-name","An Android Package Name must be provided if the Android App is required to be installed."),Object(m.a)(e,"auth-domain-config-required","Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console."),Object(m.a)(e,"missing-app-credential","The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided."),Object(m.a)(e,"missing-verification-code","The phone auth credential was created with an empty SMS verification code."),Object(m.a)(e,"missing-continue-uri","A continue URL must be provided in the request."),Object(m.a)(e,"missing-iframe-start","An internal AuthError has occurred."),Object(m.a)(e,"missing-ios-bundle-id","An iOS Bundle ID must be provided if an App Store ID is provided."),Object(m.a)(e,"missing-or-invalid-nonce","The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload."),Object(m.a)(e,"missing-multi-factor-info","No second factor identifier is provided."),Object(m.a)(e,"missing-multi-factor-session","The request is missing proof of first factor successful sign-in."),Object(m.a)(e,"missing-phone-number","To send verification codes, provide a phone number for the recipient."),Object(m.a)(e,"missing-verification-id","The phone auth credential was created with an empty verification ID."),Object(m.a)(e,"app-deleted","This instance of FirebaseApp has been deleted."),Object(m.a)(e,"multi-factor-info-not-found","The user does not have a second factor matching the identifier provided."),Object(m.a)(e,"multi-factor-auth-required","Proof of ownership of a second factor is required to complete sign-in."),Object(m.a)(e,"account-exists-with-different-credential","An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address."),Object(m.a)(e,"network-request-failed","A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred."),Object(m.a)(e,"no-auth-event","An internal AuthError has occurred."),Object(m.a)(e,"no-such-provider","User was not linked to an account with the given provider."),Object(m.a)(e,"null-user","A null user object was provided as the argument for an operation which requires a non-null user object."),Object(m.a)(e,"operation-not-allowed","The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section."),Object(m.a)(e,"operation-not-supported-in-this-environment",'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.'),Object(m.a)(e,"popup-blocked","Unable to establish a connection with the popup. It may have been blocked by the browser."),Object(m.a)(e,"popup-closed-by-user","The popup has been closed by the user before finalizing the operation."),Object(m.a)(e,"provider-already-linked","User can only be linked to one identity for the given provider."),Object(m.a)(e,"quota-exceeded","The project's quota for this operation has been exceeded."),Object(m.a)(e,"redirect-cancelled-by-user","The redirect operation has been cancelled by the user before finalizing."),Object(m.a)(e,"redirect-operation-pending","A redirect sign-in operation is already pending."),Object(m.a)(e,"rejected-credential","The request contains malformed or mismatching credentials."),Object(m.a)(e,"second-factor-already-in-use","The second factor is already enrolled on this account."),Object(m.a)(e,"maximum-second-factor-count-exceeded","The maximum allowed number of second factors on a user has been exceeded."),Object(m.a)(e,"tenant-id-mismatch","The provided tenant ID does not match the Auth instance's tenant ID"),Object(m.a)(e,"timeout","The operation has timed out."),Object(m.a)(e,"user-token-expired","The user's credential is no longer valid. The user must sign in again."),Object(m.a)(e,"too-many-requests","We have blocked all requests from this device due to unusual activity. Try again later."),Object(m.a)(e,"unauthorized-continue-uri","The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console."),Object(m.a)(e,"unsupported-first-factor","Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor."),Object(m.a)(e,"unsupported-persistence-type","The current environment does not support the specified persistence type."),Object(m.a)(e,"unsupported-tenant-operation","This operation is not supported in a multi-tenant context."),Object(m.a)(e,"unverified-email","The operation requires a verified email."),Object(m.a)(e,"user-cancelled","The user did not grant your application the permissions it requested."),Object(m.a)(e,"user-not-found","There is no user record corresponding to this identifier. The user may have been deleted."),Object(m.a)(e,"user-disabled","The user account has been disabled by an administrator."),Object(m.a)(e,"user-mismatch","The supplied credentials do not correspond to the previously signed in user."),Object(m.a)(e,"user-signed-out",""),Object(m.a)(e,"weak-password","The password must be 6 characters long or more."),Object(m.a)(e,"web-storage-unsupported","This browser is not supported or 3rd party cookies and data may be disabled."),Object(m.a)(e,"already-initialized","initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."),e},E=_,A=new g.b("auth","Firebase",_()),j=new b.b("@firebase/auth");function T(e){if(j.logLevel<=b.a.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];j.error.apply(j,["Auth (".concat(y.SDK_VERSION,"): ").concat(e)].concat(n))}}function M(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw P.apply(void 0,[e].concat(n))}function C(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return P.apply(void 0,[e].concat(n))}function D(e,t,n){var r=Object.assign(Object.assign({},E()),Object(m.a)({},t,n));return new g.b("auth","Firebase",r).create(t,{appName:e.name})}function I(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&M(e,"argument-error"),D(e,"argument-error","Type of ".concat(t.constructor.name," does not match expected instance.")+"Did you pass a reference from a different Auth SDK?")}function P(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){var i,a=n[0],o=Object(v.a)(n.slice(1));return o[0]&&(o[0].appName=e.name),(i=e._errorFactory).create.apply(i,[a].concat(Object(v.a)(o)))}return A.create.apply(A,[e].concat(n))}function R(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];throw P.apply(void 0,[t].concat(r))}}function L(e){var t="INTERNAL ASSERTION FAILED: "+e;throw T(t),new Error(t)}function N(e,t){e||L(t)}var B=new Map;function F(e){N(e instanceof Function,"Expected a class definition");var t=B.get(e);return t?(N(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,B.set(e,t),t)}function U(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function z(){return"http:"===V()||"https:"===V()}function V(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}var G=function(){function e(t,n){Object(f.a)(this,e),this.shortDelay=t,this.longDelay=n,N(n>t,"Short delay should be less than long delay!"),this.isMobile=Object(g.w)()||Object(g.y)()}return Object(p.a)(e,[{key:"get",value:function(){return"undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(z()||Object(g.s)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}]),e}();function H(e,t){N(e.emulator,"Emulator should always be set here");var n=e.emulator.url;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}var W=function(){function e(){Object(f.a)(this,e)}return Object(p.a)(e,null,[{key:"initialize",value:function(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}},{key:"fetch",value:function(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:void L("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}},{key:"headers",value:function(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:void L("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}},{key:"response",value:function(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:void L("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}]),e}(),q=(r={},Object(m.a)(r,"CREDENTIAL_MISMATCH","custom-token-mismatch"),Object(m.a)(r,"MISSING_CUSTOM_TOKEN","internal-error"),Object(m.a)(r,"INVALID_IDENTIFIER","invalid-email"),Object(m.a)(r,"MISSING_CONTINUE_URI","internal-error"),Object(m.a)(r,"INVALID_PASSWORD","wrong-password"),Object(m.a)(r,"MISSING_PASSWORD","internal-error"),Object(m.a)(r,"EMAIL_EXISTS","email-already-in-use"),Object(m.a)(r,"PASSWORD_LOGIN_DISABLED","operation-not-allowed"),Object(m.a)(r,"INVALID_IDP_RESPONSE","invalid-credential"),Object(m.a)(r,"INVALID_PENDING_TOKEN","invalid-credential"),Object(m.a)(r,"FEDERATED_USER_ID_ALREADY_LINKED","credential-already-in-use"),Object(m.a)(r,"MISSING_REQ_TYPE","internal-error"),Object(m.a)(r,"EMAIL_NOT_FOUND","user-not-found"),Object(m.a)(r,"RESET_PASSWORD_EXCEED_LIMIT","too-many-requests"),Object(m.a)(r,"EXPIRED_OOB_CODE","expired-action-code"),Object(m.a)(r,"INVALID_OOB_CODE","invalid-action-code"),Object(m.a)(r,"MISSING_OOB_CODE","internal-error"),Object(m.a)(r,"CREDENTIAL_TOO_OLD_LOGIN_AGAIN","requires-recent-login"),Object(m.a)(r,"INVALID_ID_TOKEN","invalid-user-token"),Object(m.a)(r,"TOKEN_EXPIRED","user-token-expired"),Object(m.a)(r,"USER_NOT_FOUND","user-token-expired"),Object(m.a)(r,"TOO_MANY_ATTEMPTS_TRY_LATER","too-many-requests"),Object(m.a)(r,"INVALID_CODE","invalid-verification-code"),Object(m.a)(r,"INVALID_SESSION_INFO","invalid-verification-id"),Object(m.a)(r,"INVALID_TEMPORARY_PROOF","invalid-credential"),Object(m.a)(r,"MISSING_SESSION_INFO","missing-verification-id"),Object(m.a)(r,"SESSION_EXPIRED","code-expired"),Object(m.a)(r,"MISSING_ANDROID_PACKAGE_NAME","missing-android-pkg-name"),Object(m.a)(r,"UNAUTHORIZED_DOMAIN","unauthorized-continue-uri"),Object(m.a)(r,"INVALID_OAUTH_CLIENT_ID","invalid-oauth-client-id"),Object(m.a)(r,"ADMIN_ONLY_OPERATION","admin-restricted-operation"),Object(m.a)(r,"INVALID_MFA_PENDING_CREDENTIAL","invalid-multi-factor-session"),Object(m.a)(r,"MFA_ENROLLMENT_NOT_FOUND","multi-factor-info-not-found"),Object(m.a)(r,"MISSING_MFA_ENROLLMENT_ID","missing-multi-factor-info"),Object(m.a)(r,"MISSING_MFA_PENDING_CREDENTIAL","missing-multi-factor-session"),Object(m.a)(r,"SECOND_FACTOR_EXISTS","second-factor-already-in-use"),Object(m.a)(r,"SECOND_FACTOR_LIMIT_EXCEEDED","maximum-second-factor-count-exceeded"),Object(m.a)(r,"BLOCKING_FUNCTION_ERROR_RESPONSE","internal-error"),r),Y=new G(3e4,6e4);function X(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}function K(e,t,n,r){return Q.apply(this,arguments)}function Q(){return Q=Object(d.a)(Object(l.a)().mark((function e(t,n,r,i){var a,o=arguments;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>4&&void 0!==o[4]?o[4]:{},e.abrupt("return",Z(t,a,Object(d.a)(Object(l.a)().mark((function e(){var a,o,s,u;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={},o={},i&&("GET"===n?o=i:a={body:JSON.stringify(i)}),s=Object(g.A)(Object.assign({key:t.config.apiKey},o)).slice(1),e.next=6,t._getAdditionalHeaders();case 6:return(u=e.sent)["Content-Type"]="application/json",t.languageCode&&(u["X-Firebase-Locale"]=t.languageCode),e.abrupt("return",W.fetch()(te(t,t.config.apiHost,r,s),Object.assign({method:n,headers:u,referrerPolicy:"no-referrer"},a)));case 10:case"end":return e.stop()}}),e)})))));case 2:case"end":return e.stop()}}),e)}))),Q.apply(this,arguments)}function Z(e,t,n){return J.apply(this,arguments)}function J(){return(J=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a,o,s,u,c,d,f,p,v;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t._canInitEmulator=!1,i=Object.assign(Object.assign({},q),n),e.prev=2,a=new ne(t),e.next=6,Promise.race([r(),a.promise]);case 6:return o=e.sent,a.clearNetworkTimeout(),e.next=10,o.json();case 10:if(!("needConfirmation"in(s=e.sent))){e.next=13;break}throw re(t,"account-exists-with-different-credential",s);case 13:if(!o.ok||"errorMessage"in s){e.next=17;break}return e.abrupt("return",s);case 17:if(u=o.ok?s.errorMessage:s.error.message,c=u.split(" : "),d=Object(h.a)(c,2),f=d[0],p=d[1],"FEDERATED_USER_ID_ALREADY_LINKED"!==f){e.next=23;break}throw re(t,"credential-already-in-use",s);case 23:if("EMAIL_EXISTS"!==f){e.next=27;break}throw re(t,"email-already-in-use",s);case 27:if("USER_DISABLED"!==f){e.next=29;break}throw re(t,"user-disabled",s);case 29:if(v=i[f]||f.toLowerCase().replace(/[_\s]+/g,"-"),!p){e.next=34;break}throw D(t,v,p);case 34:M(t,v);case 35:e.next=42;break;case 37:if(e.prev=37,e.t0=e.catch(2),!(e.t0 instanceof g.c)){e.next=41;break}throw e.t0;case 41:M(t,"network-request-failed");case 42:case"end":return e.stop()}}),e,null,[[2,37]])})))).apply(this,arguments)}function $(e,t,n,r){return ee.apply(this,arguments)}function ee(){return ee=Object(d.a)(Object(l.a)().mark((function e(t,n,r,i){var a,o,s=arguments;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>4&&void 0!==s[4]?s[4]:{},e.next=3,K(t,n,r,i,a);case 3:return"mfaPendingCredential"in(o=e.sent)&&M(t,"multi-factor-auth-required",{_serverResponse:o}),e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)}))),ee.apply(this,arguments)}function te(e,t,n,r){var i="".concat(t).concat(n,"?").concat(r);return e.config.emulator?H(e.config,i):"".concat(e.config.apiScheme,"://").concat(i)}var ne=function(){function e(t){var n=this;Object(f.a)(this,e),this.auth=t,this.timer=null,this.promise=new Promise((function(e,t){n.timer=setTimeout((function(){return t(C(n.auth,"network-request-failed"))}),Y.get())}))}return Object(p.a)(e,[{key:"clearNetworkTimeout",value:function(){clearTimeout(this.timer)}}]),e}();function re(e,t,n){var r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);var i=C(e,t,r);return i.customData._tokenResponse=n,i}function ie(e,t){return ae.apply(this,arguments)}function ae(){return(ae=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K(t,"POST","/v1/accounts:delete",n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oe(e,t){return se.apply(this,arguments)}function se(){return(se=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K(t,"POST","/v1/accounts:update",n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ue(e,t){return ce.apply(this,arguments)}function ce(){return(ce=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K(t,"POST","/v1/accounts:lookup",n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(e){if(e)try{var t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(n){}}function he(){return he=Object(d.a)(Object(l.a)().mark((function e(t){var n,r,i,a,o,s,u=arguments;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]&&u[1],r=Object(g.p)(t),e.next=4,r.getIdToken(n);case 4:return i=e.sent,R((a=fe(i))&&a.exp&&a.auth_time&&a.iat,r.auth,"internal-error"),o="object"===typeof a.firebase?a.firebase:void 0,s=null===o||void 0===o?void 0:o.sign_in_provider,e.abrupt("return",{claims:a,token:i,authTime:le(de(a.auth_time)),issuedAtTime:le(de(a.iat)),expirationTime:le(de(a.exp)),signInProvider:s||null,signInSecondFactor:(null===o||void 0===o?void 0:o.sign_in_second_factor)||null});case 10:case"end":return e.stop()}}),e)}))),he.apply(this,arguments)}function de(e){return 1e3*Number(e)}function fe(e){var t=e.split("."),n=Object(h.a)(t,3),r=n[0],i=n[1],a=n[2];if(void 0===r||void 0===i||void 0===a)return T("JWT malformed, contained fewer than 3 sections"),null;try{var o=Object(g.d)(i);return o?JSON.parse(o):(T("Failed to decode base64 JWT payload"),null)}catch(s){return T("Caught error parsing JWT payload as JSON",null===s||void 0===s?void 0:s.toString()),null}}function pe(e,t){return ve.apply(this,arguments)}function ve(){return ve=Object(d.a)(Object(l.a)().mark((function e(t,n){var r=arguments;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>2&&void 0!==r[2]&&r[2])){e.next=3;break}return e.abrupt("return",n);case 3:return e.prev=3,e.next=6,n;case 6:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),!(e.t0 instanceof g.c&&me(e.t0))){e.next=15;break}if(t.auth.currentUser!==t){e.next=15;break}return e.next=15,t.auth.signOut();case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[3,9]])}))),ve.apply(this,arguments)}function me(e){var t=e.code;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}var ge=function(){function e(t){Object(f.a)(this,e),this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}return Object(p.a)(e,[{key:"_start",value:function(){this.isRunning||(this.isRunning=!0,this.schedule())}},{key:"_stop",value:function(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}},{key:"getInterval",value:function(e){var t;if(e){var n=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),n}this.errorBackoff=3e4;var r=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,r)}},{key:"schedule",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isRunning){var n=this.getInterval(t);this.timerId=setTimeout(Object(d.a)(Object(l.a)().mark((function t(){return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.iteration();case 2:case"end":return t.stop()}}),t)}))),n)}}},{key:"iteration",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.user.getIdToken(!0);case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),(null===e.t0||void 0===e.t0?void 0:e.t0.code)==="auth/".concat("network-request-failed")&&this.schedule(!0),e.abrupt("return");case 9:this.schedule();case 10:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(){return e.apply(this,arguments)}}()}]),e}(),ye=function(){function e(t,n){Object(f.a)(this,e),this.createdAt=t,this.lastLoginAt=n,this._initializeTime()}return Object(p.a)(e,[{key:"_initializeTime",value:function(){this.lastSignInTime=le(this.lastLoginAt),this.creationTime=le(this.createdAt)}},{key:"_copy",value:function(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}},{key:"toJSON",value:function(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}]),e}();function be(e){return we.apply(this,arguments)}function we(){return(we=Object(d.a)(Object(l.a)().mark((function e(t){var n,r,i,a,o,s,u,c,h,d,f;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.auth,e.next=3,t.getIdToken();case 3:return i=e.sent,e.next=6,pe(t,ue(r,{idToken:i}));case 6:R(null===(a=e.sent)||void 0===a?void 0:a.users.length,r,"internal-error"),o=a.users[0],t._notifyReloadListener(o),s=(null===(n=o.providerUserInfo)||void 0===n?void 0:n.length)?o.providerUserInfo.map((function(e){var t=e.providerId,n=Object(w.a)(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],u=Oe(t.providerData,s),c=t.isAnonymous,h=!(t.email&&o.passwordHash)&&!(null===u||void 0===u?void 0:u.length),d=!!c&&h,f={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:u,metadata:new ye(o.createdAt,o.lastLoginAt),isAnonymous:d},Object.assign(t,f);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(){return(xe=Object(d.a)(Object(l.a)().mark((function e(t){var n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(g.p)(t),e.next=3,be(n);case 3:return e.next=5,n.auth._persistUserIfCurrent(n);case 5:n.auth._notifyListenersIfCurrent(n);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(e,t){var n=e.filter((function(e){return!t.some((function(t){return t.providerId===e.providerId}))}));return[].concat(Object(v.a)(n),Object(v.a)(t))}function ke(e,t){return _e.apply(this,arguments)}function _e(){return(_e=Object(d.a)(Object(l.a)().mark((function e(t,n){var r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z(t,{},Object(d.a)(Object(l.a)().mark((function e(){var r,i,a,o,s,u;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(g.A)({grant_type:"refresh_token",refresh_token:n}).slice(1),i=t.config,a=i.tokenApiHost,o=i.apiKey,s=te(t,a,"/v1/token","key=".concat(o)),e.next=5,t._getAdditionalHeaders();case 5:return(u=e.sent)["Content-Type"]="application/x-www-form-urlencoded",e.abrupt("return",W.fetch()(s,{method:"POST",headers:u,body:r}));case 8:case"end":return e.stop()}}),e)}))));case 2:return r=e.sent,e.abrupt("return",{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Se=function(){function e(){Object(f.a)(this,e),this.refreshToken=null,this.accessToken=null,this.expirationTime=null}return Object(p.a)(e,[{key:"isExpired",get:function(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}},{key:"updateFromServerResponse",value:function(e){R(e.idToken,"internal-error"),R("undefined"!==typeof e.idToken,"internal-error"),R("undefined"!==typeof e.refreshToken,"internal-error");var t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):function(e){var t=fe(e);return R(t,"internal-error"),R("undefined"!==typeof t.exp,"internal-error"),R("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}},{key:"getToken",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n,r=arguments;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]&&r[1],R(!this.accessToken||this.refreshToken,t,"user-token-expired"),n||!this.accessToken||this.isExpired){e.next=4;break}return e.abrupt("return",this.accessToken);case 4:if(!this.refreshToken){e.next=8;break}return e.next=7,this.refresh(t,this.refreshToken);case 7:return e.abrupt("return",this.accessToken);case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"clearRefreshToken",value:function(){this.refreshToken=null}},{key:"refresh",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t,n){var r,i,a,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ke(t,n);case 2:r=e.sent,i=r.accessToken,a=r.refreshToken,o=r.expiresIn,this.updateTokensAndExpiration(i,a,Number(o));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateTokensAndExpiration",value:function(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}},{key:"toJSON",value:function(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}},{key:"_assign",value:function(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}},{key:"_clone",value:function(){return Object.assign(new e,this.toJSON())}},{key:"_performRefresh",value:function(){return L("not implemented")}}],[{key:"fromJSON",value:function(t,n){var r=n.refreshToken,i=n.accessToken,a=n.expirationTime,o=new e;return r&&(R("string"===typeof r,"internal-error",{appName:t}),o.refreshToken=r),i&&(R("string"===typeof i,"internal-error",{appName:t}),o.accessToken=i),a&&(R("number"===typeof a,"internal-error",{appName:t}),o.expirationTime=a),o}}]),e}();function Ee(e,t){R("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}var Ae=function(){function e(t){Object(f.a)(this,e);var n=t.uid,r=t.auth,i=t.stsTokenManager,a=Object(w.a)(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ge(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?Object(v.a)(a.providerData):[],this.metadata=new ye(a.createdAt||void 0,a.lastLoginAt||void 0)}return Object(p.a)(e,[{key:"getIdToken",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe(this,this.stsTokenManager.getToken(this.auth,t));case 2:if(R(n=e.sent,this.auth,"internal-error"),this.accessToken===n){e.next=9;break}return this.accessToken=n,e.next=8,this.auth._persistUserIfCurrent(this);case 8:this.auth._notifyListenersIfCurrent(this);case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getIdTokenResult",value:function(e){return function(e){return he.apply(this,arguments)}(this,e)}},{key:"reload",value:function(){return function(e){return xe.apply(this,arguments)}(this)}},{key:"_assign",value:function(e){this!==e&&(R(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((function(e){return Object.assign({},e)})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}},{key:"_clone",value:function(t){return new e(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}))}},{key:"_onReload",value:function(e){R(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}},{key:"_notifyReloadListener",value:function(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}},{key:"_startProactiveRefresh",value:function(){this.proactiveRefresh._start()}},{key:"_stopProactiveRefresh",value:function(){this.proactiveRefresh._stop()}},{key:"_updateTokensIfNecessary",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n,r,i=arguments;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],r=!1,t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),r=!0),!n){e.next=6;break}return e.next=6,be(this);case 6:return e.next=8,this.auth._persistUserIfCurrent(this);case 8:r&&this.auth._notifyListenersIfCurrent(this);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){var t;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getIdToken();case 2:return t=e.sent,e.next=5,pe(this,ie(this.auth,{idToken:t}));case 5:return this.stsTokenManager.clearRefreshToken(),e.abrupt("return",this.auth.signOut());case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toJSON",value:function(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((function(e){return Object.assign({},e)})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}},{key:"refreshToken",get:function(){return this.stsTokenManager.refreshToken||""}}],[{key:"_fromJSON",value:function(t,n){var r,i,a,o,s,u,c,l,h=null!==(r=n.displayName)&&void 0!==r?r:void 0,d=null!==(i=n.email)&&void 0!==i?i:void 0,f=null!==(a=n.phoneNumber)&&void 0!==a?a:void 0,p=null!==(o=n.photoURL)&&void 0!==o?o:void 0,v=null!==(s=n.tenantId)&&void 0!==s?s:void 0,m=null!==(u=n._redirectEventId)&&void 0!==u?u:void 0,g=null!==(c=n.createdAt)&&void 0!==c?c:void 0,y=null!==(l=n.lastLoginAt)&&void 0!==l?l:void 0,b=n.uid,w=n.emailVerified,x=n.isAnonymous,O=n.providerData,k=n.stsTokenManager;R(b&&k,t,"internal-error");var _=Se.fromJSON(this.name,k);R("string"===typeof b,t,"internal-error"),Ee(h,t.name),Ee(d,t.name),R("boolean"===typeof w,t,"internal-error"),R("boolean"===typeof x,t,"internal-error"),Ee(f,t.name),Ee(p,t.name),Ee(v,t.name),Ee(m,t.name),Ee(g,t.name),Ee(y,t.name);var S=new e({uid:b,auth:t,email:d,emailVerified:w,displayName:h,isAnonymous:x,photoURL:p,phoneNumber:f,tenantId:v,stsTokenManager:_,createdAt:g,lastLoginAt:y});return O&&Array.isArray(O)&&(S.providerData=O.map((function(e){return Object.assign({},e)}))),m&&(S._redirectEventId=m),S}},{key:"_fromIdTokenResponse",value:function(){var t=Object(d.a)(Object(l.a)().mark((function t(n,r){var i,a,o,s=arguments;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=s.length>2&&void 0!==s[2]&&s[2],(a=new Se).updateFromServerResponse(r),o=new e({uid:r.localId,auth:n,stsTokenManager:a,isAnonymous:i}),t.next=6,be(o);case 6:return t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}]),e}(),je=function(){function e(){Object(f.a)(this,e),this.type="NONE",this.storage={}}return Object(p.a)(e,[{key:"_isAvailable",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_set",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.storage[t]=n;case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_get",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.storage[t],e.abrupt("return",void 0===n?null:n);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_remove",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:delete this.storage[t];case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_addListener",value:function(e,t){}},{key:"_removeListener",value:function(e,t){}}]),e}();je.type="NONE";var Te=je;function Me(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}var Ce=function(){function e(t,n,r){Object(f.a)(this,e),this.persistence=t,this.auth=n,this.userKey=r;var i=this.auth,a=i.config,o=i.name;this.fullUserKey=Me(this.userKey,a.apiKey,o),this.fullPersistenceKey=Me("persistence",a.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}return Object(p.a)(e,[{key:"setCurrentUser",value:function(e){return this.persistence._set(this.fullUserKey,e.toJSON())}},{key:"getCurrentUser",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){var t;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.persistence._get(this.fullUserKey);case 2:return t=e.sent,e.abrupt("return",t?Ae._fromJSON(this.auth,t):null);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeCurrentUser",value:function(){return this.persistence._remove(this.fullUserKey)}},{key:"savePersistenceForRedirect",value:function(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}},{key:"setPersistence",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.persistence!==t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.getCurrentUser();case 4:return n=e.sent,e.next=7,this.removeCurrentUser();case 7:if(this.persistence=t,!n){e.next=10;break}return e.abrupt("return",this.setCurrentUser(n));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}}],[{key:"create",value:function(){var t=Object(d.a)(Object(l.a)().mark((function t(n,r){var i,a,o,s,u,h,f,p,v,m,g,y=arguments;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=y.length>2&&void 0!==y[2]?y[2]:"authUser",r.length){t.next=3;break}return t.abrupt("return",new e(F(Te),n,i));case 3:return t.next=5,Promise.all(r.map(function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._isAvailable();case 2:if(!e.sent){e.next=4;break}return e.abrupt("return",t);case 4:return e.abrupt("return",void 0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:a=t.sent.filter((function(e){return e})),o=a[0]||F(Te),s=Me(i,n.config.apiKey,n.name),u=null,h=Object(c.a)(r),t.prev=10,h.s();case 12:if((f=h.n()).done){t.next=29;break}return p=f.value,t.prev=14,t.next=17,p._get(s);case 17:if(!(v=t.sent)){t.next=23;break}return m=Ae._fromJSON(n,v),p!==o&&(u=m),o=p,t.abrupt("break",29);case 23:t.next=27;break;case 25:t.prev=25,t.t0=t.catch(14);case 27:t.next=12;break;case 29:t.next=34;break;case 31:t.prev=31,t.t1=t.catch(10),h.e(t.t1);case 34:return t.prev=34,h.f(),t.finish(34);case 37:if(g=a.filter((function(e){return e._shouldAllowMigration})),o._shouldAllowMigration&&g.length){t.next=40;break}return t.abrupt("return",new e(o,n,i));case 40:if(o=g[0],!u){t.next=44;break}return t.next=44,o._set(s,u.toJSON());case 44:return t.next=46,Promise.all(r.map(function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t===o){e.next=8;break}return e.prev=1,e.next=4,t._remove(s);case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}()));case 46:return t.abrupt("return",new e(o,n,i));case 47:case"end":return t.stop()}}),t,null,[[10,31,34,37],[14,25]])})));return function(e,n){return t.apply(this,arguments)}}()}]),e}();function De(e){var t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Le(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Ie(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Be(t))return"Blackberry";if(Fe(t))return"Webos";if(Pe(t))return"Safari";if((t.includes("chrome/")||Re(t))&&!t.includes("edge/"))return"Chrome";if(Ne(t))return"Android";var n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);return 2===(null===n||void 0===n?void 0:n.length)?n[1]:"Other"}function Ie(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.q)();return/firefox\//i.test(e)}function Pe(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.q)()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Re(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.q)();return/crios\//i.test(e)}function Le(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.q)();return/iemobile/i.test(e)}function Ne(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.q)();return/android/i.test(e)}function Be(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.q)();return/blackberry/i.test(e)}function Fe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.q)();return/webos/i.test(e)}function Ue(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.q)();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function ze(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.q)();return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}function Ve(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.q)();return Ue(e)||Ne(e)||Fe(e)||Be(e)||/windows phone/i.test(e)||Le(e)}function Ge(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=De(Object(g.q)());break;case"Worker":t="".concat(De(Object(g.q)()),"-").concat(e);break;default:t=e}var r=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(y.SDK_VERSION,"/").concat(r)}var He=function(){function e(t){Object(f.a)(this,e),this.auth=t,this.queue=[]}return Object(p.a)(e,[{key:"pushCallback",value:function(e,t){var n=this,r=function(t){return new Promise((function(n,r){try{n(e(t))}catch(i){r(i)}}))};r.onAbort=t,this.queue.push(r);var i=this.queue.length-1;return function(){n.queue[i]=function(){return Promise.resolve()}}}},{key:"runMiddleware",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n,r,i,a,o,s,u;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.auth.currentUser!==t){e.next=2;break}return e.abrupt("return");case 2:n=[],e.prev=3,r=Object(c.a)(this.queue),e.prev=5,r.s();case 7:if((i=r.n()).done){e.next=14;break}return a=i.value,e.next=11,a(t);case 11:a.onAbort&&n.push(a.onAbort);case 12:e.next=7;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(5),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:e.next=30;break;case 24:e.prev=24,e.t1=e.catch(3),n.reverse(),o=Object(c.a)(n);try{for(o.s();!(s=o.n()).done;){u=s.value;try{u()}catch(l){}}}catch(h){o.e(h)}finally{o.f()}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===e.t1||void 0===e.t1?void 0:e.t1.message});case 30:case"end":return e.stop()}}),e,this,[[3,24],[5,16,19,22]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),We=function(){function e(t,n,r){Object(f.a)(this,e),this.app=t,this.heartbeatServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ye(this),this.idTokenSubscription=new Ye(this),this.beforeStateQueue=new He(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=A,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=r.sdkClientVersion}return Object(p.a)(e,[{key:"_initializeWithPersistence",value:function(e,t){var n=this;return t&&(this._popupRedirectResolver=F(t)),this._initializationPromise=this.queue(Object(d.a)(Object(l.a)().mark((function r(){var i,a;return Object(l.a)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!n._deleted){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,Ce.create(n,e);case 4:if(n.persistenceManager=r.sent,!n._deleted){r.next=7;break}return r.abrupt("return");case 7:if(!(null===(i=n._popupRedirectResolver)||void 0===i?void 0:i._shouldInitProactively)){r.next=15;break}return r.prev=8,r.next=11,n._popupRedirectResolver._initialize(n);case 11:r.next=15;break;case 13:r.prev=13,r.t0=r.catch(8);case 15:return r.next=17,n.initializeCurrentUser(t);case 17:if(n.lastNotifiedUid=(null===(a=n.currentUser)||void 0===a?void 0:a.uid)||null,!n._deleted){r.next=20;break}return r.abrupt("return");case 20:n._isInitialized=!0;case 21:case"end":return r.stop()}}),r,null,[[8,13]])})))),this._initializationPromise}},{key:"_onStorageEvent",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){var t;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._deleted){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.assertedPersistence.getCurrentUser();case 4:if(t=e.sent,this.currentUser||t){e.next=7;break}return e.abrupt("return");case 7:if(!this.currentUser||!t||this.currentUser.uid!==t.uid){e.next=12;break}return this._currentUser._assign(t),e.next=11,this.currentUser.getIdToken();case 11:return e.abrupt("return");case 12:return e.next=14,this._updateCurrentUser(t,!0);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initializeCurrentUser",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n,r,i,a,o,s,u;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.assertedPersistence.getCurrentUser();case 2:if(r=e.sent,i=r,a=!1,!t||!this.config.authDomain){e.next=14;break}return e.next=8,this.getOrInitRedirectPersistenceManager();case 8:return o=null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId,s=null===i||void 0===i?void 0:i._redirectEventId,e.next=12,this.tryRedirectSignIn(t);case 12:u=e.sent,o&&o!==s||!(null===u||void 0===u?void 0:u.user)||(i=u.user,a=!0);case 14:if(i){e.next=16;break}return e.abrupt("return",this.directlySetCurrentUser(null));case 16:if(i._redirectEventId){e.next=32;break}if(!a){e.next=27;break}return e.prev=18,e.next=21,this.beforeStateQueue.runMiddleware(i);case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(18),i=r,this._popupRedirectResolver._overrideRedirectResult(this,(function(){return Promise.reject(e.t0)}));case 27:if(!i){e.next=31;break}return e.abrupt("return",this.reloadAndSetCurrentUserOrClear(i));case 31:return e.abrupt("return",this.directlySetCurrentUser(null));case 32:return R(this._popupRedirectResolver,this,"argument-error"),e.next=35,this.getOrInitRedirectPersistenceManager();case 35:if(!this.redirectUser||this.redirectUser._redirectEventId!==i._redirectEventId){e.next=37;break}return e.abrupt("return",this.directlySetCurrentUser(i));case 37:return e.abrupt("return",this.reloadAndSetCurrentUserOrClear(i));case 38:case"end":return e.stop()}}),e,this,[[18,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"tryRedirectSignIn",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.prev=1,e.next=4,this._popupRedirectResolver._completeRedirectFn(this,t,!0);case 4:n=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),e.next=11,this._setRedirectUser(null);case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"reloadAndSetCurrentUserOrClear",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,be(t);case 3:e.next=9;break;case 5:if(e.prev=5,e.t0=e.catch(0),(null===e.t0||void 0===e.t0?void 0:e.t0.code)==="auth/".concat("network-request-failed")){e.next=9;break}return e.abrupt("return",this.directlySetCurrentUser(null));case 9:return e.abrupt("return",this.directlySetCurrentUser(t));case 10:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"useDeviceLanguage",value:function(){this.languageCode=function(){if("undefined"===typeof navigator)return null;var e=navigator;return e.languages&&e.languages[0]||e.language||null}()}},{key:"_delete",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._deleted=!0;case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateCurrentUser",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t?Object(g.p)(t):null)&&R(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),e.abrupt("return",this._updateCurrentUser(n&&n._clone(this)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateCurrentUser",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n,r=this,i=arguments;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],!this._deleted){e.next=3;break}return e.abrupt("return");case 3:if(t&&R(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),n){e.next=7;break}return e.next=7,this.beforeStateQueue.runMiddleware(t);case 7:return e.abrupt("return",this.queue(Object(d.a)(Object(l.a)().mark((function e(){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.directlySetCurrentUser(t);case 2:r.notifyAuthListeners();case 3:case"end":return e.stop()}}),e)})))));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signOut",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.beforeStateQueue.runMiddleware(null);case 2:if(!this.redirectPersistenceManager&&!this._popupRedirectResolver){e.next=5;break}return e.next=5,this._setRedirectUser(null);case 5:return e.abrupt("return",this._updateCurrentUser(null,!0));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setPersistence",value:function(e){var t=this;return this.queue(Object(d.a)(Object(l.a)().mark((function n(){return Object(l.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.assertedPersistence.setPersistence(F(e));case 2:case"end":return n.stop()}}),n)}))))}},{key:"_getPersistence",value:function(){return this.assertedPersistence.persistence.type}},{key:"_updateErrorMap",value:function(e){this._errorFactory=new g.b("auth","Firebase",e())}},{key:"onAuthStateChanged",value:function(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}},{key:"beforeAuthStateChanged",value:function(e,t){return this.beforeStateQueue.pushCallback(e,t)}},{key:"onIdTokenChanged",value:function(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}},{key:"toJSON",value:function(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}},{key:"_setRedirectUser",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t,n){var r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getOrInitRedirectPersistenceManager(n);case 2:return r=e.sent,e.abrupt("return",null===t?r.removeCurrentUser():r.setCurrentUser(t));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getOrInitRedirectPersistenceManager",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.redirectPersistenceManager){e.next=9;break}return R(n=t&&F(t)||this._popupRedirectResolver,this,"argument-error"),e.next=5,Ce.create(this,[F(n._redirectPersistence)],"redirectUser");case 5:return this.redirectPersistenceManager=e.sent,e.next=8,this.redirectPersistenceManager.getCurrentUser();case 8:this.redirectUser=e.sent;case 9:return e.abrupt("return",this.redirectPersistenceManager);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_redirectUserForId",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n,r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isInitialized){e.next=3;break}return e.next=3,this.queue(Object(d.a)(Object(l.a)().mark((function e(){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))));case 3:if((null===(n=this._currentUser)||void 0===n?void 0:n._redirectEventId)!==t){e.next=5;break}return e.abrupt("return",this._currentUser);case 5:if((null===(r=this.redirectUser)||void 0===r?void 0:r._redirectEventId)!==t){e.next=7;break}return e.abrupt("return",this.redirectUser);case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_persistUserIfCurrent",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n=this;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this.currentUser){e.next=2;break}return e.abrupt("return",this.queue(Object(d.a)(Object(l.a)().mark((function e(){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.directlySetCurrentUser(t));case 1:case"end":return e.stop()}}),e)})))));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_notifyListenersIfCurrent",value:function(e){e===this.currentUser&&this.notifyAuthListeners()}},{key:"_key",value:function(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}},{key:"_startProactiveRefresh",value:function(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}},{key:"_stopProactiveRefresh",value:function(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}},{key:"_currentUser",get:function(){return this.currentUser}},{key:"notifyAuthListeners",value:function(){var e,t;if(this._isInitialized){this.idTokenSubscription.next(this.currentUser);var n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}}},{key:"registerStateListener",value:function(e,t,n,r){var i=this;if(this._deleted)return function(){};var a="function"===typeof t?t:t.next.bind(t),o=this._isInitialized?Promise.resolve():this._initializationPromise;return R(o,this,"internal-error"),o.then((function(){return a(i.currentUser)})),"function"===typeof t?e.addObserver(t,n,r):e.addObserver(t)}},{key:"directlySetCurrentUser",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,!t){e.next=8;break}return e.next=6,this.assertedPersistence.setCurrentUser(t);case 6:e.next=10;break;case 8:return e.next=10,this.assertedPersistence.removeCurrentUser();case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queue",value:function(e){return this.operations=this.operations.then(e,e),this.operations}},{key:"assertedPersistence",get:function(){return R(this.persistenceManager,this,"internal-error"),this.persistenceManager}},{key:"_logFramework",value:function(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ge(this.config.clientPlatform,this._getFrameworks()))}},{key:"_getFrameworks",value:function(){return this.frameworks}},{key:"_getAdditionalHeaders",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){var t,n,r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(m.a)({},"X-Client-Version",this.clientVersion),this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId),e.next=4,null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader();case 4:return(r=e.sent)&&(n["X-Firebase-Client"]=r),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function qe(e){return Object(g.p)(e)}var Ye=function(){function e(t){var n=this;Object(f.a)(this,e),this.auth=t,this.observer=null,this.addObserver=Object(g.h)((function(e){return n.observer=e}))}return Object(p.a)(e,[{key:"next",get:function(){return R(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}]),e}();function Xe(e,t,n){var r=qe(e);R(r._canInitEmulator,r,"emulator-config-failed"),R(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");var i=!!(null===n||void 0===n?void 0:n.disableWarnings),a=Ke(t),o=function(e){var t=Ke(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};var r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){var a=i[1];return{host:a,port:Qe(r.substr(a.length+1))}}var o=r.split(":"),s=Object(h.a)(o,2);return{host:s[0],port:Qe(s[1])}}(t),s=o.host,u=o.port,c=null===u?"":":".concat(u);r.config.emulator={url:"".concat(a,"//").concat(s).concat(c,"/")},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:s,port:u,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){var e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Ke(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Qe(e){if(!e)return null;var t=Number(e);return isNaN(t)?null:t}var Ze=function(){function e(t,n){Object(f.a)(this,e),this.providerId=t,this.signInMethod=n}return Object(p.a)(e,[{key:"toJSON",value:function(){return L("not implemented")}},{key:"_getIdTokenResponse",value:function(e){return L("not implemented")}},{key:"_linkToIdToken",value:function(e,t){return L("not implemented")}},{key:"_getReauthenticationResolver",value:function(e){return L("not implemented")}}]),e}();function Je(e,t){return $e.apply(this,arguments)}function $e(){return($e=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K(t,"POST","/v1/accounts:resetPassword",X(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function et(e,t){return tt.apply(this,arguments)}function tt(){return(tt=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K(t,"POST","/v1/accounts:update",n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nt(e,t){return rt.apply(this,arguments)}function rt(){return(rt=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K(t,"POST","/v1/accounts:update",X(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function it(e,t){return at.apply(this,arguments)}function at(){return(at=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$(t,"POST","/v1/accounts:signInWithPassword",X(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ot(e,t){return st.apply(this,arguments)}function st(){return(st=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K(t,"POST","/v1/accounts:sendOobCode",X(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ut(e,t){return ct.apply(this,arguments)}function ct(){return(ct=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ot(t,n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lt(e,t){return ht.apply(this,arguments)}function ht(){return(ht=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ot(t,n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dt(e,t){return ft.apply(this,arguments)}function ft(){return(ft=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ot(t,n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pt(e,t){return vt.apply(this,arguments)}function vt(){return(vt=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ot(t,n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mt(e,t){return gt.apply(this,arguments)}function gt(){return(gt=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$(t,"POST","/v1/accounts:signInWithEmailLink",X(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function yt(e,t){return bt.apply(this,arguments)}function bt(){return(bt=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$(t,"POST","/v1/accounts:signInWithEmailLink",X(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var wt=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(f.a)(this,n),(a=t.call(this,"password",i))._email=e,a._password=r,a._tenantId=o,a}return Object(p.a)(n,[{key:"toJSON",value:function(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}},{key:"_getIdTokenResponse",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=this.signInMethod,e.next="password"===e.t0?3:"emailLink"===e.t0?4:5;break;case 3:return e.abrupt("return",it(t,{returnSecureToken:!0,email:this._email,password:this._password}));case 4:return e.abrupt("return",mt(t,{email:this._email,oobCode:this._password}));case 5:M(t,"internal-error");case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_linkToIdToken",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=this.signInMethod,e.next="password"===e.t0?3:"emailLink"===e.t0?4:5;break;case 3:return e.abrupt("return",et(t,{idToken:n,returnSecureToken:!0,email:this._email,password:this._password}));case 4:return e.abrupt("return",yt(t,{idToken:n,email:this._email,oobCode:this._password}));case 5:M(t,"internal-error");case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getReauthenticationResolver",value:function(e){return this._getIdTokenResponse(e)}}],[{key:"_fromEmailAndPassword",value:function(e,t){return new n(e,t,"password")}},{key:"_fromEmailAndCode",value:function(e,t){return new n(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},{key:"fromJSON",value:function(e){var t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}}]),n}(Ze);function xt(e,t){return Ot.apply(this,arguments)}function Ot(){return(Ot=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$(t,"POST","/v1/accounts:signInWithIdp",X(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var kt=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(f.a)(this,n),(e=t.apply(this,arguments)).pendingToken=null,e}return Object(p.a)(n,[{key:"toJSON",value:function(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}},{key:"_getIdTokenResponse",value:function(e){return xt(e,this.buildRequest())}},{key:"_linkToIdToken",value:function(e,t){var n=this.buildRequest();return n.idToken=t,xt(e,n)}},{key:"_getReauthenticationResolver",value:function(e){var t=this.buildRequest();return t.autoCreate=!1,xt(e,t)}},{key:"buildRequest",value:function(){var e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{var t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Object(g.A)(t)}return e}}],[{key:"_fromParams",value:function(e){var t=new n(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):M("argument-error"),t}},{key:"fromJSON",value:function(e){var t="string"===typeof e?JSON.parse(e):e,r=t.providerId,i=t.signInMethod,a=Object(w.a)(t,["providerId","signInMethod"]);if(!r||!i)return null;var o=new n(r,i);return o.idToken=a.idToken||void 0,o.accessToken=a.accessToken||void 0,o.secret=a.secret,o.nonce=a.nonce,o.pendingToken=a.pendingToken||null,o}}]),n}(Ze);function _t(e,t){return St.apply(this,arguments)}function St(){return(St=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K(t,"POST","/v1/accounts:sendVerificationCode",X(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Et(){return(Et=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$(t,"POST","/v1/accounts:signInWithPhoneNumber",X(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function At(){return(At=Object(d.a)(Object(l.a)().mark((function e(t,n){var r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$(t,"POST","/v1/accounts:signInWithPhoneNumber",X(t,n));case 2:if(!(r=e.sent).temporaryProof){e.next=5;break}throw re(t,"account-exists-with-different-credential",r);case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var jt=Object(m.a)({},"USER_NOT_FOUND","user-not-found");function Tt(){return(Tt=Object(d.a)(Object(l.a)().mark((function e(t,n){var r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object.assign(Object.assign({},n),{operation:"REAUTH"}),e.abrupt("return",$(t,"POST","/v1/accounts:signInWithPhoneNumber",X(t,r),jt));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Mt=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,"phone","phone")).params=e,r}return Object(p.a)(n,[{key:"_getIdTokenResponse",value:function(e){return function(e,t){return Et.apply(this,arguments)}(e,this._makeVerificationRequest())}},{key:"_linkToIdToken",value:function(e,t){return function(e,t){return At.apply(this,arguments)}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}},{key:"_getReauthenticationResolver",value:function(e){return function(e,t){return Tt.apply(this,arguments)}(e,this._makeVerificationRequest())}},{key:"_makeVerificationRequest",value:function(){var e=this.params,t=e.temporaryProof,n=e.phoneNumber,r=e.verificationId,i=e.verificationCode;return t&&n?{temporaryProof:t,phoneNumber:n}:{sessionInfo:r,code:i}}},{key:"toJSON",value:function(){var e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}}],[{key:"_fromVerification",value:function(e,t){return new n({verificationId:e,verificationCode:t})}},{key:"_fromTokenResponse",value:function(e,t){return new n({phoneNumber:e,temporaryProof:t})}},{key:"fromJSON",value:function(e){"string"===typeof e&&(e=JSON.parse(e));var t=e,r=t.verificationId,i=t.verificationCode,a=t.phoneNumber,o=t.temporaryProof;return i||r||a||o?new n({verificationId:r,verificationCode:i,phoneNumber:a,temporaryProof:o}):null}}]),n}(Ze);var Ct=function(){function e(t){var n,r,i,a,o,s;Object(f.a)(this,e);var u=Object(g.B)(Object(g.k)(t)),c=null!==(n=u.apiKey)&&void 0!==n?n:null,l=null!==(r=u.oobCode)&&void 0!==r?r:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=u.mode)&&void 0!==i?i:null);R(c&&l&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=l,this.continueUrl=null!==(a=u.continueUrl)&&void 0!==a?a:null,this.languageCode=null!==(o=u.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(s=u.tenantId)&&void 0!==s?s:null}return Object(p.a)(e,null,[{key:"parseLink",value:function(t){var n=function(e){var t=Object(g.B)(Object(g.k)(e)).link,n=t?Object(g.B)(Object(g.k)(t)).deep_link_id:null,r=Object(g.B)(Object(g.k)(e)).deep_link_id;return(r?Object(g.B)(Object(g.k)(r)).link:null)||r||n||t||e}(t);try{return new e(n)}catch(r){return null}}}]),e}();var Dt=function(){function e(){Object(f.a)(this,e),this.providerId=e.PROVIDER_ID}return Object(p.a)(e,null,[{key:"credential",value:function(e,t){return wt._fromEmailAndPassword(e,t)}},{key:"credentialWithLink",value:function(e,t){var n=Ct.parseLink(t);return R(n,"argument-error"),wt._fromEmailAndCode(e,n.code,n.tenantId)}}]),e}();Dt.PROVIDER_ID="password",Dt.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Dt.EMAIL_LINK_SIGN_IN_METHOD="emailLink";var It=function(){function e(t){Object(f.a)(this,e),this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}return Object(p.a)(e,[{key:"setDefaultLanguage",value:function(e){this.defaultLanguageCode=e}},{key:"setCustomParameters",value:function(e){return this.customParameters=e,this}},{key:"getCustomParameters",value:function(){return this.customParameters}}]),e}(),Pt=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(f.a)(this,n),(e=t.apply(this,arguments)).scopes=[],e}return Object(p.a)(n,[{key:"addScope",value:function(e){return this.scopes.includes(e)||this.scopes.push(e),this}},{key:"getScopes",value:function(){return Object(v.a)(this.scopes)}}]),n}(It),Rt=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"credential",value:function(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}},{key:"_credential",value:function(e){return R(e.idToken||e.accessToken,"argument-error"),kt._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}}],[{key:"credentialFromJSON",value:function(e){var t="string"===typeof e?JSON.parse(e):e;return R("providerId"in t&&"signInMethod"in t,"argument-error"),kt._fromParams(t)}},{key:"credentialFromResult",value:function(e){return n.oauthCredentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return n.oauthCredentialFromTaggedObject(e.customData||{})}},{key:"oauthCredentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t)return null;var r=t.oauthIdToken,i=t.oauthAccessToken,a=t.oauthTokenSecret,o=t.pendingToken,s=t.nonce,u=t.providerId;if(!i&&!a&&!r&&!o)return null;if(!u)return null;try{return new n(u)._credential({idToken:r,accessToken:i,nonce:s,pendingToken:o})}catch(c){return null}}}]),n}(Pt),Lt=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){return Object(f.a)(this,n),t.call(this,"facebook.com")}return Object(p.a)(n,null,[{key:"credential",value:function(e){return kt._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}},{key:"credentialFromResult",value:function(e){return n.credentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return n.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return n.credential(t.oauthAccessToken)}catch(r){return null}}}]),n}(Pt);Lt.FACEBOOK_SIGN_IN_METHOD="facebook.com",Lt.PROVIDER_ID="facebook.com";var Nt=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(f.a)(this,n),(e=t.call(this,"google.com")).addScope("profile"),e}return Object(p.a)(n,null,[{key:"credential",value:function(e,t){return kt._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}},{key:"credentialFromResult",value:function(e){return n.credentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return n.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t)return null;var r=t.oauthIdToken,i=t.oauthAccessToken;if(!r&&!i)return null;try{return n.credential(r,i)}catch(a){return null}}}]),n}(Pt);Nt.GOOGLE_SIGN_IN_METHOD="google.com",Nt.PROVIDER_ID="google.com";var Bt=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){return Object(f.a)(this,n),t.call(this,"github.com")}return Object(p.a)(n,null,[{key:"credential",value:function(e){return kt._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GITHUB_SIGN_IN_METHOD,accessToken:e})}},{key:"credentialFromResult",value:function(e){return n.credentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return n.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return n.credential(t.oauthAccessToken)}catch(r){return null}}}]),n}(Pt);Bt.GITHUB_SIGN_IN_METHOD="github.com",Bt.PROVIDER_ID="github.com";var Ft=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this,e,e)).pendingToken=r,i}return Object(p.a)(n,[{key:"_getIdTokenResponse",value:function(e){return xt(e,this.buildRequest())}},{key:"_linkToIdToken",value:function(e,t){var n=this.buildRequest();return n.idToken=t,xt(e,n)}},{key:"_getReauthenticationResolver",value:function(e){var t=this.buildRequest();return t.autoCreate=!1,xt(e,t)}},{key:"toJSON",value:function(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}},{key:"buildRequest",value:function(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}],[{key:"fromJSON",value:function(e){var t="string"===typeof e?JSON.parse(e):e,r=t.providerId,i=t.signInMethod,a=t.pendingToken;return r&&i&&a&&r===i?new n(r,a):null}},{key:"_create",value:function(e,t){return new n(e,t)}}]),n}(Ze),Ut="saml.",zt=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){return Object(f.a)(this,n),R(e.startsWith(Ut),"argument-error"),t.call(this,e)}return Object(p.a)(n,null,[{key:"credentialFromResult",value:function(e){return n.samlCredentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return n.samlCredentialFromTaggedObject(e.customData||{})}},{key:"credentialFromJSON",value:function(e){var t=Ft.fromJSON(e);return R(t,"argument-error"),t}},{key:"samlCredentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t)return null;var n=t.pendingToken,r=t.providerId;if(!n||!r)return null;try{return Ft._create(r,n)}catch(i){return null}}}]),n}(It),Vt=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){return Object(f.a)(this,n),t.call(this,"twitter.com")}return Object(p.a)(n,null,[{key:"credential",value:function(e,t){return kt._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}},{key:"credentialFromResult",value:function(e){return n.credentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return n.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t)return null;var r=t.oauthAccessToken,i=t.oauthTokenSecret;if(!r||!i)return null;try{return n.credential(r,i)}catch(a){return null}}}]),n}(Pt);function Gt(e,t){return Ht.apply(this,arguments)}function Ht(){return(Ht=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$(t,"POST","/v1/accounts:signUp",X(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Vt.TWITTER_SIGN_IN_METHOD="twitter.com",Vt.PROVIDER_ID="twitter.com";var Wt=function(){function e(t){Object(f.a)(this,e),this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}return Object(p.a)(e,null,[{key:"_fromIdTokenResponse",value:function(){var t=Object(d.a)(Object(l.a)().mark((function t(n,r,i){var a,o,s,u,c=arguments;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=c.length>3&&void 0!==c[3]&&c[3],t.next=3,Ae._fromIdTokenResponse(n,i,a);case 3:return o=t.sent,s=qt(i),u=new e({user:o,providerId:s,_tokenResponse:i,operationType:r}),t.abrupt("return",u);case 7:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"_forOperation",value:function(){var t=Object(d.a)(Object(l.a)().mark((function t(n,r,i){var a;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n._updateTokensIfNecessary(i,!0);case 2:return a=qt(i),t.abrupt("return",new e({user:n,providerId:a,_tokenResponse:i,operationType:r}));case 4:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()}]),e}();function qt(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}function Yt(e){return Xt.apply(this,arguments)}function Xt(){return(Xt=Object(d.a)(Object(l.a)().mark((function e(t){var n,r,i,a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=qe(t),e.next=3,r._initializationPromise;case 3:if(!(null===(n=r.currentUser)||void 0===n?void 0:n.isAnonymous)){e.next=5;break}return e.abrupt("return",new Wt({user:r.currentUser,providerId:null,operationType:"signIn"}));case 5:return e.next=7,Gt(r,{returnSecureToken:!0});case 7:return i=e.sent,e.next=10,Wt._fromIdTokenResponse(r,"signIn",i,!0);case 10:return a=e.sent,e.next=13,r._updateCurrentUser(a.user);case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Kt=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e,r,i,a){var s,u;return Object(f.a)(this,n),(s=t.call(this,r.code,r.message)).operationType=i,s.user=a,Object.setPrototypeOf(Object(o.a)(s),n.prototype),s.customData={appName:e.name,tenantId:null!==(u=e.tenantId)&&void 0!==u?u:void 0,_serverResponse:r.customData._serverResponse,operationType:i},s}return Object(p.a)(n,null,[{key:"_fromErrorAndOperation",value:function(e,t,r,i){return new n(e,t,r,i)}}]),n}(g.c);function Qt(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((function(n){if(n.code==="auth/".concat("multi-factor-auth-required"))throw Kt._fromErrorAndOperation(e,n,t,r);throw n}))}function Zt(e){return new Set(e.map((function(e){return e.providerId})).filter((function(e){return!!e})))}function Jt(e,t){return $t.apply(this,arguments)}function $t(){return($t=Object(d.a)(Object(l.a)().mark((function e(t,n){var r,i,a,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(g.p)(t),e.next=3,nn(!0,r,n);case 3:return e.t0=oe,e.t1=r.auth,e.next=7,r.getIdToken();case 7:return e.t2=e.sent,e.t3=[n],e.t4={idToken:e.t2,deleteProvider:e.t3},e.next=12,(0,e.t0)(e.t1,e.t4);case 12:return i=e.sent,a=i.providerUserInfo,o=Zt(a||[]),r.providerData=r.providerData.filter((function(e){return o.has(e.providerId)})),o.has("phone")||(r.phoneNumber=null),e.next=19,r.auth._persistUserIfCurrent(r);case 19:return e.abrupt("return",r);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function en(e,t){return tn.apply(this,arguments)}function tn(){return tn=Object(d.a)(Object(l.a)().mark((function e(t,n){var r,i,a=arguments;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]&&a[2],e.t0=pe,e.t1=t,e.t2=n,e.t3=t.auth,e.next=7,t.getIdToken();case 7:return e.t4=e.sent,e.t5=e.t2._linkToIdToken.call(e.t2,e.t3,e.t4),e.t6=r,e.next=12,(0,e.t0)(e.t1,e.t5,e.t6);case 12:return i=e.sent,e.abrupt("return",Wt._forOperation(t,"link",i));case 14:case"end":return e.stop()}}),e)}))),tn.apply(this,arguments)}function nn(e,t,n){return rn.apply(this,arguments)}function rn(){return(rn=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be(n);case 2:i=Zt(n.providerData),a=!1===t?"provider-already-linked":"no-such-provider",R(i.has(r)===t,n.auth,a);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function an(e,t){return on.apply(this,arguments)}function on(){return on=Object(d.a)(Object(l.a)().mark((function e(t,n){var r,i,a,o,s,u,c=arguments;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>2&&void 0!==c[2]&&c[2],i=t.auth,a="reauthenticate",e.prev=3,e.next=6,pe(t,Qt(i,a,n,t),r);case 6:return R((o=e.sent).idToken,i,"internal-error"),R(s=fe(o.idToken),i,"internal-error"),u=s.sub,R(t.uid===u,i,"user-mismatch"),e.abrupt("return",Wt._forOperation(t,a,o));case 15:throw e.prev=15,e.t0=e.catch(3),(null===e.t0||void 0===e.t0?void 0:e.t0.code)==="auth/".concat("user-not-found")&&M(i,"user-mismatch"),e.t0;case 19:case"end":return e.stop()}}),e,null,[[3,15]])}))),on.apply(this,arguments)}function sn(e,t){return un.apply(this,arguments)}function un(){return un=Object(d.a)(Object(l.a)().mark((function e(t,n){var r,i,a,o,s=arguments;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]&&s[2],i="signIn",e.next=4,Qt(t,i,n);case 4:return a=e.sent,e.next=7,Wt._fromIdTokenResponse(t,i,a);case 7:if(o=e.sent,r){e.next=11;break}return e.next=11,t._updateCurrentUser(o.user);case 11:return e.abrupt("return",o);case 12:case"end":return e.stop()}}),e)}))),un.apply(this,arguments)}function cn(e,t){return ln.apply(this,arguments)}function ln(){return(ln=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",sn(qe(t),n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function hn(e,t){return dn.apply(this,arguments)}function dn(){return(dn=Object(d.a)(Object(l.a)().mark((function e(t,n){var r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(g.p)(t),e.next=3,nn(!1,r,n.providerId);case 3:return e.abrupt("return",en(r,n));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fn(e,t){return pn.apply(this,arguments)}function pn(){return(pn=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",an(Object(g.p)(t),n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vn(e,t){return mn.apply(this,arguments)}function mn(){return(mn=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$(t,"POST","/v1/accounts:signInWithCustomToken",X(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gn(e,t){return yn.apply(this,arguments)}function yn(){return(yn=Object(d.a)(Object(l.a)().mark((function e(t,n){var r,i,a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=qe(t),e.next=3,vn(r,{token:n,returnSecureToken:!0});case 3:return i=e.sent,e.next=6,Wt._fromIdTokenResponse(r,"signIn",i);case 6:return a=e.sent,e.next=9,r._updateCurrentUser(a.user);case 9:return e.abrupt("return",a);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var bn=function(){function e(t,n){Object(f.a)(this,e),this.factorId=t,this.uid=n.mfaEnrollmentId,this.enrollmentTime=new Date(n.enrolledAt).toUTCString(),this.displayName=n.displayName}return Object(p.a)(e,null,[{key:"_fromServerResponse",value:function(e,t){return"phoneInfo"in t?wn._fromServerResponse(e,t):M(e,"internal-error")}}]),e}(),wn=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,"phone",e)).phoneNumber=e.phoneInfo,r}return Object(p.a)(n,null,[{key:"_fromServerResponse",value:function(e,t){return new n(t)}}]),n}(bn);function xn(e,t,n){var r;R((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),R("undefined"===typeof n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(R(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(R(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}function On(e,t,n){return kn.apply(this,arguments)}function kn(){return(kn=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object(g.p)(t),a={requestType:"PASSWORD_RESET",email:n},r&&xn(i,a,r),e.next=5,lt(i,a);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _n(e,t,n){return Sn.apply(this,arguments)}function Sn(){return(Sn=Object(d.a)(Object(l.a)().mark((function e(t,n,r){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Je(Object(g.p)(t),{oobCode:n,newPassword:r});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function En(e,t){return An.apply(this,arguments)}function An(){return(An=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt(Object(g.p)(t),{oobCode:n});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jn(e,t){return Tn.apply(this,arguments)}function Tn(){return(Tn=Object(d.a)(Object(l.a)().mark((function e(t,n){var r,i,a,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(g.p)(t),e.next=3,Je(r,{oobCode:n});case 3:i=e.sent,R(a=i.requestType,r,"internal-error"),e.t0=a,e.next="EMAIL_SIGNIN"===e.t0?9:"VERIFY_AND_CHANGE_EMAIL"===e.t0?10:"REVERT_SECOND_FACTOR_ADDITION"===e.t0?12:13;break;case 9:return e.abrupt("break",14);case 10:return R(i.newEmail,r,"internal-error"),e.abrupt("break",14);case 12:R(i.mfaInfo,r,"internal-error");case 13:R(i.email,r,"internal-error");case 14:return o=null,i.mfaInfo&&(o=bn._fromServerResponse(qe(r),i.mfaInfo)),e.abrupt("return",{data:{email:("VERIFY_AND_CHANGE_EMAIL"===i.requestType?i.newEmail:i.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===i.requestType?i.email:i.newEmail)||null,multiFactorInfo:o},operation:a});case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Mn(e,t){return Cn.apply(this,arguments)}function Cn(){return(Cn=Object(d.a)(Object(l.a)().mark((function e(t,n){var r,i;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jn(Object(g.p)(t),n);case 2:return r=e.sent,i=r.data,e.abrupt("return",i.email);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dn(e,t,n){return In.apply(this,arguments)}function In(){return(In=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=qe(t),e.next=3,Gt(i,{returnSecureToken:!0,email:n,password:r});case 3:return a=e.sent,e.next=6,Wt._fromIdTokenResponse(i,"signIn",a);case 6:return o=e.sent,e.next=9,i._updateCurrentUser(o.user);case 9:return e.abrupt("return",o);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pn(e,t,n){return cn(Object(g.p)(e),Dt.credential(t,n))}function Rn(e,t,n){return Ln.apply(this,arguments)}function Ln(){return(Ln=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object(g.p)(t),a={requestType:"EMAIL_SIGNIN",email:n},R(r.handleCodeInApp,i,"argument-error"),r&&xn(i,a,r),e.next=6,dt(i,a);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nn(e,t){var n=Ct.parseLink(t);return"EMAIL_SIGNIN"===(null===n||void 0===n?void 0:n.operation)}function Bn(e,t,n){return Fn.apply(this,arguments)}function Fn(){return(Fn=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object(g.p)(t),R((a=Dt.credentialWithLink(n,r||U()))._tenantId===(i.tenantId||null),i,"tenant-id-mismatch"),e.abrupt("return",cn(i,a));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Un(e,t){return zn.apply(this,arguments)}function zn(){return(zn=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K(t,"POST","/v1/accounts:createAuthUri",X(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Vn(e,t){return Gn.apply(this,arguments)}function Gn(){return(Gn=Object(d.a)(Object(l.a)().mark((function e(t,n){var r,i,a,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=z()?U():"http://localhost",i={identifier:n,continueUri:r},e.next=4,Un(Object(g.p)(t),i);case 4:return a=e.sent,o=a.signinMethods,e.abrupt("return",o||[]);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Hn(e,t){return Wn.apply(this,arguments)}function Wn(){return(Wn=Object(d.a)(Object(l.a)().mark((function e(t,n){var r,i,a,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(g.p)(t),e.next=3,t.getIdToken();case 3:return i=e.sent,a={requestType:"VERIFY_EMAIL",idToken:i},n&&xn(r.auth,a,n),e.next=8,ut(r.auth,a);case 8:if(o=e.sent,o.email===t.email){e.next=13;break}return e.next=13,t.reload();case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qn(e,t,n){return Yn.apply(this,arguments)}function Yn(){return(Yn=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a,o,s;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object(g.p)(t),e.next=3,t.getIdToken();case 3:return a=e.sent,o={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:a,newEmail:n},r&&xn(i.auth,o,r),e.next=8,pt(i.auth,o);case 8:if(s=e.sent,s.email===t.email){e.next=13;break}return e.next=13,t.reload();case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xn(e,t){return Kn.apply(this,arguments)}function Kn(){return(Kn=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K(t,"POST","/v1/accounts:update",n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qn(e,t){return Zn.apply(this,arguments)}function Zn(){return(Zn=Object(d.a)(Object(l.a)().mark((function e(t,n){var r,i,a,o,s,u,c;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.displayName,i=n.photoURL,void 0!==r||void 0!==i){e.next=3;break}return e.abrupt("return");case 3:return a=Object(g.p)(t),e.next=6,a.getIdToken();case 6:return o=e.sent,s={idToken:o,displayName:r,photoUrl:i,returnSecureToken:!0},e.next=10,pe(a,Xn(a.auth,s));case 10:return u=e.sent,a.displayName=u.displayName||null,a.photoURL=u.photoUrl||null,(c=a.providerData.find((function(e){return"password"===e.providerId})))&&(c.displayName=a.displayName,c.photoURL=a.photoURL),e.next=17,a._updateTokensIfNecessary(u);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jn(e,t){return er(Object(g.p)(e),t,null)}function $n(e,t){return er(Object(g.p)(e),null,t)}function er(e,t,n){return tr.apply(this,arguments)}function tr(){return(tr=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a,o,s;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.auth,e.next=3,t.getIdToken();case 3:return a=e.sent,o={idToken:a,returnSecureToken:!0},n&&(o.email=n),r&&(o.password=r),e.next=9,pe(t,et(i,o));case 9:return s=e.sent,e.next=12,t._updateTokensIfNecessary(s,!0);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var nr=Object(p.a)((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(f.a)(this,e),this.isNewUser=t,this.providerId=n,this.profile=r})),rr=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e,r,i,a){var o;return Object(f.a)(this,n),(o=t.call(this,e,r,i)).username=a,o}return Object(p.a)(n)}(nr),ir=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e,r){return Object(f.a)(this,n),t.call(this,e,"facebook.com",r)}return Object(p.a)(n)}(nr),ar=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e,r){return Object(f.a)(this,n),t.call(this,e,"github.com",r,"string"===typeof(null===r||void 0===r?void 0:r.login)?null===r||void 0===r?void 0:r.login:null)}return Object(p.a)(n)}(rr),or=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e,r){return Object(f.a)(this,n),t.call(this,e,"google.com",r)}return Object(p.a)(n)}(nr),sr=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e,r,i){return Object(f.a)(this,n),t.call(this,e,"twitter.com",r,i)}return Object(p.a)(n)}(rr);function ur(e){var t=e.user,n=e._tokenResponse;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;var r=e.providerId,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},a=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null===e||void 0===e?void 0:e.idToken)){var o=null===(n=null===(t=fe(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(o)return new nr(a,"anonymous"!==o&&"custom"!==o?o:null)}if(!r)return null;switch(r){case"facebook.com":return new ir(a,i);case"github.com":return new ar(a,i);case"google.com":return new or(a,i);case"twitter.com":return new sr(a,i,e.screenName||null);case"custom":case"anonymous":return new nr(a,null);default:return new nr(a,r,i)}}(n)}function cr(e){return Object(g.p)(e).signOut()}var lr=function(){function e(t,n,r){Object(f.a)(this,e),this.type=t,this.credential=n,this.auth=r}return Object(p.a)(e,[{key:"toJSON",value:function(){var e="enroll"===this.type?"idToken":"pendingCredential";return{multiFactorSession:Object(m.a)({},e,this.credential)}}}],[{key:"_fromIdtoken",value:function(t,n){return new e("enroll",t,n)}},{key:"_fromMfaPendingCredential",value:function(t){return new e("signin",t)}},{key:"fromJSON",value:function(t){var n,r;if(null===t||void 0===t?void 0:t.multiFactorSession){if(null===(n=t.multiFactorSession)||void 0===n?void 0:n.pendingCredential)return e._fromMfaPendingCredential(t.multiFactorSession.pendingCredential);if(null===(r=t.multiFactorSession)||void 0===r?void 0:r.idToken)return e._fromIdtoken(t.multiFactorSession.idToken)}return null}}]),e}(),hr=function(){function e(t,n,r){Object(f.a)(this,e),this.session=t,this.hints=n,this.signInResolver=r}return Object(p.a)(e,[{key:"resolveSignIn",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,e.abrupt("return",this.signInResolver(n));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"_fromError",value:function(t,n){var r=qe(t),i=n.customData._serverResponse,a=(i.mfaInfo||[]).map((function(e){return bn._fromServerResponse(r,e)}));R(i.mfaPendingCredential,r,"internal-error");var o=lr._fromMfaPendingCredential(i.mfaPendingCredential);return new e(o,a,function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var a,s,u;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._process(r,o);case 2:a=e.sent,delete i.mfaInfo,delete i.mfaPendingCredential,s=Object.assign(Object.assign({},i),{idToken:a.idToken,refreshToken:a.refreshToken}),e.t0=n.operationType,e.next="signIn"===e.t0?9:"reauthenticate"===e.t0?15:17;break;case 9:return e.next=11,Wt._fromIdTokenResponse(r,n.operationType,s);case 11:return u=e.sent,e.next=14,r._updateCurrentUser(u.user);case 14:return e.abrupt("return",u);case 15:return R(n.user,r,"internal-error"),e.abrupt("return",Wt._forOperation(n.user,n.operationType,s));case 17:M(r,"internal-error");case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}]),e}();function dr(e,t){var n,r=Object(g.p)(e),i=t;return R(t.customData.operationType,r,"argument-error"),R(null===(n=i.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,r,"argument-error"),hr._fromError(r,i)}function fr(e,t){return K(e,"POST","/v2/accounts/mfaEnrollment:start",X(e,t))}var pr=function(){function e(t){var n=this;Object(f.a)(this,e),this.user=t,this.enrolledFactors=[],t._onReload((function(e){e.mfaInfo&&(n.enrolledFactors=e.mfaInfo.map((function(e){return bn._fromServerResponse(t.auth,e)})))}))}return Object(p.a)(e,[{key:"getSession",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=lr,e.next=3,this.user.getIdToken();case 3:return e.t1=e.sent,e.t2=this.user.auth,e.abrupt("return",e.t0._fromIdtoken.call(e.t0,e.t1,e.t2));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"enroll",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t,n){var r,i,a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t,e.next=3,this.getSession();case 3:return i=e.sent,e.next=6,pe(this.user,r._process(this.user.auth,i,n));case 6:return a=e.sent,e.next=9,this.user._updateTokensIfNecessary(a);case 9:return e.abrupt("return",this.user.reload());case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"unenroll",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n,r,i;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="string"===typeof t?t:t.uid,e.next=3,this.user.getIdToken();case 3:return r=e.sent,e.prev=4,e.next=7,pe(this.user,K(a=this.user.auth,"POST","/v2/accounts/mfaEnrollment:withdraw",X(a,{idToken:r,mfaEnrollmentId:n})));case 7:return i=e.sent,this.enrolledFactors=this.enrolledFactors.filter((function(e){return e.uid!==n})),e.next=11,this.user._updateTokensIfNecessary(i);case 11:return e.next=13,this.user.reload();case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(4),e.t0;case 18:case"end":return e.stop()}var a}),e,this,[[4,15]])})));return function(t){return e.apply(this,arguments)}}()}],[{key:"_fromUser",value:function(t){return new e(t)}}]),e}(),vr=new WeakMap;function mr(e){var t=Object(g.p)(e);return vr.has(t)||vr.set(t,pr._fromUser(t)),vr.get(t)}var gr="__sak",yr=function(){function e(t,n){Object(f.a)(this,e),this.storageRetriever=t,this.type=n}return Object(p.a)(e,[{key:"_isAvailable",value:function(){try{return this.storage?(this.storage.setItem(gr,"1"),this.storage.removeItem(gr),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}},{key:"_set",value:function(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}},{key:"_get",value:function(e){var t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}},{key:"_remove",value:function(e){return this.storage.removeItem(e),Promise.resolve()}},{key:"storage",get:function(){return this.storageRetriever()}}]),e}();var br=10,wr=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(f.a)(this,n),(e=t.call(this,(function(){return window.localStorage}),"LOCAL")).boundEventHandler=function(t,n){return e.onStorageEvent(t,n)},e.listeners={},e.localCache={},e.pollTimer=null,e.safariLocalStorageNotSynced=function(){var e=Object(g.q)();return Pe(e)||Ue(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),e.fallbackToPolling=Ve(),e._shouldAllowMigration=!0,e}return Object(p.a)(n,[{key:"forAllChangedKeys",value:function(e){for(var t=0,n=Object.keys(this.listeners);t<n.length;t++){var r=n[t],i=this.storage.getItem(r),a=this.localCache[r];i!==a&&e(r,a,i)}}},{key:"onStorageEvent",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.key){var r=e.key;if(n?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){var i=this.storage.getItem(r);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!n)return}var a=function(){var e=t.storage.getItem(r);(n||t.localCache[r]!==e)&&t.notifyListeners(r,e)},o=this.storage.getItem(r);Object(g.u)()&&10===document.documentMode&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,br):a()}else this.forAllChangedKeys((function(e,n,r){t.notifyListeners(e,r)}))}},{key:"notifyListeners",value:function(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(var r=0,i=Array.from(n);r<i.length;r++){(0,i[r])(t?JSON.parse(t):t)}}},{key:"startPolling",value:function(){var e=this;this.stopPolling(),this.pollTimer=setInterval((function(){e.forAllChangedKeys((function(t,n,r){e.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:n,newValue:r}),!0)}))}),1e3)}},{key:"stopPolling",value:function(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}},{key:"attachListener",value:function(){window.addEventListener("storage",this.boundEventHandler)}},{key:"detachListener",value:function(){window.removeEventListener("storage",this.boundEventHandler)}},{key:"_addListener",value:function(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}},{key:"_removeListener",value:function(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}},{key:"_set",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t,r){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.a)(Object(a.a)(n.prototype),"_set",this).call(this,t,r);case 2:this.localCache[t]=JSON.stringify(r);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_get",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.a)(Object(a.a)(n.prototype),"_get",this).call(this,t);case 2:return r=e.sent,this.localCache[t]=JSON.stringify(r),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_remove",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.a)(Object(a.a)(n.prototype),"_remove",this).call(this,t);case 2:delete this.localCache[t];case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(yr);wr.type="LOCAL";var xr=wr,Or=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){return Object(f.a)(this,n),t.call(this,(function(){return window.sessionStorage}),"SESSION")}return Object(p.a)(n,[{key:"_addListener",value:function(e,t){}},{key:"_removeListener",value:function(e,t){}}]),n}(yr);Or.type="SESSION";var kr=Or;function _r(e){return Promise.all(e.map(function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t;case 3:return n=e.sent,e.abrupt("return",{fulfilled:!0,value:n});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{fulfilled:!1,reason:e.t0});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()))}var Sr=function(){function e(t){Object(f.a)(this,e),this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}return Object(p.a)(e,[{key:"isListeningto",value:function(e){return this.eventTarget===e}},{key:"handleEvent",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n,r,i,a,o,s,u,c;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=t).data,i=r.eventId,a=r.eventType,o=r.data,null===(s=this.handlersMap[a])||void 0===s?void 0:s.size){e.next=5;break}return e.abrupt("return");case 5:return n.ports[0].postMessage({status:"ack",eventId:i,eventType:a}),u=Array.from(s).map(function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t(n.origin,o));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=9,_r(u);case 9:c=e.sent,n.ports[0].postMessage({status:"done",eventId:i,eventType:a,response:c});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_subscribe",value:function(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}},{key:"_unsubscribe",value:function(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}],[{key:"_getInstance",value:function(t){var n=this.receivers.find((function(e){return e.isListeningto(t)}));if(n)return n;var r=new e(t);return this.receivers.push(r),r}}]),e}();function Er(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="",r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}Sr.receivers=[];var Ar=function(){function e(t){Object(f.a)(this,e),this.target=t,this.handlers=new Set}return Object(p.a)(e,[{key:"removeMessageHandler",value:function(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}},{key:"_send",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t,n){var r,i,a,o,s=this,u=arguments;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>2&&void 0!==u[2]?u[2]:50,i="undefined"!==typeof MessageChannel?new MessageChannel:null){e.next=4;break}throw new Error("connection_unavailable");case 4:return e.abrupt("return",new Promise((function(e,u){var c=Er("",20);i.port1.start();var l=setTimeout((function(){u(new Error("unsupported_event"))}),r);o={messageChannel:i,onMessage:function(t){var n=t;if(n.data.eventId===c)switch(n.data.status){case"ack":clearTimeout(l),a=setTimeout((function(){u(new Error("timeout"))}),3e3);break;case"done":clearTimeout(a),e(n.data.response);break;default:clearTimeout(l),clearTimeout(a),u(new Error("invalid_response"))}}},s.handlers.add(o),i.port1.addEventListener("message",o.onMessage),s.target.postMessage({eventType:t,eventId:c,data:n},[i.port2])})).finally((function(){o&&s.removeMessageHandler(o)})));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function jr(){return window}function Tr(){return"undefined"!==typeof jr().WorkerGlobalScope&&"function"===typeof jr().importScripts}function Mr(){return Cr.apply(this,arguments)}function Cr(){return(Cr=Object(d.a)(Object(l.a)().mark((function e(){var t;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===navigator||void 0===navigator?void 0:navigator.serviceWorker){e.next=2;break}return e.abrupt("return",null);case 2:return e.prev=2,e.next=5,navigator.serviceWorker.ready;case 5:return t=e.sent,e.abrupt("return",t.active);case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}function Dr(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}var Ir="firebaseLocalStorageDb",Pr=1,Rr="firebaseLocalStorage",Lr="fbase_key",Nr=function(){function e(t){Object(f.a)(this,e),this.request=t}return Object(p.a)(e,[{key:"toPromise",value:function(){var e=this;return new Promise((function(t,n){e.request.addEventListener("success",(function(){t(e.request.result)})),e.request.addEventListener("error",(function(){n(e.request.error)}))}))}}]),e}();function Br(e,t){return e.transaction([Rr],t?"readwrite":"readonly").objectStore(Rr)}function Fr(){var e=indexedDB.deleteDatabase(Ir);return new Nr(e).toPromise()}function Ur(){var e=indexedDB.open(Ir,Pr);return new Promise((function(t,n){e.addEventListener("error",(function(){n(e.error)})),e.addEventListener("upgradeneeded",(function(){var t=e.result;try{t.createObjectStore(Rr,{keyPath:Lr})}catch(r){n(r)}})),e.addEventListener("success",Object(d.a)(Object(l.a)().mark((function n(){var r;return Object(l.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((r=e.result).objectStoreNames.contains(Rr)){n.next=12;break}return r.close(),n.next=5,Fr();case 5:return n.t0=t,n.next=8,Ur();case 8:n.t1=n.sent,(0,n.t0)(n.t1),n.next=13;break;case 12:t(r);case 13:case"end":return n.stop()}}),n)}))))}))}function zr(e,t,n){return Vr.apply(this,arguments)}function Vr(){return(Vr=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Br(t,!0).put((i={},Object(m.a)(i,Lr,n),Object(m.a)(i,"value",r),i)),e.abrupt("return",new Nr(a).toPromise());case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gr(e,t){return Hr.apply(this,arguments)}function Hr(){return(Hr=Object(d.a)(Object(l.a)().mark((function e(t,n){var r,i;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Br(t,!1).get(n),e.next=3,new Nr(r).toPromise();case 3:return i=e.sent,e.abrupt("return",void 0===i?null:i.value);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wr(e,t){var n=Br(e,!0).delete(t);return new Nr(n).toPromise()}var qr=function(){function e(){Object(f.a)(this,e),this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((function(){}),(function(){}))}return Object(p.a)(e,[{key:"_openDb",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.db){e.next=2;break}return e.abrupt("return",this.db);case 2:return e.next=4,Ur();case 4:return this.db=e.sent,e.abrupt("return",this.db);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_withRetries",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n,r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:return e.prev=2,e.next=5,this._openDb();case 5:return r=e.sent,e.next=8,t(r);case 8:return e.abrupt("return",e.sent);case 11:if(e.prev=11,e.t0=e.catch(2),!(n++>3)){e.next=15;break}throw e.t0;case 15:this.db&&(this.db.close(),this.db=void 0);case 16:e.next=1;break;case 18:case"end":return e.stop()}}),e,this,[[2,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"initializeServiceWorkerMessaging",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Tr()?this.initializeReceiver():this.initializeSender());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initializeReceiver",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){var t=this;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.receiver=Sr._getInstance(Tr()?self:null),this.receiver._subscribe("keyChanged",function(){var e=Object(d.a)(Object(l.a)().mark((function e(n,r){var i;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._poll();case 2:return i=e.sent,e.abrupt("return",{keyProcessed:i.includes(r.key)});case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.receiver._subscribe("ping",function(){var e=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",["keyChanged"]);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initializeSender",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){var t,n,r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Mr();case 2:if(this.activeServiceWorker=e.sent,this.activeServiceWorker){e.next=5;break}return e.abrupt("return");case 5:return this.sender=new Ar(this.activeServiceWorker),e.next=8,this.sender._send("ping",{},800);case 8:if(r=e.sent){e.next=11;break}return e.abrupt("return");case 11:(null===(t=r[0])||void 0===t?void 0:t.fulfilled)&&(null===(n=r[0])||void 0===n?void 0:n.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"notifyServiceWorker",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sender&&this.activeServiceWorker&&Dr()===this.activeServiceWorker){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50);case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_isAvailable",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){var t;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,indexedDB){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,Ur();case 5:return t=e.sent,e.next=8,zr(t,gr,"1");case 8:return e.next=10,Wr(t,gr);case 10:return e.abrupt("return",!0);case 13:e.prev=13,e.t0=e.catch(0);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"_withPendingWrite",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.pendingWrites++,e.prev=1,e.next=4,t();case 4:return e.prev=4,this.pendingWrites--,e.finish(4);case 7:case"end":return e.stop()}}),e,this,[[1,,4,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_set",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t,n){var r=this;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._withPendingWrite(Object(d.a)(Object(l.a)().mark((function e(){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r._withRetries((function(e){return zr(e,t,n)}));case 2:return r.localCache[t]=n,e.abrupt("return",r.notifyServiceWorker(t));case 4:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_get",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._withRetries((function(e){return Gr(e,t)}));case 2:return n=e.sent,this.localCache[t]=n,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_remove",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n=this;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._withPendingWrite(Object(d.a)(Object(l.a)().mark((function e(){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._withRetries((function(e){return Wr(e,t)}));case 2:return delete n.localCache[t],e.abrupt("return",n.notifyServiceWorker(t));case 4:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_poll",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){var t,n,r,i,a,o,s,u,h,d,f;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._withRetries((function(e){var t=Br(e,!1).getAll();return new Nr(t).toPromise()}));case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",[]);case 5:if(0===this.pendingWrites){e.next=7;break}return e.abrupt("return",[]);case 7:n=[],r=new Set,i=Object(c.a)(t);try{for(i.s();!(a=i.n()).done;)o=a.value,s=o.fbase_key,u=o.value,r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(u)&&(this.notifyListeners(s,u),n.push(s))}catch(l){i.e(l)}finally{i.f()}for(h=0,d=Object.keys(this.localCache);h<d.length;h++)f=d[h],this.localCache[f]&&!r.has(f)&&(this.notifyListeners(f,null),n.push(f));return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"notifyListeners",value:function(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(var r=0,i=Array.from(n);r<i.length;r++){(0,i[r])(t)}}},{key:"startPolling",value:function(){var e=this;this.stopPolling(),this.pollTimer=setInterval(Object(d.a)(Object(l.a)().mark((function t(){return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._poll());case 1:case"end":return t.stop()}}),t)}))),800)}},{key:"stopPolling",value:function(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}},{key:"_addListener",value:function(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}},{key:"_removeListener",value:function(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}]),e}();qr.type="LOCAL";var Yr=qr;function Xr(e,t){return K(e,"POST","/v2/accounts/mfaSignIn:start",X(e,t))}function Kr(e){return Qr.apply(this,arguments)}function Qr(){return(Qr=Object(d.a)(Object(l.a)().mark((function e(t){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K(t,"GET","/v1/recaptchaParams");case 2:if(e.t0=e.sent.recaptchaSiteKey,e.t0){e.next=5;break}e.t0="";case 5:return e.abrupt("return",e.t0);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zr(e){return new Promise((function(t,n){var r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=function(e){var t=C("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)}))}function Jr(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}var $r=1e12,ei=function(){function e(t){Object(f.a)(this,e),this.auth=t,this.counter=$r,this._widgets=new Map}return Object(p.a)(e,[{key:"render",value:function(e,t){var n=this.counter;return this._widgets.set(n,new ti(e,this.auth.name,t||{})),this.counter++,n}},{key:"reset",value:function(e){var t,n=e||$r;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}},{key:"getResponse",value:function(e){var t,n=e||$r;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}},{key:"execute",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n,r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t||$r,null===(n=this._widgets.get(r))||void 0===n||n.execute(),e.abrupt("return","");case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ti=function(){function e(t,n,r){var i=this;Object(f.a)(this,e),this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=function(){i.execute()};var a="string"===typeof t?document.getElementById(t):t;R(a,"argument-error",{appName:n}),this.container=a,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}return Object(p.a)(e,[{key:"getResponse",value:function(){return this.checkIfDeleted(),this.responseToken}},{key:"delete",value:function(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}},{key:"execute",value:function(){var e=this;this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((function(){e.responseToken=function(e){for(var t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);var t=e.params,n=t.callback,r=t["expired-callback"];if(n)try{n(e.responseToken)}catch(i){}e.timerId=window.setTimeout((function(){if(e.timerId=null,e.responseToken=null,r)try{r()}catch(i){}e.isVisible&&e.execute()}),6e4)}),500))}},{key:"checkIfDeleted",value:function(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}]),e}();var ni=Jr("rcb"),ri=new G(3e4,6e4),ii="https://www.google.com/recaptcha/api.js?",ai=function(){function e(){var t;Object(f.a)(this,e),this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(t=jr().grecaptcha)||void 0===t?void 0:t.render)}return Object(p.a)(e,[{key:"load",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return R(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(n),e,"argument-error"),this.shouldResolveImmediately(n)?Promise.resolve(jr().grecaptcha):new Promise((function(r,i){var a=jr().setTimeout((function(){i(C(e,"network-request-failed"))}),ri.get());jr()[ni]=function(){jr().clearTimeout(a),delete jr()[ni];var o=jr().grecaptcha;if(o){var s=o.render;o.render=function(e,n){var r=s(e,n);return t.counter++,r},t.hostLanguage=n,r(o)}else i(C(e,"internal-error"))},Zr("".concat(ii,"?").concat(Object(g.A)({onload:ni,render:"explicit",hl:n}))).catch((function(){clearTimeout(a),i(C(e,"internal-error"))}))}))}},{key:"clearedOneInstance",value:function(){this.counter--}},{key:"shouldResolveImmediately",value:function(e){var t;return!!(null===(t=jr().grecaptcha)||void 0===t?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}]),e}();var oi=function(){function e(){Object(f.a)(this,e)}return Object(p.a)(e,[{key:"load",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new ei(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"clearedOneInstance",value:function(){}}]),e}(),si="recaptcha",ui={theme:"light",type:"image"},ci=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.assign({},ui),r=arguments.length>2?arguments[2]:void 0;Object(f.a)(this,e),this.parameters=n,this.type=si,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=qe(r),this.isInvisible="invisible"===this.parameters.size,R("undefined"!==typeof document,this.auth,"operation-not-supported-in-this-environment");var i="string"===typeof t?document.getElementById(t):t;R(i,this.auth,"argument-error"),this.container=i,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new oi:new ai,this.validateStartingState()}return Object(p.a)(e,[{key:"verify",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){var t,n,r,i=this;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.assertNotDestroyed(),e.next=3,this.render();case 3:if(t=e.sent,n=this.getAssertedRecaptcha(),!(r=n.getResponse(t))){e.next=8;break}return e.abrupt("return",r);case 8:return e.abrupt("return",new Promise((function(e){i.tokenChangeListeners.add((function t(n){n&&(i.tokenChangeListeners.delete(t),e(n))})),i.isInvisible&&n.execute(t)})));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;try{this.assertNotDestroyed()}catch(t){return Promise.reject(t)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((function(t){throw e.renderPromise=null,t}))),this.renderPromise}},{key:"_reset",value:function(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}},{key:"clear",value:function(){var e=this;this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((function(t){e.container.removeChild(t)}))}},{key:"validateStartingState",value:function(){R(!this.parameters.sitekey,this.auth,"argument-error"),R(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),R("undefined"!==typeof document,this.auth,"operation-not-supported-in-this-environment")}},{key:"makeTokenCallback",value:function(e){var t=this;return function(n){if(t.tokenChangeListeners.forEach((function(e){return e(n)})),"function"===typeof e)e(n);else if("string"===typeof e){var r=jr()[e];"function"===typeof r&&r(n)}}}},{key:"assertNotDestroyed",value:function(){R(!this.destroyed,this.auth,"internal-error")}},{key:"makeRenderPromise",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){var t,n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return this.widgetId||(t=this.container,this.isInvisible||(n=document.createElement("div"),t.appendChild(n),t=n),this.widgetId=this.getAssertedRecaptcha().render(t,this.parameters)),e.abrupt("return",this.widgetId);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){var t;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R(z()&&!Tr(),this.auth,"internal-error"),e.next=3,li();case 3:return e.next=5,this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);case 5:return this.recaptcha=e.sent,e.next=8,Kr(this.auth);case 8:R(t=e.sent,this.auth,"internal-error"),this.parameters.sitekey=t;case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAssertedRecaptcha",value:function(){return R(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}]),e}();function li(){var e=null;return new Promise((function(t){"complete"!==document.readyState?(e=function(){return t()},window.addEventListener("load",e)):t()})).catch((function(t){throw e&&window.removeEventListener("load",e),t}))}var hi=function(){function e(t,n){Object(f.a)(this,e),this.verificationId=t,this.onConfirmation=n}return Object(p.a)(e,[{key:"confirm",value:function(e){var t=Mt._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}]),e}();function di(e,t,n){return fi.apply(this,arguments)}function fi(){return(fi=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=qe(t),e.next=3,yi(i,n,Object(g.p)(r));case 3:return a=e.sent,e.abrupt("return",new hi(a,(function(e){return cn(i,e)})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pi(e,t,n){return vi.apply(this,arguments)}function vi(){return(vi=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object(g.p)(t),e.next=3,nn(!1,i,"phone");case 3:return e.next=5,yi(i.auth,n,Object(g.p)(r));case 5:return a=e.sent,e.abrupt("return",new hi(a,(function(e){return hn(i,e)})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mi(e,t,n){return gi.apply(this,arguments)}function gi(){return(gi=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object(g.p)(t),e.next=3,yi(i.auth,n,Object(g.p)(r));case 3:return a=e.sent,e.abrupt("return",new hi(a,(function(e){return fn(i,e)})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function yi(e,t,n){return bi.apply(this,arguments)}function bi(){return(bi=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a,o,s,u,c,h,d,f;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.verify();case 2:if(a=e.sent,e.prev=3,R("string"===typeof a,t,"argument-error"),R(r.type===si,t,"argument-error"),!("session"in(o="string"===typeof n?{phoneNumber:n}:n))){e.next=26;break}if(s=o.session,!("phoneNumber"in o)){e.next=17;break}return R("enroll"===s.type,t,"internal-error"),e.next=13,fr(t,{idToken:s.credential,phoneEnrollmentInfo:{phoneNumber:o.phoneNumber,recaptchaToken:a}});case 13:return u=e.sent,e.abrupt("return",u.phoneSessionInfo.sessionInfo);case 17:return R("signin"===s.type,t,"internal-error"),R(c=(null===(i=o.multiFactorHint)||void 0===i?void 0:i.uid)||o.multiFactorUid,t,"missing-multi-factor-info"),e.next=22,Xr(t,{mfaPendingCredential:s.credential,mfaEnrollmentId:c,phoneSignInInfo:{recaptchaToken:a}});case 22:return h=e.sent,e.abrupt("return",h.phoneResponseInfo.sessionInfo);case 24:e.next=31;break;case 26:return e.next=28,_t(t,{phoneNumber:o.phoneNumber,recaptchaToken:a});case 28:return d=e.sent,f=d.sessionInfo,e.abrupt("return",f);case 31:return e.prev=31,r._reset(),e.finish(31);case 34:case"end":return e.stop()}}),e,null,[[3,,31,34]])})))).apply(this,arguments)}function wi(e,t){return xi.apply(this,arguments)}function xi(){return(xi=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,en(Object(g.p)(t),n);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Oi=function(){function e(t){Object(f.a)(this,e),this.providerId=e.PROVIDER_ID,this.auth=qe(t)}return Object(p.a)(e,[{key:"verifyPhoneNumber",value:function(e,t){return yi(this.auth,e,Object(g.p)(t))}}],[{key:"credential",value:function(e,t){return Mt._fromVerification(e,t)}},{key:"credentialFromResult",value:function(t){var n=t;return e.credentialFromTaggedObject(n)}},{key:"credentialFromError",value:function(t){return e.credentialFromTaggedObject(t.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t)return null;var n=t.phoneNumber,r=t.temporaryProof;return n&&r?Mt._fromTokenResponse(n,r):null}}]),e}();function ki(e,t){return t?F(t):(R(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Oi.PROVIDER_ID="phone",Oi.PHONE_SIGN_IN_METHOD="phone";var _i=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,"custom","custom")).params=e,r}return Object(p.a)(n,[{key:"_getIdTokenResponse",value:function(e){return xt(e,this._buildIdpRequest())}},{key:"_linkToIdToken",value:function(e,t){return xt(e,this._buildIdpRequest(t))}},{key:"_getReauthenticationResolver",value:function(e){return xt(e,this._buildIdpRequest())}},{key:"_buildIdpRequest",value:function(e){var t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}]),n}(Ze);function Si(e){return sn(e.auth,new _i(e),e.bypassAuthState)}function Ei(e){var t=e.auth,n=e.user;return R(n,t,"internal-error"),an(n,new _i(e),e.bypassAuthState)}function Ai(e){return ji.apply(this,arguments)}function ji(){return(ji=Object(d.a)(Object(l.a)().mark((function e(t){var n,r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.auth,R(r=t.user,n,"internal-error"),e.abrupt("return",en(r,new _i(t),t.bypassAuthState));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ti=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Object(f.a)(this,e),this.auth=t,this.resolver=r,this.user=i,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}return Object(p.a)(e,[{key:"execute",value:function(){var e=this;return new Promise(function(){var t=Object(d.a)(Object(l.a)().mark((function t(n,r){return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.pendingPromise={resolve:n,reject:r},t.prev=1,t.next=4,e.resolver._initialize(e.auth);case 4:return e.eventManager=t.sent,t.next=7,e.onExecution();case 7:e.eventManager.registerConsumer(e),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),e.reject(t.t0);case 13:case"end":return t.stop()}}),t,null,[[1,10]])})));return function(e,n){return t.apply(this,arguments)}}())}},{key:"onAuthEvent",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n,r,i,a,o,s,u;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.urlResponse,r=t.sessionId,i=t.postBody,a=t.tenantId,o=t.error,s=t.type,!o){e.next=4;break}return this.reject(o),e.abrupt("return");case 4:return u={auth:this.auth,requestUri:n,sessionId:r,tenantId:a||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState},e.prev=5,e.t0=this,e.next=9,this.getIdpTask(s)(u);case 9:e.t1=e.sent,e.t0.resolve.call(e.t0,e.t1),e.next=16;break;case 13:e.prev=13,e.t2=e.catch(5),this.reject(e.t2);case 16:case"end":return e.stop()}}),e,this,[[5,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onError",value:function(e){this.reject(e)}},{key:"getIdpTask",value:function(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Si;case"linkViaPopup":case"linkViaRedirect":return Ai;case"reauthViaPopup":case"reauthViaRedirect":return Ei;default:M(this.auth,"internal-error")}}},{key:"resolve",value:function(e){N(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}},{key:"reject",value:function(e){N(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}},{key:"unregisterAndCleanUp",value:function(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}]),e}(),Mi=new G(2e3,1e4);function Ci(e,t,n){return Di.apply(this,arguments)}function Di(){return(Di=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=qe(t),I(t,n,It),a=ki(i,r),o=new Ni(i,"signInViaPopup",n,a),e.abrupt("return",o.executeNotNull());case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ii(e,t,n){return Pi.apply(this,arguments)}function Pi(){return(Pi=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I((i=Object(g.p)(t)).auth,n,It),a=ki(i.auth,r),o=new Ni(i.auth,"reauthViaPopup",n,a,i),e.abrupt("return",o.executeNotNull());case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ri(e,t,n){return Li.apply(this,arguments)}function Li(){return(Li=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I((i=Object(g.p)(t)).auth,n,It),a=ki(i.auth,r),o=new Ni(i.auth,"linkViaPopup",n,a,i),e.abrupt("return",o.executeNotNull());case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ni=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e,r,i,a,s){var u;return Object(f.a)(this,n),(u=t.call(this,e,r,a,s)).provider=i,u.authWindow=null,u.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=Object(o.a)(u),u}return Object(p.a)(n,[{key:"executeNotNull",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){var t;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute();case 2:return R(t=e.sent,this.auth,"internal-error"),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onExecution",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){var t,n=this;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N(1===this.filter.length,"Popup operations only handle one event"),t=Er(),e.next=4,this.resolver._openPopup(this.auth,this.provider,this.filter[0],t);case 4:this.authWindow=e.sent,this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch((function(e){n.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(function(e){e||n.reject(C(n.auth,"web-storage-unsupported"))})),this.pollUserCancellation();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"eventId",get:function(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}},{key:"cancel",value:function(){this.reject(C(this.auth,"cancelled-popup-request"))}},{key:"cleanUp",value:function(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}},{key:"pollUserCancellation",value:function(){var e=this;!function t(){var n,r;(null===(r=null===(n=e.authWindow)||void 0===n?void 0:n.window)||void 0===r?void 0:r.closed)?e.pollId=window.setTimeout((function(){e.pollId=null,e.reject(C(e.auth,"popup-closed-by-user"))}),2e3):e.pollId=window.setTimeout(t,Mi.get())}()}}]),n}(Ti);Ni.currentPopupAction=null;var Bi="pendingRedirect",Fi=new Map,Ui=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(f.a)(this,n),(i=t.call(this,e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,a)).eventId=null,i}return Object(p.a)(n,[{key:"execute",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){var t,r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Fi.get(this.auth._key())){e.next=21;break}return e.prev=2,e.next=5,zi(this.resolver,this.auth);case 5:if(!e.sent){e.next=12;break}return e.next=9,Object(i.a)(Object(a.a)(n.prototype),"execute",this).call(this);case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=null;case 13:r=e.t0,t=function(){return Promise.resolve(r)},e.next=20;break;case 17:e.prev=17,e.t1=e.catch(2),t=function(){return Promise.reject(e.t1)};case 20:Fi.set(this.auth._key(),t);case 21:return this.bypassAuthState||Fi.set(this.auth._key(),(function(){return Promise.resolve(null)})),e.abrupt("return",t());case 23:case"end":return e.stop()}}),e,this,[[2,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"onAuthEvent",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("signInViaRedirect"!==t.type){e.next=4;break}return e.abrupt("return",Object(i.a)(Object(a.a)(n.prototype),"onAuthEvent",this).call(this,t));case 4:if("unknown"!==t.type){e.next=7;break}return this.resolve(null),e.abrupt("return");case 7:if(!t.eventId){e.next=17;break}return e.next=10,this.auth._redirectUserForId(t.eventId);case 10:if(!(r=e.sent)){e.next=16;break}return this.user=r,e.abrupt("return",Object(i.a)(Object(a.a)(n.prototype),"onAuthEvent",this).call(this,t));case 16:this.resolve(null);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onExecution",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"cleanUp",value:function(){}}]),n}(Ti);function zi(e,t){return Vi.apply(this,arguments)}function Vi(){return(Vi=Object(d.a)(Object(l.a)().mark((function e(t,n){var r,i,a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Xi(n),i=Yi(t),e.next=4,i._isAvailable();case 4:if(e.sent){e.next=6;break}return e.abrupt("return",!1);case 6:return e.next=8,i._get(r);case 8:return e.t0=e.sent,a="true"===e.t0,e.next=12,i._remove(r);case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gi(e,t){return Hi.apply(this,arguments)}function Hi(){return(Hi=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Yi(t)._set(Xi(n),"true"));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wi(){Fi.clear()}function qi(e,t){Fi.set(e._key(),t)}function Yi(e){return F(e._redirectPersistence)}function Xi(e){return Me(Bi,e.config.apiKey,e.name)}function Ki(e,t,n){return function(e,t,n){return Qi.apply(this,arguments)}(e,t,n)}function Qi(){return(Qi=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=qe(t),I(t,n,It),e.next=4,i._initializationPromise;case 4:return a=ki(i,r),e.next=7,Gi(a,i);case 7:return e.abrupt("return",a._openRedirect(i,n,"signInViaRedirect"));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zi(e,t,n){return function(e,t,n){return Ji.apply(this,arguments)}(e,t,n)}function Ji(){return(Ji=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I((i=Object(g.p)(t)).auth,n,It),e.next=4,i.auth._initializationPromise;case 4:return a=ki(i.auth,r),e.next=7,Gi(a,i.auth);case 7:return e.next=9,aa(i);case 9:return o=e.sent,e.abrupt("return",a._openRedirect(i.auth,n,"reauthViaRedirect",o));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $i(e,t,n){return function(e,t,n){return ea.apply(this,arguments)}(e,t,n)}function ea(){return(ea=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var i,a,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I((i=Object(g.p)(t)).auth,n,It),e.next=4,i.auth._initializationPromise;case 4:return a=ki(i.auth,r),e.next=7,nn(!1,i,n.providerId);case 7:return e.next=9,Gi(a,i.auth);case 9:return e.next=11,aa(i);case 11:return o=e.sent,e.abrupt("return",a._openRedirect(i.auth,n,"linkViaRedirect",o));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ta(e,t){return na.apply(this,arguments)}function na(){return(na=Object(d.a)(Object(l.a)().mark((function e(t,n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qe(t)._initializationPromise;case 2:return e.abrupt("return",ra(t,n,!1));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ra(e,t){return ia.apply(this,arguments)}function ia(){return ia=Object(d.a)(Object(l.a)().mark((function e(t,n){var r,i,a,o,s,u=arguments;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]&&u[2],i=qe(t),a=ki(i,n),o=new Ui(i,a,r),e.next=6,o.execute();case 6:if(!(s=e.sent)||r){e.next=13;break}return delete s.user._redirectEventId,e.next=11,i._persistUserIfCurrent(s.user);case 11:return e.next=13,i._setRedirectUser(null,n);case 13:return e.abrupt("return",s);case 14:case"end":return e.stop()}}),e)}))),ia.apply(this,arguments)}function aa(e){return oa.apply(this,arguments)}function oa(){return(oa=Object(d.a)(Object(l.a)().mark((function e(t){var n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Er("".concat(t.uid,":::")),t._redirectEventId=n,e.next=4,t.auth._setRedirectUser(t);case 4:return e.next=6,t.auth._persistUserIfCurrent(t);case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var sa=function(){function e(t){Object(f.a)(this,e),this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}return Object(p.a)(e,[{key:"registerConsumer",value:function(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}},{key:"unregisterConsumer",value:function(e){this.consumers.delete(e)}},{key:"onEvent",value:function(e){var t=this;if(this.hasEventBeenHandled(e))return!1;var n=!1;return this.consumers.forEach((function(r){t.isEventForConsumer(e,r)&&(n=!0,t.sendToConsumer(e,r),t.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ca(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}},{key:"sendToConsumer",value:function(e,t){var n;if(e.error&&!ca(e)){var r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(C(this.auth,r))}else t.onAuthEvent(e)}},{key:"isEventForConsumer",value:function(e,t){var n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}},{key:"hasEventBeenHandled",value:function(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(ua(e))}},{key:"saveEventToCache",value:function(e){this.cachedEventUids.add(ua(e)),this.lastProcessedEventTime=Date.now()}}]),e}();function ua(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((function(e){return e})).join("-")}function ca(e){var t=e.type,n=e.error;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}function la(e){return ha.apply(this,arguments)}function ha(){return ha=Object(d.a)(Object(l.a)().mark((function e(t){var n,r=arguments;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.abrupt("return",K(t,"GET","/v1/projects",n));case 2:case"end":return e.stop()}}),e)}))),ha.apply(this,arguments)}var da=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,fa=/^https?/;function pa(){return(pa=Object(d.a)(Object(l.a)().mark((function e(t){var n,r,i,a,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.config.emulator){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,la(t);case 4:n=e.sent,r=n.authorizedDomains,i=Object(c.a)(r),e.prev=7,i.s();case 9:if((a=i.n()).done){e.next=20;break}if(o=a.value,e.prev=11,!va(o)){e.next=14;break}return e.abrupt("return");case 14:e.next=18;break;case 16:e.prev=16,e.t0=e.catch(11);case 18:e.next=9;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(7),i.e(e.t1);case 25:return e.prev=25,i.f(),e.finish(25);case 28:M(t,"unauthorized-domain");case 29:case"end":return e.stop()}}),e,null,[[7,22,25,28],[11,16]])})))).apply(this,arguments)}function va(e){var t=U(),n=new URL(t),r=n.protocol,i=n.hostname;if(e.startsWith("chrome-extension://")){var a=new URL(e);return""===a.hostname&&""===i?"chrome-extension:"===r&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===r&&a.hostname===i}if(!fa.test(r))return!1;if(da.test(e))return i===e;var o=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+o+"|"+o+")$","i").test(i)}var ma=new G(3e4,6e4);function ga(){var e=jr().___jsl;if(null===e||void 0===e?void 0:e.H)for(var t=0,n=Object.keys(e.H);t<n.length;t++){var r=n[t];if(e.H[r].r=e.H[r].r||[],e.H[r].L=e.H[r].L||[],e.H[r].r=Object(v.a)(e.H[r].L),e.CP)for(var i=0;i<e.CP.length;i++)e.CP[i]=null}}var ya=null;function ba(e){return ya=ya||function(e){return new Promise((function(t,n){var r,i,a;function o(){ga(),gapi.load("gapi.iframes",{callback:function(){t(gapi.iframes.getContext())},ontimeout:function(){ga(),n(C(e,"network-request-failed"))},timeout:ma.get()})}if(null===(i=null===(r=jr().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(a=jr().gapi)||void 0===a?void 0:a.load)){var s=Jr("iframefcb");return jr()[s]=function(){gapi.load?o():n(C(e,"network-request-failed"))},Zr("https://apis.google.com/js/api.js?onload=".concat(s)).catch((function(e){return n(e)}))}o()}})).catch((function(e){throw ya=null,e}))}(e),ya}var wa=new G(5e3,15e3),xa="__/auth/iframe",Oa="emulator/auth/iframe",ka={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},_a=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Sa(e){var t=e.config;R(t.authDomain,e,"auth-domain-config-required");var n=t.emulator?H(t,Oa):"https://".concat(e.config.authDomain,"/").concat(xa),r={apiKey:t.apiKey,appName:e.name,v:y.SDK_VERSION},i=_a.get(e.config.apiHost);i&&(r.eid=i);var a=e._getFrameworks();return a.length&&(r.fw=a.join(",")),"".concat(n,"?").concat(Object(g.A)(r).slice(1))}function Ea(e){return Aa.apply(this,arguments)}function Aa(){return Aa=Object(d.a)(Object(l.a)().mark((function e(t){var n,r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ba(t);case 2:return n=e.sent,R(r=jr().gapi,t,"internal-error"),e.abrupt("return",n.open({where:document.body,url:Sa(t),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ka,dontclear:!0},(function(e){return new Promise(function(){var n=Object(d.a)(Object(l.a)().mark((function n(r,i){var a,o,s;return Object(l.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=function(){jr().clearTimeout(o),r(e)},n.next=3,e.restyle({setHideOnLeave:!1});case 3:a=C(t,"network-request-failed"),o=jr().setTimeout((function(){i(a)}),wa.get()),e.ping(s).then(s,(function(){i(a)}));case 6:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())})));case 6:case"end":return e.stop()}}),e)}))),Aa.apply(this,arguments)}var ja={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Ta=500,Ma=600,Ca="_blank",Da="http://localhost",Ia=function(){function e(t){Object(f.a)(this,e),this.window=t,this.associatedEvent=null}return Object(p.a)(e,[{key:"close",value:function(){if(this.window)try{this.window.close()}catch(e){}}}]),e}();function Pa(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ta,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ma,a=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),s="",u=Object.assign(Object.assign({},ja),{width:r.toString(),height:i.toString(),top:a,left:o}),c=Object(g.q)().toLowerCase();n&&(s=Re(c)?Ca:n),Ie(c)&&(t=t||Da,u.scrollbars="yes");var l=Object.entries(u).reduce((function(e,t){var n=Object(h.a)(t,2),r=n[0],i=n[1];return"".concat(e).concat(r,"=").concat(i,",")}),"");if(function(){var e;return Ue(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.q)())&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(c)&&"_self"!==s)return function(e,t){var n=document.createElement("a");n.href=e,n.target=t;var r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",s),new Ia(null);var d=window.open(t||"",s,l);R(d,e,"popup-blocked");try{d.focus()}catch(f){}return new Ia(d)}var Ra="__/auth/handler",La="emulator/auth/handler";function Na(e,t,n,r,i,a){R(e.config.authDomain,e,"auth-domain-config-required"),R(e.config.apiKey,e,"invalid-api-key");var o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:y.SDK_VERSION,eventId:i};if(t instanceof It){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",Object(g.t)(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(var s=0,u=Object.entries(a||{});s<u.length;s++){var c=Object(h.a)(u[s],2),l=c[0],d=c[1];o[l]=d}}if(t instanceof Pt){var f=t.getScopes().filter((function(e){return""!==e}));f.length>0&&(o.scopes=f.join(","))}e.tenantId&&(o.tid=e.tenantId);for(var p=o,v=0,m=Object.keys(p);v<m.length;v++){var b=m[v];void 0===p[b]&&delete p[b]}return"".concat(function(e){var t=e.config;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(Ra);return H(t,La)}(e),"?").concat(Object(g.A)(p).slice(1))}var Ba="webStorageSupport",Fa=function(){function e(){Object(f.a)(this,e),this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=kr,this._completeRedirectFn=ra,this._overrideRedirectResult=qi}return Object(p.a)(e,[{key:"_openPopup",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t,n,r,i){var a,o;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N(null===(a=this.eventManagers[t._key()])||void 0===a?void 0:a.manager,"_initialize() not called before _openPopup()"),o=Na(t,n,r,U(),i),e.abrupt("return",Pa(t,o,Er()));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_openRedirect",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t,n,r,i){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._originValidation(t);case 2:return a=Na(t,n,r,U(),i),jr().location.href=a,e.abrupt("return",new Promise((function(){})));case 4:case"end":return e.stop()}var a}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_initialize",value:function(e){var t=this,n=e._key();if(this.eventManagers[n]){var r=this.eventManagers[n],i=r.manager,a=r.promise;return i?Promise.resolve(i):(N(a,"If manager is not set, promise should be"),a)}var o=this.initAndGetManager(e);return this.eventManagers[n]={promise:o},o.catch((function(){delete t.eventManagers[n]})),o}},{key:"initAndGetManager",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n,r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ea(t);case 2:return n=e.sent,r=new sa(t),n.register("authEvent",(function(e){return R(null===e||void 0===e?void 0:e.authEvent,t,"invalid-auth-event"),{status:r.onEvent(e.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:r},this.iframes[t._key()]=n,e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isIframeWebStorageSupported",value:function(e,t){this.iframes[e._key()].send(Ba,{type:Ba},(function(n){var r,i=null===(r=null===n||void 0===n?void 0:n[0])||void 0===r?void 0:r[Ba];void 0!==i&&t(!!i),M(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}},{key:"_originValidation",value:function(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function(e){return pa.apply(this,arguments)}(e)),this.originValidationPromises[t]}},{key:"_shouldInitProactively",get:function(){return Ve()||Pe()||Ue()}}]),e}(),Ua=Fa,za=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,"phone")).credential=e,r}return Object(p.a)(n,[{key:"_finalizeEnroll",value:function(e,t,n){return function(e,t){return K(e,"POST","/v2/accounts/mfaEnrollment:finalize",X(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}},{key:"_finalizeSignIn",value:function(e,t){return function(e,t){return K(e,"POST","/v2/accounts/mfaSignIn:finalize",X(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}],[{key:"_fromCredential",value:function(e){return new n(e)}}]),n}(function(){function e(t){Object(f.a)(this,e),this.factorId=t}return Object(p.a)(e,[{key:"_process",value:function(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return L("unexpected MultiFactorSessionType")}}}]),e}()),Va=function(){function e(){Object(f.a)(this,e)}return Object(p.a)(e,null,[{key:"assertion",value:function(e){return za._fromCredential(e)}}]),e}();Va.FACTOR_ID="phone";var Ga="@firebase/auth",Ha="0.21.3",Wa=function(){function e(t){Object(f.a)(this,e),this.auth=t,this.internalListeners=new Map}return Object(p.a)(e,[{key:"getUid",value:function(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}},{key:"getToken",value:function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.assertAuthConfigured(),e.next=3,this.auth._initializationPromise;case 3:if(this.auth.currentUser){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,this.auth.currentUser.getIdToken(t);case 7:return n=e.sent,e.abrupt("return",{accessToken:n});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addAuthTokenListener",value:function(e){if(this.assertAuthConfigured(),!this.internalListeners.has(e)){var t=this.auth.onIdTokenChanged((function(t){e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}}},{key:"removeAuthTokenListener",value:function(e){this.assertAuthConfigured();var t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}},{key:"assertAuthConfigured",value:function(){R(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}},{key:"updateProactiveRefresh",value:function(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}]),e}();var qa,Ya=Object(g.o)("authIdTokenMaxAge")||300,Xa=null,Ka=function(e){return function(){var t=Object(d.a)(Object(l.a)().mark((function t(n){var r,i,a;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=n,!t.t0){t.next=5;break}return t.next=4,n.getIdTokenResult();case 4:t.t0=t.sent;case 5:if(r=t.t0,!((i=r&&((new Date).getTime()-Date.parse(r.issuedAtTime))/1e3)&&i>Ya)){t.next=9;break}return t.abrupt("return");case 9:if(a=null===r||void 0===r?void 0:r.token,Xa!==a){t.next=12;break}return t.abrupt("return");case 12:return Xa=a,t.next=15,fetch(e,{method:a?"POST":"DELETE",headers:a?{Authorization:"Bearer ".concat(a)}:{}});case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()};function Qa(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(y.getApp)(),t=Object(y._getProvider)(e,"auth");if(t.isInitialized())return t.getImmediate();var n=function(e,t){var n=Object(y._getProvider)(e,"auth");if(n.isInitialized()){var r=n.getImmediate(),i=n.getOptions();if(Object(g.i)(i,null!==t&&void 0!==t?t:{}))return r;M(r,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Ua,persistence:[Yr,xr,kr]}),r=Object(g.o)("authTokenSyncURL");if(r){var i=Ka(r);!function(e,t,n){Object(g.p)(e).beforeAuthStateChanged(t,n)}(n,i,(function(){return i(n.currentUser)})),function(e,t,n,r){Object(g.p)(e).onIdTokenChanged(t,n,r)}(n,(function(e){return i(e)}))}var a=Object(g.m)("auth");return a&&Xe(n,"http://".concat(a)),n}qa="Browser",Object(y._registerComponent)(new x.a("auth",(function(e,t){var n=t.options,r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),a=r.options,o=a.apiKey,s=a.authDomain;return function(e,t){R(o&&!o.includes(":"),"invalid-api-key",{appName:e.name}),R(!(null===s||void 0===s?void 0:s.includes(":")),"argument-error",{appName:e.name});var r={apiKey:o,authDomain:s,clientPlatform:qa,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ge(qa)},i=new We(e,t,r);return function(e,t){var n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(F);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(i,n),i}(r,i)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((function(e,t,n){e.getProvider("auth-internal").initialize()}))),Object(y._registerComponent)(new x.a("auth-internal",(function(e){return function(e){return new Wa(e)}(qe(e.getProvider("auth").getImmediate()))}),"PRIVATE").setInstantiationMode("EXPLICIT")),Object(y.registerVersion)(Ga,Ha,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(qa)),Object(y.registerVersion)(Ga,Ha,"esm2017")},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(39);var i=n(45),a=n(31);function o(e){return function(e){if(Array.isArray(e))return Object(r.a)(e)}(e)||Object(i.a)(e)||Object(a.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(e,t,n){"use strict";(function(e,r){n.d(t,"a",(function(){return k})),n.d(t,"b",(function(){return N})),n.d(t,"c",(function(){return L})),n.d(t,"d",(function(){return v})),n.d(t,"e",(function(){return p})),n.d(t,"f",(function(){return F})),n.d(t,"g",(function(){return _})),n.d(t,"h",(function(){return q})),n.d(t,"i",(function(){return z})),n.d(t,"j",(function(){return m})),n.d(t,"k",(function(){return W})),n.d(t,"l",(function(){return x})),n.d(t,"m",(function(){return b})),n.d(t,"n",(function(){return w})),n.d(t,"o",(function(){return O})),n.d(t,"p",(function(){return K})),n.d(t,"q",(function(){return S})),n.d(t,"r",(function(){return j})),n.d(t,"s",(function(){return T})),n.d(t,"t",(function(){return U})),n.d(t,"u",(function(){return C})),n.d(t,"v",(function(){return I})),n.d(t,"w",(function(){return E})),n.d(t,"x",(function(){return A})),n.d(t,"y",(function(){return M})),n.d(t,"z",(function(){return D})),n.d(t,"A",(function(){return G})),n.d(t,"B",(function(){return H})),n.d(t,"C",(function(){return P}));var i=n(7),a=n(15),o=n(22),s=n(4),u=n(5),c=n(32),l=n(1),h=n(2),d=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},f={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var a=e[i],o=i+1<e.length,s=o?e[i+1]:0,u=i+2<e.length,c=u?e[i+2]:0,l=a>>2,h=(3&a)<<4|s>>4,d=(15&s)<<2|c>>6,f=63&c;u||(f=64,o||(d=64)),r.push(n[l],n[h],n[d],n[f])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(d(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var a=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&a)}else if(i>239&&i<365){var o=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{var s=e[n++],u=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&u)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var a=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0,s=++i<e.length?n[e.charAt(i)]:64,u=++i<e.length?n[e.charAt(i)]:64;if(++i,null==a||null==o||null==s||null==u)throw Error();var c=a<<2|o>>4;if(r.push(c),64!==s){var l=o<<4&240|s>>2;if(r.push(l),64!==u){var h=s<<6&192|u;r.push(h)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},p=function(e){return function(e){var t=d(e);return f.encodeByteArray(t,!0)}(e).replace(/\./g,"")},v=function(e){try{return f.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function m(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=m(e[n],t[n]));return e}var g=function(){return function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof e)return e;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__},y=function(){try{return g()||function(){if("undefined"!==typeof r){var e=Object({NODE_ENV:"production",PUBLIC_URL:"/CCPortfolio",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_API_KEY:"AIzaSyA3lsHu2D92yOvSdqZIXJgJNjoUT0VzY6E",REACT_APP_FIREBASE_APP_ID:"1:419198628817:web:40a35523550576fe4de6f0",REACT_APP_FIREBASE_AUTH_DOMAIN:"dev-1-263119.firebaseapp.com",REACT_APP_FIREBASE_DATABASE_URL:"https://dev-1-263119.firebaseio.com",REACT_APP_FIREBASE_PROJECT_ID:"dev-1-263119",REACT_APP_FIREBASE_SENDER_ID:"419198628817",REACT_APP_FIREBASE_STORAGE_BUCKET:"dev-1-263119.appspot.com"}).__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0}}()||function(){if("undefined"!==typeof document){var e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}var t=e&&v(e[1]);return t&&JSON.parse(t)}}()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e))}},b=function(e){var t,n;return null===(n=null===(t=y())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},w=function(e){var t=b(e);if(t){var n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));var r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]}},x=function(){var e;return null===(e=y())||void 0===e?void 0:e.config},O=function(e){var t;return null===(t=y())||void 0===t?void 0:t["_".concat(e)]},k=function(){function e(){var t=this;Object(l.a)(this,e),this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return Object(h.a)(e,[{key:"wrapCallback",value:function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"===typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}}}]),e}();function _(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var a=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[p(JSON.stringify({alg:"none",type:"JWT"})),p(JSON.stringify(a)),""].join(".")}function S(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function E(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(S())}function A(){var t,n=null===(t=y())||void 0===t?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(r){return!1}}function j(){return"object"===typeof self&&self.self===self}function T(){var e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}function M(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function C(){var e=S();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function D(){return!A()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function I(){try{return"object"===typeof indexedDB}catch(e){return!1}}function P(){return new Promise((function(e,t){try{var n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=function(){i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=function(){n=!1},i.onerror=function(){var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(a){t(a)}}))}var R="FirebaseError",L=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e,r,i){var a;return Object(l.a)(this,n),(a=t.call(this,r)).code=e,a.customData=i,a.name=R,Object.setPrototypeOf(Object(o.a)(a),n.prototype),Error.captureStackTrace&&Error.captureStackTrace(Object(o.a)(a),N.prototype.create),a}return Object(h.a)(n)}(Object(c.a)(Error)),N=function(){function e(t,n,r){Object(l.a)(this,e),this.service=t,this.serviceName=n,this.errors=r}return Object(h.a)(e,[{key:"create",value:function(e){var t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],i=r?function(e,t){return e.replace(B,(function(e,n){var r=t[n];return null!=r?String(r):"<".concat(n,"?>")}))}(r,t):"Error",a="".concat(this.serviceName,": ").concat(i," (").concat(n,").");return new L(n,a,t)}}]),e}();var B=/\{\$([^}]+)}/g;function F(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function U(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function z(e,t){if(e===t)return!0;for(var n=Object.keys(e),r=Object.keys(t),i=0,a=n;i<a.length;i++){var o=a[i];if(!r.includes(o))return!1;var s=e[o],u=t[o];if(V(s)&&V(u)){if(!z(s,u))return!1}else if(s!==u)return!1}for(var c=0,l=r;c<l.length;c++){var h=l[c];if(!n.includes(h))return!1}return!0}function V(e){return null!==e&&"object"===typeof e}function G(e){for(var t=[],n=function(){var e=Object(a.a)(i[r],2),n=e[0],o=e[1];Array.isArray(o)?o.forEach((function(e){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(o))},r=0,i=Object.entries(e);r<i.length;r++)n();return t.length?"&"+t.join("&"):""}function H(e){var t={};return e.replace(/^\?/,"").split("&").forEach((function(e){if(e){var n=e.split("="),r=Object(a.a)(n,2),i=r[0],o=r[1];t[decodeURIComponent(i)]=decodeURIComponent(o)}})),t}function W(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function q(e,t){var n=new Y(e,t);return n.subscribe.bind(n)}var Y=function(){function e(t,n){var r=this;Object(l.a)(this,e),this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then((function(){t(r)})).catch((function(e){r.error(e)}))}return Object(h.a)(e,[{key:"next",value:function(e){this.forEachObserver((function(t){t.next(e)}))}},{key:"error",value:function(e){this.forEachObserver((function(t){t.error(e)})),this.close(e)}},{key:"complete",value:function(){this.forEachObserver((function(e){e.complete()})),this.close()}},{key:"subscribe",value:function(e,t,n){var r,a=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!==typeof e||null===e)return!1;var n,r=Object(i.a)(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a in e&&"function"===typeof e[a])return!0}}catch(o){r.e(o)}finally{r.f()}return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(r.next=X),void 0===r.error&&(r.error=X),void 0===r.complete&&(r.complete=X);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{a.finalError?r.error(a.finalError):r.complete()}catch(e){}})),this.observers.push(r),o}},{key:"unsubscribeOne",value:function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}},{key:"forEachObserver",value:function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)}},{key:"sendOne",value:function(e,t){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(r){"undefined"!==typeof console&&console.error&&console.error(r)}}))}},{key:"close",value:function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((function(){t.observers=void 0,t.onNoObservers=void 0})))}}]),e}();function X(){}function K(e){return e&&e._delegate?e._delegate:e}}).call(this,n(37),n(38))},function(e,t,n){"use strict";e.exports=n(60)},function(e,t,n){"use strict";function r(e){return r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(44);function i(){return i="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=Object(r.a)(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},i.apply(this,arguments)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(42);var i=n(31),a=n(43);function o(e,t){return Object(r.a)(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(l){c=!0,i=l}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||Object(i.a)(e,t)||Object(a.a)()}},function(e,t,n){"use strict";e.exports=n(70)},function(e,t,n){"use strict";n.d(t,"x",(function(){return U})),n.d(t,"F",(function(){return B}));var r=n(33),i=n(0),a=n(1),o=n(2),s=n(14),u=n(13),c=n(4),l=n(5),h=n(3),d=n(9);n.d(t,"a",(function(){return d.b})),n.d(t,"b",(function(){return d.e})),n.d(t,"c",(function(){return d.h})),n.d(t,"d",(function(){return d.i})),n.d(t,"e",(function(){return d.m})),n.d(t,"f",(function(){return d.k})),n.d(t,"g",(function(){return d.f})),n.d(t,"h",(function(){return d.n})),n.d(t,"i",(function(){return d.j})),n.d(t,"j",(function(){return d.sb})),n.d(t,"k",(function(){return d.ub})),n.d(t,"l",(function(){return d.l})),n.d(t,"m",(function(){return d.L})),n.d(t,"n",(function(){return d.o})),n.d(t,"o",(function(){return d.p})),n.d(t,"p",(function(){return d.eb})),n.d(t,"q",(function(){return d.J})),n.d(t,"r",(function(){return d.Z})),n.d(t,"s",(function(){return d.K})),n.d(t,"t",(function(){return d.gb})),n.d(t,"u",(function(){return d.G})),n.d(t,"v",(function(){return d.H})),n.d(t,"w",(function(){return d.F})),n.d(t,"y",(function(){return d.x})),n.d(t,"z",(function(){return d.hb})),n.d(t,"A",(function(){return d.qb})),n.d(t,"B",(function(){return d.u})),n.d(t,"C",(function(){return d.y})),n.d(t,"D",(function(){return d.w})),n.d(t,"E",(function(){return d.d})),n.d(t,"G",(function(){return d.A})),n.d(t,"H",(function(){return d.c})),n.d(t,"I",(function(){return d.M})),n.d(t,"J",(function(){return d.T})),n.d(t,"K",(function(){return d.U})),n.d(t,"L",(function(){return d.pb})),n.d(t,"M",(function(){return d.g})),n.d(t,"N",(function(){return d.ob})),n.d(t,"O",(function(){return d.D})),n.d(t,"P",(function(){return d.s})),n.d(t,"Q",(function(){return d.rb})),n.d(t,"R",(function(){return d.jb})),n.d(t,"S",(function(){return d.mb})),n.d(t,"T",(function(){return d.V})),n.d(t,"U",(function(){return d.t})),n.d(t,"V",(function(){return d.vb})),n.d(t,"W",(function(){return d.kb})),n.d(t,"X",(function(){return d.nb})),n.d(t,"Y",(function(){return d.N})),n.d(t,"Z",(function(){return d.v})),n.d(t,"ab",(function(){return d.C})),n.d(t,"bb",(function(){return d.q})),n.d(t,"cb",(function(){return d.r})),n.d(t,"db",(function(){return d.a})),n.d(t,"eb",(function(){return d.B})),n.d(t,"fb",(function(){return d.E})),n.d(t,"gb",(function(){return d.wb})),n.d(t,"hb",(function(){return d.ib})),n.d(t,"ib",(function(){return d.lb})),n.d(t,"jb",(function(){return d.S})),n.d(t,"kb",(function(){return d.Q})),n.d(t,"lb",(function(){return d.R})),n.d(t,"mb",(function(){return d.xb})),n.d(t,"nb",(function(){return d.P})),n.d(t,"ob",(function(){return d.O})),n.d(t,"pb",(function(){return d.z}));var f=n(11);n(21),n(25),n(24);function p(){return window}var v=2e3;function m(e,t,n){return g.apply(this,arguments)}function g(){return(g=Object(h.a)(Object(i.a)().mark((function e(t,n,r){var a,o,s,u,c;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=p(),s=o.BuildInfo,Object(d.W)(n.sessionId,"AuthEvent did not contain a session ID"),e.next=4,k(n.sessionId);case 4:return u=e.sent,c={},Object(d.X)()?c.ibi=s.packageName:Object(d.Y)()?c.apn=s.packageName:Object(d.Z)(t,"operation-not-supported-in-this-environment"),s.displayName&&(c.appDisplayName=s.displayName),c.sessionId=u,e.abrupt("return",Object(d.ab)(t,r,n.type,void 0,null!==(a=n.eventId)&&void 0!==a?a:void 0,c));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return(y=Object(h.a)(Object(i.a)().mark((function e(t){var n,r,a;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=p(),r=n.BuildInfo,a={},Object(d.X)()?a.iosBundleId=r.packageName:Object(d.Y)()?a.androidPackageName=r.packageName:Object(d.Z)(t,"operation-not-supported-in-this-environment"),e.next=5,Object(d.bb)(t,a);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){var t=p().cordova;return new Promise((function(n){t.plugins.browsertab.isAvailable((function(r){var i=null;r?t.plugins.browsertab.openUrl(e):i=t.InAppBrowser.open(e,Object(d.cb)()?"_blank":"_system","location=yes"),n(i)}))}))}function w(e,t,n){return x.apply(this,arguments)}function x(){return(x=Object(h.a)(Object(i.a)().mark((function e(t,n,r){var a,o,s;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=p(),o=a.cordova,s=function(){},e.prev=2,e.next=5,new Promise((function(e,i){var a=null;function u(){var t;e();var n=null===(t=o.plugins.browsertab)||void 0===t?void 0:t.close;"function"===typeof n&&n(),"function"===typeof(null===r||void 0===r?void 0:r.close)&&r.close()}function c(){a||(a=window.setTimeout((function(){i(Object(d.db)(t,"redirect-cancelled-by-user"))}),v))}function l(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&c()}n.addPassiveListener(u),document.addEventListener("resume",c,!1),Object(d.Y)()&&document.addEventListener("visibilitychange",l,!1),s=function(){n.removePassiveListener(u),document.removeEventListener("resume",c,!1),document.removeEventListener("visibilitychange",l,!1),a&&window.clearTimeout(a)}}));case 5:return e.prev=5,s(),e.finish(5);case 8:case"end":return e.stop()}}),e,null,[[2,,5,8]])})))).apply(this,arguments)}function O(e){var t,n,r,i,a,o,s,u,c,l,h=p();Object(d.eb)("function"===typeof(null===(t=null===h||void 0===h?void 0:h.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),Object(d.eb)("undefined"!==typeof(null===(n=null===h||void 0===h?void 0:h.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),Object(d.eb)("function"===typeof(null===(a=null===(i=null===(r=null===h||void 0===h?void 0:h.cordova)||void 0===r?void 0:r.plugins)||void 0===i?void 0:i.browsertab)||void 0===a?void 0:a.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Object(d.eb)("function"===typeof(null===(u=null===(s=null===(o=null===h||void 0===h?void 0:h.cordova)||void 0===o?void 0:o.plugins)||void 0===s?void 0:s.browsertab)||void 0===u?void 0:u.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Object(d.eb)("function"===typeof(null===(l=null===(c=null===h||void 0===h?void 0:h.cordova)||void 0===c?void 0:c.InAppBrowser)||void 0===l?void 0:l.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}function k(e){return _.apply(this,arguments)}function _(){return(_=Object(h.a)(Object(i.a)().mark((function e(t){var n,r,a;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=S(t),e.next=3,crypto.subtle.digest("SHA-256",n);case 3:return r=e.sent,a=Array.from(new Uint8Array(r)),e.abrupt("return",a.map((function(e){return e.toString(16).padStart(2,"0")})).join(""));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){if(Object(d.W)(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!==typeof TextEncoder)return(new TextEncoder).encode(e);for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}var E=20,A=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){var e;return Object(a.a)(this,n),(e=t.apply(this,arguments)).passiveListeners=new Set,e.initPromise=new Promise((function(t){e.resolveInialized=t})),e}return Object(o.a)(n,[{key:"addPassiveListener",value:function(e){this.passiveListeners.add(e)}},{key:"removePassiveListener",value:function(e){this.passiveListeners.delete(e)}},{key:"resetRedirect",value:function(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}},{key:"onEvent",value:function(e){return this.resolveInialized(),this.passiveListeners.forEach((function(t){return t(e)})),Object(s.a)(Object(u.a)(n.prototype),"onEvent",this).call(this,e)}},{key:"initialized",value:function(){var e=Object(h.a)(Object(i.a)().mark((function e(){return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initPromise;case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(d.fb);function j(e,t){return{type:t,eventId:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,urlResponse:null,sessionId:I(),postBody:null,tenantId:e.tenantId,error:Object(d.db)(e,"no-auth-event")}}function T(e,t){return P()._set(R(e),t)}function M(e){return C.apply(this,arguments)}function C(){return(C=Object(h.a)(Object(i.a)().mark((function e(t){var n;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P()._get(R(t));case 2:if(!(n=e.sent)){e.next=6;break}return e.next=6,P()._remove(R(t));case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t){var n,r,i=function(e){var t=L(e),n=t.link?decodeURIComponent(t.link):void 0,r=L(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return L(i).link||i||r||n||e}(t);if(i.includes("/__/auth/callback")){var a=L(i),o=a.firebaseError?function(e){try{return JSON.parse(e)}catch(t){return null}}(decodeURIComponent(a.firebaseError)):null,s=null===(r=null===(n=null===o||void 0===o?void 0:o.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],u=s?Object(d.db)(s):null;return u?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:u,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}}return null}function I(){for(var e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",n=0;n<E;n++){var r=Math.floor(Math.random()*t.length);e.push(t.charAt(r))}return e.join("")}function P(){return Object(d.gb)(d.hb)}function R(e){return Object(d.F)("authEvent",e.config.apiKey,e.name)}function L(e){if(!(null===e||void 0===e?void 0:e.includes("?")))return{};var t=e.split("?"),n=Object(r.a)(t),i=(n[0],n.slice(1));return Object(f.B)(i.join("?"))}var N=function(){function e(){Object(a.a)(this,e),this._redirectPersistence=d.u,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=d.G,this._overrideRedirectResult=d.H}return Object(o.a)(e,[{key:"_initialize",value:function(){var e=Object(h.a)(Object(i.a)().mark((function e(t){var n,r;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._key(),(r=this.eventManagers.get(n))||(r=new A(t),this.eventManagers.set(n,r),this.attachCallbackListeners(t,r)),e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_openPopup",value:function(e){Object(d.Z)(e,"operation-not-supported-in-this-environment")}},{key:"_openRedirect",value:function(){var e=Object(h.a)(Object(i.a)().mark((function e(t,n,r,a){var o,s,u,c;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O(t),e.next=3,this._initialize(t);case 3:return o=e.sent,e.next=6,o.initialized();case 6:return o.resetRedirect(),Object(d.I)(),e.next=10,this._originValidation(t);case 10:return s=j(t,r,a),e.next=13,T(t,s);case 13:return e.next=15,m(t,s,n);case 15:return u=e.sent,e.next=18,b(u);case 18:return c=e.sent,e.abrupt("return",w(t,o,c));case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_isIframeWebStorageSupported",value:function(e,t){throw new Error("Method not implemented.")}},{key:"_originValidation",value:function(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function(e){return y.apply(this,arguments)}(e)),this.originValidationPromises[t]}},{key:"attachCallbackListeners",value:function(e,t){var n=p(),r=n.universalLinks,a=n.handleOpenURL,o=n.BuildInfo,s=setTimeout(Object(h.a)(Object(i.a)().mark((function n(){return Object(i.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,M(e);case 2:t.onEvent(F());case 3:case"end":return n.stop()}}),n)}))),500),u=function(){var n=Object(h.a)(Object(i.a)().mark((function n(r){var a,o;return Object(i.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return clearTimeout(s),n.next=3,M(e);case 3:a=n.sent,o=null,a&&(null===r||void 0===r?void 0:r.url)&&(o=D(a,r.url)),t.onEvent(o||F());case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();"undefined"!==typeof r&&"function"===typeof r.subscribe&&r.subscribe(null,u);var c=a,l="".concat(o.packageName.toLowerCase(),"://");p().handleOpenURL=function(){var e=Object(h.a)(Object(i.a)().mark((function e(t){return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.toLowerCase().startsWith(l)&&u({url:t}),"function"===typeof c)try{c(t)}catch(n){console.error(n)}case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}]),e}(),B=N;function F(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Object(d.db)("no-auth-event")}}function U(e,t){Object(d.J)(e)._logFramework(t)}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return Bh})),n.d(t,"b",(function(){return Ll})),n.d(t,"c",(function(){return Ol})),n.d(t,"d",(function(){return Vc})),n.d(t,"e",(function(){return Vh})),n.d(t,"f",(function(){return Nl})),n.d(t,"g",(function(){return R})),n.d(t,"h",(function(){return Fl})),n.d(t,"i",(function(){return Gh})),n.d(t,"j",(function(){return Hh})),n.d(t,"k",(function(){return Q})),n.d(t,"l",(function(){return cd})),n.d(t,"m",(function(){return Me})),n.d(t,"n",(function(){return ne})),n.d(t,"o",(function(){return te})),n.d(t,"p",(function(){return Lc})),n.d(t,"q",(function(){return D})),n.d(t,"r",(function(){return Ne})),n.d(t,"s",(function(){return j})),n.d(t,"t",(function(){return Dc})),n.d(t,"u",(function(){return rd})),n.d(t,"v",(function(){return md})),n.d(t,"w",(function(){return vd})),n.d(t,"x",(function(){return Tl})),n.d(t,"y",(function(){return Wc})),n.d(t,"z",(function(){return qc})),n.d(t,"A",(function(){return zc})),n.d(t,"B",(function(){return nd})),n.d(t,"C",(function(){return fd})),n.d(t,"D",(function(){return Dl})),n.d(t,"E",(function(){return Yc})),n.d(t,"F",(function(){return El})),n.d(t,"G",(function(){return Al})),n.d(t,"H",(function(){return Cl})),n.d(t,"I",(function(){return Dh})),n.d(t,"J",(function(){return Ch})),n.d(t,"K",(function(){return _l})),n.d(t,"L",(function(){return od})),n.d(t,"M",(function(){return Yh})),n.d(t,"N",(function(){return Kh})),n.d(t,"O",(function(){return Qh})),n.d(t,"P",(function(){return Zh})),n.d(t,"Q",(function(){return Jh})),n.d(t,"R",(function(){return $h})),n.d(t,"S",(function(){return gd})),n.d(t,"T",(function(){return Sh})),n.d(t,"U",(function(){return Eh})),n.d(t,"V",(function(){return Il})),n.d(t,"W",(function(){return Pl})),n.d(t,"X",(function(){return id})),n.d(t,"Y",(function(){return ad})),n.d(t,"Z",(function(){return kh})),n.d(t,"ab",(function(){return yh})),n.d(t,"bb",(function(){return Kc})),n.d(t,"cb",(function(){return Xc})),n.d(t,"db",(function(){return dd})),n.d(t,"eb",(function(){return pd})),n.d(t,"fb",(function(){return ed})),n.d(t,"gb",(function(){return S})),n.d(t,"hb",(function(){return qh})),n.d(t,"ib",(function(){return Th})),n.d(t,"jb",(function(){return jh})),n.d(t,"kb",(function(){return td})),n.d(t,"lb",(function(){return Ml})),n.d(t,"mb",(function(){return wh}));var r=n(23),i=n(14),a=n(13),o=n(15),s=n(7),u=n(0),c=n(3),l=n(4),h=n(5),d=n(10),f=n(1),p=n(2),v=n(21),m=n(24),g=n(25),y=n(11),b=n(26),w="@firebase/firestore",x=function(){function e(t){Object(f.a)(this,e),this.uid=t}return Object(p.a)(e,[{key:"isAuthenticated",value:function(){return null!=this.uid}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(e){return e.uid===this.uid}}]),e}();x.UNAUTHENTICATED=new x(null),x.GOOGLE_CREDENTIALS=new x("google-credentials-uid"),x.FIRST_PARTY=new x("first-party-uid"),x.MOCK_USER=new x("mock-user");var O="9.17.1",k=new g.b("@firebase/firestore");function _(){return k.logLevel}function S(e){k.setLogLevel(e)}function E(e){if(k.logLevel<=g.a.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(T);k.debug.apply(k,["Firestore (".concat(O,"): ").concat(e)].concat(Object(d.a)(i)))}}function A(e){if(k.logLevel<=g.a.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(T);k.error.apply(k,["Firestore (".concat(O,"): ").concat(e)].concat(Object(d.a)(i)))}}function j(e){if(k.logLevel<=g.a.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(T);k.warn.apply(k,["Firestore (".concat(O,"): ").concat(e)].concat(Object(d.a)(i)))}}function T(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function M(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state",t="FIRESTORE (".concat(O,") INTERNAL ASSERTION FAILED: ")+e;throw A(t),new Error(t)}function C(e,t){e||M()}function D(e,t){e||M()}function I(e,t){return e}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},R=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this,e,r)).code=e,i.message=r,i.toString=function(){return"".concat(i.name,": [code=").concat(i.code,"]: ").concat(i.message)},i}return Object(p.a)(n)}(y.c),L=Object(p.a)((function e(){var t=this;Object(f.a)(this,e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))})),N=Object(p.a)((function e(t,n){Object(f.a)(this,e),this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))})),B=function(){function e(){Object(f.a)(this,e)}return Object(p.a)(e,[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(x.UNAUTHENTICATED)}))}},{key:"shutdown",value:function(){}}]),e}(),F=function(){function e(t){Object(f.a)(this,e),this.token=t,this.changeListener=null}return Object(p.a)(e,[{key:"getToken",value:function(){return Promise.resolve(this.token)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){var n=this;this.changeListener=t,e.enqueueRetryable((function(){return t(n.token.user)}))}},{key:"shutdown",value:function(){this.changeListener=null}}]),e}(),U=function(){function e(t){Object(f.a)(this,e),this.t=t,this.currentUser=x.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return Object(p.a)(e,[{key:"start",value:function(e,t){var n=this,r=this.i,i=function(e){return n.i!==r?(r=n.i,t(e)):Promise.resolve()},a=new L;this.o=function(){n.i++,n.currentUser=n.u(),a.resolve(),a=new L,e.enqueueRetryable((function(){return i(n.currentUser)}))};var o=function(){var t=a;e.enqueueRetryable(Object(c.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.promise;case 2:return e.next=4,i(n.currentUser);case 4:case"end":return e.stop()}}),e)}))))},s=function(e){E("FirebaseAuthCredentialsProvider","Auth detected"),n.auth=e,n.auth.addAuthTokenListener(n.o),o()};this.t.onInit((function(e){return s(e)})),setTimeout((function(){if(!n.auth){var e=n.t.getImmediate({optional:!0});e?s(e):(E("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new L)}}),0),o()}},{key:"getToken",value:function(){var e=this,t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return e.i!==t?(E("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),e.getToken()):n?(C("string"==typeof n.accessToken),new N(n.accessToken,e.currentUser)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:"u",value:function(){var e=this.auth&&this.auth.getUid();return C(null===e||"string"==typeof e),new x(e)}}]),e}(),z=function(){function e(t,n,r,i){Object(f.a)(this,e),this.h=t,this.l=n,this.m=r,this.g=i,this.type="FirstParty",this.user=x.FIRST_PARTY,this.p=new Map}return Object(p.a)(e,[{key:"I",value:function(){return this.g?this.g():(C(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}},{key:"headers",get:function(){this.p.set("X-Goog-AuthUser",this.l);var e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}]),e}(),V=function(){function e(t,n,r,i){Object(f.a)(this,e),this.h=t,this.l=n,this.m=r,this.g=i}return Object(p.a)(e,[{key:"getToken",value:function(){return Promise.resolve(new z(this.h,this.l,this.m,this.g))}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(x.FIRST_PARTY)}))}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}]),e}(),G=Object(p.a)((function e(t){Object(f.a)(this,e),this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)})),H=function(){function e(t){Object(f.a)(this,e),this.T=t,this.forceRefresh=!1,this.appCheck=null,this.A=null}return Object(p.a)(e,[{key:"start",value:function(e,t){var n=this,r=function(e){null!=e.error&&E("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));var r=e.token!==n.A;return n.A=e.token,E("FirebaseAppCheckTokenProvider","Received ".concat(r?"new":"existing"," token.")),r?t(e.token):Promise.resolve()};this.o=function(t){e.enqueueRetryable((function(){return r(t)}))};var i=function(e){E("FirebaseAppCheckTokenProvider","AppCheck detected"),n.appCheck=e,n.appCheck.addTokenListener(n.o)};this.T.onInit((function(e){return i(e)})),setTimeout((function(){if(!n.appCheck){var e=n.T.getImmediate({optional:!0});e?i(e):E("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}},{key:"getToken",value:function(){var e=this,t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((function(t){return t?(C("string"==typeof t.token),e.A=t.token,new G(t.token)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}]),e}();function W(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}var q=function(){function e(){Object(f.a)(this,e)}return Object(p.a)(e,null,[{key:"R",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";n.length<20;)for(var r=W(40),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return n}}]),e}();function Y(e,t){return e<t?-1:e>t?1:0}function X(e,t,n){return e.length===t.length&&e.every((function(e,r){return n(e,t[r])}))}function K(e){return e+"\0"}var Q=function(){function e(t,n){if(Object(f.a)(this,e),this.seconds=t,this.nanoseconds=n,n<0)throw new R(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new R(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new R(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new R(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return Object(p.a)(e,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(e){return this.seconds===e.seconds?Y(this.nanoseconds,e.nanoseconds):Y(this.seconds,e.seconds)}},{key:"isEqual",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return e.fromMillis(Date.now())}},{key:"fromDate",value:function(t){return e.fromMillis(t.getTime())}},{key:"fromMillis",value:function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))}}]),e}(),Z=function(){function e(t){Object(f.a)(this,e),this.timestamp=t}return Object(p.a)(e,[{key:"compareTo",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(t){return new e(t)}},{key:"min",value:function(){return new e(new Q(0,0))}},{key:"max",value:function(){return new e(new Q(253402300799,999999999))}}]),e}(),J=function(){function e(t,n,r){Object(f.a)(this,e),void 0===n?n=0:n>t.length&&M(),void 0===r?r=t.length-n:r>t.length-n&&M(),this.segments=t,this.offset=n,this.len=r}return Object(p.a)(e,[{key:"length",get:function(){return this.len}},{key:"isEqual",value:function(t){return 0===e.comparator(this,t)}},{key:"child",value:function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach((function(e){n.push(e)})):n.push(t),this.construct(n)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function(){return 0===this.length}},{key:"isPrefixOf",value:function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"isImmediateParentOf",value:function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"forEach",value:function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),a=t.get(r);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]),e}(),$=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}}],[{key:"fromString",value:function(){for(var e=[],t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0,o=r;a<o.length;a++){var s=o[a];if(s.indexOf("//")>=0)throw new R(P.INVALID_ARGUMENT,"Invalid segment (".concat(s,"). Paths must not contain // in them."));e.push.apply(e,Object(d.a)(s.split("/").filter((function(e){return e.length>0}))))}return new n(e)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(J),ee=/^[_a-zA-Z][_a-zA-Z0-9]*$/,te=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().map((function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e})).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function(e){return ee.test(e)}},{key:"keyField",value:function(){return new n(["__name__"])}},{key:"fromServerFormat",value:function(e){for(var t=[],r="",i=0,a=function(){if(0===r.length)throw new R(P.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(r),r=""},o=!1;i<e.length;){var s=e[i];if("\\"===s){if(i+1===e.length)throw new R(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var u=e[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new R(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else"`"===s?(o=!o,i++):"."!==s||o?(r+=s,i++):(a(),i++)}if(a(),o)throw new R(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(J),ne=function(){function e(t){Object(f.a)(this,e),this.path=t}return Object(p.a)(e,[{key:"collectionGroup",get:function(){return this.path.popLast().lastSegment()}},{key:"hasCollectionId",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"getCollectionGroup",value:function(){return this.path.get(this.path.length-2)}},{key:"getCollectionPath",value:function(){return this.path.popLast()}},{key:"isEqual",value:function(e){return null!==e&&0===$.comparator(this.path,e.path)}},{key:"toString",value:function(){return this.path.toString()}}],[{key:"fromPath",value:function(t){return new e($.fromString(t))}},{key:"fromName",value:function(t){return new e($.fromString(t).popFirst(5))}},{key:"empty",value:function(){return new e($.emptyPath())}},{key:"comparator",value:function(e,t){return $.comparator(e.path,t.path)}},{key:"isDocumentKey",value:function(e){return e.length%2==0}},{key:"fromSegments",value:function(t){return new e(new $(t.slice()))}}]),e}(),re=Object(p.a)((function e(t,n,r,i){Object(f.a)(this,e),this.indexId=t,this.collectionGroup=n,this.fields=r,this.indexState=i}));function ie(e){return e.fields.find((function(e){return 2===e.kind}))}function ae(e){return e.fields.filter((function(e){return 2!==e.kind}))}re.UNKNOWN_ID=-1;var oe=Object(p.a)((function e(t,n){Object(f.a)(this,e),this.fieldPath=t,this.kind=n}));var se=function(){function e(t,n){Object(f.a)(this,e),this.sequenceNumber=t,this.offset=n}return Object(p.a)(e,null,[{key:"empty",value:function(){return new e(0,le.min())}}]),e}();function ue(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=Z.fromTimestamp(1e9===r?new Q(n+1,0):new Q(n,r));return new le(i,ne.empty(),t)}function ce(e){return new le(e.readTime,e.key,-1)}var le=function(){function e(t,n,r){Object(f.a)(this,e),this.readTime=t,this.documentKey=n,this.largestBatchId=r}return Object(p.a)(e,null,[{key:"min",value:function(){return new e(Z.min(),ne.empty(),-1)}},{key:"max",value:function(){return new e(Z.max(),ne.empty(),-1)}}]),e}();function he(e,t){var n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=ne.comparator(e.documentKey,t.documentKey))?n:Y(e.largestBatchId,t.largestBatchId)}var de="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",fe=function(){function e(){Object(f.a)(this,e),this.onCommittedListeners=[]}return Object(p.a)(e,[{key:"addOnCommittedListener",value:function(e){this.onCommittedListeners.push(e)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach((function(e){return e()}))}}]),e}();function pe(e){return ve.apply(this,arguments)}function ve(){return(ve=Object(c.a)(Object(u.a)().mark((function e(t){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.code===P.FAILED_PRECONDITION&&t.message===de){e.next=2;break}throw t;case 2:E("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var me=function(){function e(t){var n=this;Object(f.a)(this,e),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(e){n.isDone=!0,n.result=e,n.nextCallback&&n.nextCallback(e)}),(function(e){n.isDone=!0,n.error=e,n.catchCallback&&n.catchCallback(e)}))}return Object(p.a)(e,[{key:"catch",value:function(e){return this.next(void 0,e)}},{key:"next",value:function(t,n){var r=this;return this.callbackAttached&&M(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e((function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}}))}},{key:"toPromise",value:function(){var e=this;return new Promise((function(t,n){e.next(t,n)}))}},{key:"wrapUserFunction",value:function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}},{key:"wrapSuccess",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.resolve(n)}},{key:"wrapFailure",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.reject(n)}}],[{key:"resolve",value:function(t){return new e((function(e,n){e(t)}))}},{key:"reject",value:function(t){return new e((function(e,n){n(t)}))}},{key:"waitFor",value:function(t){return new e((function(e,n){var r=0,i=0,a=!1;t.forEach((function(t){++r,t.next((function(){++i,a&&i===r&&e()}),(function(e){return n(e)}))})),a=!0,i===r&&e()}))}},{key:"or",value:function(t){var n,r=e.resolve(!1),i=Object(s.a)(t);try{var a=function(){var t=n.value;r=r.next((function(n){return n?e.resolve(n):t()}))};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return r}},{key:"forEach",value:function(e,t){var n=this,r=[];return e.forEach((function(e,i){r.push(t.call(n,e,i))})),this.waitFor(r)}},{key:"mapArray",value:function(t,n){return new e((function(e,r){for(var i=t.length,a=new Array(i),o=0,s=function(){var s=u;n(t[s]).next((function(t){a[s]=t,++o===i&&e(a)}),(function(e){return r(e)}))},u=0;u<i;u++)s()}))}},{key:"doWhile",value:function(t,n){return new e((function(e,r){!function i(){!0===t()?n().next((function(){i()}),r):e()}()}))}}]),e}(),ge=function(){function e(t,n){var r=this;Object(f.a)(this,e),this.action=t,this.transaction=n,this.aborted=!1,this.P=new L,this.transaction.oncomplete=function(){r.P.resolve()},this.transaction.onabort=function(){n.error?r.P.reject(new we(t,n.error)):r.P.resolve()},this.transaction.onerror=function(e){var n=Se(e.target.error);r.P.reject(new we(t,n))}}return Object(p.a)(e,[{key:"v",get:function(){return this.P.promise}},{key:"abort",value:function(e){e&&this.P.reject(e),this.aborted||(E("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}},{key:"V",value:function(){var e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}},{key:"store",value:function(e){var t=this.transaction.objectStore(e);return new Oe(t)}}],[{key:"open",value:function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(t){throw new we(n,t)}}}]),e}(),ye=function(){function t(e,n,r){Object(f.a)(this,t),this.name=e,this.version=n,this.S=r,12.2===t.D(Object(y.q)())&&A("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return Object(p.a)(t,[{key:"F",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var n=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.db,e.t0){e.next=6;break}return E("SimpleDb","Opening database:",this.name),e.next=5,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new we(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new R(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new R(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new we(t,n))},i.onupgradeneeded=function(e){E("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;n.S.$(t,i.transaction,e.oldVersion,n.version).next((function(){E("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}));case 5:this.db=e.sent;case 6:return this.B&&(this.db.onversionchange=function(e){return n.B(e)}),e.abrupt("return",this.db);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"L",value:function(e){this.B=e,this.db&&(this.db.onversionchange=function(t){return e(t)})}},{key:"runTransaction",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,n,r,i){var a,o,s,c,l=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a="readonly"===n,o=0,s=Object(u.a)().mark((function e(){var n,s,c,h;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return++o,e.prev=1,e.next=4,l.F(t);case 4:return l.db=e.sent,n=ge.open(l.db,t,a?"readonly":"readwrite",r),s=i(n).next((function(e){return n.V(),e})).catch((function(e){return n.abort(e),me.reject(e)})).toPromise(),s.catch((function(){})),e.next=9,n.v;case 9:return e.t0=s,e.abrupt("return",{v:e.t0});case 13:if(e.prev=13,e.t1=e.catch(1),c=e.t1,h="FirebaseError"!==c.name&&o<3,E("SimpleDb","Transaction failed with error:",c.message,"Retrying:",h),l.close(),h){e.next=18;break}return e.abrupt("return",{v:Promise.reject(c)});case 18:case"end":return e.stop()}}),e,null,[[1,13]])}));case 3:return e.delegateYield(s(),"t0",4);case 4:if("object"!==typeof(c=e.t0)){e.next=7;break}return e.abrupt("return",c.v);case 7:e.next=3;break;case 9:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"close",value:function(){this.db&&this.db.close(),this.db=void 0}}],[{key:"delete",value:function(e){return E("SimpleDb","Removing database:",e),ke(window.indexedDB.deleteDatabase(e)).toPromise()}},{key:"C",value:function(){if(!Object(y.v)())return!1;if(t.N())return!0;var e=Object(y.q)(),n=t.D(e),r=0<n&&n<10,i=t.k(e),a=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||a)}},{key:"N",value:function(){var t;return"undefined"!=typeof e&&"YES"===(null===(t=Object({NODE_ENV:"production",PUBLIC_URL:"/CCPortfolio",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_API_KEY:"AIzaSyA3lsHu2D92yOvSdqZIXJgJNjoUT0VzY6E",REACT_APP_FIREBASE_APP_ID:"1:419198628817:web:40a35523550576fe4de6f0",REACT_APP_FIREBASE_AUTH_DOMAIN:"dev-1-263119.firebaseapp.com",REACT_APP_FIREBASE_DATABASE_URL:"https://dev-1-263119.firebaseio.com",REACT_APP_FIREBASE_PROJECT_ID:"dev-1-263119",REACT_APP_FIREBASE_SENDER_ID:"419198628817",REACT_APP_FIREBASE_STORAGE_BUCKET:"dev-1-263119.appspot.com"}))||void 0===t?void 0:t.O)}},{key:"M",value:function(e,t){return e.store(t)}},{key:"D",value:function(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}},{key:"k",value:function(e){var t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}}]),t}(),be=function(){function e(t){Object(f.a)(this,e),this.q=t,this.U=!1,this.K=null}return Object(p.a)(e,[{key:"isDone",get:function(){return this.U}},{key:"G",get:function(){return this.K}},{key:"cursor",set:function(e){this.q=e}},{key:"done",value:function(){this.U=!0}},{key:"j",value:function(e){this.K=e}},{key:"delete",value:function(){return ke(this.q.delete())}}]),e}(),we=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this,P.UNAVAILABLE,"IndexedDB transaction '".concat(e,"' failed: ").concat(r))).name="IndexedDbTransactionError",i}return Object(p.a)(n)}(R);function xe(e){return"IndexedDbTransactionError"===e.name}var Oe=function(){function e(t){Object(f.a)(this,e),this.store=t}return Object(p.a)(e,[{key:"put",value:function(e,t){var n;return void 0!==t?(E("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(E("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),ke(n)}},{key:"add",value:function(e){return E("SimpleDb","ADD",this.store.name,e,e),ke(this.store.add(e))}},{key:"get",value:function(e){var t=this;return ke(this.store.get(e)).next((function(n){return void 0===n&&(n=null),E("SimpleDb","GET",t.store.name,e,n),n}))}},{key:"delete",value:function(e){return E("SimpleDb","DELETE",this.store.name,e),ke(this.store.delete(e))}},{key:"count",value:function(){return E("SimpleDb","COUNT",this.store.name),ke(this.store.count())}},{key:"W",value:function(e,t){var n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){var r=this.cursor(n),i=[];return this.H(r,(function(e,t){i.push(t)})).next((function(){return i}))}var a=this.store.getAll(n.range);return new me((function(e,t){a.onerror=function(e){t(e.target.error)},a.onsuccess=function(t){e(t.target.result)}}))}},{key:"J",value:function(e,t){var n=this.store.getAll(e,null===t?void 0:t);return new me((function(e,t){n.onerror=function(e){t(e.target.error)},n.onsuccess=function(t){e(t.target.result)}}))}},{key:"Y",value:function(e,t){E("SimpleDb","DELETE ALL",this.store.name);var n=this.options(e,t);n.X=!1;var r=this.cursor(n);return this.H(r,(function(e,t,n){return n.delete()}))}},{key:"Z",value:function(e,t){var n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.H(r,t)}},{key:"tt",value:function(e){var t=this.cursor({});return new me((function(n,r){t.onerror=function(e){var t=Se(e.target.error);r(t)},t.onsuccess=function(t){var r=t.target.result;r?e(r.primaryKey,r.value).next((function(e){e?r.continue():n()})):n()}}))}},{key:"H",value:function(e,t){var n=[];return new me((function(r,i){e.onerror=function(e){i(e.target.error)},e.onsuccess=function(e){var i=e.target.result;if(i){var a=new be(i),o=t(i.primaryKey,i.value,a);if(o instanceof me){var s=o.catch((function(e){return a.done(),me.reject(e)}));n.push(s)}a.isDone?r():null===a.G?i.continue():i.continue(a.G)}else r()}})).next((function(){return me.waitFor(n)}))}},{key:"options",value:function(e,t){var n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}},{key:"cursor",value:function(e){var t="next";if(e.reverse&&(t="prev"),e.index){var n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}]),e}();function ke(e){return new me((function(t,n){e.onsuccess=function(e){var n=e.target.result;t(n)},e.onerror=function(e){var t=Se(e.target.error);n(t)}}))}var _e=!1;function Se(e){var t=ye.D(Object(y.q)());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new R("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '".concat(n,"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround."));return _e||(_e=!0,setTimeout((function(){throw r}),0)),r}}return e}var Ee=function(){function e(t,n){Object(f.a)(this,e),this.asyncQueue=t,this.et=n,this.task=null}return Object(p.a)(e,[{key:"start",value:function(){this.nt(15e3)}},{key:"stop",value:function(){this.task&&(this.task.cancel(),this.task=null)}},{key:"started",get:function(){return null!==this.task}},{key:"nt",value:function(e){var t=this;E("IndexBackiller","Scheduled in ".concat(e,"ms")),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,Object(c.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.task=null,e.prev=1,e.t0=E,e.t1="Documents written: ",e.next=6,t.et.st();case 6:e.t2=e.sent,e.t3=e.t1.concat.call(e.t1,e.t2),(0,e.t0)("IndexBackiller",e.t3),e.next=19;break;case 11:if(e.prev=11,e.t4=e.catch(1),!xe(e.t4)){e.next=17;break}E("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e.t4),e.next=19;break;case 17:return e.next=19,pe(e.t4);case 19:return e.next=21,t.nt(6e4);case 21:case"end":return e.stop()}}),e,null,[[1,11]])}))))}}]),e}(),Ae=function(){function e(t,n){Object(f.a)(this,e),this.localStore=t,this.persistence=n}return Object(p.a)(e,[{key:"st",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t,n=this,r=arguments;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:50,e.abrupt("return",this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(function(e){return n.it(e,t)})));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"it",value:function(e,t){var n=this,r=new Set,i=t,a=!0;return me.doWhile((function(){return!0===a&&i>0}),(function(){return n.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((function(t){if(null!==t&&!r.has(t))return E("IndexBackiller","Processing collection: ".concat(t)),n.rt(e,t,i).next((function(e){i-=e,r.add(t)}));a=!1}))})).next((function(){return t-i}))}},{key:"rt",value:function(e,t,n){var r=this;return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((function(i){return r.localStore.localDocuments.getNextDocuments(e,t,i,n).next((function(n){var a=n.changes;return r.localStore.indexManager.updateIndexEntries(e,a).next((function(){return r.ot(i,n)})).next((function(n){return E("IndexBackiller","Updating offset: ".concat(n)),r.localStore.indexManager.updateCollectionGroup(e,t,n)})).next((function(){return a.size}))}))}))}},{key:"ot",value:function(e,t){var n=e;return t.changes.forEach((function(e,t){var r=ce(t);he(r,n)>0&&(n=r)})),new le(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}]),e}(),je=function(){function e(t,n){var r=this;Object(f.a)(this,e),this.previousValue=t,n&&(n.sequenceNumberHandler=function(e){return r.ut(e)},this.ct=function(e){return n.writeSequenceNumber(e)})}return Object(p.a)(e,[{key:"ut",value:function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:"next",value:function(){var e=++this.previousValue;return this.ct&&this.ct(e),e}}]),e}();je.at=-1;var Te=Object(p.a)((function e(t,n,r,i,a,o,s,u){Object(f.a)(this,e),this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=u})),Me=function(){function e(t,n){Object(f.a)(this,e),this.projectId=t,this.database=n||"(default)"}return Object(p.a)(e,[{key:"isDefaultDatabase",get:function(){return"(default)"===this.database}},{key:"isEqual",value:function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}}],[{key:"empty",value:function(){return new e("","")}}]),e}();function Ce(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function De(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Ie(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Pe(e){return null==e}function Re(e){return 0===e&&1/e==-1/0}function Le(e){return"number"==typeof e&&Number.isInteger(e)&&!Re(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function Ne(){return"undefined"!=typeof atob}var Be=function(e){function t(e){Object(f.a)(this,t),this.binaryString=e}return Object(p.a)(t,[{key:e,value:function(){var e=this,t=0;return{next:function(){return t<e.binaryString.length?{value:e.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}}},{key:"toBase64",value:function(){return e=this.binaryString,btoa(e);var e}},{key:"toUint8Array",value:function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(e){return Y(this.binaryString,e.binaryString)}},{key:"isEqual",value:function(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function(e){return new t(atob(e))}},{key:"fromUint8Array",value:function(e){var n=function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new t(n)}}]),t}(Symbol.iterator);Be.EMPTY_BYTE_STRING=new Be("");var Fe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ue(e){if(C(!!e),"string"==typeof e){var t=0,n=Fe.exec(e);if(C(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:ze(e.seconds),nanos:ze(e.nanos)}}function ze(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ve(e){return"string"==typeof e?Be.fromBase64String(e):Be.fromUint8Array(e)}function Ge(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function He(e){var t=e.mapValue.fields.__previous_value__;return Ge(t)?He(t):t}function We(e){var t=Ue(e.mapValue.fields.__local_write_time__.timestampValue);return new Q(t.seconds,t.nanos)}var qe={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ye={nullValue:"NULL_VALUE"};function Xe(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Ge(e)?4:ut(e)?9007199254740991:10:M()}function Ke(e,t){if(e===t)return!0;var n=Xe(e);if(n!==Xe(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return We(e).isEqual(We(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=Ue(e.timestampValue),r=Ue(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Ve(e.bytesValue).isEqual(Ve(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return ze(e.geoPointValue.latitude)===ze(t.geoPointValue.latitude)&&ze(e.geoPointValue.longitude)===ze(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return ze(e.integerValue)===ze(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=ze(e.doubleValue),r=ze(t.doubleValue);return n===r?Re(n)===Re(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return X(e.arrayValue.values||[],t.arrayValue.values||[],Ke);case 10:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Ce(n)!==Ce(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Ke(n[i],r[i])))return!1;return!0}(e,t);default:return M()}}function Qe(e,t){return void 0!==(e.values||[]).find((function(e){return Ke(e,t)}))}function Ze(e,t){if(e===t)return 0;var n=Xe(e),r=Xe(t);if(n!==r)return Y(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Y(e.booleanValue,t.booleanValue);case 2:return function(e,t){var n=ze(e.integerValue||e.doubleValue),r=ze(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Je(e.timestampValue,t.timestampValue);case 4:return Je(We(e),We(t));case 5:return Y(e.stringValue,t.stringValue);case 6:return function(e,t){var n=Ve(e),r=Ve(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var a=Y(n[i],r[i]);if(0!==a)return a}return Y(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){var n=Y(ze(e.latitude),ze(t.latitude));return 0!==n?n:Y(ze(e.longitude),ze(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var a=Ze(n[i],r[i]);if(a)return a}return Y(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===qe.mapValue&&t===qe.mapValue)return 0;if(e===qe.mapValue)return 1;if(t===qe.mapValue)return-1;var n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(var o=0;o<r.length&&o<a.length;++o){var s=Y(r[o],a[o]);if(0!==s)return s;var u=Ze(n[r[o]],i[a[o]]);if(0!==u)return u}return Y(r.length,a.length)}(e.mapValue,t.mapValue);default:throw M()}}function Je(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Y(e,t);var n=Ue(e),r=Ue(t),i=Y(n.seconds,r.seconds);return 0!==i?i:Y(n.nanos,r.nanos)}function $e(e){return et(e)}function et(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){var t=Ue(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ve(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,ne.fromName(n).toString()):"geoPointValue"in e?"geo(".concat((t=e.geoPointValue).latitude,",").concat(t.longitude,")"):"arrayValue"in e?function(e){var t,n="[",r=!0,i=Object(s.a)(e.values||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+=et(a)}}catch(o){i.e(o)}finally{i.f()}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){var t,n=Object.keys(e.fields||{}).sort(),r="{",i=!0,a=Object(s.a)(n);try{for(a.s();!(t=a.n()).done;){var o=t.value;i?i=!1:r+=",",r+="".concat(o,":").concat(et(e.fields[o]))}}catch(u){a.e(u)}finally{a.f()}return r+"}"}(e.mapValue):M();var t,n}function tt(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function nt(e){return!!e&&"integerValue"in e}function rt(e){return!!e&&"arrayValue"in e}function it(e){return!!e&&"nullValue"in e}function at(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ot(e){return!!e&&"mapValue"in e}function st(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return De(e.mapValue.fields,(function(e,n){return t.mapValue.fields[e]=st(n)})),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=st(e.arrayValue.values[r]);return n}return Object.assign({},e)}function ut(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function ct(e){return"nullValue"in e?Ye:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?tt(Me.empty(),ne.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:M()}function lt(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?tt(Me.empty(),ne.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?qe:M()}function ht(e,t){var n=Ze(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function dt(e,t){var n=Ze(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}var ft=Object(p.a)((function e(t,n){Object(f.a)(this,e),this.position=t,this.inclusive=n}));function pt(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var a=t[i],o=e.position[i];if(r=a.field.isKeyField()?ne.comparator(ne.fromName(o.referenceValue),n.key):Ze(o,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return r}function vt(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!Ke(e.position[n],t.position[n]))return!1;return!0}var mt=Object(p.a)((function e(){Object(f.a)(this,e)})),gt=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r,i){var a;return Object(f.a)(this,n),(a=t.call(this)).field=e,a.op=r,a.value=i,a}return Object(p.a)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Ze(t,this.value)):null!==t&&Xe(this.value)===Xe(t)&&this.matchesComparison(Ze(t,this.value))}},{key:"matchesComparison",value:function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return M()}}},{key:"isInequality",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}},{key:"getFlattenedFilters",value:function(){return[this]}},{key:"getFilters",value:function(){return[this]}},{key:"getFirstInequalityField",value:function(){return this.isInequality()?this.field:null}}],[{key:"create",value:function(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new At(e,t,r):"array-contains"===t?new Ct(e,r):"in"===t?new Dt(e,r):"not-in"===t?new It(e,r):"array-contains-any"===t?new Pt(e,r):new n(e,t,r)}},{key:"createKeyFieldInFilter",value:function(e,t,n){return"in"===t?new jt(e,n):new Tt(e,n)}}]),n}(mt),yt=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this)).filters=e,i.op=r,i.ht=null,i}return Object(p.a)(n,[{key:"matches",value:function(e){return bt(this)?void 0===this.filters.find((function(t){return!t.matches(e)})):void 0!==this.filters.find((function(t){return t.matches(e)}))}},{key:"getFlattenedFilters",value:function(){return null!==this.ht||(this.ht=this.filters.reduce((function(e,t){return e.concat(t.getFlattenedFilters())}),[])),this.ht}},{key:"getFilters",value:function(){return Object.assign([],this.filters)}},{key:"getFirstInequalityField",value:function(){var e=this.lt((function(e){return e.isInequality()}));return null!==e?e.field:null}},{key:"lt",value:function(e){var t,n=Object(s.a)(this.getFlattenedFilters());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(e(r))return r}}catch(i){n.e(i)}finally{n.f()}return null}}],[{key:"create",value:function(e,t){return new n(e,t)}}]),n}(mt);function bt(e){return"and"===e.op}function wt(e){return"or"===e.op}function xt(e){return Ot(e)&&bt(e)}function Ot(e){var t,n=Object(s.a)(e.filters);try{for(n.s();!(t=n.n()).done;){if(t.value instanceof yt)return!1}}catch(r){n.e(r)}finally{n.f()}return!0}function kt(e){if(e instanceof gt)return e.field.canonicalString()+e.op.toString()+$e(e.value);if(xt(e))return e.filters.map((function(e){return kt(e)})).join(",");var t=e.filters.map((function(e){return kt(e)})).join(",");return"".concat(e.op,"(").concat(t,")")}function _t(e,t){return e instanceof gt?function(e,t){return t instanceof gt&&e.op===t.op&&e.field.isEqual(t.field)&&Ke(e.value,t.value)}(e,t):e instanceof yt?function(e,t){return t instanceof yt&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((function(e,n,r){return e&&_t(n,t.filters[r])}),!0)}(e,t):void M()}function St(e,t){var n=e.filters.concat(t);return yt.create(n,e.op)}function Et(e){return e instanceof gt?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat($e(e.value))}(e):e instanceof yt?function(e){return e.op.toString()+" {"+e.getFilters().map(Et).join(" ,")+"}"}(e):"Filter"}var At=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r,i){var a;return Object(f.a)(this,n),(a=t.call(this,e,r,i)).key=ne.fromName(i.referenceValue),a}return Object(p.a)(n,[{key:"matches",value:function(e){var t=ne.comparator(e.key,this.key);return this.matchesComparison(t)}}]),n}(gt),jt=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this,e,"in",r)).keys=Mt("in",r),i}return Object(p.a)(n,[{key:"matches",value:function(e){return this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(gt),Tt=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this,e,"not-in",r)).keys=Mt("not-in",r),i}return Object(p.a)(n,[{key:"matches",value:function(e){return!this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(gt);function Mt(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(e){return ne.fromName(e.referenceValue)}))}var Ct=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){return Object(f.a)(this,n),t.call(this,e,"array-contains",r)}return Object(p.a)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return rt(t)&&Qe(t.arrayValue,this.value)}}]),n}(gt),Dt=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){return Object(f.a)(this,n),t.call(this,e,"in",r)}return Object(p.a)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return null!==t&&Qe(this.value.arrayValue,t)}}]),n}(gt),It=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){return Object(f.a)(this,n),t.call(this,e,"not-in",r)}return Object(p.a)(n,[{key:"matches",value:function(e){if(Qe(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!Qe(this.value.arrayValue,t)}}]),n}(gt),Pt=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){return Object(f.a)(this,n),t.call(this,e,"array-contains-any",r)}return Object(p.a)(n,[{key:"matches",value:function(e){var t=this,n=e.data.field(this.field);return!(!rt(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(e){return Qe(t.value.arrayValue,e)}))}}]),n}(gt),Rt=Object(p.a)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";Object(f.a)(this,e),this.field=t,this.dir=n}));function Lt(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}var Nt=function(){function e(t,n){Object(f.a)(this,e),this.comparator=t,this.root=n||Ft.EMPTY}return Object(p.a)(e,[{key:"insert",value:function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,Ft.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ft.BLACK,null,null))}},{key:"get",value:function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:"indexOf",value:function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"size",get:function(){return this.root.size}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function(e){this.inorderTraversal((function(t,n){return e(t,n),!1}))}},{key:"toString",value:function(){var e=[];return this.inorderTraversal((function(t,n){return e.push("".concat(t,":").concat(n)),!1})),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function(){return new Bt(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(e){return new Bt(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new Bt(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(e){return new Bt(this.root,e,this.comparator,!0)}}]),e}(),Bt=function(){function e(t,n,r,i){Object(f.a)(this,e),this.isReverse=i,this.nodeStack=[];for(var a=1;!t.isEmpty();)if(a=n?r(t.key,n):1,n&&i&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return Object(p.a)(e,[{key:"getNext",value:function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]),e}(),Ft=function(){function e(t,n,r,i,a){Object(f.a)(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:e.EMPTY,this.right=null!=a?a:e.EMPTY,this.size=this.left.size+1+this.right.size}return Object(p.a)(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(t,i.key)){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:"moveRedRight",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:"rotateLeft",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth",value:function(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed())throw M();if(this.right.isRed())throw M();var e=this.left.check();if(e!==this.right.check())throw M();return e+(this.isRed()?0:1)}}]),e}();Ft.EMPTY=null,Ft.RED=!0,Ft.BLACK=!1,Ft.EMPTY=new(function(){function e(){Object(f.a)(this,e),this.size=0}return Object(p.a)(e,[{key:"key",get:function(){throw M()}},{key:"value",get:function(){throw M()}},{key:"color",get:function(){throw M()}},{key:"left",get:function(){throw M()}},{key:"right",get:function(){throw M()}},{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new Ft(e,t)}},{key:"remove",value:function(e,t){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}}]),e}());var Ut=function(){function e(t){Object(f.a)(this,e),this.comparator=t,this.data=new Nt(this.comparator)}return Object(p.a)(e,[{key:"has",value:function(e){return null!==this.data.get(e)}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"size",get:function(){return this.data.size}},{key:"indexOf",value:function(e){return this.data.indexOf(e)}},{key:"forEach",value:function(e){this.data.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"forEachInRange",value:function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}},{key:"forEachWhile",value:function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}},{key:"firstAfterOrEqual",value:function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:"getIterator",value:function(){return new zt(this.data.getIterator())}},{key:"getIteratorFrom",value:function(e){return new zt(this.data.getIteratorFrom(e))}},{key:"add",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach((function(e){t=t.add(e)})),t}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(0!==this.comparator(i,a))return!1}return!0}},{key:"toArray",value:function(){var e=[];return this.forEach((function(t){e.push(t)})),e}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){return e.push(t)})),"SortedSet("+e.toString()+")"}},{key:"copy",value:function(t){var n=new e(this.comparator);return n.data=t,n}}]),e}(),zt=function(){function e(t){Object(f.a)(this,e),this.iter=t}return Object(p.a)(e,[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}]),e}();function Vt(e){return e.hasNext()?e.getNext():void 0}var Gt=function(){function e(t){Object(f.a)(this,e),this.fields=t,t.sort(te.comparator)}return Object(p.a)(e,[{key:"unionWith",value:function(t){var n,r=new Ut(te.comparator),i=Object(s.a)(this.fields);try{for(i.s();!(n=i.n()).done;){var a=n.value;r=r.add(a)}}catch(l){i.e(l)}finally{i.f()}var o,u=Object(s.a)(t);try{for(u.s();!(o=u.n()).done;){var c=o.value;r=r.add(c)}}catch(l){u.e(l)}finally{u.f()}return new e(r.toArray())}},{key:"covers",value:function(e){var t,n=Object(s.a)(this.fields);try{for(n.s();!(t=n.n()).done;){if(t.value.isPrefixOf(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"isEqual",value:function(e){return X(this.fields,e.fields,(function(e,t){return e.isEqual(t)}))}}],[{key:"empty",value:function(){return new e([])}}]),e}(),Ht=function(){function e(t){Object(f.a)(this,e),this.value=t}return Object(p.a)(e,[{key:"field",value:function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!ot(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}},{key:"set",value:function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=st(t)}},{key:"setAll",value:function(e){var t=this,n=te.emptyPath(),r={},i=[];e.forEach((function(e,a){if(!n.isImmediateParentOf(a)){var o=t.getFieldsMap(n);t.applyChanges(o,r,i),r={},i=[],n=a.popLast()}e?r[a.lastSegment()]=st(e):i.push(a.lastSegment())}));var a=this.getFieldsMap(n);this.applyChanges(a,r,i)}},{key:"delete",value:function(e){var t=this.field(e.popLast());ot(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function(e){return Ke(this.value,e.value)}},{key:"getFieldsMap",value:function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];ot(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}},{key:"applyChanges",value:function(e,t,n){De(t,(function(t,n){return e[t]=n}));var r,i=Object(s.a)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;delete e[a]}}catch(o){i.e(o)}finally{i.f()}}},{key:"clone",value:function(){return new e(st(this.value))}}],[{key:"empty",value:function(){return new e({mapValue:{}})}}]),e}();function Wt(e){var t=[];return De(e.fields,(function(e,n){var r=new te([e]);if(ot(n)){var i=Wt(n.mapValue).fields;if(0===i.length)t.push(r);else{var a,o=Object(s.a)(i);try{for(o.s();!(a=o.n()).done;){var u=a.value;t.push(r.child(u))}}catch(c){o.e(c)}finally{o.f()}}}else t.push(r)})),new Gt(t)}var qt=function(){function e(t,n,r,i,a,o,s){Object(f.a)(this,e),this.key=t,this.documentType=n,this.version=r,this.readTime=i,this.createTime=a,this.data=o,this.documentState=s}return Object(p.a)(e,[{key:"convertToFoundDocument",value:function(e,t){return!this.createTime.isEqual(Z.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:"convertToNoDocument",value:function(e){return this.version=e,this.documentType=2,this.data=Ht.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(e){return this.version=e,this.documentType=3,this.data=Ht.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this.version=Z.min(),this}},{key:"setReadTime",value:function(e){return this.readTime=e,this}},{key:"hasLocalMutations",get:function(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function(){return 2===this.documentState}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function(){return 0!==this.documentType}},{key:"isFoundDocument",value:function(){return 1===this.documentType}},{key:"isNoDocument",value:function(){return 2===this.documentType}},{key:"isUnknownDocument",value:function(){return 3===this.documentType}},{key:"isEqual",value:function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}},{key:"mutableCopy",value:function(){return new e(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function(t){return new e(t,0,Z.min(),Z.min(),Z.min(),Ht.empty(),0)}},{key:"newFoundDocument",value:function(t,n,r,i){return new e(t,1,n,Z.min(),r,i,0)}},{key:"newNoDocument",value:function(t,n){return new e(t,2,n,Z.min(),Z.min(),Ht.empty(),0)}},{key:"newUnknownDocument",value:function(t,n){return new e(t,3,n,Z.min(),Z.min(),Ht.empty(),2)}}]),e}(),Yt=Object(p.a)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;Object(f.a)(this,e),this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=o,this.endAt=s,this.ft=null}));function Xt(e){return new Yt(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function Kt(e){var t=I(e);if(null===t.ft){var n=t.path.canonicalString();null!==t.collectionGroup&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map((function(e){return kt(e)})).join(","),n+="|ob:",n+=t.orderBy.map((function(e){return function(e){return e.field.canonicalString()+e.dir}(e)})).join(","),Pe(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((function(e){return $e(e)})).join(",")),t.endAt&&(n+="|ub:",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((function(e){return $e(e)})).join(",")),t.ft=n}return t.ft}function Qt(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!Lt(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(!_t(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!vt(e.startAt,t.startAt)&&vt(e.endAt,t.endAt)}function Zt(e){return ne.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Jt(e,t){return e.filters.filter((function(e){return e instanceof gt&&e.field.isEqual(t)}))}function $t(e,t,n){var r,i=Ye,a=!0,o=Object(s.a)(Jt(e,t));try{for(o.s();!(r=o.n()).done;){var u=r.value,c=Ye,l=!0;switch(u.op){case"<":case"<=":c=ct(u.value);break;case"==":case"in":case">=":c=u.value;break;case">":c=u.value,l=!1;break;case"!=":case"not-in":c=Ye}ht({value:i,inclusive:a},{value:c,inclusive:l})<0&&(i=c,a=l)}}catch(f){o.e(f)}finally{o.f()}if(null!==n)for(var h=0;h<e.orderBy.length;++h)if(e.orderBy[h].field.isEqual(t)){var d=n.position[h];ht({value:i,inclusive:a},{value:d,inclusive:n.inclusive})<0&&(i=d,a=n.inclusive);break}return{value:i,inclusive:a}}function en(e,t,n){var r,i=qe,a=!0,o=Object(s.a)(Jt(e,t));try{for(o.s();!(r=o.n()).done;){var u=r.value,c=qe,l=!0;switch(u.op){case">=":case">":c=lt(u.value),l=!1;break;case"==":case"in":case"<=":c=u.value;break;case"<":c=u.value,l=!1;break;case"!=":case"not-in":c=qe}dt({value:i,inclusive:a},{value:c,inclusive:l})>0&&(i=c,a=l)}}catch(f){o.e(f)}finally{o.f()}if(null!==n)for(var h=0;h<e.orderBy.length;++h)if(e.orderBy[h].field.isEqual(t)){var d=n.position[h];dt({value:i,inclusive:a},{value:d,inclusive:n.inclusive})>0&&(i=d,a=n.inclusive);break}return{value:i,inclusive:a}}var tn=Object(p.a)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;Object(f.a)(this,e),this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=o,this.startAt=s,this.endAt=u,this.dt=null,this._t=null,this.startAt,this.endAt}));function nn(e,t,n,r,i,a,o,s){return new tn(e,t,n,r,i,a,o,s)}function rn(e){return new tn(e)}function an(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function on(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function sn(e){var t,n=Object(s.a)(e.filters);try{for(n.s();!(t=n.n()).done;){var r=t.value.getFirstInequalityField();if(null!==r)return r}}catch(i){n.e(i)}finally{n.f()}return null}function un(e){return null!==e.collectionGroup}function cn(e){var t=I(e);if(null===t.dt){t.dt=[];var n=sn(t),r=on(t);if(null!==n&&null===r)n.isKeyField()||t.dt.push(new Rt(n)),t.dt.push(new Rt(te.keyField(),"asc"));else{var i,a=!1,o=Object(s.a)(t.explicitOrderBy);try{for(o.s();!(i=o.n()).done;){var u=i.value;t.dt.push(u),u.field.isKeyField()&&(a=!0)}}catch(l){o.e(l)}finally{o.f()}if(!a){var c=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.dt.push(new Rt(te.keyField(),c))}}}return t.dt}function ln(e){var t=I(e);if(!t._t)if("F"===t.limitType)t._t=Xt(t.path,t.collectionGroup,cn(t),t.filters,t.limit,t.startAt,t.endAt);else{var n,r=[],i=Object(s.a)(cn(t));try{for(i.s();!(n=i.n()).done;){var a=n.value,o="desc"===a.dir?"asc":"desc";r.push(new Rt(a.field,o))}}catch(l){i.e(l)}finally{i.f()}var u=t.endAt?new ft(t.endAt.position,t.endAt.inclusive):null,c=t.startAt?new ft(t.startAt.position,t.startAt.inclusive):null;t._t=Xt(t.path,t.collectionGroup,r,t.filters,t.limit,u,c)}return t._t}function hn(e,t){t.getFirstInequalityField(),sn(e);var n=e.filters.concat([t]);return new tn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function dn(e,t,n){return new tn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function fn(e,t){return Qt(ln(e),ln(t))&&e.limitType===t.limitType}function pn(e){return"".concat(Kt(ln(e)),"|lt:").concat(e.limitType)}function vn(e){return"Query(target=".concat(function(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map((function(e){return Et(e)})).join(", "),"]")),Pe(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map((function(e){return function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)})).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((function(e){return $e(e)})).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((function(e){return $e(e)})).join(",")),"Target(".concat(t,")")}(ln(e)),"; limitType=").concat(e.limitType,")")}function mn(e,t){return t.isFoundDocument()&&function(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ne.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){var n,r=Object(s.a)(cn(e));try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}(e,t)&&function(e,t){var n,r=Object(s.a)(e.filters);try{for(r.s();!(n=r.n()).done;){if(!n.value.matches(t))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){var r=pt(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,cn(e),t))&&!(e.endAt&&!function(e,t,n){var r=pt(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,cn(e),t))}(e,t)}function gn(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function yn(e){return function(t,n){var r,i=!1,a=Object(s.a)(cn(e));try{for(a.s();!(r=a.n()).done;){var o=r.value,u=bn(o,t,n);if(0!==u)return u;i=i||o.field.isKeyField()}}catch(c){a.e(c)}finally{a.f()}return 0}}function bn(e,t,n){var r=e.field.isKeyField()?ne.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Ze(r,i):M()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return M()}}function wn(e,t){if(e.wt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Re(t)?"-0":t}}function xn(e){return{integerValue:""+e}}function On(e,t){return Le(t)?xn(t):wn(e,t)}var kn=Object(p.a)((function e(){Object(f.a)(this,e),this._=void 0}));function _n(e,t,n){return e instanceof An?function(e,t){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof jn?Tn(e,t):e instanceof Mn?Cn(e,t):function(e,t){var n=En(e,t),r=In(n)+In(e.gt);return nt(n)&&nt(e.gt)?xn(r):wn(e.yt,r)}(e,t)}function Sn(e,t,n){return e instanceof jn?Tn(e,t):e instanceof Mn?Cn(e,t):n}function En(e,t){return e instanceof Dn?nt(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}var An=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n)}(kn),jn=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this)).elements=e,r}return Object(p.a)(n)}(kn);function Tn(e,t){var n,r=Pn(t),i=Object(s.a)(e.elements);try{var a=function(){var e=n.value;r.some((function(t){return Ke(t,e)}))||r.push(e)};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return{arrayValue:{values:r}}}var Mn=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this)).elements=e,r}return Object(p.a)(n)}(kn);function Cn(e,t){var n,r=Pn(t),i=Object(s.a)(e.elements);try{var a=function(){var e=n.value;r=r.filter((function(t){return!Ke(t,e)}))};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return{arrayValue:{values:r}}}var Dn=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this)).yt=e,i.gt=r,i}return Object(p.a)(n)}(kn);function In(e){return ze(e.integerValue||e.doubleValue)}function Pn(e){return rt(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var Rn=Object(p.a)((function e(t,n){Object(f.a)(this,e),this.field=t,this.transform=n}));var Ln=Object(p.a)((function e(t,n){Object(f.a)(this,e),this.version=t,this.transformResults=n})),Nn=function(){function e(t,n){Object(f.a)(this,e),this.updateTime=t,this.exists=n}return Object(p.a)(e,[{key:"isNone",get:function(){return void 0===this.updateTime&&void 0===this.exists}},{key:"isEqual",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function(){return new e}},{key:"exists",value:function(t){return new e(void 0,t)}},{key:"updateTime",value:function(t){return new e(t)}}]),e}();function Bn(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var Fn=Object(p.a)((function e(){Object(f.a)(this,e)}));function Un(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Jn(e.key,Nn.none()):new Wn(e.key,e.data,Nn.none());var n,r=e.data,i=Ht.empty(),a=new Ut(te.comparator),o=Object(s.a)(t.fields);try{for(o.s();!(n=o.n()).done;){var u=n.value;if(!a.has(u)){var c=r.field(u);null===c&&u.length>1&&(u=u.popLast(),c=r.field(u)),null===c?i.delete(u):i.set(u,c),a=a.add(u)}}}catch(l){o.e(l)}finally{o.f()}return new qn(e.key,i,new Gt(a.toArray()),Nn.none())}function zn(e,t,n){e instanceof Wn?function(e,t,n){var r=e.value.clone(),i=Xn(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof qn?function(e,t,n){if(Bn(e.precondition,t)){var r=Xn(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Yn(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else t.convertToUnknownDocument(n.version)}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Vn(e,t,n,r){return e instanceof Wn?function(e,t,n,r){if(!Bn(e.precondition,t))return n;var i=e.value.clone(),a=Kn(e.fieldTransforms,r,t);return i.setAll(a),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof qn?function(e,t,n,r){if(!Bn(e.precondition,t))return n;var i=Kn(e.fieldTransforms,r,t),a=t.data;return a.setAll(Yn(e)),a.setAll(i),t.convertToFoundDocument(t.version,a).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((function(e){return e.field})))}(e,t,n,r):function(e,t,n){return Bn(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Gn(e,t){var n,r=null,i=Object(s.a)(e.fieldTransforms);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=t.data.field(a.field),u=En(a.transform,o||null);null!=u&&(null===r&&(r=Ht.empty()),r.set(a.field,u))}}catch(c){i.e(c)}finally{i.f()}return r||null}function Hn(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&X(e,t,(function(e,t){return function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof jn&&t instanceof jn||e instanceof Mn&&t instanceof Mn?X(e.elements,t.elements,Ke):e instanceof Dn&&t instanceof Dn?Ke(e.gt,t.gt):e instanceof An&&t instanceof An}(e.transform,t.transform)}(e,t)}))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}var Wn=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return Object(f.a)(this,n),(a=t.call(this)).key=e,a.value=r,a.precondition=i,a.fieldTransforms=o,a.type=0,a}return Object(p.a)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(Fn),qn=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r,i,a){var o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return Object(f.a)(this,n),(o=t.call(this)).key=e,o.data=r,o.fieldMask=i,o.precondition=a,o.fieldTransforms=s,o.type=1,o}return Object(p.a)(n,[{key:"getFieldMask",value:function(){return this.fieldMask}}]),n}(Fn);function Yn(e){var t=new Map;return e.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}})),t}function Xn(e,t,n){var r=new Map;C(e.length===n.length);for(var i=0;i<n.length;i++){var a=e[i],o=a.transform,s=t.data.field(a.field);r.set(a.field,Sn(o,s,n[i]))}return r}function Kn(e,t,n){var r,i=new Map,a=Object(s.a)(e);try{for(a.s();!(r=a.n()).done;){var o=r.value,u=o.transform,c=n.data.field(o.field);i.set(o.field,_n(u,c,t))}}catch(l){a.e(l)}finally{a.f()}return i}var Qn,Zn,Jn=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return Object(p.a)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(Fn),$n=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return Object(p.a)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(Fn),er=Object(p.a)((function e(t){Object(f.a)(this,e),this.count=t}));function tr(e){switch(e){default:return M();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0}}function nr(e){if(void 0===e)return A("GRPC error has no .code"),P.UNKNOWN;switch(e){case Qn.OK:return P.OK;case Qn.CANCELLED:return P.CANCELLED;case Qn.UNKNOWN:return P.UNKNOWN;case Qn.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case Qn.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case Qn.INTERNAL:return P.INTERNAL;case Qn.UNAVAILABLE:return P.UNAVAILABLE;case Qn.UNAUTHENTICATED:return P.UNAUTHENTICATED;case Qn.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case Qn.NOT_FOUND:return P.NOT_FOUND;case Qn.ALREADY_EXISTS:return P.ALREADY_EXISTS;case Qn.PERMISSION_DENIED:return P.PERMISSION_DENIED;case Qn.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case Qn.ABORTED:return P.ABORTED;case Qn.OUT_OF_RANGE:return P.OUT_OF_RANGE;case Qn.UNIMPLEMENTED:return P.UNIMPLEMENTED;case Qn.DATA_LOSS:return P.DATA_LOSS;default:return M()}}(Zn=Qn||(Qn={}))[Zn.OK=0]="OK",Zn[Zn.CANCELLED=1]="CANCELLED",Zn[Zn.UNKNOWN=2]="UNKNOWN",Zn[Zn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Zn[Zn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Zn[Zn.NOT_FOUND=5]="NOT_FOUND",Zn[Zn.ALREADY_EXISTS=6]="ALREADY_EXISTS",Zn[Zn.PERMISSION_DENIED=7]="PERMISSION_DENIED",Zn[Zn.UNAUTHENTICATED=16]="UNAUTHENTICATED",Zn[Zn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Zn[Zn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Zn[Zn.ABORTED=10]="ABORTED",Zn[Zn.OUT_OF_RANGE=11]="OUT_OF_RANGE",Zn[Zn.UNIMPLEMENTED=12]="UNIMPLEMENTED",Zn[Zn.INTERNAL=13]="INTERNAL",Zn[Zn.UNAVAILABLE=14]="UNAVAILABLE",Zn[Zn.DATA_LOSS=15]="DATA_LOSS";var rr=function(){function e(t,n){Object(f.a)(this,e),this.mapKeyFn=t,this.equalsFn=n,this.inner={},this.innerSize=0}return Object(p.a)(e,[{key:"get",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var r,i=Object(s.a)(n);try{for(i.s();!(r=i.n()).done;){var a=Object(o.a)(r.value,2),u=a[0],c=a[1];if(this.equalsFn(u,e))return c}}catch(l){i.e(l)}finally{i.f()}}}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"set",value:function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}},{key:"delete",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}},{key:"forEach",value:function(e){De(this.inner,(function(t,n){var r,i=Object(s.a)(n);try{for(i.s();!(r=i.n()).done;){var a=Object(o.a)(r.value,2),u=a[0],c=a[1];e(u,c)}}catch(l){i.e(l)}finally{i.f()}}))}},{key:"isEmpty",value:function(){return Ie(this.inner)}},{key:"size",value:function(){return this.innerSize}}]),e}(),ir=new Nt(ne.comparator);function ar(){return ir}var or=new Nt(ne.comparator);function sr(){for(var e=or,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];e=e.insert(o.key,o)}return e}function ur(e){var t=or;return e.forEach((function(e,n){return t=t.insert(e,n.overlayedDocument)})),t}function cr(){return hr()}function lr(){return hr()}function hr(){return new rr((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)}))}var dr=new Nt(ne.comparator),fr=new Ut(ne.comparator);function pr(){for(var e=fr,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];e=e.add(o)}return e}var vr=new Ut(Y);function mr(){return vr}var gr=function(){function e(t,n,r,i,a){Object(f.a)(this,e),this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}return Object(p.a)(e,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function(t,n,r){var i=new Map;return i.set(t,yr.createSynthesizedTargetChangeForCurrentChange(t,n,r)),new e(Z.min(),i,mr(),ar(),pr())}}]),e}(),yr=function(){function e(t,n,r,i,a){Object(f.a)(this,e),this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}return Object(p.a)(e,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function(t,n,r){return new e(r,n,pr(),pr(),pr())}}]),e}(),br=Object(p.a)((function e(t,n,r,i){Object(f.a)(this,e),this.It=t,this.removedTargetIds=n,this.key=r,this.Tt=i})),wr=Object(p.a)((function e(t,n){Object(f.a)(this,e),this.targetId=t,this.Et=n})),xr=Object(p.a)((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Be.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Object(f.a)(this,e),this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=i})),Or=function(){function e(){Object(f.a)(this,e),this.At=0,this.Rt=Sr(),this.bt=Be.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}return Object(p.a)(e,[{key:"current",get:function(){return this.Pt}},{key:"resumeToken",get:function(){return this.bt}},{key:"Vt",get:function(){return 0!==this.At}},{key:"St",get:function(){return this.vt}},{key:"Dt",value:function(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}},{key:"Ct",value:function(){var e=pr(),t=pr(),n=pr();return this.Rt.forEach((function(r,i){switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:M()}})),new yr(this.bt,this.Pt,e,t,n)}},{key:"xt",value:function(){this.vt=!1,this.Rt=Sr()}},{key:"Nt",value:function(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}},{key:"kt",value:function(e){this.vt=!0,this.Rt=this.Rt.remove(e)}},{key:"Ot",value:function(){this.At+=1}},{key:"Mt",value:function(){this.At-=1}},{key:"Ft",value:function(){this.vt=!0,this.Pt=!0}}]),e}(),kr=function(){function e(t){Object(f.a)(this,e),this.$t=t,this.Bt=new Map,this.Lt=ar(),this.qt=_r(),this.Ut=new Ut(Y)}return Object(p.a)(e,[{key:"Kt",value:function(e){var t,n=Object(s.a)(e.It);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.Tt&&e.Tt.isFoundDocument()?this.Gt(r,e.Tt):this.Qt(r,e.key,e.Tt)}}catch(u){n.e(u)}finally{n.f()}var i,a=Object(s.a)(e.removedTargetIds);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.Qt(o,e.key,e.Tt)}}catch(u){a.e(u)}finally{a.f()}}},{key:"jt",value:function(e){var t=this;this.forEachTarget(e,(function(n){var r=t.Wt(n);switch(e.state){case 0:t.zt(n)&&r.Dt(e.resumeToken);break;case 1:r.Mt(),r.Vt||r.xt(),r.Dt(e.resumeToken);break;case 2:r.Mt(),r.Vt||t.removeTarget(n);break;case 3:t.zt(n)&&(r.Ft(),r.Dt(e.resumeToken));break;case 4:t.zt(n)&&(t.Ht(n),r.Dt(e.resumeToken));break;default:M()}}))}},{key:"forEachTarget",value:function(e,t){var n=this;e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach((function(e,r){n.zt(r)&&t(r)}))}},{key:"Jt",value:function(e){var t=e.targetId,n=e.Et.count,r=this.Yt(t);if(r){var i=r.target;if(Zt(i))if(0===n){var a=new ne(i.path);this.Qt(t,a,qt.newNoDocument(a,Z.min()))}else C(1===n);else this.Xt(t)!==n&&(this.Ht(t),this.Ut=this.Ut.add(t))}}},{key:"Zt",value:function(e){var t=this,n=new Map;this.Bt.forEach((function(r,i){var a=t.Yt(i);if(a){if(r.current&&Zt(a.target)){var o=new ne(a.target.path);null!==t.Lt.get(o)||t.te(i,o)||t.Qt(i,o,qt.newNoDocument(o,e))}r.St&&(n.set(i,r.Ct()),r.xt())}}));var r=pr();this.qt.forEach((function(e,n){var i=!0;n.forEachWhile((function(e){var n=t.Yt(e);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(e))})),this.Lt.forEach((function(t,n){return n.setReadTime(e)}));var i=new gr(e,n,this.Ut,this.Lt,r);return this.Lt=ar(),this.qt=_r(),this.Ut=new Ut(Y),i}},{key:"Gt",value:function(e,t){if(this.zt(e)){var n=this.te(e,t.key)?2:0;this.Wt(e).Nt(t.key,n),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}}},{key:"Qt",value:function(e,t,n){if(this.zt(e)){var r=this.Wt(e);this.te(e,t)?r.Nt(t,1):r.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),n&&(this.Lt=this.Lt.insert(t,n))}}},{key:"removeTarget",value:function(e){this.Bt.delete(e)}},{key:"Xt",value:function(e){var t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}},{key:"Ot",value:function(e){this.Wt(e).Ot()}},{key:"Wt",value:function(e){var t=this.Bt.get(e);return t||(t=new Or,this.Bt.set(e,t)),t}},{key:"ee",value:function(e){var t=this.qt.get(e);return t||(t=new Ut(Y),this.qt=this.qt.insert(e,t)),t}},{key:"zt",value:function(e){var t=null!==this.Yt(e);return t||E("WatchChangeAggregator","Detected inactive target",e),t}},{key:"Yt",value:function(e){var t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}},{key:"Ht",value:function(e){var t=this;this.Bt.set(e,new Or),this.$t.getRemoteKeysForTarget(e).forEach((function(n){t.Qt(e,n,null)}))}},{key:"te",value:function(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}]),e}();function _r(){return new Nt(ne.comparator)}function Sr(){return new Nt(ne.comparator)}var Er={asc:"ASCENDING",desc:"DESCENDING"},Ar={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},jr={and:"AND",or:"OR"},Tr=Object(p.a)((function e(t,n){Object(f.a)(this,e),this.databaseId=t,this.wt=n}));function Mr(e,t){return e.wt?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Cr(e,t){return e.wt?t.toBase64():t.toUint8Array()}function Dr(e,t){return Mr(e,t.toTimestamp())}function Ir(e){return C(!!e),Z.fromTimestamp(function(e){var t=Ue(e);return new Q(t.seconds,t.nanos)}(e))}function Pr(e,t){return function(e){return new $(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Rr(e){var t=$.fromString(e);return C(ii(t)),t}function Lr(e,t){return Pr(e.databaseId,t.path)}function Nr(e,t){var n=Rr(t);if(n.get(1)!==e.databaseId.projectId)throw new R(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new R(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ne(zr(n))}function Br(e,t){return Pr(e.databaseId,t)}function Fr(e){var t=Rr(e);return 4===t.length?$.emptyPath():zr(t)}function Ur(e){return new $(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function zr(e){return C(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Vr(e,t,n){return{name:Lr(e,t),fields:n.value.mapValue.fields}}function Gr(e,t,n){var r=Nr(e,t.name),i=Ir(t.updateTime),a=t.createTime?Ir(t.createTime):Z.min(),o=new Ht({mapValue:{fields:t.fields}}),s=qt.newFoundDocument(r,i,a,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Hr(e,t){return"found"in t?function(e,t){C(!!t.found),t.found.name,t.found.updateTime;var n=Nr(e,t.found.name),r=Ir(t.found.updateTime),i=t.found.createTime?Ir(t.found.createTime):Z.min(),a=new Ht({mapValue:{fields:t.found.fields}});return qt.newFoundDocument(n,r,i,a)}(e,t):"missing"in t?function(e,t){C(!!t.missing),C(!!t.readTime);var n=Nr(e,t.missing),r=Ir(t.readTime);return qt.newNoDocument(n,r)}(e,t):M()}function Wr(e,t){var n;if(t instanceof Wn)n={update:Vr(e,t.key,t.value)};else if(t instanceof Jn)n={delete:Lr(e,t.key)};else if(t instanceof qn)n={update:Vr(e,t.key,t.data),updateMask:ri(t.fieldMask)};else{if(!(t instanceof $n))return M();n={verify:Lr(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((function(e){return function(e,t){var n=t.transform;if(n instanceof An)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof jn)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Mn)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Dn)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw M()}(0,e)}))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Dr(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:M()}(e,t.precondition)),n}function qr(e,t){var n=t.currentDocument?function(e){return void 0!==e.updateTime?Nn.updateTime(Ir(e.updateTime)):void 0!==e.exists?Nn.exists(e.exists):Nn.none()}(t.currentDocument):Nn.none(),r=t.updateTransforms?t.updateTransforms.map((function(t){return function(e,t){var n=null;if("setToServerValue"in t)C("REQUEST_TIME"===t.setToServerValue),n=new An;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new jn(r)}else if("removeAllFromArray"in t){var i=t.removeAllFromArray.values||[];n=new Mn(i)}else"increment"in t?n=new Dn(e,t.increment):M();var a=te.fromServerFormat(t.fieldPath);return new Rn(a,n)}(e,t)})):[];if(t.update){t.update.name;var i=Nr(e,t.update.name),a=new Ht({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=function(e){var t=e.fieldPaths||[];return new Gt(t.map((function(e){return te.fromServerFormat(e)})))}(t.updateMask);return new qn(i,a,o,n,r)}return new Wn(i,a,n,r)}if(t.delete){var s=Nr(e,t.delete);return new Jn(s,n)}if(t.verify){var u=Nr(e,t.verify);return new $n(u,n)}return M()}function Yr(e,t){return{documents:[Br(e,t.path)]}}function Xr(e,t){var n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Br(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Br(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length)return ni(yt.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);var a=function(e){if(0!==e.length)return e.map((function(e){return function(e){return{field:ei(e.field),direction:Zr(e.dir)}}(e)}))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);var o,s=function(e,t){return e.wt||Pe(t)?t:{value:t}}(e,t.limit);return null!==s&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt={before:(o=t.startAt).inclusive,values:o.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function Kr(e){var t=Fr(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){C(1===r);var a=n.from[0];a.allDescendants?i=a.collectionId:t=t.child(a.collectionId)}var o=[];n.where&&(o=function(e){var t=Qr(e);return t instanceof yt&&xt(t)?t.getFilters():[t]}(n.where));var s=[];n.orderBy&&(s=n.orderBy.map((function(e){return function(e){return new Rt(ti(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)})));var u=null;n.limit&&(u=function(e){var t;return Pe(t="object"==typeof e?e.value:e)?null:t}(n.limit));var c=null;n.startAt&&(c=function(e){var t=!!e.before,n=e.values||[];return new ft(n,t)}(n.startAt));var l=null;return n.endAt&&(l=function(e){var t=!e.before,n=e.values||[];return new ft(n,t)}(n.endAt)),nn(t,i,s,o,u,"F",c,l)}function Qr(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":var t=ti(e.unaryFilter.field);return gt.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=ti(e.unaryFilter.field);return gt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ti(e.unaryFilter.field);return gt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ti(e.unaryFilter.field);return gt.create(i,"!=",{nullValue:"NULL_VALUE"});default:return M()}}(e):void 0!==e.fieldFilter?function(e){return gt.create(ti(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return M()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return yt.create(e.compositeFilter.filters.map((function(e){return Qr(e)})),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return M()}}(e.compositeFilter.op))}(e):M()}function Zr(e){return Er[e]}function Jr(e){return Ar[e]}function $r(e){return jr[e]}function ei(e){return{fieldPath:e.canonicalString()}}function ti(e){return te.fromServerFormat(e.fieldPath)}function ni(e){return e instanceof gt?function(e){if("=="===e.op){if(at(e.value))return{unaryFilter:{field:ei(e.field),op:"IS_NAN"}};if(it(e.value))return{unaryFilter:{field:ei(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(at(e.value))return{unaryFilter:{field:ei(e.field),op:"IS_NOT_NAN"}};if(it(e.value))return{unaryFilter:{field:ei(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ei(e.field),op:Jr(e.op),value:e.value}}}(e):e instanceof yt?function(e){var t=e.getFilters().map((function(e){return ni(e)}));return 1===t.length?t[0]:{compositeFilter:{op:$r(e.op),filters:t}}}(e):M()}function ri(e){var t=[];return e.fields.forEach((function(e){return t.push(e.canonicalString())})),{fieldPaths:t}}function ii(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function ai(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=si(t)),t=oi(e.get(n),t);return si(t)}function oi(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var a=e.charAt(i);switch(a){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=a}}return n}function si(e){return e+"\x01\x01"}function ui(e){var t=e.length;if(C(t>=2),2===t)return C("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),$.emptyPath();for(var n=t-2,r=[],i="",a=0;a<t;){var o=e.indexOf("\x01",a);switch((o<0||o>n)&&M(),e.charAt(o+1)){case"\x01":var s=e.substring(a,o),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case"\x10":i+=e.substring(a,o),i+="\0";break;case"\x11":i+=e.substring(a,o+1);break;default:M()}a=o+2}return new $(r)}var ci=["userId","batchId"];function li(e,t){return[e,ai(t)]}function hi(e,t,n){return[e,ai(t),n]}var di={},fi=["prefixPath","collectionGroup","readTime","documentId"],pi=["prefixPath","collectionGroup","documentId"],vi=["collectionGroup","readTime","prefixPath","documentId"],mi=["canonicalId","targetId"],gi=["targetId","path"],yi=["path","targetId"],bi=["collectionId","parent"],wi=["indexId","uid"],xi=["uid","sequenceNumber"],Oi=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ki=["indexId","uid","orderedDocumentKey"],_i=["userId","collectionPath","documentId"],Si=["userId","collectionPath","largestBatchId"],Ei=["userId","collectionGroup","largestBatchId"],Ai=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments"].concat(["clientMetadata"]).concat(["remoteDocumentGlobal"]).concat(["collectionParents"]).concat(["bundles","namedQueries"]),ji=[].concat(Object(d.a)(Ai),["documentOverlays"]),Ti=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Mi=Ti,Ci=[].concat(Mi,["indexConfiguration","indexState","indexEntries"]),Di=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this)).se=e,i.currentSequenceNumber=r,i}return Object(p.a)(n)}(fe);function Ii(e,t){var n=I(e);return ye.M(n.se,t)}var Pi=function(){function e(t,n,r,i){Object(f.a)(this,e),this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return Object(p.a)(e,[{key:"applyToRemoteDocument",value:function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(e.key)&&zn(i,e,n[r])}}},{key:"applyToLocalView",value:function(e,t){var n,r=Object(s.a)(this.baseMutations);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.key.isEqual(e.key)&&(t=Vn(i,e,t,this.localWriteTime))}}catch(c){r.e(c)}finally{r.f()}var a,o=Object(s.a)(this.mutations);try{for(o.s();!(a=o.n()).done;){var u=a.value;u.key.isEqual(e.key)&&(t=Vn(u,e,t,this.localWriteTime))}}catch(c){o.e(c)}finally{o.f()}return t}},{key:"applyToLocalDocumentSet",value:function(e,t){var n=this,r=lr();return this.mutations.forEach((function(i){var a=e.get(i.key),o=a.overlayedDocument,s=n.applyToLocalView(o,a.mutatedFields),u=Un(o,s=t.has(i.key)?null:s);null!==u&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(Z.min())})),r}},{key:"keys",value:function(){return this.mutations.reduce((function(e,t){return e.add(t.key)}),pr())}},{key:"isEqual",value:function(e){return this.batchId===e.batchId&&X(this.mutations,e.mutations,(function(e,t){return Hn(e,t)}))&&X(this.baseMutations,e.baseMutations,(function(e,t){return Hn(e,t)}))}}]),e}(),Ri=function(){function e(t,n,r,i){Object(f.a)(this,e),this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return Object(p.a)(e,null,[{key:"from",value:function(t,n,r){C(t.mutations.length===r.length);for(var i=dr,a=t.mutations,o=0;o<a.length;o++)i=i.insert(a[o].key,r[o].version);return new e(t,n,r,i)}}]),e}(),Li=function(){function e(t,n){Object(f.a)(this,e),this.largestBatchId=t,this.mutation=n}return Object(p.a)(e,[{key:"getKey",value:function(){return this.mutation.key}},{key:"isEqual",value:function(e){return null!==e&&this.mutation===e.mutation}},{key:"toString",value:function(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}]),e}(),Ni=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Z.min(),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Z.min(),s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Be.EMPTY_BYTE_STRING;Object(f.a)(this,e),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return Object(p.a)(e,[{key:"withSequenceNumber",value:function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}},{key:"withResumeToken",value:function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)}},{key:"withLastLimboFreeSnapshotVersion",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}]),e}(),Bi=Object(p.a)((function e(t){Object(f.a)(this,e),this.ie=t}));function Fi(e,t){var n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Ui(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Lr(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Mr(e,t.version.toTimestamp()),createTime:Mr(e,t.createTime.toTimestamp())}}(e.ie,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:zi(t.version)};else{if(!t.isUnknownDocument())return M();r.unknownDocument={path:n.path.toArray(),version:zi(t.version)}}return r}function Ui(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function zi(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Vi(e){var t=new Q(e.seconds,e.nanoseconds);return Z.fromTimestamp(t)}function Gi(e,t){for(var n=(t.baseMutations||[]).map((function(t){return qr(e.ie,t)})),r=0;r<t.mutations.length-1;++r){var i=t.mutations[r];if(r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform){var a=t.mutations[r+1];i.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}var o=t.mutations.map((function(t){return qr(e.ie,t)})),s=Q.fromMillis(t.localWriteTimeMs);return new Pi(t.batchId,s,n,o)}function Hi(e){var t,n,r=Vi(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?Vi(e.lastLimboFreeSnapshotVersion):Z.min();return void 0!==e.query.documents?(C(1===(n=e.query).documents.length),t=ln(rn(Fr(n.documents[0])))):t=function(e){return ln(Kr(e))}(e.query),new Ni(t,e.targetId,0,e.lastListenSequenceNumber,r,i,Be.fromBase64String(e.resumeToken))}function Wi(e,t){var n,r=zi(t.snapshotVersion),i=zi(t.lastLimboFreeSnapshotVersion);n=Zt(t.target)?Yr(e.ie,t.target):Xr(e.ie,t.target);var a=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Kt(t.target),readTime:r,resumeToken:a,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function qi(e){var t=Kr({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?dn(t,t.limit,"L"):t}function Yi(e,t){return new Li(t.largestBatchId,qr(e.ie,t.overlayMutation))}function Xi(e,t){var n=t.path.lastSegment();return[e,ai(t.path.popLast()),n]}function Ki(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:zi(r.readTime),documentKey:ai(r.documentKey.path),largestBatchId:r.largestBatchId}}var Qi=function(){function e(){Object(f.a)(this,e)}return Object(p.a)(e,[{key:"getBundleMetadata",value:function(e,t){return Zi(e).get(t).next((function(e){if(e)return{id:(t=e).bundleId,createTime:Vi(t.createTime),version:t.version};var t}))}},{key:"saveBundleMetadata",value:function(e,t){return Zi(e).put({bundleId:(n=t).id,createTime:zi(Ir(n.createTime)),version:n.version});var n}},{key:"getNamedQuery",value:function(e,t){return Ji(e).get(t).next((function(e){if(e)return{name:(t=e).name,query:qi(t.bundledQuery),readTime:Vi(t.readTime)};var t}))}},{key:"saveNamedQuery",value:function(e,t){return Ji(e).put(function(e){return{name:e.name,readTime:zi(Ir(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}]),e}();function Zi(e){return Ii(e,"bundles")}function Ji(e){return Ii(e,"namedQueries")}var $i=function(){function e(t,n){Object(f.a)(this,e),this.yt=t,this.userId=n}return Object(p.a)(e,[{key:"getOverlay",value:function(e,t){var n=this;return ea(e).get(Xi(this.userId,t)).next((function(e){return e?Yi(n.yt,e):null}))}},{key:"getOverlays",value:function(e,t){var n=this,r=cr();return me.forEach(t,(function(t){return n.getOverlay(e,t).next((function(e){null!==e&&r.set(t,e)}))})).next((function(){return r}))}},{key:"saveOverlays",value:function(e,t,n){var r=this,i=[];return n.forEach((function(n,a){var o=new Li(t,a);i.push(r.oe(e,o))})),me.waitFor(i)}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,i=new Set;t.forEach((function(e){return i.add(ai(e.getCollectionPath()))}));var a=[];return i.forEach((function(t){var i=IDBKeyRange.bound([r.userId,t,n],[r.userId,t,n+1],!1,!0);a.push(ea(e).Y("collectionPathOverlayIndex",i))})),me.waitFor(a)}},{key:"getOverlaysForCollection",value:function(e,t,n){var r=this,i=cr(),a=ai(t),o=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,Number.POSITIVE_INFINITY],!0);return ea(e).W("collectionPathOverlayIndex",o).next((function(e){var t,n=Object(s.a)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,o=Yi(r.yt,a);i.set(o.getKey(),o)}}catch(u){n.e(u)}finally{n.f()}return i}))}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){var i,a=this,o=cr(),s=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ea(e).Z({index:"collectionGroupOverlayIndex",range:s},(function(e,t,n){var s=Yi(a.yt,t);o.size()<r||s.largestBatchId===i?(o.set(s.getKey(),s),i=s.largestBatchId):n.done()})).next((function(){return o}))}},{key:"oe",value:function(e,t){return ea(e).put(function(e,t,n){var r=Xi(t,n.mutation.key),i=Object(o.a)(r,3);i[0];return{userId:t,collectionPath:i[1],documentId:i[2],collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Wr(e.ie,n.mutation)}}(this.yt,this.userId,t))}}],[{key:"re",value:function(t,n){return new e(t,n.uid||"")}}]),e}();function ea(e){return Ii(e,"documentOverlays")}var ta=function(){function e(){Object(f.a)(this,e)}return Object(p.a)(e,[{key:"ue",value:function(e,t){this.ce(e,t),t.ae()}},{key:"ce",value:function(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(ze(e.integerValue));else if("doubleValue"in e){var n=ze(e.doubleValue);isNaN(n)?this.he(t,13):(this.he(t,15),Re(n)?t.le(0):t.le(n))}else if("timestampValue"in e){var r=e.timestampValue;this.he(t,20),"string"==typeof r?t.fe(r):(t.fe("".concat(r.seconds||"")),t.le(r.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(Ve(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){var i=e.geoPointValue;this.he(t,45),t.le(i.latitude||0),t.le(i.longitude||0)}else"mapValue"in e?ut(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):M()}},{key:"de",value:function(e,t){this.he(t,25),this.pe(e,t)}},{key:"pe",value:function(e,t){t.fe(e)}},{key:"ge",value:function(e,t){var n=e.fields||{};this.he(t,55);for(var r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];this.de(a,t),this.ce(n[a],t)}}},{key:"ye",value:function(e,t){var n=e.values||[];this.he(t,50);var r,i=Object(s.a)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.ce(a,t)}}catch(o){i.e(o)}finally{i.f()}}},{key:"me",value:function(e,t){var n=this;this.he(t,37),ne.fromName(e).path.forEach((function(e){n.he(t,60),n.pe(e,t)}))}},{key:"he",value:function(e,t){e.le(t)}},{key:"_e",value:function(e){e.le(2)}}]),e}();function na(e){if(0===e)return 8;var t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function ra(e){var t=64-function(e){for(var t=0,n=0;n<8;++n){var r=na(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}ta.Ie=new ta;var ia=function(){function e(){Object(f.a)(this,e),this.buffer=new Uint8Array(1024),this.position=0}return Object(p.a)(e,[{key:"Te",value:function(e){for(var t=e[Symbol.iterator](),n=t.next();!n.done;)this.Ee(n.value),n=t.next();this.Ae()}},{key:"Re",value:function(e){for(var t=e[Symbol.iterator](),n=t.next();!n.done;)this.be(n.value),n=t.next();this.Pe()}},{key:"ve",value:function(e){var t,n=Object(s.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.charCodeAt(0);if(i<128)this.Ee(i);else if(i<2048)this.Ee(960|i>>>6),this.Ee(128|63&i);else if(r<"\ud800"||"\udbff"<r)this.Ee(480|i>>>12),this.Ee(128|63&i>>>6),this.Ee(128|63&i);else{var a=r.codePointAt(0);this.Ee(240|a>>>18),this.Ee(128|63&a>>>12),this.Ee(128|63&a>>>6),this.Ee(128|63&a)}}}catch(o){n.e(o)}finally{n.f()}this.Ae()}},{key:"Ve",value:function(e){var t,n=Object(s.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.charCodeAt(0);if(i<128)this.be(i);else if(i<2048)this.be(960|i>>>6),this.be(128|63&i);else if(r<"\ud800"||"\udbff"<r)this.be(480|i>>>12),this.be(128|63&i>>>6),this.be(128|63&i);else{var a=r.codePointAt(0);this.be(240|a>>>18),this.be(128|63&a>>>12),this.be(128|63&a>>>6),this.be(128|63&a)}}}catch(o){n.e(o)}finally{n.f()}this.Pe()}},{key:"Se",value:function(e){var t=this.De(e),n=ra(t);this.Ce(1+n),this.buffer[this.position++]=255&n;for(var r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}},{key:"xe",value:function(e){var t=this.De(e),n=ra(t);this.Ce(1+n),this.buffer[this.position++]=~(255&n);for(var r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}},{key:"Ne",value:function(){this.ke(255),this.ke(255)}},{key:"Oe",value:function(){this.Me(255),this.Me(255)}},{key:"reset",value:function(){this.position=0}},{key:"seed",value:function(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}},{key:"Fe",value:function(){return this.buffer.slice(0,this.position)}},{key:"De",value:function(e){var t=function(e){var t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(var r=1;r<t.length;++r)t[r]^=n?255:0;return t}},{key:"Ee",value:function(e){var t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(t)}},{key:"be",value:function(e){var t=255&e;0===t?(this.Me(0),this.Me(255)):255===t?(this.Me(255),this.Me(0)):this.Me(e)}},{key:"Ae",value:function(){this.ke(0),this.ke(1)}},{key:"Pe",value:function(){this.Me(0),this.Me(1)}},{key:"ke",value:function(e){this.Ce(1),this.buffer[this.position++]=e}},{key:"Me",value:function(e){this.Ce(1),this.buffer[this.position++]=~e}},{key:"Ce",value:function(e){var t=e+this.position;if(!(t<=this.buffer.length)){var n=2*this.buffer.length;n<t&&(n=t);var r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}}]),e}(),aa=function(){function e(t){Object(f.a)(this,e),this.$e=t}return Object(p.a)(e,[{key:"we",value:function(e){this.$e.Te(e)}},{key:"fe",value:function(e){this.$e.ve(e)}},{key:"le",value:function(e){this.$e.Se(e)}},{key:"ae",value:function(){this.$e.Ne()}}]),e}(),oa=function(){function e(t){Object(f.a)(this,e),this.$e=t}return Object(p.a)(e,[{key:"we",value:function(e){this.$e.Re(e)}},{key:"fe",value:function(e){this.$e.Ve(e)}},{key:"le",value:function(e){this.$e.xe(e)}},{key:"ae",value:function(){this.$e.Oe()}}]),e}(),sa=function(){function e(){Object(f.a)(this,e),this.$e=new ia,this.Be=new aa(this.$e),this.Le=new oa(this.$e)}return Object(p.a)(e,[{key:"seed",value:function(e){this.$e.seed(e)}},{key:"qe",value:function(e){return 0===e?this.Be:this.Le}},{key:"Fe",value:function(){return this.$e.Fe()}},{key:"reset",value:function(){this.$e.reset()}}]),e}(),ua=function(){function e(t,n,r,i){Object(f.a)(this,e),this.indexId=t,this.documentKey=n,this.arrayValue=r,this.directionalValue=i}return Object(p.a)(e,[{key:"Ue",value:function(){var t=this.directionalValue.length,n=0===t||255===this.directionalValue[t-1]?t+1:t,r=new Uint8Array(n);return r.set(this.directionalValue,0),n!==t?r.set([0],this.directionalValue.length):++r[r.length-1],new e(this.indexId,this.documentKey,this.arrayValue,r)}}]),e}();function ca(e,t){var n=e.indexId-t.indexId;return 0!==n?n:0!==(n=la(e.arrayValue,t.arrayValue))?n:0!==(n=la(e.directionalValue,t.directionalValue))?n:ne.comparator(e.documentKey,t.documentKey)}function la(e,t){for(var n=0;n<e.length&&n<t.length;++n){var r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}var ha=function(){function e(t){Object(f.a)(this,e),this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment(),this.Ke=t.orderBy,this.Ge=[];var n,r=Object(s.a)(t.filters);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.isInequality()?this.Qe=i:this.Ge.push(i)}}catch(a){r.e(a)}finally{r.f()}}return Object(p.a)(e,[{key:"je",value:function(e){C(e.collectionGroup===this.collectionId);var t=ie(e);if(void 0!==t&&!this.We(t))return!1;for(var n=ae(e),r=0,i=0;r<n.length&&this.We(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Qe){var a=n[r];if(!this.ze(this.Qe,a)||!this.He(this.Ke[i++],a))return!1;++r}for(;r<n.length;++r){var o=n[r];if(i>=this.Ke.length||!this.He(this.Ke[i++],o))return!1}return!0}},{key:"We",value:function(e){var t,n=Object(s.a)(this.Ge);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(this.ze(r,e))return!0}}catch(i){n.e(i)}finally{n.f()}return!1}},{key:"ze",value:function(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}},{key:"He",value:function(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}]),e}();function da(e){var t,n;if(C(e instanceof gt||e instanceof yt),e instanceof gt){if(e instanceof Dt){var r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((function(t){return gt.create(e.field,"==",t)})))||[];return yt.create(r,"or")}return e}var i=e.filters.map((function(e){return da(e)}));return yt.create(i,e.op)}function fa(e){if(0===e.getFilters().length)return[];var t=ga(da(e));return C(ma(t)),pa(t)||va(t)?[t]:t.getFilters()}function pa(e){return e instanceof gt}function va(e){return e instanceof yt&&xt(e)}function ma(e){return pa(e)||va(e)||function(e){if(e instanceof yt&&wt(e)){var t,n=Object(s.a)(e.getFilters());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!pa(r)&&!va(r))return!1}}catch(i){n.e(i)}finally{n.f()}return!0}return!1}(e)}function ga(e){if(C(e instanceof gt||e instanceof yt),e instanceof gt)return e;if(1===e.filters.length)return ga(e.filters[0]);var t=e.filters.map((function(e){return ga(e)})),n=yt.create(t,e.op);return ma(n=wa(n))?n:(C(n instanceof yt),C(bt(n)),C(n.filters.length>1),n.filters.reduce((function(e,t){return ya(e,t)})))}function ya(e,t){var n;return C(e instanceof gt||e instanceof yt),C(t instanceof gt||t instanceof yt),n=e instanceof gt?t instanceof gt?function(e,t){return yt.create([e,t],"and")}(e,t):ba(e,t):t instanceof gt?ba(t,e):function(e,t){if(C(e.filters.length>0&&t.filters.length>0),bt(e)&&bt(t))return St(e,t.getFilters());var n=wt(e)?e:t,r=wt(e)?t:e,i=n.filters.map((function(e){return ya(e,r)}));return yt.create(i,"or")}(e,t),wa(n)}function ba(e,t){if(bt(t))return St(t,e.getFilters());var n=t.filters.map((function(t){return ya(e,t)}));return yt.create(n,"or")}function wa(e){if(C(e instanceof gt||e instanceof yt),e instanceof gt)return e;var t=e.getFilters();if(1===t.length)return wa(t[0]);if(Ot(e))return e;var n=t.map((function(e){return wa(e)})),r=[];return n.forEach((function(t){t instanceof gt?r.push(t):t instanceof yt&&(t.op===e.op?r.push.apply(r,Object(d.a)(t.filters)):r.push(t))})),1===r.length?r[0]:yt.create(r,e.op)}var xa=function(){function e(){Object(f.a)(this,e),this.Je=new Oa}return Object(p.a)(e,[{key:"addToCollectionParentIndex",value:function(e,t){return this.Je.add(t),me.resolve()}},{key:"getCollectionParents",value:function(e,t){return me.resolve(this.Je.getEntries(t))}},{key:"addFieldIndex",value:function(e,t){return me.resolve()}},{key:"deleteFieldIndex",value:function(e,t){return me.resolve()}},{key:"getDocumentsMatchingTarget",value:function(e,t){return me.resolve(null)}},{key:"getIndexType",value:function(e,t){return me.resolve(0)}},{key:"getFieldIndexes",value:function(e,t){return me.resolve([])}},{key:"getNextCollectionGroupToUpdate",value:function(e){return me.resolve(null)}},{key:"getMinOffset",value:function(e,t){return me.resolve(le.min())}},{key:"getMinOffsetFromCollectionGroup",value:function(e,t){return me.resolve(le.min())}},{key:"updateCollectionGroup",value:function(e,t,n){return me.resolve()}},{key:"updateIndexEntries",value:function(e,t){return me.resolve()}}]),e}(),Oa=function(){function e(){Object(f.a)(this,e),this.index={}}return Object(p.a)(e,[{key:"add",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Ut($.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}},{key:"has",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}},{key:"getEntries",value:function(e){return(this.index[e]||new Ut($.comparator)).toArray()}}]),e}(),ka=new Uint8Array(0),_a=function(){function e(t,n){Object(f.a)(this,e),this.user=t,this.databaseId=n,this.Ye=new Oa,this.Xe=new rr((function(e){return Kt(e)}),(function(e,t){return Qt(e,t)})),this.uid=t.uid||""}return Object(p.a)(e,[{key:"addToCollectionParentIndex",value:function(e,t){var n=this;if(!this.Ye.has(t)){var r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener((function(){n.Ye.add(t)}));var a={collectionId:r,parent:ai(i)};return Sa(e).put(a)}return me.resolve()}},{key:"getCollectionParents",value:function(e,t){var n=[],r=IDBKeyRange.bound([t,""],[K(t),""],!1,!0);return Sa(e).W(r).next((function(e){var r,i=Object(s.a)(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.collectionId!==t)break;n.push(ui(a.parent))}}catch(o){i.e(o)}finally{i.f()}return n}))}},{key:"addFieldIndex",value:function(e,t){var n=this,r=Aa(e),i=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((function(e){return[e.fieldPath.canonicalString(),e.kind]}))}}(t);delete i.indexId;var a=r.add(i);if(t.indexState){var o=ja(e);return a.next((function(e){o.put(Ki(e,n.user,t.indexState.sequenceNumber,t.indexState.offset))}))}return a.next()}},{key:"deleteFieldIndex",value:function(e,t){var n=Aa(e),r=ja(e),i=Ea(e);return n.delete(t.indexId).next((function(){return r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))})).next((function(){return i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))}))}},{key:"getDocumentsMatchingTarget",value:function(e,t){var n=this,r=Ea(e),i=!0,a=new Map;return me.forEach(this.Ze(t),(function(t){return n.tn(e,t).next((function(e){i&&(i=!!e),a.set(t,e)}))})).next((function(){if(i){var e=pr(),o=[];return me.forEach(a,(function(i,a){var u;E("IndexedDbIndexManager","Using index ".concat((u=i,"id=".concat(u.indexId,"|cg=").concat(u.collectionGroup,"|f=").concat(u.fields.map((function(e){return"".concat(e.fieldPath,":").concat(e.kind)})).join(",")))," to execute ").concat(Kt(t)));var c=function(e,t){var n=ie(t);if(void 0===n)return null;var r,i=Object(s.a)(Jt(e,n.fieldPath));try{for(i.s();!(r=i.n()).done;){var a=r.value;switch(a.op){case"array-contains-any":return a.value.arrayValue.values||[];case"array-contains":return[a.value]}}}catch(o){i.e(o)}finally{i.f()}return null}(a,i),l=function(e,t){var n,r=new Map,i=Object(s.a)(ae(t));try{for(i.s();!(n=i.n()).done;){var a,o=n.value,u=Object(s.a)(Jt(e,o.fieldPath));try{for(u.s();!(a=u.n()).done;){var c=a.value;switch(c.op){case"==":case"in":r.set(o.fieldPath.canonicalString(),c.value);break;case"not-in":case"!=":return r.set(o.fieldPath.canonicalString(),c.value),Array.from(r.values())}}}catch(l){u.e(l)}finally{u.f()}}}catch(l){i.e(l)}finally{i.f()}return null}(a,i),h=function(e,t){var n,r=[],i=!0,a=Object(s.a)(ae(t));try{for(a.s();!(n=a.n()).done;){var o=n.value,u=0===o.kind?$t(e,o.fieldPath,e.startAt):en(e,o.fieldPath,e.startAt);r.push(u.value),i&&(i=u.inclusive)}}catch(c){a.e(c)}finally{a.f()}return new ft(r,i)}(a,i),d=function(e,t){var n,r=[],i=!0,a=Object(s.a)(ae(t));try{for(a.s();!(n=a.n()).done;){var o=n.value,u=0===o.kind?en(e,o.fieldPath,e.endAt):$t(e,o.fieldPath,e.endAt);r.push(u.value),i&&(i=u.inclusive)}}catch(c){a.e(c)}finally{a.f()}return new ft(r,i)}(a,i),f=n.en(i,a,h),p=n.en(i,a,d),v=n.nn(i,a,l),m=n.sn(i.indexId,c,f,h.inclusive,p,d.inclusive,v);return me.forEach(m,(function(n){return r.J(n,t.limit).next((function(t){t.forEach((function(t){var n=ne.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),o.push(n))}))}))}))})).next((function(){return o}))}return me.resolve(null)}))}},{key:"Ze",value:function(e){var t=this.Xe.get(e);return t||(t=0===e.filters.length?[e]:fa(yt.create(e.filters,"and")).map((function(t){return Xt(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)})),this.Xe.set(e,t),t)}},{key:"sn",value:function(e,t,n,r,i,a,o){for(var s=this,u=(null!=t?t.length:1)*Math.max(n.length,i.length),c=u/(null!=t?t.length:1),l=[],h=function(){var u=t?s.rn(t[f/c]):ka,h=s.on(e,u,n[f%c],r),p=s.un(e,u,i[f%c],a),v=o.map((function(t){return s.on(e,u,t,!0)}));l.push.apply(l,Object(d.a)(s.createRange(h,p,v)))},f=0;f<u;++f)h();return l}},{key:"on",value:function(e,t,n,r){var i=new ua(e,ne.empty(),t,n);return r?i:i.Ue()}},{key:"un",value:function(e,t,n,r){var i=new ua(e,ne.empty(),t,n);return r?i.Ue():i}},{key:"tn",value:function(e,t){var n=new ha(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((function(e){var t,r=null,i=Object(s.a)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;n.je(a)&&(!r||a.fields.length>r.fields.length)&&(r=a)}}catch(o){i.e(o)}finally{i.f()}return r}))}},{key:"getIndexType",value:function(e,t){var n=this,r=2,i=this.Ze(t);return me.forEach(i,(function(t){return n.tn(e,t).next((function(e){e?0!==r&&e.fields.length<function(e){var t,n=new Ut(te.comparator),r=!1,i=Object(s.a)(e.filters);try{for(i.s();!(t=i.n()).done;){var a,o=t.value,u=Object(s.a)(o.getFlattenedFilters());try{for(u.s();!(a=u.n()).done;){var c=a.value;c.field.isKeyField()||("array-contains"===c.op||"array-contains-any"===c.op?r=!0:n=n.add(c.field))}}catch(f){u.e(f)}finally{u.f()}}}catch(f){i.e(f)}finally{i.f()}var l,h=Object(s.a)(e.orderBy);try{for(h.s();!(l=h.n()).done;){var d=l.value;d.field.isKeyField()||(n=n.add(d.field))}}catch(f){h.e(f)}finally{h.f()}return n.size+(r?1:0)}(t)&&(r=1):r=0}))})).next((function(){return function(e){return null!==e.limit}(t)&&i.length>1&&2===r?1:r}))}},{key:"cn",value:function(e,t){var n,r=new sa,i=Object(s.a)(ae(e));try{for(i.s();!(n=i.n()).done;){var a=n.value,o=t.data.field(a.fieldPath);if(null==o)return null;var u=r.qe(a.kind);ta.Ie.ue(o,u)}}catch(c){i.e(c)}finally{i.f()}return r.Fe()}},{key:"rn",value:function(e){var t=new sa;return ta.Ie.ue(e,t.qe(0)),t.Fe()}},{key:"an",value:function(e,t){var n=new sa;return ta.Ie.ue(tt(this.databaseId,t),n.qe(function(e){var t=ae(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Fe()}},{key:"nn",value:function(e,t,n){if(null===n)return[];var r=[];r.push(new sa);var i,a=0,o=Object(s.a)(ae(e));try{for(o.s();!(i=o.n()).done;){var u,c=i.value,l=n[a++],h=Object(s.a)(r);try{for(h.s();!(u=h.n()).done;){var d=u.value;if(this.hn(t,c.fieldPath)&&rt(l))r=this.ln(r,c,l);else{var f=d.qe(c.kind);ta.Ie.ue(l,f)}}}catch(p){h.e(p)}finally{h.f()}}}catch(p){o.e(p)}finally{o.f()}return this.fn(r)}},{key:"en",value:function(e,t,n){return this.nn(e,t,n.position)}},{key:"fn",value:function(e){for(var t=[],n=0;n<e.length;++n)t[n]=e[n].Fe();return t}},{key:"ln",value:function(e,t,n){var r,i=Object(d.a)(e),a=[],o=Object(s.a)(n.arrayValue.values||[]);try{for(o.s();!(r=o.n()).done;){var u,c=r.value,l=Object(s.a)(i);try{for(l.s();!(u=l.n()).done;){var h=u.value,f=new sa;f.seed(h.Fe()),ta.Ie.ue(c,f.qe(t.kind)),a.push(f)}}catch(p){l.e(p)}finally{l.f()}}}catch(p){o.e(p)}finally{o.f()}return a}},{key:"hn",value:function(e,t){return!!e.filters.find((function(e){return e instanceof gt&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)}))}},{key:"getFieldIndexes",value:function(e,t){var n=this,r=Aa(e),i=ja(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next((function(e){var t=[];return me.forEach(e,(function(e){return i.get([e.indexId,n.uid]).next((function(n){t.push(function(e,t){var n=t?new se(t.sequenceNumber,new le(Vi(t.readTime),new ne(ui(t.documentKey)),t.largestBatchId)):se.empty(),r=e.fields.map((function(e){var t=Object(o.a)(e,2),n=t[0],r=t[1];return new oe(te.fromServerFormat(n),r)}));return new re(e.indexId,e.collectionGroup,r,n)}(e,n))}))})).next((function(){return t}))}))}},{key:"getNextCollectionGroupToUpdate",value:function(e){return this.getFieldIndexes(e).next((function(e){return 0===e.length?null:(e.sort((function(e,t){var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Y(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)}))}},{key:"updateCollectionGroup",value:function(e,t,n){var r=this,i=Aa(e),a=ja(e);return this.dn(e).next((function(e){return i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((function(t){return me.forEach(t,(function(t){return a.put(Ki(t.indexId,r.user,e,n))}))}))}))}},{key:"updateIndexEntries",value:function(e,t){var n=this,r=new Map;return me.forEach(t,(function(t,i){var a=r.get(t.collectionGroup);return(a?me.resolve(a):n.getFieldIndexes(e,t.collectionGroup)).next((function(a){return r.set(t.collectionGroup,a),me.forEach(a,(function(r){return n._n(e,t,r).next((function(t){var a=n.wn(i,r);return t.isEqual(a)?me.resolve():n.mn(e,i,r,t,a)}))}))}))}))}},{key:"gn",value:function(e,t,n,r){return Ea(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.an(n,t.key),documentKey:t.key.path.toArray()})}},{key:"yn",value:function(e,t,n,r){return Ea(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.an(n,t.key),t.key.path.toArray()])}},{key:"_n",value:function(e,t,n){var r=Ea(e),i=new Ut(ca);return r.Z({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.an(n,t)])},(function(e,r){i=i.add(new ua(n.indexId,t,r.arrayValue,r.directionalValue))})).next((function(){return i}))}},{key:"wn",value:function(e,t){var n=new Ut(ca),r=this.cn(t,e);if(null==r)return n;var i=ie(t);if(null!=i){var a=e.data.field(i.fieldPath);if(rt(a)){var o,u=Object(s.a)(a.arrayValue.values||[]);try{for(u.s();!(o=u.n()).done;){var c=o.value;n=n.add(new ua(t.indexId,e.key,this.rn(c),r))}}catch(l){u.e(l)}finally{u.f()}}}else n=n.add(new ua(t.indexId,e.key,ka,r));return n}},{key:"mn",value:function(e,t,n,r,i){var a=this;E("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);var o=[];return function(e,t,n,r,i){for(var a=e.getIterator(),o=t.getIterator(),s=Vt(a),u=Vt(o);s||u;){var c=!1,l=!1;if(s&&u){var h=n(s,u);h<0?l=!0:h>0&&(c=!0)}else null!=s?l=!0:c=!0;c?(r(u),u=Vt(o)):l?(i(s),s=Vt(a)):(s=Vt(a),u=Vt(o))}}(r,i,ca,(function(r){o.push(a.gn(e,t,n,r))}),(function(r){o.push(a.yn(e,t,n,r))})),me.waitFor(o)}},{key:"dn",value:function(e){var t=1;return ja(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(function(e,n,r){r.done(),t=n.sequenceNumber+1})).next((function(){return t}))}},{key:"createRange",value:function(e,t,n){n=n.sort((function(e,t){return ca(e,t)})).filter((function(e,t,n){return!t||0!==ca(e,n[t-1])}));var r=[];r.push(e);var i,a=Object(s.a)(n);try{for(a.s();!(i=a.n()).done;){var o=i.value,u=ca(o,e),c=ca(o,t);if(0===u)r[0]=e.Ue();else if(u>0&&c<0)r.push(o),r.push(o.Ue());else if(c>0)break}}catch(p){a.e(p)}finally{a.f()}r.push(t);for(var l=[],h=0;h<r.length;h+=2){if(this.pn(r[h],r[h+1]))return[];var d=[r[h].indexId,this.uid,r[h].arrayValue,r[h].directionalValue,ka,[]],f=[r[h+1].indexId,this.uid,r[h+1].arrayValue,r[h+1].directionalValue,ka,[]];l.push(IDBKeyRange.bound(d,f))}return l}},{key:"pn",value:function(e,t){return ca(e,t)>0}},{key:"getMinOffsetFromCollectionGroup",value:function(e,t){return this.getFieldIndexes(e,t).next(Ta)}},{key:"getMinOffset",value:function(e,t){var n=this;return me.mapArray(this.Ze(t),(function(t){return n.tn(e,t).next((function(e){return e||M()}))})).next(Ta)}}]),e}();function Sa(e){return Ii(e,"collectionParents")}function Ea(e){return Ii(e,"indexEntries")}function Aa(e){return Ii(e,"indexConfiguration")}function ja(e){return Ii(e,"indexState")}function Ta(e){C(0!==e.length);for(var t=e[0].indexState.offset,n=t.largestBatchId,r=1;r<e.length;r++){var i=e[r].indexState.offset;he(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new le(t.readTime,t.documentKey,n)}var Ma={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ca=function(){function e(t,n,r){Object(f.a)(this,e),this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return Object(p.a)(e,null,[{key:"withCacheSize",value:function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),e}();function Da(e,t,n){var r=e.store("mutations"),i=e.store("documentMutations"),a=[],o=IDBKeyRange.only(n.batchId),u=0,c=r.Z({range:o},(function(e,t,n){return u++,n.delete()}));a.push(c.next((function(){C(1===u)})));var l,h=[],d=Object(s.a)(n.mutations);try{for(d.s();!(l=d.n()).done;){var f=l.value,p=hi(t,f.key.path,n.batchId);a.push(i.delete(p)),h.push(f.key)}}catch(v){d.e(v)}finally{d.f()}return me.waitFor(a).next((function(){return h}))}function Ia(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw M();t=e.noDocument}return JSON.stringify(t).length}Ca.DEFAULT_COLLECTION_PERCENTILE=10,Ca.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ca.DEFAULT=new Ca(41943040,Ca.DEFAULT_COLLECTION_PERCENTILE,Ca.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ca.DISABLED=new Ca(-1,0,0);var Pa=function(){function e(t,n,r,i){Object(f.a)(this,e),this.userId=t,this.yt=n,this.indexManager=r,this.referenceDelegate=i,this.In={}}return Object(p.a)(e,[{key:"checkEmpty",value:function(e){var t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return La(e).Z({index:"userMutationsIndex",range:n},(function(e,n,r){t=!1,r.done()})).next((function(){return t}))}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this,a=Na(e),o=La(e);return o.add({}).next((function(u){C("number"==typeof u);var c,l=new Pi(u,t,n,r),h=function(e,t,n){var r=n.baseMutations.map((function(t){return Wr(e.ie,t)})),i=n.mutations.map((function(t){return Wr(e.ie,t)}));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(i.yt,i.userId,l),d=[],f=new Ut((function(e,t){return Y(e.canonicalString(),t.canonicalString())})),p=Object(s.a)(r);try{for(p.s();!(c=p.n()).done;){var v=c.value,m=hi(i.userId,v.key.path,u);f=f.add(v.key.path.popLast()),d.push(o.put(h)),d.push(a.put(m,di))}}catch(g){p.e(g)}finally{p.f()}return f.forEach((function(t){d.push(i.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((function(){i.In[u]=l.keys()})),me.waitFor(d).next((function(){return l}))}))}},{key:"lookupMutationBatch",value:function(e,t){var n=this;return La(e).get(t).next((function(e){return e?(C(e.userId===n.userId),Gi(n.yt,e)):null}))}},{key:"Tn",value:function(e,t){var n=this;return this.In[t]?me.resolve(this.In[t]):this.lookupMutationBatch(e,t).next((function(e){if(e){var r=e.keys();return n.In[t]=r,r}return null}))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=this,r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),a=null;return La(e).Z({index:"userMutationsIndex",range:i},(function(e,t,i){t.userId===n.userId&&(C(t.batchId>=r),a=Gi(n.yt,t)),i.done()})).next((function(){return a}))}},{key:"getHighestUnacknowledgedBatchId",value:function(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return La(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(function(e,t,r){n=t.batchId,r.done()})).next((function(){return n}))}},{key:"getAllMutationBatches",value:function(e){var t=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return La(e).W("userMutationsIndex",n).next((function(e){return e.map((function(e){return Gi(t.yt,e)}))}))}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=li(this.userId,t.path),i=IDBKeyRange.lowerBound(r),a=[];return Na(e).Z({range:i},(function(r,i,s){var u=Object(o.a)(r,3),c=u[0],l=u[1],h=u[2],d=ui(l);if(c===n.userId&&t.path.isEqual(d))return La(e).get(h).next((function(e){if(!e)throw M();C(e.userId===n.userId),a.push(Gi(n.yt,e))}));s.done()})).next((function(){return a}))}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new Ut(Y),i=[];return t.forEach((function(t){var a=li(n.userId,t.path),s=IDBKeyRange.lowerBound(a),u=Na(e).Z({range:s},(function(e,i,a){var s=Object(o.a)(e,3),u=s[0],c=s[1],l=s[2],h=ui(c);u===n.userId&&t.path.isEqual(h)?r=r.add(l):a.done()}));i.push(u)})),me.waitFor(i).next((function(){return n.En(e,r)}))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=this,r=t.path,i=r.length+1,a=li(this.userId,r),s=IDBKeyRange.lowerBound(a),u=new Ut(Y);return Na(e).Z({range:s},(function(e,t,a){var s=Object(o.a)(e,3),c=s[0],l=s[1],h=s[2],d=ui(l);c===n.userId&&r.isPrefixOf(d)?d.length===i&&(u=u.add(h)):a.done()})).next((function(){return n.En(e,u)}))}},{key:"En",value:function(e,t){var n=this,r=[],i=[];return t.forEach((function(t){i.push(La(e).get(t).next((function(e){if(null===e)throw M();C(e.userId===n.userId),r.push(Gi(n.yt,e))})))})),me.waitFor(i).next((function(){return r}))}},{key:"removeMutationBatch",value:function(e,t){var n=this;return Da(e.se,this.userId,t).next((function(r){return e.addOnCommittedListener((function(){n.An(t.batchId)})),me.forEach(r,(function(t){return n.referenceDelegate.markPotentiallyOrphaned(e,t)}))}))}},{key:"An",value:function(e){delete this.In[e]}},{key:"performConsistencyCheck",value:function(e){var t=this;return this.checkEmpty(e).next((function(n){if(!n)return me.resolve();var r=IDBKeyRange.lowerBound([t.userId]),i=[];return Na(e).Z({range:r},(function(e,n,r){if(e[0]===t.userId){var a=ui(e[1]);i.push(a)}else r.done()})).next((function(){C(0===i.length)}))}))}},{key:"containsKey",value:function(e,t){return Ra(e,this.userId,t)}},{key:"Rn",value:function(e){var t=this;return Ba(e).get(this.userId).next((function(e){return e||{userId:t.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}}))}}],[{key:"re",value:function(t,n,r,i){return C(""!==t.uid),new e(t.isAuthenticated()?t.uid:"",n,r,i)}}]),e}();function Ra(e,t,n){var r=li(t,n.path),i=r[1],a=IDBKeyRange.lowerBound(r),s=!1;return Na(e).Z({range:a,X:!0},(function(e,n,r){var a=Object(o.a)(e,3),u=a[0],c=a[1];a[2];u===t&&c===i&&(s=!0),r.done()})).next((function(){return s}))}function La(e){return Ii(e,"mutations")}function Na(e){return Ii(e,"documentMutations")}function Ba(e){return Ii(e,"mutationQueues")}var Fa=function(){function e(t){Object(f.a)(this,e),this.bn=t}return Object(p.a)(e,[{key:"next",value:function(){return this.bn+=2,this.bn}}],[{key:"Pn",value:function(){return new e(0)}},{key:"vn",value:function(){return new e(-1)}}]),e}(),Ua=function(){function e(t,n){Object(f.a)(this,e),this.referenceDelegate=t,this.yt=n}return Object(p.a)(e,[{key:"allocateTargetId",value:function(e){var t=this;return this.Vn(e).next((function(n){var r=new Fa(n.highestTargetId);return n.highestTargetId=r.next(),t.Sn(e,n).next((function(){return n.highestTargetId}))}))}},{key:"getLastRemoteSnapshotVersion",value:function(e){return this.Vn(e).next((function(e){return Z.fromTimestamp(new Q(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))}))}},{key:"getHighestSequenceNumber",value:function(e){return this.Vn(e).next((function(e){return e.highestListenSequenceNumber}))}},{key:"setTargetsMetadata",value:function(e,t,n){var r=this;return this.Vn(e).next((function(i){return i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),r.Sn(e,i)}))}},{key:"addTargetData",value:function(e,t){var n=this;return this.Dn(e,t).next((function(){return n.Vn(e).next((function(r){return r.targetCount+=1,n.Cn(t,r),n.Sn(e,r)}))}))}},{key:"updateTargetData",value:function(e,t){return this.Dn(e,t)}},{key:"removeTargetData",value:function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next((function(){return za(e).delete(t.targetId)})).next((function(){return n.Vn(e)})).next((function(t){return C(t.targetCount>0),t.targetCount-=1,n.Sn(e,t)}))}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return za(e).Z((function(o,s){var u=Hi(s);u.sequenceNumber<=t&&null===n.get(u.targetId)&&(i++,a.push(r.removeTargetData(e,u)))})).next((function(){return me.waitFor(a)})).next((function(){return i}))}},{key:"forEachTarget",value:function(e,t){return za(e).Z((function(e,n){var r=Hi(n);t(r)}))}},{key:"Vn",value:function(e){return Va(e).get("targetGlobalKey").next((function(e){return C(null!==e),e}))}},{key:"Sn",value:function(e,t){return Va(e).put("targetGlobalKey",t)}},{key:"Dn",value:function(e,t){return za(e).put(Wi(this.yt,t))}},{key:"Cn",value:function(e,t){var n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}},{key:"getTargetCount",value:function(e){return this.Vn(e).next((function(e){return e.targetCount}))}},{key:"getTargetData",value:function(e,t){var n=Kt(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return za(e).Z({range:r,index:"queryTargetsIndex"},(function(e,n,r){var a=Hi(n);Qt(t,a.target)&&(i=a,r.done())})).next((function(){return i}))}},{key:"addMatchingKeys",value:function(e,t,n){var r=this,i=[],a=Ga(e);return t.forEach((function(t){var o=ai(t.path);i.push(a.put({targetId:n,path:o})),i.push(r.referenceDelegate.addReference(e,n,t))})),me.waitFor(i)}},{key:"removeMatchingKeys",value:function(e,t,n){var r=this,i=Ga(e);return me.forEach(t,(function(t){var a=ai(t.path);return me.waitFor([i.delete([n,a]),r.referenceDelegate.removeReference(e,n,t)])}))}},{key:"removeMatchingKeysForTargetId",value:function(e,t){var n=Ga(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Ga(e),i=pr();return r.Z({range:n,X:!0},(function(e,t,n){var r=ui(e[1]),a=new ne(r);i=i.add(a)})).next((function(){return i}))}},{key:"containsKey",value:function(e,t){var n=ai(t.path),r=IDBKeyRange.bound([n],[K(n)],!1,!0),i=0;return Ga(e).Z({index:"documentTargetsIndex",X:!0,range:r},(function(e,t,n){var r=Object(o.a)(e,2),a=r[0];r[1];0!==a&&(i++,n.done())})).next((function(){return i>0}))}},{key:"ne",value:function(e,t){return za(e).get(t).next((function(e){return e?Hi(e):null}))}}]),e}();function za(e){return Ii(e,"targets")}function Va(e){return Ii(e,"targetGlobal")}function Ga(e){return Ii(e,"targetDocuments")}function Ha(e,t){var n=Object(o.a)(e,2),r=n[0],i=n[1],a=Object(o.a)(t,2),s=a[0],u=a[1],c=Y(r,s);return 0===c?Y(i,u):c}var Wa=function(){function e(t){Object(f.a)(this,e),this.xn=t,this.buffer=new Ut(Ha),this.Nn=0}return Object(p.a)(e,[{key:"kn",value:function(){return++this.Nn}},{key:"On",value:function(e){var t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{var n=this.buffer.last();Ha(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}},{key:"maxValue",get:function(){return this.buffer.last()[0]}}]),e}(),qa=function(){function e(t,n,r){Object(f.a)(this,e),this.garbageCollector=t,this.asyncQueue=n,this.localStore=r,this.Mn=null}return Object(p.a)(e,[{key:"start",value:function(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}},{key:"stop",value:function(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}},{key:"started",get:function(){return null!==this.Mn}},{key:"Fn",value:function(e){var t=this;E("LruGarbageCollector","Garbage collection scheduled in ".concat(e,"ms")),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,Object(c.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.Mn=null,e.prev=1,e.next=4,t.localStore.collectGarbage(t.garbageCollector);case 4:e.next=14;break;case 6:if(e.prev=6,e.t0=e.catch(1),!xe(e.t0)){e.next=12;break}E("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e.t0),e.next=14;break;case 12:return e.next=14,pe(e.t0);case 14:return e.next=16,t.Fn(3e5);case 16:case"end":return e.stop()}}),e,null,[[1,6]])}))))}}]),e}(),Ya=function(){function e(t,n){Object(f.a)(this,e),this.$n=t,this.params=n}return Object(p.a)(e,[{key:"calculateTargetCount",value:function(e,t){return this.$n.Bn(e).next((function(e){return Math.floor(t/100*e)}))}},{key:"nthSequenceNumber",value:function(e,t){var n=this;if(0===t)return me.resolve(je.at);var r=new Wa(t);return this.$n.forEachTarget(e,(function(e){return r.On(e.sequenceNumber)})).next((function(){return n.$n.Ln(e,(function(e){return r.On(e)}))})).next((function(){return r.maxValue}))}},{key:"removeTargets",value:function(e,t,n){return this.$n.removeTargets(e,t,n)}},{key:"removeOrphanedDocuments",value:function(e,t){return this.$n.removeOrphanedDocuments(e,t)}},{key:"collect",value:function(e,t){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(E("LruGarbageCollector","Garbage collection skipped; disabled"),me.resolve(Ma)):this.getCacheSize(e).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(E("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(r," is lower than threshold ").concat(n.params.cacheSizeCollectionThreshold)),Ma):n.qn(e,t)}))}},{key:"getCacheSize",value:function(e){return this.$n.getCacheSize(e)}},{key:"qn",value:function(e,t){var n,r,i,a,o,s,u,c=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((function(t){return t>c.params.maximumSequenceNumbersToCollect?(E("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(c.params.maximumSequenceNumbersToCollect," from ").concat(t)),r=c.params.maximumSequenceNumbersToCollect):r=t,a=Date.now(),c.nthSequenceNumber(e,r)})).next((function(r){return n=r,o=Date.now(),c.removeTargets(e,n,t)})).next((function(t){return i=t,s=Date.now(),c.removeOrphanedDocuments(e,n)})).next((function(e){return u=Date.now(),_()<=g.a.DEBUG&&E("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(a-l,"ms\n\tDetermined least recently used ").concat(r," in ")+(o-a)+"ms\n"+"\tRemoved ".concat(i," targets in ")+(s-o)+"ms\n"+"\tRemoved ".concat(e," documents in ")+(u-s)+"ms\n"+"Total Duration: ".concat(u-l,"ms")),me.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})}))}}]),e}(),Xa=function(){function e(t,n){Object(f.a)(this,e),this.db=t,this.garbageCollector=function(e,t){return new Ya(e,t)}(this,n)}return Object(p.a)(e,[{key:"Bn",value:function(e){var t=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next((function(e){return t.next((function(t){return e+t}))}))}},{key:"Un",value:function(e){var t=0;return this.Ln(e,(function(e){t++})).next((function(){return t}))}},{key:"forEachTarget",value:function(e,t){return this.db.getTargetCache().forEachTarget(e,t)}},{key:"Ln",value:function(e,t){return this.Kn(e,(function(e,n){return t(n)}))}},{key:"addReference",value:function(e,t,n){return Ka(e,n)}},{key:"removeReference",value:function(e,t,n){return Ka(e,n)}},{key:"removeTargets",value:function(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}},{key:"markPotentiallyOrphaned",value:function(e,t){return Ka(e,t)}},{key:"Gn",value:function(e,t){return function(e,t){var n=!1;return Ba(e).tt((function(r){return Ra(e,r,t).next((function(e){return e&&(n=!0),me.resolve(!e)}))})).next((function(){return n}))}(e,t)}},{key:"removeOrphanedDocuments",value:function(e,t){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],a=0;return this.Kn(e,(function(o,s){if(s<=t){var u=n.Gn(e,o).next((function(t){if(!t)return a++,r.getEntry(e,o).next((function(){return r.removeEntry(o,Z.min()),Ga(e).delete([0,ai(o.path)])}))}));i.push(u)}})).next((function(){return me.waitFor(i)})).next((function(){return r.apply(e)})).next((function(){return a}))}},{key:"removeTarget",value:function(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}},{key:"updateLimboDocument",value:function(e,t){return Ka(e,t)}},{key:"Kn",value:function(e,t){var n,r=Ga(e),i=je.at;return r.Z({index:"documentTargetsIndex"},(function(e,r){var a=Object(o.a)(e,2),s=a[0],u=(a[1],r.path),c=r.sequenceNumber;0===s?(i!==je.at&&t(new ne(ui(n)),i),i=c,n=u):i=je.at})).next((function(){i!==je.at&&t(new ne(ui(n)),i)}))}},{key:"getCacheSize",value:function(e){return this.db.getRemoteDocumentCache().getSize(e)}}]),e}();function Ka(e,t){return Ga(e).put(function(e,t){return{targetId:0,path:ai(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}var Qa=function(){function e(){Object(f.a)(this,e),this.changes=new rr((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),this.changesApplied=!1}return Object(p.a)(e,[{key:"addEntry",value:function(e){this.assertNotApplied(),this.changes.set(e.key,e)}},{key:"removeEntry",value:function(e,t){this.assertNotApplied(),this.changes.set(e,qt.newInvalidDocument(e).setReadTime(t))}},{key:"getEntry",value:function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?me.resolve(n):this.getFromCache(e,t)}},{key:"getEntries",value:function(e,t){return this.getAllFromCache(e,t)}},{key:"apply",value:function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:"assertNotApplied",value:function(){}}]),e}(),Za=function(){function e(t){Object(f.a)(this,e),this.yt=t}return Object(p.a)(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t,n){return to(e).put(n)}},{key:"removeEntry",value:function(e,t,n){return to(e).delete(function(e,t){var n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Ui(t),n[n.length-1]]}(t,n))}},{key:"updateMetadata",value:function(e,t){var n=this;return this.getMetadata(e).next((function(r){return r.byteSize+=t,n.Qn(e,r)}))}},{key:"getEntry",value:function(e,t){var n=this,r=qt.newInvalidDocument(t);return to(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(no(t))},(function(e,i){r=n.jn(t,i)})).next((function(){return r}))}},{key:"Wn",value:function(e,t){var n=this,r={size:0,document:qt.newInvalidDocument(t)};return to(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(no(t))},(function(e,i){r={document:n.jn(t,i),size:Ia(i)}})).next((function(){return r}))}},{key:"getEntries",value:function(e,t){var n=this,r=ar();return this.zn(e,t,(function(e,t){var i=n.jn(e,t);r=r.insert(e,i)})).next((function(){return r}))}},{key:"Hn",value:function(e,t){var n=this,r=ar(),i=new Nt(ne.comparator);return this.zn(e,t,(function(e,t){var a=n.jn(e,t);r=r.insert(e,a),i=i.insert(e,Ia(t))})).next((function(){return{documents:r,Jn:i}}))}},{key:"zn",value:function(e,t,n){if(t.isEmpty())return me.resolve();var r=new Ut(io);t.forEach((function(e){return r=r.add(e)}));var i=IDBKeyRange.bound(no(r.first()),no(r.last())),a=r.getIterator(),o=a.getNext();return to(e).Z({index:"documentKeyIndex",range:i},(function(e,t,r){for(var i=ne.fromSegments([].concat(Object(d.a)(t.prefixPath),[t.collectionGroup,t.documentId]));o&&io(o,i)<0;)n(o,null),o=a.getNext();o&&o.isEqual(i)&&(n(o,t),o=a.hasNext()?a.getNext():null),o?r.j(no(o)):r.done()})).next((function(){for(;o;)n(o,null),o=a.hasNext()?a.getNext():null}))}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){var i=this,a=t.path,o=[a.popLast().toArray(),a.lastSegment(),Ui(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],u=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return to(e).W(IDBKeyRange.bound(o,u,!0)).next((function(e){var n,a=ar(),o=Object(s.a)(e);try{for(o.s();!(n=o.n()).done;){var u=n.value,c=i.jn(ne.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);c.isFoundDocument()&&(mn(t,c)||r.has(c.key))&&(a=a.insert(c.key,c))}}catch(l){o.e(l)}finally{o.f()}return a}))}},{key:"getAllFromCollectionGroup",value:function(e,t,n,r){var i=this,a=ar(),o=ro(t,n),s=ro(t,le.max());return to(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,s,!0)},(function(e,t,n){var o=i.jn(ne.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(a=a.insert(o.key,o)).size===r&&n.done()})).next((function(){return a}))}},{key:"newChangeBuffer",value:function(e){return new $a(this,!!e&&e.trackRemovals)}},{key:"getSize",value:function(e){return this.getMetadata(e).next((function(e){return e.byteSize}))}},{key:"getMetadata",value:function(e){return eo(e).get("remoteDocumentGlobalKey").next((function(e){return C(!!e),e}))}},{key:"Qn",value:function(e,t){return eo(e).put("remoteDocumentGlobalKey",t)}},{key:"jn",value:function(e,t){if(t){var n=function(e,t){var n;if(t.document)n=Gr(e.ie,t.document,!!t.hasCommittedMutations);else if(t.noDocument){var r=ne.fromSegments(t.noDocument.path),i=Vi(t.noDocument.readTime);n=qt.newNoDocument(r,i),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return M();var a=ne.fromSegments(t.unknownDocument.path),o=Vi(t.unknownDocument.version);n=qt.newUnknownDocument(a,o)}return t.readTime&&n.setReadTime(function(e){var t=new Q(e[0],e[1]);return Z.fromTimestamp(t)}(t.readTime)),n}(this.yt,t);if(!n.isNoDocument()||!n.version.isEqual(Z.min()))return n}return qt.newInvalidDocument(e)}}]),e}();function Ja(e){return new Za(e)}var $a=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this)).Yn=e,i.trackRemovals=r,i.Xn=new rr((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),i}return Object(p.a)(n,[{key:"applyChanges",value:function(e){var t=this,n=[],r=0,i=new Ut((function(e,t){return Y(e.canonicalString(),t.canonicalString())}));return this.changes.forEach((function(a,o){var s=t.Xn.get(a);if(n.push(t.Yn.removeEntry(e,a,s.readTime)),o.isValidDocument()){var u=Fi(t.Yn.yt,o);i=i.add(a.path.popLast());var c=Ia(u);r+=c-s.size,n.push(t.Yn.addEntry(e,a,u))}else if(r-=s.size,t.trackRemovals){var l=Fi(t.Yn.yt,o.convertToNoDocument(Z.min()));n.push(t.Yn.addEntry(e,a,l))}})),i.forEach((function(r){n.push(t.Yn.indexManager.addToCollectionParentIndex(e,r))})),n.push(this.Yn.updateMetadata(e,r)),me.waitFor(n)}},{key:"getFromCache",value:function(e,t){var n=this;return this.Yn.Wn(e,t).next((function(e){return n.Xn.set(t,{size:e.size,readTime:e.document.readTime}),e.document}))}},{key:"getAllFromCache",value:function(e,t){var n=this;return this.Yn.Hn(e,t).next((function(e){var t=e.documents;return e.Jn.forEach((function(e,r){n.Xn.set(e,{size:r,readTime:t.get(e).readTime})})),t}))}}]),n}(Qa);function eo(e){return Ii(e,"remoteDocumentGlobal")}function to(e){return Ii(e,"remoteDocumentsV14")}function no(e){var t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function ro(e,t){var n=t.documentKey.path.toArray();return[e,Ui(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function io(e,t){for(var n=e.path.toArray(),r=t.path.toArray(),i=0,a=0;a<n.length-2&&a<r.length-2;++a)if(i=Y(n[a],r[a]))return i;return(i=Y(n.length,r.length))||((i=Y(n[n.length-2],r[r.length-2]))||Y(n[n.length-1],r[r.length-1]))}var ao=Object(p.a)((function e(t,n){Object(f.a)(this,e),this.overlayedDocument=t,this.mutatedFields=n})),oo=function(){function e(t,n,r,i){Object(f.a)(this,e),this.remoteDocumentCache=t,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}return Object(p.a)(e,[{key:"getDocument",value:function(e,t){var n=this,r=null;return this.documentOverlayCache.getOverlay(e,t).next((function(i){return r=i,n.remoteDocumentCache.getEntry(e,t)})).next((function(e){return null!==r&&Vn(r.mutation,e,Gt.empty(),Q.now()),e}))}},{key:"getDocuments",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next((function(t){return n.getLocalViewOfDocuments(e,t,pr()).next((function(){return t}))}))}},{key:"getLocalViewOfDocuments",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:pr(),i=cr();return this.populateOverlays(e,i,t).next((function(){return n.computeViews(e,t,i,r).next((function(e){var t=sr();return e.forEach((function(e,n){t=t.insert(e,n.overlayedDocument)})),t}))}))}},{key:"getOverlayedDocuments",value:function(e,t){var n=this,r=cr();return this.populateOverlays(e,r,t).next((function(){return n.computeViews(e,t,r,pr())}))}},{key:"populateOverlays",value:function(e,t,n){var r=[];return n.forEach((function(e){t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((function(e){e.forEach((function(e,n){t.set(e,n)}))}))}},{key:"computeViews",value:function(e,t,n,r){var i=ar(),a=hr(),o=hr();return t.forEach((function(e,t){var o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof qn)?i=i.insert(t.key,t):void 0!==o?(a.set(t.key,o.mutation.getFieldMask()),Vn(o.mutation,t,o.mutation.getFieldMask(),Q.now())):a.set(t.key,Gt.empty())})),this.recalculateAndSaveOverlays(e,i).next((function(e){return e.forEach((function(e,t){return a.set(e,t)})),t.forEach((function(e,t){var n;return o.set(e,new ao(t,null!==(n=a.get(e))&&void 0!==n?n:null))})),o}))}},{key:"recalculateAndSaveOverlays",value:function(e,t){var n=this,r=hr(),i=new Nt((function(e,t){return e-t})),a=pr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((function(e){var n,a=Object(s.a)(e);try{var o=function(){var e=n.value;e.keys().forEach((function(n){var a=t.get(n);if(null!==a){var o=r.get(n)||Gt.empty();o=e.applyToLocalView(a,o),r.set(n,o);var s=(i.get(e.batchId)||pr()).add(n);i=i.insert(e.batchId,s)}}))};for(a.s();!(n=a.n()).done;)o()}catch(u){a.e(u)}finally{a.f()}})).next((function(){for(var o=[],s=i.getReverseIterator(),u=function(){var i=s.getNext(),u=i.key,c=i.value,l=lr();c.forEach((function(e){if(!a.has(e)){var n=Un(t.get(e),r.get(e));null!==n&&l.set(e,n),a=a.add(e)}})),o.push(n.documentOverlayCache.saveOverlays(e,u,l))};s.hasNext();)u();return me.waitFor(o)})).next((function(){return r}))}},{key:"recalculateAndSaveOverlaysForDocumentKeys",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next((function(t){return n.recalculateAndSaveOverlays(e,t)}))}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){return function(e){return ne.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):un(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}},{key:"getNextDocuments",value:function(e,t,n,r){var i=this;return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((function(a){var o=r-a.size>0?i.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-a.size):me.resolve(cr()),s=-1,u=a;return o.next((function(t){return me.forEach(t,(function(t,n){return s<n.largestBatchId&&(s=n.largestBatchId),a.get(t)?me.resolve():i.remoteDocumentCache.getEntry(e,t).next((function(e){u=u.insert(t,e)}))})).next((function(){return i.populateOverlays(e,t,a)})).next((function(){return i.computeViews(e,u,t,pr())})).next((function(e){return{batchId:s,changes:ur(e)}}))}))}))}},{key:"getDocumentsMatchingDocumentQuery",value:function(e,t){return this.getDocument(e,new ne(t)).next((function(e){var t=sr();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}},{key:"getDocumentsMatchingCollectionGroupQuery",value:function(e,t,n){var r=this,i=t.collectionGroup,a=sr();return this.indexManager.getCollectionParents(e,i).next((function(o){return me.forEach(o,(function(o){var s=function(e,t){return new tn(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return r.getDocumentsMatchingCollectionQuery(e,s,n).next((function(e){e.forEach((function(e,t){a=a.insert(e,t)}))}))})).next((function(){return a}))}))}},{key:"getDocumentsMatchingCollectionQuery",value:function(e,t,n){var r,i=this;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((function(a){return r=a,i.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r)})).next((function(e){r.forEach((function(t,n){var r=n.getKey();null===e.get(r)&&(e=e.insert(r,qt.newInvalidDocument(r)))}));var n=sr();return e.forEach((function(e,i){var a=r.get(e);void 0!==a&&Vn(a.mutation,i,Gt.empty(),Q.now()),mn(t,i)&&(n=n.insert(e,i))})),n}))}}]),e}(),so=function(){function e(t){Object(f.a)(this,e),this.yt=t,this.Zn=new Map,this.ts=new Map}return Object(p.a)(e,[{key:"getBundleMetadata",value:function(e,t){return me.resolve(this.Zn.get(t))}},{key:"saveBundleMetadata",value:function(e,t){var n;return this.Zn.set(t.id,{id:(n=t).id,version:n.version,createTime:Ir(n.createTime)}),me.resolve()}},{key:"getNamedQuery",value:function(e,t){return me.resolve(this.ts.get(t))}},{key:"saveNamedQuery",value:function(e,t){return this.ts.set(t.name,function(e){return{name:e.name,query:qi(e.bundledQuery),readTime:Ir(e.readTime)}}(t)),me.resolve()}}]),e}(),uo=function(){function e(){Object(f.a)(this,e),this.overlays=new Nt(ne.comparator),this.es=new Map}return Object(p.a)(e,[{key:"getOverlay",value:function(e,t){return me.resolve(this.overlays.get(t))}},{key:"getOverlays",value:function(e,t){var n=this,r=cr();return me.forEach(t,(function(t){return n.getOverlay(e,t).next((function(e){null!==e&&r.set(t,e)}))})).next((function(){return r}))}},{key:"saveOverlays",value:function(e,t,n){var r=this;return n.forEach((function(n,i){r.oe(e,t,i)})),me.resolve()}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,i=this.es.get(n);return void 0!==i&&(i.forEach((function(e){return r.overlays=r.overlays.remove(e)})),this.es.delete(n)),me.resolve()}},{key:"getOverlaysForCollection",value:function(e,t,n){for(var r=cr(),i=t.length+1,a=new ne(t.child("")),o=this.overlays.getIteratorFrom(a);o.hasNext();){var s=o.getNext().value,u=s.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&s.largestBatchId>n&&r.set(s.getKey(),s)}return me.resolve(r)}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){for(var i=new Nt((function(e,t){return e-t})),a=this.overlays.getIterator();a.hasNext();){var o=a.getNext().value;if(o.getKey().getCollectionGroup()===t&&o.largestBatchId>n){var s=i.get(o.largestBatchId);null===s&&(s=cr(),i=i.insert(o.largestBatchId,s)),s.set(o.getKey(),o)}}for(var u=cr(),c=i.getIterator();c.hasNext()&&(c.getNext().value.forEach((function(e,t){return u.set(e,t)})),!(u.size()>=r)););return me.resolve(u)}},{key:"oe",value:function(e,t,n){var r=this.overlays.get(n.key);if(null!==r){var i=this.es.get(r.largestBatchId).delete(n.key);this.es.set(r.largestBatchId,i)}this.overlays=this.overlays.insert(n.key,new Li(t,n));var a=this.es.get(t);void 0===a&&(a=pr(),this.es.set(t,a)),this.es.set(t,a.add(n.key))}}]),e}(),co=function(){function e(){Object(f.a)(this,e),this.ns=new Ut(lo.ss),this.rs=new Ut(lo.os)}return Object(p.a)(e,[{key:"isEmpty",value:function(){return this.ns.isEmpty()}},{key:"addReference",value:function(e,t){var n=new lo(e,t);this.ns=this.ns.add(n),this.rs=this.rs.add(n)}},{key:"us",value:function(e,t){var n=this;e.forEach((function(e){return n.addReference(e,t)}))}},{key:"removeReference",value:function(e,t){this.cs(new lo(e,t))}},{key:"hs",value:function(e,t){var n=this;e.forEach((function(e){return n.removeReference(e,t)}))}},{key:"ls",value:function(e){var t=this,n=new ne(new $([])),r=new lo(n,e),i=new lo(n,e+1),a=[];return this.rs.forEachInRange([r,i],(function(e){t.cs(e),a.push(e.key)})),a}},{key:"fs",value:function(){var e=this;this.ns.forEach((function(t){return e.cs(t)}))}},{key:"cs",value:function(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}},{key:"ds",value:function(e){var t=new ne(new $([])),n=new lo(t,e),r=new lo(t,e+1),i=pr();return this.rs.forEachInRange([n,r],(function(e){i=i.add(e.key)})),i}},{key:"containsKey",value:function(e){var t=new lo(e,0),n=this.ns.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]),e}(),lo=function(){function e(t,n){Object(f.a)(this,e),this.key=t,this._s=n}return Object(p.a)(e,null,[{key:"ss",value:function(e,t){return ne.comparator(e.key,t.key)||Y(e._s,t._s)}},{key:"os",value:function(e,t){return Y(e._s,t._s)||ne.comparator(e.key,t.key)}}]),e}(),ho=function(){function e(t,n){Object(f.a)(this,e),this.indexManager=t,this.referenceDelegate=n,this.mutationQueue=[],this.ws=1,this.gs=new Ut(lo.ss)}return Object(p.a)(e,[{key:"checkEmpty",value:function(e){return me.resolve(0===this.mutationQueue.length)}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];var a=new Pi(i,t,n,r);this.mutationQueue.push(a);var o,u=Object(s.a)(r);try{for(u.s();!(o=u.n()).done;){var c=o.value;this.gs=this.gs.add(new lo(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast())}}catch(l){u.e(l)}finally{u.f()}return me.resolve(a)}},{key:"lookupMutationBatch",value:function(e,t){return me.resolve(this.ys(t))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=t+1,r=this.ps(n),i=r<0?0:r;return me.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return me.resolve(0===this.mutationQueue.length?-1:this.ws-1)}},{key:"getAllMutationBatches",value:function(e){return me.resolve(this.mutationQueue.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=new lo(t,0),i=new lo(t,Number.POSITIVE_INFINITY),a=[];return this.gs.forEachInRange([r,i],(function(e){var t=n.ys(e._s);a.push(t)})),me.resolve(a)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new Ut(Y);return t.forEach((function(e){var t=new lo(e,0),i=new lo(e,Number.POSITIVE_INFINITY);n.gs.forEachInRange([t,i],(function(e){r=r.add(e._s)}))})),me.resolve(this.Is(r))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=t.path,r=n.length+1,i=n;ne.isDocumentKey(i)||(i=i.child(""));var a=new lo(new ne(i),0),o=new Ut(Y);return this.gs.forEachWhile((function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e._s)),!0)}),a),me.resolve(this.Is(o))}},{key:"Is",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=t.ys(e);null!==r&&n.push(r)})),n}},{key:"removeMutationBatch",value:function(e,t){var n=this;C(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();var r=this.gs;return me.forEach(t.mutations,(function(i){var a=new lo(i.key,t.batchId);return r=r.delete(a),n.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((function(){n.gs=r}))}},{key:"An",value:function(e){}},{key:"containsKey",value:function(e,t){var n=new lo(t,0),r=this.gs.firstAfterOrEqual(n);return me.resolve(t.isEqual(r&&r.key))}},{key:"performConsistencyCheck",value:function(e){return this.mutationQueue.length,me.resolve()}},{key:"Ts",value:function(e,t){return this.ps(e)}},{key:"ps",value:function(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}},{key:"ys",value:function(e){var t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}]),e}(),fo=function(){function e(t){Object(f.a)(this,e),this.Es=t,this.docs=new Nt(ne.comparator),this.size=0}return Object(p.a)(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t){var n=t.key,r=this.docs.get(n),i=r?r.size:0,a=this.Es(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}},{key:"removeEntry",value:function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:"getEntry",value:function(e,t){var n=this.docs.get(t);return me.resolve(n?n.document.mutableCopy():qt.newInvalidDocument(t))}},{key:"getEntries",value:function(e,t){var n=this,r=ar();return t.forEach((function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():qt.newInvalidDocument(e))})),me.resolve(r)}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){for(var i=ar(),a=t.path,o=new ne(a.child("")),s=this.docs.getIteratorFrom(o);s.hasNext();){var u=s.getNext(),c=u.key,l=u.value.document;if(!a.isPrefixOf(c.path))break;c.path.length>a.length+1||he(ce(l),n)<=0||(r.has(l.key)||mn(t,l))&&(i=i.insert(l.key,l.mutableCopy()))}return me.resolve(i)}},{key:"getAllFromCollectionGroup",value:function(e,t,n,r){M()}},{key:"As",value:function(e,t){return me.forEach(this.docs,(function(e){return t(e)}))}},{key:"newChangeBuffer",value:function(e){return new po(this)}},{key:"getSize",value:function(e){return me.resolve(this.size)}}]),e}(),po=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this)).Yn=e,r}return Object(p.a)(n,[{key:"applyChanges",value:function(e){var t=this,n=[];return this.changes.forEach((function(r,i){i.isValidDocument()?n.push(t.Yn.addEntry(e,i)):t.Yn.removeEntry(r)})),me.waitFor(n)}},{key:"getFromCache",value:function(e,t){return this.Yn.getEntry(e,t)}},{key:"getAllFromCache",value:function(e,t){return this.Yn.getEntries(e,t)}}]),n}(Qa),vo=function(){function e(t){Object(f.a)(this,e),this.persistence=t,this.Rs=new rr((function(e){return Kt(e)}),Qt),this.lastRemoteSnapshotVersion=Z.min(),this.highestTargetId=0,this.bs=0,this.Ps=new co,this.targetCount=0,this.vs=Fa.Pn()}return Object(p.a)(e,[{key:"forEachTarget",value:function(e,t){return this.Rs.forEach((function(e,n){return t(n)})),me.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(e){return me.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(e){return me.resolve(this.bs)}},{key:"allocateTargetId",value:function(e){return this.highestTargetId=this.vs.next(),me.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.bs&&(this.bs=t),me.resolve()}},{key:"Dn",value:function(e){this.Rs.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.vs=new Fa(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}},{key:"addTargetData",value:function(e,t){return this.Dn(t),this.targetCount+=1,me.resolve()}},{key:"updateTargetData",value:function(e,t){return this.Dn(t),me.resolve()}},{key:"removeTargetData",value:function(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,me.resolve()}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return this.Rs.forEach((function(o,s){s.sequenceNumber<=t&&null===n.get(s.targetId)&&(r.Rs.delete(o),a.push(r.removeMatchingKeysForTargetId(e,s.targetId)),i++)})),me.waitFor(a).next((function(){return i}))}},{key:"getTargetCount",value:function(e){return me.resolve(this.targetCount)}},{key:"getTargetData",value:function(e,t){var n=this.Rs.get(t)||null;return me.resolve(n)}},{key:"addMatchingKeys",value:function(e,t,n){return this.Ps.us(t,n),me.resolve()}},{key:"removeMatchingKeys",value:function(e,t,n){this.Ps.hs(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((function(t){i.push(r.markPotentiallyOrphaned(e,t))})),me.waitFor(i)}},{key:"removeMatchingKeysForTargetId",value:function(e,t){return this.Ps.ls(t),me.resolve()}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=this.Ps.ds(t);return me.resolve(n)}},{key:"containsKey",value:function(e,t){return me.resolve(this.Ps.containsKey(t))}}]),e}(),mo=function(){function e(t,n){var r=this;Object(f.a)(this,e),this.Vs={},this.overlays={},this.Ss=new je(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=t(this),this.Cs=new vo(this),this.indexManager=new xa,this.remoteDocumentCache=new fo((function(e){return r.referenceDelegate.xs(e)})),this.yt=new Bi(n),this.Ns=new so(this.yt)}return Object(p.a)(e,[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.Ds=!1,Promise.resolve()}},{key:"started",get:function(){return this.Ds}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(e){return this.indexManager}},{key:"getDocumentOverlayCache",value:function(e){var t=this.overlays[e.toKey()];return t||(t=new uo,this.overlays[e.toKey()]=t),t}},{key:"getMutationQueue",value:function(e,t){var n=this.Vs[e.toKey()];return n||(n=new ho(t,this.referenceDelegate),this.Vs[e.toKey()]=n),n}},{key:"getTargetCache",value:function(){return this.Cs}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getBundleCache",value:function(){return this.Ns}},{key:"runTransaction",value:function(e,t,n){var r=this;E("MemoryPersistence","Starting transaction:",e);var i=new go(this.Ss.next());return this.referenceDelegate.ks(),n(i).next((function(e){return r.referenceDelegate.Os(i).next((function(){return e}))})).toPromise().then((function(e){return i.raiseOnCommittedEvent(),e}))}},{key:"Ms",value:function(e,t){return me.or(Object.values(this.Vs).map((function(n){return function(){return n.containsKey(e,t)}})))}}]),e}(),go=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this)).currentSequenceNumber=e,r}return Object(p.a)(n)}(fe),yo=function(){function e(t){Object(f.a)(this,e),this.persistence=t,this.Fs=new co,this.$s=null}return Object(p.a)(e,[{key:"Ls",get:function(){if(this.$s)return this.$s;throw M()}},{key:"addReference",value:function(e,t,n){return this.Fs.addReference(n,t),this.Ls.delete(n.toString()),me.resolve()}},{key:"removeReference",value:function(e,t,n){return this.Fs.removeReference(n,t),this.Ls.add(n.toString()),me.resolve()}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.Ls.add(t.toString()),me.resolve()}},{key:"removeTarget",value:function(e,t){var n=this;this.Fs.ls(t.targetId).forEach((function(e){return n.Ls.add(e.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((function(e){e.forEach((function(e){return n.Ls.add(e.toString())}))})).next((function(){return r.removeTargetData(e,t)}))}},{key:"ks",value:function(){this.$s=new Set}},{key:"Os",value:function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return me.forEach(this.Ls,(function(r){var i=ne.fromPath(r);return t.qs(e,i).next((function(e){e||n.removeEntry(i,Z.min())}))})).next((function(){return t.$s=null,n.apply(e)}))}},{key:"updateLimboDocument",value:function(e,t){var n=this;return this.qs(e,t).next((function(e){e?n.Ls.delete(t.toString()):n.Ls.add(t.toString())}))}},{key:"xs",value:function(e){return 0}},{key:"qs",value:function(e,t){var n=this;return me.or([function(){return me.resolve(n.Fs.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.Ms(e,t)}])}}],[{key:"Bs",value:function(t){return new e(t)}}]),e}(),bo=function(){function e(t){Object(f.a)(this,e),this.yt=t}return Object(p.a)(e,[{key:"$",value:function(e,t,n,r){var i=this,a=new ge("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ci,{unique:!0}),e.createObjectStore("documentMutations")}(e),wo(e),function(e){e.createObjectStore("remoteDocuments")}(e));var o=me.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),wo(e)),o=o.next((function(){return function(e){var t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Z.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(a)}))),n<4&&r>=4&&(0!==n&&(o=o.next((function(){return function(e,t){return t.store("mutations").W().next((function(n){e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ci,{unique:!0});var r=t.store("mutations"),i=n.map((function(e){return r.put(e)}));return me.waitFor(i)}))}(e,a)}))),o=o.next((function(){!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(o=o.next((function(){return i.Us(a)}))),n<6&&r>=6&&(o=o.next((function(){return function(e){e.createObjectStore("remoteDocumentGlobal")}(e),i.Ks(a)}))),n<7&&r>=7&&(o=o.next((function(){return i.Gs(a)}))),n<8&&r>=8&&(o=o.next((function(){return i.Qs(e,a)}))),n<9&&r>=9&&(o=o.next((function(){!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(o=o.next((function(){return i.js(a)}))),n<11&&r>=11&&(o=o.next((function(){!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(o=o.next((function(){!function(e){var t=e.createObjectStore("documentOverlays",{keyPath:_i});t.createIndex("collectionPathOverlayIndex",Si,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",Ei,{unique:!1})}(e)}))),n<13&&r>=13&&(o=o.next((function(){return function(e){var t=e.createObjectStore("remoteDocumentsV14",{keyPath:fi});t.createIndex("documentKeyIndex",pi),t.createIndex("collectionGroupIndex",vi)}(e)})).next((function(){return i.Ws(e,a)})).next((function(){return e.deleteObjectStore("remoteDocuments")}))),n<14&&r>=14&&(o=o.next((function(){return i.zs(e,a)}))),n<15&&r>=15&&(o=o.next((function(){return function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:wi}).createIndex("sequenceNumberIndex",xi,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Oi}).createIndex("documentKeyIndex",ki,{unique:!1})}(e)}))),o}},{key:"Ks",value:function(e){var t=0;return e.store("remoteDocuments").Z((function(e,n){t+=Ia(n)})).next((function(){var n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}},{key:"Us",value:function(e){var t=this,n=e.store("mutationQueues"),r=e.store("mutations");return n.W().next((function(n){return me.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",i).next((function(r){return me.forEach(r,(function(r){C(r.userId===n.userId);var i=Gi(t.yt,r);return Da(e,n.userId,i).next((function(){}))}))}))}))}))}},{key:"Gs",value:function(e){var t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((function(e){var r=[];return n.Z((function(n,i){var a=new $(n),o=function(e){return[0,ai(e)]}(a);r.push(t.get(o).next((function(n){return n?me.resolve():function(n){return t.put({targetId:0,path:ai(n),sequenceNumber:e.highestListenSequenceNumber})}(a)})))})).next((function(){return me.waitFor(r)}))}))}},{key:"Qs",value:function(e,t){e.createObjectStore("collectionParents",{keyPath:bi});var n=t.store("collectionParents"),r=new Oa,i=function(e){if(r.add(e)){var t=e.lastSegment(),i=e.popLast();return n.put({collectionId:t,parent:ai(i)})}};return t.store("remoteDocuments").Z({X:!0},(function(e,t){var n=new $(e);return i(n.popLast())})).next((function(){return t.store("documentMutations").Z({X:!0},(function(e,t){var n=Object(o.a)(e,3),r=(n[0],n[1]),a=(n[2],ui(r));return i(a.popLast())}))}))}},{key:"js",value:function(e){var t=this,n=e.store("targets");return n.Z((function(e,r){var i=Hi(r),a=Wi(t.yt,i);return n.put(a)}))}},{key:"Ws",value:function(e,t){var n=t.store("remoteDocuments"),r=[];return n.Z((function(e,n){var i,a=t.store("remoteDocumentsV14"),o=(i=n,i.document?new ne($.fromString(i.document.name).popFirst(5)):i.noDocument?ne.fromSegments(i.noDocument.path):i.unknownDocument?ne.fromSegments(i.unknownDocument.path):M()).path.toArray(),s={prefixPath:o.slice(0,o.length-2),collectionGroup:o[o.length-2],documentId:o[o.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(a.put(s))})).next((function(){return me.waitFor(r)}))}},{key:"zs",value:function(e,t){var n=this,r=t.store("mutations"),i=Ja(this.yt),a=new mo(yo.Bs,this.yt.ie);return r.W().next((function(e){var r=new Map;return e.forEach((function(e){var t,i=null!==(t=r.get(e.userId))&&void 0!==t?t:pr();Gi(n.yt,e).keys().forEach((function(e){return i=i.add(e)})),r.set(e.userId,i)})),me.forEach(r,(function(e,r){var o=new x(r),s=$i.re(n.yt,o),u=a.getIndexManager(o),c=Pa.re(o,n.yt,u,a.referenceDelegate);return new oo(i,c,s,u).recalculateAndSaveOverlaysForDocumentKeys(new Di(t,je.at),e).next()}))}))}}]),e}();function wo(e){e.createObjectStore("targetDocuments",{keyPath:gi}).createIndex("documentTargetsIndex",yi,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",mi,{unique:!0}),e.createObjectStore("targetGlobal")}var xo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Oo=function(){function e(t,n,r,i,a,o,s,u,c,l){var h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:15;if(Object(f.a)(this,e),this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.Hs=a,this.window=o,this.document=s,this.Js=c,this.Ys=l,this.Xs=h,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=function(e){return Promise.resolve()},!e.C())throw new R(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Xa(this,i),this.ii=n+"main",this.yt=new Bi(u),this.ri=new ye(this.ii,this.Xs,new bo(this.yt)),this.Cs=new Ua(this.referenceDelegate,this.yt),this.remoteDocumentCache=Ja(this.yt),this.Ns=new Qi,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===l&&A("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return Object(p.a)(e,[{key:"start",value:function(){var e=this;return this.ui().then((function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new R(P.FAILED_PRECONDITION,xo);return e.ci(),e.ai(),e.hi(),e.runTransaction("getHighestListenSequenceNumber","readonly",(function(t){return e.Cs.getHighestSequenceNumber(t)}))})).then((function(t){e.Ss=new je(t,e.Js)})).then((function(){e.Ds=!0})).catch((function(t){return e.ri&&e.ri.close(),Promise.reject(t)}))}},{key:"li",value:function(e){var t=this;return this.si=function(){var n=Object(c.a)(Object(u.a)().mark((function n(r){return Object(u.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.started){n.next=2;break}return n.abrupt("return",e(r));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e(this.isPrimary)}},{key:"setDatabaseDeletedListener",value:function(e){this.ri.L(function(){var t=Object(c.a)(Object(u.a)().mark((function t(n){return Object(u.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=null===n.newVersion,!t.t0){t.next=4;break}return t.next=4,e();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"setNetworkEnabled",value:function(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget(Object(c.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.started,!e.t0){e.next=4;break}return e.next=4,t.ui();case 4:case"end":return e.stop()}}),e)})))))}},{key:"ui",value:function(){var e=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(t){return _o(t).put({clientId:e.clientId,updateTimeMs:Date.now(),networkEnabled:e.networkEnabled,inForeground:e.inForeground}).next((function(){if(e.isPrimary)return e.fi(t).next((function(t){t||(e.isPrimary=!1,e.Hs.enqueueRetryable((function(){return e.si(!1)})))}))})).next((function(){return e.di(t)})).next((function(n){return e.isPrimary&&!n?e._i(t).next((function(){return!1})):!!n&&e.wi(t).next((function(){return!0}))}))})).catch((function(t){if(xe(t))return E("IndexedDbPersistence","Failed to extend owner lease: ",t),e.isPrimary;if(!e.allowTabSynchronization)throw t;return E("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((function(t){e.isPrimary!==t&&e.Hs.enqueueRetryable((function(){return e.si(t)})),e.isPrimary=t}))}},{key:"fi",value:function(e){var t=this;return ko(e).get("owner").next((function(e){return me.resolve(t.mi(e))}))}},{key:"gi",value:function(e){return _o(e).delete(this.clientId)}},{key:"yi",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t,n,r,i,a=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrimary||this.pi(this.ni,18e5)){e.next=6;break}return this.ni=Date.now(),e.next=4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var t=Ii(e,"clientMetadata");return t.W().next((function(e){var n=a.Ii(e,18e5),r=e.filter((function(e){return-1===n.indexOf(e)}));return me.forEach(r,(function(e){return t.delete(e.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}));case 4:if(t=e.sent,this.oi){n=Object(s.a)(t);try{for(n.s();!(r=n.n()).done;)i=r.value,this.oi.removeItem(this.Ti(i.clientId))}catch(o){n.e(o)}finally{n.f()}}case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"hi",value:function(){var e=this;this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return e.ui().then((function(){return e.yi()})).then((function(){return e.hi()}))}))}},{key:"mi",value:function(e){return!!e&&e.ownerId===this.clientId}},{key:"di",value:function(e){var t=this;return this.Ys?me.resolve(!0):ko(e).get("owner").next((function(n){if(null!==n&&t.pi(n.leaseTimestampMs,5e3)&&!t.Ei(n.ownerId)){if(t.mi(n)&&t.networkEnabled)return!0;if(!t.mi(n)){if(!n.allowTabSynchronization)throw new R(P.FAILED_PRECONDITION,xo);return!1}}return!(!t.networkEnabled||!t.inForeground)||_o(e).W().next((function(e){return void 0===t.Ii(e,5e3).find((function(e){if(t.clientId!==e.clientId){var n=!t.networkEnabled&&e.networkEnabled,r=!t.inForeground&&e.inForeground,i=t.networkEnabled===e.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(e){return t.isPrimary!==e&&E("IndexedDbPersistence","Client ".concat(e?"is":"is not"," eligible for a primary lease.")),e}))}},{key:"shutdown",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),e.next=7,this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(function(e){var n=new Di(e,je.at);return t._i(n).next((function(){return t.gi(n)}))}));case 7:this.ri.close(),this.Pi();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Ii",value:function(e,t){var n=this;return e.filter((function(e){return n.pi(e.updateTimeMs,t)&&!n.Ei(e.clientId)}))}},{key:"vi",value:function(){var e=this;return this.runTransaction("getActiveClients","readonly",(function(t){return _o(t).W().next((function(t){return e.Ii(t,18e5).map((function(e){return e.clientId}))}))}))}},{key:"started",get:function(){return this.Ds}},{key:"getMutationQueue",value:function(e,t){return Pa.re(e,this.yt,t,this.referenceDelegate)}},{key:"getTargetCache",value:function(){return this.Cs}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getIndexManager",value:function(e){return new _a(e,this.yt.ie.databaseId)}},{key:"getDocumentOverlayCache",value:function(e){return $i.re(this.yt,e)}},{key:"getBundleCache",value:function(){return this.Ns}},{key:"runTransaction",value:function(e,t,n){var r=this;E("IndexedDbPersistence","Starting transaction:",e);var i,a,o="readonly"===t?"readonly":"readwrite",s=15===(i=this.Xs)?Ci:14===i?Mi:13===i?Ti:12===i?ji:11===i?Ai:void M();return this.ri.runTransaction(e,o,s,(function(i){return a=new Di(i,r.Ss?r.Ss.next():je.at),"readwrite-primary"===t?r.fi(a).next((function(e){return!!e||r.di(a)})).next((function(t){if(!t)throw A("Failed to obtain primary lease for action '".concat(e,"'.")),r.isPrimary=!1,r.Hs.enqueueRetryable((function(){return r.si(!1)})),new R(P.FAILED_PRECONDITION,de);return n(a)})).next((function(e){return r.wi(a).next((function(){return e}))})):r.Vi(a).next((function(){return n(a)}))})).then((function(e){return a.raiseOnCommittedEvent(),e}))}},{key:"Vi",value:function(e){var t=this;return ko(e).get("owner").next((function(e){if(null!==e&&t.pi(e.leaseTimestampMs,5e3)&&!t.Ei(e.ownerId)&&!t.mi(e)&&!(t.Ys||t.allowTabSynchronization&&e.allowTabSynchronization))throw new R(P.FAILED_PRECONDITION,xo)}))}},{key:"wi",value:function(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ko(e).put("owner",t)}},{key:"_i",value:function(e){var t=this,n=ko(e);return n.get("owner").next((function(e){return t.mi(e)?(E("IndexedDbPersistence","Releasing primary lease."),n.delete("owner")):me.resolve()}))}},{key:"pi",value:function(e,t){var n=Date.now();return!(e<n-t)&&(!(e>n)||(A("Detected an update time that is in the future: ".concat(e," > ").concat(n)),!1))}},{key:"ci",value:function(){var e=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=function(){e.Hs.enqueueAndForget((function(){return e.inForeground="visible"===e.document.visibilityState,e.ui()}))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}},{key:"Ri",value:function(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}},{key:"ai",value:function(){var e,t=this;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=function(){t.Ai(),Object(y.z)()&&navigator.appVersion.match(/Version\/1[45]/)&&t.Hs.enterRestrictedMode(!0),t.Hs.enqueueAndForget((function(){return t.shutdown()}))},this.window.addEventListener("pagehide",this.Zs))}},{key:"bi",value:function(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}},{key:"Ei",value:function(e){var t;try{var n=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return E("IndexedDbPersistence","Client '".concat(e,"' ").concat(n?"is":"is not"," zombied in LocalStorage")),n}catch(e){return A("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}},{key:"Ai",value:function(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){A("Failed to set zombie client id.",e)}}},{key:"Pi",value:function(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}},{key:"Ti",value:function(e){return"firestore_zombie_".concat(this.persistenceKey,"_").concat(e)}}],[{key:"C",value:function(){return ye.C()}}]),e}();function ko(e){return Ii(e,"owner")}function _o(e){return Ii(e,"clientMetadata")}function So(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var Eo=function(){function e(t,n,r,i){Object(f.a)(this,e),this.targetId=t,this.fromCache=n,this.Si=r,this.Di=i}return Object(p.a)(e,null,[{key:"Ci",value:function(t,n){var r,i=pr(),a=pr(),o=Object(s.a)(n.docChanges);try{for(o.s();!(r=o.n()).done;){var u=r.value;switch(u.type){case 0:i=i.add(u.doc.key);break;case 1:a=a.add(u.doc.key)}}}catch(c){o.e(c)}finally{o.f()}return new e(t,n.fromCache,i,a)}}]),e}(),Ao=function(){function e(){Object(f.a)(this,e),this.xi=!1}return Object(p.a)(e,[{key:"initialize",value:function(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){var i=this;return this.ki(e,t).next((function(a){return a||i.Oi(e,t,r,n)})).next((function(n){return n||i.Mi(e,t)}))}},{key:"ki",value:function(e,t){var n=this;if(an(t))return me.resolve(null);var r=ln(t);return this.indexManager.getIndexType(e,r).next((function(i){return 0===i?null:(null!==t.limit&&1===i&&(t=dn(t,null,"F"),r=ln(t)),n.indexManager.getDocumentsMatchingTarget(e,r).next((function(i){var a=pr.apply(void 0,Object(d.a)(i));return n.Ni.getDocuments(e,a).next((function(i){return n.indexManager.getMinOffset(e,r).next((function(r){var o=n.Fi(t,i);return n.$i(t,o,a,r.readTime)?n.ki(e,dn(t,null,"F")):n.Bi(e,o,t,r)}))}))})))}))}},{key:"Oi",value:function(e,t,n,r){var i=this;return an(t)||r.isEqual(Z.min())?this.Mi(e,t):this.Ni.getDocuments(e,n).next((function(a){var o=i.Fi(t,a);return i.$i(t,o,n,r)?i.Mi(e,t):(_()<=g.a.DEBUG&&E("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),vn(t)),i.Bi(e,o,t,ue(r,-1)))}))}},{key:"Fi",value:function(e,t){var n=new Ut(yn(e));return t.forEach((function(t,r){mn(e,r)&&(n=n.add(r))})),n}},{key:"$i",value:function(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;var i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:"Mi",value:function(e,t){return _()<=g.a.DEBUG&&E("QueryEngine","Using full collection scan to execute query:",vn(t)),this.Ni.getDocumentsMatchingQuery(e,t,le.min())}},{key:"Bi",value:function(e,t,n,r){return this.Ni.getDocumentsMatchingQuery(e,n,r).next((function(e){return t.forEach((function(t){e=e.insert(t.key,t)})),e}))}}]),e}(),jo=function(){function e(t,n,r,i){Object(f.a)(this,e),this.persistence=t,this.Li=n,this.yt=i,this.qi=new Nt(Y),this.Ui=new rr((function(e){return Kt(e)}),Qt),this.Ki=new Map,this.Gi=t.getRemoteDocumentCache(),this.Cs=t.getTargetCache(),this.Ns=t.getBundleCache(),this.Qi(r)}return Object(p.a)(e,[{key:"Qi",value:function(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new oo(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}},{key:"collectGarbage",value:function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return e.collect(n,t.qi)}))}}]),e}();function To(e,t,n,r){return new jo(e,t,n,r)}function Mo(e,t){return Co.apply(this,arguments)}function Co(){return(Co=Object(c.a)(Object(u.a)().mark((function e(t,n){var r;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=I(t),e.next=3,r.persistence.runTransaction("Handle user change","readonly",(function(e){var t;return r.mutationQueue.getAllMutationBatches(e).next((function(i){return t=i,r.Qi(n),r.mutationQueue.getAllMutationBatches(e)})).next((function(n){var i,a=[],o=[],u=pr(),c=Object(s.a)(t);try{for(c.s();!(i=c.n()).done;){var l=i.value;a.push(l.batchId);var h,d=Object(s.a)(l.mutations);try{for(d.s();!(h=d.n()).done;){var f=h.value;u=u.add(f.key)}}catch(w){d.e(w)}finally{d.f()}}}catch(w){c.e(w)}finally{c.f()}var p,v=Object(s.a)(n);try{for(v.s();!(p=v.n()).done;){var m=p.value;o.push(m.batchId);var g,y=Object(s.a)(m.mutations);try{for(y.s();!(g=y.n()).done;){var b=g.value;u=u.add(b.key)}}catch(w){y.e(w)}finally{y.f()}}}catch(w){v.e(w)}finally{v.f()}return r.localDocuments.getDocuments(e,u).next((function(e){return{ji:e,removedBatchIds:a,addedBatchIds:o}}))}))}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Do(e,t){var n=I(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(e){var r=t.batch.keys(),i=n.Gi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){var i=n.batch,a=i.keys(),o=me.resolve();return a.forEach((function(e){o=o.next((function(){return r.getEntry(t,e)})).next((function(t){var a=n.docVersions.get(e);C(null!==a),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((function(){return e.mutationQueue.removeMutationBatch(t,i)}))}(n,e,t,i).next((function(){return i.apply(e)})).next((function(){return n.mutationQueue.performConsistencyCheck(e)})).next((function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)})).next((function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){for(var t=pr(),n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))})).next((function(){return n.localDocuments.getDocuments(e,r)}))}))}function Io(e){var t=I(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.Cs.getLastRemoteSnapshotVersion(e)}))}function Po(e,t){var n=I(e),r=t.snapshotVersion,i=n.qi;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(e){var a=n.Gi.newChangeBuffer({trackRemovals:!0});i=n.qi;var o=[];t.targetChanges.forEach((function(a,s){var u=i.get(s);if(u){o.push(n.Cs.removeMatchingKeys(e,a.removedDocuments,s).next((function(){return n.Cs.addMatchingKeys(e,a.addedDocuments,s)})));var c=u.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(s)?c=c.withResumeToken(Be.EMPTY_BYTE_STRING,Z.min()).withLastLimboFreeSnapshotVersion(Z.min()):a.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(a.resumeToken,r)),i=i.insert(s,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(u,c,a)&&o.push(n.Cs.updateTargetData(e,c))}}));var s=ar(),u=pr();if(t.documentUpdates.forEach((function(r){t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(Ro(e,a,t.documentUpdates).next((function(e){s=e.Wi,u=e.zi}))),!r.isEqual(Z.min())){var c=n.Cs.getLastRemoteSnapshotVersion(e).next((function(t){return n.Cs.setTargetsMetadata(e,e.currentSequenceNumber,r)}));o.push(c)}return me.waitFor(o).next((function(){return a.apply(e)})).next((function(){return n.localDocuments.getLocalViewOfDocuments(e,s,u)})).next((function(){return s}))})).then((function(e){return n.qi=i,e}))}function Ro(e,t,n){var r=pr(),i=pr();return n.forEach((function(e){return r=r.add(e)})),t.getEntries(e,r).next((function(e){var r=ar();return n.forEach((function(n,a){var o=e.get(n);a.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),a.isNoDocument()&&a.version.isEqual(Z.min())?(t.removeEntry(n,a.readTime),r=r.insert(n,a)):!o.isValidDocument()||a.version.compareTo(o.version)>0||0===a.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(a),r=r.insert(n,a)):E("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",a.version)})),{Wi:r,zi:i}}))}function Lo(e,t){var n=I(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(e){return void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)}))}function No(e,t){var n=I(e);return n.persistence.runTransaction("Allocate target","readwrite",(function(e){var r;return n.Cs.getTargetData(e,t).next((function(i){return i?(r=i,me.resolve(r)):n.Cs.allocateTargetId(e).next((function(i){return r=new Ni(t,i,0,e.currentSequenceNumber),n.Cs.addTargetData(e,r).next((function(){return r}))}))}))})).then((function(e){var r=n.qi.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.qi=n.qi.insert(e.targetId,e),n.Ui.set(t,e.targetId)),e}))}function Bo(e,t,n){return Fo.apply(this,arguments)}function Fo(){return(Fo=Object(c.a)(Object(u.a)().mark((function e(t,n,r){var i,a,o;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=I(t),a=i.qi.get(n),o=r?"readwrite":"readwrite-primary",e.prev=1,e.t0=r,e.t0){e.next=6;break}return e.next=6,i.persistence.runTransaction("Release target",o,(function(e){return i.persistence.referenceDelegate.removeTarget(e,a)}));case 6:e.next=13;break;case 8:if(e.prev=8,e.t1=e.catch(1),xe(e.t1)){e.next=12;break}throw e.t1;case 12:E("LocalStore","Failed to update sequence numbers for target ".concat(n,": ").concat(e.t1));case 13:i.qi=i.qi.remove(n),i.Ui.delete(a.target);case 14:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function Uo(e,t,n){var r=I(e),i=Z.min(),a=pr();return r.persistence.runTransaction("Execute query","readonly",(function(e){return function(e,t,n){var r=I(e),i=r.Ui.get(n);return void 0!==i?me.resolve(r.qi.get(i)):r.Cs.getTargetData(t,n)}(r,e,ln(t)).next((function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(e,t.targetId).next((function(e){a=e}))})).next((function(){return r.Li.getDocumentsMatchingQuery(e,t,n?i:Z.min(),n?a:pr())})).next((function(e){return Go(r,gn(t),e),{documents:e,Hi:a}}))}))}function zo(e,t){var n=I(e),r=I(n.Cs),i=n.qi.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(e){return r.ne(e,t).next((function(e){return e?e.target:null}))}))}function Vo(e,t){var n=I(e),r=n.Ki.get(t)||Z.min();return n.persistence.runTransaction("Get new document changes","readonly",(function(e){return n.Gi.getAllFromCollectionGroup(e,t,ue(r,-1),Number.MAX_SAFE_INTEGER)})).then((function(e){return Go(n,t,e),e}))}function Go(e,t,n){var r=e.Ki.get(t)||Z.min();n.forEach((function(e,t){t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Ki.set(t,r)}function Ho(e,t,n,r){return Wo.apply(this,arguments)}function Wo(){return(Wo=Object(c.a)(Object(u.a)().mark((function e(t,n,r,i){var a,o,c,l,h,d,f,p,v,m;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=I(t),o=pr(),c=ar(),l=Object(s.a)(r);try{for(l.s();!(h=l.n()).done;)d=h.value,f=n.Ji(d.metadata.name),d.document&&(o=o.add(f)),(p=n.Yi(d)).setReadTime(n.Xi(d.metadata.readTime)),c=c.insert(f,p)}catch(u){l.e(u)}finally{l.f()}return v=a.Gi.newChangeBuffer({trackRemovals:!0}),e.next=7,No(a,function(e){return ln(rn($.fromString("__bundle__/docs/".concat(e))))}(i));case 7:return m=e.sent,e.abrupt("return",a.persistence.runTransaction("Apply bundle documents","readwrite",(function(e){return Ro(e,v,c).next((function(t){return v.apply(e),t})).next((function(t){return a.Cs.removeMatchingKeysForTargetId(e,m.targetId).next((function(){return a.Cs.addMatchingKeys(e,o,m.targetId)})).next((function(){return a.localDocuments.getLocalViewOfDocuments(e,t.Wi,t.zi)})).next((function(){return t.Wi}))}))})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qo(e,t){return Yo.apply(this,arguments)}function Yo(){return Yo=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i,a,o=arguments;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:pr(),e.next=3,No(t,ln(qi(n.bundledQuery)));case 3:return i=e.sent,a=I(t),e.abrupt("return",a.persistence.runTransaction("Save named query","readwrite",(function(e){var t=Ir(n.readTime);if(i.snapshotVersion.compareTo(t)>=0)return a.Ns.saveNamedQuery(e,n);var o=i.withResumeToken(Be.EMPTY_BYTE_STRING,t);return a.qi=a.qi.insert(o.targetId,o),a.Cs.updateTargetData(e,o).next((function(){return a.Cs.removeMatchingKeysForTargetId(e,i.targetId)})).next((function(){return a.Cs.addMatchingKeys(e,r,i.targetId)})).next((function(){return a.Ns.saveNamedQuery(e,n)}))})));case 6:case"end":return e.stop()}}),e)}))),Yo.apply(this,arguments)}function Xo(e,t){return"firestore_clients_".concat(e,"_").concat(t)}function Ko(e,t,n){var r="firestore_mutations_".concat(e,"_").concat(n);return t.isAuthenticated()&&(r+="_".concat(t.uid)),r}function Qo(e,t){return"firestore_targets_".concat(e,"_").concat(t)}var Zo=function(){function e(t,n,r,i){Object(f.a)(this,e),this.user=t,this.batchId=n,this.state=r,this.error=i}return Object(p.a)(e,[{key:"tr",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Zi",value:function(t,n,r){var i,a=JSON.parse(r),o="object"==typeof a&&-1!==["pending","acknowledged","rejected"].indexOf(a.state)&&(void 0===a.error||"object"==typeof a.error);return o&&a.error&&((o="string"==typeof a.error.message&&"string"==typeof a.error.code)&&(i=new R(a.error.code,a.error.message))),o?new e(t,n,a.state,i):(A("SharedClientState","Failed to parse mutation state for ID '".concat(n,"': ").concat(r)),null)}}]),e}(),Jo=function(){function e(t,n,r){Object(f.a)(this,e),this.targetId=t,this.state=n,this.error=r}return Object(p.a)(e,[{key:"tr",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Zi",value:function(t,n){var r,i=JSON.parse(n),a="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&((a="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new R(i.error.code,i.error.message))),a?new e(t,i.state,r):(A("SharedClientState","Failed to parse target state for ID '".concat(t,"': ").concat(n)),null)}}]),e}(),$o=function(){function e(t,n){Object(f.a)(this,e),this.clientId=t,this.activeTargetIds=n}return Object(p.a)(e,null,[{key:"Zi",value:function(t,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,a=mr(),o=0;i&&o<r.activeTargetIds.length;++o)i=Le(r.activeTargetIds[o]),a=a.add(r.activeTargetIds[o]);return i?new e(t,a):(A("SharedClientState","Failed to parse client data for instance '".concat(t,"': ").concat(n)),null)}}]),e}(),es=function(){function e(t,n){Object(f.a)(this,e),this.clientId=t,this.onlineState=n}return Object(p.a)(e,null,[{key:"Zi",value:function(t){var n=JSON.parse(t);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new e(n.clientId,n.onlineState):(A("SharedClientState","Failed to parse online state: ".concat(t)),null)}}]),e}(),ts=function(){function e(){Object(f.a)(this,e),this.activeTargetIds=mr()}return Object(p.a)(e,[{key:"er",value:function(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:"nr",value:function(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:"tr",value:function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}]),e}(),ns=function(){function e(t,n,r,i,a){Object(f.a)(this,e),this.window=t,this.Hs=n,this.persistenceKey=r,this.sr=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new Nt(Y),this.started=!1,this.cr=[];var o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=a,this.ar=Xo(this.persistenceKey,this.sr),this.hr=function(e){return"firestore_sequence_number_".concat(e)}(this.persistenceKey),this.ur=this.ur.insert(this.sr,new ts),this.lr=new RegExp("^firestore_clients_".concat(o,"_([^_]*)$")),this.dr=new RegExp("^firestore_mutations_".concat(o,"_(\\d+)(?:_(.*))?$")),this._r=new RegExp("^firestore_targets_".concat(o,"_(\\d+)$")),this.wr=function(e){return"firestore_online_state_".concat(e)}(this.persistenceKey),this.mr=function(e){return"firestore_bundle_loaded_v2_".concat(e)}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}return Object(p.a)(e,[{key:"start",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t,n,r,i,a,o,c,l,h,d,f,p=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.syncEngine.vi();case 2:t=e.sent,n=Object(s.a)(t),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=14;break}if((i=r.value)!==this.sr){e.next=10;break}return e.abrupt("continue",12);case 10:(a=this.getItem(Xo(this.persistenceKey,i)))&&(o=$o.Zi(i,a))&&(this.ur=this.ur.insert(o.clientId,o));case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:this.gr(),(c=this.storage.getItem(this.wr))&&(l=this.yr(c))&&this.pr(l),h=Object(s.a)(this.cr);try{for(h.s();!(d=h.n()).done;)f=d.value,this.rr(f)}catch(u){h.e(u)}finally{h.f()}this.cr=[],this.window.addEventListener("pagehide",(function(){return p.shutdown()})),this.started=!0;case 28:case"end":return e.stop()}}),e,this,[[4,16,19,22]])})));return function(){return e.apply(this,arguments)}}()},{key:"writeSequenceNumber",value:function(e){this.setItem(this.hr,JSON.stringify(e))}},{key:"getAllActiveQueryTargets",value:function(){return this.Ir(this.ur)}},{key:"isActiveQueryTarget",value:function(e){var t=!1;return this.ur.forEach((function(n,r){r.activeTargetIds.has(e)&&(t=!0)})),t}},{key:"addPendingMutation",value:function(e){this.Tr(e,"pending")}},{key:"updateMutationState",value:function(e,t,n){this.Tr(e,t,n),this.Er(e)}},{key:"addLocalQueryTarget",value:function(e){var t="not-current";if(this.isActiveQueryTarget(e)){var n=this.storage.getItem(Qo(this.persistenceKey,e));if(n){var r=Jo.Zi(e,n);r&&(t=r.state)}}return this.Ar.er(e),this.gr(),t}},{key:"removeLocalQueryTarget",value:function(e){this.Ar.nr(e),this.gr()}},{key:"isLocalQueryTarget",value:function(e){return this.Ar.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){this.removeItem(Qo(this.persistenceKey,e))}},{key:"updateQueryState",value:function(e,t,n){this.Rr(e,t,n)}},{key:"handleUserChange",value:function(e,t,n){var r=this;t.forEach((function(e){r.Er(e)})),this.currentUser=e,n.forEach((function(e){r.addPendingMutation(e)}))}},{key:"setOnlineState",value:function(e){this.br(e)}},{key:"notifyBundleLoaded",value:function(e){this.Pr(e)}},{key:"shutdown",value:function(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}},{key:"getItem",value:function(e){var t=this.storage.getItem(e);return E("SharedClientState","READ",e,t),t}},{key:"setItem",value:function(e,t){E("SharedClientState","SET",e,t),this.storage.setItem(e,t)}},{key:"removeItem",value:function(e){E("SharedClientState","REMOVE",e),this.storage.removeItem(e)}},{key:"rr",value:function(e){var t=this,n=e;if(n.storageArea===this.storage){if(E("SharedClientState","EVENT",n.key,n.newValue),n.key===this.ar)return void A("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable(Object(c.a)(Object(u.a)().mark((function e(){var r,i,a,o,s,c,l;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.started){e.next=43;break}if(null===n.key){e.next=41;break}if(!t.lr.test(n.key)){e.next=11;break}if(null!=n.newValue){e.next=6;break}return r=t.vr(n.key),e.abrupt("return",t.Vr(r,null));case 6:if(!(i=t.Sr(n.key,n.newValue))){e.next=9;break}return e.abrupt("return",t.Vr(i.clientId,i));case 9:e.next=41;break;case 11:if(!t.dr.test(n.key)){e.next=18;break}if(null===n.newValue){e.next=16;break}if(!(a=t.Dr(n.key,n.newValue))){e.next=16;break}return e.abrupt("return",t.Cr(a));case 16:e.next=41;break;case 18:if(!t._r.test(n.key)){e.next=25;break}if(null===n.newValue){e.next=23;break}if(!(o=t.Nr(n.key,n.newValue))){e.next=23;break}return e.abrupt("return",t.kr(o));case 23:e.next=41;break;case 25:if(n.key!==t.wr){e.next=32;break}if(null===n.newValue){e.next=30;break}if(!(s=t.yr(n.newValue))){e.next=30;break}return e.abrupt("return",t.pr(s));case 30:e.next=41;break;case 32:if(n.key!==t.hr){e.next=37;break}c=function(e){var t=je.at;if(null!=e)try{var n=JSON.parse(e);C("number"==typeof n),t=n}catch(e){A("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(n.newValue),c!==je.at&&t.sequenceNumberHandler(c),e.next=41;break;case 37:if(n.key!==t.mr){e.next=41;break}return l=t.Or(n.newValue),e.next=41,Promise.all(l.map((function(e){return t.syncEngine.Mr(e)})));case 41:e.next=44;break;case 43:t.cr.push(n);case 44:case"end":return e.stop()}}),e)}))))}}},{key:"Ar",get:function(){return this.ur.get(this.sr)}},{key:"gr",value:function(){this.setItem(this.ar,this.Ar.tr())}},{key:"Tr",value:function(e,t,n){var r=new Zo(this.currentUser,e,t,n),i=Ko(this.persistenceKey,this.currentUser,e);this.setItem(i,r.tr())}},{key:"Er",value:function(e){var t=Ko(this.persistenceKey,this.currentUser,e);this.removeItem(t)}},{key:"br",value:function(e){var t={clientId:this.sr,onlineState:e};this.storage.setItem(this.wr,JSON.stringify(t))}},{key:"Rr",value:function(e,t,n){var r=Qo(this.persistenceKey,e),i=new Jo(e,t,n);this.setItem(r,i.tr())}},{key:"Pr",value:function(e){var t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}},{key:"vr",value:function(e){var t=this.lr.exec(e);return t?t[1]:null}},{key:"Sr",value:function(e,t){var n=this.vr(e);return $o.Zi(n,t)}},{key:"Dr",value:function(e,t){var n=this.dr.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Zo.Zi(new x(i),r,t)}},{key:"Nr",value:function(e,t){var n=this._r.exec(e),r=Number(n[1]);return Jo.Zi(r,t)}},{key:"yr",value:function(e){return es.Zi(e)}},{key:"Or",value:function(e){return JSON.parse(e)}},{key:"Cr",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.user.uid!==this.currentUser.uid){e.next=2;break}return e.abrupt("return",this.syncEngine.Fr(t.batchId,t.state,t.error));case 2:E("SharedClientState","Ignoring mutation for non-active user ".concat(t.user.uid));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"kr",value:function(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}},{key:"Vr",value:function(e,t){var n=this,r=t?this.ur.insert(e,t):this.ur.remove(e),i=this.Ir(this.ur),a=this.Ir(r),o=[],s=[];return a.forEach((function(e){i.has(e)||o.push(e)})),i.forEach((function(e){a.has(e)||s.push(e)})),this.syncEngine.Br(o,s).then((function(){n.ur=r}))}},{key:"pr",value:function(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}},{key:"Ir",value:function(e){var t=mr();return e.forEach((function(e,n){t=t.unionWith(n.activeTargetIds)})),t}}],[{key:"C",value:function(e){return!(!e||!e.localStorage)}}]),e}(),rs=function(){function e(){Object(f.a)(this,e),this.Lr=new ts,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return Object(p.a)(e,[{key:"addPendingMutation",value:function(e){}},{key:"updateMutationState",value:function(e,t,n){}},{key:"addLocalQueryTarget",value:function(e){return this.Lr.er(e),this.qr[e]||"not-current"}},{key:"updateQueryState",value:function(e,t,n){this.qr[e]=t}},{key:"removeLocalQueryTarget",value:function(e){this.Lr.nr(e)}},{key:"isLocalQueryTarget",value:function(e){return this.Lr.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){delete this.qr[e]}},{key:"getAllActiveQueryTargets",value:function(){return this.Lr.activeTargetIds}},{key:"isActiveQueryTarget",value:function(e){return this.Lr.activeTargetIds.has(e)}},{key:"start",value:function(){return this.Lr=new ts,Promise.resolve()}},{key:"handleUserChange",value:function(e,t,n){}},{key:"setOnlineState",value:function(e){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(e){}},{key:"notifyBundleLoaded",value:function(e){}}]),e}(),is=function(){function e(){Object(f.a)(this,e)}return Object(p.a)(e,[{key:"Ur",value:function(e){}},{key:"shutdown",value:function(){}}]),e}(),as=function(){function e(){var t=this;Object(f.a)(this,e),this.Kr=function(){return t.Gr()},this.Qr=function(){return t.jr()},this.Wr=[],this.zr()}return Object(p.a)(e,[{key:"Ur",value:function(e){this.Wr.push(e)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}},{key:"zr",value:function(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}},{key:"Gr",value:function(){E("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var e,t=Object(s.a)(this.Wr);try{for(t.s();!(e=t.n()).done;){(0,e.value)(0)}}catch(n){t.e(n)}finally{t.f()}}},{key:"jr",value:function(){E("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var e,t=Object(s.a)(this.Wr);try{for(t.s();!(e=t.n()).done;){(0,e.value)(1)}}catch(n){t.e(n)}finally{t.f()}}}],[{key:"C",value:function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),e}(),os={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},ss=function(){function e(t){Object(f.a)(this,e),this.Hr=t.Hr,this.Jr=t.Jr}return Object(p.a)(e,[{key:"Yr",value:function(e){this.Xr=e}},{key:"Zr",value:function(e){this.eo=e}},{key:"onMessage",value:function(e){this.no=e}},{key:"close",value:function(){this.Jr()}},{key:"send",value:function(e){this.Hr(e)}},{key:"so",value:function(){this.Xr()}},{key:"io",value:function(e){this.eo(e)}},{key:"ro",value:function(e){this.no(e)}}]),e}(),us=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,e)).forceLongPolling=e.forceLongPolling,r.autoDetectLongPolling=e.autoDetectLongPolling,r.useFetchStreams=e.useFetchStreams,r}return Object(p.a)(n,[{key:"fo",value:function(e,t,n,r){return new Promise((function(i,a){var o=new b.g;o.setWithCredentials(!0),o.listenOnce(b.c.COMPLETE,(function(){try{switch(o.getLastErrorCode()){case b.a.NO_ERROR:var t=o.getResponseJson();E("Connection","XHR received:",JSON.stringify(t)),i(t);break;case b.a.TIMEOUT:E("Connection",'RPC "'+e+'" timed out'),a(new R(P.DEADLINE_EXCEEDED,"Request time out"));break;case b.a.HTTP_ERROR:var n=o.getStatus();if(E("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){var r=o.getResponseJson();Array.isArray(r)&&(r=r[0]);var s=null==r?void 0:r.error;if(s&&s.status&&s.message){var u=function(e){var t=e.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(t)>=0?t:P.UNKNOWN}(s.status);a(new R(u,s.message))}else a(new R(P.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new R(P.UNAVAILABLE,"Connection failed."));break;default:M()}}finally{E("Connection",'RPC "'+e+'" completed.')}}));var s=JSON.stringify(r);o.send(t,"POST",s,n,15)}))}},{key:"wo",value:function(e,t,n){var r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Object(b.h)(),a=Object(b.i)(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new b.d({})),this.lo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;var s=r.join("");E("Connection","Creating WebChannel: "+s,o);var u=i.createWebChannel(s,o),c=!1,l=!1,h=new ss({Hr:function(e){l?E("Connection","Not sending because WebChannel is closed:",e):(c||(E("Connection","Opening WebChannel transport."),u.open(),c=!0),E("Connection","WebChannel sending:",e),u.send(e))},Jr:function(){return u.close()}}),d=function(e,t,n){e.listen(t,(function(e){try{n(e)}catch(e){setTimeout((function(){throw e}),0)}}))};return d(u,b.f.EventType.OPEN,(function(){l||E("Connection","WebChannel transport opened.")})),d(u,b.f.EventType.CLOSE,(function(){l||(l=!0,E("Connection","WebChannel transport closed"),h.io())})),d(u,b.f.EventType.ERROR,(function(e){l||(l=!0,j("Connection","WebChannel transport errored:",e),h.io(new R(P.UNAVAILABLE,"The operation could not be completed")))})),d(u,b.f.EventType.MESSAGE,(function(e){var t;if(!l){var n=e.data[0];C(!!n);var r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){E("Connection","WebChannel received error:",i);var a=i.status,o=function(e){var t=Qn[e];if(void 0!==t)return nr(t)}(a),s=i.message;void 0===o&&(o=P.INTERNAL,s="Unknown error status: "+a+" with message "+i.message),l=!0,h.io(new R(o,s)),u.close()}else E("Connection","WebChannel received:",n),h.ro(n)}})),d(a,b.b.STAT_EVENT,(function(e){e.stat===b.e.PROXY?E("Connection","Detected buffering proxy"):e.stat===b.e.NOPROXY&&E("Connection","Detected no buffering proxy")})),setTimeout((function(){h.so()}),0),h}}]),n}(function(){function e(t){Object(f.a)(this,e),this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http";this.oo=n+"://"+t.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return Object(p.a)(e,[{key:"co",get:function(){return!1}},{key:"ao",value:function(e,t,n,r,i){var a=this.ho(e,t);E("RestConnection","Sending: ",a,n);var o={};return this.lo(o,r,i),this.fo(e,a,o,n).then((function(e){return E("RestConnection","Received: ",e),e}),(function(t){throw j("RestConnection","".concat(e," failed with error: "),t,"url: ",a,"request:",n),t}))}},{key:"_o",value:function(e,t,n,r,i,a){return this.ao(e,t,n,r,i)}},{key:"lo",value:function(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+O,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((function(t,n){return e[n]=t})),n&&n.headers.forEach((function(t,n){return e[n]=t}))}},{key:"ho",value:function(e,t){var n=os[e];return"".concat(this.oo,"/v1/").concat(t,":").concat(n)}}]),e}());function cs(){return"undefined"!=typeof window?window:null}function ls(){return"undefined"!=typeof document?document:null}function hs(e){return new Tr(e,!0)}var ds=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;Object(f.a)(this,e),this.Hs=t,this.timerId=n,this.mo=r,this.yo=i,this.po=a,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}return Object(p.a)(e,[{key:"reset",value:function(){this.Io=0}},{key:"Ao",value:function(){this.Io=this.po}},{key:"Ro",value:function(e){var t=this;this.cancel();var n=Math.floor(this.Io+this.bo()),r=Math.max(0,Date.now()-this.Eo),i=Math.max(0,n-r);i>0&&E("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.Io," ms, delay with jitter: ").concat(n," ms, last attempt: ").concat(r," ms ago)")),this.To=this.Hs.enqueueAfterDelay(this.timerId,i,(function(){return t.Eo=Date.now(),e()})),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}},{key:"Po",value:function(){null!==this.To&&(this.To.skipDelay(),this.To=null)}},{key:"cancel",value:function(){null!==this.To&&(this.To.cancel(),this.To=null)}},{key:"bo",value:function(){return(Math.random()-.5)*this.Io}}]),e}(),fs=function(){function e(t,n,r,i,a,o,s,u){Object(f.a)(this,e),this.Hs=t,this.vo=r,this.Vo=i,this.connection=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=s,this.listener=u,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new ds(t,n)}return Object(p.a)(e,[{key:"No",value:function(){return 1===this.state||5===this.state||this.ko()}},{key:"ko",value:function(){return 2===this.state||3===this.state}},{key:"start",value:function(){4!==this.state?this.auth():this.Oo()}},{key:"stop",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.No(),!e.t0){e.next=4;break}return e.next=4,this.close(0);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Mo",value:function(){this.state=0,this.xo.reset()}},{key:"Fo",value:function(){var e=this;this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,(function(){return e.$o()})))}},{key:"Bo",value:function(e){this.Lo(),this.stream.send(e)}},{key:"$o",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.ko()){e.next=2;break}return e.abrupt("return",this.close(0));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Lo",value:function(){this.Do&&(this.Do.cancel(),this.Do=null)}},{key:"qo",value:function(){this.Co&&(this.Co.cancel(),this.Co=null)}},{key:"close",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,n){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.Lo(),this.qo(),this.xo.cancel(),this.So++,4!==t?this.xo.reset():n&&n.code===P.RESOURCE_EXHAUSTED?(A(n.toString()),A("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):n&&n.code===P.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Uo(),this.stream.close(),this.stream=null),this.state=t,e.next=9,this.listener.Zr(n);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"Uo",value:function(){}},{key:"auth",value:function(){var e=this;this.state=1;var t=this.Ko(this.So),n=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((function(t){var r=Object(o.a)(t,2),i=r[0],a=r[1];e.So===n&&e.Go(i,a)}),(function(n){t((function(){var t=new R(P.UNKNOWN,"Fetching auth token failed: "+n.message);return e.Qo(t)}))}))}},{key:"Go",value:function(e,t){var n=this,r=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr((function(){r((function(){return n.state=2,n.Co=n.Hs.enqueueAfterDelay(n.Vo,1e4,(function(){return n.ko()&&(n.state=3),Promise.resolve()})),n.listener.Yr()}))})),this.stream.Zr((function(e){r((function(){return n.Qo(e)}))})),this.stream.onMessage((function(e){r((function(){return n.onMessage(e)}))}))}},{key:"Oo",value:function(){var e=this;this.state=5,this.xo.Ro(Object(c.a)(Object(u.a)().mark((function t(){return Object(u.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.state=0,e.start();case 1:case"end":return t.stop()}}),t)}))))}},{key:"Qo",value:function(e){return E("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}},{key:"Ko",value:function(e){var t=this;return function(n){t.Hs.enqueueAndForget((function(){return t.So===e?n():(E("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}}}]),e}(),ps=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r,i,a,o,s){var u;return Object(f.a)(this,n),(u=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,i,a,s)).yt=o,u}return Object(p.a)(n,[{key:"jo",value:function(e,t){return this.connection.wo("Listen",e,t)}},{key:"onMessage",value:function(e){this.xo.reset();var t=function(e,t){var n;if("targetChange"in t){t.targetChange;var r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:M()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],a=function(e,t){return e.wt?(C(void 0===t||"string"==typeof t),Be.fromBase64String(t||"")):(C(void 0===t||t instanceof Uint8Array),Be.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,s=o&&function(e){var t=void 0===e.code?P.UNKNOWN:nr(e.code);return new R(t,e.message||"")}(o);n=new xr(r,i,a,s||null)}else if("documentChange"in t){t.documentChange;var u=t.documentChange;u.document,u.document.name,u.document.updateTime;var c=Nr(e,u.document.name),l=Ir(u.document.updateTime),h=u.document.createTime?Ir(u.document.createTime):Z.min(),d=new Ht({mapValue:{fields:u.document.fields}}),f=qt.newFoundDocument(c,l,h,d),p=u.targetIds||[],v=u.removedTargetIds||[];n=new br(p,v,f.key,f)}else if("documentDelete"in t){t.documentDelete;var m=t.documentDelete;m.document;var g=Nr(e,m.document),y=m.readTime?Ir(m.readTime):Z.min(),b=qt.newNoDocument(g,y),w=m.removedTargetIds||[];n=new br([],w,b.key,b)}else if("documentRemove"in t){t.documentRemove;var x=t.documentRemove;x.document;var O=Nr(e,x.document),k=x.removedTargetIds||[];n=new br([],k,O,null)}else{if(!("filter"in t))return M();t.filter;var _=t.filter;_.targetId;var S=_.count||0,E=new er(S),A=_.targetId;n=new wr(A,E)}return n}(this.yt,e),n=function(e){if(!("targetChange"in e))return Z.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?Z.min():t.readTime?Ir(t.readTime):Z.min()}(e);return this.listener.Wo(t,n)}},{key:"zo",value:function(e){var t={};t.database=Ur(this.yt),t.addTarget=function(e,t){var n,r=t.target;return(n=Zt(r)?{documents:Yr(e,r)}:{query:Xr(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=Cr(e,t.resumeToken):t.snapshotVersion.compareTo(Z.min())>0&&(n.readTime=Mr(e,t.snapshotVersion.toTimestamp())),n}(this.yt,e);var n=function(e,t){var n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return M()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.yt,e);n&&(t.labels=n),this.Bo(t)}},{key:"Ho",value:function(e){var t={};t.database=Ur(this.yt),t.removeTarget=e,this.Bo(t)}}]),n}(fs),vs=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r,i,a,o,s){var u;return Object(f.a)(this,n),(u=t.call(this,e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,i,a,s)).yt=o,u.Jo=!1,u}return Object(p.a)(n,[{key:"Yo",get:function(){return this.Jo}},{key:"start",value:function(){this.Jo=!1,this.lastStreamToken=void 0,Object(i.a)(Object(a.a)(n.prototype),"start",this).call(this)}},{key:"Uo",value:function(){this.Jo&&this.Xo([])}},{key:"jo",value:function(e,t){return this.connection.wo("Write",e,t)}},{key:"onMessage",value:function(e){if(C(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();var t=function(e,t){return e&&e.length>0?(C(void 0!==t),e.map((function(e){return function(e,t){var n=e.updateTime?Ir(e.updateTime):Ir(t);return n.isEqual(Z.min())&&(n=Ir(t)),new Ln(n,e.transformResults||[])}(e,t)}))):[]}(e.writeResults,e.commitTime),n=Ir(e.commitTime);return this.listener.Zo(n,t)}return C(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}},{key:"eu",value:function(){var e={};e.database=Ur(this.yt),this.Bo(e)}},{key:"Xo",value:function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map((function(e){return Wr(t.yt,e)}))};this.Bo(n)}}]),n}(fs),ms=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r,i,a){var o;return Object(f.a)(this,n),(o=t.call(this)).authCredentials=e,o.appCheckCredentials=r,o.connection=i,o.yt=a,o.nu=!1,o}return Object(p.a)(n,[{key:"su",value:function(){if(this.nu)throw new R(P.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"ao",value:function(e,t,n){var r=this;return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(i){var a=Object(o.a)(i,2),s=a[0],u=a[1];return r.connection.ao(e,t,n,s,u)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===P.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new R(P.UNKNOWN,e.toString())}))}},{key:"_o",value:function(e,t,n,r){var i=this;return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(a){var s=Object(o.a)(a,2),u=s[0],c=s[1];return i.connection._o(e,t,n,u,c,r)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===P.UNAUTHENTICATED&&(i.authCredentials.invalidateToken(),i.appCheckCredentials.invalidateToken()),e):new R(P.UNKNOWN,e.toString())}))}},{key:"terminate",value:function(){this.nu=!0}}]),n}(function(){return Object(p.a)((function e(){Object(f.a)(this,e)}))}());var gs=function(){function e(t,n){Object(f.a)(this,e),this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}return Object(p.a)(e,[{key:"uu",value:function(){var e=this;0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return e.ru=null,e.au("Backend didn't respond within 10 seconds."),e.cu("Offline"),Promise.resolve()})))}},{key:"hu",value:function(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.cu("Offline")))}},{key:"set",value:function(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}},{key:"cu",value:function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:"au",value:function(e){var t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.ou?(A(t),this.ou=!1):E("OnlineStateTracker",t)}},{key:"lu",value:function(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}]),e}(),ys=Object(p.a)((function e(t,n,r,i,a){var o=this;Object(f.a)(this,e),this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=a,this.mu.Ur((function(e){r.enqueueAndForget(Object(c.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Ts(o),!e.t0){e.next=5;break}return E("RemoteStore","Restarting streams for network reachability change."),e.next=5,function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var n;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=I(t))._u.add(4),e.next=4,xs(n);case 4:return n.gu.set("Unknown"),n._u.delete(4),e.next=8,bs(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(o);case 5:case"end":return e.stop()}}),e)}))))})),this.gu=new gs(r,i)}));function bs(e){return ws.apply(this,arguments)}function ws(){return(ws=Object(c.a)(Object(u.a)().mark((function e(t){var n,r,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ts(t)){e.next=18;break}n=Object(s.a)(t.wu),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return i=r.value,e.next=8,i(!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,12,15,18]])})))).apply(this,arguments)}function xs(e){return Os.apply(this,arguments)}function Os(){return(Os=Object(c.a)(Object(u.a)().mark((function e(t){var n,r,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(s.a)(t.wu),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,i(!1);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})))).apply(this,arguments)}function ks(e,t){var n=I(e);n.du.has(t.targetId)||(n.du.set(t.targetId,t),js(n)?As(n):iu(n).ko()&&Ss(n,t))}function _s(e,t){var n=I(e),r=iu(n);n.du.delete(t),r.ko()&&Es(n,t),0===n.du.size&&(r.ko()?r.Fo():Ts(n)&&n.gu.set("Unknown"))}function Ss(e,t){e.yu.Ot(t.targetId),iu(e).zo(t)}function Es(e,t){e.yu.Ot(t),iu(e).Ho(t)}function As(e){e.yu=new kr({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},ne:function(t){return e.du.get(t)||null}}),iu(e).start(),e.gu.uu()}function js(e){return Ts(e)&&!iu(e).No()&&e.du.size>0}function Ts(e){return 0===I(e)._u.size}function Ms(e){e.yu=void 0}function Cs(e){return Ds.apply(this,arguments)}function Ds(){return(Ds=Object(c.a)(Object(u.a)().mark((function e(t){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.du.forEach((function(e,n){Ss(t,e)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Is(e,t){return Ps.apply(this,arguments)}function Ps(){return(Ps=Object(c.a)(Object(u.a)().mark((function e(t,n){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ms(t),js(t)?(t.gu.hu(n),As(t)):t.gu.set("Unknown");case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rs(e,t,n){return Ls.apply(this,arguments)}function Ls(){return Ls=Object(c.a)(Object(u.a)().mark((function e(t,n,r){var i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.gu.set("Online"),!(n instanceof xr&&2===n.state&&n.cause)){e.next=13;break}return e.prev=1,e.next=4,function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i,a,o;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.cause,i=Object(s.a)(n.targetIds),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=14;break}if(o=a.value,e.t0=t.du.has(o),!e.t0){e.next=12;break}return e.next=10,t.remoteSyncer.rejectListen(o,r);case 10:t.du.delete(o),t.yu.removeTarget(o);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(2),i.e(e.t1);case 19:return e.prev=19,i.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[2,16,19,22]])})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),E("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),e.t0),e.next=11,Ns(t,e.t0);case 11:case 22:e.next=29;break;case 13:if(n instanceof br?t.yu.Kt(n):n instanceof wr?t.yu.Jt(n):t.yu.jt(n),r.isEqual(Z.min())){e.next=29;break}return e.prev=14,e.next=17,Io(t.localStore);case 17:if(i=e.sent,e.t1=r.compareTo(i)>=0,!e.t1){e.next=22;break}return e.next=22,function(e,t){var n=e.yu.Zt(t);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=e.du.get(r);i&&e.du.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((function(t){var n=e.du.get(t);if(n){e.du.set(t,n.withResumeToken(Be.EMPTY_BYTE_STRING,n.snapshotVersion)),Es(e,t);var r=new Ni(n.target,t,1,n.sequenceNumber);Ss(e,r)}})),e.remoteSyncer.applyRemoteEvent(n)}(t,r);case 24:return e.prev=24,e.t2=e.catch(14),E("RemoteStore","Failed to raise snapshot:",e.t2),e.next=29,Ns(t,e.t2);case 29:case"end":return e.stop()}}),e,null,[[1,6],[14,24]])}))),Ls.apply(this,arguments)}function Ns(e,t,n){return Bs.apply(this,arguments)}function Bs(){return(Bs=Object(c.a)(Object(u.a)().mark((function e(t,n,r){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(xe(n)){e.next=2;break}throw n;case 2:return t._u.add(1),e.next=5,xs(t);case 5:t.gu.set("Offline"),r||(r=function(){return Io(t.localStore)}),t.asyncQueue.enqueueRetryable(Object(c.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E("RemoteStore","Retrying IndexedDB access"),e.next=3,r();case 3:return t._u.delete(1),e.next=6,bs(t);case 6:case"end":return e.stop()}}),e)}))));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fs(e,t){return t().catch((function(n){return Ns(e,n,t)}))}function Us(e){return zs.apply(this,arguments)}function zs(){return(zs=Object(c.a)(Object(u.a)().mark((function e(t){var n,r,i,a;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=I(t),r=au(n),i=n.fu.length>0?n.fu[n.fu.length-1].batchId:-1;case 2:if(!Vs(n)){e.next=19;break}return e.prev=3,e.next=6,Lo(n.localStore,i);case 6:if(null!==(a=e.sent)){e.next=10;break}return 0===n.fu.length&&r.Fo(),e.abrupt("break",19);case 10:i=a.batchId,Gs(n,a),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),e.next=17,Ns(n,e.t0);case 17:e.next=2;break;case 19:Hs(n)&&Ws(n);case 20:case"end":return e.stop()}}),e,null,[[3,13]])})))).apply(this,arguments)}function Vs(e){return Ts(e)&&e.fu.length<10}function Gs(e,t){e.fu.push(t);var n=au(e);n.ko()&&n.Yo&&n.Xo(t.mutations)}function Hs(e){return Ts(e)&&!au(e).No()&&e.fu.length>0}function Ws(e){au(e).start()}function qs(e){return Ys.apply(this,arguments)}function Ys(){return(Ys=Object(c.a)(Object(u.a)().mark((function e(t){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:au(t).eu();case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xs(e){return Ks.apply(this,arguments)}function Ks(){return(Ks=Object(c.a)(Object(u.a)().mark((function e(t){var n,r,i,a;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=au(t),r=Object(s.a)(t.fu);try{for(r.s();!(i=r.n()).done;)a=i.value,n.Xo(a.mutations)}catch(o){r.e(o)}finally{r.f()}case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qs(e,t,n){return Zs.apply(this,arguments)}function Zs(){return(Zs=Object(c.a)(Object(u.a)().mark((function e(t,n,r){var i,a;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.fu.shift(),a=Ri.from(i,n,r),e.next=3,Fs(t,(function(){return t.remoteSyncer.applySuccessfulWrite(a)}));case 3:return e.next=5,Us(t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Js(e,t){return $s.apply(this,arguments)}function $s(){return $s=Object(c.a)(Object(u.a)().mark((function e(t,n){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n&&au(t).Yo,!e.t0){e.next=4;break}return e.next=4,function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!tr(i=n.code)||i===P.ABORTED){e.next=7;break}return r=t.fu.shift(),au(t).Mo(),e.next=5,Fs(t,(function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)}));case 5:return e.next=7,Us(t);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:Hs(t)&&Ws(t);case 5:case"end":return e.stop()}}),e)}))),$s.apply(this,arguments)}function eu(e,t){return tu.apply(this,arguments)}function tu(){return(tu=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=I(t)).asyncQueue.verifyOperationInProgress(),E("RemoteStore","RemoteStore received new credentials"),i=Ts(r),r._u.add(3),e.next=6,xs(r);case 6:return i&&r.gu.set("Unknown"),e.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r._u.delete(3),e.next=12,bs(r);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nu(e,t){return ru.apply(this,arguments)}function ru(){return(ru=Object(c.a)(Object(u.a)().mark((function e(t,n){var r;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=I(t),!n){e.next=7;break}return r._u.delete(2),e.next=5,bs(r);case 5:e.next=13;break;case 7:if(e.t0=n,e.t0){e.next=13;break}return r._u.add(2),e.next=12,xs(r);case 12:r.gu.set("Unknown");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function iu(e){return e.pu||(e.pu=function(e,t,n){var r=I(e);return r.su(),new ps(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,n)}(e.datastore,e.asyncQueue,{Yr:Cs.bind(null,e),Zr:Is.bind(null,e),Wo:Rs.bind(null,e)}),e.wu.push(function(){var t=Object(c.a)(Object(u.a)().mark((function t(n){return Object(u.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}e.pu.Mo(),js(e)?As(e):e.gu.set("Unknown"),t.next=7;break;case 4:return t.next=6,e.pu.stop();case 6:Ms(e);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.pu}function au(e){return e.Iu||(e.Iu=function(e,t,n){var r=I(e);return r.su(),new vs(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,n)}(e.datastore,e.asyncQueue,{Yr:qs.bind(null,e),Zr:Js.bind(null,e),tu:Xs.bind(null,e),Zo:Qs.bind(null,e)}),e.wu.push(function(){var t=Object(c.a)(Object(u.a)().mark((function t(n){return Object(u.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return e.Iu.Mo(),t.next=4,Us(e);case 4:t.next=9;break;case 6:return t.next=8,e.Iu.stop();case 8:e.fu.length>0&&(E("RemoteStore","Stopping write stream with ".concat(e.fu.length," pending writes")),e.fu=[]);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.Iu}var ou=function(){function e(t,n,r,i,a){Object(f.a)(this,e),this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new L,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(e){}))}return Object(p.a)(e,[{key:"start",value:function(e){var t=this;this.timerHandle=setTimeout((function(){return t.handleDelayElapsed()}),e)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new R(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function(){var e=this;this.asyncQueue.enqueueAndForget((function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then((function(t){return e.deferred.resolve(t)}))):Promise.resolve()}))}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}))}],[{key:"createAndSchedule",value:function(t,n,r,i,a){var o=new e(t,n,Date.now()+r,i,a);return o.start(r),o}}]),e}();function su(e,t){if(A("AsyncQueue","".concat(t,": ").concat(e)),xe(e))return new R(P.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}var uu=function(){function e(t){Object(f.a)(this,e),this.comparator=t?function(e,n){return t(e,n)||ne.comparator(e.key,n.key)}:function(e,t){return ne.comparator(e.key,t.key)},this.keyedMap=sr(),this.sortedSet=new Nt(this.comparator)}return Object(p.a)(e,[{key:"has",value:function(e){return null!=this.keyedMap.get(e)}},{key:"get",value:function(e){return this.keyedMap.get(e)}},{key:"first",value:function(){return this.sortedSet.minKey()}},{key:"last",value:function(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}},{key:"size",get:function(){return this.sortedSet.size}},{key:"forEach",value:function(e){this.sortedSet.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"add",value:function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}},{key:"delete",value:function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}},{key:"copy",value:function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}}],[{key:"emptySet",value:function(t){return new e(t.comparator)}}]),e}(),cu=function(){function e(){Object(f.a)(this,e),this.Tu=new Nt(ne.comparator)}return Object(p.a)(e,[{key:"track",value:function(e){var t=e.doc.key,n=this.Tu.get(t);n?0!==e.type&&3===n.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==n.type?this.Tu=this.Tu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Tu=this.Tu.remove(t):1===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):M():this.Tu=this.Tu.insert(t,e)}},{key:"Eu",value:function(){var e=[];return this.Tu.inorderTraversal((function(t,n){e.push(n)})),e}}]),e}(),lu=function(){function e(t,n,r,i,a,o,s,u,c){Object(f.a)(this,e),this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=u,this.hasCachedResults=c}return Object(p.a)(e,[{key:"hasPendingWrites",get:function(){return!this.mutatedKeys.isEmpty()}},{key:"isEqual",value:function(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&fn(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}],[{key:"fromInitialDocuments",value:function(t,n,r,i,a){var o=[];return n.forEach((function(e){o.push({type:0,doc:e})})),new e(t,n,uu.emptySet(n),o,r,i,!0,!1,a)}}]),e}(),hu=Object(p.a)((function e(){Object(f.a)(this,e),this.Au=void 0,this.listeners=[]})),du=Object(p.a)((function e(){Object(f.a)(this,e),this.queries=new rr((function(e){return pn(e)}),fn),this.onlineState="Unknown",this.Ru=new Set}));function fu(e,t){return pu.apply(this,arguments)}function pu(){return(pu=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i,a,o,s;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=I(t),i=n.query,a=!1,(o=r.queries.get(i))||(a=!0,o=new hu),!a){e.next=13;break}return e.prev=3,e.next=6,r.onListen(i);case 6:o.Au=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),s=su(e.t0,"Initialization of query '".concat(vn(n.query),"' failed")),e.abrupt("return",void n.onError(s));case 13:r.queries.set(i,o),o.listeners.push(n),n.bu(r.onlineState),o.Au&&n.Pu(o.Au)&&bu(r);case 14:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}function vu(e,t){return mu.apply(this,arguments)}function mu(){return(mu=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i,a,o,s;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=I(t),i=n.query,a=!1,(o=r.queries.get(i))&&(s=o.listeners.indexOf(n))>=0&&(o.listeners.splice(s,1),a=0===o.listeners.length),!a){e.next=6;break}return e.abrupt("return",(r.queries.delete(i),r.onUnlisten(i)));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gu(e,t){var n,r=I(e),i=!1,a=Object(s.a)(t);try{for(a.s();!(n=a.n()).done;){var o=n.value,u=o.query,c=r.queries.get(u);if(c){var l,h=Object(s.a)(c.listeners);try{for(h.s();!(l=h.n()).done;){l.value.Pu(o)&&(i=!0)}}catch(d){h.e(d)}finally{h.f()}c.Au=o}}}catch(d){a.e(d)}finally{a.f()}i&&bu(r)}function yu(e,t,n){var r=I(e),i=r.queries.get(t);if(i){var a,o=Object(s.a)(i.listeners);try{for(o.s();!(a=o.n()).done;){a.value.onError(n)}}catch(u){o.e(u)}finally{o.f()}}r.queries.delete(t)}function bu(e){e.Ru.forEach((function(e){e.next()}))}var wu=function(){function e(t,n,r){Object(f.a)(this,e),this.query=t,this.vu=n,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=r||{}}return Object(p.a)(e,[{key:"Pu",value:function(e){if(!this.options.includeMetadataChanges){var t,n=[],r=Object(s.a)(e.docChanges);try{for(r.s();!(t=r.n()).done;){var i=t.value;3!==i.type&&n.push(i)}}catch(o){r.e(o)}finally{r.f()}e=new lu(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}var a=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),a=!0):this.Cu(e,this.onlineState)&&(this.xu(e),a=!0),this.Su=e,a}},{key:"onError",value:function(e){this.vu.error(e)}},{key:"bu",value:function(e){this.onlineState=e;var t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}},{key:"Cu",value:function(e,t){if(!e.fromCache)return!0;var n="Offline"!==t;return(!this.options.Nu||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}},{key:"Du",value:function(e){if(e.docChanges.length>0)return!0;var t=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}},{key:"xu",value:function(e){e=lu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}]),e}(),xu=function(){function e(t,n){Object(f.a)(this,e),this.ku=t,this.byteLength=n}return Object(p.a)(e,[{key:"Ou",value:function(){return"metadata"in this.ku}}]),e}(),Ou=function(){function e(t){Object(f.a)(this,e),this.yt=t}return Object(p.a)(e,[{key:"Ji",value:function(e){return Nr(this.yt,e)}},{key:"Yi",value:function(e){return e.metadata.exists?Gr(this.yt,e.document,!1):qt.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}},{key:"Xi",value:function(e){return Ir(e)}}]),e}(),ku=function(){function e(t,n,r){Object(f.a)(this,e),this.Mu=t,this.localStore=n,this.yt=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=_u(t)}return Object(p.a)(e,[{key:"Fu",value:function(e){this.progress.bytesLoaded+=e.byteLength;var t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;var n=$.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}},{key:"$u",value:function(e){var t,n=new Map,r=new Ou(this.yt),i=Object(s.a)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.metadata.queries){var o,u=r.Ji(a.metadata.name),c=Object(s.a)(a.metadata.queries);try{for(c.s();!(o=c.n()).done;){var l=o.value,h=(n.get(l)||pr()).add(u);n.set(l,h)}}catch(d){c.e(d)}finally{c.f()}}}}catch(d){i.e(d)}finally{i.f()}return n}},{key:"complete",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t,n,r,i,a;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ho(this.localStore,new Ou(this.yt),this.documents,this.Mu.id);case 2:t=e.sent,n=this.$u(this.documents),r=Object(s.a)(this.queries),e.prev=5,r.s();case 7:if((i=r.n()).done){e.next=13;break}return a=i.value,e.next=11,qo(this.localStore,a,n.get(a.name));case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",(this.progress.taskState="Success",{progress:this.progress,Bu:this.collectionGroups,Lu:t}));case 22:case"end":return e.stop()}}),e,this,[[5,15,18,21]])})));return function(){return e.apply(this,arguments)}}()}]),e}();function _u(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}var Su=Object(p.a)((function e(t){Object(f.a)(this,e),this.key=t})),Eu=Object(p.a)((function e(t){Object(f.a)(this,e),this.key=t})),Au=function(){function e(t,n){Object(f.a)(this,e),this.query=t,this.qu=n,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=pr(),this.mutatedKeys=pr(),this.Gu=yn(t),this.Qu=new uu(this.Gu)}return Object(p.a)(e,[{key:"ju",get:function(){return this.qu}},{key:"Wu",value:function(e,t){var n=this,r=t?t.zu:new cu,i=t?t.Qu:this.Qu,a=t?t.mutatedKeys:this.mutatedKeys,o=i,s=!1,u="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((function(e,t){var l=i.get(e),h=mn(n.query,t)?t:null,d=!!l&&n.mutatedKeys.has(l.key),f=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),p=!1;l&&h?l.data.isEqual(h.data)?d!==f&&(r.track({type:3,doc:h}),p=!0):n.Hu(l,h)||(r.track({type:2,doc:h}),p=!0,(u&&n.Gu(h,u)>0||c&&n.Gu(h,c)<0)&&(s=!0)):!l&&h?(r.track({type:0,doc:h}),p=!0):l&&!h&&(r.track({type:1,doc:l}),p=!0,(u||c)&&(s=!0)),p&&(h?(o=o.add(h),a=f?a.add(e):a.delete(e)):(o=o.delete(e),a=a.delete(e)))})),null!==this.query.limit)for(;o.size>this.query.limit;){var l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),a=a.delete(l.key),r.track({type:1,doc:l})}return{Qu:o,zu:r,$i:s,mutatedKeys:a}}},{key:"Hu",value:function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}},{key:"applyChanges",value:function(e,t,n){var r=this,i=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;var a=e.zu.Eu();a.sort((function(e,t){return function(e,t){var n=function(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M()}};return n(e)-n(t)}(e.type,t.type)||r.Gu(e.doc,t.doc)})),this.Ju(n);var o=t?this.Yu():[],s=0===this.Ku.size&&this.current?1:0,u=s!==this.Uu;return this.Uu=s,0!==a.length||u?{snapshot:new lu(this.query,e.Qu,i,a,e.mutatedKeys,0===s,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),Xu:o}:{Xu:o}}},{key:"bu",value:function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new cu,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}},{key:"Zu",value:function(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}},{key:"Ju",value:function(e){var t=this;e&&(e.addedDocuments.forEach((function(e){return t.qu=t.qu.add(e)})),e.modifiedDocuments.forEach((function(e){})),e.removedDocuments.forEach((function(e){return t.qu=t.qu.delete(e)})),this.current=e.current)}},{key:"Yu",value:function(){var e=this;if(!this.current)return[];var t=this.Ku;this.Ku=pr(),this.Qu.forEach((function(t){e.Zu(t.key)&&(e.Ku=e.Ku.add(t.key))}));var n=[];return t.forEach((function(t){e.Ku.has(t)||n.push(new Eu(t))})),this.Ku.forEach((function(e){t.has(e)||n.push(new Su(e))})),n}},{key:"tc",value:function(e){this.qu=e.Hi,this.Ku=pr();var t=this.Wu(e.documents);return this.applyChanges(t,!0)}},{key:"ec",value:function(){return lu.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}]),e}(),ju=Object(p.a)((function e(t,n,r){Object(f.a)(this,e),this.query=t,this.targetId=n,this.view=r})),Tu=Object(p.a)((function e(t){Object(f.a)(this,e),this.key=t,this.nc=!1})),Mu=function(){function e(t,n,r,i,a,o){Object(f.a)(this,e),this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.sc={},this.ic=new rr((function(e){return pn(e)}),fn),this.rc=new Map,this.oc=new Set,this.uc=new Nt(ne.comparator),this.cc=new Map,this.ac=new co,this.hc={},this.lc=new Map,this.fc=Fa.vn(),this.onlineState="Unknown",this.dc=void 0}return Object(p.a)(e,[{key:"isPrimaryClient",get:function(){return!0===this.dc}}]),e}();function Cu(e,t){return Du.apply(this,arguments)}function Du(){return(Du=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i,a,o,s,c;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=_c(t),!(o=r.ic.get(n))){e.next=6;break}i=o.targetId,r.sharedClientState.addLocalQueryTarget(i),a=o.view.ec(),e.next=15;break;case 6:return e.next=8,No(r.localStore,ln(n));case 8:return s=e.sent,r.isPrimaryClient&&ks(r.remoteStore,s),c=r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.targetId,e.next=14,Iu(r,n,i,"current"===c,s.resumeToken);case 14:a=e.sent;case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Iu(e,t,n,r,i){return Pu.apply(this,arguments)}function Pu(){return Pu=Object(c.a)(Object(u.a)().mark((function e(t,n,r,i,a){var o,s,l,h,d,f;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t._c=function(e,n,r){return function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,n,r,i){var a,o,s;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.view.Wu(r),e.t0=a.$i,!e.t0){e.next=6;break}return e.next=5,Uo(t.localStore,n.query,!1).then((function(e){var t=e.documents;return n.view.Wu(t,a)}));case 5:a=e.sent;case 6:return o=i&&i.targetChanges.get(n.targetId),s=n.view.applyChanges(a,t.isPrimaryClient,o),e.abrupt("return",(ec(t,n.targetId,s.Xu),s.snapshot));case 8:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()(t,e,n,r)},e.next=3,Uo(t.localStore,n,!0);case 3:return o=e.sent,s=new Au(n,o.Hi),l=s.Wu(o.documents),h=yr.createSynthesizedTargetChangeForCurrentChange(r,i&&"Offline"!==t.onlineState,a),d=s.applyChanges(l,t.isPrimaryClient,h),ec(t,r,d.Xu),f=new ju(n,r,s),e.abrupt("return",(t.ic.set(n,f),t.rc.has(r)?t.rc.get(r).push(n):t.rc.set(r,[n]),d.snapshot));case 11:case"end":return e.stop()}}),e)}))),Pu.apply(this,arguments)}function Ru(e,t){return Lu.apply(this,arguments)}function Lu(){return(Lu=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i,a;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=I(t),i=r.ic.get(n),!((a=r.rc.get(i.targetId)).length>1)){e.next=3;break}return e.abrupt("return",(r.rc.set(i.targetId,a.filter((function(e){return!fn(e,n)}))),void r.ic.delete(n)));case 3:if(!r.isPrimaryClient){e.next=11;break}if(r.sharedClientState.removeLocalQueryTarget(i.targetId),e.t0=r.sharedClientState.isActiveQueryTarget(i.targetId),e.t0){e.next=9;break}return e.next=9,Bo(r.localStore,i.targetId,!1).then((function(){r.sharedClientState.clearQueryState(i.targetId),_s(r.remoteStore,i.targetId),Ju(r,i.targetId)})).catch(pe);case 9:e.next=14;break;case 11:return Ju(r,i.targetId),e.next=14,Bo(r.localStore,i.targetId,!0);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nu(e,t,n){return Bu.apply(this,arguments)}function Bu(){return(Bu=Object(c.a)(Object(u.a)().mark((function e(t,n,r){var i,a,o;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Sc(t),e.prev=1,e.next=4,function(e,t){var n,r,i=I(e),a=Q.now(),o=t.reduce((function(e,t){return e.add(t.key)}),pr());return i.persistence.runTransaction("Locally write mutations","readwrite",(function(e){var u=ar(),c=pr();return i.Gi.getEntries(e,o).next((function(e){(u=e).forEach((function(e,t){t.isValidDocument()||(c=c.add(e))}))})).next((function(){return i.localDocuments.getOverlayedDocuments(e,u)})).next((function(r){n=r;var o,u=[],c=Object(s.a)(t);try{for(c.s();!(o=c.n()).done;){var l=o.value,h=Gn(l,n.get(l.key).overlayedDocument);null!=h&&u.push(new qn(l.key,h,Wt(h.value.mapValue),Nn.exists(!0)))}}catch(d){c.e(d)}finally{c.f()}return i.mutationQueue.addMutationBatch(e,a,u,t)})).next((function(t){r=t;var a=t.applyToLocalDocumentSet(n,c);return i.documentOverlayCache.saveOverlays(e,t.batchId,a)}))})).then((function(){return{batchId:r.batchId,changes:ur(n)}}))}(i.localStore,n);case 4:return a=e.sent,i.sharedClientState.addPendingMutation(a.batchId),function(e,t,n){var r=e.hc[e.currentUser.toKey()];r||(r=new Nt(Y)),r=r.insert(t,n),e.hc[e.currentUser.toKey()]=r}(i,a.batchId,r),e.next=9,rc(i,a.changes);case 9:return e.next=11,Us(i.remoteStore);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),o=su(e.t0,"Failed to persist write"),r.reject(o);case 17:case"end":return e.stop()}}),e,null,[[1,13]])})))).apply(this,arguments)}function Fu(e,t){return Uu.apply(this,arguments)}function Uu(){return(Uu=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=I(t),e.prev=1,e.next=4,Po(r.localStore,n);case 4:return i=e.sent,n.targetChanges.forEach((function(e,t){var n=r.cc.get(t);n&&(C(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.nc=!0:e.modifiedDocuments.size>0?C(n.nc):e.removedDocuments.size>0&&(C(n.nc),n.nc=!1))})),e.next=8,rc(r,i,n);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,pe(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})))).apply(this,arguments)}function zu(e,t,n){var r=I(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.ic.forEach((function(e,n){var r=n.view.bu(t);r.snapshot&&i.push(r.snapshot)})),function(e,t){var n=I(e);n.onlineState=t;var r=!1;n.queries.forEach((function(e,n){var i,a=Object(s.a)(n.listeners);try{for(a.s();!(i=a.n()).done;){i.value.bu(t)&&(r=!0)}}catch(o){a.e(o)}finally{a.f()}})),r&&bu(n)}(r.eventManager,t),i.length&&r.sc.Wo(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Vu(e,t,n){return Gu.apply(this,arguments)}function Gu(){return(Gu=Object(c.a)(Object(u.a)().mark((function e(t,n,r){var i,a,o,s,c,l;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=I(t)).sharedClientState.updateQueryState(n,"rejected",r),a=i.cc.get(n),!(o=a&&a.key)){e.next=14;break}return s=(s=new Nt(ne.comparator)).insert(o,qt.newNoDocument(o,Z.min())),c=pr().add(o),l=new gr(Z.min(),new Map,new Ut(Y),s,c),e.next=9,Fu(i,l);case 9:i.uc=i.uc.remove(o),i.cc.delete(n),nc(i),e.next=16;break;case 14:return e.next=16,Bo(i.localStore,n,!1).then((function(){return Ju(i,n,r)})).catch(pe);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Hu(e,t){return Wu.apply(this,arguments)}function Wu(){return(Wu=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i,a;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=I(t),i=n.batch.batchId,e.prev=1,e.next=4,Do(r.localStore,n);case 4:return a=e.sent,Zu(r,i,null),Qu(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),e.next=10,rc(r,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,pe(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}function qu(e,t,n){return Yu.apply(this,arguments)}function Yu(){return(Yu=Object(c.a)(Object(u.a)().mark((function e(t,n,r){var i,a;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=I(t),e.prev=1,e.next=4,function(e,t){var n=I(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(e){var r;return n.mutationQueue.lookupMutationBatch(e,t).next((function(t){return C(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)})).next((function(){return n.mutationQueue.performConsistencyCheck(e)})).next((function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)})).next((function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)})).next((function(){return n.localDocuments.getDocuments(e,r)}))}))}(i.localStore,n);case 4:return a=e.sent,Zu(i,n,r),Qu(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),e.next=10,rc(i,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,pe(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}function Xu(e,t){return Ku.apply(this,arguments)}function Ku(){return(Ku=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i,a,o;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ts((r=I(t)).remoteStore)||E("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),e.prev=2,e.next=5,function(e){var t=I(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(e){return t.mutationQueue.getHighestUnacknowledgedBatchId(e)}))}(r.localStore);case 5:if(-1!==(i=e.sent)){e.next=8;break}return e.abrupt("return",void n.resolve());case 8:(a=r.lc.get(i)||[]).push(n),r.lc.set(i,a),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),o=su(e.t0,"Initialization of waitForPendingWrites() operation failed"),n.reject(o);case 16:case"end":return e.stop()}}),e,null,[[2,12]])})))).apply(this,arguments)}function Qu(e,t){(e.lc.get(t)||[]).forEach((function(e){e.resolve()})),e.lc.delete(t)}function Zu(e,t,n){var r=I(e),i=r.hc[r.currentUser.toKey()];if(i){var a=i.get(t);a&&(n?a.reject(n):a.resolve(),i=i.remove(t)),r.hc[r.currentUser.toKey()]=i}}function Ju(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);var r,i=Object(s.a)(e.rc.get(t));try{for(i.s();!(r=i.n()).done;){var a=r.value;e.ic.delete(a),n&&e.sc.wc(a,n)}}catch(o){i.e(o)}finally{i.f()}e.rc.delete(t),e.isPrimaryClient&&e.ac.ls(t).forEach((function(t){e.ac.containsKey(t)||$u(e,t)}))}function $u(e,t){e.oc.delete(t.path.canonicalString());var n=e.uc.get(t);null!==n&&(_s(e.remoteStore,n),e.uc=e.uc.remove(t),e.cc.delete(n),nc(e))}function ec(e,t,n){var r,i=Object(s.a)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;a instanceof Su?(e.ac.addReference(a.key,t),tc(e,a)):a instanceof Eu?(E("SyncEngine","Document no longer in limbo: "+a.key),e.ac.removeReference(a.key,t),e.ac.containsKey(a.key)||$u(e,a.key)):M()}}catch(o){i.e(o)}finally{i.f()}}function tc(e,t){var n=t.key,r=n.path.canonicalString();e.uc.get(n)||e.oc.has(r)||(E("SyncEngine","New document in limbo: "+n),e.oc.add(r),nc(e))}function nc(e){for(;e.oc.size>0&&e.uc.size<e.maxConcurrentLimboResolutions;){var t=e.oc.values().next().value;e.oc.delete(t);var n=new ne($.fromString(t)),r=e.fc.next();e.cc.set(r,new Tu(n)),e.uc=e.uc.insert(n,r),ks(e.remoteStore,new Ni(ln(rn(n.path)),r,2,je.at))}}function rc(e,t,n){return ic.apply(this,arguments)}function ic(){return ic=Object(c.a)(Object(u.a)().mark((function e(t,n,r){var i,a,o,l;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=I(t),a=[],o=[],l=[],e.t0=i.ic.isEmpty(),e.t0){e.next=9;break}return i.ic.forEach((function(e,t){l.push(i._c(t,n,r).then((function(e){if((e||r)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){a.push(e);var n=Eo.Ci(t.targetId,e);o.push(n)}})))})),e.next=6,Promise.all(l);case 6:return i.sc.Wo(a),e.next=9,function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i,a,o,c,l,h,d;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=I(t),e.prev=1,e.next=4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(e){return me.forEach(n,(function(t){return me.forEach(t.Si,(function(n){return r.persistence.referenceDelegate.addReference(e,t.targetId,n)})).next((function(){return me.forEach(t.Di,(function(n){return r.persistence.referenceDelegate.removeReference(e,t.targetId,n)}))}))}))}));case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),xe(e.t0)){e.next=10;break}throw e.t0;case 10:E("LocalStore","Failed to update sequence numbers: "+e.t0);case 11:i=Object(s.a)(n);try{for(i.s();!(a=i.n()).done;)o=a.value,c=o.targetId,o.fromCache||(l=r.qi.get(c),h=l.snapshotVersion,d=l.withLastLimboFreeSnapshotVersion(h),r.qi=r.qi.insert(c,d))}catch(u){i.e(u)}finally{i.f()}case 13:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}()(i.localStore,o);case 9:case"end":return e.stop()}}),e)}))),ic.apply(this,arguments)}function ac(e,t){return oc.apply(this,arguments)}function oc(){return(oc=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=I(t)).currentUser.isEqual(n)){e.next=11;break}return E("SyncEngine","User change. New user:",n.toKey()),e.next=5,Mo(r.localStore,n);case 5:return i=e.sent,r.currentUser=n,function(e,t){e.lc.forEach((function(e){e.forEach((function(e){e.reject(new R(P.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.lc.clear()}(r),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),e.next=11,rc(r,i.ji);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sc(e,t){var n=I(e),r=n.cc.get(t);if(r&&r.nc)return pr().add(r.key);var i=pr(),a=n.rc.get(t);if(!a)return i;var o,u=Object(s.a)(a);try{for(u.s();!(o=u.n()).done;){var c=o.value,l=n.ic.get(c);i=i.unionWith(l.view.ju)}}catch(h){u.e(h)}finally{u.f()}return i}function uc(e,t){return cc.apply(this,arguments)}function cc(){return(cc=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i,a;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=I(t),e.next=3,Uo(r.localStore,n.query,!0);case 3:return i=e.sent,a=n.view.tc(i),e.abrupt("return",(r.isPrimaryClient&&ec(r,n.targetId,a.Xu),a));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lc(e,t){return hc.apply(this,arguments)}function hc(){return(hc=Object(c.a)(Object(u.a)().mark((function e(t,n){var r;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=I(t),e.abrupt("return",Vo(r.localStore,n).then((function(e){return rc(r,e)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dc(e,t,n,r){return fc.apply(this,arguments)}function fc(){return(fc=Object(c.a)(Object(u.a)().mark((function e(t,n,r,i){var a,o;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=I(t),e.next=3,function(e,t){var n=I(e),r=I(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(e){return r.Tn(e,t).next((function(t){return t?n.localDocuments.getDocuments(e,t):me.resolve(null)}))}))}(a.localStore,n);case 3:if(null===(o=e.sent)){e.next=15;break}if("pending"!==r){e.next=10;break}return e.next=8,Us(a.remoteStore);case 8:e.next=11;break;case 10:"acknowledged"===r||"rejected"===r?(Zu(a,n,i||null),Qu(a,n),function(e,t){I(I(e).mutationQueue).An(t)}(a.localStore,n)):M();case 11:return e.next=13,rc(a,o);case 13:e.next=16;break;case 15:E("SyncEngine","Cannot apply mutation batch with id: "+n);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pc(e,t){return vc.apply(this,arguments)}function vc(){return(vc=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i,a,o,c,l,h,d;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_c(r=I(t)),Sc(r),!0!==n||!0===r.dc){e.next=13;break}return i=r.sharedClientState.getAllActiveQueryTargets(),e.next=5,mc(r,i.toArray());case 5:return a=e.sent,r.dc=!0,e.next=9,nu(r.remoteStore,!0);case 9:o=Object(s.a)(a);try{for(o.s();!(c=o.n()).done;)l=c.value,ks(r.remoteStore,l)}catch(u){o.e(u)}finally{o.f()}e.next=25;break;case 13:if(!1!==n||!1===r.dc){e.next=25;break}return h=[],d=Promise.resolve(),r.rc.forEach((function(e,t){r.sharedClientState.isLocalQueryTarget(t)?h.push(t):d=d.then((function(){return Ju(r,t),Bo(r.localStore,t,!0)})),_s(r.remoteStore,t)})),e.next=19,d;case 19:return e.next=21,mc(r,h);case 21:return function(e){var t=I(e);t.cc.forEach((function(e,n){_s(t.remoteStore,n)})),t.ac.fs(),t.cc=new Map,t.uc=new Nt(ne.comparator)}(r),r.dc=!1,e.next=25,nu(r.remoteStore,!1);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mc(e,t,n){return gc.apply(this,arguments)}function gc(){return(gc=Object(c.a)(Object(u.a)().mark((function e(t,n,r){var i,a,o,c,l,h,d,f,p,v,m,g,y,b;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=I(t),a=[],o=[],c=Object(s.a)(n),e.prev=2,c.s();case 4:if((l=c.n()).done){e.next=45;break}if(h=l.value,d=void 0,!(f=i.rc.get(h))||0===f.length){e.next=34;break}return e.next=11,No(i.localStore,ln(f[0]));case 11:d=e.sent,p=Object(s.a)(f),e.prev=13,p.s();case 15:if((v=p.n()).done){e.next=24;break}return m=v.value,g=i.ic.get(m),e.next=20,uc(i,g);case 20:(y=e.sent).snapshot&&o.push(y.snapshot);case 22:e.next=15;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),p.e(e.t0);case 29:return e.prev=29,p.f(),e.finish(29);case 32:e.next=42;break;case 34:return e.next=36,zo(i.localStore,h);case 36:return b=e.sent,e.next=39,No(i.localStore,b);case 39:return d=e.sent,e.next=42,Iu(i,yc(b),h,!1,d.resumeToken);case 42:a.push(d);case 43:e.next=4;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(2),c.e(e.t1);case 50:return e.prev=50,c.f(),e.finish(50);case 53:return e.abrupt("return",(i.sc.Wo(o),a));case 54:case"end":return e.stop()}}),e,null,[[2,47,50,53],[13,26,29,32]])})))).apply(this,arguments)}function yc(e){return nn(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function bc(e){var t=I(e);return I(I(t.localStore).persistence).vi()}function wc(e,t,n,r){return xc.apply(this,arguments)}function xc(){return(xc=Object(c.a)(Object(u.a)().mark((function e(t,n,r,i){var a,o,s,c;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=I(t)).dc){e.next=3;break}return e.abrupt("return",void E("SyncEngine","Ignoring unexpected query state notification."));case 3:if(!((o=a.rc.get(n))&&o.length>0)){e.next=20;break}e.t0=r,e.next="current"===e.t0||"not-current"===e.t0?8:"rejected"===e.t0?15:19;break;case 8:return e.next=10,Vo(a.localStore,gn(o[0]));case 10:return s=e.sent,c=gr.createSynthesizedRemoteEventForCurrentChange(n,"current"===r,Be.EMPTY_BYTE_STRING),e.next=14,rc(a,s,c);case 14:return e.abrupt("break",20);case 15:return e.next=17,Bo(a.localStore,n,!0);case 17:return Ju(a,n,i),e.abrupt("break",20);case 19:M();case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oc(e,t,n){return kc.apply(this,arguments)}function kc(){return(kc=Object(c.a)(Object(u.a)().mark((function e(t,n,r){var i,a,o,c,l,h,d,f,p;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=_c(t)).dc){e.next=45;break}a=Object(s.a)(n),e.prev=3,a.s();case 5:if((o=a.n()).done){e.next=21;break}if(c=o.value,!i.rc.has(c)){e.next=10;break}return E("SyncEngine","Adding an already active target "+c),e.abrupt("continue",19);case 10:return e.next=12,zo(i.localStore,c);case 12:return l=e.sent,e.next=15,No(i.localStore,l);case 15:return h=e.sent,e.next=18,Iu(i,yc(l),h.targetId,!1,h.resumeToken);case 18:ks(i.remoteStore,h);case 19:e.next=5;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),a.e(e.t0);case 26:return e.prev=26,a.f(),e.finish(26);case 29:d=Object(s.a)(r),e.prev=30,p=Object(u.a)().mark((function e(){var t;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.value,e.t0=i.rc.has(t),!e.t0){e.next=5;break}return e.next=5,Bo(i.localStore,t,!1).then((function(){_s(i.remoteStore,t),Ju(i,t)})).catch(pe);case 5:case"end":return e.stop()}}),e)})),d.s();case 33:if((f=d.n()).done){e.next=37;break}return e.delegateYield(p(),"t1",35);case 35:e.next=33;break;case 37:e.next=42;break;case 39:e.prev=39,e.t2=e.catch(30),d.e(e.t2);case 42:return e.prev=42,d.f(),e.finish(42);case 45:case"end":return e.stop()}}),e,null,[[3,23,26,29],[30,39,42,45]])})))).apply(this,arguments)}function _c(e){var t=I(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Fu.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=sc.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Vu.bind(null,t),t.sc.Wo=gu.bind(null,t.eventManager),t.sc.wc=yu.bind(null,t.eventManager),t}function Sc(e){var t=I(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Hu.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=qu.bind(null,t),t}function Ec(e,t,n){var r=I(e);(function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,n,r){var i,a,o,s,c;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.getMetadata();case 3:return i=e.sent,e.next=6,function(e,t){var n=I(e),r=Ir(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(function(e){return n.Ns.getBundleMetadata(e,t.id)})).then((function(e){return!!e&&e.createTime.compareTo(r)>=0}))}(t.localStore,i);case 6:if(!e.sent){e.next=11;break}return e.next=9,n.close();case 9:return r._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(i)),e.abrupt("return",Promise.resolve(new Set));case 11:return r._updateProgress(_u(i)),a=new ku(i,t.localStore,n.yt),e.next=15,n.mc();case 15:o=e.sent;case 16:if(!o){e.next=26;break}return e.next=19,a.Fu(o);case 19:return(s=e.sent)&&r._updateProgress(s),e.next=23,n.mc();case 23:o=e.sent;case 24:e.next=16;break;case 26:return e.next=28,a.complete();case 28:return c=e.sent,e.next=31,rc(t,c.Lu,void 0);case 31:return e.next=33,function(e,t){var n=I(e);return n.persistence.runTransaction("Save bundle","readwrite",(function(e){return n.Ns.saveBundleMetadata(e,t)}))}(t.localStore,i);case 33:return r._completeWith(c.progress),e.abrupt("return",Promise.resolve(c.Bu));case 37:return e.prev=37,e.t0=e.catch(0),e.abrupt("return",(j("SyncEngine","Loading bundle failed with ".concat(e.t0)),r._failWith(e.t0),Promise.resolve(new Set)));case 40:case"end":return e.stop()}}),e,null,[[0,37]])})));return function(t,n,r){return e.apply(this,arguments)}})()(r,t,n).then((function(e){r.sharedClientState.notifyBundleLoaded(e)}))}var Ac=function(){function e(){Object(f.a)(this,e),this.synchronizeTabs=!1}return Object(p.a)(e,[{key:"initialize",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.yt=hs(t.databaseInfo.databaseId),this.sharedClientState=this.gc(t),this.persistence=this.yc(t),e.next=5,this.persistence.start();case 5:this.localStore=this.Ic(t),this.gcScheduler=this.Tc(t,this.localStore),this.indexBackfillerScheduler=this.Ec(t,this.localStore);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"Tc",value:function(e,t){return null}},{key:"Ec",value:function(e,t){return null}},{key:"Ic",value:function(e){return To(this.persistence,new Ao,e.initialUser,this.yt)}},{key:"yc",value:function(e){return new mo(yo.Bs,this.yt)}},{key:"gc",value:function(e){return new rs}},{key:"terminate",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.gcScheduler&&this.gcScheduler.stop(),e.next=3,this.sharedClientState.shutdown();case 3:return e.next=5,this.persistence.shutdown();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),jc=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r,i){var a;return Object(f.a)(this,n),(a=t.call(this)).Ac=e,a.cacheSizeBytes=r,a.forceOwnership=i,a.synchronizeTabs=!1,a}return Object(p.a)(n,[{key:"initialize",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var r=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.a)(Object(a.a)(n.prototype),"initialize",this).call(this,t);case 2:return e.next=4,this.Ac.initialize(this,t);case 4:return e.next=6,Sc(this.Ac.syncEngine);case 6:return e.next=8,Us(this.Ac.remoteStore);case 8:return e.next=10,this.persistence.li((function(){return r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"Ic",value:function(e){return To(this.persistence,new Ao,e.initialUser,this.yt)}},{key:"Tc",value:function(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new qa(n,e.asyncQueue,t)}},{key:"Ec",value:function(e,t){var n=new Ae(t,this.persistence);return new Ee(e.asyncQueue,n)}},{key:"yc",value:function(e){var t=So(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ca.withCacheSize(this.cacheSizeBytes):Ca.DEFAULT;return new Oo(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,cs(),ls(),this.yt,this.sharedClientState,!!this.forceOwnership)}},{key:"gc",value:function(e){return new rs}}]),n}(Ac),Tc=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this,e,r,!1)).Ac=e,i.cacheSizeBytes=r,i.synchronizeTabs=!0,i}return Object(p.a)(n,[{key:"initialize",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var r,o=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.a)(Object(a.a)(n.prototype),"initialize",this).call(this,t);case 2:if(r=this.Ac.syncEngine,e.t0=this.sharedClientState instanceof ns,!e.t0){e.next=8;break}return this.sharedClientState.syncEngine={Fr:dc.bind(null,r),$r:wc.bind(null,r),Br:Oc.bind(null,r),vi:bc.bind(null,r),Mr:lc.bind(null,r)},e.next=8,this.sharedClientState.start();case 8:return e.next=10,this.persistence.li(function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pc(o.Ac.syncEngine,t);case 2:o.gcScheduler&&(t&&!o.gcScheduler.started?o.gcScheduler.start():t||o.gcScheduler.stop()),o.indexBackfillerScheduler&&(t&&!o.indexBackfillerScheduler.started?o.indexBackfillerScheduler.start():t||o.indexBackfillerScheduler.stop());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"gc",value:function(e){var t=cs();if(!ns.C(t))throw new R(P.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=So(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ns(t,e.asyncQueue,n,e.clientId,e.initialUser)}}]),n}(jc),Mc=function(){function e(){Object(f.a)(this,e)}return Object(p.a)(e,[{key:"initialize",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,n){var r=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.localStore,e.t0){e.next=12;break}return this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return zu(r.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=ac.bind(null,this.syncEngine),e.next=12,nu(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createEventManager",value:function(e){return new du}},{key:"createDatastore",value:function(e){var t,n=hs(e.databaseInfo.databaseId),r=(t=e.databaseInfo,new us(t));return function(e,t,n,r){return new ms(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,r,n)}},{key:"createRemoteStore",value:function(e){var t,n,r,i,a,o=this;return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=function(e){return zu(o.syncEngine,e,0)},a=as.C()?new as:new is,new ys(t,n,r,i,a)}},{key:"createSyncEngine",value:function(e,t){return function(e,t,n,r,i,a,o){var s=new Mu(e,t,n,r,i,a);return o&&(s.dc=!0),s}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}},{key:"terminate",value:function(){return function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var n;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=I(t),E("RemoteStore","RemoteStore shutting down."),n._u.add(5),e.next=5,xs(n);case 5:n.mu.shutdown(),n.gu.set("Unknown");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(this.remoteStore)}}]),e}();function Cc(e,t,n){if(!n)throw new R(P.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function Dc(e,t,n,r){if(!0===t&&!0===r)throw new R(P.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))}function Ic(e){if(!ne.isDocumentKey(e))throw new R(P.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function Pc(e){if(ne.isDocumentKey(e))throw new R(P.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function Rc(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";var t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}return"function"==typeof e?"a function":M()}function Lc(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new R(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Rc(e);throw new R(P.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}return e}function Nc(e,t){if(t<=0)throw new R(P.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}var Bc=new Map,Fc=function(){function e(t){var n;if(Object(f.a)(this,e),void 0===t.host){if(void 0!==t.ssl)throw new R(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(n=t.ssl)||void 0===n||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new R(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Dc("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return Object(p.a)(e,[{key:"isEqual",value:function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}]),e}(),Uc=function(){function e(t,n,r,i){Object(f.a)(this,e),this._authCredentials=t,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Fc({}),this._settingsFrozen=!1}return Object(p.a)(e,[{key:"app",get:function(){if(!this._app)throw new R(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return void 0!==this._terminateTask}},{key:"_setSettings",value:function(e){if(this._settingsFrozen)throw new R(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Fc(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new B;switch(e.type){case"gapi":var t=e.client;return new V(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new R(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){return function(e){var t=Bc.get(e);t&&(E("ComponentProvider","Removing Datastore"),Bc.delete(e),t.terminate())}(this),Promise.resolve()}}]),e}();function zc(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=(e=Lc(e,Uc))._getSettings();if("firestore.googleapis.com"!==a.host&&a.host!==t&&j("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},a),{host:"".concat(t,":").concat(n),ssl:!1})),i.mockUserToken){var o,s;if("string"==typeof i.mockUserToken)o=i.mockUserToken,s=x.MOCK_USER;else{o=Object(y.g)(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);var u=i.mockUserToken.sub||i.mockUserToken.user_id;if(!u)throw new R(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");s=new x(u)}e._authCredentials=new F(new N(o,s))}}var Vc=function(){function e(t,n,r){Object(f.a)(this,e),this.converter=n,this._key=r,this.type="document",this.firestore=t}return Object(p.a)(e,[{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new Hc(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function(t){return new e(this.firestore,t,this._key)}}]),e}(),Gc=function(){function e(t,n,r){Object(f.a)(this,e),this.converter=n,this._query=r,this.type="query",this.firestore=t}return Object(p.a)(e,[{key:"withConverter",value:function(t){return new e(this.firestore,t,this._query)}}]),e}(),Hc=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r,i){var a;return Object(f.a)(this,n),(a=t.call(this,e,r,rn(i)))._path=i,a.type="collection",a}return Object(p.a)(n,[{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new Vc(this.firestore,null,new ne(e))}},{key:"withConverter",value:function(e){return new n(this.firestore,e,this._path)}}]),n}(Gc);function Wc(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=Object(y.p)(e),Cc("collection","path",t),e instanceof Uc){var a=$.fromString.apply($,[t].concat(r));return Pc(a),new Hc(e,null,a)}if(!(e instanceof Vc||e instanceof Hc))throw new R(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child($.fromString.apply($,[t].concat(r)));return Pc(o),new Hc(e.firestore,null,o)}function qc(e,t){if(e=Lc(e,Uc),Cc("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new R(P.INVALID_ARGUMENT,"Invalid collection ID '".concat(t,"' passed to function collectionGroup(). Collection IDs must not contain '/'."));return new Gc(e,null,function(e){return new tn($.emptyPath(),e)}(t))}function Yc(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=Object(y.p)(e),1===arguments.length&&(t=q.R()),Cc("doc","path",t),e instanceof Uc){var a=$.fromString.apply($,[t].concat(r));return Ic(a),new Vc(e,null,new ne(a))}if(!(e instanceof Vc||e instanceof Hc))throw new R(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child($.fromString.apply($,[t].concat(r)));return Ic(o),new Vc(e.firestore,e instanceof Hc?e.converter:null,new ne(o))}function Xc(e,t){return e=Object(y.p)(e),t=Object(y.p)(t),(e instanceof Vc||e instanceof Hc)&&(t instanceof Vc||t instanceof Hc)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Kc(e,t){return e=Object(y.p)(e),t=Object(y.p)(t),e instanceof Gc&&t instanceof Gc&&e.firestore===t.firestore&&fn(e._query,t._query)&&e.converter===t.converter}function Qc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10240,n=0;return{read:function(){return Object(c.a)(Object(u.a)().mark((function r(){var i;return Object(u.a)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n<e.byteLength)){r.next=3;break}return i={value:e.slice(n,n+t),done:!1},r.abrupt("return",(n+=t,i));case 3:return r.abrupt("return",{done:!0});case 4:case"end":return r.stop()}}),r)})))()},cancel:function(){return Object(c.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var Zc=function(){function e(t){Object(f.a)(this,e),this.observer=t,this.muted=!1}return Object(p.a)(e,[{key:"next",value:function(e){this.observer.next&&this.Rc(this.observer.next,e)}},{key:"error",value:function(e){this.observer.error?this.Rc(this.observer.error,e):A("Uncaught Error in snapshot listener:",e.toString())}},{key:"bc",value:function(){this.muted=!0}},{key:"Rc",value:function(e,t){var n=this;this.muted||setTimeout((function(){n.muted||e(t)}),0)}}]),e}(),Jc=function(){function e(t,n){var r=this;Object(f.a)(this,e),this.Pc=t,this.yt=n,this.metadata=new L,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then((function(e){e&&e.Ou()?r.metadata.resolve(e.ku.metadata):r.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             ".concat(JSON.stringify(null==e?void 0:e.ku))))}),(function(e){return r.metadata.reject(e)}))}return Object(p.a)(e,[{key:"close",value:function(){return this.Pc.cancel()}},{key:"getMetadata",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.metadata.promise);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"mc",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadata();case 2:return e.abrupt("return",this.Vc());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Vc",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t,n,r,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Sc();case 2:if(null!==(t=e.sent)){e.next=5;break}return e.abrupt("return",null);case 5:return n=this.vc.decode(t),r=Number(n),isNaN(r)&&this.Dc("length string (".concat(n,") is not valid number")),e.next=9,this.Cc(r);case 9:return i=e.sent,e.abrupt("return",new xu(JSON.parse(i),t.length+r));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"xc",value:function(){return this.buffer.findIndex((function(e){return e==="{".charCodeAt(0)}))}},{key:"Sc",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t,n;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.xc()<0)){e.next=7;break}return e.next=3,this.Nc();case 3:if(!e.sent){e.next=5;break}return e.abrupt("break",7);case 5:e.next=0;break;case 7:if(0!==this.buffer.length){e.next=9;break}return e.abrupt("return",null);case 9:return(t=this.xc())<0&&this.Dc("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,t),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Cc",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var n;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.buffer.length<t)){e.next=8;break}return e.next=3,this.Nc();case 3:if(e.t0=e.sent,!e.t0){e.next=6;break}this.Dc("Reached the end of bundle when more is expected.");case 6:e.next=0;break;case 8:return n=this.vc.decode(this.buffer.slice(0,t)),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"Dc",value:function(e){throw this.Pc.cancel(),new Error("Invalid bundle format: ".concat(e))}},{key:"Nc",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t,n;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Pc.read();case 2:return(t=e.sent).done||((n=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),n.set(t.value,this.buffer.length),this.buffer=n),e.abrupt("return",t.done);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),$c=function(){function e(t){Object(f.a)(this,e),this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return Object(p.a)(e,[{key:"lookup",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var n,r=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!(this.mutations.length>0)){e.next=2;break}throw new R(P.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");case 2:return e.next=4,function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i,a,o,s,c;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=I(t),i=Ur(r.yt)+"/documents",a={documents:n.map((function(e){return Lr(r.yt,e)}))},e.next=5,r._o("BatchGetDocuments",i,a,n.length);case 5:return o=e.sent,s=new Map,o.forEach((function(e){var t=Hr(r.yt,e);s.set(t.key.toString(),t)})),c=[],e.abrupt("return",(n.forEach((function(e){var t=s.get(e.toString());C(!!t),c.push(t)})),c));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,t);case 4:return n=e.sent,e.abrupt("return",(n.forEach((function(e){return r.recordVersion(e)})),n));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"update",value:function(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}},{key:"delete",value:function(e){this.write(new Jn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"commit",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t,n=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!this.lastWriteError){e.next=2;break}throw this.lastWriteError;case 2:return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(e,t){var r=ne.fromPath(t);n.mutations.push(new $n(r,n.precondition(r)))})),e.next=7,function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i,a;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=I(t),i=Ur(r.yt)+"/documents",a={writes:n.map((function(e){return Wr(r.yt,e)}))},e.next=3,r.ao("Commit",i,a);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,this.mutations);case 7:this.committed=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"recordVersion",value:function(e){var t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw M();t=Z.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new R(P.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}},{key:"precondition",value:function(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Z.min())?Nn.exists(!1):Nn.updateTime(t):Nn.none()}},{key:"preconditionForUpdate",value:function(e){var t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Z.min()))throw new R(P.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Nn.updateTime(t)}return Nn.exists(!0)}},{key:"write",value:function(e){this.ensureCommitNotCalled(),this.mutations.push(e)}},{key:"ensureCommitNotCalled",value:function(){}}]),e}(),el=function(){function e(t,n,r,i,a){Object(f.a)(this,e),this.asyncQueue=t,this.datastore=n,this.options=r,this.updateFunction=i,this.deferred=a,this.kc=r.maxAttempts,this.xo=new ds(this.asyncQueue,"transaction_retry")}return Object(p.a)(e,[{key:"run",value:function(){this.kc-=1,this.Oc()}},{key:"Oc",value:function(){var e=this;this.xo.Ro(Object(c.a)(Object(u.a)().mark((function t(){var n,r;return Object(u.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=new $c(e.datastore),(r=e.Mc(n))&&r.then((function(t){e.asyncQueue.enqueueAndForget((function(){return n.commit().then((function(){e.deferred.resolve(t)})).catch((function(t){e.Fc(t)}))}))})).catch((function(t){e.Fc(t)}));case 2:case"end":return t.stop()}}),t)}))))}},{key:"Mc",value:function(e){try{var t=this.updateFunction(e);return!Pe(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}},{key:"Fc",value:function(e){var t=this;this.kc>0&&this.$c(e)?(this.kc-=1,this.asyncQueue.enqueueAndForget((function(){return t.Oc(),Promise.resolve()}))):this.deferred.reject(e)}},{key:"$c",value:function(e){if("FirebaseError"===e.name){var t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!tr(t)}return!1}}]),e}(),tl=function(){function e(t,n,r,i){var a=this;Object(f.a)(this,e),this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=x.UNAUTHENTICATED,this.clientId=q.R(),this.authCredentialListener=function(){return Promise.resolve()},this.appCheckCredentialListener=function(){return Promise.resolve()},this.authCredentials.start(r,function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E("FirestoreClient","Received user=",t.uid),e.next=3,a.authCredentialListener(t);case 3:a.user=t;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(r,(function(e){return E("FirestoreClient","Received new app check token=",e),a.appCheckCredentialListener(e,a.user)}))}return Object(p.a)(e,[{key:"getConfiguration",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100});case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setCredentialChangeListener",value:function(e){this.authCredentialListener=e}},{key:"setAppCheckTokenChangeListener",value:function(e){this.appCheckCredentialListener=e}},{key:"verifyNotTerminated",value:function(){if(this.asyncQueue.isShuttingDown)throw new R(P.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"terminate",value:function(){var e=this;this.asyncQueue.enterRestrictedMode();var t=new L;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(Object(c.a)(Object(u.a)().mark((function n(){var r;return Object(u.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=e.onlineComponents,!n.t0){n.next=5;break}return n.next=5,e.onlineComponents.terminate();case 5:if(n.t1=e.offlineComponents,!n.t1){n.next=9;break}return n.next=9,e.offlineComponents.terminate();case 9:e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve(),n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),r=su(n.t2,"Failed to shutdown persistence"),t.reject(r);case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))),t.promise}}]),e}();function nl(e,t){return rl.apply(this,arguments)}function rl(){return rl=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),E("FirestoreClient","Initializing OfflineComponentProvider"),e.next=3,t.getConfiguration();case 3:return r=e.sent,e.next=6,n.initialize(r);case 6:i=r.initialUser,t.setCredentialChangeListener(function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.isEqual(t),e.t0){e.next=5;break}return e.next=4,Mo(n.localStore,t);case 4:i=t;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=n;case 8:case"end":return e.stop()}}),e)}))),rl.apply(this,arguments)}function il(e,t){return al.apply(this,arguments)}function al(){return(al=Object(c.a)(Object(u.a)().mark((function e(t,n){var r,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),e.next=3,ol(t);case 3:return r=e.sent,E("FirestoreClient","Initializing OnlineComponentProvider"),e.next=7,t.getConfiguration();case 7:return i=e.sent,e.next=10,n.initialize(r,i);case 10:t.setCredentialChangeListener((function(e){return eu(n.remoteStore,e)})),t.setAppCheckTokenChangeListener((function(e,t){return eu(n.remoteStore,t)})),t.onlineComponents=n;case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ol(e){return sl.apply(this,arguments)}function sl(){return(sl=Object(c.a)(Object(u.a)().mark((function e(t){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.offlineComponents,e.t0){e.next=5;break}return E("FirestoreClient","Using default OfflineComponentProvider"),e.next=5,nl(t,new Ac);case 5:return e.abrupt("return",t.offlineComponents);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ul(e){return cl.apply(this,arguments)}function cl(){return(cl=Object(c.a)(Object(u.a)().mark((function e(t){return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.onlineComponents,e.t0){e.next=5;break}return E("FirestoreClient","Using default OnlineComponentProvider"),e.next=5,il(t,new Mc);case 5:return e.abrupt("return",t.onlineComponents);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ll(e){return ol(e).then((function(e){return e.persistence}))}function hl(e){return ol(e).then((function(e){return e.localStore}))}function dl(e){return ul(e).then((function(e){return e.remoteStore}))}function fl(e){return ul(e).then((function(e){return e.syncEngine}))}function pl(e){return ul(e).then((function(e){return e.datastore}))}function vl(e){return ml.apply(this,arguments)}function ml(){return(ml=Object(c.a)(Object(u.a)().mark((function e(t){var n,r;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ul(t);case 2:return n=e.sent,r=n.eventManager,e.abrupt("return",(r.onListen=Cu.bind(null,n.syncEngine),r.onUnlisten=Ru.bind(null,n.syncEngine),r));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new L;return e.asyncQueue.enqueueAndForget(Object(c.a)(Object(u.a)().mark((function i(){return Object(u.a)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new Zc({next:function(a){t.enqueueAndForget((function(){return vu(e,o)}));var s=a.docs.has(n);!s&&a.fromCache?i.reject(new R(P.UNAVAILABLE,"Failed to get document because the client is offline.")):s&&a.fromCache&&r&&"server"===r.source?i.reject(new R(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:function(e){return i.reject(e)}}),o=new wu(rn(n.path),a,{includeMetadataChanges:!0,Nu:!0});return fu(e,o)},i.next=3,vl(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}function yl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new L;return e.asyncQueue.enqueueAndForget(Object(c.a)(Object(u.a)().mark((function i(){return Object(u.a)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new Zc({next:function(n){t.enqueueAndForget((function(){return vu(e,o)})),n.fromCache&&"server"===r.source?i.reject(new R(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(e){return i.reject(e)}}),o=new wu(n,a,{includeMetadataChanges:!0,Nu:!0});return fu(e,o)},i.next=3,vl(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}var bl=function(){function e(){var t=this;Object(f.a)(this,e),this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new ds(this,"async_queue_retry"),this.Wc=function(){var e=ls();e&&E("AsyncQueue","Visibility state changed to "+e.visibilityState),t.xo.Po()};var n=ls();n&&"function"==typeof n.addEventListener&&n.addEventListener("visibilitychange",this.Wc)}return Object(p.a)(e,[{key:"isShuttingDown",get:function(){return this.qc}},{key:"enqueueAndForget",value:function(e){this.enqueue(e)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(e){this.zc(),this.Hc(e)}},{key:"enterRestrictedMode",value:function(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;var t=ls();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}},{key:"enqueue",value:function(e){var t=this;if(this.zc(),this.qc)return new Promise((function(){}));var n=new L;return this.Hc((function(){return t.qc&&t.Qc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))}},{key:"enqueueRetryable",value:function(e){var t=this;this.enqueueAndForget((function(){return t.Lc.push(e),t.Jc()}))}},{key:"Jc",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t=this;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.Lc.length){e.next=14;break}return e.prev=1,e.next=4,this.Lc[0]();case 4:this.Lc.shift(),this.xo.reset(),e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(1),xe(e.t0)){e.next=12;break}throw e.t0;case 12:E("AsyncQueue","Operation failed with retryable error: "+e.t0);case 13:this.Lc.length>0&&this.xo.Ro((function(){return t.Jc()}));case 14:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"Hc",value:function(e){var t=this,n=this.Bc.then((function(){return t.Gc=!0,e().catch((function(e){t.Kc=e,t.Gc=!1;var n=function(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw A("INTERNAL UNHANDLED ERROR: ",n),e})).then((function(e){return t.Gc=!1,e}))}));return this.Bc=n,n}},{key:"enqueueAfterDelay",value:function(e,t,n){var r=this;this.zc(),this.jc.indexOf(e)>-1&&(t=0);var i=ou.createAndSchedule(this,e,t,n,(function(e){return r.Yc(e)}));return this.Uc.push(i),i}},{key:"zc",value:function(){this.Kc&&M()}},{key:"verifyOperationInProgress",value:function(){}},{key:"Xc",value:function(){var e=Object(c.a)(Object(u.a)().mark((function e(){var t;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.Bc,e.next=3,t;case 3:if(t!==this.Bc){e.next=0;break}case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Zc",value:function(e){var t,n=Object(s.a)(this.Uc);try{for(n.s();!(t=n.n()).done;){if(t.value.timerId===e)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"ta",value:function(e){var t=this;return this.Xc().then((function(){t.Uc.sort((function(e,t){return e.targetTimeMs-t.targetTimeMs}));var n,r=Object(s.a)(t.Uc);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.skipDelay(),"all"!==e&&i.timerId===e)break}}catch(a){r.e(a)}finally{r.f()}return t.Xc()}))}},{key:"ea",value:function(e){this.jc.push(e)}},{key:"Yc",value:function(e){var t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}]),e}();function wl(e){return function(e,t){if("object"!=typeof e||null===e)return!1;var n,r=e,i=Object(s.a)(["next","error","complete"]);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in r&&"function"==typeof r[a])return!0}}catch(o){i.e(o)}finally{i.f()}return!1}(e)}var xl=function(){function e(){Object(f.a)(this,e),this._progressObserver={},this._taskCompletionResolver=new L,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return Object(p.a)(e,[{key:"onProgress",value:function(e,t,n){this._progressObserver={next:e,error:t,complete:n}}},{key:"catch",value:function(e){return this._taskCompletionResolver.promise.catch(e)}},{key:"then",value:function(e,t){return this._taskCompletionResolver.promise.then(e,t)}},{key:"_completeWith",value:function(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}},{key:"_failWith",value:function(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}},{key:"_updateProgress",value:function(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}]),e}(),Ol=-1,kl=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r,i,a){var o;return Object(f.a)(this,n),(o=t.call(this,e,r,i,a)).type="firestore",o._queue=new bl,o._persistenceKey=(null==a?void 0:a.name)||"[DEFAULT]",o}return Object(p.a)(n,[{key:"_terminate",value:function(){return this._firestoreClient||Sl(this),this._firestoreClient.terminate()}}]),n}(Uc);function _l(e){return e._firestoreClient||Sl(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Sl(e){var t,n=e._freezeSettings(),r=function(e,t,n,r){return new Te(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new tl(e._authCredentials,e._appCheckCredentials,e._queue,r)}function El(e,t){Rl(e=Lc(e,kl));var n=_l(e),r=e._freezeSettings(),i=new Mc;return jl(n,i,new jc(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}function Al(e){Rl(e=Lc(e,kl));var t=_l(e),n=e._freezeSettings(),r=new Mc;return jl(t,r,new Tc(r,n.cacheSizeBytes))}function jl(e,t,n){var r=new L;return e.asyncQueue.enqueue(Object(c.a)(Object(u.a)().mark((function i(){var a;return Object(u.a)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,nl(e,n);case 3:return i.next=5,il(e,t);case 5:r.resolve(),i.next=14;break;case 8:if(i.prev=8,i.t0=i.catch(0),function(e){return"FirebaseError"===e.name?e.code===P.FAILED_PRECONDITION||e.code===P.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||(22===e.code||20===e.code||11===e.code)}(a=i.t0)){i.next=13;break}throw a;case 13:j("Error enabling offline persistence. Falling back to persistence disabled: "+a),r.reject(a);case 14:case"end":return i.stop()}}),i,null,[[0,8]])})))).then((function(){return r.promise}))}function Tl(e){if(e._initialized&&!e._terminated)throw new R(P.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var t=new L;return e._queue.enqueueAndForgetEvenWhileRestricted(Object(c.a)(Object(u.a)().mark((function n(){return Object(u.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var n;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ye.C()){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return n=t+"main",e.next=5,ye.delete(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(So(e._databaseId,e._persistenceKey));case 3:t.resolve(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),t.reject(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})))),t.promise}function Ml(e){return function(e){var t=new L;return e.asyncQueue.enqueueAndForget(Object(c.a)(Object(u.a)().mark((function n(){return Object(u.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=Xu,n.next=3,fl(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)})))),t.promise}(_l(e=Lc(e,kl)))}function Cl(e){return function(e){return e.asyncQueue.enqueue(Object(c.a)(Object(u.a)().mark((function t(){var n,r;return Object(u.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ll(e);case 2:return n=t.sent,t.next=5,dl(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!0),function(e){var t=I(e);return t._u.delete(0),bs(t)}(r)));case 7:case"end":return t.stop()}}),t)}))))}(_l(e=Lc(e,kl)))}function Dl(e){return function(e){return e.asyncQueue.enqueue(Object(c.a)(Object(u.a)().mark((function t(){var n,r;return Object(u.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ll(e);case 2:return n=t.sent,t.next=5,dl(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!1),function(){var e=Object(c.a)(Object(u.a)().mark((function e(t){var n;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=I(t))._u.add(0),e.next=4,xs(n);case 4:n.gu.set("Offline");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(r)));case 7:case"end":return t.stop()}}),t)}))))}(_l(e=Lc(e,kl)))}function Il(e,t){var n=_l(e=Lc(e,kl)),r=new xl;return function(e,t,n,r){var i=function(e,t){return function(e,t){return new Jc(e,t)}(function(e,t){if(e instanceof Uint8Array)return Qc(e,t);if(e instanceof ArrayBuffer)return Qc(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),t)}(n,hs(t));e.asyncQueue.enqueueAndForget(Object(c.a)(Object(u.a)().mark((function t(){return Object(u.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Ec,t.next=3,fl(e);case 3:t.t1=t.sent,t.t2=i,t.t3=r,(0,t.t0)(t.t1,t.t2,t.t3);case 7:case"end":return t.stop()}}),t)}))))}(n,e._databaseId,t,r),r}function Pl(e,t){return function(e,t){return e.asyncQueue.enqueue(Object(c.a)(Object(u.a)().mark((function n(){return Object(u.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=function(e,t){var n=I(e);return n.persistence.runTransaction("Get named query","readonly",(function(e){return n.Ns.getNamedQuery(e,t)}))},n.next=3,hl(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)}))))}(_l(e=Lc(e,kl)),t).then((function(t){return t?new Gc(e,null,t.query):null}))}function Rl(e){if(e._initialized||e._terminated)throw new R(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Ll=function(){function e(t){Object(f.a)(this,e),this._byteString=t}return Object(p.a)(e,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function(t){try{return new e(Be.fromBase64String(t))}catch(t){throw new R(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}},{key:"fromUint8Array",value:function(t){return new e(Be.fromUint8Array(t))}}]),e}(),Nl=function(){function e(){Object(f.a)(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;++i)if(0===n[i].length)throw new R(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new te(n)}return Object(p.a)(e,[{key:"isEqual",value:function(e){return this._internalPath.isEqual(e._internalPath)}}]),e}();var Bl=Object(p.a)((function e(t){Object(f.a)(this,e),this._methodName=t})),Fl=function(){function e(t,n){if(Object(f.a)(this,e),!isFinite(t)||t<-90||t>90)throw new R(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new R(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return Object(p.a)(e,[{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}},{key:"isEqual",value:function(e){return this._lat===e._lat&&this._long===e._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(e){return Y(this._lat,e._lat)||Y(this._long,e._long)}}]),e}(),Ul=/^__.*__$/,zl=function(){function e(t,n,r){Object(f.a)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return Object(p.a)(e,[{key:"toMutation",value:function(e,t){return null!==this.fieldMask?new qn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Wn(e,this.data,t,this.fieldTransforms)}}]),e}(),Vl=function(){function e(t,n,r){Object(f.a)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return Object(p.a)(e,[{key:"toMutation",value:function(e,t){return new qn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}]),e}();function Gl(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M()}}var Hl=function(){function e(t,n,r,i,a,o){Object(f.a)(this,e),this.settings=t,this.databaseId=n,this.yt=r,this.ignoreUndefinedProperties=i,void 0===a&&this.na(),this.fieldTransforms=a||[],this.fieldMask=o||[]}return Object(p.a)(e,[{key:"path",get:function(){return this.settings.path}},{key:"sa",get:function(){return this.settings.sa}},{key:"ia",value:function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"ra",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.ua(e),r}},{key:"ca",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.na(),r}},{key:"aa",value:function(e){return this.ia({path:void 0,oa:!0})}},{key:"ha",value:function(e){return lh(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}},{key:"contains",value:function(e){return void 0!==this.fieldMask.find((function(t){return e.isPrefixOf(t)}))||void 0!==this.fieldTransforms.find((function(t){return e.isPrefixOf(t.field)}))}},{key:"na",value:function(){if(this.path)for(var e=0;e<this.path.length;e++)this.ua(this.path.get(e))}},{key:"ua",value:function(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(Gl(this.sa)&&Ul.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}]),e}(),Wl=function(){function e(t,n,r){Object(f.a)(this,e),this.databaseId=t,this.ignoreUndefinedProperties=n,this.yt=r||hs(t)}return Object(p.a)(e,[{key:"da",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Hl({sa:e,methodName:t,fa:n,path:te.emptyPath(),oa:!1,la:r},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}]),e}();function ql(e){var t=e._freezeSettings(),n=hs(e._databaseId);return new Wl(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Yl(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=e.da(a.merge||a.mergeFields?2:0,t,n,i);oh("Data must be an object, but it was:",o,r);var u,c,l=ih(r,o);if(a.merge)u=new Gt(o.fieldMask),c=o.fieldTransforms;else if(a.mergeFields){var h,d=[],f=Object(s.a)(a.mergeFields);try{for(f.s();!(h=f.n()).done;){var p=sh(t,h.value,n);if(!o.contains(p))throw new R(P.INVALID_ARGUMENT,"Field '".concat(p,"' is specified in your field mask but missing from your input data."));hh(d,p)||d.push(p)}}catch(v){f.e(v)}finally{f.f()}u=new Gt(d),c=o.fieldTransforms.filter((function(e){return u.covers(e.field)}))}else u=null,c=o.fieldTransforms;return new zl(new Ht(l),u,c)}var Xl=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"_toFieldTransform",value:function(e){if(2!==e.sa)throw 1===e.sa?e.ha("".concat(this._methodName,"() can only appear at the top level of your update data")):e.ha("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(Bl);function Kl(e,t,n){return new Hl({sa:3,fa:t.settings.fa,methodName:e._methodName,oa:n},t.databaseId,t.yt,t.ignoreUndefinedProperties)}var Ql=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"_toFieldTransform",value:function(e){return new Rn(e.path,new An)}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(Bl),Zl=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this,e))._a=r,i}return Object(p.a)(n,[{key:"_toFieldTransform",value:function(e){var t=Kl(this,e,!0),n=this._a.map((function(e){return rh(e,t)})),r=new jn(n);return new Rn(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(Bl),Jl=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this,e))._a=r,i}return Object(p.a)(n,[{key:"_toFieldTransform",value:function(e){var t=Kl(this,e,!0),n=this._a.map((function(e){return rh(e,t)})),r=new Mn(n);return new Rn(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(Bl),$l=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this,e)).wa=r,i}return Object(p.a)(n,[{key:"_toFieldTransform",value:function(e){var t=new Dn(e.yt,On(e.yt,this.wa));return new Rn(e.path,t)}},{key:"isEqual",value:function(e){return this===e}}]),n}(Bl);function eh(e,t,n,r){var i=e.da(1,t,n);oh("Data must be an object, but it was:",i,r);var a=[],o=Ht.empty();De(r,(function(e,r){var s=ch(t,e,n);r=Object(y.p)(r);var u=i.ca(s);if(r instanceof Xl)a.push(s);else{var c=rh(r,u);null!=c&&(a.push(s),o.set(s,c))}}));var s=new Gt(a);return new Vl(o,s,i.fieldTransforms)}function th(e,t,n,r,i,a){var o=e.da(1,t,n),s=[sh(t,r,n)],u=[i];if(a.length%2!=0)throw new R(P.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(var c=0;c<a.length;c+=2)s.push(sh(t,a[c])),u.push(a[c+1]);for(var l=[],h=Ht.empty(),d=s.length-1;d>=0;--d)if(!hh(l,s[d])){var f=s[d],p=u[d];p=Object(y.p)(p);var v=o.ca(f);if(p instanceof Xl)l.push(f);else{var m=rh(p,v);null!=m&&(l.push(f),h.set(f,m))}}var g=new Gt(l);return new Vl(h,g,o.fieldTransforms)}function nh(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return rh(n,e.da(r?4:3,t))}function rh(e,t){if(ah(e=Object(y.p)(e)))return oh("Unsupported field value:",t,e),ih(e,t);if(e instanceof Bl)return function(e,t){if(!Gl(t.sa))throw t.ha("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.ha("".concat(e._methodName,"() is not currently supported inside arrays"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.oa&&4!==t.sa)throw t.ha("Nested arrays are not supported");return function(e,t){var n,r=[],i=0,a=Object(s.a)(e);try{for(a.s();!(n=a.n()).done;){var o=rh(n.value,t.aa(i));null==o&&(o={nullValue:"NULL_VALUE"}),r.push(o),i++}}catch(u){a.e(u)}finally{a.f()}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=Object(y.p)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return On(t.yt,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=Q.fromDate(e);return{timestampValue:Mr(t.yt,n)}}if(e instanceof Q){var r=new Q(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Mr(t.yt,r)}}if(e instanceof Fl)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Ll)return{bytesValue:Cr(t.yt,e._byteString)};if(e instanceof Vc){var i=t.databaseId,a=e.firestore._databaseId;if(!a.isEqual(i))throw t.ha("Document reference is for database ".concat(a.projectId,"/").concat(a.database," but should be for database ").concat(i.projectId,"/").concat(i.database));return{referenceValue:Pr(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.ha("Unsupported field value: ".concat(Rc(e)))}(e,t)}function ih(e,t){var n={};return Ie(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):De(e,(function(e,r){var i=rh(r,t.ra(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function ah(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Q||e instanceof Fl||e instanceof Ll||e instanceof Vc||e instanceof Bl)}function oh(e,t,n){if(!ah(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){var r=Rc(n);throw"an object"===r?t.ha(e+" a custom object"):t.ha(e+" "+r)}}function sh(e,t,n){if((t=Object(y.p)(t))instanceof Nl)return t._internalPath;if("string"==typeof t)return ch(e,t);throw lh("Field path arguments must be of type string or ",e,!1,void 0,n)}var uh=new RegExp("[~\\*/\\[\\]]");function ch(e,t,n){if(t.search(uh)>=0)throw lh("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return Object(r.a)(Nl,Object(d.a)(t.split(".")))._internalPath}catch(i){throw lh("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function lh(e,t,n,r,i){var a=r&&!r.isEmpty(),o=void 0!==i,s="Function ".concat(t,"() called with invalid data");n&&(s+=" (via `toFirestore()`)"),s+=". ";var u="";return(a||o)&&(u+=" (found",a&&(u+=" in field ".concat(r)),o&&(u+=" in document ".concat(i)),u+=")"),new R(P.INVALID_ARGUMENT,s+e+u)}function hh(e,t){return e.some((function(e){return e.isEqual(t)}))}var dh=function(){function e(t,n,r,i,a){Object(f.a)(this,e),this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=a}return Object(p.a)(e,[{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"ref",get:function(){return new Vc(this._firestore,this._converter,this._key)}},{key:"exists",value:function(){return null!==this._document}},{key:"data",value:function(){if(this._document){if(this._converter){var e=new fh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function(e){if(this._document){var t=this._document.data.field(ph("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}]),e}(),fh=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"data",value:function(){return Object(i.a)(Object(a.a)(n.prototype),"data",this).call(this)}}]),n}(dh);function ph(e,t){return"string"==typeof t?ch(e,t):t instanceof Nl?t._internalPath:t._delegate._internalPath}function vh(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new R(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var mh=Object(p.a)((function e(){Object(f.a)(this,e)})),gh=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n)}(mh);function yh(e,t){for(var n=[],r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];t instanceof mh&&n.push(t),function(e){var t=e.filter((function(e){return e instanceof xh})).length,n=e.filter((function(e){return e instanceof bh})).length;if(t>1||t>0&&n>0)throw new R(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(i));var o,u=Object(s.a)(n);try{for(u.s();!(o=u.n()).done;){e=o.value._apply(e)}}catch(c){u.e(c)}finally{u.f()}return e}var bh=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r,i){var a;return Object(f.a)(this,n),(a=t.call(this))._field=e,a._op=r,a._value=i,a.type="where",a}return Object(p.a)(n,[{key:"_apply",value:function(e){var t=this._parse(e);return Lh(e._query,t),new Gc(e.firestore,e.converter,hn(e._query,t))}},{key:"_parse",value:function(e){var t=ql(e.firestore),n=function(e,t,n,r,i,a,o){var u;if(i.isKeyField()){if("array-contains"===a||"array-contains-any"===a)throw new R(P.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(a,"' queries on documentId()."));if("in"===a||"not-in"===a){Rh(o,a);var c,l=[],h=Object(s.a)(o);try{for(h.s();!(c=h.n()).done;){var d=c.value;l.push(Ph(r,e,d))}}catch(f){h.e(f)}finally{h.f()}u={arrayValue:{values:l}}}else u=Ph(r,e,o)}else"in"!==a&&"not-in"!==a&&"array-contains-any"!==a||Rh(o,a),u=nh(n,"where",o,"in"===a||"not-in"===a);return gt.create(i,a,u)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}],[{key:"_create",value:function(e,t,r){return new n(e,t,r)}}]),n}(gh);function wh(e,t,n){var r=t,i=ph("where",e);return bh._create(i,r,n)}var xh=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this)).type=e,i._queryConstraints=r,i}return Object(p.a)(n,[{key:"_parse",value:function(e){var t=this._queryConstraints.map((function(t){return t._parse(e)})).filter((function(e){return e.getFilters().length>0}));return 1===t.length?t[0]:yt.create(t,this._getOperator())}},{key:"_apply",value:function(e){var t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){var n,r=e,i=t.getFlattenedFilters(),a=Object(s.a)(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;Lh(r,o),r=hn(r,o)}}catch(u){a.e(u)}finally{a.f()}}(e._query,t),new Gc(e.firestore,e.converter,hn(e._query,t)))}},{key:"_getQueryConstraints",value:function(){return this._queryConstraints}},{key:"_getOperator",value:function(){return"and"===this.type?"and":"or"}}],[{key:"_create",value:function(e,t){return new n(e,t)}}]),n}(mh);var Oh=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this))._field=e,i._direction=r,i.type="orderBy",i}return Object(p.a)(n,[{key:"_apply",value:function(e){var t=function(e,t,n){if(null!==e.startAt)throw new R(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new R(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Rt(t,n);return function(e,t){if(null===on(e)){var n=sn(e);null!==n&&Nh(e,n,t.field)}}(e,r),r}(e._query,this._field,this._direction);return new Gc(e.firestore,e.converter,function(e,t){var n=e.explicitOrderBy.concat([t]);return new tn(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}],[{key:"_create",value:function(e,t){return new n(e,t)}}]),n}(gh);function kh(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=ph("orderBy",e);return Oh._create(n,t)}var _h=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r,i){var a;return Object(f.a)(this,n),(a=t.call(this)).type=e,a._limit=r,a._limitType=i,a}return Object(p.a)(n,[{key:"_apply",value:function(e){return new Gc(e.firestore,e.converter,dn(e._query,this._limit,this._limitType))}}],[{key:"_create",value:function(e,t,r){return new n(e,t,r)}}]),n}(gh);function Sh(e){return Nc("limit",e),_h._create("limit",e,"F")}function Eh(e){return Nc("limitToLast",e),_h._create("limitToLast",e,"L")}var Ah=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r,i){var a;return Object(f.a)(this,n),(a=t.call(this)).type=e,a._docOrFields=r,a._inclusive=i,a}return Object(p.a)(n,[{key:"_apply",value:function(e){var t=Ih(e,this.type,this._docOrFields,this._inclusive);return new Gc(e.firestore,e.converter,function(e,t){return new tn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}],[{key:"_create",value:function(e,t,r){return new n(e,t,r)}}]),n}(gh);function jh(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ah._create("startAt",t,!0)}function Th(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ah._create("startAfter",t,!1)}var Mh=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r,i){var a;return Object(f.a)(this,n),(a=t.call(this)).type=e,a._docOrFields=r,a._inclusive=i,a}return Object(p.a)(n,[{key:"_apply",value:function(e){var t=Ih(e,this.type,this._docOrFields,this._inclusive);return new Gc(e.firestore,e.converter,function(e,t){return new tn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}],[{key:"_create",value:function(e,t,r){return new n(e,t,r)}}]),n}(gh);function Ch(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mh._create("endBefore",t,!1)}function Dh(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mh._create("endAt",t,!0)}function Ih(e,t,n,r){if(n[0]=Object(y.p)(n[0]),n[0]instanceof dh)return function(e,t,n,r,i){if(!r)throw new R(P.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for ".concat(n,"()."));var a,o=[],u=Object(s.a)(cn(e));try{for(u.s();!(a=u.n()).done;){var c=a.value;if(c.field.isKeyField())o.push(tt(t,r.key));else{var l=r.data.field(c.field);if(Ge(l))throw new R(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+c.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===l){var h=c.field.canonicalString();throw new R(P.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '".concat(h,"' (used as the orderBy) does not exist."))}o.push(l)}}}catch(d){u.e(d)}finally{u.f()}return new ft(o,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=ql(e.firestore);return function(e,t,n,r,i,a){var o=e.explicitOrderBy;if(i.length>o.length)throw new R(P.INVALID_ARGUMENT,"Too many arguments provided to ".concat(r,"(). The number of arguments must be less than or equal to the number of orderBy() clauses"));for(var s=[],u=0;u<i.length;u++){var c=i[u];if(o[u].field.isKeyField()){if("string"!=typeof c)throw new R(P.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in ".concat(r,"(), but got a ").concat(typeof c));if(!un(e)&&-1!==c.indexOf("/"))throw new R(P.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by documentId(), the value passed to ".concat(r,"() must be a plain document ID, but '").concat(c,"' contains a slash."));var l=e.path.child($.fromString(c));if(!ne.isDocumentKey(l))throw new R(P.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by documentId(), the value passed to ".concat(r,"() must result in a valid document path, but '").concat(l,"' is not because it contains an odd number of segments."));var h=new ne(l);s.push(tt(t,h))}else{var d=nh(n,r,c);s.push(d)}}return new ft(s,a)}(e._query,e.firestore._databaseId,i,t,n,r)}function Ph(e,t,n){if("string"==typeof(n=Object(y.p)(n))){if(""===n)throw new R(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!un(t)&&-1!==n.indexOf("/"))throw new R(P.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));var r=t.path.child($.fromString(n));if(!ne.isDocumentKey(r))throw new R(P.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return tt(e,new ne(r))}if(n instanceof Vc)return tt(e,n._key);throw new R(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(Rc(n),"."))}function Rh(e,t){if(!Array.isArray(e)||0===e.length)throw new R(P.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."));if(e.length>10)throw new R(P.INVALID_ARGUMENT,"Invalid Query. '".concat(t.toString(),"' filters support a maximum of 10 elements in the value array."))}function Lh(e,t){if(t.isInequality()){var n=sn(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new R(P.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '".concat(n.toString(),"' and '").concat(r.toString(),"'"));var i=on(e);null!==i&&Nh(e,r,i)}var a=function(e,t){var n,r=Object(s.a)(e);try{for(r.s();!(n=r.n()).done;){var i,a=n.value,o=Object(s.a)(a.getFlattenedFilters());try{for(o.s();!(i=o.n()).done;){var u=i.value;if(t.indexOf(u.op)>=0)return u.op}}catch(c){o.e(c)}finally{o.f()}}}catch(c){r.e(c)}finally{r.f()}return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==a)throw a===t.op?new R(P.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new R(P.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(a.toString(),"' filters."))}function Nh(e,t,n){if(!n.isEqual(t))throw new R(P.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '".concat(t.toString(),"' and so you must also use '").concat(t.toString(),"' as your first argument to orderBy(), but your first orderBy() is on field '").concat(n.toString(),"' instead."))}var Bh=function(){function e(){Object(f.a)(this,e)}return Object(p.a)(e,[{key:"convertValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Xe(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ze(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ve(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw M()}}},{key:"convertObject",value:function(e,t){var n=this,r={};return De(e.fields,(function(e,i){r[e]=n.convertValue(i,t)})),r}},{key:"convertGeoPoint",value:function(e){return new Fl(ze(e.latitude),ze(e.longitude))}},{key:"convertArray",value:function(e,t){var n=this;return(e.values||[]).map((function(e){return n.convertValue(e,t)}))}},{key:"convertServerTimestamp",value:function(e,t){switch(t){case"previous":var n=He(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(We(e));default:return null}}},{key:"convertTimestamp",value:function(e){var t=Ue(e);return new Q(t.seconds,t.nanos)}},{key:"convertDocumentKey",value:function(e,t){var n=$.fromString(e);C(ii(n));var r=new Me(n.get(1),n.get(3)),i=new ne(n.popFirst(5));return r.isEqual(t)||A("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}]),e}();function Fh(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var Uh=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this)).firestore=e,r}return Object(p.a)(n,[{key:"convertBytes",value:function(e){return new Ll(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Vc(this.firestore,null,t)}}]),n}(Bh),zh=function(){function e(t,n){Object(f.a)(this,e),this.hasPendingWrites=t,this.fromCache=n}return Object(p.a)(e,[{key:"isEqual",value:function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}]),e}(),Vh=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r,i,a,o,s){var u;return Object(f.a)(this,n),(u=t.call(this,e,r,i,a,s))._firestore=e,u._firestoreImpl=e,u.metadata=o,u}return Object(p.a)(n,[{key:"exists",value:function(){return Object(i.a)(Object(a.a)(n.prototype),"exists",this).call(this)}},{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){var t=new Gh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){var n=this._document.data.field(ph("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}]),n}(dh),Gh=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i.a)(Object(a.a)(n.prototype),"data",this).call(this,e)}}]),n}(Vh),Hh=function(){function e(t,n,r,i){Object(f.a)(this,e),this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new zh(i.hasPendingWrites,i.fromCache),this.query=r}return Object(p.a)(e,[{key:"docs",get:function(){var e=[];return this.forEach((function(t){return e.push(t)})),e}},{key:"size",get:function(){return this._snapshot.docs.size}},{key:"empty",get:function(){return 0===this.size}},{key:"forEach",value:function(e,t){var n=this;this._snapshot.docs.forEach((function(r){e.call(t,new Gh(n._firestore,n._userDataWriter,r.key,r,new zh(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))}},{key:"docChanges",value:function(){var e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new R(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){var n=0;return e._snapshot.docChanges.map((function(t){var r=new Gh(e._firestore,e._userDataWriter,t.doc.key,t.doc,new zh(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);return t.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((function(e){return t||3!==e.type})).map((function(t){var n=new Gh(e._firestore,e._userDataWriter,t.doc.key,t.doc,new zh(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,a=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(a=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:Wh(t.type),doc:n,oldIndex:i,newIndex:a}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}]),e}();function Wh(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M()}}function qh(e,t){return e instanceof Vh&&t instanceof Vh?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Hh&&t instanceof Hh&&e._firestore===t._firestore&&Kc(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function Yh(e){e=Lc(e,Vc);var t=Lc(e.firestore,kl);return gl(_l(t),e._key).then((function(n){return sd(t,e,n)}))}var Xh=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this)).firestore=e,r}return Object(p.a)(n,[{key:"convertBytes",value:function(e){return new Ll(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Vc(this.firestore,null,t)}}]),n}(Bh);function Kh(e){e=Lc(e,Vc);var t=Lc(e.firestore,kl),n=_l(t),r=new Xh(t);return function(e,t){var n=new L;return e.asyncQueue.enqueueAndForget(Object(c.a)(Object(u.a)().mark((function r(){return Object(u.a)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,n,r){var i,a;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,function(e,t){var n=I(e);return n.persistence.runTransaction("read document","readonly",(function(e){return n.localDocuments.getDocument(e,t)}))}(t,n);case 3:(i=e.sent).isFoundDocument()?r.resolve(i):i.isNoDocument()?r.resolve(null):r.reject(new R(P.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),a=su(e.t0,"Failed to get document '".concat(n," from cache")),r.reject(a);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,hl(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._key).then((function(n){return new Vh(t,r,e._key,n,new zh(null!==n&&n.hasLocalMutations,!0),e.converter)}))}function Qh(e){e=Lc(e,Vc);var t=Lc(e.firestore,kl);return gl(_l(t),e._key,{source:"server"}).then((function(n){return sd(t,e,n)}))}function Zh(e){e=Lc(e,Gc);var t=Lc(e.firestore,kl),n=_l(t),r=new Xh(t);return vh(e._query),yl(n,e._query).then((function(n){return new Hh(t,r,e,n)}))}function Jh(e){e=Lc(e,Gc);var t=Lc(e.firestore,kl),n=_l(t),r=new Xh(t);return function(e,t){var n=new L;return e.asyncQueue.enqueueAndForget(Object(c.a)(Object(u.a)().mark((function r(){return Object(u.a)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=Object(c.a)(Object(u.a)().mark((function e(t,n,r){var i,a,o,s,c;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Uo(t,n,!0);case 3:i=e.sent,a=new Au(n,i.Hi),o=a.Wu(i.documents),s=a.applyChanges(o,!1),r.resolve(s.snapshot),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),c=su(e.t0,"Failed to execute query '".concat(n," against cache")),r.reject(c);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,hl(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._query).then((function(n){return new Hh(t,r,e,n)}))}function $h(e){e=Lc(e,Gc);var t=Lc(e.firestore,kl),n=_l(t),r=new Xh(t);return yl(n,e._query,{source:"server"}).then((function(n){return new Hh(t,r,e,n)}))}function ed(e,t,n){e=Lc(e,Vc);var r=Lc(e.firestore,kl),i=Fh(e.converter,t,n);return od(r,[Yl(ql(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Nn.none())])}function td(e,t,n){e=Lc(e,Vc);for(var r=Lc(e.firestore,kl),i=ql(r),a=arguments.length,o=new Array(a>3?a-3:0),s=3;s<a;s++)o[s-3]=arguments[s];return od(r,[("string"==typeof(t=Object(y.p)(t))||t instanceof Nl?th(i,"updateDoc",e._key,t,n,o):eh(i,"updateDoc",e._key,t)).toMutation(e._key,Nn.exists(!0))])}function nd(e){return od(Lc(e.firestore,kl),[new Jn(e._key,Nn.none())])}function rd(e,t){var n=Lc(e.firestore,kl),r=Yc(e),i=Fh(e.converter,t);return od(n,[Yl(ql(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Nn.exists(!1))]).then((function(){return r}))}function id(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,a,o;e=Object(y.p)(e);var s={includeMetadataChanges:!1},l=0;"object"!=typeof n[l]||wl(n[l])||(s=n[l],l++);var h,d,f,p={includeMetadataChanges:s.includeMetadataChanges};if(wl(n[l])){var v=n[l];n[l]=null===(i=v.next)||void 0===i?void 0:i.bind(v),n[l+1]=null===(a=v.error)||void 0===a?void 0:a.bind(v),n[l+2]=null===(o=v.complete)||void 0===o?void 0:o.bind(v)}if(e instanceof Vc)d=Lc(e.firestore,kl),f=rn(e._key.path),h={next:function(t){n[l]&&n[l](sd(d,e,t))},error:n[l+1],complete:n[l+2]};else{var m=Lc(e,Gc);d=Lc(m.firestore,kl),f=m._query;var g=new Xh(d);h={next:function(e){n[l]&&n[l](new Hh(d,g,m,e))},error:n[l+1],complete:n[l+2]},vh(e._query)}return function(e,t,n,r){var i=new Zc(r),a=new wu(t,i,n);return e.asyncQueue.enqueueAndForget(Object(c.a)(Object(u.a)().mark((function t(){return Object(u.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=fu,t.next=3,vl(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){i.bc(),e.asyncQueue.enqueueAndForget(Object(c.a)(Object(u.a)().mark((function t(){return Object(u.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=vu,t.next=3,vl(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(_l(d),f,p,h)}function ad(e,t){return function(e,t){var n=new Zc(t);return e.asyncQueue.enqueueAndForget(Object(c.a)(Object(u.a)().mark((function t(){return Object(u.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){I(e).Ru.add(t),t.next()},t.next=3,vl(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){n.bc(),e.asyncQueue.enqueueAndForget(Object(c.a)(Object(u.a)().mark((function t(){return Object(u.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){I(e).Ru.delete(t)},t.next=3,vl(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(_l(e=Lc(e,kl)),wl(t)?t:{next:t})}function od(e,t){return function(e,t){var n=new L;return e.asyncQueue.enqueueAndForget(Object(c.a)(Object(u.a)().mark((function r(){return Object(u.a)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=Nu,r.next=3,fl(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(_l(e),t)}function sd(e,t,n){var r=n.docs.get(t._key),i=new Xh(e);return new Vh(e,i,t._key,r,new zh(n.hasPendingWrites,n.fromCache),t.converter)}var ud={maxAttempts:5},cd=function(){function e(t,n){Object(f.a)(this,e),this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=ql(t)}return Object(p.a)(e,[{key:"set",value:function(e,t,n){this._verifyNotCommitted();var r=ld(e,this._firestore),i=Fh(r.converter,t,n),a=Yl(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(a.toMutation(r._key,Nn.none())),this}},{key:"update",value:function(e,t,n){this._verifyNotCommitted();for(var r,i=ld(e,this._firestore),a=arguments.length,o=new Array(a>3?a-3:0),s=3;s<a;s++)o[s-3]=arguments[s];return r="string"==typeof(t=Object(y.p)(t))||t instanceof Nl?th(this._dataReader,"WriteBatch.update",i._key,t,n,o):eh(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(r.toMutation(i._key,Nn.exists(!0))),this}},{key:"delete",value:function(e){this._verifyNotCommitted();var t=ld(e,this._firestore);return this._mutations=this._mutations.concat(new Jn(t._key,Nn.none())),this}},{key:"commit",value:function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}},{key:"_verifyNotCommitted",value:function(){if(this._committed)throw new R(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}]),e}();function ld(e,t){if((e=Object(y.p)(e)).firestore!==t)throw new R(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}var hd=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e,r){var i;return Object(f.a)(this,n),(i=t.call(this,e,r))._firestore=e,i}return Object(p.a)(n,[{key:"get",value:function(e){var t=this,r=ld(e,this._firestore),o=new Xh(this._firestore);return Object(i.a)(Object(a.a)(n.prototype),"get",this).call(this,e).then((function(e){return new Vh(t._firestore,o,r._key,e._document,new zh(!1,!1),r.converter)}))}}]),n}(function(){function e(t,n){Object(f.a)(this,e),this._firestore=t,this._transaction=n,this._dataReader=ql(t)}return Object(p.a)(e,[{key:"get",value:function(e){var t=this,n=ld(e,this._firestore),r=new Uh(this._firestore);return this._transaction.lookup([n._key]).then((function(e){if(!e||1!==e.length)return M();var i=e[0];if(i.isFoundDocument())return new dh(t._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new dh(t._firestore,r,n._key,null,n.converter);throw M()}))}},{key:"set",value:function(e,t,n){var r=ld(e,this._firestore),i=Fh(r.converter,t,n),a=Yl(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,a),this}},{key:"update",value:function(e,t,n){for(var r,i=ld(e,this._firestore),a=arguments.length,o=new Array(a>3?a-3:0),s=3;s<a;s++)o[s-3]=arguments[s];return r="string"==typeof(t=Object(y.p)(t))||t instanceof Nl?th(this._dataReader,"Transaction.update",i._key,t,n,o):eh(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,r),this}},{key:"delete",value:function(e){var t=ld(e,this._firestore);return this._transaction.delete(t._key),this}}]),e}());function dd(e,t,n){e=Lc(e,kl);var r=Object.assign(Object.assign({},ud),n);return function(e){if(e.maxAttempts<1)throw new R(P.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){var r=new L;return e.asyncQueue.enqueueAndForget(Object(c.a)(Object(u.a)().mark((function i(){var a;return Object(u.a)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,pl(e);case 2:a=i.sent,new el(e.asyncQueue,a,n,t,r).run();case 4:case"end":return i.stop()}}),i)})))),r.promise}(_l(e),(function(n){return t(new hd(e,n))}),r)}function fd(){return new Xl("deleteField")}function pd(){return new Ql("serverTimestamp")}function vd(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Zl("arrayUnion",t)}function md(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Jl("arrayRemove",t)}function gd(e){return new $l("increment",e)}!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){O=e}(v.SDK_VERSION),Object(v._registerComponent)(new m.a("firestore",(function(e,n){var r=n.instanceIdentifier,i=n.options,a=e.getProvider("app").getImmediate(),o=new kl(new U(e.getProvider("auth-internal")),new H(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new R(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Me(e.options.projectId,t)}(a,r),a);return i=Object.assign({useFetchStreams:t},i),o._setSettings(i),o}),"PUBLIC").setMultipleInstances(!0)),Object(v.registerVersion)(w,"3.8.3",e),Object(v.registerVersion)(w,"3.8.3","esm2017")}()}).call(this,n(38))},function(e,t,n){"use strict";n.d(t,"a",(function(){return $})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return te})),n.d(t,"d",(function(){return Y})),n.d(t,"e",(function(){return w})),n.d(t,"f",(function(){return x})),n.d(t,"g",(function(){return b})),n.d(t,"h",(function(){return E})),n.d(t,"i",(function(){return ve})),n.d(t,"j",(function(){return O})),n.d(t,"k",(function(){return ne})),n.d(t,"l",(function(){return K})),n.d(t,"m",(function(){return V})),n.d(t,"n",(function(){return M})),n.d(t,"o",(function(){return A})),n.d(t,"p",(function(){return X})),n.d(t,"q",(function(){return H}));var r,i=n(0),a=n(3),o=n(8),s=n(2),u=n(1),c=n(4),l=n(5),h=n(32),d=n(15),f=n(33),p=n(7),v=n(10);function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},m.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(r||(r={}));var g,y="popstate";function b(e){void 0===e&&(e={});var t,n=e,i=n.initialEntries,a=void 0===i?["/"]:i,o=n.initialIndex,s=n.v5Compat,u=void 0!==s&&s;t=a.map((function(e,t){return p(e,"string"===typeof e?null:e.state,0===t?"default":void 0)}));var c=d(null==o?t.length-1:o),l=r.Pop,h=null;function d(e){return Math.min(Math.max(e,0),t.length-1)}function f(){return t[c]}function p(e,n,r){void 0===n&&(n=null);var i=S(t?f().pathname:"/",e,n,r);return k("/"===i.pathname.charAt(0),"relative pathnames are not supported in memory history: "+JSON.stringify(e)),i}function v(e){return"string"===typeof e?e:E(e)}return{get index(){return c},get action(){return l},get location(){return f()},createHref:v,createURL:function(e){return new URL(v(e),"http://localhost")},encodeLocation:function(e){var t="string"===typeof e?A(e):e;return{pathname:t.pathname||"",search:t.search||"",hash:t.hash||""}},push:function(e,n){l=r.Push;var i=p(e,n);c+=1,t.splice(c,t.length,i),u&&h&&h({action:l,location:i,delta:1})},replace:function(e,n){l=r.Replace;var i=p(e,n);t[c]=i,u&&h&&h({action:l,location:i,delta:0})},go:function(e){l=r.Pop;var n=d(c+e),i=t[n];c=n,h&&h({action:l,location:i,delta:e})},listen:function(e){return h=e,function(){h=null}}}}function w(e){return void 0===e&&(e={}),j((function(e,t){var n=e.location;return S("",{pathname:n.pathname,search:n.search,hash:n.hash},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:E(t)}),null,e)}function x(e){return void 0===e&&(e={}),j((function(e,t){var n=A(e.location.hash.substr(1)),r=n.pathname,i=void 0===r?"/":r,a=n.search,o=void 0===a?"":a,s=n.hash;return S("",{pathname:i,search:o,hash:void 0===s?"":s},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){var n=e.document.querySelector("base"),r="";if(n&&n.getAttribute("href")){var i=e.location.href,a=i.indexOf("#");r=-1===a?i:i.slice(0,a)}return r+"#"+("string"===typeof t?t:E(t))}),(function(e,t){k("/"===e.pathname.charAt(0),"relative pathnames are not supported in hash history.push("+JSON.stringify(t)+")")}),e)}function O(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function k(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function _(e,t){return{usr:e.state,key:e.key,idx:t}}function S(e,t,n,r){return void 0===n&&(n=null),m({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?A(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function E(e){var t=e.pathname,n=void 0===t?"/":t,r=e.search,i=void 0===r?"":r,a=e.hash,o=void 0===a?"":a;return i&&"?"!==i&&(n+="?"===i.charAt(0)?i:"?"+i),o&&"#"!==o&&(n+="#"===o.charAt(0)?o:"#"+o),n}function A(e){var t={};if(e){var n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));var r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function j(e,t,n,i){void 0===i&&(i={});var a=i,o=a.window,s=void 0===o?document.defaultView:o,u=a.v5Compat,c=void 0!==u&&u,l=s.history,h=r.Pop,d=null,f=p();function p(){return(l.state||{idx:null}).idx}function v(){h=r.Pop;var e=p(),t=null==e?null:e-f;f=e,d&&d({action:h,location:b.location,delta:t})}function g(e){var t="null"!==s.location.origin?s.location.origin:s.location.href,n="string"===typeof e?e:E(e);return O(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==f&&(f=0,l.replaceState(m({},l.state,{idx:f}),""));var b={get action(){return h},get location(){return e(s,l)},listen:function(e){if(d)throw new Error("A history only accepts one active listener");return s.addEventListener(y,v),d=e,function(){s.removeEventListener(y,v),d=null}},createHref:function(e){return t(s,e)},createURL:g,encodeLocation:function(e){var t=g(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){h=r.Push;var i=S(b.location,e,t);n&&n(i,e);var a=_(i,f=p()+1),o=b.createHref(i);try{l.pushState(a,"",o)}catch(u){s.location.assign(o)}c&&d&&d({action:h,location:b.location,delta:1})},replace:function(e,t){h=r.Replace;var i=S(b.location,e,t);n&&n(i,e);var a=_(i,f=p()),o=b.createHref(i);l.replaceState(a,"",o),c&&d&&d({action:h,location:b.location,delta:0})},go:function(e){return l.go(e)}};return b}function T(e,t,n){return void 0===t&&(t=[]),void 0===n&&(n=new Set),e.map((function(e,r){var i=[].concat(Object(v.a)(t),[r]),a="string"===typeof e.id?e.id:i.join("-");return O(!0!==e.index||!e.children,"Cannot specify children on an index route"),O(!n.has(a),'Found a route id collision on id "'+a+"\".  Route id's must be globally unique within Data Router usages"),n.add(a),function(e){return!0===e.index}(e)?m({},e,{id:a}):m({},e,{id:a,children:e.children?T(e.children,i,n):void 0})}))}function M(e,t,n){void 0===n&&(n="/");var r=H(("string"===typeof t?A(t):t).pathname||"/",n);if(null==r)return null;var i=C(e);!function(e){e.sort((function(e,t){return e.score!==t.score?t.score-e.score:function(e,t){var n=e.length===t.length&&e.slice(0,-1).every((function(e,n){return e===t[n]}));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((function(e){return e.childrenIndex})),t.routesMeta.map((function(e){return e.childrenIndex})))}))}(i);for(var a=null,o=0;null==a&&o<i.length;++o)a=z(i[o],G(r));return a}function C(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");var i=function(e,i,a){var o={relativePath:void 0===a?e.path||"":a,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};o.relativePath.startsWith("/")&&(O(o.relativePath.startsWith(r),'Absolute route path "'+o.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),o.relativePath=o.relativePath.slice(r.length));var s=K([r,o.relativePath]),u=n.concat(o);e.children&&e.children.length>0&&(O(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),C(e.children,t,u,s)),(null!=e.path||e.index)&&t.push({path:s,score:U(s,e.index),routesMeta:u})};return e.forEach((function(e,t){var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?")){var r,a=Object(p.a)(D(e.path));try{for(a.s();!(r=a.n()).done;){var o=r.value;i(e,t,o)}}catch(s){a.e(s)}finally{a.f()}}else i(e,t)})),t}function D(e){var t=e.split("/");if(0===t.length)return[];var n=Object(f.a)(t),r=n[0],i=n.slice(1),a=r.endsWith("?"),o=r.replace(/\?$/,"");if(0===i.length)return a?[o,""]:[o];var s=D(i.join("/")),u=[];return u.push.apply(u,Object(v.a)(s.map((function(e){return""===e?o:[o,e].join("/")})))),a&&u.push.apply(u,Object(v.a)(s)),u.map((function(t){return e.startsWith("/")&&""===t?"/":t}))}!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(g||(g={}));var I=/^:\w+$/,P=3,R=2,L=1,N=10,B=-2,F=function(e){return"*"===e};function U(e,t){var n=e.split("/"),r=n.length;return n.some(F)&&(r+=B),t&&(r+=R),n.filter((function(e){return!F(e)})).reduce((function(e,t){return e+(I.test(t)?P:""===t?L:N)}),r)}function z(e,t){for(var n=e.routesMeta,r={},i="/",a=[],o=0;o<n.length;++o){var s=n[o],u=o===n.length-1,c="/"===i?t:t.slice(i.length)||"/",l=V({path:s.relativePath,caseSensitive:s.caseSensitive,end:u},c);if(!l)return null;Object.assign(r,l.params);var h=s.route;a.push({params:r,pathname:K([i,l.pathname]),pathnameBase:Q(K([i,l.pathnameBase])),route:h}),"/"!==l.pathnameBase&&(i=K([i,l.pathnameBase]))}return a}function V(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});var n=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);W("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');var r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(function(e,t){return r.push(t),"/([^\\/]+)"}));e.endsWith("*")?(r.push("*"),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))");var a=new RegExp(i,t?void 0:"i");return[a,r]}(e.path,e.caseSensitive,e.end),r=Object(d.a)(n,2),i=r[0],a=r[1],o=t.match(i);if(!o)return null;var s=o[0],u=s.replace(/(.)\/+$/,"$1"),c=o.slice(1);return{params:a.reduce((function(e,t,n){if("*"===t){var r=c[n]||"";u=s.slice(0,s.length-r.length).replace(/(.)\/+$/,"$1")}return e[t]=function(e,t){try{return decodeURIComponent(e)}catch(n){return W(!1,'The value for the URL param "'+t+'" will not be decoded because the string "'+e+'" is a malformed URL segment. This is probably due to a bad percent encoding ('+n+")."),e}}(c[n]||"",t),e}),{}),pathname:s,pathnameBase:u,pattern:e}}function G(e){try{return decodeURI(e)}catch(t){return W(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function H(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;var n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function W(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function q(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function Y(e){return e.filter((function(e,t){return 0===t||e.route.path&&e.route.path.length>0}))}function X(e,t,n,r){var i;void 0===r&&(r=!1),"string"===typeof e?i=A(e):(O(!(i=m({},e)).pathname||!i.pathname.includes("?"),q("?","pathname","search",i)),O(!i.pathname||!i.pathname.includes("#"),q("#","pathname","hash",i)),O(!i.search||!i.search.includes("#"),q("#","search","hash",i)));var a,o=""===e||""===i.pathname,s=o?"/":i.pathname;if(r||null==s)a=n;else{var u=t.length-1;if(s.startsWith("..")){for(var c=s.split("/");".."===c[0];)c.shift(),u-=1;i.pathname=c.join("/")}a=u>=0?t[u]:"/"}var l=function(e,t){void 0===t&&(t="/");var n="string"===typeof e?A(e):e,r=n.pathname,i=n.search,a=void 0===i?"":i,o=n.hash,s=void 0===o?"":o,u=r?r.startsWith("/")?r:function(e,t){var n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((function(e){".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(r,t):t;return{pathname:u,search:Z(a),hash:J(s)}}(i,a),h=s&&"/"!==s&&s.endsWith("/"),d=(o||"."===s)&&n.endsWith("/");return l.pathname.endsWith("/")||!h&&!d||(l.pathname+="/"),l}var K=function(e){return e.join("/").replace(/\/\/+/g,"/")},Q=function(e){return e.replace(/\/+$/,"").replace(/^\/*/,"/")},Z=function(e){return e&&"?"!==e?e.startsWith("?")?e:"?"+e:""},J=function(e){return e&&"#"!==e?e.startsWith("#")?e:"#"+e:""},$=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n)}(Object(h.a)(Error)),ee=function(){function e(t,n){var r,i=this;Object(u.a)(this,e),this.pendingKeysSet=new Set,this.subscribers=new Set,this.deferredKeys=[],O(t&&"object"===typeof t&&!Array.isArray(t),"defer() only accepts plain objects"),this.abortPromise=new Promise((function(e,t){return r=t})),this.controller=new AbortController;var a=function(){return r(new $("Deferred data aborted"))};this.unlistenAbortSignal=function(){return i.controller.signal.removeEventListener("abort",a)},this.controller.signal.addEventListener("abort",a),this.data=Object.entries(t).reduce((function(e,t){var n=Object(d.a)(t,2),r=n[0],a=n[1];return Object.assign(e,Object(o.a)({},r,i.trackPromise(r,a)))}),{}),this.done&&this.unlistenAbortSignal(),this.init=n}return Object(s.a)(e,[{key:"trackPromise",value:function(e,t){var n=this;if(!(t instanceof Promise))return t;this.deferredKeys.push(e),this.pendingKeysSet.add(e);var r=Promise.race([t,this.abortPromise]).then((function(t){return n.onSettle(r,e,null,t)}),(function(t){return n.onSettle(r,e,t)}));return r.catch((function(){})),Object.defineProperty(r,"_tracked",{get:function(){return!0}}),r}},{key:"onSettle",value:function(e,t,n,r){return this.controller.signal.aborted&&n instanceof $?(this.unlistenAbortSignal(),Object.defineProperty(e,"_error",{get:function(){return n}}),Promise.reject(n)):(this.pendingKeysSet.delete(t),this.done&&this.unlistenAbortSignal(),n?(Object.defineProperty(e,"_error",{get:function(){return n}}),this.emit(!1,t),Promise.reject(n)):(Object.defineProperty(e,"_data",{get:function(){return r}}),this.emit(!1,t),r))}},{key:"emit",value:function(e,t){this.subscribers.forEach((function(n){return n(e,t)}))}},{key:"subscribe",value:function(e){var t=this;return this.subscribers.add(e),function(){return t.subscribers.delete(e)}}},{key:"cancel",value:function(){var e=this;this.controller.abort(),this.pendingKeysSet.forEach((function(t,n){return e.pendingKeysSet.delete(n)})),this.emit(!0)}},{key:"resolveData",value:function(){var e=Object(a.a)(Object(i.a)().mark((function e(t){var n,r,a=this;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!1,this.done){e.next=7;break}return r=function(){return a.cancel()},t.addEventListener("abort",r),e.next=6,new Promise((function(e){a.subscribe((function(n){t.removeEventListener("abort",r),(n||a.done)&&e(n)}))}));case 6:n=e.sent;case 7:return e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"done",get:function(){return 0===this.pendingKeysSet.size}},{key:"unwrappedData",get:function(){return O(null!==this.data&&this.done,"Can only unwrap data on initialized and settled deferreds"),Object.entries(this.data).reduce((function(e,t){var n=Object(d.a)(t,2),r=n[0],i=n[1];return Object.assign(e,Object(o.a)({},r,function(e){if(!function(e){return e instanceof Promise&&!0===e._tracked}(e))return e;if(e._error)throw e._error;return e._data}(i)))}),{})}},{key:"pendingKeys",get:function(){return Array.from(this.pendingKeysSet)}}]),e}();var te=Object(s.a)((function e(t,n,r,i){Object(u.a)(this,e),void 0===i&&(i=!1),this.status=t,this.statusText=n||"",this.internal=i,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}));function ne(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}var re=["post","put","patch","delete"],ie=new Set(re),ae=["get"].concat(re),oe=new Set(ae),se=new Set([301,302,303,307,308]),ue=new Set([307,308]),ce={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0},le={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0},he={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},de=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,fe="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,pe=!fe;function ve(e){O(e.routes.length>0,"You must provide a non-empty routes array to createRouter");var t=T(e.routes),n=null,s=new Set,u=null,c=null,l=null,h=null!=e.hydrationData,f=M(t,e.history.location,e.basename),y=null;if(null==f){var b=Me(404,{pathname:e.history.location.pathname}),w=Te(t),x=w.matches,k=w.route;f=x,y=Object(o.a)({},k.id,b)}var _,E,A=!f.some((function(e){return e.route.loader}))||null!=e.hydrationData,j={historyAction:e.history.action,location:e.history.location,matches:f,initialized:A,navigation:ce,restoreScrollPosition:null==e.hydrationData&&null,preventScrollReset:!1,revalidation:"idle",loaderData:e.hydrationData&&e.hydrationData.loaderData||{},actionData:e.hydrationData&&e.hydrationData.actionData||null,errors:e.hydrationData&&e.hydrationData.errors||y,fetchers:new Map,blockers:new Map},C=r.Pop,D=!1,I=!1,P=!1,R=[],L=[],N=new Map,B=0,F=-1,U=new Map,z=new Set,V=new Map,G=new Map,H=new Map,q=!1;function Y(e){j=m({},j,e),s.forEach((function(e){return e(j)}))}function X(t,n){var i,a,o,s=null!=j.actionData&&null!=j.navigation.formMethod&&Be(j.navigation.formMethod)&&"loading"===j.navigation.state&&!0!==(null==(i=t.state)?void 0:i._isRedirect);o=n.actionData?Object.keys(n.actionData).length>0?n.actionData:null:s?j.actionData:null;var u,c=n.loaderData?Ae(j.loaderData,n.loaderData,n.matches||[],n.errors):j.loaderData,l=Object(p.a)(H);try{for(l.s();!(u=l.n()).done;){Ne(Object(d.a)(u.value,1)[0])}}catch(f){l.e(f)}finally{l.f()}var h=!0===D||null!=j.navigation.formMethod&&Be(j.navigation.formMethod)&&!0!==(null==(a=t.state)?void 0:a._isRedirect);Y(m({},n,{actionData:o,loaderData:c,historyAction:C,location:t,initialized:!0,navigation:ce,revalidation:"idle",restoreScrollPosition:Ye(t,n.matches||j.matches),preventScrollReset:h,blockers:new Map(j.blockers)})),I||C===r.Pop||(C===r.Push?e.history.push(t,t.state):C===r.Replace&&e.history.replace(t,t.state)),C=r.Pop,D=!1,I=!1,P=!1,R=[],L=[]}function K(e,t){return Q.apply(this,arguments)}function Q(){return Q=Object(a.a)(Object(i.a)().mark((function t(n,a){var o,s,u,c,l,h,d,f,p,v;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("number"!==typeof n){t.next=3;break}return e.history.go(n),t.abrupt("return");case 3:if(o=me(n,a),s=o.path,u=o.submission,c=o.error,l=j.location,h=m({},h=S(j.location,s,a&&a.state),e.history.encodeLocation(h)),d=a&&null!=a.replace?a.replace:void 0,f=r.Push,!0===d?f=r.Replace:!1===d||null!=u&&Be(u.formMethod)&&u.formAction===j.location.pathname+j.location.search&&(f=r.Replace),p=a&&"preventScrollReset"in a?!0===a.preventScrollReset:void 0,!(v=Ve({currentLocation:l,nextLocation:h,historyAction:f}))){t.next=15;break}return Ue(v,{state:"blocked",location:h,proceed:function(){Ue(v,{state:"proceeding",proceed:void 0,reset:void 0,location:h}),K(n,a)},reset:function(){Ne(v),Y({blockers:new Map(j.blockers)})}}),t.abrupt("return");case 15:return t.next=17,Z(f,h,{submission:u,pendingError:c,preventScrollReset:p,replace:a&&a.replace});case 17:return t.abrupt("return",t.sent);case 18:case"end":return t.stop()}}),t)}))),Q.apply(this,arguments)}function Z(e,t,n){return J.apply(this,arguments)}function J(){return J=Object(a.a)(Object(i.a)().mark((function n(r,a,s){var u,c,l,h,d,f,p,v,g,y,b,w,x,O,k;return Object(i.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(E&&E.abort(),E=null,C=r,I=!0===(s&&s.startUninterruptedRevalidation),qe(j.location,j.matches),D=!0===(s&&s.preventScrollReset),u=s&&s.overrideNavigation,c=M(t,a,e.basename)){n.next=14;break}return l=Me(404,{pathname:a.pathname}),h=Te(t),d=h.matches,f=h.route,Ge(),X(a,{matches:d,loaderData:{},errors:Object(o.a)({},f.id,l)}),n.abrupt("return");case 14:if(i=j.location,_=a,i.pathname!==_.pathname||i.search!==_.search||i.hash===_.hash||s&&s.submission&&Be(s.submission.formMethod)){n.next=17;break}return X(a,{matches:c}),n.abrupt("return");case 17:if(E=new AbortController,p=ke(e.history,a,E.signal,s&&s.submission),!s||!s.pendingError){n.next=23;break}g=Object(o.a)({},je(c).route.id,s.pendingError),n.next=34;break;case 23:if(!(s&&s.submission&&Be(s.submission.formMethod))){n.next=34;break}return n.next=26,$(p,a,s.submission,c,{replace:s.replace});case 26:if(!(y=n.sent).shortCircuited){n.next=29;break}return n.abrupt("return");case 29:v=y.pendingActionData,g=y.pendingActionError,b=m({state:"loading",location:a},s.submission),u=b,p=new Request(p.url,{signal:p.signal});case 34:return n.next=36,te(p,a,c,u,s&&s.submission,s&&s.replace,v,g);case 36:if(w=n.sent,x=w.shortCircuited,O=w.loaderData,k=w.errors,!x){n.next=42;break}return n.abrupt("return");case 42:E=null,X(a,m({matches:c},v?{actionData:v}:{},{loaderData:O,errors:k}));case 44:case"end":return n.stop()}var i,_}),n)}))),J.apply(this,arguments)}function $(e,t,n,r,i){return ee.apply(this,arguments)}function ee(){return ee=Object(a.a)(Object(i.a)().mark((function e(t,n,a,s,u){var c,l,h,d;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(be(),Y({navigation:m({state:"submitting",location:n},a)}),(l=We(s,n)).route.action){e.next=8;break}c={type:g.error,error:Me(405,{method:t.method,pathname:n.pathname,routeId:l.route.id})},e.next=13;break;case 8:return e.next=10,xe("action",t,l,s,_.basename);case 10:if(c=e.sent,!t.signal.aborted){e.next=13;break}return e.abrupt("return",{shortCircuited:!0});case 13:if(!Re(c)){e.next=18;break}return h=u&&null!=u.replace?u.replace:c.location===j.location.pathname+j.location.search,e.next=17,oe(j,c,{submission:a,replace:h});case 17:return e.abrupt("return",{shortCircuited:!0});case 18:if(!Pe(c)){e.next=22;break}return d=je(s,l.route.id),!0!==(u&&u.replace)&&(C=r.Push),e.abrupt("return",{pendingActionData:{},pendingActionError:Object(o.a)({},d.route.id,c.error)});case 22:if(!Ie(c)){e.next=24;break}throw Me(400,{type:"defer-action"});case 24:return e.abrupt("return",{pendingActionData:Object(o.a)({},l.route.id,c.data)});case 25:case"end":return e.stop()}}),e)}))),ee.apply(this,arguments)}function te(e,t,n,r,i,a,o,s){return ne.apply(this,arguments)}function ne(){return ne=Object(a.a)(Object(i.a)().mark((function t(n,r,a,o,s,u,c,l){var h,f,p,v,g,y,b,w,x,O,k,_,S,A,T,M,C;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((h=o)||(f=m({state:"loading",location:r,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0},s),h=f),p=s||(h.formMethod&&h.formAction&&h.formData&&h.formEncType?{formMethod:h.formMethod,formAction:h.formAction,formData:h.formData,formEncType:h.formEncType}:void 0),v=ye(e.history,j,a,p,r,P,R,L,c,l,V),g=Object(d.a)(v,2),y=g[0],b=g[1],Ge((function(e){return!(a&&a.some((function(t){return t.route.id===e})))||y&&y.some((function(t){return t.route.id===e}))})),0!==y.length||0!==b.length){t.next=8;break}return X(r,m({matches:a,loaderData:{},errors:l||null},c?{actionData:c}:{})),t.abrupt("return",{shortCircuited:!0});case 8:return I||(b.forEach((function(e){var t=j.fetchers.get(e.key),n={state:"loading",data:t&&t.data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0," _hasFetcherDoneAnything ":!0};j.fetchers.set(e.key,n)})),w=c||j.actionData,Y(m({navigation:h},w?0===Object.keys(w).length?{actionData:null}:{actionData:w}:{},b.length>0?{fetchers:new Map(j.fetchers)}:{}))),F=++B,b.forEach((function(e){return N.set(e.key,E)})),t.next=13,ve(j.matches,a,y,b,n);case 13:if(x=t.sent,O=x.results,k=x.loaderResults,_=x.fetcherResults,!n.signal.aborted){t.next=19;break}return t.abrupt("return",{shortCircuited:!0});case 19:if(b.forEach((function(e){return N.delete(e.key)})),!(S=Ce(O))){t.next=25;break}return t.next=24,oe(j,S,{replace:u});case 24:return t.abrupt("return",{shortCircuited:!0});case 25:return A=Ee(j,a,y,k,l,b,_,G),T=A.loaderData,M=A.errors,G.forEach((function(e,t){e.subscribe((function(n){(n||e.done)&&G.delete(t)}))})),De(),C=Le(F),t.abrupt("return",m({loaderData:T,errors:M},C||b.length>0?{fetchers:new Map(j.fetchers)}:{}));case 30:case"end":return t.stop()}}),t)}))),ne.apply(this,arguments)}function re(e){return j.fetchers.get(e)||le}function ie(){return ie=Object(a.a)(Object(i.a)().mark((function n(r,a,s,u,c,l){var h,f,p,v,g,y,b,w,x,k,S,A,T,D,I,H,W,q,K,Q,Z,J,$,ee,te,ne;return Object(i.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(be(),V.delete(r),u.route.action){n.next=6;break}return h=Me(405,{method:l.formMethod,pathname:s,routeId:a}),we(r,a,h),n.abrupt("return");case 6:return f=j.fetchers.get(r),p=m({state:"submitting"},l,{data:f&&f.data," _hasFetcherDoneAnything ":!0}),j.fetchers.set(r,p),Y({fetchers:new Map(j.fetchers)}),v=new AbortController,g=ke(e.history,s,v.signal,l),N.set(r,v),n.next=15,xe("action",g,u,c,_.basename);case 15:if(y=n.sent,!g.signal.aborted){n.next=19;break}return N.get(r)===v&&N.delete(r),n.abrupt("return");case 19:if(!Re(y)){n.next=26;break}return N.delete(r),z.add(r),b=m({state:"loading"},l,{data:void 0," _hasFetcherDoneAnything ":!0}),j.fetchers.set(r,b),Y({fetchers:new Map(j.fetchers)}),n.abrupt("return",oe(j,y,{isFetchActionRedirect:!0}));case 26:if(!Pe(y)){n.next=29;break}return we(r,a,y.error),n.abrupt("return");case 29:if(!Ie(y)){n.next=31;break}throw Me(400,{type:"defer-action"});case 31:return w=j.navigation.location||j.location,x=ke(e.history,w,v.signal),O(k="idle"!==j.navigation.state?M(t,j.navigation.location,e.basename):j.matches,"Didn't find any matches after fetcher action"),S=++B,U.set(r,S),A=m({state:"loading",data:y.data},l,{" _hasFetcherDoneAnything ":!0}),j.fetchers.set(r,A),T=ye(e.history,j,k,l,w,P,R,L,Object(o.a)({},u.route.id,y.data),void 0,V),D=Object(d.a)(T,2),I=D[0],(H=D[1]).filter((function(e){return e.key!==r})).forEach((function(e){var t=e.key,n=j.fetchers.get(t),r={state:"loading",data:n&&n.data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0," _hasFetcherDoneAnything ":!0};j.fetchers.set(t,r),N.set(t,v)})),Y({fetchers:new Map(j.fetchers)}),n.next=44,ve(j.matches,k,I,H,x);case 44:if(W=n.sent,q=W.results,K=W.loaderResults,Q=W.fetcherResults,!v.signal.aborted){n.next=50;break}return n.abrupt("return");case 50:if(U.delete(r),N.delete(r),H.forEach((function(e){return N.delete(e.key)})),!(Z=Ce(q))){n.next=56;break}return n.abrupt("return",oe(j,Z));case 56:J=Ee(j,j.matches,I,K,void 0,H,Q,G),$=J.loaderData,ee=J.errors,te={state:"idle",data:y.data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0," _hasFetcherDoneAnything ":!0},j.fetchers.set(r,te),ne=Le(S),"loading"===j.navigation.state&&S>F?(O(C,"Expected pending action"),E&&E.abort(),X(j.navigation.location,{matches:k,loaderData:$,errors:ee,fetchers:new Map(j.fetchers)})):(Y(m({errors:ee,loaderData:Ae(j.loaderData,$,k,ee)},ne?{fetchers:new Map(j.fetchers)}:{})),P=!1);case 61:case"end":return n.stop()}}),n)}))),ie.apply(this,arguments)}function ae(){return ae=Object(a.a)(Object(i.a)().mark((function t(n,r,a,s,u,c){var l,h,d,f,p,v,g;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l=j.fetchers.get(n),h=m({state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0},c,{data:l&&l.data," _hasFetcherDoneAnything ":!0}),j.fetchers.set(n,h),Y({fetchers:new Map(j.fetchers)}),d=new AbortController,f=ke(e.history,a,d.signal),N.set(n,d),t.next=9,xe("loader",f,s,u,_.basename);case 9:if(!Ie(p=t.sent)){t.next=17;break}return t.next=13,ze(p,f.signal,!0);case 13:if(t.t0=t.sent,t.t0){t.next=16;break}t.t0=p;case 16:p=t.t0;case 17:if(N.get(n)===d&&N.delete(n),!f.signal.aborted){t.next=20;break}return t.abrupt("return");case 20:if(!Re(p)){t.next=24;break}return t.next=23,oe(j,p);case 23:return t.abrupt("return");case 24:if(!Pe(p)){t.next=29;break}return v=je(j.matches,r),j.fetchers.delete(n),Y({fetchers:new Map(j.fetchers),errors:Object(o.a)({},v.route.id,p.error)}),t.abrupt("return");case 29:O(!Ie(p),"Unhandled fetcher deferred data"),g={state:"idle",data:p.data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0," _hasFetcherDoneAnything ":!0},j.fetchers.set(n,g),Y({fetchers:new Map(j.fetchers)});case 33:case"end":return t.stop()}}),t)}))),ae.apply(this,arguments)}function oe(e,t,n){return se.apply(this,arguments)}function se(){return se=Object(a.a)(Object(i.a)().mark((function t(n,a,o){var s,u,c,l,h,d,f,p,v,g,y,b,w;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=(u=void 0===o?{}:o).submission,l=u.replace,h=u.isFetchActionRedirect,a.revalidate&&(P=!0),O(d=S(n.location,a.location,m({_isRedirect:!0},h?{_isFetchActionRedirect:!0}:{})),"Expected a location on the redirect navigation"),!de.test(a.location)||!fe||"undefined"===typeof(null==(s=window)?void 0:s.location)){t.next=9;break}if(f=e.history.createURL(a.location).origin,window.location.origin===f){t.next=9;break}return l?window.location.replace(a.location):window.location.assign(a.location),t.abrupt("return");case 9:if(E=null,p=!0===l?r.Replace:r.Push,v=n.navigation,g=v.formMethod,y=v.formAction,b=v.formEncType,w=v.formData,!c&&g&&y&&w&&b&&(c={formMethod:g,formAction:y,formEncType:b,formData:w}),!(ue.has(a.status)&&c&&Be(c.formMethod))){t.next=18;break}return t.next=16,Z(p,d,{submission:m({},c,{formAction:a.location}),preventScrollReset:D});case 16:t.next=20;break;case 18:return t.next=20,Z(p,d,{overrideNavigation:{state:"loading",location:d,formMethod:c?c.formMethod:void 0,formAction:c?c.formAction:void 0,formEncType:c?c.formEncType:void 0,formData:c?c.formData:void 0},preventScrollReset:D});case 20:case"end":return t.stop()}}),t)}))),se.apply(this,arguments)}function ve(e,t,n,r,i){return ge.apply(this,arguments)}function ge(){return ge=Object(a.a)(Object(i.a)().mark((function t(n,r,a,o,s){var u,c,l;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([].concat(Object(v.a)(a.map((function(e){return xe("loader",s,e,r,_.basename)}))),Object(v.a)(o.map((function(t){return xe("loader",ke(e.history,t.path,s.signal),t.match,t.matches,_.basename)})))));case 2:return u=t.sent,c=u.slice(0,a.length),l=u.slice(a.length),t.next=7,Promise.all([Fe(n,a,c,s.signal,!1,j.loaderData),Fe(n,o.map((function(e){return e.match})),l,s.signal,!0)]);case 7:return t.abrupt("return",{results:u,loaderResults:c,fetcherResults:l});case 8:case"end":return t.stop()}}),t)}))),ge.apply(this,arguments)}function be(){var e;P=!0,(e=R).push.apply(e,Object(v.a)(Ge())),V.forEach((function(e,t){N.has(t)&&(L.push(t),_e(t))}))}function we(e,t,n){var r=je(j.matches,t);Oe(e),Y({errors:Object(o.a)({},r.route.id,n),fetchers:new Map(j.fetchers)})}function Oe(e){N.has(e)&&_e(e),V.delete(e),U.delete(e),z.delete(e),j.fetchers.delete(e)}function _e(e){var t=N.get(e);O(t,"Expected fetch controller: "+e),t.abort(),N.delete(e)}function Se(e){var t,n=Object(p.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i={state:"idle",data:re(r).data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0," _hasFetcherDoneAnything ":!0};j.fetchers.set(r,i)}}catch(a){n.e(a)}finally{n.f()}}function De(){var e,t=[],n=Object(p.a)(z);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=j.fetchers.get(r);O(i,"Expected fetcher: "+r),"loading"===i.state&&(z.delete(r),t.push(r))}}catch(a){n.e(a)}finally{n.f()}Se(t)}function Le(e){var t,n=[],r=Object(p.a)(U);try{for(r.s();!(t=r.n()).done;){var i=Object(d.a)(t.value,2),a=i[0];if(i[1]<e){var o=j.fetchers.get(a);O(o,"Expected fetcher: "+a),"loading"===o.state&&(_e(a),U.delete(a),n.push(a))}}}catch(s){r.e(s)}finally{r.f()}return Se(n),n.length>0}function Ne(e){j.blockers.delete(e),H.delete(e)}function Ue(e,t){var n=j.blockers.get(e)||he;O("unblocked"===n.state&&"blocked"===t.state||"blocked"===n.state&&"blocked"===t.state||"blocked"===n.state&&"proceeding"===t.state||"blocked"===n.state&&"unblocked"===t.state||"proceeding"===n.state&&"unblocked"===t.state,"Invalid blocker state transition: "+n.state+" -> "+t.state),j.blockers.set(e,t),Y({blockers:new Map(j.blockers)})}function Ve(e){var t=e.currentLocation,n=e.nextLocation,r=e.historyAction;if(0!==H.size){H.size>1&&W(!1,"A router only supports one blocker at a time");var i=Array.from(H.entries()),a=Object(d.a)(i[i.length-1],2),o=a[0],s=a[1],u=j.blockers.get(o);if(!u||"proceeding"!==u.state)return s({currentLocation:t,nextLocation:n,historyAction:r})?o:void 0}}function Ge(e){var t=[];return G.forEach((function(n,r){e&&!e(r)||(n.cancel(),t.push(r),G.delete(r))})),t}function qe(e,t){if(u&&c&&l){var n=t.map((function(e){return He(e,j.loaderData)})),r=c(e,n)||e.key;u[r]=l()}}function Ye(e,t){if(u&&c&&l){var n=t.map((function(e){return He(e,j.loaderData)})),r=c(e,n)||e.key,i=u[r];if("number"===typeof i)return i}return null}return _={get basename(){return e.basename},get state(){return j},get routes(){return t},initialize:function(){return n=e.history.listen((function(t){var n=t.action,r=t.location,i=t.delta;if(!q){W(0===H.size||null!=i,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");var a=Ve({currentLocation:j.location,nextLocation:r,historyAction:n});return a&&null!=i?(q=!0,e.history.go(-1*i),void Ue(a,{state:"blocked",location:r,proceed:function(){Ue(a,{state:"proceeding",proceed:void 0,reset:void 0,location:r}),e.history.go(i)},reset:function(){Ne(a),Y({blockers:new Map(_.state.blockers)})}})):Z(n,r)}q=!1})),j.initialized||Z(r.Pop,j.location),_},subscribe:function(e){return s.add(e),function(){return s.delete(e)}},enableScrollRestoration:function(e,t,n){if(u=e,l=t,c=n||function(e){return e.key},!h&&j.navigation===ce){h=!0;var r=Ye(j.location,j.matches);null!=r&&Y({restoreScrollPosition:r})}return function(){u=null,l=null,c=null}},navigate:K,fetch:function(n,r,i,a){if(pe)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");N.has(n)&&_e(n);var o=M(t,i,e.basename);if(o){var s=me(i,a,!0),u=s.path,c=s.submission,l=We(o,u);D=!0===(a&&a.preventScrollReset),c&&Be(c.formMethod)?function(e,t,n,r,i,a){ie.apply(this,arguments)}(n,r,u,l,o,c):(V.set(n,{routeId:r,path:u,match:l,matches:o}),function(e,t,n,r,i,a){ae.apply(this,arguments)}(n,r,u,l,o,c))}else we(n,r,Me(404,{pathname:i}))},revalidate:function(){be(),Y({revalidation:"loading"}),"submitting"!==j.navigation.state&&("idle"!==j.navigation.state?Z(C||j.historyAction,j.navigation.location,{overrideNavigation:j.navigation}):Z(j.historyAction,j.location,{startUninterruptedRevalidation:!0}))},createHref:function(t){return e.history.createHref(t)},encodeLocation:function(t){return e.history.encodeLocation(t)},getFetcher:re,deleteFetcher:Oe,dispose:function(){n&&n(),s.clear(),E&&E.abort(),j.fetchers.forEach((function(e,t){return Oe(t)})),j.blockers.forEach((function(e,t){return Ne(t)}))},getBlocker:function(e,t){var n=j.blockers.get(e)||he;return H.get(e)!==t&&H.set(e,t),n},deleteBlocker:Ne,_internalFetchControllers:N,_internalActiveDeferreds:G},_}Symbol("deferred");function me(e,t,n){void 0===n&&(n=!1);var r,i="string"===typeof e?e:E(e);if(!t||!function(e){return null!=e&&"formData"in e}(t))return{path:i};if(t.formMethod&&!Ne(t.formMethod))return{path:i,error:Me(405,{method:t.formMethod})};if(t.formData&&Be((r={formMethod:t.formMethod||"get",formAction:De(i),formEncType:t&&t.formEncType||"application/x-www-form-urlencoded",formData:t.formData}).formMethod))return{path:i,submission:r};var a=A(i),o=_e(t.formData);return n&&a.search&&Ge(a.search)&&o.append("index",""),a.search="?"+o,{path:E(a),submission:r}}function ge(e,t){var n=e;if(t){var r=e.findIndex((function(e){return e.route.id===t}));r>=0&&(n=e.slice(0,r))}return n}function ye(e,t,n,r,i,a,o,s,u,c,l){var h=c?Object.values(c)[0]:u?Object.values(u)[0]:void 0,d=e.createURL(t.location),f=e.createURL(i),p=a||d.toString()===f.toString()||d.search!==f.search,v=c?Object.keys(c)[0]:void 0,g=ge(n,v).filter((function(e,n){if(null==e.route.loader)return!1;if(function(e,t,n){var r=!t||n.route.id!==t.route.id,i=void 0===e[n.route.id];return r||i}(t.loaderData,t.matches[n],e)||o.some((function(t){return t===e.route.id})))return!0;var i=t.matches[n],a=e;return we(e,m({currentUrl:d,currentParams:i.params,nextUrl:f,nextParams:a.params},r,{actionResult:h,defaultShouldRevalidate:p||be(i,a)}))})),y=[];return l&&l.forEach((function(e,i){n.some((function(t){return t.route.id===e.routeId}))&&((s.includes(i)||we(e.match,m({currentUrl:d,currentParams:t.matches[t.matches.length-1].params,nextUrl:f,nextParams:n[n.length-1].params},r,{actionResult:h,defaultShouldRevalidate:p})))&&y.push(m({key:i},e)))})),[g,y]}function be(e,t){var n=e.route.path;return e.pathname!==t.pathname||null!=n&&n.endsWith("*")&&e.params["*"]!==t.params["*"]}function we(e,t){if(e.route.shouldRevalidate){var n=e.route.shouldRevalidate(t);if("boolean"===typeof n)return n}return t.defaultShouldRevalidate}function xe(e,t,n,r,i,a,o,s){return Oe.apply(this,arguments)}function Oe(){return(Oe=Object(a.a)(Object(i.a)().mark((function e(t,n,r,a,o,s,u,c){var l,h,d,f,p,v,m,y,b,w,x,k,_,S,A,j;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===o&&(o="/"),void 0===s&&(s=!1),void 0===u&&(u=!1),f=new Promise((function(e,t){return d=t})),p=function(){return d()},n.signal.addEventListener("abort",p),e.prev=6,O(v=r.route[t],"Could not find the "+t+' to run on the "'+r.route.id+'" route'),e.next=11,Promise.race([v({request:n,params:r.params,context:c}),f]);case 11:O(void 0!==(h=e.sent),"You defined "+("action"===t?"an action":"a loader")+' for route "'+r.route.id+"\" but didn't return anything from your `"+t+"` function. Please return a value or `null`."),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(6),l=g.error,h=e.t0;case 19:return e.prev=19,n.signal.removeEventListener("abort",p),e.finish(19);case 22:if(!Le(h)){e.next=47;break}if(m=h.status,!se.has(m)){e.next=32;break}if(O(y=h.headers.get("Location"),"Redirects returned/thrown from loaders/actions must have a Location header"),de.test(y)?s||(_=new URL(n.url),(S=y.startsWith("//")?new URL(_.protocol+y):new URL(y)).origin===_.origin&&(y=S.pathname+S.search+S.hash)):(b=a.slice(0,a.indexOf(r)+1),w=Y(b).map((function(e){return e.pathnameBase})),O(E(x=X(y,w,new URL(n.url).pathname)),"Unable to resolve redirect location: "+y),o&&(k=x.pathname,x.pathname="/"===k?o:K([o,k])),y=E(x)),!s){e.next=31;break}throw h.headers.set("Location",y),h;case 31:return e.abrupt("return",{type:g.redirect,status:m,location:y,revalidate:null!==h.headers.get("X-Remix-Revalidate")});case 32:if(!u){e.next=34;break}throw{type:l||g.data,response:h};case 34:if(!(j=h.headers.get("Content-Type"))||!/\bapplication\/json\b/.test(j)){e.next=41;break}return e.next=38,h.json();case 38:A=e.sent,e.next=44;break;case 41:return e.next=43,h.text();case 43:A=e.sent;case 44:if(l!==g.error){e.next=46;break}return e.abrupt("return",{type:l,error:new te(m,h.statusText,A),headers:h.headers});case 46:return e.abrupt("return",{type:g.data,data:A,statusCode:h.status,headers:h.headers});case 47:if(l!==g.error){e.next=49;break}return e.abrupt("return",{type:l,error:h});case 49:if(!(h instanceof ee)){e.next=51;break}return e.abrupt("return",{type:g.deferred,deferredData:h});case 51:return e.abrupt("return",{type:g.data,data:h});case 52:case"end":return e.stop()}}),e,null,[[6,15,19,22]])})))).apply(this,arguments)}function ke(e,t,n,r){var i=e.createURL(De(t)).toString(),a={signal:n};if(r&&Be(r.formMethod)){var o=r.formMethod,s=r.formEncType,u=r.formData;a.method=o.toUpperCase(),a.body="application/x-www-form-urlencoded"===s?_e(u):u}return new Request(i,a)}function _e(e){var t,n=new URLSearchParams,r=Object(p.a)(e.entries());try{for(r.s();!(t=r.n()).done;){var i=Object(d.a)(t.value,2),a=i[0],o=i[1];n.append(a,o instanceof File?o.name:o)}}catch(s){r.e(s)}finally{r.f()}return n}function Se(e,t,n,r,i){var a,o={},s=null,u=!1,c={};return n.forEach((function(n,l){var h=t[l].route.id;if(O(!Re(n),"Cannot handle redirect results in processLoaderData"),Pe(n)){var d=je(e,h),f=n.error;r&&(f=Object.values(r)[0],r=void 0),null==(s=s||{})[d.route.id]&&(s[d.route.id]=f),o[h]=void 0,u||(u=!0,a=ne(n.error)?n.error.status:500),n.headers&&(c[h]=n.headers)}else Ie(n)?(i.set(h,n.deferredData),o[h]=n.deferredData.data):o[h]=n.data,null==n.statusCode||200===n.statusCode||u||(a=n.statusCode),n.headers&&(c[h]=n.headers)})),r&&(s=r,o[Object.keys(r)[0]]=void 0),{loaderData:o,errors:s,statusCode:a||200,loaderHeaders:c}}function Ee(e,t,n,r,i,a,s,u){for(var c=Se(t,n,r,i,u),l=c.loaderData,h=c.errors,d=0;d<a.length;d++){var f=a[d],p=f.key,v=f.match;O(void 0!==s&&void 0!==s[d],"Did not find corresponding fetcher result");var g=s[d];if(Pe(g)){var y=je(e.matches,v.route.id);h&&h[y.route.id]||(h=m({},h,Object(o.a)({},y.route.id,g.error))),e.fetchers.delete(p)}else if(Re(g))O(!1,"Unhandled fetcher revalidation redirect");else if(Ie(g))O(!1,"Unhandled fetcher deferred data");else{var b={state:"idle",data:g.data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0," _hasFetcherDoneAnything ":!0};e.fetchers.set(p,b)}}return{loaderData:l,errors:h}}function Ae(e,t,n,r){var i,a=m({},t),o=Object(p.a)(n);try{for(o.s();!(i=o.n()).done;){var s=i.value.route.id;if(t.hasOwnProperty(s)?void 0!==t[s]&&(a[s]=t[s]):void 0!==e[s]&&(a[s]=e[s]),r&&r.hasOwnProperty(s))break}}catch(u){o.e(u)}finally{o.f()}return a}function je(e,t){return(t?e.slice(0,e.findIndex((function(e){return e.route.id===t}))+1):Object(v.a)(e)).reverse().find((function(e){return!0===e.route.hasErrorBoundary}))||e[0]}function Te(e){var t=e.find((function(e){return e.index||!e.path||"/"===e.path}))||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:t}],route:t}}function Me(e,t){var n=void 0===t?{}:t,r=n.pathname,i=n.routeId,a=n.method,o=n.type,s="Unknown Server Error",u="Unknown @remix-run/router error";return 400===e?(s="Bad Request",a&&r&&i?u="You made a "+a+' request to "'+r+'" but did not provide a `loader` for route "'+i+'", so there is no way to handle the request.':"defer-action"===o&&(u="defer() is not supported in actions")):403===e?(s="Forbidden",u='Route "'+i+'" does not match URL "'+r+'"'):404===e?(s="Not Found",u='No route matches URL "'+r+'"'):405===e&&(s="Method Not Allowed",a&&r&&i?u="You made a "+a.toUpperCase()+' request to "'+r+'" but did not provide an `action` for route "'+i+'", so there is no way to handle the request.':a&&(u='Invalid request method "'+a.toUpperCase()+'"')),new te(e||500,s,new Error(u),!0)}function Ce(e){for(var t=e.length-1;t>=0;t--){var n=e[t];if(Re(n))return n}}function De(e){return E(m({},"string"===typeof e?A(e):e,{hash:""}))}function Ie(e){return e.type===g.deferred}function Pe(e){return e.type===g.error}function Re(e){return(e&&e.type)===g.redirect}function Le(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"object"===typeof e.headers&&"undefined"!==typeof e.body}function Ne(e){return oe.has(e)}function Be(e){return ie.has(e)}function Fe(e,t,n,r,i,a){return Ue.apply(this,arguments)}function Ue(){return(Ue=Object(a.a)(Object(i.a)().mark((function e(t,n,r,a,o,s){var u,c;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=Object(i.a)().mark((function e(u){var c,l,h,d;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=r[u],l=n[u],h=t.find((function(e){return e.route.id===l.route.id})),d=null!=h&&!be(h,l)&&void 0!==(s&&s[l.route.id]),!Ie(c)||!o&&!d){e.next=7;break}return e.next=7,ze(c,a,o).then((function(e){e&&(r[u]=e||r[u])}));case 7:case"end":return e.stop()}}),e)})),c=0;case 2:if(!(c<r.length)){e.next=7;break}return e.delegateYield(u(c),"t0",4);case 4:c++,e.next=2;break;case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ze(e,t,n){return Ve.apply(this,arguments)}function Ve(){return(Ve=Object(a.a)(Object(i.a)().mark((function e(t,n,r){return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r=!1),e.next=3,t.deferredData.resolveData(n);case 3:if(!e.sent){e.next=6;break}return e.abrupt("return");case 6:if(!r){e.next=14;break}return e.prev=7,e.abrupt("return",{type:g.data,data:t.deferredData.unwrappedData});case 11:return e.prev=11,e.t0=e.catch(7),e.abrupt("return",{type:g.error,error:e.t0});case 14:return e.abrupt("return",{type:g.data,data:t.deferredData.data});case 15:case"end":return e.stop()}}),e,null,[[7,11]])})))).apply(this,arguments)}function Ge(e){return new URLSearchParams(e).getAll("index").some((function(e){return""===e}))}function He(e,t){var n=e.route,r=e.pathname,i=e.params;return{id:n.id,pathname:r,params:i,data:t[n.id],handle:n.handle}}function We(e,t){var n="string"===typeof t?A(t).search:t.search;if(e[e.length-1].route.index&&Ge(n||""))return e[e.length-1];var r=Y(e);return r[r.length-1]}},function(e,t,n){"use strict";n.d(t,"a",(function(){return W})),n.d(t,"b",(function(){return q})),n.d(t,"c",(function(){return Y})),n.d(t,"d",(function(){return b})),n.d(t,"e",(function(){return w})),n.d(t,"f",(function(){return O})),n.d(t,"g",(function(){return _})),n.d(t,"h",(function(){return Q})),n.d(t,"i",(function(){return G})),n.d(t,"j",(function(){return E})),n.d(t,"k",(function(){return j})),n.d(t,"l",(function(){return z})),n.d(t,"m",(function(){return T})),n.d(t,"n",(function(){return U})),n.d(t,"o",(function(){return M}));var r=n(10),i=n(1),a=n(2),o=n(4),s=n(5),u=n(15),c=n(19),l=n(12);function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},h.apply(this,arguments)}var d="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},f=l.useState,p=l.useEffect,v=l.useLayoutEffect,m=l.useDebugValue;function g(e){var t=e.getSnapshot,n=e.value;try{var r=t();return!d(n,r)}catch(i){return!0}}var y=!!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement)?function(e,t,n){return t()}:function(e,t,n){var r=t(),i=f({inst:{value:r,getSnapshot:t}}),a=Object(u.a)(i,2),o=a[0].inst,s=a[1];return v((function(){o.value=r,o.getSnapshot=t,g(o)&&s({inst:o})}),[e,r,t]),p((function(){g(o)&&s({inst:o});return e((function(){g(o)&&s({inst:o})}))}),[e]),m(r),r},b=("useSyncExternalStore"in l&&function(e){e.useSyncExternalStore}(l),l.createContext(null));var w=l.createContext(null);var x=l.createContext(null);var O=l.createContext(null);var k=l.createContext(null);var _=l.createContext({outlet:null,matches:[]});var S=l.createContext(null);function E(e,t){var n=(void 0===t?{}:t).relative;A()||Object(c.j)(!1);var r=l.useContext(O),i=r.basename,a=r.navigator,o=M(e,{relative:n}),s=o.hash,u=o.pathname,h=o.search,d=u;return"/"!==i&&(d="/"===u?i:Object(c.l)([i,u])),a.createHref({pathname:d,search:h,hash:s})}function A(){return null!=l.useContext(k)}function j(){return A()||Object(c.j)(!1),l.useContext(k).location}function T(){A()||Object(c.j)(!1);var e=l.useContext(O),t=e.basename,n=e.navigator,r=l.useContext(_).matches,i=j().pathname,a=JSON.stringify(Object(c.d)(r).map((function(e){return e.pathnameBase}))),o=l.useRef(!1);return l.useEffect((function(){o.current=!0})),l.useCallback((function(e,r){if(void 0===r&&(r={}),o.current)if("number"!==typeof e){var s=Object(c.p)(e,JSON.parse(a),i,"path"===r.relative);"/"!==t&&(s.pathname="/"===s.pathname?t:Object(c.l)([t,s.pathname])),(r.replace?n.replace:n.push)(s,r.state,r)}else n.go(e)}),[t,n,a,i])}function M(e,t){var n=(void 0===t?{}:t).relative,r=l.useContext(_).matches,i=j().pathname,a=JSON.stringify(Object(c.d)(r).map((function(e){return e.pathnameBase})));return l.useMemo((function(){return Object(c.p)(e,JSON.parse(a),i,"path"===n)}),[e,a,i,n])}function C(){var e=function(){var e,t=l.useContext(S),n=B(I.UseRouteError),r=F(I.UseRouteError);if(t)return t;return null==(e=n.errors)?void 0:e[r]}(),t=Object(c.k)(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r};return l.createElement(l.Fragment,null,l.createElement("h2",null,"Unexpected Application Error!"),l.createElement("h3",{style:{fontStyle:"italic"}},t),n?l.createElement("pre",{style:i},n):null,null)}var D,I,P=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e)).state={location:e.location,error:e.error},r}return Object(a.a)(n,[{key:"componentDidCatch",value:function(e,t){console.error("React Router caught the following error during render",e,t)}},{key:"render",value:function(){return this.state.error?l.createElement(_.Provider,{value:this.props.routeContext},l.createElement(S.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{error:e}}},{key:"getDerivedStateFromProps",value:function(e,t){return t.location!==e.location?{error:e.error,location:e.location}:{error:e.error||t.error,location:t.location}}}]),n}(l.Component);function R(e){var t=e.routeContext,n=e.match,r=e.children,i=l.useContext(b);return i&&i.static&&i.staticContext&&n.route.errorElement&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),l.createElement(_.Provider,{value:t},r)}function L(e,t,n){if(void 0===t&&(t=[]),null==e){if(null==n||!n.errors)return null;e=n.matches}var r=e,i=null==n?void 0:n.errors;if(null!=i){var a=r.findIndex((function(e){return e.route.id&&(null==i?void 0:i[e.route.id])}));a>=0||Object(c.j)(!1),r=r.slice(0,Math.min(r.length,a+1))}return r.reduceRight((function(e,a,o){var s=a.route.id?null==i?void 0:i[a.route.id]:null,u=n?a.route.errorElement||l.createElement(C,null):null,c=t.concat(r.slice(0,o+1)),h=function(){return l.createElement(R,{match:a,routeContext:{outlet:e,matches:c}},s?u:void 0!==a.route.element?a.route.element:e)};return n&&(a.route.errorElement||0===o)?l.createElement(P,{location:n.location,component:u,error:s,children:h(),routeContext:{outlet:null,matches:c}}):h()}),null)}function N(e){var t=l.useContext(b);return t||Object(c.j)(!1),t}function B(e){var t=l.useContext(w);return t||Object(c.j)(!1),t}function F(e){var t=function(e){var t=l.useContext(_);return t||Object(c.j)(!1),t}(),n=t.matches[t.matches.length-1];return n.route.id||Object(c.j)(!1),n.route.id}function U(){return B(I.UseNavigation).navigation}function z(){var e=B(I.UseMatches),t=e.matches,n=e.loaderData;return l.useMemo((function(){return t.map((function(e){var t=e.pathname,r=e.params;return{id:e.route.id,pathname:t,params:r,data:n[e.route.id],handle:e.route.handle}}))}),[t,n])}!function(e){e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator"}(D||(D={})),function(e){e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator"}(I||(I={}));var V=0;function G(e){var t=N(D.UseBlocker).router,n=l.useState((function(){return String(++V)})),r=Object(u.a)(n,1)[0],i=l.useCallback((function(t){return"function"===typeof e?!!e(t):!!e}),[e]),a=t.getBlocker(r,i);return l.useEffect((function(){return function(){return t.deleteBlocker(r)}}),[t,r]),a}var H;function W(e){Object(c.j)(!1)}function q(e){var t=e.basename,n=void 0===t?"/":t,r=e.children,i=void 0===r?null:r,a=e.location,o=e.navigationType,s=void 0===o?c.b.Pop:o,u=e.navigator,h=e.static,d=void 0!==h&&h;A()&&Object(c.j)(!1);var f=n.replace(/^\/*/,"/"),p=l.useMemo((function(){return{basename:f,navigator:u,static:d}}),[f,u,d]);"string"===typeof a&&(a=Object(c.o)(a));var v=a,m=v.pathname,g=void 0===m?"/":m,y=v.search,b=void 0===y?"":y,w=v.hash,x=void 0===w?"":w,_=v.state,S=void 0===_?null:_,E=v.key,j=void 0===E?"default":E,T=l.useMemo((function(){var e=Object(c.q)(g,f);return null==e?null:{pathname:e,search:b,hash:x,state:S,key:j}}),[f,g,b,x,S,j]);return null==T?null:l.createElement(O.Provider,{value:p},l.createElement(k.Provider,{children:i,value:{location:T,navigationType:s}}))}function Y(e){var t=e.children,n=e.location,r=l.useContext(b);return function(e,t){A()||Object(c.j)(!1);var n,r=l.useContext(O).navigator,i=l.useContext(w),a=l.useContext(_).matches,o=a[a.length-1],s=o?o.params:{},u=(o&&o.pathname,o?o.pathnameBase:"/"),d=(o&&o.route,j());if(t){var f,p="string"===typeof t?Object(c.o)(t):t;"/"===u||(null==(f=p.pathname)?void 0:f.startsWith(u))||Object(c.j)(!1),n=p}else n=d;var v=n.pathname||"/",m="/"===u?v:v.slice(u.length)||"/",g=Object(c.n)(e,{pathname:m}),y=L(g&&g.map((function(e){return Object.assign({},e,{params:Object.assign({},s,e.params),pathname:Object(c.l)([u,r.encodeLocation?r.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:Object(c.l)([u,r.encodeLocation?r.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})})),a,i||void 0);return t&&y?l.createElement(k.Provider,{value:{location:h({pathname:"/",search:"",hash:"",state:null,key:"default"},n),navigationType:c.b.Pop}},y):y}(r&&!t?r.router.routes:K(t),n)}!function(e){e[e.pending=0]="pending",e[e.success=1]="success",e[e.error=2]="error"}(H||(H={}));var X=new Promise((function(){}));l.Component;function K(e,t){void 0===t&&(t=[]);var n=[];return l.Children.forEach(e,(function(e,i){if(l.isValidElement(e))if(e.type!==l.Fragment){e.type!==W&&Object(c.j)(!1),e.props.index&&e.props.children&&Object(c.j)(!1);var a=[].concat(Object(r.a)(t),[i]),o={id:e.props.id||a.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,hasErrorBoundary:null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle};e.props.children&&(o.children=K(e.props.children,a)),n.push(o)}else n.push.apply(n,K(e.props.children,t))})),n}function Q(e){return e.map((function(e){var t=h({},e);return null==t.hasErrorBoundary&&(t.hasErrorBoundary=null!=t.errorElement),t.children&&(t.children=Q(t.children)),t}))}},function(e,t,n){"use strict";n.r(t),n.d(t,"FirebaseError",(function(){return p.c})),n.d(t,"SDK_VERSION",(function(){return Q})),n.d(t,"_DEFAULT_ENTRY_NAME",(function(){return N})),n.d(t,"_addComponent",(function(){return z})),n.d(t,"_addOrOverwriteComponent",(function(){return V})),n.d(t,"_apps",(function(){return F})),n.d(t,"_clearComponents",(function(){return q})),n.d(t,"_components",(function(){return U})),n.d(t,"_getProvider",(function(){return H})),n.d(t,"_registerComponent",(function(){return G})),n.d(t,"_removeServiceInstance",(function(){return W})),n.d(t,"deleteApp",(function(){return ee})),n.d(t,"getApp",(function(){return J})),n.d(t,"getApps",(function(){return $})),n.d(t,"initializeApp",(function(){return Z})),n.d(t,"onLog",(function(){return re})),n.d(t,"registerVersion",(function(){return ne})),n.d(t,"setLogLevel",(function(){return ie}));var r,i,a=n(10),o=n(0),s=n(3),u=n(7),c=n(8),l=n(1),h=n(2),d=n(24),f=n(25),p=n(11),v=n(6),m=function(e,t){return t.some((function(t){return e instanceof t}))};var g=new WeakMap,y=new WeakMap,b=new WeakMap,w=new WeakMap,x=new WeakMap;var O={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return y.get(e);if("objectStoreNames"===t)return e.objectStoreNames||b.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return S(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function k(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(E(this),n),S(g.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return S(e.apply(E(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a=e.call.apply(e,[E(this),t].concat(r));return b.set(a,t.sort?t.sort():[t]),S(a)}}function _(e){return"function"===typeof e?k(e):(e instanceof IDBTransaction&&function(e){if(!y.has(e)){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=function(){t(),r()},a=function(){n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)}));y.set(e,t)}}(e),m(e,r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,O):e)}function S(e){if(e instanceof IDBRequest)return function(e){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("success",i),e.removeEventListener("error",a)},i=function(){t(S(e.result)),r()},a=function(){n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",a)}));return t.then((function(t){t instanceof IDBCursor&&g.set(t,e)})).catch((function(){})),x.set(t,e),t}(e);if(w.has(e))return w.get(e);var t=_(e);return t!==e&&(w.set(e,t),x.set(t,e)),t}var E=function(e){return x.get(e)};var A,j,T=["get","getKey","getAll","getAllKeys","count"],M=["put","add","delete","clear"],C=new Map;function D(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"===typeof t){if(C.get(t))return C.get(t);var n=t.replace(/FromIndex$/,""),r=t!==n,i=M.includes(n);if(n in(r?IDBIndex:IDBObjectStore).prototype&&(i||T.includes(n))){var a=function(){var e=Object(s.a)(Object(o.a)().mark((function e(t){var a,s,u,c,l,h,d=arguments;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this.transaction(t,i?"readwrite":"readonly"),u=s.store,c=d.length,l=new Array(c>1?c-1:0),h=1;h<c;h++)l[h-1]=d[h];return r&&(u=u.index(l.shift())),e.next=6,Promise.all([(a=u)[n].apply(a,l),i&&s.done]);case 6:return e.abrupt("return",e.sent[0]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return C.set(t,a),a}}}O=function(e){return Object(v.a)(Object(v.a)({},e),{},{get:function(t,n,r){return D(t,n)||e.get(t,n,r)},has:function(t,n){return!!D(t,n)||e.has(t,n)}})}(O);var I=function(){function e(t){Object(l.a)(this,e),this.container=t}return Object(h.a)(e,[{key:"getPlatformInfoString",value:function(){return this.container.getProviders().map((function(e){if(function(e){var t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){var t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null})).filter((function(e){return e})).join(" ")}}]),e}();var P="@firebase/app",R="0.9.3",L=new f.b("@firebase/app"),N="[DEFAULT]",B=(A={},Object(c.a)(A,P,"fire-core"),Object(c.a)(A,"@firebase/app-compat","fire-core-compat"),Object(c.a)(A,"@firebase/analytics","fire-analytics"),Object(c.a)(A,"@firebase/analytics-compat","fire-analytics-compat"),Object(c.a)(A,"@firebase/app-check","fire-app-check"),Object(c.a)(A,"@firebase/app-check-compat","fire-app-check-compat"),Object(c.a)(A,"@firebase/auth","fire-auth"),Object(c.a)(A,"@firebase/auth-compat","fire-auth-compat"),Object(c.a)(A,"@firebase/database","fire-rtdb"),Object(c.a)(A,"@firebase/database-compat","fire-rtdb-compat"),Object(c.a)(A,"@firebase/functions","fire-fn"),Object(c.a)(A,"@firebase/functions-compat","fire-fn-compat"),Object(c.a)(A,"@firebase/installations","fire-iid"),Object(c.a)(A,"@firebase/installations-compat","fire-iid-compat"),Object(c.a)(A,"@firebase/messaging","fire-fcm"),Object(c.a)(A,"@firebase/messaging-compat","fire-fcm-compat"),Object(c.a)(A,"@firebase/performance","fire-perf"),Object(c.a)(A,"@firebase/performance-compat","fire-perf-compat"),Object(c.a)(A,"@firebase/remote-config","fire-rc"),Object(c.a)(A,"@firebase/remote-config-compat","fire-rc-compat"),Object(c.a)(A,"@firebase/storage","fire-gcs"),Object(c.a)(A,"@firebase/storage-compat","fire-gcs-compat"),Object(c.a)(A,"@firebase/firestore","fire-fst"),Object(c.a)(A,"@firebase/firestore-compat","fire-fst-compat"),Object(c.a)(A,"fire-js","fire-js"),Object(c.a)(A,"firebase","fire-js-all"),A),F=new Map,U=new Map;function z(e,t){try{e.container.addComponent(t)}catch(n){L.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function V(e,t){e.container.addOrOverwriteComponent(t)}function G(e){var t=e.name;if(U.has(t))return L.debug("There were multiple attempts to register component ".concat(t,".")),!1;U.set(t,e);var n,r=Object(u.a)(F.values());try{for(r.s();!(n=r.n()).done;){z(n.value,e)}}catch(i){r.e(i)}finally{r.f()}return!0}function H(e,t){var n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function W(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:N;H(e,t).clearInstance(n)}function q(){U.clear()}var Y=(j={},Object(c.a)(j,"no-app","No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()"),Object(c.a)(j,"bad-app-name","Illegal App name: '{$appName}"),Object(c.a)(j,"duplicate-app","Firebase App named '{$appName}' already exists with different options or config"),Object(c.a)(j,"app-deleted","Firebase App named '{$appName}' already deleted"),Object(c.a)(j,"no-options","Need to provide options, when not being deployed to hosting via source."),Object(c.a)(j,"invalid-app-argument","firebase.{$appName}() takes either no argument or a Firebase App instance."),Object(c.a)(j,"invalid-log-argument","First argument to `onLog` must be null or a function."),Object(c.a)(j,"idb-open","Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}."),Object(c.a)(j,"idb-get","Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}."),Object(c.a)(j,"idb-set","Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}."),Object(c.a)(j,"idb-delete","Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."),j),X=new p.b("app","Firebase",Y),K=function(){function e(t,n,r){var i=this;Object(l.a)(this,e),this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new d.a("app",(function(){return i}),"PUBLIC"))}return Object(h.a)(e,[{key:"automaticDataCollectionEnabled",get:function(){return this.checkDestroyed(),this._automaticDataCollectionEnabled},set:function(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}},{key:"name",get:function(){return this.checkDestroyed(),this._name}},{key:"options",get:function(){return this.checkDestroyed(),this._options}},{key:"config",get:function(){return this.checkDestroyed(),this._config}},{key:"container",get:function(){return this._container}},{key:"isDeleted",get:function(){return this._isDeleted},set:function(e){this._isDeleted=e}},{key:"checkDestroyed",value:function(){if(this.isDeleted)throw X.create("app-deleted",{appName:this._name})}}]),e}(),Q="9.17.1";function Z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;"object"!==typeof t&&(t={name:t});var r=Object.assign({name:N,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!==typeof i||!i)throw X.create("bad-app-name",{appName:String(i)});if(n||(n=Object(p.l)()),!n)throw X.create("no-options");var a=F.get(i);if(a){if(Object(p.i)(n,a.options)&&Object(p.i)(r,a.config))return a;throw X.create("duplicate-app",{appName:i})}var o,s=new d.b(i),c=Object(u.a)(U.values());try{for(c.s();!(o=c.n()).done;){var l=o.value;s.addComponent(l)}}catch(f){c.e(f)}finally{c.f()}var h=new K(n,r,s);return F.set(i,h),h}function J(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=F.get(e);if(!t&&e===N)return Z();if(!t)throw X.create("no-app",{appName:e});return t}function $(){return Array.from(F.values())}function ee(e){return te.apply(this,arguments)}function te(){return(te=Object(s.a)(Object(o.a)().mark((function e(t){var n;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.name,!F.has(n)){e.next=6;break}return F.delete(n),e.next=5,Promise.all(t.container.getProviders().map((function(e){return e.delete()})));case 5:t.isDeleted=!0;case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e,t,n){var r,i=null!==(r=B[e])&&void 0!==r?r:e;n&&(i+="-".concat(n));var a=i.match(/\s|\//),o=t.match(/\s|\//);if(a||o){var s=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];return a&&s.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),a&&o&&s.push("and"),o&&s.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void L.warn(s.join(" "))}G(new d.a("".concat(i,"-version"),(function(){return{library:i,version:t}}),"VERSION"))}function re(e,t){if(null!==e&&"function"!==typeof e)throw X.create("invalid-log-argument");Object(f.d)(e,t)}function ie(e){Object(f.c)(e)}var ae="firebase-heartbeat-database",oe=1,se="firebase-heartbeat-store",ue=null;function ce(){return ue||(ue=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.blocked,i=n.upgrade,a=n.blocking,o=n.terminated,s=indexedDB.open(e,t),u=S(s);return i&&s.addEventListener("upgradeneeded",(function(e){i(S(s.result),e.oldVersion,e.newVersion,S(s.transaction))})),r&&s.addEventListener("blocked",(function(){return r()})),u.then((function(e){o&&e.addEventListener("close",(function(){return o()})),a&&e.addEventListener("versionchange",(function(){return a()}))})).catch((function(){})),u}(ae,oe,{upgrade:function(e,t){if(0===t)e.createObjectStore(se)}}).catch((function(e){throw X.create("idb-open",{originalErrorMessage:e.message})}))),ue}function le(e){return he.apply(this,arguments)}function he(){return(he=Object(s.a)(Object(o.a)().mark((function e(t){var n,r;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ce();case 3:return n=e.sent,e.abrupt("return",n.transaction(se).objectStore(se).get(pe(t)));case 7:e.prev=7,e.t0=e.catch(0),e.t0 instanceof p.c?L.warn(e.t0.message):(r=X.create("idb-get",{originalErrorMessage:null===e.t0||void 0===e.t0?void 0:e.t0.message}),L.warn(r.message));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function de(e,t){return fe.apply(this,arguments)}function fe(){return(fe=Object(s.a)(Object(o.a)().mark((function e(t,n){var r,i,a,s;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ce();case 3:return r=e.sent,i=r.transaction(se,"readwrite"),a=i.objectStore(se),e.next=8,a.put(n,pe(t));case 8:return e.abrupt("return",i.done);case 11:e.prev=11,e.t0=e.catch(0),e.t0 instanceof p.c?L.warn(e.t0.message):(s=X.create("idb-set",{originalErrorMessage:null===e.t0||void 0===e.t0?void 0:e.t0.message}),L.warn(s.message));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function pe(e){return"".concat(e.name,"!").concat(e.options.appId)}var ve=1024,me=function(){function e(t){var n=this;Object(l.a)(this,e),this.container=t,this._heartbeatsCache=null;var r=this.container.getProvider("app").getImmediate();this._storage=new we(r),this._heartbeatsCachePromise=this._storage.read().then((function(e){return n._heartbeatsCache=e,e}))}return Object(h.a)(e,[{key:"triggerHeartbeat",value:function(){var e=Object(s.a)(Object(o.a)().mark((function e(){var t,n,r;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.container.getProvider("platform-logger").getImmediate(),n=t.getPlatformInfoString(),r=ge(),null!==this._heartbeatsCache){e.next=7;break}return e.next=6,this._heartbeatsCachePromise;case 6:this._heartbeatsCache=e.sent;case 7:if(this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((function(e){return e.date===r}))){e.next=11;break}return e.abrupt("return");case 11:this._heartbeatsCache.heartbeats.push({date:r,agent:n});case 12:return this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((function(e){var t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),e.abrupt("return",this._storage.overwrite(this._heartbeatsCache));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHeartbeatsHeader",value:function(){var e=Object(s.a)(Object(o.a)().mark((function e(){var t,n,r,i,a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._heartbeatsCache){e.next=3;break}return e.next=3,this._heartbeatsCachePromise;case 3:if(null!==this._heartbeatsCache&&0!==this._heartbeatsCache.heartbeats.length){e.next=5;break}return e.abrupt("return","");case 5:if(t=ge(),n=ye(this._heartbeatsCache.heartbeats),r=n.heartbeatsToSend,i=n.unsentEntries,a=Object(p.e)(JSON.stringify({version:2,heartbeats:r})),this._heartbeatsCache.lastSentHeartbeatDate=t,!(i.length>0)){e.next=15;break}return this._heartbeatsCache.heartbeats=i,e.next=13,this._storage.overwrite(this._heartbeatsCache);case 13:e.next=17;break;case 15:this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache);case 17:return e.abrupt("return",a);case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function ge(){return(new Date).toISOString().substring(0,10)}function ye(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ve,r=[],i=e.slice(),a=Object(u.a)(e);try{var o=function(){var e=t.value,a=r.find((function(t){return t.agent===e.agent}));if(a){if(a.dates.push(e.date),xe(r)>n)return a.dates.pop(),"break"}else if(r.push({agent:e.agent,dates:[e.date]}),xe(r)>n)return r.pop(),"break";i=i.slice(1)};for(a.s();!(t=a.n()).done;){if("break"===o())break}}catch(s){a.e(s)}finally{a.f()}return{heartbeatsToSend:r,unsentEntries:i}}var be,we=function(){function e(t){Object(l.a)(this,e),this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}return Object(h.a)(e,[{key:"runIndexedDBEnvironmentCheck",value:function(){var e=Object(s.a)(Object(o.a)().mark((function e(){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.v)()){e.next=4;break}return e.abrupt("return",!1);case 4:return e.abrupt("return",Object(p.C)().then((function(){return!0})).catch((function(){return!1})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"read",value:function(){var e=Object(s.a)(Object(o.a)().mark((function e(){var t;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canUseIndexedDBPromise;case 2:if(e.sent){e.next=7;break}return e.abrupt("return",{heartbeats:[]});case 7:return e.next=9,le(this.app);case 9:return t=e.sent,e.abrupt("return",t||{heartbeats:[]});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"overwrite",value:function(){var e=Object(s.a)(Object(o.a)().mark((function e(t){var n,r;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canUseIndexedDBPromise;case 2:if(e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.read();case 9:return r=e.sent,e.abrupt("return",de(this.app,{lastSentHeartbeatDate:null!==(n=t.lastSentHeartbeatDate)&&void 0!==n?n:r.lastSentHeartbeatDate,heartbeats:t.heartbeats}));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=Object(s.a)(Object(o.a)().mark((function e(t){var n,r;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canUseIndexedDBPromise;case 2:if(e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.read();case 9:return r=e.sent,e.abrupt("return",de(this.app,{lastSentHeartbeatDate:null!==(n=t.lastSentHeartbeatDate)&&void 0!==n?n:r.lastSentHeartbeatDate,heartbeats:[].concat(Object(a.a)(r.heartbeats),Object(a.a)(t.heartbeats))}));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function xe(e){return Object(p.e)(JSON.stringify({version:2,heartbeats:e})).length}be="",G(new d.a("platform-logger",(function(e){return new I(e)}),"PRIVATE")),G(new d.a("heartbeat",(function(e){return new me(e)}),"PRIVATE")),ne(P,R,be),ne(P,R,"esm2017"),ne("fire-js","")},function(e,t,n){"use strict";function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(30),i=n(41);function a(e,t,n){return a=Object(i.a)()?Reflect.construct.bind():function(e,t,n){var i=[null];i.push.apply(i,t);var a=new(Function.bind.apply(e,i));return n&&Object(r.a)(a,n.prototype),a},a.apply(null,arguments)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return p}));var r=n(0),i=n(10),a=n(3),o=n(15),s=n(7),u=n(1),c=n(2),l=n(11),h=function(){function e(t,n,r){Object(u.a)(this,e),this.name=t,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return Object(c.a)(e,[{key:"setInstantiationMode",value:function(e){return this.instantiationMode=e,this}},{key:"setMultipleInstances",value:function(e){return this.multipleInstances=e,this}},{key:"setServiceProps",value:function(e){return this.serviceProps=e,this}},{key:"setInstanceCreatedCallback",value:function(e){return this.onInstanceCreated=e,this}}]),e}(),d="[DEFAULT]",f=function(){function e(t,n){Object(u.a)(this,e),this.name=t,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return Object(c.a)(e,[{key:"get",value:function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new l.a;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch(i){}}return this.instancesDeferred.get(t).promise}},{key:"getImmediate",value:function(e){var t,n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}},{key:"getComponent",value:function(){return this.component}},{key:"setComponent",value:function(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:d})}catch(l){}var t,n=Object(s.a)(this.instancesDeferred.entries());try{for(n.s();!(t=n.n()).done;){var r=Object(o.a)(t.value,2),i=r[0],a=r[1],u=this.normalizeInstanceIdentifier(i);try{var c=this.getOrInitializeService({instanceIdentifier:u});a.resolve(c)}catch(l){}}}catch(h){n.e(h)}finally{n.f()}}}},{key:"clearInstance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}},{key:"delete",value:function(){var e=Object(a.a)(Object(r.a)().mark((function e(){var t;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Array.from(this.instances.values()),e.next=3,Promise.all([].concat(Object(i.a)(t.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()}))),Object(i.a)(t.filter((function(e){return"_delete"in e})).map((function(e){return e._delete()})))));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isComponentSet",value:function(){return null!=this.component}},{key:"isInitialized",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;return this.instances.has(e)}},{key:"getOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;return this.instancesOptions.get(e)||{}}},{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.options,n=void 0===t?{}:t,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error("".concat(this.name,"(").concat(r,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));var i,a=this.getOrInitializeService({instanceIdentifier:r,options:n}),u=Object(s.a)(this.instancesDeferred.entries());try{for(u.s();!(i=u.n()).done;){var c=Object(o.a)(i.value,2),l=c[0],h=c[1];r===this.normalizeInstanceIdentifier(l)&&h.resolve(a)}}catch(d){u.e(d)}finally{u.f()}return a}},{key:"onInit",value:function(e,t){var n,r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);var a=this.instances.get(r);return a&&e(a,r),function(){i.delete(e)}}},{key:"invokeOnInitCallbacks",value:function(e,t){var n=this.onInitCallbacks.get(t);if(n){var r,i=Object(s.a)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;try{a(e,t)}catch(o){}}}catch(u){i.e(u)}finally{i.f()}}}},{key:"getOrInitializeService",value:function(e){var t,n=e.instanceIdentifier,r=e.options,i=void 0===r?{}:r,a=this.instances.get(n);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:(t=n,t===d?void 0:t),options:i}),this.instances.set(n,a),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(a,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,a)}catch(o){}return a||null}},{key:"normalizeInstanceIdentifier",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;return this.component?this.component.multipleInstances?e:d:e}},{key:"shouldAutoInitialize",value:function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}]),e}();var p=function(){function e(t){Object(u.a)(this,e),this.name=t,this.providers=new Map}return Object(c.a)(e,[{key:"addComponent",value:function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}},{key:"addOrOverwriteComponent",value:function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}},{key:"getProvider",value:function(e){if(this.providers.has(e))return this.providers.get(e);var t=new f(e,this);return this.providers.set(e,t),t}},{key:"getProviders",value:function(){return Array.from(this.providers.values())}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return v})),n.d(t,"d",(function(){return m}));var r,i,a=n(7),o=n(1),s=n(2),u=n(8),c=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));var l={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},h=i.INFO,d=(r={},Object(u.a)(r,i.DEBUG,"log"),Object(u.a)(r,i.VERBOSE,"log"),Object(u.a)(r,i.INFO,"info"),Object(u.a)(r,i.WARN,"warn"),Object(u.a)(r,i.ERROR,"error"),r),f=function(e,t){if(!(t<e.logLevel)){var n=(new Date).toISOString(),r=d[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i,a=arguments.length,o=new Array(a>2?a-2:0),s=2;s<a;s++)o[s-2]=arguments[s];(i=console)[r].apply(i,["[".concat(n,"]  ").concat(e.name,":")].concat(o))}},p=function(){function e(t){Object(o.a)(this,e),this.name=t,this._logLevel=h,this._logHandler=f,this._userLogHandler=null,c.push(this)}return Object(s.a)(e,[{key:"logLevel",get:function(){return this._logLevel},set:function(e){if(!(e in i))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}},{key:"setLogLevel",value:function(e){this._logLevel="string"===typeof e?l[e]:e}},{key:"logHandler",get:function(){return this._logHandler},set:function(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}},{key:"userLogHandler",get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.DEBUG].concat(t)),this._logHandler.apply(this,[this,i.DEBUG].concat(t))}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.VERBOSE].concat(t)),this._logHandler.apply(this,[this,i.VERBOSE].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.INFO].concat(t)),this._logHandler.apply(this,[this,i.INFO].concat(t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.WARN].concat(t)),this._logHandler.apply(this,[this,i.WARN].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.ERROR].concat(t)),this._logHandler.apply(this,[this,i.ERROR].concat(t))}}]),e}();function v(e){c.forEach((function(t){t.setLogLevel(e)}))}function m(e,t){var n,r=Object(a.a)(c);try{var o=function(){var r=n.value,a=null;t&&t.level&&(a=l[t.level]),r.userLogHandler=null===e?null:function(t,n){for(var r=arguments.length,o=new Array(r>2?r-2:0),s=2;s<r;s++)o[s-2]=arguments[s];var u=o.map((function(e){if(null==e)return null;if("string"===typeof e)return e;if("number"===typeof e||"boolean"===typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(t){return null}})).filter((function(e){return e})).join(" ");n>=(null!==a&&void 0!==a?a:t.logLevel)&&e({level:i[n].toLowerCase(),message:u,args:o,type:t.name})}};for(r.s();!(n=r.n()).done;)o()}catch(s){r.e(s)}finally{r.f()}}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return cr})),n.d(t,"b",(function(){return hr})),n.d(t,"c",(function(){return lr})),n.d(t,"d",(function(){return fr})),n.d(t,"e",(function(){return dr})),n.d(t,"f",(function(){return pr})),n.d(t,"g",(function(){return vr})),n.d(t,"h",(function(){return sr})),n.d(t,"i",(function(){return ur}));var r,i=n(15),a=n(7),o=n(14),s=n(13),u=n(4),c=n(5),l=n(1),h=n(2),d="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof e?e:"undefined"!==typeof self?self:{},f={},p=p||{},v=d||self;function m(){}function g(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function y(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var b="closure_uid_"+(1e9*Math.random()>>>0),w=0;function x(e,t,n){return e.call.apply(e.bind,arguments)}function O(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function k(e,t,n){return(k=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?x:O).apply(null,arguments)}function _(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function S(e,t){function n(){}n.prototype=t.prototype,e.X=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Wb=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}function E(){this.s=this.s,this.o=this.o}E.prototype.s=!1,E.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,b)&&e[b]||(e[b]=++w))},E.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var A=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"===typeof e)return"string"!==typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function j(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function T(e,t){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(g(r)){var i=e.length||0,a=r.length||0;e.length=i+a;for(var o=0;o<a;o++)e[i+o]=r[o]}else e.push(r)}}function M(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}M.prototype.h=function(){this.defaultPrevented=!0};var C=function(){if(!v.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{v.addEventListener("test",m,t),v.removeEventListener("test",m,t)}catch(n){}return e}();function D(e){return/^[\s\xa0]*$/.test(e)}var I=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function P(e,t){return e<t?-1:e>t?1:0}function R(){var e=v.navigator;return e&&(e=e.userAgent)?e:""}function L(e){return-1!=R().indexOf(e)}function N(e){return N[" "](e),e}N[" "]=m;var B,F=L("Opera"),U=L("Trident")||L("MSIE"),z=L("Edge"),V=z||U,G=L("Gecko")&&!(-1!=R().toLowerCase().indexOf("webkit")&&!L("Edge"))&&!(L("Trident")||L("MSIE"))&&!L("Edge"),H=-1!=R().toLowerCase().indexOf("webkit")&&!L("Edge");function W(){var e=v.document;return e?e.documentMode:void 0}e:{var q="",Y=function(){var e=R();return G?/rv:([^\);]+)(\)|;)/.exec(e):z?/Edge\/([\d\.]+)/.exec(e):U?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):H?/WebKit\/(\S+)/.exec(e):F?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(Y&&(q=Y?Y[1]:""),U){var X=W();if(null!=X&&X>parseFloat(q)){B=String(X);break e}}B=q}var K,Q={};function Z(){return function(e){var t=Q;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}((function(){for(var e=0,t=I(String(B)).split("."),n=I("9").split("."),r=Math.max(t.length,n.length),i=0;0==e&&i<r;i++){var a=t[i]||"",o=n[i]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],0==a[0].length&&0==o[0].length)break;e=P(0==a[1].length?0:parseInt(a[1],10),0==o[1].length?0:parseInt(o[1],10))||P(0==a[2].length,0==o[2].length)||P(a[2],o[2]),a=a[3],o=o[3]}while(0==e)}return 0<=e}))}if(v.document&&U){var J=W();K=J||(parseInt(B,10)||void 0)}else K=void 0;var $=K;function ee(e,t){if(M.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(G){e:{try{N(t.nodeName);var i=!0;break e}catch(a){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:te[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&ee.X.h.call(this)}}S(ee,M);var te={2:"touch",3:"pen",4:"mouse"};ee.prototype.h=function(){ee.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var ne="closure_listenable_"+(1e6*Math.random()|0),re=0;function ie(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++re,this.ba=this.ea=!1}function ae(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function oe(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function se(e){var t={};for(var n in e)t[n]=e[n];return t}var ue="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ce(e,t){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])e[n]=r[n];for(var a=0;a<ue.length;a++)n=ue[a],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function le(e){this.src=e,this.g={},this.h=0}function he(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],a=A(i,t);(r=0<=a)&&Array.prototype.splice.call(i,a,1),r&&(ae(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function de(e,t,n,r){for(var i=0;i<e.length;++i){var a=e[i];if(!a.ba&&a.listener==t&&a.capture==!!n&&a.ha==r)return i}return-1}le.prototype.add=function(e,t,n,r,i){var a=e.toString();(e=this.g[a])||(e=this.g[a]=[],this.h++);var o=de(e,t,r,i);return-1<o?(t=e[o],n||(t.ea=!1)):((t=new ie(t,this.src,a,!!r,i)).ea=n,e.push(t)),t};var fe="closure_lm_"+(1e6*Math.random()|0),pe={};function ve(e,t,n,r,i){if(r&&r.once)return ge(e,t,n,r,i);if(Array.isArray(t)){for(var a=0;a<t.length;a++)ve(e,t[a],n,r,i);return null}return n=_e(n),e&&e[ne]?e.N(t,n,y(r)?!!r.capture:!!r,i):me(e,t,n,!1,r,i)}function me(e,t,n,r,i,a){if(!t)throw Error("Invalid event type");var o=y(i)?!!i.capture:!!i,s=Oe(e);if(s||(e[fe]=s=new le(e)),(n=s.add(t,n,r,o,a)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}var t=xe;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)C||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(we(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function ge(e,t,n,r,i){if(Array.isArray(t)){for(var a=0;a<t.length;a++)ge(e,t[a],n,r,i);return null}return n=_e(n),e&&e[ne]?e.O(t,n,y(r)?!!r.capture:!!r,i):me(e,t,n,!0,r,i)}function ye(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)ye(e,t[a],n,r,i);else r=y(r)?!!r.capture:!!r,n=_e(n),e&&e[ne]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=de(a=e.g[t],n,r,i))&&(ae(a[n]),Array.prototype.splice.call(a,n,1),0==a.length&&(delete e.g[t],e.h--)))):e&&(e=Oe(e))&&(t=e.g[t.toString()],e=-1,t&&(e=de(t,n,r,i)),(n=-1<e?t[e]:null)&&be(n))}function be(e){if("number"!==typeof e&&e&&!e.ba){var t=e.src;if(t&&t[ne])he(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(we(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Oe(t))?(he(n,e),0==n.h&&(n.src=null,t[fe]=null)):ae(e)}}}function we(e){return e in pe?pe[e]:pe[e]="on"+e}function xe(e,t){if(e.ba)e=!0;else{t=new ee(t,this);var n=e.listener,r=e.ha||e.src;e.ea&&be(e),e=n.call(r,t)}return e}function Oe(e){return(e=e[fe])instanceof le?e:null}var ke="__closure_events_fn_"+(1e9*Math.random()>>>0);function _e(e){return"function"===typeof e?e:(e[ke]||(e[ke]=function(t){return e.handleEvent(t)}),e[ke])}function Se(){E.call(this),this.i=new le(this),this.P=this,this.I=null}function Ee(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"===typeof t)t=new M(t,e);else if(t instanceof M)t.target=t.target||e;else{var i=t;ce(t=new M(r,e),i)}if(i=!0,n)for(var a=n.length-1;0<=a;a--){var o=t.g=n[a];i=Ae(o,r,!0,t)&&i}if(i=Ae(o=t.g=e,r,!0,t)&&i,i=Ae(o,r,!1,t)&&i,n)for(a=0;a<n.length;a++)i=Ae(o=t.g=n[a],r,!1,t)&&i}function Ae(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,a=0;a<t.length;++a){var o=t[a];if(o&&!o.ba&&o.capture==n){var s=o.listener,u=o.ha||o.src;o.ea&&he(e.i,o),i=!1!==s.call(u,r)&&i}}return i&&!r.defaultPrevented}S(Se,E),Se.prototype[ne]=!0,Se.prototype.removeEventListener=function(e,t,n,r){ye(this,e,t,n,r)},Se.prototype.M=function(){if(Se.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)ae(n[r]);delete t.g[e],t.h--}}this.I=null},Se.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Se.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var je=v.JSON.stringify;function Te(){var e=Ne,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Me,Ce=function(){function e(){Object(l.a)(this,e),this.h=this.g=null}return Object(h.a)(e,[{key:"add",value:function(e,t){var n=De.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}]),e}(),De=new(function(){function e(t,n){Object(l.a)(this,e),this.i=t,this.j=n,this.h=0,this.g=null}return Object(h.a)(e,[{key:"get",value:function(){var e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}]),e}())((function(){return new Ie}),(function(e){return e.reset()})),Ie=function(){function e(){Object(l.a)(this,e),this.next=this.g=this.h=null}return Object(h.a)(e,[{key:"set",value:function(e,t){this.h=e,this.g=t,this.next=null}},{key:"reset",value:function(){this.next=this.g=this.h=null}}]),e}();function Pe(e){v.setTimeout((function(){throw e}),0)}function Re(e,t){Me||function(){var e=v.Promise.resolve(void 0);Me=function(){e.then(Be)}}(),Le||(Me(),Le=!0),Ne.add(e,t)}var Le=!1,Ne=new Ce;function Be(){for(var e;e=Te();){try{e.h.call(e.g)}catch(n){Pe(n)}var t=De;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Le=!1}function Fe(e,t){Se.call(this),this.h=e||1,this.g=t||v,this.j=k(this.lb,this),this.l=Date.now()}function Ue(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function ze(e,t,n){if("function"===typeof e)n&&(e=k(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=k(e.handleEvent,e)}return 2147483647<Number(t)?-1:v.setTimeout(e,t||0)}function Ve(e){e.g=ze((function(){e.g=null,e.i&&(e.i=!1,Ve(e))}),e.j);var t=e.h;e.h=null,e.m.apply(null,t)}S(Fe,Se),(r=Fe.prototype).ca=!1,r.R=null,r.lb=function(){if(this.ca){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Ee(this,"tick"),this.ca&&(Ue(this),this.start()))}},r.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){Fe.X.M.call(this),Ue(this),delete this.g};var Ge=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(e,r){var i;return Object(l.a)(this,n),(i=t.call(this)).m=e,i.j=r,i.h=null,i.i=!1,i.g=null,i}return Object(h.a)(n,[{key:"l",value:function(e){this.h=arguments,this.g?this.i=!0:Ve(this)}},{key:"M",value:function(){Object(o.a)(Object(s.a)(n.prototype),"M",this).call(this),this.g&&(v.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}]),n}(E);function He(e){E.call(this),this.h=e,this.g={}}S(He,E);var We=[];function qe(e,t,n,r){Array.isArray(n)||(n&&(We[0]=n.toString()),n=We);for(var i=0;i<n.length;i++){var a=ve(t,n[i],r||e.handleEvent,!1,e.h||e);if(!a)break;e.g[a.key]=a}}function Ye(e){oe(e.g,(function(e,t){this.g.hasOwnProperty(t)&&be(e)}),e),e.g={}}function Xe(){this.g=!0}function Ke(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var a=i[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var o=1;o<i.length;o++)i[o]=""}}}return je(n)}catch(s){return t}}(e,n)+(r?" "+r:"")}))}He.prototype.M=function(){He.X.M.call(this),Ye(this)},He.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Xe.prototype.Aa=function(){this.g=!1},Xe.prototype.info=function(){};var Qe={},Ze=null;function Je(){return Ze=Ze||new Se}function $e(e){M.call(this,Qe.Pa,e)}function et(e){var t=Je();Ee(t,new $e(t))}function tt(e,t){M.call(this,Qe.STAT_EVENT,e),this.stat=t}function nt(e){var t=Je();Ee(t,new tt(t,e))}function rt(e,t){M.call(this,Qe.Qa,e),this.size=t}function it(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return v.setTimeout((function(){e()}),t)}Qe.Pa="serverreachability",S($e,M),Qe.STAT_EVENT="statevent",S(tt,M),Qe.Qa="timingevent",S(rt,M);var at={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},ot={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function st(){}function ut(e){return e.h||(e.h=e.i())}function ct(){}st.prototype.h=null;var lt,ht={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function dt(){M.call(this,"d")}function ft(){M.call(this,"c")}function pt(){}function vt(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new He(this),this.O=gt,e=V?125:void 0,this.T=new Fe(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new mt}function mt(){this.i=null,this.g="",this.h=!1}S(dt,M),S(ft,M),S(pt,st),pt.prototype.g=function(){return new XMLHttpRequest},pt.prototype.i=function(){return{}},lt=new pt;var gt=45e3,yt={},bt={};function wt(e,t,n){e.K=1,e.v=Ft(Pt(t)),e.s=n,e.P=!0,xt(e,null)}function xt(e,t){e.F=Date.now(),St(e),e.A=Pt(e.v);var n=e.A,r=e.U;Array.isArray(r)||(r=[String(r)]),Jt(n.i,"t",r),e.C=0,n=e.l.H,e.h=new mt,e.g=er(e.l,n?t:null,!e.s),0<e.N&&(e.L=new Ge(k(e.La,e,e.g),e.N)),qe(e.S,e.g,"readystatechange",e.ib),t=e.H?se(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),et(),function(e,t,n,r,i,a){e.info((function(){if(e.g)if(a)for(var o="",s=a.split("&"),u=0;u<s.length;u++){var c=s[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=a;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.U,e.s)}function Ot(e){return!!e.g&&("GET"==e.u&&2!=e.K&&e.l.Da)}function kt(e,t,n){for(var r,i=!0;!e.I&&e.C<n.length;){if((r=_t(e,n))==bt){4==t&&(e.o=4,nt(14),i=!1),Ke(e.j,e.m,null,"[Incomplete Response]");break}if(r==yt){e.o=4,nt(15),Ke(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}Ke(e.j,e.m,r,null),Mt(e,r)}Ot(e)&&r!=bt&&r!=yt&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,nt(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),qn(t),t.K=!0,nt(11))):(Ke(e.j,e.m,n,"[Invalid Chunked Response]"),Tt(e),jt(e))}function _t(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?bt:(n=Number(t.substring(n,r)),isNaN(n)?yt:(r+=1)+n>t.length?bt:(t=t.substr(r,n),e.C=r+n,t))}function St(e){e.V=Date.now()+e.O,Et(e,e.O)}function Et(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=it(k(e.gb,e),t)}function At(e){e.B&&(v.clearTimeout(e.B),e.B=null)}function jt(e){0==e.l.G||e.I||Kn(e.l,e)}function Tt(e){At(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Ue(e.T),Ye(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Mt(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||sn(n.h,e)))if(!e.J&&sn(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(a){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Xn(n),Bn(n)}Wn(n),nt(18)}}else n.Ba=i[1],0<n.Ba-n.T&&37500>i[2]&&n.L&&0==n.A&&!n.v&&(n.v=it(k(n.cb,n),6e3));if(1>=on(n.h)&&n.ja){try{n.ja()}catch(a){}n.ja=void 0}}else Zn(n,11)}else if((e.J||n.g==e)&&Xn(n),!D(t))for(i=n.Fa.g.parse(t),t=0;t<i.length;t++){var a=i[t];if(n.T=a[0],a=a[1],2==n.G)if("c"==a[0]){n.I=a[1],n.ka=a[2];var o=a[3];null!=o&&(n.ma=o,n.j.info("VER="+n.ma));var s=a[4];null!=s&&(n.Ca=s,n.j.info("SVER="+n.Ca));var u=a[5];null!=u&&"number"===typeof u&&0<u&&(r=1.5*u,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=e.g;if(c){var l=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(l){var h=r.h;h.g||-1==l.indexOf("spdy")&&-1==l.indexOf("quic")&&-1==l.indexOf("h2")||(h.j=h.l,h.g=new Set,h.h&&(un(h,h.h),h.h=null))}if(r.D){var d=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;d&&(r.za=d,Bt(r.F,r.D,d))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms"));var f=e;if((r=n).sa=$n(r,r.H?r.ka:null,r.V),f.J){cn(r.h,f);var p=f,v=r.J;v&&p.setTimeout(v),p.B&&(At(p),St(p)),r.g=f}else Hn(r);0<n.i.length&&Un(n)}else"stop"!=a[0]&&"close"!=a[0]||Zn(n,7);else 3==n.G&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?Zn(n,7):Nn(n):"noop"!=a[0]&&n.l&&n.l.wa(a),n.A=0)}et()}catch(a){}}function Ct(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(g(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(g(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(var r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(g(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,a=0;a<i;a++)t.call(void 0,r[a],n&&n[a],e)}(r=vt.prototype).setTimeout=function(e){this.O=e},r.ib=function(e){e=e.target;var t=this.L;t&&3==Cn(e)?t.l():this.La(e)},r.La=function(e){try{if(e==this.g)e:{var t=Cn(this.g),n=this.g.Ea();this.g.aa();if(!(3>t)&&(3!=t||V||this.g&&(this.h.h||this.g.fa()||Dn(this.g)))){this.I||4!=t||7==n||et(),At(this);var r=this.g.aa();this.Y=r;t:if(Ot(this)){var i=Dn(this.g);e="";var a=i.length,o=4==Cn(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Tt(this),jt(this);var s="";break t}this.h.i=new v.TextDecoder}for(n=0;n<a;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:o&&n==a-1});i.splice(0,a),this.h.g+=e,this.C=0,s=this.h.g}else s=this.g.fa();if(this.i=200==r,function(e,t,n,r,i,a,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+a+" "+o}))}(this.j,this.u,this.A,this.m,this.U,t,r),this.i){if(this.Z&&!this.J){t:{if(this.g){var u,c=this.g;if((u=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(u)){var l=u;break t}}l=null}if(!(r=l)){this.i=!1,this.o=3,nt(12),Tt(this),jt(this);break e}Ke(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Mt(this,r)}this.P?(kt(this,t,s),V&&this.i&&3==t&&(qe(this.S,this.T,"tick",this.hb),this.T.start())):(Ke(this.j,this.m,s,null),Mt(this,s)),4==t&&Tt(this),this.i&&!this.I&&(4==t?Kn(this.l,this):(this.i=!1,St(this)))}else 400==r&&0<s.indexOf("Unknown SID")?(this.o=3,nt(12)):(this.o=0,nt(13)),Tt(this),jt(this)}}}catch(t){}},r.hb=function(){if(this.g){var e=Cn(this.g),t=this.g.fa();this.C<t.length&&(At(this),kt(this,e,t),this.i&&4!=e&&St(this))}},r.cancel=function(){this.I=!0,Tt(this)},r.gb=function(){this.B=null;var e=Date.now();0<=e-this.V?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(et(),nt(17)),Tt(this),this.o=2,jt(this)):Et(this,this.V-e)};var Dt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function It(e,t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof It){this.h=void 0!==t?t:e.h,Rt(this,e.j),this.s=e.s,this.g=e.g,Lt(this,e.m),this.l=e.l,t=e.i;var n=new Xt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Nt(this,n),this.o=e.o}else e&&(n=String(e).match(Dt))?(this.h=!!t,Rt(this,n[1]||"",!0),this.s=Ut(n[2]||""),this.g=Ut(n[3]||"",!0),Lt(this,n[4]),this.l=Ut(n[5]||"",!0),Nt(this,n[6]||"",!0),this.o=Ut(n[7]||"")):(this.h=!!t,this.i=new Xt(null,this.h))}function Pt(e){return new It(e)}function Rt(e,t,n){e.j=n?Ut(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Lt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Nt(e,t,n){t instanceof Xt?(e.i=t,function(e,t){t&&!e.j&&(Kt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Qt(this,t),Jt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=zt(t,qt)),e.i=new Xt(t,e.h))}function Bt(e,t,n){e.i.set(t,n)}function Ft(e){return Bt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Ut(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function zt(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,Vt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Vt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}It.prototype.toString=function(){var e=[],t=this.j;t&&e.push(zt(t,Gt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(zt(t,Gt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(zt(n,"/"==n.charAt(0)?Wt:Ht,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",zt(n,Yt)),e.join("")};var Gt=/[#\/\?@]/g,Ht=/[#\?:]/g,Wt=/[#\?]/g,qt=/[#\?@]/g,Yt=/#/g;function Xt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Kt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var a=e[n].substring(0,r);i=e[n].substring(r+1)}else a=e[n];t(a,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Qt(e,t){Kt(e),t=$t(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Zt(e,t){return Kt(e),t=$t(e,t),e.g.has(t)}function Jt(e,t,n){Qt(e,t),0<n.length&&(e.i=null,e.g.set($t(e,t),j(n)),e.h+=n.length)}function $t(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(r=Xt.prototype).add=function(e,t){Kt(this),this.i=null,e=$t(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},r.forEach=function(e,t){Kt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},r.oa=function(){Kt(this);for(var e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[],r=0;r<t.length;r++)for(var i=e[r],a=0;a<i.length;a++)n.push(t[r]);return n},r.W=function(e){Kt(this);var t=[];if("string"===typeof e)Zt(this,e)&&(t=t.concat(this.g.get($t(this,e))));else{e=Array.from(this.g.values());for(var n=0;n<e.length;n++)t=t.concat(e[n])}return t},r.set=function(e,t){return Kt(this),this.i=null,Zt(this,e=$t(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},r.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=Array.from(this.g.keys()),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r)),a=this.W(r);for(r=0;r<a.length;r++){var o=i;""!==a[r]&&(o+="="+encodeURIComponent(String(a[r]))),e.push(o)}}return this.i=e.join("&")};var en=Object(h.a)((function e(t,n){Object(l.a)(this,e),this.h=t,this.g=n}));function tn(e){this.l=e||rn,v.PerformanceNavigationTiming?e=0<(e=v.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(v.g&&v.g.Ga&&v.g.Ga()&&v.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var nn,rn=10;function an(e){return!!e.h||!!e.g&&e.g.size>=e.j}function on(e){return e.h?1:e.g?e.g.size:0}function sn(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function un(e,t){e.g?e.g.add(t):e.h=t}function cn(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function ln(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){var t,n=e.i,r=Object(a.a)(e.g.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;n=n.concat(i.D)}}catch(o){r.e(o)}finally{r.f()}return n}return j(e.i)}function hn(){}function dn(){this.g=new hn}function fn(e,t,n){var r=n||"";try{Ct(e,(function(e,n){var i=e;y(e)&&(i=je(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function pn(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(a){}}function vn(e){this.l=e.ac||null,this.j=e.jb||!1}function mn(e,t){Se.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=gn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}tn.prototype.cancel=function(){if(this.i=ln(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){var e,t=Object(a.a)(this.g.values());try{for(t.s();!(e=t.n()).done;){e.value.cancel()}}catch(n){t.e(n)}finally{t.f()}this.g.clear()}},hn.prototype.stringify=function(e){return v.JSON.stringify(e,void 0)},hn.prototype.parse=function(e){return v.JSON.parse(e,void 0)},S(vn,st),vn.prototype.g=function(){return new mn(this.l,this.j)},vn.prototype.i=(nn={},function(){return nn}),S(mn,Se);var gn=0;function yn(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function bn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,wn(e)}function wn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(r=mn.prototype).open=function(e,t){if(this.readyState!=gn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,wn(this)},r.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||v).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((function(){})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,bn(this)),this.readyState=gn},r.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,wn(this)),this.g&&(this.readyState=3,wn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if("undefined"!==typeof v.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;yn(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))},r.Ta=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?bn(this):wn(this),3==this.readyState&&yn(this)}},r.Va=function(e){this.g&&(this.response=this.responseText=e,bn(this))},r.Ua=function(e){this.g&&(this.response=e,bn(this))},r.ga=function(){this.g&&bn(this)},r.setRequestHeader=function(e,t){this.v.append(e,t)},r.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(mn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var xn=v.JSON.parse;function On(e){Se.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=kn,this.K=this.L=!1}S(On,Se);var kn="",_n=/^https?$/i,Sn=["POST","PUT"];function En(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,An(e),Tn(e)}function An(e){e.D||(e.D=!0,Ee(e,"complete"),Ee(e,"error"))}function jn(e){if(e.h&&"undefined"!=typeof p&&(!e.C[1]||4!=Cn(e)||2!=e.aa()))if(e.v&&4==Cn(e))ze(e.Ha,0,e);else if(Ee(e,"readystatechange"),4==Cn(e)){e.h=!1;try{var t,n=e.aa();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break e;default:r=!1}if(!(t=r)){var i;if(i=0===n){var a=String(e.H).match(Dt)[1]||null;if(!a&&v.self&&v.self.location){var o=v.self.location.protocol;a=o.substr(0,o.length-1)}i=!_n.test(a?a.toLowerCase():"")}t=i}if(t)Ee(e,"complete"),Ee(e,"success");else{e.m=6;try{var s=2<Cn(e)?e.g.statusText:""}catch(u){s=""}e.j=s+" ["+e.aa()+"]",An(e)}}finally{Tn(e)}}}function Tn(e,t){if(e.g){Mn(e);var n=e.g,r=e.C[0]?m:null;e.g=null,e.C=null,t||Ee(e,"ready");try{n.onreadystatechange=r}catch(i){}}}function Mn(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(v.clearTimeout(e.A),e.A=null)}function Cn(e){return e.g?e.g.readyState:0}function Dn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case kn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function In(e){var t="";return oe(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Pn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=In(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):Bt(e,t,n))}function Rn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Ln(e){this.Ca=0,this.i=[],this.j=new Xe,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Rn("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Rn("baseRetryDelayMs",5e3,e),this.bb=Rn("retryDelaySeedMs",1e4,e),this.$a=Rn("forwardChannelMaxRetries",2,e),this.ta=Rn("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new tn(e&&e.concurrentRequestLimit),this.Fa=new dn,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Nn(e){if(Fn(e),3==e.G){var t=e.U++,n=Pt(e.F);Bt(n,"SID",e.I),Bt(n,"RID",t),Bt(n,"TYPE","terminate"),Vn(e,n),(t=new vt(e,e.j,t,void 0)).K=2,t.v=Ft(Pt(n)),n=!1,v.navigator&&v.navigator.sendBeacon&&(n=v.navigator.sendBeacon(t.v.toString(),"")),!n&&v.Image&&((new Image).src=t.v,n=!0),n||(t.g=er(t.l,null),t.g.da(t.v)),t.F=Date.now(),St(t)}Jn(e)}function Bn(e){e.g&&(qn(e),e.g.cancel(),e.g=null)}function Fn(e){Bn(e),e.u&&(v.clearTimeout(e.u),e.u=null),Xn(e),e.h.cancel(),e.m&&("number"===typeof e.m&&v.clearTimeout(e.m),e.m=null)}function Un(e){an(e.h)||e.m||(e.m=!0,Re(e.Ja,e),e.C=0)}function zn(e,t){var n;n=t?t.m:e.U++;var r=Pt(e.F);Bt(r,"SID",e.I),Bt(r,"RID",n),Bt(r,"AID",e.T),Vn(e,r),e.o&&e.s&&Pn(r,e.o,e.s),n=new vt(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=Gn(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),un(e.h,n),wt(n,r,t)}function Vn(e,t){e.ia&&oe(e.ia,(function(e,n){Bt(t,n,e)})),e.l&&Ct({},(function(e,n){Bt(t,n,e)}))}function Gn(e,t,n){n=Math.min(e.i.length,n);var r=e.l?k(e.l.Ra,e.l,e):null;e:for(var i=e.i,a=-1;;){var o=["count="+n];-1==a?0<n?(a=i[0].h,o.push("ofs="+a)):a=0:o.push("ofs="+a);for(var s=!0,u=0;u<n;u++){var c=i[u].h,l=i[u].g;if(0>(c-=a))a=Math.max(0,i[u].h-100),s=!1;else try{fn(l,o,"req"+c+"_")}catch(h){r&&r(l)}}if(s){r=o.join("&");break e}}return e=e.i.splice(0,n),t.D=e,r}function Hn(e){e.g||e.u||(e.Z=1,Re(e.Ia,e),e.A=0)}function Wn(e){return!(e.g||e.u||3<=e.A)&&(e.Z++,e.u=it(k(e.Ia,e),Qn(e,e.A)),e.A++,!0)}function qn(e){null!=e.B&&(v.clearTimeout(e.B),e.B=null)}function Yn(e){e.g=new vt(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=Pt(e.sa);Bt(t,"RID","rpc"),Bt(t,"SID",e.I),Bt(t,"CI",e.L?"0":"1"),Bt(t,"AID",e.T),Bt(t,"TYPE","xmlhttp"),Vn(e,t),e.o&&e.s&&Pn(t,e.o,e.s),e.J&&e.g.setTimeout(e.J);var n=e.g;e=e.ka,n.K=1,n.v=Ft(Pt(t)),n.s=null,n.P=!0,xt(n,e)}function Xn(e){null!=e.v&&(v.clearTimeout(e.v),e.v=null)}function Kn(e,t){var n=null;if(e.g==t){Xn(e),qn(e),e.g=null;var r=2}else{if(!sn(e.h,t))return;n=t.D,cn(e.h,t),r=1}if(0!=e.G)if(e.pa=t.Y,t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;Ee(r=Je(),new rt(r,n)),Un(e)}else Hn(e);else if(3==(i=t.o)||0==i&&0<e.pa||!(1==r&&function(e,t){return!(on(e.h)>=e.h.j-(e.m?1:0))&&(e.m?(e.i=t.D.concat(e.i),!0):!(1==e.G||2==e.G||e.C>=(e.Za?0:e.$a))&&(e.m=it(k(e.Ja,e,t),Qn(e,e.C)),e.C++,!0))}(e,t)||2==r&&Wn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:Zn(e,5);break;case 4:Zn(e,10);break;case 3:Zn(e,6);break;default:Zn(e,2)}}function Qn(e,t){var n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function Zn(e,t){if(e.j.info("Error code "+t),2==t){var n=null;e.l&&(n=null);var r=k(e.kb,e);n||(n=new It("//www.google.com/images/cleardot.gif"),v.location&&"http"==v.location.protocol||Rt(n,"https"),Ft(n)),function(e,t){var n=new Xe;if(v.Image){var r=new Image;r.onload=_(pn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=_(pn,n,r,"TestLoadImage: error",!1,t),r.onabort=_(pn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=_(pn,n,r,"TestLoadImage: timeout",!1,t),v.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else nt(2);e.G=0,e.l&&e.l.va(t),Jn(e),Fn(e)}function Jn(e){if(e.G=0,e.la=[],e.l){var t=ln(e.h);0==t.length&&0==e.i.length||(T(e.la,t),T(e.la,e.i),e.h.i.length=0,j(e.i),e.i.length=0),e.l.ua()}}function $n(e,t,n){var r=n instanceof It?Pt(n):new It(n,void 0);if(""!=r.g)t&&(r.g=t+"."+r.g),Lt(r,r.m);else{var i=v.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var a=new It(null,void 0);r&&Rt(a,r),t&&(a.g=t),i&&Lt(a,i),n&&(a.l=n),r=a}return n=e.D,t=e.za,n&&t&&Bt(r,n,t),Bt(r,"VER",e.ma),Vn(e,r),r}function er(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Da&&!e.ra?new On(new vn({jb:!0})):new On(e.ra)).Ka(e.H),t}function tr(){}function nr(){if(U&&!(10<=Number($)))throw Error("Environmental error: no available transport.")}function rr(e,t){Se.call(this),this.g=new Ln(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!D(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!D(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new or(this)}function ir(e){dt.call(this);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function ar(){ft.call(this),this.status=1}function or(e){this.g=e}(r=On.prototype).Ka=function(e){this.L=e},r.da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():lt.g(),this.C=this.u?ut(this.u):ut(lt),this.g.onreadystatechange=k(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(c){return void En(this,c)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var o in r)n.set(o,r[o]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));var s,u=Object(a.a)(r.keys());try{for(u.s();!(s=u.n()).done;){var c=s.value;n.set(c,r.get(c))}}catch(m){u.e(m)}finally{u.f()}}r=Array.from(n.keys()).find((function(e){return"content-type"==e.toLowerCase()})),o=v.FormData&&e instanceof v.FormData,!(0<=A(Sn,t))||r||o||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");var l,h=Object(a.a)(n);try{for(h.s();!(l=h.n()).done;){var d=Object(i.a)(l.value,2),f=d[0],p=d[1];this.g.setRequestHeader(f,p)}}catch(m){h.e(m)}finally{h.f()}this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Mn(this),0<this.B&&((this.K=function(e){return U&&Z()&&"number"===typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=k(this.qa,this)):this.A=ze(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(c){En(this,c)}},r.qa=function(){"undefined"!=typeof p&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ee(this,"timeout"),this.abort(8))},r.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Ee(this,"complete"),Ee(this,"abort"),Tn(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Tn(this,!0)),On.X.M.call(this)},r.Ha=function(){this.s||(this.F||this.v||this.l?jn(this):this.fb())},r.fb=function(){jn(this)},r.aa=function(){try{return 2<Cn(this)?this.g.status:-1}catch(nn){return-1}},r.fa=function(){try{return this.g?this.g.responseText:""}catch(nn){return""}},r.Sa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),xn(t)}},r.Ea=function(){return this.m},r.Oa=function(){return"string"===typeof this.j?this.j:String(this.j)},(r=Ln.prototype).ma=8,r.G=1,r.Ja=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;var t=new vt(this,this.j,e,void 0),n=this.s;if(this.S&&(n?ce(n=se(n),this.S):n=this.S),null!==this.o||this.N||(t.H=n,n=null),this.O)e:{for(var r=0,i=0;i<this.i.length;i++){var a=this.i[i];if(void 0===(a="__data__"in a.g&&"string"===typeof(a=a.g.__data__)?a.length:void 0))break;if(4096<(r+=a)){r=i;break e}if(4096===r||i===this.i.length-1){r=i+1;break e}}r=1e3}else r=1e3;r=Gn(this,t,r),Bt(i=Pt(this.F),"RID",e),Bt(i,"CVER",22),this.D&&Bt(i,"X-HTTP-Session-Id",this.D),Vn(this,i),n&&(this.N?r="headers="+encodeURIComponent(String(In(n)))+"&"+r:this.o&&Pn(i,this.o,n)),un(this.h,t),this.Ya&&Bt(i,"TYPE","init"),this.O?(Bt(i,"$req",r),Bt(i,"SID","null"),t.Z=!0,wt(t,i,null)):wt(t,i,r),this.G=2}}else 3==this.G&&(e?zn(this,e):0==this.i.length||an(this.h)||zn(this))},r.Ia=function(){if(this.u=null,Yn(this),this.$&&!(this.K||null==this.g||0>=this.P)){var e=2*this.P;this.j.info("BP detection timer enabled: "+e),this.B=it(k(this.eb,this),e)}},r.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,nt(10),Bn(this),Yn(this))},r.cb=function(){null!=this.v&&(this.v=null,Bn(this),Wn(this),nt(19))},r.kb=function(e){e?(this.j.info("Successfully pinged google.com"),nt(2)):(this.j.info("Failed to ping google.com"),nt(1))},(r=tr.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Ra=function(){},nr.prototype.g=function(e,t){return new rr(e,t)},S(rr,Se),rr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;nt(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=$n(e,null,e.V),Un(e)},rr.prototype.close=function(){Nn(this.g)},rr.prototype.u=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=je(e),e=n);t.i.push(new en(t.ab++,e)),3==t.G&&Un(t)},rr.prototype.M=function(){this.g.l=null,delete this.j,Nn(this.g),delete this.g,rr.X.M.call(this)},S(ir,dt),S(ar,ft),S(or,tr),or.prototype.xa=function(){Ee(this.g,"a")},or.prototype.wa=function(e){Ee(this.g,new ir(e))},or.prototype.va=function(e){Ee(this.g,new ar)},or.prototype.ua=function(){Ee(this.g,"b")},nr.prototype.createWebChannel=nr.prototype.g,rr.prototype.send=rr.prototype.u,rr.prototype.open=rr.prototype.m,rr.prototype.close=rr.prototype.close,at.NO_ERROR=0,at.TIMEOUT=8,at.HTTP_ERROR=6,ot.COMPLETE="complete",ct.EventType=ht,ht.OPEN="a",ht.CLOSE="b",ht.ERROR="c",ht.MESSAGE="d",Se.prototype.listen=Se.prototype.N,On.prototype.listenOnce=On.prototype.O,On.prototype.getLastError=On.prototype.Oa,On.prototype.getLastErrorCode=On.prototype.Ea,On.prototype.getStatus=On.prototype.aa,On.prototype.getResponseJson=On.prototype.Sa,On.prototype.getResponseText=On.prototype.fa,On.prototype.send=On.prototype.da,On.prototype.setWithCredentials=On.prototype.Ka;var sr=f.createWebChannelTransport=function(){return new nr},ur=f.getStatEventTarget=function(){return Je()},cr=f.ErrorCode=at,lr=f.EventType=ot,hr=f.Event=Qe,dr=f.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},fr=f.FetchXmlHttpFactory=vn,pr=f.WebChannel=ct,vr=f.XhrIo=On}).call(this,n(37))},function(e,t,n){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return w}));var r,i=n(8),a=n(1),o=n(2),s=n(11),u=n(24),c=n(21),l=n(25),h=function(){function e(t,n){var r=this;Object(a.a)(this,e),this._delegate=t,this.firebase=n,Object(c._addComponent)(t,new u.a("app-compat",(function(){return r}),"PUBLIC")),this.container=t.container}return Object(o.a)(e,[{key:"automaticDataCollectionEnabled",get:function(){return this._delegate.automaticDataCollectionEnabled},set:function(e){this._delegate.automaticDataCollectionEnabled=e}},{key:"name",get:function(){return this._delegate.name}},{key:"options",get:function(){return this._delegate.options}},{key:"delete",value:function(){var e=this;return new Promise((function(t){e._delegate.checkDestroyed(),t()})).then((function(){return e.firebase.INTERNAL.removeApp(e.name),Object(c.deleteApp)(e._delegate)}))}},{key:"_getService",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c._DEFAULT_ENTRY_NAME;this._delegate.checkDestroyed();var r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(t=r.getComponent())||void 0===t?void 0:t.instantiationMode)||r.initialize(),r.getImmediate({identifier:n})}},{key:"_removeServiceInstance",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c._DEFAULT_ENTRY_NAME;this._delegate.container.getProvider(e).clearInstance(t)}},{key:"_addComponent",value:function(e){Object(c._addComponent)(this._delegate,e)}},{key:"_addOrOverwriteComponent",value:function(e){Object(c._addOrOverwriteComponent)(this._delegate,e)}},{key:"toJSON",value:function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}]),e}(),d=(r={},Object(i.a)(r,"no-app","No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()"),Object(i.a)(r,"invalid-app-argument","firebase.{$appName}() takes either no argument or a Firebase App instance."),r),f=new s.b("app-compat","Firebase",d);var p=function e(){var t=function(e){var t={},n={__esModule:!0,initializeApp:function(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=c.initializeApp(r,i);if(Object(s.f)(t,a.name))return t[a.name];var o=new e(a,n);return t[a.name]=o,o},app:r,registerVersion:c.registerVersion,setLogLevel:c.setLogLevel,onLog:c.onLog,apps:null,SDK_VERSION:c.SDK_VERSION,INTERNAL:{registerComponent:function(t){var i=t.name,a=i.replace("-compat","");if(c._registerComponent(t)&&"PUBLIC"===t.type){var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r();if("function"!==typeof e[a])throw f.create("invalid-app-argument",{appName:i});return e[a]()};void 0!==t.serviceProps&&Object(s.j)(o,t.serviceProps),n[a]=o,e.prototype[a]=function(){for(var e=this._getService.bind(this,i),n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e.apply(this,t.multipleInstances?r:[])}}return"PUBLIC"===t.type?n[a]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:c}};function r(e){if(e=e||c._DEFAULT_ENTRY_NAME,!Object(s.f)(t,e))throw f.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map((function(e){return t[e]}))}}),r.App=e,n}(h);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){Object(s.j)(t,e)},createSubscribe:s.h,ErrorFactory:s.b,deepExtend:s.j}),t}(),v=new l.b("@firebase/app-compat"),m="@firebase/app-compat",g="0.2.3";if(Object(s.r)()&&void 0!==self.firebase){v.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var y=self.firebase.SDK_VERSION;y&&y.indexOf("LITE")>=0&&v.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var b,w=p;Object(c.registerVersion)(m,g,b)},function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return p}));n(10);var r=n(15),i=(n(7),n(12)),a=n(20),o=n(19);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s.apply(this,arguments)}function u(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}var c=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset"],l=["aria-current","caseSensitive","className","end","style","to","children"];function h(e){var t=e.basename,n=e.children,s=e.window,u=i.useRef();null==u.current&&(u.current=Object(o.e)({window:s,v5Compat:!0}));var c=u.current,l=i.useState({action:c.action,location:c.location}),h=Object(r.a)(l,2),d=h[0],f=h[1];return i.useLayoutEffect((function(){return c.listen(f)}),[c]),i.createElement(a.b,{basename:t,children:n,location:d.location,navigationType:d.action,navigator:c})}var d="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,f=i.forwardRef((function(e,t){var n,r=e.onClick,l=e.relative,h=e.reloadDocument,f=e.replace,p=e.state,v=e.target,m=e.to,g=e.preventScrollReset,y=u(e,c),b=!1;if(d&&"string"===typeof m&&/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i.test(m)){n=m;var w=new URL(window.location.href),x=m.startsWith("//")?new URL(w.protocol+m):new URL(m);x.origin===w.origin?m=x.pathname+x.search+x.hash:b=!0}var O=Object(a.j)(m,{relative:l}),k=function(e,t){var n=void 0===t?{}:t,r=n.target,s=n.replace,u=n.state,c=n.preventScrollReset,l=n.relative,h=Object(a.m)(),d=Object(a.k)(),f=Object(a.o)(e,{relative:l});return i.useCallback((function(t){if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,r)){t.preventDefault();var n=void 0!==s?s:Object(o.h)(d)===Object(o.h)(f);h(e,{replace:n,state:u,preventScrollReset:c,relative:l})}}),[d,h,f,s,u,r,e,c,l])}(m,{replace:f,state:p,target:v,preventScrollReset:g,relative:l});return i.createElement("a",s({},y,{href:n||O,onClick:b||h?r:function(e){r&&r(e),e.defaultPrevented||k(e)},ref:t,target:v}))}));var p=i.forwardRef((function(e,t){var n=e["aria-current"],r=void 0===n?"page":n,o=e.caseSensitive,c=void 0!==o&&o,h=e.className,d=void 0===h?"":h,p=e.end,v=void 0!==p&&p,m=e.style,g=e.to,y=e.children,b=u(e,l),w=Object(a.o)(g,{relative:b.relative}),x=Object(a.k)(),O=i.useContext(a.e),k=i.useContext(a.f).navigator,_=k.encodeLocation?k.encodeLocation(w).pathname:w.pathname,S=x.pathname,E=O&&O.navigation&&O.navigation.location?O.navigation.location.pathname:null;c||(S=S.toLowerCase(),E=E?E.toLowerCase():null,_=_.toLowerCase());var A,j=S===_||!v&&S.startsWith(_)&&"/"===S.charAt(_.length),T=null!=E&&(E===_||!v&&E.startsWith(_)&&"/"===E.charAt(_.length)),M=j?r:void 0;A="function"===typeof d?d({isActive:j,isPending:T}):[d,j?"active":null,T?"pending":null].filter(Boolean).join(" ");var C="function"===typeof m?m({isActive:j,isPending:T}):m;return i.createElement(f,s({},b,{"aria-current":M,className:A,ref:t,style:C,to:g}),"function"===typeof y?y({isActive:j,isPending:T}):y)}));var v,m;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmitImpl="useSubmitImpl",e.UseFetcher="useFetcher"})(v||(v={})),function(e){e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(m||(m={}))},function(e,t,n){"use strict";function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(39);function i(e,t){if(e){if("string"===typeof e)return Object(r.a)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Object(r.a)(e,t):void 0}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(13),i=n(30);var a=n(23);function o(e){var t="function"===typeof Map?new Map:void 0;return o=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,o)}function o(){return Object(a.a)(e,arguments,Object(r.a)(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),Object(i.a)(o,e)},o(e)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(42),i=n(45),a=n(31),o=n(43);function s(e){return Object(r.a)(e)||Object(i.a)(e)||Object(a.a)(e)||Object(o.a)()}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));function r(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create;Object.create},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(27),i=n(22);function a(e,t){if(t&&("object"===Object(r.a)(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Object(i.a)(e)}},function(e,t,n){"use strict";function r(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}n.d(t,"a",(function(){return r}))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}e.exports=n},function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"===typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"===typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var u,c=[],l=!1,h=-1;function d(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&f())}function f(){if(!l){var e=s(d);l=!0;for(var t=c.length;t;){for(u=c,c=[];++h<t;)u&&u[h].run();h=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function v(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||l||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r.k})),n.d(t,"b",(function(){return r.tb})),n.d(t,"c",(function(){return r.ib})),n.d(t,"d",(function(){return r.yb}));var r=n(9);n(11),n(21),n(25),n(24)},function(e,t,n){"use strict";function r(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e){if(Array.isArray(e))return e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(13);function i(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Object(r.a)(e)););return e}},function(e,t,n){"use strict";function r(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";var r,i,a=n(12),o=n.n(a),s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},u=(i=r={path:void 0,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports,function(){var e={}.hasOwnProperty;function t(){for(var n=[],r=0;r<arguments.length;r++){var i=arguments[r];if(i){var a=typeof i;if("string"===a||"number"===a)n.push(i);else if(Array.isArray(i)&&i.length){var o=t.apply(null,i);o&&n.push(o)}else if("object"===a)for(var s in i)e.call(i,s)&&i[s]&&n.push(s)}}return n.join(" ")}i.exports?(t.default=t,i.exports=t):window.classNames=t}(),r.exports);function c(e,t,n){var r,i,a,o,s;function u(){var c=Date.now()-o;c<t&&c>=0?r=setTimeout(u,t-c):(r=null,n||(s=e.apply(a,i),a=i=null))}null==t&&(t=100);var c=function(){a=this,i=arguments,o=Date.now();var c=n&&!r;return r||(r=setTimeout(u,t)),c&&(s=e.apply(a,i),a=i=null),s};return c.clear=function(){r&&(clearTimeout(r),r=null)},c.flush=function(){r&&(s=e.apply(a,i),a=i=null,clearTimeout(r),r=null)},c}c.debounce=c;var l=c;!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}(".indiana-scroll-container {\n  overflow: auto; }\n  .indiana-scroll-container--dragging {\n    scroll-behavior: auto !important; }\n    .indiana-scroll-container--dragging > * {\n      pointer-events: none;\n      cursor: -webkit-grab;\n      cursor: grab; }\n  .indiana-scroll-container--hide-scrollbars {\n    overflow: hidden;\n    overflow: -moz-scrollbars-none;\n    -ms-overflow-style: none;\n    scrollbar-width: none; }\n    .indiana-scroll-container--hide-scrollbars::-webkit-scrollbar {\n      display: none !important;\n      height: 0 !important;\n      width: 0 !important;\n      background: transparent !important;\n      -webkit-appearance: none !important; }\n  .indiana-scroll-container--native-scroll {\n    overflow: auto; }\n\n.indiana-dragging {\n  cursor: -webkit-grab;\n  cursor: grab; }\n");var h,d=(h="indiana-scroll-container",function(e,t){if(!e)return h;var n;"string"==typeof e?n=e:t=e;var r=h;return n&&(r+="__"+n),r+(t?Object.keys(t).reduce((function(e,n){var i=t[n];return i&&(e+=" "+("boolean"==typeof i?r+"--"+n:r+"--"+n+"_"+i)),e}),""):"")}),f=function(e){function t(t){var n=e.call(this,t)||this;return n.onEndScroll=function(){n.scrolling=!1,!n.pressed&&n.started&&n.processEnd()},n.onScroll=function(e){var t=n.container.current;t.scrollLeft===n.scrollLeft&&t.scrollTop===n.scrollTop||(n.scrolling=!0,n.processScroll(e),n.onEndScroll())},n.onTouchStart=function(e){var t=n.props.nativeMobileScroll;if(n.isDraggable(e.target))if(n.internal=!0,t&&n.scrolling)n.pressed=!0;else{var r=e.touches[0];n.processClick(e,r.clientX,r.clientY),!t&&n.props.stopPropagation&&e.stopPropagation()}},n.onTouchEnd=function(e){var t=n.props.nativeMobileScroll;n.pressed&&(!n.started||n.scrolling&&t?n.pressed=!1:n.processEnd(),n.forceUpdate())},n.onTouchMove=function(e){var t=n.props.nativeMobileScroll;if(n.pressed&&(!t||!n.isMobile)){var r=e.touches[0];r&&n.processMove(e,r.clientX,r.clientY),e.preventDefault(),n.props.stopPropagation&&e.stopPropagation()}},n.onMouseDown=function(e){n.isDraggable(e.target)&&n.isScrollable()&&(n.internal=!0,-1!==n.props.buttons.indexOf(e.button)&&(n.processClick(e,e.clientX,e.clientY),e.preventDefault(),n.props.stopPropagation&&e.stopPropagation()))},n.onMouseMove=function(e){n.pressed&&(n.processMove(e,e.clientX,e.clientY),e.preventDefault(),n.props.stopPropagation&&e.stopPropagation())},n.onMouseUp=function(e){n.pressed&&(n.started?n.processEnd():(n.internal=!1,n.pressed=!1,n.forceUpdate(),n.props.onClick&&n.props.onClick(e)),e.preventDefault(),n.props.stopPropagation&&e.stopPropagation())},n.container=o.a.createRef(),n.onEndScroll=l(n.onEndScroll,300),n.scrolling=!1,n.started=!1,n.pressed=!1,n.internal=!1,n.getRef=n.getRef.bind(n),n}return function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.componentDidMount=function(){var e=this.props.nativeMobileScroll,t=this.container.current;window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd),t.addEventListener("touchstart",this.onTouchStart,{passive:!1}),t.addEventListener("mousedown",this.onMouseDown,{passive:!1}),e&&(this.isMobile=this.isMobileDevice(),this.isMobile&&this.forceUpdate())},t.prototype.componentWillUnmount=function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},t.prototype.getElement=function(){return this.container.current},t.prototype.isMobileDevice=function(){return void 0!==window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")},t.prototype.isDraggable=function(e){var t=this.props.ignoreElements;if(t){var n=e.closest(t);return null===n||n.contains(this.getElement())}return!0},t.prototype.isScrollable=function(){var e=this.container.current;return e&&(e.scrollWidth>e.clientWidth||e.scrollHeight>e.clientHeight)},t.prototype.processClick=function(e,t,n){var r=this.container.current;this.scrollLeft=r.scrollLeft,this.scrollTop=r.scrollTop,this.clientX=t,this.clientY=n,this.pressed=!0},t.prototype.processStart=function(e){void 0===e&&(e=!0);var t=this.props.onStartScroll;this.started=!0,e&&document.body.classList.add("indiana-dragging"),t&&t({external:!this.internal}),this.forceUpdate()},t.prototype.processScroll=function(e){if(this.started){var t=this.props.onScroll;t&&t({external:!this.internal})}else this.processStart(!1)},t.prototype.processMove=function(e,t,n){var r=this.props,i=r.horizontal,a=r.vertical,o=r.activationDistance,s=r.onScroll,u=this.container.current;this.started?(i&&(u.scrollLeft-=t-this.clientX),a&&(u.scrollTop-=n-this.clientY),s&&s({external:!this.internal}),this.clientX=t,this.clientY=n,this.scrollLeft=u.scrollLeft,this.scrollTop=u.scrollTop):(i&&Math.abs(t-this.clientX)>o||a&&Math.abs(n-this.clientY)>o)&&(this.clientX=t,this.clientY=n,this.processStart())},t.prototype.processEnd=function(){var e=this.props.onEndScroll;this.container.current&&e&&e({external:!this.internal}),this.pressed=!1,this.started=!1,this.scrolling=!1,this.internal=!1,document.body.classList.remove("indiana-dragging"),this.forceUpdate()},t.prototype.getRef=function(e){[this.container,this.props.innerRef].forEach((function(t){t&&("function"==typeof t?t(e):t.current=e)}))},t.prototype.render=function(){var e=this.props,t=e.children,n=e.draggingClassName,r=e.className,i=e.style,a=e.hideScrollbars,s=e.component;return o.a.createElement(s,{className:u(r,this.pressed&&n,d({dragging:this.pressed,"hide-scrollbars":a,"native-scroll":this.isMobile})),style:i,ref:this.getRef,onScroll:this.onScroll},t)},t.defaultProps={nativeMobileScroll:!0,hideScrollbars:!0,activationDistance:10,vertical:!0,horizontal:!0,stopPropagation:!1,style:{},component:"div",buttons:[0]},t}(a.PureComponent);t.a=f},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(27);function i(e){var t=function(e,t){if("object"!==Object(r.a)(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==Object(r.a)(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Object(r.a)(t)?t:String(t)}},function(e,t,n){"use strict";var r=n(28);n.d(t,"a",(function(){return r.a}));r.a.registerVersion("firebase","9.17.1","app-compat")},function(e,t,n){"use strict";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(i){return!1}}()?Object.assign:function(e,t){for(var n,o,s=function(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),u=1;u<arguments.length;u++){for(var c in n=Object(arguments[u]))i.call(n,c)&&(s[c]=n[c]);if(r){o=r(n);for(var l=0;l<o.length;l++)a.call(n,o[l])&&(s[o[l]]=n[o[l]])}}return s}},function(e,t){(function(t){e.exports=t}).call(this,{})},,function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(61)},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return E}));var r=n(0),i=n(3),a=n(15),o=n(7),s=n(12),u=n.n(s),c=n(56),l=Object.defineProperty,h=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,p=function(e,t,n){return t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},v=function(e,t){for(var n in t||(t={}))d.call(t,n)&&p(e,n,t[n]);if(h){var r,i=Object(o.a)(h(t));try{for(i.s();!(r=i.n()).done;){n=r.value;f.call(t,n)&&p(e,n,t[n])}}catch(a){i.e(a)}finally{i.f()}}return e};var m={exports:{}},g={},y=u.a,b=Symbol.for("react.element"),w=Symbol.for("react.fragment"),x=Object.prototype.hasOwnProperty,O=y.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,k={key:!0,ref:!0,__self:!0,__source:!0};function _(e,t,n){var r,i={},a=null,o=null;for(r in void 0!==n&&(a=""+n),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(o=t.ref),t)x.call(t,r)&&!k.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:b,type:e,key:a,ref:o,props:i,_owner:O.current}}g.Fragment=w,g.jsx=_,g.jsxs=_,m.exports=g;var S=m.exports.jsx,E=Object(s.forwardRef)((function(e,t){var n,u=e,l=u.scene,p=u.style,m=u.onMouseDown,g=u.onMouseUp,y=u.onMouseHover,b=u.onKeyDown,w=u.onKeyUp,x=u.onStart,O=u.onLookAt,k=u.onFollow,_=u.onWheel,E=u.onLoad,A=u.renderOnDemand,j=void 0===A||A,T=function(e,t){var n={};for(var r in e)d.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&h){var i,a=Object(o.a)(h(e));try{for(a.s();!(i=a.n()).done;)r=i.value,t.indexOf(r)<0&&f.call(e,r)&&(n[r]=e[r])}catch(s){a.e(s)}finally{a.f()}}return n}(u,["scene","style","onMouseDown","onMouseUp","onMouseHover","onKeyDown","onKeyUp","onStart","onLookAt","onFollow","onWheel","onLoad","renderOnDemand"]),M=Object(s.useRef)(null),C=Object(s.useState)(!0),D=Object(a.a)(C,2),I=D[0],P=D[1];return Object(s.useEffect)((function(){var e;P(!0);var t=[{name:"mouseDown",cb:m},{name:"mouseUp",cb:g},{name:"mouseHover",cb:y},{name:"keyDown",cb:b},{name:"keyUp",cb:w},{name:"start",cb:x},{name:"lookAt",cb:O},{name:"follow",cb:k},{name:"scroll",cb:_}];if(M.current){var n=function(){var n=Object(i.a)(Object(r.a)().mark((function n(){var i,a,s;return Object(r.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.load(l);case 2:i=Object(o.a)(t);try{for(i.s();!(a=i.n()).done;)(s=a.value).cb&&e.addEventListener(s.name,s.cb)}catch(r){i.e(r)}finally{i.f()}P(!1),null==E||E(e);case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();e=new c.a(M.current,{renderOnDemand:j}),n()}return function(){for(var n=0,r=t;n<r.length;n++){var i=r[n];i.cb&&e.removeEventListener(i.name,i.cb)}e.dispose()}}),[l]),S("canvas",v({ref:(n=[t,M],function(e){n.forEach((function(t){"function"===typeof t?t(e):null!=t&&(t.current=e)}))}),style:v({display:I?"none":"block"},p)},T))}))},function(e,t,n){"use strict";(function(e,r,i,a){n.d(t,"a",(function(){return LB}));var o,s,u=n(57),c=n(58),l=n(23),h=n(36),d=n(33),f=n(32),p=n(6),v=n(10),m=n(3),g=n(15),y=n(35),b=n(14),w=n(13),x=n(22),O=n(4),k=n(5),_=n(8),S=n(0),E=n(1),A=n(2),j=n(7),T=["texture"],M=["texture"],C=["name"],D=["material"],I=["enabled"],P=Object.create,R=Object.defineProperty,L=Object.getOwnPropertyDescriptor,N=Object.getOwnPropertyNames,B=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty,U=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}},z=function(e,t,n){return n=null!=e?P(B(e)):{},function(e,t,n,r){if(t&&"object"==typeof t||"function"==typeof t){var i,a=Object(j.a)(N(t));try{var o=function(){var a=i.value;!F.call(e,a)&&a!==n&&R(e,a,{get:function(){return t[a]},enumerable:!(r=L(t,a))||r.enumerable})};for(a.s();!(i=a.n()).done;)o()}catch(s){a.e(s)}finally{a.f()}}return e}(!t&&e&&e.__esModule?n:R(n,"default",{value:e,enumerable:!0}),e)},V=U((function(e,t){!function(r,i){"object"==typeof e?t.exports=i():"function"==typeof define&&n(50)?define(i):r.Alea=i()}(e,(function(){return e.importState=function(t){var n=new e;return n.importState(t),n},e;function e(){return function(e){var t=0,n=0,r=0,i=1;0==e.length&&(e=[+new Date]);var a=function(){var e=4022871197,t=function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t.version="Mash 0.9",t}();t=a(" "),n=a(" "),r=a(" ");for(var o=0;o<e.length;o++)(t-=a(e[o]))<0&&(t+=1),(n-=a(e[o]))<0&&(n+=1),(r-=a(e[o]))<0&&(r+=1);a=null;var s=function(){var e=2091639*t+2.3283064365386963e-10*i;return t=n,n=r,r=e-(i=0|e)};return s.next=s,s.uint32=function(){return 4294967296*s()},s.fract53=function(){return s()+11102230246251565e-32*(2097152*s()|0)},s.version="Alea 0.9",s.args=e,s.exportState=function(){return[t,n,r,i]},s.importState=function(e){t=+e[0]||0,n=+e[1]||0,r=+e[2]||0,i=+e[3]||0},s}(Array.prototype.slice.call(arguments))}}))})),G=U((function(e,t){!function(r,i){"object"==typeof e&&typeof t<"u"?i(e):"function"==typeof define&&n(50)?define(["exports"],i):i((r=typeof globalThis<"u"?globalThis:r||self).SVDJS={})}(e,(function(e){e.SVD=function(e,t,n,r,i){if(t=void 0===t||t,n=void 0===n||n,i=1e-64/(r=r||Math.pow(2,-52)),!e)throw new TypeError("Matrix a is not defined");var a,o,s,u,c,l,h,d,f,p,v,m,g=e[0].length,y=e.length;if(y<g)throw new TypeError("Invalid matrix: m < n");for(var b=[],w=[],x=[],O="f"===t?y:g,k=p=h=0;k<y;k++)w[k]=new Array(O).fill(0);for(k=0;k<g;k++)x[k]=new Array(g).fill(0);var _,S=new Array(g).fill(0);for(k=0;k<y;k++)for(a=0;a<g;a++)w[k][a]=e[k][a];for(k=0;k<g;k++){for(b[k]=h,f=0,s=k+1,a=k;a<y;a++)f+=Math.pow(w[a][k],2);if(f<i)h=0;else for(d=(l=w[k][k])*(h=l<0?Math.sqrt(f):-Math.sqrt(f))-f,w[k][k]=l-h,a=s;a<g;a++){for(f=0,o=k;o<y;o++)f+=w[o][k]*w[o][a];for(l=f/d,o=k;o<y;o++)w[o][a]=w[o][a]+l*w[o][k]}for(S[k]=h,f=0,a=s;a<g;a++)f+=Math.pow(w[k][a],2);if(f<i)h=0;else{for(d=(l=w[k][k+1])*(h=l<0?Math.sqrt(f):-Math.sqrt(f))-f,w[k][k+1]=l-h,a=s;a<g;a++)b[a]=w[k][a]/d;for(a=s;a<y;a++){for(f=0,o=s;o<g;o++)f+=w[a][o]*w[k][o];for(o=s;o<g;o++)w[a][o]=w[a][o]+f*b[o]}}p<(v=Math.abs(S[k])+Math.abs(b[k]))&&(p=v)}if(n)for(k=g-1;0<=k;k--){if(0!==h){for(d=w[k][k+1]*h,a=s;a<g;a++)x[a][k]=w[k][a]/d;for(a=s;a<g;a++){for(f=0,o=s;o<g;o++)f+=w[k][o]*x[o][a];for(o=s;o<g;o++)x[o][a]=x[o][a]+f*x[o][k]}}for(a=s;a<g;a++)x[k][a]=0,x[a][k]=0;x[k][k]=1,h=b[k],s=k}if(t){if("f"===t)for(k=g;k<y;k++){for(a=g;a<y;a++)w[k][a]=0;w[k][k]=1}for(k=g-1;0<=k;k--){for(s=k+1,h=S[k],a=s;a<O;a++)w[k][a]=0;if(0!==h){for(d=w[k][k]*h,a=s;a<O;a++){for(f=0,o=s;o<y;o++)f+=w[o][k]*w[o][a];for(l=f/d,o=k;o<y;o++)w[o][a]=w[o][a]+l*w[o][k]}for(a=k;a<y;a++)w[a][k]=w[a][k]/h}else for(a=k;a<y;a++)w[a][k]=0;w[k][k]=w[k][k]+1}}for(r*=p,o=g-1;0<=o;o--)for(var E=0;E<50;E++){for(_=!1,s=o;0<=s;s--){if(Math.abs(b[s])<=r){_=!0;break}if(Math.abs(S[s-1])<=r)break}if(!_)for(c=0,u=s-(f=1),k=s;k<o+1&&(l=f*b[k],b[k]=c*b[k],!(Math.abs(l)<=r));k++)if(h=S[k],S[k]=Math.sqrt(l*l+h*h),c=h/(d=S[k]),f=-l/d,t)for(a=0;a<y;a++)v=w[a][u],m=w[a][k],w[a][u]=v*c+m*f,w[a][k]=-v*f+m*c;if(m=S[o],s===o){if(m<0&&(S[o]=-m,n))for(a=0;a<g;a++)x[a][o]=-x[a][o];break}for(p=S[s],l=(((v=S[o-1])-m)*(v+m)+((h=b[o-1])-(d=b[o]))*(h+d))/(2*d*v),h=Math.sqrt(l*l+1),l=((p-m)*(p+m)+d*(v/(l<0?l-h:l+h)-d))/p,k=s+(f=c=1);k<o+1;k++){if(h=b[k],v=S[k],d=f*h,h*=c,m=Math.sqrt(l*l+d*d),l=p*(c=l/(b[k-1]=m))+h*(f=d/m),h=-p*f+h*c,d=v*f,v*=c,n)for(a=0;a<g;a++)p=x[a][k-1],m=x[a][k],x[a][k-1]=p*c+m*f,x[a][k]=-p*f+m*c;if(m=Math.sqrt(l*l+d*d),l=(c=l/(S[k-1]=m))*h+(f=d/m)*v,p=-f*h+c*v,t)for(a=0;a<y;a++)v=w[a][k-1],m=w[a][k],w[a][k-1]=v*c+m*f,w[a][k]=-v*f+m*c}b[s]=0,b[o]=l,S[o]=p}for(k=0;k<g;k++)S[k]<r&&(S[k]=0);return{u:w,q:S,v:x}},e.VERSION="1.1.1",Object.defineProperty(e,"__esModule",{value:!0})}))})),H=U((function(t){!function(){var r=function(){this.init()};r.prototype={init:function(){var e=this||i;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator=typeof window<"u"&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||i;if(e=parseFloat(e),t.ctx||d(),typeof e<"u"&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,i.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var r=t._howls[n]._getSoundIds(),a=0;a<r.length;a++){var o=t._howls[n]._soundById(r[a]);o&&o._node&&(o._node.volume=o._volume*e)}return t}return t._volume},mute:function(e){var t=this||i;t.ctx||d(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,i.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var r=t._howls[n]._getSoundIds(),a=0;a<r.length;a++){var o=t._howls[n]._soundById(r[a]);o&&o._node&&(o._node.muted=!!e||o._muted)}return t},stop:function(){for(var e=this||i,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||i,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&typeof e.ctx.close<"u"&&(e.ctx.close(),e.ctx=null,d()),e},codecs:function(e){return(this||i)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||i;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if(typeof Audio<"u")try{typeof(new Audio).oncanplaythrough>"u"&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(n){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||i,t=null;try{t=typeof Audio<"u"?new Audio:null}catch(l){return e}if(!t||"function"!=typeof t.canPlayType)return e;var n=t.canPlayType("audio/mpeg;").replace(/^no$/,""),r=e._navigator?e._navigator.userAgent:"",a=r.match(/OPR\/([0-6].)/g),o=a&&parseInt(a[0].split("/")[1],10)<33,s=-1!==r.indexOf("Safari")&&-1===r.indexOf("Chrome"),u=r.match(/Version\/(.*?) /),c=s&&u&&parseInt(u[1],10)<15;return e._codecs={mp3:!(o||!n&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(c||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(c||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||i;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,!e._mobileUnloaded&&44100!==e.ctx.sampleRate&&(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function t(n){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var r=new Audio;r._unlocked=!0,e._releaseHtml5Audio(r)}catch(c){e.noAudio=!0;break}for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var a=e._howls[i]._getSoundIds(),o=0;o<a.length;o++){var s=e._howls[i]._soundById(a[o]);s&&s._node&&!s._node._unlocked&&(s._node._unlocked=!0,s._node.load())}e._autoResume();var u=e.ctx.createBufferSource();u.buffer=e._scratchBuffer,u.connect(e.ctx.destination),typeof u.start>"u"?u.noteOn(0):u.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),u.onended=function(){u.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("keydown",t,!0);for(var n=0;n<e._howls.length;n++)e._howls[n]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),document.addEventListener("keydown",t,!0),e}},_obtainHtml5Audio:function(){var e=this||i;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&typeof Promise<"u"&&(t instanceof Promise||"function"==typeof t.then)&&t.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var t=this||i;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&!(typeof e.ctx.suspend>"u")&&i.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var n=0;n<e._howls[t]._sounds.length;n++)if(!e._howls[t]._sounds[n]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&!(typeof e.ctx.resume>"u")&&i.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var i=new r,a=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};a.prototype={init:function(e){var t=this;return i.ctx||d(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=i.usingWebAudio&&!t._html5,typeof i.ctx<"u"&&i.ctx&&i.autoUnlock&&i._unlockAudio(),i._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(i.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var n=0;n<e._src.length;n++){var r,a;if(e._format&&e._format[n])r=e._format[n];else{if("string"!=typeof(a=e._src[n])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(r=/^data:audio\/([^;,]+);/i.exec(a))||(r=/\.([^.]+)$/.exec(a.split("?",1)[0])),r&&(r=r[1].toLowerCase())}if(r||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),r&&i.codecs(r)){t=e._src[n];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new o(e),e._webAudio&&u(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var n=this,r=null;if("number"==typeof e)r=e,e=null;else{if("string"==typeof e&&"loaded"===n._state&&!n._sprite[e])return null;if(typeof e>"u"&&(e="__default",!n._playLock)){for(var a=0,o=0;o<n._sounds.length;o++)n._sounds[o]._paused&&!n._sounds[o]._ended&&(a++,r=n._sounds[o]._id);1===a?e=null:r=null}}var s=r?n._soundById(r):n._inactiveSound();if(!s)return null;if(r&&!e&&(e=s._sprite||"__default"),"loaded"!==n._state){s._sprite=e,s._ended=!1;var u=s._id;return n._queue.push({event:"play",action:function(){n.play(u)}}),u}if(r&&!s._paused)return t||n._loadQueue("play"),s._id;n._webAudio&&i._autoResume();var c=Math.max(0,s._seek>0?s._seek:n._sprite[e][0]/1e3),l=Math.max(0,(n._sprite[e][0]+n._sprite[e][1])/1e3-c),h=1e3*l/Math.abs(s._rate),d=n._sprite[e][0]/1e3,f=(n._sprite[e][0]+n._sprite[e][1])/1e3;s._sprite=e,s._ended=!1;var p=function(){s._paused=!1,s._seek=c,s._start=d,s._stop=f,s._loop=!(!s._loop&&!n._sprite[e][2])};if(!(c>=f)){var v=s._node;if(n._webAudio){var m=function(){n._playLock=!1,p(),n._refreshBuffer(s);var e=s._muted||n._muted?0:s._volume;v.gain.setValueAtTime(e,i.ctx.currentTime),s._playStart=i.ctx.currentTime,typeof v.bufferSource.start>"u"?s._loop?v.bufferSource.noteGrainOn(0,c,86400):v.bufferSource.noteGrainOn(0,c,l):s._loop?v.bufferSource.start(0,c,86400):v.bufferSource.start(0,c,l),h!==1/0&&(n._endTimers[s._id]=setTimeout(n._ended.bind(n,s),h)),t||setTimeout((function(){n._emit("play",s._id),n._loadQueue()}),0)};"running"===i.state&&"interrupted"!==i.ctx.state?m():(n._playLock=!0,n.once("resume",m),n._clearTimer(s._id))}else{var g=function(){v.currentTime=c,v.muted=s._muted||n._muted||i._muted||v.muted,v.volume=s._volume*i.volume(),v.playbackRate=s._rate;try{var r=v.play();if(r&&typeof Promise<"u"&&(r instanceof Promise||"function"==typeof r.then)?(n._playLock=!0,p(),r.then((function(){n._playLock=!1,v._unlocked=!0,t?n._loadQueue():n._emit("play",s._id)})).catch((function(){n._playLock=!1,n._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),s._ended=!0,s._paused=!0}))):t||(n._playLock=!1,p(),n._emit("play",s._id)),v.playbackRate=s._rate,v.paused)return void n._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||s._loop?n._endTimers[s._id]=setTimeout(n._ended.bind(n,s),h):(n._endTimers[s._id]=function(){n._ended(s),v.removeEventListener("ended",n._endTimers[s._id],!1)},v.addEventListener("ended",n._endTimers[s._id],!1))}catch(a){n._emit("playerror",s._id,a)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===v.src&&(v.src=n._src,v.load());var y=window&&window.ejecta||!v.readyState&&i._navigator.isCocoonJS;if(v.readyState>=3||y)g();else{n._playLock=!0,n._state="loading";v.addEventListener(i._canPlayEvent,(function e(){n._state="loaded",g(),v.removeEventListener(i._canPlayEvent,e,!1)}),!1),n._clearTimer(s._id)}}return s._id}n._ended(s)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),r=0;r<n.length;r++){t._clearTimer(n[r]);var i=t._soundById(n[r]);if(i&&!i._paused&&(i._seek=t.seek(n[r]),i._rateSeek=0,i._paused=!0,t._stopFade(n[r]),i._node))if(t._webAudio){if(!i._node.bufferSource)continue;typeof i._node.bufferSource.stop>"u"?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),t._cleanBuffer(i._node)}else(!isNaN(i._node.duration)||i._node.duration===1/0)&&i._node.pause();arguments[1]||t._emit("pause",i?i._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var r=n._getSoundIds(e),i=0;i<r.length;i++){n._clearTimer(r[i]);var a=n._soundById(r[i]);a&&(a._seek=a._start||0,a._rateSeek=0,a._paused=!0,a._ended=!0,n._stopFade(r[i]),a._node&&(n._webAudio?a._node.bufferSource&&(typeof a._node.bufferSource.stop>"u"?a._node.bufferSource.noteOff(0):a._node.bufferSource.stop(0),n._cleanBuffer(a._node)):(!isNaN(a._node.duration)||a._node.duration===1/0)&&(a._node.currentTime=a._start||0,a._node.pause(),a._node.duration===1/0&&n._clearSound(a._node))),t||n._emit("stop",a._id))}return n},mute:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(e,t)}}),n;if(typeof t>"u"){if("boolean"!=typeof e)return n._muted;n._muted=e}for(var r=n._getSoundIds(t),a=0;a<r.length;a++){var o=n._soundById(r[a]);o&&(o._muted=e,o._interval&&n._stopFade(o._id),n._webAudio&&o._node?o._node.gain.setValueAtTime(e?0:o._volume,i.ctx.currentTime):o._node&&(o._node.muted=!!i._muted||e),n._emit("mute",o._id))}return n},volume:function(){var e,t,n,r=this,a=arguments;if(0===a.length)return r._volume;1===a.length||2===a.length&&typeof a[1]>"u"?r._getSoundIds().indexOf(a[0])>=0?t=parseInt(a[0],10):e=parseFloat(a[0]):a.length>=2&&(e=parseFloat(a[0]),t=parseInt(a[1],10));if(!(typeof e<"u"&&e>=0&&e<=1))return(n=t?r._soundById(t):r._sounds[0])?n._volume:0;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,a)}}),r;typeof t>"u"&&(r._volume=e),t=r._getSoundIds(t);for(var o=0;o<t.length;o++)(n=r._soundById(t[o]))&&(n._volume=e,a[2]||r._stopFade(t[o]),r._webAudio&&n._node&&!n._muted?n._node.gain.setValueAtTime(e,i.ctx.currentTime):n._node&&!n._muted&&(n._node.volume=e*i.volume()),r._emit("volume",n._id));return r},fade:function(e,t,n,r){var a=this;if("loaded"!==a._state||a._playLock)return a._queue.push({event:"fade",action:function(){a.fade(e,t,n,r)}}),a;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),n=parseFloat(n),a.volume(e,r);for(var o=a._getSoundIds(r),s=0;s<o.length;s++){var u=a._soundById(o[s]);if(u){if(r||a._stopFade(o[s]),a._webAudio&&!u._muted){var c=i.ctx.currentTime,l=c+n/1e3;u._volume=e,u._node.gain.setValueAtTime(e,c),u._node.gain.linearRampToValueAtTime(t,l)}a._startFadeInterval(u,e,t,n,o[s],typeof r>"u")}}return a},_startFadeInterval:function(e,t,n,r,i,a){var o=this,s=t,u=n-t,c=Math.abs(u/.01),l=Math.max(4,c>0?r/c:r),h=Date.now();e._fadeTo=n,e._interval=setInterval((function(){var i=(Date.now()-h)/r;h=Date.now(),s+=u*i,s=Math.round(100*s)/100,s=u<0?Math.max(n,s):Math.min(n,s),o._webAudio?e._volume=s:o.volume(s,e._id,!0),a&&(o._volume=s),(n<t&&s<=n||n>t&&s>=n)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,o.volume(n,e._id),o._emit("fade",e._id))}),l)},_stopFade:function(e){var t=this,n=t._soundById(e);return n&&n._interval&&(t._webAudio&&n._node.gain.cancelScheduledValues(i.ctx.currentTime),clearInterval(n._interval),n._interval=null,t.volume(n._fadeTo,e),n._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,n,r=this,i=arguments;if(0===i.length)return r._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(n=r._soundById(parseInt(i[0],10)))&&n._loop;e=i[0],r._loop=e}else 2===i.length&&(e=i[0],t=parseInt(i[1],10));for(var a=r._getSoundIds(t),o=0;o<a.length;o++)(n=r._soundById(a[o]))&&(n._loop=e,r._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop,r.playing(a[o])&&(r.pause(a[o],!0),r.play(a[o],!0)))));return r},rate:function(){var e,t,n,r=this,a=arguments;if(0===a.length)t=r._sounds[0]._id;else if(1===a.length){r._getSoundIds().indexOf(a[0])>=0?t=parseInt(a[0],10):e=parseFloat(a[0])}else 2===a.length&&(e=parseFloat(a[0]),t=parseInt(a[1],10));if("number"!=typeof e)return(n=r._soundById(t))?n._rate:r._rate;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,a)}}),r;typeof t>"u"&&(r._rate=e),t=r._getSoundIds(t);for(var o=0;o<t.length;o++)if(n=r._soundById(t[o])){r.playing(t[o])&&(n._rateSeek=r.seek(t[o]),n._playStart=r._webAudio?i.ctx.currentTime:n._playStart),n._rate=e,r._webAudio&&n._node&&n._node.bufferSource?n._node.bufferSource.playbackRate.setValueAtTime(e,i.ctx.currentTime):n._node&&(n._node.playbackRate=e);var s=r.seek(t[o]),u=1e3*((r._sprite[n._sprite][0]+r._sprite[n._sprite][1])/1e3-s)/Math.abs(n._rate);(r._endTimers[t[o]]||!n._paused)&&(r._clearTimer(t[o]),r._endTimers[t[o]]=setTimeout(r._ended.bind(r,n),u)),r._emit("rate",n._id)}return r},seek:function(){var e,t,n=this,r=arguments;if(0===r.length)n._sounds.length&&(t=n._sounds[0]._id);else if(1===r.length){n._getSoundIds().indexOf(r[0])>=0?t=parseInt(r[0],10):n._sounds.length&&(t=n._sounds[0]._id,e=parseFloat(r[0]))}else 2===r.length&&(e=parseFloat(r[0]),t=parseInt(r[1],10));if(typeof t>"u")return 0;if("number"==typeof e&&("loaded"!==n._state||n._playLock))return n._queue.push({event:"seek",action:function(){n.seek.apply(n,r)}}),n;var a=n._soundById(t);if(a){if(!("number"==typeof e&&e>=0)){if(n._webAudio){var o=n.playing(t)?i.ctx.currentTime-a._playStart:0,s=a._rateSeek?a._rateSeek-a._seek:0;return a._seek+(s+o*Math.abs(a._rate))}return a._node.currentTime}var u=n.playing(t);u&&n.pause(t,!0),a._seek=e,a._ended=!1,n._clearTimer(t),!n._webAudio&&a._node&&!isNaN(a._node.duration)&&(a._node.currentTime=e);var c=function(){u&&n.play(t,!0),n._emit("seek",t)};if(u&&!n._webAudio){setTimeout((function e(){n._playLock?setTimeout(e,0):c()}),0)}else c()}return n},playing:function(e){var t=this;if("number"==typeof e){var n=t._soundById(e);return!!n&&!n._paused}for(var r=0;r<t._sounds.length;r++)if(!t._sounds[r]._paused)return!0;return!1},duration:function(e){var t=this,n=t._duration,r=t._soundById(e);return r&&(n=t._sprite[r._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,n=0;n<t.length;n++)t[n]._paused||e.stop(t[n]._id),e._webAudio||(e._clearSound(t[n]._node),t[n]._node.removeEventListener("error",t[n]._errorFn,!1),t[n]._node.removeEventListener(i._canPlayEvent,t[n]._loadFn,!1),t[n]._node.removeEventListener("ended",t[n]._endFn,!1),i._releaseHtml5Audio(t[n]._node)),delete t[n]._node,e._clearTimer(t[n]._id);var r=i._howls.indexOf(e);r>=0&&i._howls.splice(r,1);var a=!0;for(n=0;n<i._howls.length;n++)if(i._howls[n]._src===e._src||e._src.indexOf(i._howls[n]._src)>=0){a=!1;break}return s&&a&&delete s[e._src],i.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,r){var i=this["_on"+e];return"function"==typeof t&&i.push(r?{id:n,fn:t,once:r}:{id:n,fn:t}),this},off:function(e,t,n){var r=this,i=r["_on"+e],a=0;if("number"==typeof t&&(n=t,t=null),t||n)for(a=0;a<i.length;a++){var o=n===i[a].id;if(t===i[a].fn&&o||!t&&o){i.splice(a,1);break}}else if(e)r["_on"+e]=[];else{var s=Object.keys(r);for(a=0;a<s.length;a++)0===s[a].indexOf("_on")&&Array.isArray(r[s[a]])&&(r[s[a]]=[])}return r},once:function(e,t,n){return this.on(e,t,n,1),this},_emit:function(e,t,n){for(var r=this,i=r["_on"+e],a=i.length-1;a>=0;a--)(!i[a].id||i[a].id===t||"load"===e)&&(setTimeout(function(e){e.call(this,t,n)}.bind(r,i[a].fn),0),i[a].once&&r.off(e,i[a].fn,i[a].id));return r._loadQueue(e),r},_loadQueue:function(e){var t=this;if(t._queue.length>0){var n=t._queue[0];n.event===e&&(t._queue.shift(),t._loadQueue()),e||n.action()}return t},_ended:function(e){var t=this,n=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var r=!(!e._loop&&!t._sprite[n][2]);if(t._emit("end",e._id),!t._webAudio&&r&&t.stop(e._id,!0).play(e._id),t._webAudio&&r){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=i.ctx.currentTime;var a=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),a)}return t._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),i._autoSuspend()),!t._webAudio&&!r&&t.stop(e._id,!0),t},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var n=t._soundById(e);n&&n._node&&n._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,n=0;n<t._sounds.length;n++)if(e===t._sounds[n]._id)return t._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new o(e)},_drain:function(){var e=this,t=e._pool,n=0,r=0;if(!(e._sounds.length<t)){for(r=0;r<e._sounds.length;r++)e._sounds[r]._ended&&n++;for(r=e._sounds.length-1;r>=0;r--){if(n<=t)return;e._sounds[r]._ended&&(e._webAudio&&e._sounds[r]._node&&e._sounds[r]._node.disconnect(0),e._sounds.splice(r,1),n--)}}},_getSoundIds:function(e){if(typeof e>"u"){for(var t=[],n=0;n<this._sounds.length;n++)t.push(this._sounds[n]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=i.ctx.createBufferSource(),e._node.bufferSource.buffer=s[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,i.ctx.currentTime),this},_cleanBuffer:function(e){var t=i._navigator&&i._navigator.vendor.indexOf("Apple")>=0;if(i._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=i._scratchBuffer}catch(n){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(i._navigator&&i._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var o=function(e){this._parent=e,this.init()};o.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++i._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,n=i._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),e._node.gain.setValueAtTime(n,i.ctx.currentTime),e._node.paused=!0,e._node.connect(i.masterGain)):i.noAudio||(e._node=i._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(i._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=n*i.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++i._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(i._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var s={},u=function(e){var t=e._src;if(s[t])return e._duration=s[t].duration,void h(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);l(r.buffer,e)}else{var a=new XMLHttpRequest;a.open(e._xhr.method,t,!0),a.withCredentials=e._xhr.withCredentials,a.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){a.setRequestHeader(t,e._xhr.headers[t])})),a.onload=function(){var t=(a.status+"")[0];"0"===t||"2"===t||"3"===t?l(a.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+a.status+".")},a.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete s[t],e.load())},c(a)}},c=function(e){try{e.send()}catch(t){e.onerror()}},l=function(e,t){var n=function(){t._emit("loaderror",null,"Decoding audio data failed.")},r=function(e){e&&t._sounds.length>0?(s[t._src]=e,h(t,e)):n()};typeof Promise<"u"&&1===i.ctx.decodeAudioData.length?i.ctx.decodeAudioData(e).then(r).catch(n):i.ctx.decodeAudioData(e,r,n)},h=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},d=function(){if(i.usingWebAudio){try{typeof AudioContext<"u"?i.ctx=new AudioContext:typeof webkitAudioContext<"u"?i.ctx=new webkitAudioContext:i.usingWebAudio=!1}catch(a){i.usingWebAudio=!1}i.ctx||(i.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(i._navigator&&i._navigator.platform),t=i._navigator&&i._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=t?parseInt(t[1],10):null;if(e&&n&&n<9){var r=/safari/.test(i._navigator&&i._navigator.userAgent.toLowerCase());i._navigator&&!r&&(i.usingWebAudio=!1)}i.usingWebAudio&&(i.masterGain=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),i.masterGain.gain.setValueAtTime(i._muted?0:i._volume,i.ctx.currentTime),i.masterGain.connect(i.ctx.destination)),i._setup()}};"function"==typeof define&&n(50)&&define([],(function(){return{Howler:i,Howl:a}})),typeof t<"u"&&(t.Howler=i,t.Howl=a),typeof e<"u"?(e.HowlerGlobal=r,e.Howler=i,e.Howl=a,e.Sound=o):typeof window<"u"&&(window.HowlerGlobal=r,window.Howler=i,window.Howl=a,window.Sound=o)}(),function(){var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var n=t._howls.length-1;n>=0;n--)t._howls[n].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,n){var r=this;return r.ctx&&r.ctx.listener?(t="number"!=typeof t?r._pos[1]:t,n="number"!=typeof n?r._pos[2]:n,"number"!=typeof e?r._pos:(r._pos=[e,t,n],typeof r.ctx.listener.positionX<"u"?(r.ctx.listener.positionX.setTargetAtTime(r._pos[0],Howler.ctx.currentTime,.1),r.ctx.listener.positionY.setTargetAtTime(r._pos[1],Howler.ctx.currentTime,.1),r.ctx.listener.positionZ.setTargetAtTime(r._pos[2],Howler.ctx.currentTime,.1)):r.ctx.listener.setPosition(r._pos[0],r._pos[1],r._pos[2]),r)):r},HowlerGlobal.prototype.orientation=function(e,t,n,r,i,a){var o=this;if(!o.ctx||!o.ctx.listener)return o;var s=o._orientation;return t="number"!=typeof t?s[1]:t,n="number"!=typeof n?s[2]:n,r="number"!=typeof r?s[3]:r,i="number"!=typeof i?s[4]:i,a="number"!=typeof a?s[5]:a,"number"!=typeof e?s:(o._orientation=[e,t,n,r,i,a],typeof o.ctx.listener.forwardX<"u"?(o.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),o.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),o.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),o.ctx.listener.upX.setTargetAtTime(r,Howler.ctx.currentTime,.1),o.ctx.listener.upY.setTargetAtTime(i,Howler.ctx.currentTime,.1),o.ctx.listener.upZ.setTargetAtTime(a,Howler.ctx.currentTime,.1)):o.ctx.listener.setOrientation(e,t,n,r,i,a),o)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var n=this;return n._orientation=t.orientation||[1,0,0],n._stereo=t.stereo||null,n._pos=t.pos||null,n._pannerAttr={coneInnerAngle:typeof t.coneInnerAngle<"u"?t.coneInnerAngle:360,coneOuterAngle:typeof t.coneOuterAngle<"u"?t.coneOuterAngle:360,coneOuterGain:typeof t.coneOuterGain<"u"?t.coneOuterGain:0,distanceModel:typeof t.distanceModel<"u"?t.distanceModel:"inverse",maxDistance:typeof t.maxDistance<"u"?t.maxDistance:1e4,panningModel:typeof t.panningModel<"u"?t.panningModel:"HRTF",refDistance:typeof t.refDistance<"u"?t.refDistance:1,rolloffFactor:typeof t.rolloffFactor<"u"?t.rolloffFactor:1},n._onstereo=t.onstereo?[{fn:t.onstereo}]:[],n._onpos=t.onpos?[{fn:t.onpos}]:[],n._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,n){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"stereo",action:function(){r.stereo(e,n)}}),r;var i=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof n>"u"){if("number"!=typeof e)return r._stereo;r._stereo=e,r._pos=[e,0,0]}for(var a=r._getSoundIds(n),o=0;o<a.length;o++){var s=r._soundById(a[o]);if(s){if("number"!=typeof e)return s._stereo;s._stereo=e,s._pos=[e,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",(!s._panner||!s._panner.pan)&&t(s,i),"spatial"===i?typeof s._panner.positionX<"u"?(s._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),s._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),s._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):s._panner.setPosition(e,0,0):s._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),r._emit("stereo",s._id)}}return r},Howl.prototype.pos=function(e,n,r,i){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"pos",action:function(){a.pos(e,n,r,i)}}),a;if(n="number"!=typeof n?0:n,r="number"!=typeof r?-.5:r,typeof i>"u"){if("number"!=typeof e)return a._pos;a._pos=[e,n,r]}for(var o=a._getSoundIds(i),s=0;s<o.length;s++){var u=a._soundById(o[s]);if(u){if("number"!=typeof e)return u._pos;u._pos=[e,n,r],u._node&&((!u._panner||u._panner.pan)&&t(u,"spatial"),typeof u._panner.positionX<"u"?(u._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),u._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),u._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):u._panner.setPosition(e,n,r)),a._emit("pos",u._id)}}return a},Howl.prototype.orientation=function(e,n,r,i){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"orientation",action:function(){a.orientation(e,n,r,i)}}),a;if(n="number"!=typeof n?a._orientation[1]:n,r="number"!=typeof r?a._orientation[2]:r,typeof i>"u"){if("number"!=typeof e)return a._orientation;a._orientation=[e,n,r]}for(var o=a._getSoundIds(i),s=0;s<o.length;s++){var u=a._soundById(o[s]);if(u){if("number"!=typeof e)return u._orientation;u._orientation=[e,n,r],u._node&&(u._panner||(u._pos||(u._pos=a._pos||[0,0,-.5]),t(u,"spatial")),typeof u._panner.orientationX<"u"?(u._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),u._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),u._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):u._panner.setOrientation(e,n,r)),a._emit("orientation",u._id)}}return a},Howl.prototype.pannerAttr=function(){var e,n,r,i=this,a=arguments;if(!i._webAudio)return i;if(0===a.length)return i._pannerAttr;if(1===a.length){if("object"!=typeof a[0])return(r=i._soundById(parseInt(a[0],10)))?r._pannerAttr:i._pannerAttr;e=a[0],typeof n>"u"&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),i._pannerAttr={coneInnerAngle:typeof e.pannerAttr.coneInnerAngle<"u"?e.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:typeof e.pannerAttr.coneOuterAngle<"u"?e.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:typeof e.pannerAttr.coneOuterGain<"u"?e.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:typeof e.pannerAttr.distanceModel<"u"?e.pannerAttr.distanceModel:i._distanceModel,maxDistance:typeof e.pannerAttr.maxDistance<"u"?e.pannerAttr.maxDistance:i._maxDistance,refDistance:typeof e.pannerAttr.refDistance<"u"?e.pannerAttr.refDistance:i._refDistance,rolloffFactor:typeof e.pannerAttr.rolloffFactor<"u"?e.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:typeof e.pannerAttr.panningModel<"u"?e.pannerAttr.panningModel:i._panningModel})}else 2===a.length&&(e=a[0],n=parseInt(a[1],10));for(var o=i._getSoundIds(n),s=0;s<o.length;s++)if(r=i._soundById(o[s])){var u=r._pannerAttr;u={coneInnerAngle:typeof e.coneInnerAngle<"u"?e.coneInnerAngle:u.coneInnerAngle,coneOuterAngle:typeof e.coneOuterAngle<"u"?e.coneOuterAngle:u.coneOuterAngle,coneOuterGain:typeof e.coneOuterGain<"u"?e.coneOuterGain:u.coneOuterGain,distanceModel:typeof e.distanceModel<"u"?e.distanceModel:u.distanceModel,maxDistance:typeof e.maxDistance<"u"?e.maxDistance:u.maxDistance,refDistance:typeof e.refDistance<"u"?e.refDistance:u.refDistance,rolloffFactor:typeof e.rolloffFactor<"u"?e.rolloffFactor:u.rolloffFactor,panningModel:typeof e.panningModel<"u"?e.panningModel:u.panningModel};var c=r._panner;c?(c.coneInnerAngle=u.coneInnerAngle,c.coneOuterAngle=u.coneOuterAngle,c.coneOuterGain=u.coneOuterGain,c.distanceModel=u.distanceModel,c.maxDistance=u.maxDistance,c.refDistance=u.refDistance,c.rolloffFactor=u.rolloffFactor,c.panningModel=u.panningModel):(r._pos||(r._pos=i._pos||[0,0,-.5]),t(r,"spatial"))}return i},Sound.prototype.init=function(e){return function(){var t=this,n=t._parent;t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,e.call(this),t._stereo?n.stereo(t._stereo):t._pos&&n.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,n=t._parent;return t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,t._stereo?n.stereo(t._stereo):t._pos?n.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,n._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX<"u"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX<"u"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}()})),W="142",q={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Y=0,X=1,K=2,Q=1,Z=2,J=3,$=0,ee=1,te=2,ne=0,re=1,ie=2,ae=3,oe=4,se=5,ue=100,ce=101,le=102,he=103,de=104,fe=200,pe=201,ve=202,me=203,ge=204,ye=205,be=206,we=207,xe=208,Oe=209,ke=210,_e=0,Se=1,Ee=2,Ae=3,je=4,Te=5,Me=6,Ce=7,De=0,Ie=1,Pe=2,Re=0,Le=1,Ne=2,Be=3,Fe=4,Ue=5,ze=301,Ve=302,Ge=303,He=304,We=306,qe=1e3,Ye=1001,Xe=1002,Ke=1003,Qe=1004,Ze=1005,Je=1006,$e=1007,et=1008,tt=1009,nt=1010,rt=1011,it=1012,at=1013,ot=1014,st=1015,ut=1016,ct=1017,lt=1018,ht=1020,dt=1021,ft=1022,pt=1023,vt=1024,mt=1025,gt=1026,yt=1027,bt=1028,wt=1029,xt=1030,Ot=1031,kt=1033,_t=33776,St=33777,Et=33778,At=33779,jt=35840,Tt=35841,Mt=35842,Ct=35843,Dt=36196,It=37492,Pt=37496,Rt=37808,Lt=37809,Nt=37810,Bt=37811,Ft=37812,Ut=37813,zt=37814,Vt=37815,Gt=37816,Ht=37817,Wt=37818,qt=37819,Yt=37820,Xt=37821,Kt=36492,Qt=2300,Zt=2301,Jt=2302,$t=2400,en=2501,tn=3e3,nn=3001,rn=3200,an=3201,on=0,sn=1,un="srgb",cn="srgb-linear",ln=7680,hn=519,dn=35044,fn="300 es",pn=1035,vn=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,e);e.target=null}}}}]),e}(),mn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],gn=1234567,yn=Math.PI/180,bn=180/Math.PI;function wn(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(mn[255&e]+mn[e>>8&255]+mn[e>>16&255]+mn[e>>24&255]+"-"+mn[255&t]+mn[t>>8&255]+"-"+mn[t>>16&15|64]+mn[t>>24&255]+"-"+mn[63&n|128]+mn[n>>8&255]+"-"+mn[n>>16&255]+mn[n>>24&255]+mn[255&r]+mn[r>>8&255]+mn[r>>16&255]+mn[r>>24&255]).toLowerCase()}function xn(e,t,n){return Math.max(t,Math.min(n,e))}function On(e,t){return(e%t+t)%t}function kn(e,t,n){return(1-n)*e+n*t}function _n(e){return 0===(e&e-1)&&0!==e}function Sn(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var En=Object.freeze({__proto__:null,DEG2RAD:yn,RAD2DEG:bn,generateUUID:wn,clamp:xn,euclideanModulo:On,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:kn,damp:function(e,t,n,r){return kn(e,t,1-Math.exp(-n*r))},pingpong:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(On(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(gn=e);var t=gn+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*yn},radToDeg:function(e){return e*bn},isPowerOfTwo:_n,ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:Sn,setQuaternionFromProperEuler:function(e,t,n,r,i){var a=Math.cos,o=Math.sin,s=a(n/2),u=o(n/2),c=a((t+r)/2),l=o((t+r)/2),h=a((t-r)/2),d=o((t-r)/2),f=a((r-t)/2),p=o((r-t)/2);switch(i){case"XYX":e.set(s*l,u*h,u*d,s*c);break;case"YZY":e.set(u*d,s*l,u*h,s*c);break;case"ZXZ":e.set(u*h,u*d,s*l,s*c);break;case"XZX":e.set(s*l,u*p,u*f,s*c);break;case"YXY":e.set(u*f,s*l,u*p,s*c);break;case"ZYZ":e.set(u*p,u*f,s*l,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},normalize:function(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}},denormalize:function(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}}),An=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(E.a)(this,t),t.prototype.isVector2=!0,this.x=e,this.y=n}return Object(A.a)(t,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){return Math.atan2(-this.y,-this.x)+Math.PI}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:e,value:Object(S.a)().mark((function e(){return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:case"end":return e.stop()}}),e,this)}))}]),t}(Symbol.iterator),jn=function(){function e(){Object(E.a)(this,e),e.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}return Object(A.a)(e,[{key:"set",value:function(e,t,n,r,i,a,o,s,u){var c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=i,c[5]=s,c[6]=n,c[7]=a,c[8]=u,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[3],s=n[6],u=n[1],c=n[4],l=n[7],h=n[2],d=n[5],f=n[8],p=r[0],v=r[3],m=r[6],g=r[1],y=r[4],b=r[7],w=r[2],x=r[5],O=r[8];return i[0]=a*p+o*g+s*w,i[3]=a*v+o*y+s*x,i[6]=a*m+o*b+s*O,i[1]=u*p+c*g+l*w,i[4]=u*v+c*y+l*x,i[7]=u*m+c*b+l*O,i[2]=h*p+d*g+f*w,i[5]=h*v+d*y+f*x,i[8]=h*m+d*b+f*O,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],c=e[8];return t*a*c-t*o*u-n*i*c+n*o*s+r*i*u-r*a*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],c=e[8],l=c*a-o*u,h=o*s-c*i,d=u*i-a*s,f=t*l+n*h+r*d;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);var p=1/f;return e[0]=l*p,e[1]=(r*u-c*n)*p,e[2]=(o*n-r*a)*p,e[3]=h*p,e[4]=(c*t-r*s)*p,e[5]=(r*i-o*t)*p,e[6]=d*p,e[7]=(n*s-u*t)*p,e[8]=(a*t-n*i)*p,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,r,i,a,o){var s=Math.cos(i),u=Math.sin(i);return this.set(n*s,n*u,-n*(s*a+u*o)+a+e,-r*u,r*s,-r*(-u*a+s*o)+o+t,0,0,1),this}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],a=r[3],o=r[6],s=r[1],u=r[4],c=r[7];return r[0]=t*i+n*s,r[3]=t*a+n*u,r[6]=t*o+n*c,r[1]=-n*i+t*s,r[4]=-n*a+t*u,r[7]=-n*o+t*c,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}}]),e}();function Tn(e){for(var t=e.length-1;t>=0;--t)if(e[t]>65535)return!0;return!1}var Mn={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Cn(e,t){return new Mn[e](t)}function Dn(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function In(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Pn(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var Rn=(o={},Object(_.a)(o,un,Object(_.a)({},cn,In)),Object(_.a)(o,cn,Object(_.a)({},un,Pn)),o),Ln={legacyMode:!0,get workingColorSpace(){return cn},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(this.legacyMode||t===n||!t||!n)return e;if(Rn[t]&&void 0!==Rn[t][n]){var r=Rn[t][n];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},Nn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Bn={r:0,g:0,b:0},Fn={h:0,s:0,l:0},Un={h:0,s:0,l:0};function zn(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Vn(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var Gn=function(e){function t(e,n,r){return Object(E.a)(this,t),this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===n&&void 0===r?this.set(e):this.setRGB(e,n,r)}return Object(A.a)(t,[{key:"set",value:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:un;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Ln.toWorkingColorSpace(this,t),this}},{key:"setRGB",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:cn;return this.r=e,this.g=t,this.b=n,Ln.toWorkingColorSpace(this,r),this}},{key:"setHSL",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:cn;if(e=On(e,1),t=xn(t,0,1),n=xn(n,0,1),0===t)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+t):n+t-n*t,a=2*n-i;this.r=zn(a,i,e+1/3),this.g=zn(a,i,e),this.b=zn(a,i,e-1/3)}return Ln.toWorkingColorSpace(this,r),this}},{key:"setStyle",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:un;function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){var i,a=t[1],o=t[2];switch(a){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,Ln.toWorkingColorSpace(this,n),r(i[4]),this;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,Ln.toWorkingColorSpace(this,n),r(i[4]),this;break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){var s=parseFloat(i[1])/360,u=parseInt(i[2],10)/100,c=parseInt(i[3],10)/100;return r(i[4]),this.setHSL(s,u,c,n)}}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){var l=t[1],h=l.length;if(3===h)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,Ln.toWorkingColorSpace(this,n),this;if(6===h)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,Ln.toWorkingColorSpace(this,n),this}return e&&e.length>0?this.setColorName(e,n):this}},{key:"setColorName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:un,n=Nn[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copySRGBToLinear",value:function(e){return this.r=In(e.r),this.g=In(e.g),this.b=In(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=Pn(e.r),this.g=Pn(e.g),this.b=Pn(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:un;return Ln.fromWorkingColorSpace(Vn(this,Bn),e),xn(255*Bn.r,0,255)<<16^xn(255*Bn.g,0,255)<<8^xn(255*Bn.b,0,255)<<0}},{key:"getHexString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:un;return("000000"+this.getHex(e).toString(16)).slice(-6)}},{key:"getHSL",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cn;Ln.fromWorkingColorSpace(Vn(this,Bn),t);var n,r,i=Bn.r,a=Bn.g,o=Bn.b,s=Math.max(i,a,o),u=Math.min(i,a,o),c=(u+s)/2;if(u===s)n=0,r=0;else{var l=s-u;switch(r=c<=.5?l/(s+u):l/(2-s-u),s){case i:n=(a-o)/l+(a<o?6:0);break;case a:n=(o-i)/l+2;break;case o:n=(i-a)/l+4}n/=6}return e.h=n,e.s=r,e.l=c,e}},{key:"getRGB",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cn;return Ln.fromWorkingColorSpace(Vn(this,Bn),t),e.r=Bn.r,e.g=Bn.g,e.b=Bn.b,e}},{key:"getStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:un;return Ln.fromWorkingColorSpace(Vn(this,Bn),e),e!==un?"color(".concat(e," ").concat(Bn.r," ").concat(Bn.g," ").concat(Bn.b,")"):"rgb(".concat(255*Bn.r|0,",").concat(255*Bn.g|0,",").concat(255*Bn.b|0,")")}},{key:"offsetHSL",value:function(e,t,n){return this.getHSL(Fn),Fn.h+=e,Fn.s+=t,Fn.l+=n,this.setHSL(Fn.h,Fn.s,Fn.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(Fn),e.getHSL(Un);var n=kn(Fn.h,Un.h,t),r=kn(Fn.s,Un.s,t),i=kn(Fn.l,Un.l,t);return this.setHSL(n,r,i),this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}},{key:"toJSON",value:function(){return this.getHex()}},{key:e,value:Object(S.a)().mark((function e(){return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.r;case 2:return e.next=4,this.g;case 4:return e.next=6,this.b;case 6:case"end":return e.stop()}}),e,this)}))}]),t}(Symbol.iterator);Gn.NAMES=Nn;var Hn,Wn=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"getDataURL",value:function(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Hn&&(Hn=Dn("canvas")),Hn.width=e.width,Hn.height=e.height;var n=Hn.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Hn}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}},{key:"sRGBToLinear",value:function(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){var t=Dn("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);for(var r=n.getImageData(0,0,e.width,e.height),i=r.data,a=0;a<i.length;a++)i[a]=255*In(i[a]/255);return n.putImageData(r,0,0),t}if(e.data){for(var o=e.data.slice(0),s=0;s<o.length;s++)o instanceof Uint8Array||o instanceof Uint8ClampedArray?o[s]=Math.floor(255*In(o[s]/255)):o[s]=In(o[s]);return{data:o,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}]),e}(),qn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object(E.a)(this,e),this.isSource=!0,this.uuid=wn(),this.data=t,this.version=0}return Object(A.a)(e,[{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"toJSON",value:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];var n={uuid:this.uuid,url:""},r=this.data;if(null!==r){var i;if(Array.isArray(r)){i=[];for(var a=0,o=r.length;a<o;a++)r[a].isDataTexture?i.push(Yn(r[a].image)):i.push(Yn(r[a]))}else i=Yn(r);n.url=i}return t||(e.images[this.uuid]=n),n}}]),e}();function Yn(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?Wn.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Xn=0,Kn=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.DEFAULT_IMAGE,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.DEFAULT_MAPPING,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ye,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ye,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Je,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:et,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:pt,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:tt,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:tn;return Object(E.a)(this,n),(e=t.call(this)).isTexture=!0,Object.defineProperty(Object(x.a)(e),"id",{value:Xn++}),e.uuid=wn(),e.name="",e.source=new qn(r),e.mipmaps=[],e.mapping=i,e.wrapS=a,e.wrapT=o,e.magFilter=s,e.minFilter=u,e.anisotropy=h,e.format=c,e.internalFormat=null,e.type=l,e.offset=new An(0,0),e.repeat=new An(1,1),e.center=new An(0,0),e.rotation=0,e.matrixAutoUpdate=!0,e.matrix=new jn,e.generateMipmaps=!0,e.premultiplyAlpha=!1,e.flipY=!0,e.unpackAlignment=4,e.encoding=d,e.userData={},e.version=0,e.onUpdate=null,e.isRenderTargetTexture=!1,e.needsPMREMUpdate=!1,e}return Object(A.a)(n,[{key:"image",get:function(){return this.source.data},set:function(e){this.source.data=e}},{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}},{key:"toJSON",value:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case qe:e.x=e.x-Math.floor(e.x);break;case Ye:e.x=e.x<0?0:1;break;case Xe:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case qe:e.y=e.y-Math.floor(e.y);break;case Ye:e.y=e.y<0?0:1;break;case Xe:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}},{key:"needsUpdate",set:function(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}]),n}(vn);Kn.DEFAULT_IMAGE=null,Kn.DEFAULT_MAPPING=300;var Qn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(E.a)(this,t),t.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=i}return Object(A.a)(t,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}},{key:"set",value:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,r,i,a=e.elements,o=a[0],s=a[4],u=a[8],c=a[1],l=a[5],h=a[9],d=a[2],f=a[6],p=a[10];if(Math.abs(s-c)<.01&&Math.abs(u-d)<.01&&Math.abs(h-f)<.01){if(Math.abs(s+c)<.1&&Math.abs(u+d)<.1&&Math.abs(h+f)<.1&&Math.abs(o+l+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var v=(o+1)/2,m=(l+1)/2,g=(p+1)/2,y=(s+c)/4,b=(u+d)/4,w=(h+f)/4;return v>m&&v>g?v<.01?(n=0,r=.707106781,i=.707106781):(r=y/(n=Math.sqrt(v)),i=b/n):m>g?m<.01?(n=.707106781,r=0,i=.707106781):(n=y/(r=Math.sqrt(m)),i=w/r):g<.01?(n=.707106781,r=.707106781,i=0):(n=b/(i=Math.sqrt(g)),r=w/i),this.set(n,r,i,t),this}var x=Math.sqrt((f-h)*(f-h)+(u-d)*(u-d)+(c-s)*(c-s));return Math.abs(x)<.001&&(x=1),this.x=(f-h)/x,this.y=(u-d)/x,this.z=(c-s)/x,this.w=Math.acos((o+l+p-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:e,value:Object(S.a)().mark((function e(){return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:return e.next=8,this.w;case 8:case"end":return e.stop()}}),e,this)}))}]),t}(Symbol.iterator),Zn=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(E.a)(this,n),(i=t.call(this)).isWebGLRenderTarget=!0,i.width=e,i.height=r,i.depth=1,i.scissor=new Qn(0,0,e,r),i.scissorTest=!1,i.viewport=new Qn(0,0,e,r);var o={width:e,height:r,depth:1};return i.texture=new Kn(o,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),i.texture.isRenderTargetTexture=!0,i.texture.flipY=!1,i.texture.generateMipmaps=void 0!==a.generateMipmaps&&a.generateMipmaps,i.texture.internalFormat=void 0!==a.internalFormat?a.internalFormat:null,i.texture.minFilter=void 0!==a.minFilter?a.minFilter:Je,i.depthBuffer=void 0===a.depthBuffer||a.depthBuffer,i.stencilBuffer=void 0!==a.stencilBuffer&&a.stencilBuffer,i.depthTexture=void 0!==a.depthTexture?a.depthTexture:null,i.samples=void 0!==a.samples?a.samples:0,i}return Object(A.a)(n,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;var t=Object.assign({},e.texture.image);return this.texture.source=new qn(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(vn),Jn=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Object(E.a)(this,n),(e=t.call(this,null)).isDataArrayTexture=!0,e.image={data:r,width:i,height:a,depth:o},e.magFilter=Ke,e.minFilter=Ke,e.wrapR=Ye,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return Object(A.a)(n)}(Kn),$n=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Object(E.a)(this,n),(e=t.call(this,null)).isData3DTexture=!0,e.image={data:r,width:i,height:a,depth:o},e.magFilter=Ke,e.minFilter=Ke,e.wrapR=Ye,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return Object(A.a)(n)}(Kn),er=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(E.a)(this,t),this.isQuaternion=!0,this._x=e,this._y=n,this._z=r,this._w=i}return Object(A.a)(t,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,i=e._z,a=e._order,o=Math.cos,s=Math.sin,u=o(n/2),c=o(r/2),l=o(i/2),h=s(n/2),d=s(r/2),f=s(i/2);switch(a){case"XYZ":this._x=h*c*l+u*d*f,this._y=u*d*l-h*c*f,this._z=u*c*f+h*d*l,this._w=u*c*l-h*d*f;break;case"YXZ":this._x=h*c*l+u*d*f,this._y=u*d*l-h*c*f,this._z=u*c*f-h*d*l,this._w=u*c*l+h*d*f;break;case"ZXY":this._x=h*c*l-u*d*f,this._y=u*d*l+h*c*f,this._z=u*c*f+h*d*l,this._w=u*c*l-h*d*f;break;case"ZYX":this._x=h*c*l-u*d*f,this._y=u*d*l+h*c*f,this._z=u*c*f-h*d*l,this._w=u*c*l+h*d*f;break;case"YZX":this._x=h*c*l+u*d*f,this._y=u*d*l+h*c*f,this._z=u*c*f-h*d*l,this._w=u*c*l-h*d*f;break;case"XZY":this._x=h*c*l-u*d*f,this._y=u*d*l-h*c*f,this._z=u*c*f+h*d*l,this._w=u*c*l+h*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],o=t[5],s=t[9],u=t[2],c=t[6],l=t[10],h=n+o+l;if(h>0){var d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(c-s)*d,this._y=(i-u)*d,this._z=(a-r)*d}else if(n>o&&n>l){var f=2*Math.sqrt(1+n-o-l);this._w=(c-s)/f,this._x=.25*f,this._y=(r+a)/f,this._z=(i+u)/f}else if(o>l){var p=2*Math.sqrt(1+o-n-l);this._w=(i-u)/p,this._x=(r+a)/p,this._y=.25*p,this._z=(s+c)/p}else{var v=2*Math.sqrt(1+l-n-o);this._w=(a-r)/v,this._x=(i+u)/v,this._y=(s+c)/v,this._z=.25*v}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(xn(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,r=e._y,i=e._z,a=e._w,o=t._x,s=t._y,u=t._z,c=t._w;return this._x=n*c+a*o+r*u-i*s,this._y=r*c+a*s+i*o-n*u,this._z=i*c+a*u+n*s-r*o,this._w=a*c-n*o-r*s-i*u,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,a=this._w,o=a*e._w+n*e._x+r*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;var s=1-o*o;if(s<=Number.EPSILON){var u=1-t;return this._w=u*a+t*this._w,this._x=u*n+t*this._x,this._y=u*r+t*this._y,this._z=u*i+t*this._z,this.normalize(),this._onChangeCallback(),this}var c=Math.sqrt(s),l=Math.atan2(c,o),h=Math.sin((1-t)*l)/c,d=Math.sin(t*l)/c;return this._w=a*h+this._w*d,this._x=n*h+this._x*d,this._y=r*h+this._y*d,this._z=i*h+this._z*d,this._onChangeCallback(),this}},{key:"slerpQuaternions",value:function(e,t,n){return this.copy(e).slerp(t,n)}},{key:"random",value:function(){var e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(i),n*Math.cos(i),t*Math.sin(r))}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:e,value:Object(S.a)().mark((function e(){return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._w;case 8:case"end":return e.stop()}}),e,this)}))}],[{key:"slerp",value:function(e,t,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,r)}},{key:"slerpFlat",value:function(e,t,n,r,i,a,o){var s=n[r+0],u=n[r+1],c=n[r+2],l=n[r+3],h=i[a+0],d=i[a+1],f=i[a+2],p=i[a+3];if(0===o)return e[t+0]=s,e[t+1]=u,e[t+2]=c,void(e[t+3]=l);if(1===o)return e[t+0]=h,e[t+1]=d,e[t+2]=f,void(e[t+3]=p);if(l!==p||s!==h||u!==d||c!==f){var v=1-o,m=s*h+u*d+c*f+l*p,g=m>=0?1:-1,y=1-m*m;if(y>Number.EPSILON){var b=Math.sqrt(y),w=Math.atan2(b,m*g);v=Math.sin(v*w)/b,o=Math.sin(o*w)/b}var x=o*g;if(s=s*v+h*x,u=u*v+d*x,c=c*v+f*x,l=l*v+p*x,v===1-o){var O=1/Math.sqrt(s*s+u*u+c*c+l*l);s*=O,u*=O,c*=O,l*=O}}e[t]=s,e[t+1]=u,e[t+2]=c,e[t+3]=l}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,r,i,a){var o=n[r],s=n[r+1],u=n[r+2],c=n[r+3],l=i[a],h=i[a+1],d=i[a+2],f=i[a+3];return e[t]=o*f+c*l+s*d-u*h,e[t+1]=s*f+c*h+u*l-o*d,e[t+2]=u*f+c*d+o*h-s*l,e[t+3]=c*f-o*l-s*h-u*d,e}}]),t}(Symbol.iterator),tr=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(E.a)(this,t),t.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}return Object(A.a)(t,[{key:"set",value:function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(rr.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(rr.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,u=s*t+a*r-o*n,c=s*n+o*t-i*r,l=s*r+i*n-a*t,h=-i*t-a*n-o*r;return this.x=u*s+h*-i+c*-o-l*-a,this.y=c*s+h*-a+l*-i-u*-o,this.z=l*s+h*-o+u*-a-c*-i,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}},{key:"cross",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(e){return nr.copy(this).projectOnVector(e),this.sub(nr)}},{key:"reflect",value:function(e){return this.sub(nr.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(xn(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"setFromEuler",value:function(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}},{key:"randomDirection",value:function(){var e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-Math.pow(e,2));return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}},{key:e,value:Object(S.a)().mark((function e(){return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:case"end":return e.stop()}}),e,this)}))}]),t}(Symbol.iterator),nr=new tr,rr=new er,ir=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tr(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tr(-1/0,-1/0,-1/0);Object(E.a)(this,e),this.isBox3=!0,this.min=t,this.max=n}return Object(A.a)(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,u=e.length;s<u;s+=3){var c=e[s],l=e[s+1],h=e[s+2];c<t&&(t=c),l<n&&(n=l),h<r&&(r=h),c>i&&(i=c),l>a&&(a=l),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,u=e.count;s<u;s++){var c=e.getX(s),l=e.getY(s),h=e.getZ(s);c<t&&(t=c),l<n&&(n=l),h<r&&(r=h),c>i&&(i=c),l>a&&(a=l),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=or.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);var n=e.geometry;if(void 0!==n)if(t&&null!=n.attributes&&void 0!==n.attributes.position)for(var r=n.attributes.position,i=0,a=r.count;i<a;i++)or.fromBufferAttribute(r,i).applyMatrix4(e.matrixWorld),this.expandByPoint(or);else null===n.boundingBox&&n.computeBoundingBox(),sr.copy(n.boundingBox),sr.applyMatrix4(e.matrixWorld),this.union(sr);for(var o=e.children,s=0,u=o.length;s<u;s++)this.expandByObject(o[s],t);return this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,or),or.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(pr),vr.subVectors(this.max,pr),ur.subVectors(e.a,pr),cr.subVectors(e.b,pr),lr.subVectors(e.c,pr),hr.subVectors(cr,ur),dr.subVectors(lr,cr),fr.subVectors(ur,lr);var t=[0,-hr.z,hr.y,0,-dr.z,dr.y,0,-fr.z,fr.y,hr.z,0,-hr.x,dr.z,0,-dr.x,fr.z,0,-fr.x,-hr.y,hr.x,0,-dr.y,dr.x,0,-fr.y,fr.x,0];return!(!yr(t,ur,cr,lr,vr)||(t=[1,0,0,0,1,0,0,0,1],!yr(t,ur,cr,lr,vr)))&&(mr.crossVectors(hr,dr),yr(t=[mr.x,mr.y,mr.z],ur,cr,lr,vr))}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return or.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"getBoundingSphere",value:function(e){return this.getCenter(e.center),e.radius=.5*this.getSize(or).length(),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()||(ar[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ar[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ar[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ar[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ar[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ar[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ar[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ar[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ar)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),ar=[new tr,new tr,new tr,new tr,new tr,new tr,new tr,new tr],or=new tr,sr=new ir,ur=new tr,cr=new tr,lr=new tr,hr=new tr,dr=new tr,fr=new tr,pr=new tr,vr=new tr,mr=new tr,gr=new tr;function yr(e,t,n,r,i){for(var a=0,o=e.length-3;a<=o;a+=3){gr.fromArray(e,a);var s=i.x*Math.abs(gr.x)+i.y*Math.abs(gr.y)+i.z*Math.abs(gr.z),u=t.dot(gr),c=n.dot(gr),l=r.dot(gr);if(Math.max(-Math.max(u,c,l),Math.min(u,c,l))>s)return!1}return!0}var br=new ir,wr=new tr,xr=new tr,Or=new tr,kr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;Object(E.a)(this,e),this.center=t,this.radius=n}return Object(A.a)(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var n=this.center;void 0!==t?n.copy(t):br.setFromPoints(e).getCenter(n);for(var r=0,i=0,a=e.length;i<a;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"expandByPoint",value:function(e){Or.subVectors(e,this.center);var t=Or.lengthSq();if(t>this.radius*this.radius){var n=Math.sqrt(t),r=.5*(n-this.radius);this.center.add(Or.multiplyScalar(r/n)),this.radius+=r}return this}},{key:"union",value:function(e){return!0===this.center.equals(e.center)?xr.set(0,0,1).multiplyScalar(e.radius):xr.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(wr.copy(e.center).add(xr)),this.expandByPoint(wr.copy(e.center).sub(xr)),this}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),_r=new tr,Sr=new tr,Er=new tr,Ar=new tr,jr=new tr,Tr=new tr,Mr=new tr,Cr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tr(0,0,-1);Object(E.a)(this,e),this.origin=t,this.direction=n}return Object(A.a)(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,_r)),this}},{key:"closestPointToPoint",value:function(e,t){t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=_r.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(_r.copy(this.direction).multiplyScalar(t).add(this.origin),_r.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,n,r){Sr.copy(e).add(t).multiplyScalar(.5),Er.copy(t).sub(e).normalize(),Ar.copy(this.origin).sub(Sr);var i,a,o,s,u=.5*e.distanceTo(t),c=-this.direction.dot(Er),l=Ar.dot(this.direction),h=-Ar.dot(Er),d=Ar.lengthSq(),f=Math.abs(1-c*c);if(f>0)if(a=c*l-h,s=u*f,(i=c*h-l)>=0)if(a>=-s)if(a<=s){var p=1/f;o=(i*=p)*(i+c*(a*=p)+2*l)+a*(c*i+a+2*h)+d}else a=u,o=-(i=Math.max(0,-(c*a+l)))*i+a*(a+2*h)+d;else a=-u,o=-(i=Math.max(0,-(c*a+l)))*i+a*(a+2*h)+d;else a<=-s?o=-(i=Math.max(0,-(-c*u+l)))*i+(a=i>0?-u:Math.min(Math.max(-u,-h),u))*(a+2*h)+d:a<=s?(i=0,o=(a=Math.min(Math.max(-u,-h),u))*(a+2*h)+d):o=-(i=Math.max(0,-(c*u+l)))*i+(a=i>0?u:Math.min(Math.max(-u,-h),u))*(a+2*h)+d;else a=c>0?-u:u,o=-(i=Math.max(0,-(c*a+l)))*i+a*(a+2*h)+d;return n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(Er).multiplyScalar(a).add(Sr),o}},{key:"intersectSphere",value:function(e,t){_r.subVectors(e.center,this.origin);var n=_r.dot(this.direction),r=_r.dot(_r)-n*n,i=e.radius*e.radius;if(r>i)return null;var a=Math.sqrt(i-r),o=n-a,s=n+a;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}},{key:"intersectPlane",value:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}},{key:"intersectBox",value:function(e,t){var n,r,i,a,o,s,u=1/this.direction.x,c=1/this.direction.y,l=1/this.direction.z,h=this.origin;return u>=0?(n=(e.min.x-h.x)*u,r=(e.max.x-h.x)*u):(n=(e.max.x-h.x)*u,r=(e.min.x-h.x)*u),c>=0?(i=(e.min.y-h.y)*c,a=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,a=(e.min.y-h.y)*c),n>a||i>r||((i>n||n!==n)&&(n=i),(a<r||r!==r)&&(r=a),l>=0?(o=(e.min.z-h.z)*l,s=(e.max.z-h.z)*l):(o=(e.max.z-h.z)*l,s=(e.min.z-h.z)*l),n>s||o>r)||((o>n||n!==n)&&(n=o),(s<r||r!==r)&&(r=s),r<0)?null:this.at(n>=0?n:r,t)}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,_r)}},{key:"intersectTriangle",value:function(e,t,n,r,i){jr.subVectors(t,e),Tr.subVectors(n,e),Mr.crossVectors(jr,Tr);var a,o=this.direction.dot(Mr);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Ar.subVectors(this.origin,e);var s=a*this.direction.dot(Tr.crossVectors(Ar,Tr));if(s<0)return null;var u=a*this.direction.dot(jr.cross(Ar));if(u<0||s+u>o)return null;var c=-a*Ar.dot(Mr);return c<0?null:this.at(c/o,i)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),Dr=function(){function e(){Object(E.a)(this,e),e.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}return Object(A.a)(e,[{key:"set",value:function(e,t,n,r,i,a,o,s,u,c,l,h,d,f,p,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=i,m[5]=a,m[9]=o,m[13]=s,m[2]=u,m[6]=c,m[10]=l,m[14]=h,m[3]=d,m[7]=f,m[11]=p,m[15]=v,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,r=1/Ir.setFromMatrixColumn(e,0).length(),i=1/Ir.setFromMatrixColumn(e,1).length(),a=1/Ir.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(r),u=Math.sin(r),c=Math.cos(i),l=Math.sin(i);if("XYZ"===e.order){var h=a*c,d=a*l,f=o*c,p=o*l;t[0]=s*c,t[4]=-s*l,t[8]=u,t[1]=d+f*u,t[5]=h-p*u,t[9]=-o*s,t[2]=p-h*u,t[6]=f+d*u,t[10]=a*s}else if("YXZ"===e.order){var v=s*c,m=s*l,g=u*c,y=u*l;t[0]=v+y*o,t[4]=g*o-m,t[8]=a*u,t[1]=a*l,t[5]=a*c,t[9]=-o,t[2]=m*o-g,t[6]=y+v*o,t[10]=a*s}else if("ZXY"===e.order){var b=s*c,w=s*l,x=u*c,O=u*l;t[0]=b-O*o,t[4]=-a*l,t[8]=x+w*o,t[1]=w+x*o,t[5]=a*c,t[9]=O-b*o,t[2]=-a*u,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var k=a*c,_=a*l,S=o*c,E=o*l;t[0]=s*c,t[4]=S*u-_,t[8]=k*u+E,t[1]=s*l,t[5]=E*u+k,t[9]=_*u-S,t[2]=-u,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var A=a*s,j=a*u,T=o*s,M=o*u;t[0]=s*c,t[4]=M-A*l,t[8]=T*l+j,t[1]=l,t[5]=a*c,t[9]=-o*c,t[2]=-u*c,t[6]=j*l+T,t[10]=A-M*l}else if("XZY"===e.order){var C=a*s,D=a*u,I=o*s,P=o*u;t[0]=s*c,t[4]=-l,t[8]=u*c,t[1]=C*l+P,t[5]=a*c,t[9]=D*l-I,t[2]=I*l-D,t[6]=o*c,t[10]=P*l+C}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(Rr,e,Lr)}},{key:"lookAt",value:function(e,t,n){var r=this.elements;return Fr.subVectors(e,t),0===Fr.lengthSq()&&(Fr.z=1),Fr.normalize(),Nr.crossVectors(n,Fr),0===Nr.lengthSq()&&(1===Math.abs(n.z)?Fr.x+=1e-4:Fr.z+=1e-4,Fr.normalize(),Nr.crossVectors(n,Fr)),Nr.normalize(),Br.crossVectors(Fr,Nr),r[0]=Nr.x,r[4]=Br.x,r[8]=Fr.x,r[1]=Nr.y,r[5]=Br.y,r[9]=Fr.y,r[2]=Nr.z,r[6]=Br.z,r[10]=Fr.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],u=n[12],c=n[1],l=n[5],h=n[9],d=n[13],f=n[2],p=n[6],v=n[10],m=n[14],g=n[3],y=n[7],b=n[11],w=n[15],x=r[0],O=r[4],k=r[8],_=r[12],S=r[1],E=r[5],A=r[9],j=r[13],T=r[2],M=r[6],C=r[10],D=r[14],I=r[3],P=r[7],R=r[11],L=r[15];return i[0]=a*x+o*S+s*T+u*I,i[4]=a*O+o*E+s*M+u*P,i[8]=a*k+o*A+s*C+u*R,i[12]=a*_+o*j+s*D+u*L,i[1]=c*x+l*S+h*T+d*I,i[5]=c*O+l*E+h*M+d*P,i[9]=c*k+l*A+h*C+d*R,i[13]=c*_+l*j+h*D+d*L,i[2]=f*x+p*S+v*T+m*I,i[6]=f*O+p*E+v*M+m*P,i[10]=f*k+p*A+v*C+m*R,i[14]=f*_+p*j+v*D+m*L,i[3]=g*x+y*S+b*T+w*I,i[7]=g*O+y*E+b*M+w*P,i[11]=g*k+y*A+b*C+w*R,i[15]=g*_+y*j+b*D+w*L,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],o=e[5],s=e[9],u=e[13],c=e[2],l=e[6],h=e[10],d=e[14];return e[3]*(+i*s*l-r*u*l-i*o*h+n*u*h+r*o*d-n*s*d)+e[7]*(+t*s*d-t*u*h+i*a*h-r*a*d+r*u*c-i*s*c)+e[11]*(+t*u*l-t*o*d-i*a*l+n*a*d+i*o*c-n*u*c)+e[15]*(-r*o*c-t*s*l+t*o*h+r*a*l-n*a*h+n*s*c)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],c=e[8],l=e[9],h=e[10],d=e[11],f=e[12],p=e[13],v=e[14],m=e[15],g=l*v*u-p*h*u+p*s*d-o*v*d-l*s*m+o*h*m,y=f*h*u-c*v*u-f*s*d+a*v*d+c*s*m-a*h*m,b=c*p*u-f*l*u+f*o*d-a*p*d-c*o*m+a*l*m,w=f*l*s-c*p*s-f*o*h+a*p*h+c*o*v-a*l*v,x=t*g+n*y+r*b+i*w;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var O=1/x;return e[0]=g*O,e[1]=(p*h*i-l*v*i-p*r*d+n*v*d+l*r*m-n*h*m)*O,e[2]=(o*v*i-p*s*i+p*r*u-n*v*u-o*r*m+n*s*m)*O,e[3]=(l*s*i-o*h*i-l*r*u+n*h*u+o*r*d-n*s*d)*O,e[4]=y*O,e[5]=(c*v*i-f*h*i+f*r*d-t*v*d-c*r*m+t*h*m)*O,e[6]=(f*s*i-a*v*i-f*r*u+t*v*u+a*r*m-t*s*m)*O,e[7]=(a*h*i-c*s*i+c*r*u-t*h*u-a*r*d+t*s*d)*O,e[8]=b*O,e[9]=(f*l*i-c*p*i-f*n*d+t*p*d+c*n*m-t*l*m)*O,e[10]=(a*p*i-f*o*i+f*n*u-t*p*u-a*n*m+t*o*m)*O,e[11]=(c*o*i-a*l*i-c*n*u+t*l*u+a*n*d-t*o*d)*O,e[12]=w*O,e[13]=(c*p*r-f*l*r+f*n*h-t*p*h-c*n*v+t*l*v)*O,e[14]=(f*o*r-a*p*r-f*n*s+t*p*s+a*n*v-t*o*v)*O,e[15]=(a*l*r-c*o*r+c*n*s-t*l*s-a*n*h+t*o*h)*O,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,o=e.y,s=e.z,u=i*a,c=i*o;return this.set(u*a+n,u*o-r*s,u*s+r*o,0,u*o+r*s,c*o+n,c*s-r*a,0,u*s-r*o,c*s+r*a,i*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n,r,i,a){return this.set(1,n,i,0,e,1,a,0,t,r,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var r=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,u=i+i,c=a+a,l=o+o,h=i*u,d=i*c,f=i*l,p=a*c,v=a*l,m=o*l,g=s*u,y=s*c,b=s*l,w=n.x,x=n.y,O=n.z;return r[0]=(1-(p+m))*w,r[1]=(d+b)*w,r[2]=(f-y)*w,r[3]=0,r[4]=(d-b)*x,r[5]=(1-(h+m))*x,r[6]=(v+g)*x,r[7]=0,r[8]=(f+y)*O,r[9]=(v-g)*O,r[10]=(1-(h+p))*O,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}},{key:"decompose",value:function(e,t,n){var r=this.elements,i=Ir.set(r[0],r[1],r[2]).length(),a=Ir.set(r[4],r[5],r[6]).length(),o=Ir.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],Pr.copy(this);var s=1/i,u=1/a,c=1/o;return Pr.elements[0]*=s,Pr.elements[1]*=s,Pr.elements[2]*=s,Pr.elements[4]*=u,Pr.elements[5]*=u,Pr.elements[6]*=u,Pr.elements[8]*=c,Pr.elements[9]*=c,Pr.elements[10]*=c,t.setFromRotationMatrix(Pr),n.x=i,n.y=a,n.z=o,this}},{key:"makePerspective",value:function(e,t,n,r,i,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*i/(t-e),u=2*i/(n-r),c=(t+e)/(t-e),l=(n+r)/(n-r),h=-(a+i)/(a-i),d=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=u,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,r,i,a){var o=this.elements,s=1/(t-e),u=1/(n-r),c=1/(a-i),l=(t+e)*s,h=(n+r)*u,d=(a+i)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-l,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}]),e}(),Ir=new tr,Pr=new Dr,Rr=new tr(0,0,0),Lr=new tr(1,1,1),Nr=new tr,Br=new tr,Fr=new tr,Ur=new Dr,zr=new er,Vr=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DefaultOrder;Object(E.a)(this,t),this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=i}return Object(A.a)(t,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.elements,i=r[0],a=r[4],o=r[8],s=r[1],u=r[5],c=r[9],l=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(xn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(h,u),this._z=0);break;case"YXZ":this._x=Math.asin(-xn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(s,u)):(this._y=Math.atan2(-l,i),this._z=0);break;case"ZXY":this._x=Math.asin(xn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-l,d),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-xn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(xn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-l,i)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-xn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,u),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,n){return Ur.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Ur,t,n)}},{key:"setFromVector3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return zr.setFromEuler(this),this.setFromQuaternion(zr,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:e,value:Object(S.a)().mark((function e(){return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._order;case 8:case"end":return e.stop()}}),e,this)}))},{key:"toVector3",value:function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}]),t}(Symbol.iterator);Vr.DefaultOrder="XYZ",Vr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var Gr=function(){function e(){Object(E.a)(this,e),this.mask=1}return Object(A.a)(e,[{key:"set",value:function(e){this.mask=(1<<e|0)>>>0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return 0!==(this.mask&e.mask)}},{key:"isEnabled",value:function(e){return 0!==(this.mask&(1<<e|0))}}]),e}(),Hr=0,Wr=new tr,qr=new er,Yr=new Dr,Xr=new tr,Kr=new tr,Qr=new tr,Zr=new er,Jr=new tr(1,0,0),$r=new tr(0,1,0),ei=new tr(0,0,1),ti={type:"added"},ni={type:"removed"},ri=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;Object(E.a)(this,n),(e=t.call(this)).isObject3D=!0,Object.defineProperty(Object(x.a)(e),"id",{value:Hr++}),e.uuid=wn(),e.name="",e.type="Object3D",e.parent=null,e.children=[],e.up=n.DefaultUp.clone();var r=new tr,i=new Vr,a=new er,o=new tr(1,1,1);return i._onChange((function(){a.setFromEuler(i,!1)})),a._onChange((function(){i.setFromQuaternion(a,void 0,!1)})),Object.defineProperties(Object(x.a)(e),{position:{configurable:!0,enumerable:!0,value:r},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:a},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new Dr},normalMatrix:{value:new jn}}),e.matrix=new Dr,e.matrixWorld=new Dr,e.matrixAutoUpdate=n.DefaultMatrixAutoUpdate,e.matrixWorldNeedsUpdate=!1,e.layers=new Gr,e.visible=!0,e.castShadow=!1,e.receiveShadow=!1,e.frustumCulled=!0,e.renderOrder=0,e.animations=[],e.userData={},e}return Object(A.a)(n,[{key:"onBeforeRender",value:function(){}},{key:"onAfterRender",value:function(){}},{key:"applyMatrix4",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function(e){return this.quaternion.premultiply(e),this}},{key:"setRotationFromAxisAngle",value:function(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function(e,t){return qr.setFromAxisAngle(e,t),this.quaternion.multiply(qr),this}},{key:"rotateOnWorldAxis",value:function(e,t){return qr.setFromAxisAngle(e,t),this.quaternion.premultiply(qr),this}},{key:"rotateX",value:function(e){return this.rotateOnAxis(Jr,e)}},{key:"rotateY",value:function(e){return this.rotateOnAxis($r,e)}},{key:"rotateZ",value:function(e){return this.rotateOnAxis(ei,e)}},{key:"translateOnAxis",value:function(e,t){return Wr.copy(e).applyQuaternion(this.quaternion),this.position.add(Wr.multiplyScalar(t)),this}},{key:"translateX",value:function(e){return this.translateOnAxis(Jr,e)}},{key:"translateY",value:function(e){return this.translateOnAxis($r,e)}},{key:"translateZ",value:function(e){return this.translateOnAxis(ei,e)}},{key:"localToWorld",value:function(e){return e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(e){return e.applyMatrix4(Yr.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function(e,t,n){e.isVector3?Xr.copy(e):Xr.set(e,t,n);var r=this.parent;this.updateWorldMatrix(!0,!1),Kr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Yr.lookAt(Kr,Xr,this.up):Yr.lookAt(Xr,Kr,this.up),this.quaternion.setFromRotationMatrix(Yr),r&&(Yr.extractRotation(r.matrixWorld),qr.setFromRotationMatrix(Yr),this.quaternion.premultiply(qr.invert()))}},{key:"add",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ti)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}},{key:"remove",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(ni)),this}},{key:"removeFromParent",value:function(){var e=this.parent;return null!==e&&e.remove(this),this}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t.parent=null,t.dispatchEvent(ni)}return this.children.length=0,this}},{key:"attach",value:function(e){return this.updateWorldMatrix(!0,!1),Yr.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Yr.multiply(e.parent.matrixWorld)),e.applyMatrix4(Yr),this.add(e),e.updateWorldMatrix(!1,!0),this}},{key:"getObjectById",value:function(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}},{key:"getWorldPosition",value:function(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Kr,e,Qr),e}},{key:"getWorldScale",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Kr,Zr,e),e}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}},{key:"raycast",value:function(){}},{key:"traverse",value:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)}},{key:"traverseVisible",value:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}}},{key:"traverseAncestors",value:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}},{key:"updateWorldMatrix",value:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,i=0,a=r.length;i<a;i++)r[i].updateWorldMatrix(!1,!0)}},{key:"toJSON",value:function(e){var t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,u=o.length;s<u;s++){var c=o[s];i(e.shapes,c)}else i(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var l=[],h=0,d=this.material.length;h<d;h++)l.push(i(e.materials,this.material[h]));r.material=l}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(var f=0;f<this.children.length;f++)r.children.push(this.children[f].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(var p=0;p<this.animations.length;p++){var v=this.animations[p];r.animations.push(i(e.animations,v))}}if(t){var m=_(e.geometries),g=_(e.materials),y=_(e.textures),b=_(e.images),w=_(e.shapes),x=_(e.skeletons),O=_(e.animations),k=_(e.nodes);m.length>0&&(n.geometries=m),g.length>0&&(n.materials=g),y.length>0&&(n.textures=y),b.length>0&&(n.images=b),w.length>0&&(n.shapes=w),x.length>0&&(n.skeletons=x),O.length>0&&(n.animations=O),k.length>0&&(n.nodes=k)}return n.object=r,n;function _(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}}},{key:"clone",value:function(e){return(new this.constructor).copy(this,e)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}}]),n}(vn);ri.DefaultUp=new tr(0,1,0),ri.DefaultMatrixAutoUpdate=!0;var ii=new tr,ai=new tr,oi=new tr,si=new tr,ui=new tr,ci=new tr,li=new tr,hi=new tr,di=new tr,fi=new tr,pi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tr,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new tr;Object(E.a)(this,e),this.a=t,this.b=n,this.c=r}return Object(A.a)(e,[{key:"set",value:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}},{key:"setFromAttributeAndIndices",value:function(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return ii.subVectors(this.c,this.b),ai.subVectors(this.a,this.b),.5*ii.cross(ai).length()}},{key:"getMidpoint",value:function(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(t,n){return e.getBarycoord(t,this.a,this.b,this.c,n)}},{key:"getUV",value:function(t,n,r,i,a){return e.getUV(t,this.a,this.b,this.c,n,r,i,a)}},{key:"containsPoint",value:function(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){var n,r,i=this.a,a=this.b,o=this.c;ui.subVectors(a,i),ci.subVectors(o,i),hi.subVectors(e,i);var s=ui.dot(hi),u=ci.dot(hi);if(s<=0&&u<=0)return t.copy(i);di.subVectors(e,a);var c=ui.dot(di),l=ci.dot(di);if(c>=0&&l<=c)return t.copy(a);var h=s*l-c*u;if(h<=0&&s>=0&&c<=0)return n=s/(s-c),t.copy(i).addScaledVector(ui,n);fi.subVectors(e,o);var d=ui.dot(fi),f=ci.dot(fi);if(f>=0&&d<=f)return t.copy(o);var p=d*u-s*f;if(p<=0&&u>=0&&f<=0)return r=u/(u-f),t.copy(i).addScaledVector(ci,r);var v=c*f-d*l;if(v<=0&&l-c>=0&&d-f>=0)return li.subVectors(o,a),r=(l-c)/(l-c+(d-f)),t.copy(a).addScaledVector(li,r);var m=1/(v+p+h);return n=p*m,r=h*m,t.copy(i).addScaledVector(ui,n).addScaledVector(ci,r)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,n,r){r.subVectors(n,t),ii.subVectors(e,t),r.cross(ii);var i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,n,r,i){ii.subVectors(r,t),ai.subVectors(n,t),oi.subVectors(e,t);var a=ii.dot(ii),o=ii.dot(ai),s=ii.dot(oi),u=ai.dot(ai),c=ai.dot(oi),l=a*u-o*o;if(0===l)return i.set(-2,-1,-1);var h=1/l,d=(u*s-o*c)*h,f=(a*c-o*s)*h;return i.set(1-d-f,f,d)}},{key:"containsPoint",value:function(e,t,n,r){return this.getBarycoord(e,t,n,r,si),si.x>=0&&si.y>=0&&si.x+si.y<=1}},{key:"getUV",value:function(e,t,n,r,i,a,o,s){return this.getBarycoord(e,t,n,r,si),s.set(0,0),s.addScaledVector(i,si.x),s.addScaledVector(a,si.y),s.addScaledVector(o,si.z),s}},{key:"isFrontFacing",value:function(e,t,n,r){return ii.subVectors(n,t),ai.subVectors(e,t),ii.cross(ai).dot(r)<0}}]),e}(),vi=0,mi=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this)).isMaterial=!0,Object.defineProperty(Object(x.a)(e),"id",{value:vi++}),e.uuid=wn(),e.name="",e.type="Material",e.blending=re,e.side=$,e.vertexColors=!1,e.opacity=1,e.transparent=!1,e.blendSrc=ge,e.blendDst=ye,e.blendEquation=ue,e.blendSrcAlpha=null,e.blendDstAlpha=null,e.blendEquationAlpha=null,e.depthFunc=Ae,e.depthTest=!0,e.depthWrite=!0,e.stencilWriteMask=255,e.stencilFunc=hn,e.stencilRef=0,e.stencilFuncMask=255,e.stencilFail=ln,e.stencilZFail=ln,e.stencilZPass=ln,e.stencilWrite=!1,e.clippingPlanes=null,e.clipIntersection=!1,e.clipShadows=!1,e.shadowSide=null,e.colorWrite=!0,e.precision=null,e.polygonOffset=!1,e.polygonOffsetFactor=0,e.polygonOffsetUnits=0,e.dithering=!1,e.alphaToCoverage=!1,e.premultipliedAlpha=!1,e.visible=!0,e.toneMapped=!0,e.userData={},e.version=0,e._alphaTest=0,e}return Object(A.a)(n,[{key:"alphaTest",get:function(){return this._alphaTest},set:function(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}},{key:"onBuild",value:function(){}},{key:"onBeforeRender",value:function(){}},{key:"onBeforeCompile",value:function(){}},{key:"customProgramCacheKey",value:function(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==re&&(n.blending=this.blending),this.side!==$&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var i=r(e.textures),a=r(e.images);i.length>0&&(n.textures=i),a.length>0&&(n.images=a)}return n}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}}]),n}(vn),gi=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this)).isMeshBasicMaterial=!0,r.type="MeshBasicMaterial",r.color=new Gn(16777215),r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=De,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.fog=!0,r.setValues(e),r}return Object(A.a)(n,[{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}]),n}(mi),yi=new tr,bi=new An,wi=function(){function e(t,n,r){if(Object(E.a)(this,e),Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=n,this.count=void 0!==t?t.length/n:0,this.normalized=!0===r,this.usage=dn,this.updateRange={offset:0,count:-1},this.version=0}return Object(A.a)(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}},{key:"copyArray",value:function(e){return this.array.set(e),this}},{key:"copyColorsArray",value:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),a=new Gn),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this}},{key:"copyVector2sArray",value:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),a=new An),t[n++]=a.x,t[n++]=a.y}return this}},{key:"copyVector3sArray",value:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),a=new tr),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this}},{key:"copyVector4sArray",value:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),a=new Qn),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z,t[n++]=a.w}return this}},{key:"applyMatrix3",value:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)bi.fromBufferAttribute(this,t),bi.applyMatrix3(e),this.setXY(t,bi.x,bi.y);else if(3===this.itemSize)for(var r=0,i=this.count;r<i;r++)yi.fromBufferAttribute(this,r),yi.applyMatrix3(e),this.setXYZ(r,yi.x,yi.y,yi.z);return this}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.count;t<n;t++)yi.fromBufferAttribute(this,t),yi.applyMatrix4(e),this.setXYZ(t,yi.x,yi.y,yi.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)yi.fromBufferAttribute(this,t),yi.applyNormalMatrix(e),this.setXYZ(t,yi.x,yi.y,yi.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)yi.fromBufferAttribute(this,t),yi.transformDirection(e),this.setXYZ(t,yi.x,yi.y,yi.z);return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"getX",value:function(e){return this.array[e*this.itemSize]}},{key:"setX",value:function(e,t){return this.array[e*this.itemSize]=t,this}},{key:"getY",value:function(e){return this.array[e*this.itemSize+1]}},{key:"setY",value:function(e,t){return this.array[e*this.itemSize+1]=t,this}},{key:"getZ",value:function(e){return this.array[e*this.itemSize+2]}},{key:"setZ",value:function(e,t){return this.array[e*this.itemSize+2]=t,this}},{key:"getW",value:function(e){return this.array[e*this.itemSize+3]}},{key:"setW",value:function(e,t){return this.array[e*this.itemSize+3]=t,this}},{key:"setXY",value:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}},{key:"setXYZW",value:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"clone",value:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==dn&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}}]),e}(),xi=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){return Object(E.a)(this,n),t.call(this,new Uint16Array(e),r,i)}return Object(A.a)(n)}(wi),Oi=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){return Object(E.a)(this,n),t.call(this,new Uint32Array(e),r,i)}return Object(A.a)(n)}(wi),ki=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;return Object(E.a)(this,n),(a=t.call(this,new Uint16Array(e),r,i)).isFloat16BufferAttribute=!0,a}return Object(A.a)(n)}(wi),_i=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){return Object(E.a)(this,n),t.call(this,new Float32Array(e),r,i)}return Object(A.a)(n)}(wi),Si=0,Ei=new Dr,Ai=new ri,ji=new tr,Ti=new ir,Mi=new ir,Ci=new tr,Di=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this)).isBufferGeometry=!0,Object.defineProperty(Object(x.a)(e),"id",{value:Si++}),e.uuid=wn(),e.name="",e.type="BufferGeometry",e.index=null,e.attributes={},e.morphAttributes={},e.morphTargetsRelative=!1,e.groups=[],e.boundingBox=null,e.boundingSphere=null,e.drawRange={start:0,count:1/0},e.userData={},e}return Object(A.a)(n,[{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(e){return Array.isArray(e)?this.index=new(Tn(e)?Oi:xi)(e,1):this.index=e,this}},{key:"getAttribute",value:function(e){return this.attributes[e]}},{key:"setAttribute",value:function(e,t){return this.attributes[e]=t,this}},{key:"deleteAttribute",value:function(e){return delete this.attributes[e],this}},{key:"hasAttribute",value:function(e){return void 0!==this.attributes[e]}},{key:"addGroup",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}},{key:"clearGroups",value:function(){this.groups=[]}},{key:"setDrawRange",value:function(e,t){this.drawRange.start=e,this.drawRange.count=t}},{key:"applyMatrix4",value:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new jn).getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"applyQuaternion",value:function(e){return Ei.makeRotationFromQuaternion(e),this.applyMatrix4(Ei),this}},{key:"rotateX",value:function(e){return Ei.makeRotationX(e),this.applyMatrix4(Ei),this}},{key:"rotateY",value:function(e){return Ei.makeRotationY(e),this.applyMatrix4(Ei),this}},{key:"rotateZ",value:function(e){return Ei.makeRotationZ(e),this.applyMatrix4(Ei),this}},{key:"translate",value:function(e,t,n){return Ei.makeTranslation(e,t,n),this.applyMatrix4(Ei),this}},{key:"scale",value:function(e,t,n){return Ei.makeScale(e,t,n),this.applyMatrix4(Ei),this}},{key:"lookAt",value:function(e){return Ai.lookAt(e),Ai.updateMatrix(),this.applyMatrix4(Ai.matrix),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ji).negate(),this.translate(ji.x,ji.y,ji.z),this}},{key:"setFromPoints",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new _i(t,3)),this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new ir);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new tr(-1/0,-1/0,-1/0),new tr(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,r=t.length;n<r;n++){var i=t[n];Ti.setFromBufferAttribute(i),this.morphTargetsRelative?(Ci.addVectors(this.boundingBox.min,Ti.min),this.boundingBox.expandByPoint(Ci),Ci.addVectors(this.boundingBox.max,Ti.max),this.boundingBox.expandByPoint(Ci)):(this.boundingBox.expandByPoint(Ti.min),this.boundingBox.expandByPoint(Ti.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new kr);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new tr,1/0);if(e){var n=this.boundingSphere.center;if(Ti.setFromBufferAttribute(e),t)for(var r=0,i=t.length;r<i;r++){var a=t[r];Mi.setFromBufferAttribute(a),this.morphTargetsRelative?(Ci.addVectors(Ti.min,Mi.min),Ti.expandByPoint(Ci),Ci.addVectors(Ti.max,Mi.max),Ti.expandByPoint(Ci)):(Ti.expandByPoint(Mi.min),Ti.expandByPoint(Mi.max))}Ti.getCenter(n);for(var o=0,s=0,u=e.count;s<u;s++)Ci.fromBufferAttribute(e,s),o=Math.max(o,n.distanceToSquared(Ci));if(t)for(var c=0,l=t.length;c<l;c++)for(var h=t[c],d=this.morphTargetsRelative,f=0,p=h.count;f<p;f++)Ci.fromBufferAttribute(h,f),d&&(ji.fromBufferAttribute(e,f),Ci.add(ji)),o=Math.max(o,n.distanceToSquared(Ci));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}},{key:"computeTangents",value:function(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var n=e.array,r=t.position.array,i=t.normal.array,a=t.uv.array,o=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new wi(new Float32Array(4*o),4));for(var s=this.getAttribute("tangent").array,u=[],c=[],l=0;l<o;l++)u[l]=new tr,c[l]=new tr;var h=new tr,d=new tr,f=new tr,p=new An,v=new An,m=new An,g=new tr,y=new tr,b=this.groups;0===b.length&&(b=[{start:0,count:n.length}]);for(var w=0,x=b.length;w<x;++w)for(var O=b[w],k=O.start,_=k,S=k+O.count;_<S;_+=3)L(n[_+0],n[_+1],n[_+2]);for(var E=new tr,A=new tr,j=new tr,T=new tr,M=0,C=b.length;M<C;++M)for(var D=b[M],I=D.start,P=I,R=I+D.count;P<R;P+=3)N(n[P+0]),N(n[P+1]),N(n[P+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function L(e,t,n){h.fromArray(r,3*e),d.fromArray(r,3*t),f.fromArray(r,3*n),p.fromArray(a,2*e),v.fromArray(a,2*t),m.fromArray(a,2*n),d.sub(h),f.sub(h),v.sub(p),m.sub(p);var i=1/(v.x*m.y-m.x*v.y);!isFinite(i)||(g.copy(d).multiplyScalar(m.y).addScaledVector(f,-v.y).multiplyScalar(i),y.copy(f).multiplyScalar(v.x).addScaledVector(d,-m.x).multiplyScalar(i),u[e].add(g),u[t].add(g),u[n].add(g),c[e].add(y),c[t].add(y),c[n].add(y))}function N(e){j.fromArray(i,3*e),T.copy(j);var t=u[e];E.copy(t),E.sub(j.multiplyScalar(j.dot(t))).normalize(),A.crossVectors(T,t);var n=A.dot(c[e])<0?-1:1;s[4*e]=E.x,s[4*e+1]=E.y,s[4*e+2]=E.z,s[4*e+3]=n}}},{key:"computeVertexNormals",value:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new wi(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var r=0,i=n.count;r<i;r++)n.setXYZ(r,0,0,0);var a=new tr,o=new tr,s=new tr,u=new tr,c=new tr,l=new tr,h=new tr,d=new tr;if(e)for(var f=0,p=e.count;f<p;f+=3){var v=e.getX(f+0),m=e.getX(f+1),g=e.getX(f+2);a.fromBufferAttribute(t,v),o.fromBufferAttribute(t,m),s.fromBufferAttribute(t,g),h.subVectors(s,o),d.subVectors(a,o),h.cross(d),u.fromBufferAttribute(n,v),c.fromBufferAttribute(n,m),l.fromBufferAttribute(n,g),u.add(h),c.add(h),l.add(h),n.setXYZ(v,u.x,u.y,u.z),n.setXYZ(m,c.x,c.y,c.z),n.setXYZ(g,l.x,l.y,l.z)}else for(var y=0,b=t.count;y<b;y+=3)a.fromBufferAttribute(t,y+0),o.fromBufferAttribute(t,y+1),s.fromBufferAttribute(t,y+2),h.subVectors(s,o),d.subVectors(a,o),h.cross(d),n.setXYZ(y+0,h.x,h.y,h.z),n.setXYZ(y+1,h.x,h.y,h.z),n.setXYZ(y+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}},{key:"merge",value:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==e.attributes[r])for(var i=n[r].array,a=e.attributes[r],o=a.array,s=a.itemSize*t,u=Math.min(o.length,i.length-s),c=0,l=s;c<u;c++,l++)i[l]=o[c];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)}},{key:"normalizeNormals",value:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)Ci.fromBufferAttribute(e,t),Ci.normalize(),e.setXYZ(t,Ci.x,Ci.y,Ci.z)}},{key:"toNonIndexed",value:function(){function e(e,t){for(var n=e.array,r=e.itemSize,i=e.normalized,a=new n.constructor(t.length*r),o=0,s=0,u=0,c=t.length;u<c;u++){o=e.isInterleavedBufferAttribute?t[u]*e.data.stride+e.offset:t[u]*r;for(var l=0;l<r;l++)a[s++]=n[o++]}return new wi(a,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var t=new n,r=this.index.array,i=this.attributes;for(var a in i){var o=e(i[a],r);t.setAttribute(a,o)}var s=this.morphAttributes;for(var u in s){for(var c=[],l=s[u],h=0,d=l.length;h<d;h++){var f=e(l[h],r);c.push(f)}t.morphAttributes[u]=c}t.morphTargetsRelative=this.morphTargetsRelative;for(var p=this.groups,v=0,m=p.length;v<m;v++){var g=p[v];t.addGroup(g.start,g.count,g.materialIndex)}return t}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var i=this.attributes;for(var a in i){var o=i[a];e.data.attributes[a]=o.toJSON(e.data)}var s={},u=!1;for(var c in this.morphAttributes){for(var l=this.morphAttributes[c],h=[],d=0,f=l.length;d<f;d++){var p=l[d];h.push(p.toJSON(e.data))}h.length>0&&(s[c]=h,u=!0)}u&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);var v=this.groups;v.length>0&&(e.data.groups=JSON.parse(JSON.stringify(v)));var m=this.boundingSphere;return null!==m&&(e.data.boundingSphere={center:m.center.toArray(),radius:m.radius}),e}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var r=e.attributes;for(var i in r){var a=r[i];this.setAttribute(i,a.clone(t))}var o=e.morphAttributes;for(var s in o){for(var u=[],c=o[s],l=0,h=c.length;l<h;l++)u.push(c[l].clone(t));this.morphAttributes[s]=u}this.morphTargetsRelative=e.morphTargetsRelative;for(var d=e.groups,f=0,p=d.length;f<p;f++){var v=d[f];this.addGroup(v.start,v.count,v.materialIndex)}var m=e.boundingBox;null!==m&&(this.boundingBox=m.clone());var g=e.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(vn),Ii=new Dr,Pi=new Cr,Ri=new kr,Li=new tr,Ni=new tr,Bi=new tr,Fi=new tr,Ui=new tr,zi=new tr,Vi=new tr,Gi=new tr,Hi=new tr,Wi=new An,qi=new An,Yi=new An,Xi=new tr,Ki=new tr,Qi=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Di,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new gi;return Object(E.a)(this,n),(e=t.call(this)).isMesh=!0,e.type="Mesh",e.geometry=r,e.material=i,e.updateMorphTargets(),e}return Object(A.a)(n,[{key:"copy",value:function(e,t){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,i=n.length;r<i;r++){var a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}},{key:"raycast",value:function(e,t){var n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r&&(null===n.boundingSphere&&n.computeBoundingSphere(),Ri.copy(n.boundingSphere),Ri.applyMatrix4(i),!1!==e.ray.intersectsSphere(Ri))&&(Ii.copy(i).invert(),Pi.copy(e.ray).applyMatrix4(Ii),null===n.boundingBox||!1!==Pi.intersectsBox(n.boundingBox))){var a,o=n.index,s=n.attributes.position,u=n.morphAttributes.position,c=n.morphTargetsRelative,l=n.attributes.uv,h=n.attributes.uv2,d=n.groups,f=n.drawRange;if(null!==o)if(Array.isArray(r))for(var p=0,v=d.length;p<v;p++)for(var m=d[p],g=r[m.materialIndex],y=Math.max(m.start,f.start),b=Math.min(o.count,Math.min(m.start+m.count,f.start+f.count));y<b;y+=3){var w=o.getX(y),x=o.getX(y+1),O=o.getX(y+2);(a=Zi(this,g,e,Pi,s,u,c,l,h,w,x,O))&&(a.faceIndex=Math.floor(y/3),a.face.materialIndex=m.materialIndex,t.push(a))}else for(var k=Math.max(0,f.start),_=Math.min(o.count,f.start+f.count);k<_;k+=3){var S=o.getX(k),E=o.getX(k+1),A=o.getX(k+2);(a=Zi(this,r,e,Pi,s,u,c,l,h,S,E,A))&&(a.faceIndex=Math.floor(k/3),t.push(a))}else if(void 0!==s)if(Array.isArray(r))for(var j=0,T=d.length;j<T;j++)for(var M=d[j],C=r[M.materialIndex],D=Math.max(M.start,f.start),I=Math.min(s.count,Math.min(M.start+M.count,f.start+f.count));D<I;D+=3){(a=Zi(this,C,e,Pi,s,u,c,l,h,D,D+1,D+2))&&(a.faceIndex=Math.floor(D/3),a.face.materialIndex=M.materialIndex,t.push(a))}else for(var P=Math.max(0,f.start),R=Math.min(s.count,f.start+f.count);P<R;P+=3){(a=Zi(this,r,e,Pi,s,u,c,l,h,P,P+1,P+2))&&(a.faceIndex=Math.floor(P/3),t.push(a))}}}}]),n}(ri);function Zi(e,t,n,r,i,a,o,s,u,c,l,h){Li.fromBufferAttribute(i,c),Ni.fromBufferAttribute(i,l),Bi.fromBufferAttribute(i,h);var d=e.morphTargetInfluences;if(a&&d){Vi.set(0,0,0),Gi.set(0,0,0),Hi.set(0,0,0);for(var f=0,p=a.length;f<p;f++){var v=d[f],m=a[f];0!==v&&(Fi.fromBufferAttribute(m,c),Ui.fromBufferAttribute(m,l),zi.fromBufferAttribute(m,h),o?(Vi.addScaledVector(Fi,v),Gi.addScaledVector(Ui,v),Hi.addScaledVector(zi,v)):(Vi.addScaledVector(Fi.sub(Li),v),Gi.addScaledVector(Ui.sub(Ni),v),Hi.addScaledVector(zi.sub(Bi),v)))}Li.add(Vi),Ni.add(Gi),Bi.add(Hi)}e.isSkinnedMesh&&(e.boneTransform(c,Li),e.boneTransform(l,Ni),e.boneTransform(h,Bi));var g=function(e,t,n,r,i,a,o,s){if(null===(t.side===ee?r.intersectTriangle(o,a,i,!0,s):r.intersectTriangle(i,a,o,t.side!==te,s)))return null;Ki.copy(s),Ki.applyMatrix4(e.matrixWorld);var u=n.ray.origin.distanceTo(Ki);return u<n.near||u>n.far?null:{distance:u,point:Ki.clone(),object:e}}(e,t,n,r,Li,Ni,Bi,Xi);if(g){s&&(Wi.fromBufferAttribute(s,c),qi.fromBufferAttribute(s,l),Yi.fromBufferAttribute(s,h),g.uv=pi.getUV(Xi,Li,Ni,Bi,Wi,qi,Yi,new An)),u&&(Wi.fromBufferAttribute(u,c),qi.fromBufferAttribute(u,l),Yi.fromBufferAttribute(u,h),g.uv2=pi.getUV(Xi,Li,Ni,Bi,Wi,qi,Yi,new An));var y={a:c,b:l,c:h,normal:new tr,materialIndex:0};pi.getNormal(Li,Ni,Bi,y.normal),g.face=y}return g}var Ji=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;Object(E.a)(this,n),(e=t.call(this)).type="BoxGeometry",e.parameters={width:r,height:i,depth:a,widthSegments:o,heightSegments:s,depthSegments:u};var c=Object(x.a)(e);o=Math.floor(o),s=Math.floor(s),u=Math.floor(u);var l=[],h=[],d=[],f=[],p=0,v=0;function m(e,t,n,r,i,a,o,s,u,m,g){for(var y=a/u,b=o/m,w=a/2,x=o/2,O=s/2,k=u+1,_=m+1,S=0,E=0,A=new tr,j=0;j<_;j++)for(var T=j*b-x,M=0;M<k;M++){var C=M*y-w;A[e]=C*r,A[t]=T*i,A[n]=O,h.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[n]=s>0?1:-1,d.push(A.x,A.y,A.z),f.push(M/u),f.push(1-j/m),S+=1}for(var D=0;D<m;D++)for(var I=0;I<u;I++){var P=p+I+k*D,R=p+I+k*(D+1),L=p+(I+1)+k*(D+1),N=p+(I+1)+k*D;l.push(P,R,N),l.push(R,L,N),E+=6}c.addGroup(v,E,g),v+=E,p+=S}return m("z","y","x",-1,-1,a,i,r,u,s,0),m("z","y","x",1,-1,a,i,-r,u,s,1),m("x","z","y",1,1,r,a,i,o,u,2),m("x","z","y",1,-1,r,a,-i,o,u,3),m("x","y","z",1,-1,r,i,a,o,s,4),m("x","y","z",-1,-1,r,i,-a,o,s,5),e.setIndex(l),e.setAttribute("position",new _i(h,3)),e.setAttribute("normal",new _i(d,3)),e.setAttribute("uv",new _i(f,2)),e}return Object(A.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}]),n}(Di);function $i(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}return t}function ea(e){for(var t={},n=0;n<e.length;n++){var r=$i(e[n]);for(var i in r)t[i]=r[i]}return t}var ta={clone:$i,merge:ea},na="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",ra="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",ia=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this)).isShaderMaterial=!0,r.type="ShaderMaterial",r.defines={},r.uniforms={},r.vertexShader=na,r.fragmentShader=ra,r.linewidth=1,r.wireframe=!1,r.wireframeLinewidth=1,r.fog=!1,r.lights=!1,r.clipping=!1,r.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},r.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},r.index0AttributeName=void 0,r.uniformsNeedUpdate=!1,r.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),r.setValues(e)),r}return Object(A.a)(n,[{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=$i(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}},{key:"toJSON",value:function(e){var t=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this,e);for(var r in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var i=this.uniforms[r].value;i&&i.isTexture?t.uniforms[r]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[r]={type:"m4",value:i.toArray()}:t.uniforms[r]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var a={};for(var o in this.extensions)!0===this.extensions[o]&&(a[o]=!0);return Object.keys(a).length>0&&(t.extensions=a),t}}]),n}(mi),aa=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this)).isCamera=!0,e.type="Camera",e.matrixWorldInverse=new Dr,e.projectionMatrix=new Dr,e.projectionMatrixInverse=new Dr,e}return Object(A.a)(n,[{key:"copy",value:function(e,t){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}},{key:"updateMatrixWorld",value:function(e){Object(b.a)(Object(w.a)(n.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(e,t){Object(b.a)(Object(w.a)(n.prototype),"updateWorldMatrix",this).call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),n}(ri),oa=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;return Object(E.a)(this,n),(e=t.call(this)).isPerspectiveCamera=!0,e.type="PerspectiveCamera",e.fov=r,e.zoom=1,e.near=a,e.far=o,e.focus=10,e.aspect=i,e.view=null,e.filmGauge=35,e.filmOffset=0,e.updateProjectionMatrix(),e}return Object(A.a)(n,[{key:"copy",value:function(e,t){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}},{key:"setFocalLength",value:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*bn*Math.atan(t),this.updateProjectionMatrix()}},{key:"getFocalLength",value:function(){var e=Math.tan(.5*yn*this.fov);return.5*this.getFilmHeight()/e}},{key:"getEffectiveFOV",value:function(){return 2*bn*Math.atan(Math.tan(.5*yn*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"setViewOffset",value:function(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=this.near,t=e*Math.tan(.5*yn*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;i+=a.offsetX*r/o,t-=a.offsetY*n/s,r*=a.width/o,n*=a.height/s}var u=this.filmOffset;0!==u&&(i+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}]),n}(aa),sa=90,ua=1,ca=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;if(Object(E.a)(this,n),(a=t.call(this)).type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter."),Object(y.a)(a);a.renderTarget=i;var o=new oa(sa,ua,e,r);o.layers=a.layers,o.up.set(0,-1,0),o.lookAt(new tr(1,0,0)),a.add(o);var s=new oa(sa,ua,e,r);s.layers=a.layers,s.up.set(0,-1,0),s.lookAt(new tr(-1,0,0)),a.add(s);var u=new oa(sa,ua,e,r);u.layers=a.layers,u.up.set(0,0,1),u.lookAt(new tr(0,1,0)),a.add(u);var c=new oa(sa,ua,e,r);c.layers=a.layers,c.up.set(0,0,-1),c.lookAt(new tr(0,-1,0)),a.add(c);var l=new oa(sa,ua,e,r);l.layers=a.layers,l.up.set(0,-1,0),l.lookAt(new tr(0,0,1)),a.add(l);var h=new oa(sa,ua,e,r);return h.layers=a.layers,h.up.set(0,-1,0),h.lookAt(new tr(0,0,-1)),a.add(h),Object(y.a)(a)}return Object(A.a)(n,[{key:"update",value:function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,r=Object(g.a)(this.children,6),i=r[0],a=r[1],o=r[2],s=r[3],u=r[4],c=r[5],l=e.getRenderTarget(),h=e.toneMapping,d=e.xr.enabled;e.toneMapping=Re,e.xr.enabled=!1;var f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,a),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,u),n.texture.generateMipmaps=f,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(l),e.toneMapping=h,e.xr.enabled=d,n.texture.needsPMREMUpdate=!0}}]),n}(ri),la=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o,s,u,c,l,h){var d;return Object(E.a)(this,n),e=void 0!==e?e:[],r=void 0!==r?r:ze,(d=t.call(this,e,r,i,a,o,s,u,c,l,h)).isCubeTexture=!0,d.flipY=!1,d}return Object(A.a)(n,[{key:"images",get:function(){return this.image},set:function(e){this.image=e}}]),n}(Kn),ha=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(E.a)(this,n),(r=t.call(this,e,e,i)).isWebGLCubeRenderTarget=!0;var a={width:e,height:e,depth:1},o=[a,a,a,a,a,a];return r.texture=new la(o,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),r.texture.isRenderTargetTexture=!0,r.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,r.texture.minFilter=void 0!==i.minFilter?i.minFilter:Je,r}return Object(A.a)(n,[{key:"fromEquirectangularTexture",value:function(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new Ji(5,5,5),o=new ia({name:"CubemapFromEquirect",uniforms:$i(n),vertexShader:r,fragmentShader:i,side:ee,blending:ne});o.uniforms.tEquirect.value=t;var s=new Qi(a,o),u=t.minFilter;return t.minFilter===et&&(t.minFilter=Je),new ca(1,10,this).update(e,s),t.minFilter=u,s.geometry.dispose(),s.material.dispose(),this}},{key:"clear",value:function(e,t,n,r){for(var i=e.getRenderTarget(),a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,r);e.setRenderTarget(i)}}]),n}(Zn),da=new tr,fa=new tr,pa=new jn,va=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tr(1,0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(E.a)(this,e),this.isPlane=!0,this.normal=t,this.constant=n}return Object(A.a)(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var r=da.subVectors(n,t).cross(fa.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function(e,t){var n=e.delta(da),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;var i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(n).multiplyScalar(i).add(e.start)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var n=t||pa.getNormalMatrix(e),r=this.coplanarPoint(da).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),ma=new kr,ga=new tr,ya=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new va,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new va,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new va,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new va,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new va,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new va;Object(E.a)(this,e),this.planes=[t,n,r,i,a,o]}return Object(A.a)(e,[{key:"set",value:function(e,t,n,r,i,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this}},{key:"copy",value:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],u=n[5],c=n[6],l=n[7],h=n[8],d=n[9],f=n[10],p=n[11],v=n[12],m=n[13],g=n[14],y=n[15];return t[0].setComponents(o-r,l-s,p-h,y-v).normalize(),t[1].setComponents(o+r,l+s,p+h,y+v).normalize(),t[2].setComponents(o+i,l+u,p+d,y+m).normalize(),t[3].setComponents(o-i,l-u,p-d,y-m).normalize(),t[4].setComponents(o-a,l-c,p-f,y-g).normalize(),t[5].setComponents(o+a,l+c,p+f,y+g).normalize(),this}},{key:"intersectsObject",value:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),ma.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(ma)}},{key:"intersectsSprite",value:function(e){return ma.center.set(0,0,0),ma.radius=.7071067811865476,ma.applyMatrix4(e.matrixWorld),this.intersectsSphere(ma)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,n=e.center,r=-e.radius,i=0;i<6;i++)if(t[i].distanceToPoint(n)<r)return!1;return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,n=0;n<6;n++){var r=t[n];if(ga.x=r.normal.x>0?e.max.x:e.min.x,ga.y=r.normal.y>0?e.max.y:e.min.y,ga.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(ga)<0)return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();function ba(){var e=null,t=!1,n=null,r=null;function i(t,a){n(t,a),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function wa(e,t){var n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){var a=r.get(t);(!a||a.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var o=r.get(t);void 0===o?r.set(t,function(t,r){var i,a=t.array,o=t.usage,s=e.createBuffer();if(e.bindBuffer(r,s),e.bufferData(r,a,o),t.onUploadCallback(),a instanceof Float32Array)i=5126;else if(a instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");i=5131}else i=5123;else if(a instanceof Int16Array)i=5122;else if(a instanceof Uint32Array)i=5125;else if(a instanceof Int32Array)i=5124;else if(a instanceof Int8Array)i=5120;else if(a instanceof Uint8Array)i=5121;else{if(!(a instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+a);i=5121}return{buffer:s,type:i,bytesPerElement:a.BYTES_PER_ELEMENT,version:t.version}}(t,i)):o.version<t.version&&(function(t,r,i){var a=r.array,o=r.updateRange;e.bindBuffer(i,t),-1===o.count?e.bufferSubData(i,0,a):(n?e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(o.buffer,t,i),o.version=t.version)}}}}var xa=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(E.a)(this,n),(e=t.call(this)).type="PlaneGeometry",e.parameters={width:r,height:i,widthSegments:a,heightSegments:o};for(var s=r/2,u=i/2,c=Math.floor(a),l=Math.floor(o),h=c+1,d=l+1,f=r/c,p=i/l,v=[],m=[],g=[],y=[],b=0;b<d;b++)for(var w=b*p-u,x=0;x<h;x++){var O=x*f-s;m.push(O,-w,0),g.push(0,0,1),y.push(x/c),y.push(1-b/l)}for(var k=0;k<l;k++)for(var _=0;_<c;_++){var S=_+h*k,A=_+h*(k+1),j=_+1+h*(k+1),T=_+1+h*k;v.push(S,A,T),v.push(A,j,T)}return e.setIndex(v),e.setAttribute("position",new _i(m,3)),e.setAttribute("normal",new _i(g,3)),e.setAttribute("uv",new _i(y,2)),e}return Object(A.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.widthSegments,e.heightSegments)}}]),n}(Di),Oa={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\nvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = mix(F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence);\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\nconst mat3 XYZ_TO_REC709 = mat3(\n    3.2404542, -0.9692660,  0.0556434,\n   -1.5371385,  1.8760108, -0.2040259,\n   -0.4985314,  0.0415560,  1.0572252\n);\nvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n   vec3 sqrtF0 = sqrt( fresnel0 );\n   return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n}\nvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n   return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n}\nfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n   return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n}\nvec3 evalSensitivity( float OPD, vec3 shift ) {\n   float phase = 2.0 * PI * OPD * 1.0e-9;\n   vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n   vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n   vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n   vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( -pow2( phase ) * var );\n   xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[0] ) * exp( -4.5282e+09 * pow2( phase ) );\n   xyz /= 1.0685e-7;\n   vec3 srgb = XYZ_TO_REC709 * xyz;\n   return srgb;\n}\nvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n   vec3 I;\n   float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n   float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n   float cosTheta2Sq = 1.0 - sinTheta2Sq;\n   if ( cosTheta2Sq < 0.0 ) {\n       return vec3( 1.0 );\n   }\n   float cosTheta2 = sqrt( cosTheta2Sq );\n   float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n   float R12 = F_Schlick( R0, 1.0, cosTheta1 );\n   float R21 = R12;\n   float T121 = 1.0 - R12;\n   float phi12 = 0.0;\n   if ( iridescenceIOR < outsideIOR ) phi12 = PI;\n   float phi21 = PI - phi12;\n   vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );   vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n   vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n   vec3 phi23 = vec3( 0.0 );\n   if ( baseIOR[0] < iridescenceIOR ) phi23[0] = PI;\n   if ( baseIOR[1] < iridescenceIOR ) phi23[1] = PI;\n   if ( baseIOR[2] < iridescenceIOR ) phi23[2] = PI;\n   float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n   vec3 phi = vec3( phi21 ) + phi23;\n   vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n   vec3 r123 = sqrt( R123 );\n   vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n   vec3 C0 = R12 + Rs;\n   I = C0;\n   vec3 Cm = Rs - T121;\n   for ( int m = 1; m <= 2; ++m ) {\n       Cm *= r123;\n       vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n       I += Cm * Sm;\n   }\n   return max( I, vec3( 0.0 ) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\nfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\nif ( material.iridescenceThickness == 0.0 ) {\n\tmaterial.iridescence = 0.0;\n} else {\n\tmaterial.iridescence = saturate( material.iridescence );\n}\nif ( material.iridescence > 0.0 ) {\n\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},ka={common:{diffuse:{value:new Gn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new jn},uv2Transform:{value:new jn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new An(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Gn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Gn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new jn}},sprite:{diffuse:{value:new Gn(16777215)},opacity:{value:1},center:{value:new An(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new jn}}},_a={basic:{uniforms:ea([ka.common,ka.specularmap,ka.envmap,ka.aomap,ka.lightmap,ka.fog]),vertexShader:Oa.meshbasic_vert,fragmentShader:Oa.meshbasic_frag},lambert:{uniforms:ea([ka.common,ka.specularmap,ka.envmap,ka.aomap,ka.lightmap,ka.emissivemap,ka.fog,ka.lights,{emissive:{value:new Gn(0)}}]),vertexShader:Oa.meshlambert_vert,fragmentShader:Oa.meshlambert_frag},phong:{uniforms:ea([ka.common,ka.specularmap,ka.envmap,ka.aomap,ka.lightmap,ka.emissivemap,ka.bumpmap,ka.normalmap,ka.displacementmap,ka.fog,ka.lights,{emissive:{value:new Gn(0)},specular:{value:new Gn(1118481)},shininess:{value:30}}]),vertexShader:Oa.meshphong_vert,fragmentShader:Oa.meshphong_frag},standard:{uniforms:ea([ka.common,ka.envmap,ka.aomap,ka.lightmap,ka.emissivemap,ka.bumpmap,ka.normalmap,ka.displacementmap,ka.roughnessmap,ka.metalnessmap,ka.fog,ka.lights,{emissive:{value:new Gn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Oa.meshphysical_vert,fragmentShader:Oa.meshphysical_frag},toon:{uniforms:ea([ka.common,ka.aomap,ka.lightmap,ka.emissivemap,ka.bumpmap,ka.normalmap,ka.displacementmap,ka.gradientmap,ka.fog,ka.lights,{emissive:{value:new Gn(0)}}]),vertexShader:Oa.meshtoon_vert,fragmentShader:Oa.meshtoon_frag},matcap:{uniforms:ea([ka.common,ka.bumpmap,ka.normalmap,ka.displacementmap,ka.fog,{matcap:{value:null}}]),vertexShader:Oa.meshmatcap_vert,fragmentShader:Oa.meshmatcap_frag},points:{uniforms:ea([ka.points,ka.fog]),vertexShader:Oa.points_vert,fragmentShader:Oa.points_frag},dashed:{uniforms:ea([ka.common,ka.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Oa.linedashed_vert,fragmentShader:Oa.linedashed_frag},depth:{uniforms:ea([ka.common,ka.displacementmap]),vertexShader:Oa.depth_vert,fragmentShader:Oa.depth_frag},normal:{uniforms:ea([ka.common,ka.bumpmap,ka.normalmap,ka.displacementmap,{opacity:{value:1}}]),vertexShader:Oa.meshnormal_vert,fragmentShader:Oa.meshnormal_frag},sprite:{uniforms:ea([ka.sprite,ka.fog]),vertexShader:Oa.sprite_vert,fragmentShader:Oa.sprite_frag},background:{uniforms:{uvTransform:{value:new jn},t2D:{value:null}},vertexShader:Oa.background_vert,fragmentShader:Oa.background_frag},cube:{uniforms:ea([ka.envmap,{opacity:{value:1}}]),vertexShader:Oa.cube_vert,fragmentShader:Oa.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Oa.equirect_vert,fragmentShader:Oa.equirect_frag},distanceRGBA:{uniforms:ea([ka.common,ka.displacementmap,{referencePosition:{value:new tr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Oa.distanceRGBA_vert,fragmentShader:Oa.distanceRGBA_frag},shadow:{uniforms:ea([ka.lights,ka.fog,{color:{value:new Gn(0)},opacity:{value:1}}]),vertexShader:Oa.shadow_vert,fragmentShader:Oa.shadow_frag}};function Sa(e,t,n,r,i,a){var o,s,u=new Gn(0),c=!0===i?0:1,l=null,h=0,d=null;function f(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,a)}return{getClearColor:function(){return u},setClearColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;u.set(e),f(u,c=t)},getClearAlpha:function(){return c},setClearAlpha:function(e){f(u,c=e)},render:function(n,i){var a=!1,p=!0===i.isScene?i.background:null;p&&p.isTexture&&(p=t.get(p));var v=e.xr,m=v.getSession&&v.getSession();m&&"additive"===m.environmentBlendMode&&(p=null),null===p?f(u,c):p&&p.isColor&&(f(p,1),a=!0),(e.autoClear||a)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),p&&(p.isCubeTexture||p.mapping===We)?(void 0===s&&((s=new Qi(new Ji(1,1,1),new ia({name:"BackgroundCubeMaterial",uniforms:$i(_a.cube.uniforms),vertexShader:_a.cube.vertexShader,fragmentShader:_a.cube.fragmentShader,side:ee,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(s)),s.material.uniforms.envMap.value=p,s.material.uniforms.flipEnvMap.value=p.isCubeTexture&&!1===p.isRenderTargetTexture?-1:1,(l!==p||h!==p.version||d!==e.toneMapping)&&(s.material.needsUpdate=!0,l=p,h=p.version,d=e.toneMapping),s.layers.enableAll(),n.unshift(s,s.geometry,s.material,0,0,null)):p&&p.isTexture&&(void 0===o&&((o=new Qi(new xa(2,2),new ia({name:"BackgroundMaterial",uniforms:$i(_a.background.uniforms),vertexShader:_a.background.vertexShader,fragmentShader:_a.background.fragmentShader,side:$,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=p,!0===p.matrixAutoUpdate&&p.updateMatrix(),o.material.uniforms.uvTransform.value.copy(p.matrix),(l!==p||h!==p.version||d!==e.toneMapping)&&(o.material.needsUpdate=!0,l=p,h=p.version,d=e.toneMapping),o.layers.enableAll(),n.unshift(o,o.geometry,o.material,0,0,null))}}}function Ea(e,t,n,r){var i=e.getParameter(34921),a=r.isWebGL2?null:t.get("OES_vertex_array_object"),o=r.isWebGL2||null!==a,s={},u=f(null),c=u,l=!1;function h(t){return r.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function d(t){return r.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function f(e){for(var t=[],n=[],r=[],a=0;a<i;a++)t[a]=0,n[a]=0,r[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function p(){for(var e=c.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function v(e){m(e,0)}function m(n,i){var a=c.newAttributes,o=c.enabledAttributes,s=c.attributeDivisors;a[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==i&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),s[n]=i)}function g(){for(var t=c.newAttributes,n=c.enabledAttributes,r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function y(t,n,i,a,o,s){!0!==r.isWebGL2||5124!==i&&5125!==i?e.vertexAttribPointer(t,n,i,a,o,s):e.vertexAttribIPointer(t,n,i,o,s)}function b(){w(),l=!0,c!==u&&h((c=u).object)}function w(){u.geometry=null,u.program=null,u.wireframe=!1}return{setup:function(i,u,d,b,w){var x=!1;if(o){var O=function(t,n,i){var o=!0===i.wireframe,u=s[t.id];void 0===u&&(u={},s[t.id]=u);var c=u[n.id];void 0===c&&(c={},u[n.id]=c);var l=c[o];return void 0===l&&(l=f(r.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),c[o]=l),l}(b,d,u);c!==O&&h((c=O).object),x=function(e,t,n,r){var i=c.attributes,a=t.attributes,o=0,s=n.getAttributes();for(var u in s)if(s[u].location>=0){var l=i[u],h=a[u];if(void 0===h&&("instanceMatrix"===u&&e.instanceMatrix&&(h=e.instanceMatrix),"instanceColor"===u&&e.instanceColor&&(h=e.instanceColor)),void 0===l||l.attribute!==h||h&&l.data!==h.data)return!0;o++}return c.attributesNum!==o||c.index!==r}(i,b,d,w),x&&function(e,t,n,r){var i={},a=t.attributes,o=0,s=n.getAttributes();for(var u in s)if(s[u].location>=0){var l=a[u];void 0===l&&("instanceMatrix"===u&&e.instanceMatrix&&(l=e.instanceMatrix),"instanceColor"===u&&e.instanceColor&&(l=e.instanceColor));var h={};h.attribute=l,l&&l.data&&(h.data=l.data),i[u]=h,o++}c.attributes=i,c.attributesNum=o,c.index=r}(i,b,d,w)}else{var k=!0===u.wireframe;(c.geometry!==b.id||c.program!==d.id||c.wireframe!==k)&&(c.geometry=b.id,c.program=d.id,c.wireframe=k,x=!0)}null!==w&&n.update(w,34963),(x||l)&&(l=!1,function(i,a,o,s){if(!1===r.isWebGL2&&(i.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();var u=s.attributes,c=o.getAttributes(),l=a.defaultAttributeValues;for(var h in c){var d=c[h];if(d.location>=0){var f=u[h];if(void 0===f&&("instanceMatrix"===h&&i.instanceMatrix&&(f=i.instanceMatrix),"instanceColor"===h&&i.instanceColor&&(f=i.instanceColor)),void 0!==f){var b=f.normalized,w=f.itemSize,x=n.get(f);if(void 0===x)continue;var O=x.buffer,k=x.type,_=x.bytesPerElement;if(f.isInterleavedBufferAttribute){var S=f.data,E=S.stride,A=f.offset;if(S.isInstancedInterleavedBuffer){for(var j=0;j<d.locationSize;j++)m(d.location+j,S.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=S.meshPerAttribute*S.count)}else for(var T=0;T<d.locationSize;T++)v(d.location+T);e.bindBuffer(34962,O);for(var M=0;M<d.locationSize;M++)y(d.location+M,w/d.locationSize,k,b,E*_,(A+w/d.locationSize*M)*_)}else{if(f.isInstancedBufferAttribute){for(var C=0;C<d.locationSize;C++)m(d.location+C,f.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=f.meshPerAttribute*f.count)}else for(var D=0;D<d.locationSize;D++)v(d.location+D);e.bindBuffer(34962,O);for(var I=0;I<d.locationSize;I++)y(d.location+I,w/d.locationSize,k,b,w*_,w/d.locationSize*I*_)}}else if(void 0!==l){var P=l[h];if(void 0!==P)switch(P.length){case 2:e.vertexAttrib2fv(d.location,P);break;case 3:e.vertexAttrib3fv(d.location,P);break;case 4:e.vertexAttrib4fv(d.location,P);break;default:e.vertexAttrib1fv(d.location,P)}}}}g()}(i,u,d,b),null!==w&&e.bindBuffer(34963,n.get(w).buffer))},reset:b,resetDefaultState:w,dispose:function(){for(var e in b(),s){var t=s[e];for(var n in t){var r=t[n];for(var i in r)d(r[i].object),delete r[i];delete t[n]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0!==s[e.id]){var t=s[e.id];for(var n in t){var r=t[n];for(var i in r)d(r[i].object),delete r[i];delete t[n]}delete s[e.id]}},releaseStatesOfProgram:function(e){for(var t in s){var n=s[t];if(void 0!==n[e.id]){var r=n[e.id];for(var i in r)d(r[i].object),delete r[i];delete n[e.id]}}},initAttributes:p,enableAttribute:v,disableUnusedAttributes:g}}function Aa(e,t,n,r){var i,a=r.isWebGL2;this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i,1)},this.renderInstances=function(r,o,s){if(0!==s){var u,c;if(a)u=e,c="drawArraysInstanced";else if(c="drawArraysInstancedANGLE",null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[c](i,r,o,s),n.update(o,i,s)}}}function ja(e,t,n){var r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==n.precision?n.precision:"highp",s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var u=a||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,l=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),f=e.getParameter(34076),p=e.getParameter(34921),v=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),y=h>0,b=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:u,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){var n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:c,maxTextures:l,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:f,maxAttributes:p,maxVertexUniforms:v,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:a?e.getParameter(36183):0}}function Ta(e){var t=this,n=null,r=0,i=!1,a=!1,o=new va,s=new jn,u={value:null,needsUpdate:!1};function c(){u.value!==n&&(u.value=n,u.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function l(e,n,r,i){var a=null!==e?e.length:0,c=null;if(0!==a){if(c=u.value,!0!==i||null===c){var l=r+4*a,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===c||c.length<l)&&(c=new Float32Array(l));for(var d=0,f=r;d!==a;++d,f+=4)o.copy(e[d]).applyMatrix4(h,s),o.normal.toArray(c,f),c[f+3]=o.constant}u.value=c,u.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,c}this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,a){var o=0!==e.length||t||0!==r||i;return i=t,n=l(e,a,0),r=e.length,o},this.beginShadows=function(){a=!0,l(null)},this.endShadows=function(){a=!1,c()},this.setState=function(t,o,s){var h=t.clippingPlanes,d=t.clipIntersection,f=t.clipShadows,p=e.get(t);if(!i||null===h||0===h.length||a&&!f)a?l(null):c();else{var v=a?0:r,m=4*v,g=p.clippingState||null;u.value=g,g=l(h,o,m,s);for(var y=0;y!==m;++y)g[y]=n[y];p.clippingState=g,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=v}}}function Ma(e){var t=new WeakMap;function n(e,t){return t===Ge?e.mapping=ze:t===He&&(e.mapping=Ve),e}function r(e){var n=e.target;n.removeEventListener("dispose",r);var i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){var a=i.mapping;if(a===Ge||a===He){if(t.has(i))return n(t.get(i).texture,i.mapping);var o=i.image;if(o&&o.height>0){var s=new ha(o.height/2);return s.fromEquirectangularTexture(e,i),t.set(i,s),i.addEventListener("dispose",r),n(s.texture,i.mapping)}return null}}return i},dispose:function(){t=new WeakMap}}}_a.physical={uniforms:ea([_a.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new An(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Gn(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new An},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Gn(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Gn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Oa.meshphysical_vert,fragmentShader:Oa.meshphysical_frag};var Ca=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return Object(E.a)(this,n),(e=t.call(this)).isOrthographicCamera=!0,e.type="OrthographicCamera",e.zoom=1,e.view=null,e.left=r,e.right=i,e.top=a,e.bottom=o,e.near=s,e.far=u,e.updateProjectionMatrix(),e}return Object(A.a)(n,[{key:"copy",value:function(e,t){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}},{key:"setViewOffset",value:function(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-e,a=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var u=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a=(i+=u*this.view.offsetX)+u*this.view.width,s=(o-=c*this.view.offsetY)-c*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}]),n}(aa),Da=4,Ia=[.125,.215,.35,.446,.526,.582],Pa=20,Ra=new Ca,La=new Gn,Na=null,Ba=(1+Math.sqrt(5))/2,Fa=1/Ba,Ua=[new tr(1,1,1),new tr(-1,1,1),new tr(1,1,-1),new tr(-1,1,-1),new tr(0,Ba,Fa),new tr(0,Ba,-Fa),new tr(Fa,0,Ba),new tr(-Fa,0,Ba),new tr(Ba,Fa,0),new tr(-Ba,Fa,0)],za=function(){function e(t){Object(E.a)(this,e),this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}return Object(A.a)(e,[{key:"fromScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;Na=this._renderer.getRenderTarget(),this._setSize(256);var i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}},{key:"fromEquirectangular",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"fromCubemap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"compileCubemapShader",value:function(){null===this._cubemapMaterial&&(this._cubemapMaterial=Wa(),this._compileMaterial(this._cubemapMaterial))}},{key:"compileEquirectangularShader",value:function(){null===this._equirectMaterial&&(this._equirectMaterial=Ha(),this._compileMaterial(this._equirectMaterial))}},{key:"dispose",value:function(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}},{key:"_setSize",value:function(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}},{key:"_dispose",value:function(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(var e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}},{key:"_cleanup",value:function(e){this._renderer.setRenderTarget(Na),e.scissorTest=!1,Ga(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function(e,t){e.mapping===ze||e.mapping===Ve?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Na=this._renderer.getRenderTarget();var n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}},{key:"_allocateTargets",value:function(){var e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Je,minFilter:Je,generateMipmaps:!1,type:ut,format:pt,encoding:tn,depthBuffer:!1},r=Va(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){var i;null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Va(e,t,n);var a=this._lodMax;i=function(e){for(var t=[],n=[],r=[],i=e,a=e-Da+1+Ia.length,o=0;o<a;o++){var s=Math.pow(2,i);n.push(s);var u=1/s;o>e-Da?u=Ia[o-e+Da-1]:0===o&&(u=0),r.push(u);for(var c=1/(s-2),l=-c,h=1+c,d=[l,l,h,l,h,h,l,l,h,h,l,h],f=6,p=6,v=3,m=2,g=1,y=new Float32Array(v*p*f),b=new Float32Array(m*p*f),w=new Float32Array(g*p*f),x=0;x<f;x++){var O=x%3*2/3-1,k=x>2?0:-1,_=[O,k,0,O+2/3,k,0,O+2/3,k+1,0,O,k,0,O+2/3,k+1,0,O,k+1,0];y.set(_,v*p*x),b.set(d,m*p*x);var S=[x,x,x,x,x,x];w.set(S,g*p*x)}var E=new Di;E.setAttribute("position",new wi(y,v)),E.setAttribute("uv",new wi(b,m)),E.setAttribute("faceIndex",new wi(w,g)),t.push(E),i>Da&&i--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(a),this._sizeLods=i.sizeLods,this._lodPlanes=i.lodPlanes,this._sigmas=i.sigmas,this._blurMaterial=function(e,t,n){var r=new Float32Array(Pa),i=new tr(0,1,0);return new ia({name:"SphericalGaussianBlur",defines:{n:Pa,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:ne,depthTest:!1,depthWrite:!1})}(a,e,t)}return r}},{key:"_compileMaterial",value:function(e){var t=new Qi(this._lodPlanes[0],e);this._renderer.compile(t,Ra)}},{key:"_sceneToCubeUV",value:function(e,t,n,r){var i=new oa(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,u=s.autoClear,c=s.toneMapping;s.getClearColor(La),s.toneMapping=Re,s.autoClear=!1;var l=new gi({name:"PMREM.Background",side:ee,depthWrite:!1,depthTest:!1}),h=new Qi(new Ji,l),d=!1,f=e.background;f?f.isColor&&(l.color.copy(f),e.background=null,d=!0):(l.color.copy(La),d=!0);for(var p=0;p<6;p++){var v=p%3;0===v?(i.up.set(0,a[p],0),i.lookAt(o[p],0,0)):1===v?(i.up.set(0,0,a[p]),i.lookAt(0,o[p],0)):(i.up.set(0,a[p],0),i.lookAt(0,0,o[p]));var m=this._cubeSize;Ga(r,v*m,p>2?m:0,m,m),s.setRenderTarget(r),d&&s.render(h,i),s.render(e,i)}h.geometry.dispose(),h.material.dispose(),s.toneMapping=c,s.autoClear=u,e.background=f}},{key:"_textureToCubeUV",value:function(e,t){var n=this._renderer,r=e.mapping===ze||e.mapping===Ve;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=Wa()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Ha());var i=r?this._cubemapMaterial:this._equirectMaterial,a=new Qi(this._lodPlanes[0],i);i.uniforms.envMap.value=e;var o=this._cubeSize;Ga(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(a,Ra)}},{key:"_applyPMREM",value:function(e){var t=this._renderer,n=t.autoClear;t.autoClear=!1;for(var r=1;r<this._lodPlanes.length;r++){var i=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),a=Ua[(r-1)%Ua.length];this._blur(e,r-1,r,i,a)}t.autoClear=n}},{key:"_blur",value:function(e,t,n,r,i){var a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",i),this._halfBlur(a,e,n,n,r,"longitudinal",i)}},{key:"_halfBlur",value:function(e,t,n,r,i,a,o){var s=this._renderer,u=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var c=new Qi(this._lodPlanes[r],u),l=u.uniforms,h=this._sizeLods[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/(2*Pa-1),f=i/d,p=isFinite(i)?1+Math.floor(3*f):Pa;p>Pa&&console.warn("sigmaRadians, ".concat(i,", is too large and will clip, as it requested ").concat(p," samples when the maximum is set to ").concat(Pa));for(var v=[],m=0,g=0;g<Pa;++g){var y=g/f,b=Math.exp(-y*y/2);v.push(b),0===g?m+=b:g<p&&(m+=2*b)}for(var w=0;w<v.length;w++)v[w]=v[w]/m;l.envMap.value=e.texture,l.samples.value=p,l.weights.value=v,l.latitudinal.value="latitudinal"===a,o&&(l.poleAxis.value=o);var x=this._lodMax;l.dTheta.value=d,l.mipInt.value=x-n;var O=this._sizeLods[r];Ga(t,3*O*(r>x-Da?r-x+Da:0),4*(this._cubeSize-O),3*O,2*O),s.setRenderTarget(t),s.render(c,Ra)}}]),e}();function Va(e,t,n){var r=new Zn(e,t,n);return r.texture.mapping=We,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Ga(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function Ha(){return new ia({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:ne,depthTest:!1,depthWrite:!1})}function Wa(){return new ia({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:ne,depthTest:!1,depthWrite:!1})}function qa(e){var t=new WeakMap,n=null;function r(e){var n=e.target;n.removeEventListener("dispose",r);var i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){var a=i.mapping,o=a===Ge||a===He,s=a===ze||a===Ve;if(o||s){if(i.isRenderTargetTexture&&!0===i.needsPMREMUpdate){i.needsPMREMUpdate=!1;var u=t.get(i);return null===n&&(n=new za(e)),u=o?n.fromEquirectangular(i,u):n.fromCubemap(i,u),t.set(i,u),u.texture}if(t.has(i))return t.get(i).texture;var c=i.image;if(o&&c&&c.height>0||s&&c&&function(e){for(var t=0,n=6,r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(c)){null===n&&(n=new za(e));var l=o?n.fromEquirectangular(i):n.fromCubemap(i);return t.set(i,l),i.addEventListener("dispose",r),l.texture}return null}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Ya(e){var t={};function n(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Xa(e,t,n,r){var i={},a=new WeakMap;function o(e){var s=e.target;for(var u in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[u]);s.removeEventListener("dispose",o),delete i[s.id];var c=a.get(s);c&&(t.remove(c),a.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],r=e.index,i=e.attributes.position,o=0;if(null!==r){var s=r.array;o=r.version;for(var u=0,c=s.length;u<c;u+=3){var l=s[u+0],h=s[u+1],d=s[u+2];n.push(l,h,h,d,d,l)}}else{var f=i.array;o=i.version;for(var p=0,v=f.length/3-1;p<v;p+=3){var m=p+0,g=p+1,y=p+2;n.push(m,g,g,y,y,m)}}var b=new(Tn(n)?Oi:xi)(n,1);b.version=o;var w=a.get(e);w&&t.remove(w),a.set(e,b)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",o),i[t.id]=!0,n.memory.geometries++),t},update:function(e){var n=e.attributes;for(var r in n)t.update(n[r],34962);var i=e.morphAttributes;for(var a in i)for(var o=i[a],s=0,u=o.length;s<u;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var t=a.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function Ka(e,t,n,r){var i,a,o,s=r.isWebGL2;this.setMode=function(e){i=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,r){e.drawElements(i,r,a,t*o),n.update(r,i,1)},this.renderInstances=function(r,u,c){if(0!==c){var l,h;if(s)l=e,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[h](i,u,a,r*o,c),n.update(u,i,c)}}}function Qa(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Za(e,t){return e[0]-t[0]}function Ja(e,t){return Math.abs(t[1])-Math.abs(e[1])}function $a(e,t){var n=1,r=t.isInterleavedBufferAttribute?t.data.array:t.array;r instanceof Int8Array?n=127:r instanceof Uint8Array?n=255:r instanceof Uint16Array?n=65535:r instanceof Int16Array?n=32767:r instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r),e.divideScalar(n)}function eo(e,t,n){for(var r={},i=new Float32Array(8),a=new WeakMap,o=new Qn,s=[],u=0;u<8;u++)s[u]=[u,0];return{update:function(u,c,l,h){var d=u.morphTargetInfluences;if(!0===t.isWebGL2){var f=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,p=void 0!==f?f.length:0,v=a.get(c);if(void 0===v||v.count!==p){void 0!==v&&v.texture.dispose();var m=void 0!==c.morphAttributes.position,g=void 0!==c.morphAttributes.normal,y=void 0!==c.morphAttributes.color,b=c.morphAttributes.position||[],w=c.morphAttributes.normal||[],x=c.morphAttributes.color||[],O=0;!0===m&&(O=1),!0===g&&(O=2),!0===y&&(O=3);var k=c.attributes.position.count*O,_=1;k>t.maxTextureSize&&(_=Math.ceil(k/t.maxTextureSize),k=t.maxTextureSize);var S=new Float32Array(k*_*4*p),E=new Jn(S,k,_,p);E.type=st,E.needsUpdate=!0;for(var A=4*O,j=0;j<p;j++)for(var T=b[j],M=w[j],C=x[j],D=k*_*4*j,I=0;I<T.count;I++){var P=I*A;!0===m&&(o.fromBufferAttribute(T,I),!0===T.normalized&&$a(o,T),S[D+P+0]=o.x,S[D+P+1]=o.y,S[D+P+2]=o.z,S[D+P+3]=0),!0===g&&(o.fromBufferAttribute(M,I),!0===M.normalized&&$a(o,M),S[D+P+4]=o.x,S[D+P+5]=o.y,S[D+P+6]=o.z,S[D+P+7]=0),!0===y&&(o.fromBufferAttribute(C,I),!0===C.normalized&&$a(o,C),S[D+P+8]=o.x,S[D+P+9]=o.y,S[D+P+10]=o.z,S[D+P+11]=4===C.itemSize?o.w:1)}v={count:p,texture:E,size:new An(k,_)},a.set(c,v),c.addEventListener("dispose",(function e(){E.dispose(),a.delete(c),c.removeEventListener("dispose",e)}))}for(var R=0,L=0;L<d.length;L++)R+=d[L];var N=c.morphTargetsRelative?1:1-R;h.getUniforms().setValue(e,"morphTargetBaseInfluence",N),h.getUniforms().setValue(e,"morphTargetInfluences",d),h.getUniforms().setValue(e,"morphTargetsTexture",v.texture,n),h.getUniforms().setValue(e,"morphTargetsTextureSize",v.size)}else{var B=void 0===d?0:d.length,F=r[c.id];if(void 0===F||F.length!==B){F=[];for(var U=0;U<B;U++)F[U]=[U,0];r[c.id]=F}for(var z=0;z<B;z++){var V=F[z];V[0]=z,V[1]=d[z]}F.sort(Ja);for(var G=0;G<8;G++)G<B&&F[G][1]?(s[G][0]=F[G][0],s[G][1]=F[G][1]):(s[G][0]=Number.MAX_SAFE_INTEGER,s[G][1]=0);s.sort(Za);for(var H=c.morphAttributes.position,W=c.morphAttributes.normal,q=0,Y=0;Y<8;Y++){var X=s[Y],K=X[0],Q=X[1];K!==Number.MAX_SAFE_INTEGER&&Q?(H&&c.getAttribute("morphTarget"+Y)!==H[K]&&c.setAttribute("morphTarget"+Y,H[K]),W&&c.getAttribute("morphNormal"+Y)!==W[K]&&c.setAttribute("morphNormal"+Y,W[K]),i[Y]=Q,q+=Q):(H&&!0===c.hasAttribute("morphTarget"+Y)&&c.deleteAttribute("morphTarget"+Y),W&&!0===c.hasAttribute("morphNormal"+Y)&&c.deleteAttribute("morphNormal"+Y),i[Y]=0)}var Z=c.morphTargetsRelative?1:1-q;h.getUniforms().setValue(e,"morphTargetBaseInfluence",Z),h.getUniforms().setValue(e,"morphTargetInfluences",i)}}}}function to(e,t,n,r){var i=new WeakMap;function a(e){var t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){var o=r.render.frame,s=e.geometry,u=t.get(e,s);return i.get(u)!==o&&(t.update(u),i.set(u,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",a)&&e.addEventListener("dispose",a),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),u},dispose:function(){i=new WeakMap}}}var no=new Kn,ro=new Jn,io=new $n,ao=new la,oo=[],so=[],uo=new Float32Array(16),co=new Float32Array(9),lo=new Float32Array(4);function ho(e,t,n){var r=e[0];if(r<=0||r>0)return e;var i=t*n,a=oo[i];if(void 0===a&&(a=new Float32Array(i),oo[i]=a),0!==t){r.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function fo(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function po(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}function vo(e,t){var n=so[t];void 0===n&&(n=new Int32Array(t),so[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function mo(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function go(e,t){var n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(fo(n,t))return;e.uniform2fv(this.addr,t),po(n,t)}}function yo(e,t){var n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)(n[0]!==t.r||n[1]!==t.g||n[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(fo(n,t))return;e.uniform3fv(this.addr,t),po(n,t)}}function bo(e,t){var n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z||n[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(fo(n,t))return;e.uniform4fv(this.addr,t),po(n,t)}}function wo(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(fo(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),po(n,t)}else{if(fo(n,r))return;lo.set(r),e.uniformMatrix2fv(this.addr,!1,lo),po(n,r)}}function xo(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(fo(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),po(n,t)}else{if(fo(n,r))return;co.set(r),e.uniformMatrix3fv(this.addr,!1,co),po(n,r)}}function Oo(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(fo(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),po(n,t)}else{if(fo(n,r))return;uo.set(r),e.uniformMatrix4fv(this.addr,!1,uo),po(n,r)}}function ko(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function _o(e,t){var n=this.cache;fo(n,t)||(e.uniform2iv(this.addr,t),po(n,t))}function So(e,t){var n=this.cache;fo(n,t)||(e.uniform3iv(this.addr,t),po(n,t))}function Eo(e,t){var n=this.cache;fo(n,t)||(e.uniform4iv(this.addr,t),po(n,t))}function Ao(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function jo(e,t){var n=this.cache;fo(n,t)||(e.uniform2uiv(this.addr,t),po(n,t))}function To(e,t){var n=this.cache;fo(n,t)||(e.uniform3uiv(this.addr,t),po(n,t))}function Mo(e,t){var n=this.cache;fo(n,t)||(e.uniform4uiv(this.addr,t),po(n,t))}function Co(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2D(t||no,i)}function Do(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||io,i)}function Io(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||ao,i)}function Po(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||ro,i)}function Ro(e,t){e.uniform1fv(this.addr,t)}function Lo(e,t){var n=ho(t,this.size,2);e.uniform2fv(this.addr,n)}function No(e,t){var n=ho(t,this.size,3);e.uniform3fv(this.addr,n)}function Bo(e,t){var n=ho(t,this.size,4);e.uniform4fv(this.addr,n)}function Fo(e,t){var n=ho(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Uo(e,t){var n=ho(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function zo(e,t){var n=ho(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Vo(e,t){e.uniform1iv(this.addr,t)}function Go(e,t){e.uniform2iv(this.addr,t)}function Ho(e,t){e.uniform3iv(this.addr,t)}function Wo(e,t){e.uniform4iv(this.addr,t)}function qo(e,t){e.uniform1uiv(this.addr,t)}function Yo(e,t){e.uniform2uiv(this.addr,t)}function Xo(e,t){e.uniform3uiv(this.addr,t)}function Ko(e,t){e.uniform4uiv(this.addr,t)}function Qo(e,t,n){var r=t.length,i=vo(n,r);e.uniform1iv(this.addr,i);for(var a=0;a!==r;++a)n.setTexture2D(t[a]||no,i[a])}function Zo(e,t,n){var r=t.length,i=vo(n,r);e.uniform1iv(this.addr,i);for(var a=0;a!==r;++a)n.setTexture3D(t[a]||io,i[a])}function Jo(e,t,n){var r=t.length,i=vo(n,r);e.uniform1iv(this.addr,i);for(var a=0;a!==r;++a)n.setTextureCube(t[a]||ao,i[a])}function $o(e,t,n){var r=t.length,i=vo(n,r);e.uniform1iv(this.addr,i);for(var a=0;a!==r;++a)n.setTexture2DArray(t[a]||ro,i[a])}var es=Object(A.a)((function e(t,n,r){Object(E.a)(this,e),this.id=t,this.addr=r,this.cache=[],this.setValue=function(e){switch(e){case 5126:return mo;case 35664:return go;case 35665:return yo;case 35666:return bo;case 35674:return wo;case 35675:return xo;case 35676:return Oo;case 5124:case 35670:return ko;case 35667:case 35671:return _o;case 35668:case 35672:return So;case 35669:case 35673:return Eo;case 5125:return Ao;case 36294:return jo;case 36295:return To;case 36296:return Mo;case 35678:case 36198:case 36298:case 36306:case 35682:return Co;case 35679:case 36299:case 36307:return Do;case 35680:case 36300:case 36308:case 36293:return Io;case 36289:case 36303:case 36311:case 36292:return Po}}(n.type)})),ts=Object(A.a)((function e(t,n,r){Object(E.a)(this,e),this.id=t,this.addr=r,this.cache=[],this.size=n.size,this.setValue=function(e){switch(e){case 5126:return Ro;case 35664:return Lo;case 35665:return No;case 35666:return Bo;case 35674:return Fo;case 35675:return Uo;case 35676:return zo;case 5124:case 35670:return Vo;case 35667:case 35671:return Go;case 35668:case 35672:return Ho;case 35669:case 35673:return Wo;case 5125:return qo;case 36294:return Yo;case 36295:return Xo;case 36296:return Ko;case 35678:case 36198:case 36298:case 36306:case 35682:return Qo;case 35679:case 36299:case 36307:return Zo;case 35680:case 36300:case 36308:case 36293:return Jo;case 36289:case 36303:case 36311:case 36292:return $o}}(n.type)})),ns=function(){function e(t){Object(E.a)(this,e),this.id=t,this.seq=[],this.map={}}return Object(A.a)(e,[{key:"setValue",value:function(e,t,n){for(var r=this.seq,i=0,a=r.length;i!==a;++i){var o=r[i];o.setValue(e,t[o.id],n)}}}]),e}(),rs=/(\w+)(\])?(\[|\.)?/g;function is(e,t){e.seq.push(t),e.map[t.id]=t}function as(e,t,n){var r=e.name,i=r.length;for(rs.lastIndex=0;;){var a=rs.exec(r),o=rs.lastIndex,s=a[1],u="]"===a[2],c=a[3];if(u&&(s|=0),void 0===c||"["===c&&o+2===i){is(n,void 0===c?new es(s,e,t):new ts(s,e,t));break}var l=n.map[s];void 0===l&&is(n,l=new ns(s)),n=l}}var os=function(){function e(t,n){Object(E.a)(this,e),this.seq=[],this.map={};for(var r=t.getProgramParameter(n,35718),i=0;i<r;++i){var a=t.getActiveUniform(n,i);as(a,t.getUniformLocation(n,a.name),this)}}return Object(A.a)(e,[{key:"setValue",value:function(e,t,n,r){var i=this.map[t];void 0!==i&&i.setValue(e,n,r)}},{key:"setOptional",value:function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)}}],[{key:"upload",value:function(e,t,n,r){for(var i=0,a=t.length;i!==a;++i){var o=t[i],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}}},{key:"seqWithValue",value:function(e,t){for(var n=[],r=0,i=e.length;r!==i;++r){var a=e[r];a.id in t&&n.push(a)}return n}}]),e}();function ss(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}var us=0;function cs(e,t,n){var r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";var a=/ERROR: 0:(\d+)/.exec(i);if(a){var o=parseInt(a[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(e,t){for(var n=e.split("\n"),r=[],i=Math.max(t-6,0),a=Math.min(t+6,n.length),o=i;o<a;o++){var s=o+1;r.push("".concat(s===t?">":" "," ").concat(s,": ").concat(n[o]))}return r.join("\n")}(e.getShaderSource(t),o)}return i}function ls(e,t){var n=function(e){switch(e){case tn:return["Linear","( value )"];case nn:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function hs(e,t){var n;switch(t){case Le:n="Linear";break;case Ne:n="Reinhard";break;case Be:n="OptimizedCineon";break;case Fe:n="ACESFilmic";break;case Ue:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function ds(e){return""!==e}function fs(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ps(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var vs=/^[ \t]*#include +<([\w\d./]+)>/gm;function ms(e){return e.replace(vs,gs)}function gs(e,t){var n=Oa[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return ms(n)}var ys=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,bs=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function ws(e){return e.replace(bs,Os).replace(ys,xs)}function xs(e,t,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Os(e,t,n,r)}function Os(e,t,n,r){for(var i="",a=parseInt(t);a<parseInt(n);a++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function ks(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function _s(e,t,n,r){var i,a,o=e.getContext(),s=n.defines,u=n.vertexShader,c=n.fragmentShader,l=function(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===Q?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===Z?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===J&&(t="SHADOWMAP_TYPE_VSM"),t}(n),h=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ze:case Ve:t="ENVMAP_TYPE_CUBE";break;case We:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),d=function(e){var t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===Ve&&(t="ENVMAP_MODE_REFRACTION");return t}(n),f=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case De:t="ENVMAP_BLENDING_MULTIPLY";break;case Ie:t="ENVMAP_BLENDING_MIX";break;case Pe:t="ENVMAP_BLENDING_ADD"}return t}(n),p=function(e){var t=e.envMapCubeUVHeight;if(null===t)return null;var n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),v=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ds).join("\n")}(n),m=function(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(s),g=o.createProgram(),y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((i=[m].filter(ds).join("\n")).length>0&&(i+="\n"),(a=[v,m].filter(ds).join("\n")).length>0&&(a+="\n")):(i=[ks(n),"#define SHADER_NAME "+n.shaderName,m,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ds).join("\n"),a=[v,ks(n),"#define SHADER_NAME "+n.shaderName,m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+d:"",n.envMap?"#define "+f:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Re?"#define TONE_MAPPING":"",n.toneMapping!==Re?Oa.tonemapping_pars_fragment:"",n.toneMapping!==Re?hs("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Oa.encodings_pars_fragment,ls("linearToOutputTexel",n.outputEncoding),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(ds).join("\n")),u=ps(u=fs(u=ms(u),n),n),c=ps(c=fs(c=ms(c),n),n),u=ws(u),c=ws(c),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",i=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+i,a=["#define varying in",n.glslVersion===fn?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===fn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);var b,w,x=y+a+c,O=ss(o,35633,y+i+u),k=ss(o,35632,x);if(o.attachShader(g,O),o.attachShader(g,k),void 0!==n.index0AttributeName?o.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(g,0,"position"),o.linkProgram(g),e.debug.checkShaderErrors){var _=o.getProgramInfoLog(g).trim(),S=o.getShaderInfoLog(O).trim(),E=o.getShaderInfoLog(k).trim(),A=!0,j=!0;if(!1===o.getProgramParameter(g,35714)){A=!1;var T=cs(o,O,"vertex"),M=cs(o,k,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(g,35715)+"\n\nProgram Info Log: "+_+"\n"+T+"\n"+M)}else""!==_?console.warn("THREE.WebGLProgram: Program Info Log:",_):(""===S||""===E)&&(j=!1);j&&(this.diagnostics={runnable:A,programLog:_,vertexShader:{log:S,prefix:i},fragmentShader:{log:E,prefix:a}})}return o.deleteShader(O),o.deleteShader(k),this.getUniforms=function(){return void 0===b&&(b=new os(o,g)),b},this.getAttributes=function(){return void 0===w&&(w=function(e,t){for(var n={},r=e.getProgramParameter(t,35721),i=0;i<r;i++){var a=e.getActiveAttrib(t,i),o=a.name,s=1;35674===a.type&&(s=2),35675===a.type&&(s=3),35676===a.type&&(s=4),n[o]={type:a.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(o,g)),w},this.destroy=function(){r.releaseStatesOfProgram(this),o.deleteProgram(g),this.program=void 0},this.name=n.shaderName,this.id=us++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=O,this.fragmentShader=k,this}var Ss=0,Es=function(){function e(){Object(E.a)(this,e),this.shaderCache=new Map,this.materialCache=new Map}return Object(A.a)(e,[{key:"update",value:function(e){var t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(r)&&(a.add(r),r.usedTimes++),!1===a.has(i)&&(a.add(i),i.usedTimes++),this}},{key:"remove",value:function(e){var t,n=this.materialCache.get(e),r=Object(j.a)(n);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code)}}catch(a){r.e(a)}finally{r.f()}return this.materialCache.delete(e),this}},{key:"getVertexShaderID",value:function(e){return this._getShaderStage(e.vertexShader).id}},{key:"getFragmentShaderID",value:function(e){return this._getShaderStage(e.fragmentShader).id}},{key:"dispose",value:function(){this.shaderCache.clear(),this.materialCache.clear()}},{key:"_getShaderCacheForMaterial",value:function(e){var t=this.materialCache;return!1===t.has(e)&&t.set(e,new Set),t.get(e)}},{key:"_getShaderStage",value:function(e){var t=this.shaderCache;if(!1===t.has(e)){var n=new As(e);t.set(e,n)}return t.get(e)}}]),e}(),As=Object(A.a)((function e(t){Object(E.a)(this,e),this.id=Ss++,this.code=t,this.usedTimes=0}));function js(e,t,n,r,i,a,o){var s=new Gr,u=new Es,c=[],l=i.isWebGL2,h=i.logarithmicDepthBuffer,d=i.vertexTextures,f=i.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(a,s,c,v,m){var g=v.fog,y=m.geometry,b=a.isMeshStandardMaterial?v.environment:null,w=(a.isMeshStandardMaterial?n:t).get(a.envMap||b),x=w&&w.mapping===We?w.image.height:null,O=p[a.type];null!==a.precision&&((f=i.getMaxPrecision(a.precision))!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",f,"instead."));var k,_,S,E,A=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,j=void 0!==A?A.length:0,T=0;if(void 0!==y.morphAttributes.position&&(T=1),void 0!==y.morphAttributes.normal&&(T=2),void 0!==y.morphAttributes.color&&(T=3),O){var M=_a[O];k=M.vertexShader,_=M.fragmentShader}else k=a.vertexShader,_=a.fragmentShader,u.update(a),S=u.getVertexShaderID(a),E=u.getFragmentShaderID(a);var C=e.getRenderTarget(),D=a.alphaTest>0,I=a.clearcoat>0,P=a.iridescence>0;return{isWebGL2:l,shaderID:O,shaderName:a.type,vertexShader:k,fragmentShader:_,defines:a.defines,customVertexShaderID:S,customFragmentShaderID:E,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:f,instancing:!0===m.isInstancedMesh,instancingColor:!0===m.isInstancedMesh&&null!==m.instanceColor,supportsVertexTextures:d,outputEncoding:null===C?e.outputEncoding:!0===C.isXRRenderTarget?C.texture.encoding:tn,map:!!a.map,matcap:!!a.matcap,envMap:!!w,envMapMode:w&&w.mapping,envMapCubeUVHeight:x,lightMap:!!a.lightMap,aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,objectSpaceNormalMap:a.normalMapType===sn,tangentSpaceNormalMap:a.normalMapType===on,decodeVideoTexture:!!a.map&&!0===a.map.isVideoTexture&&a.map.encoding===nn,clearcoat:I,clearcoatMap:I&&!!a.clearcoatMap,clearcoatRoughnessMap:I&&!!a.clearcoatRoughnessMap,clearcoatNormalMap:I&&!!a.clearcoatNormalMap,iridescence:P,iridescenceMap:P&&!!a.iridescenceMap,iridescenceThicknessMap:P&&!!a.iridescenceThicknessMap,displacementMap:!!a.displacementMap,roughnessMap:!!a.roughnessMap,metalnessMap:!!a.metalnessMap,specularMap:!!a.specularMap,specularIntensityMap:!!a.specularIntensityMap,specularColorMap:!!a.specularColorMap,opaque:!1===a.transparent&&a.blending===re,alphaMap:!!a.alphaMap,alphaTest:D,gradientMap:!!a.gradientMap,sheen:a.sheen>0,sheenColorMap:!!a.sheenColorMap,sheenRoughnessMap:!!a.sheenRoughnessMap,transmission:a.transmission>0,transmissionMap:!!a.transmissionMap,thicknessMap:!!a.thicknessMap,combine:a.combine,vertexTangents:!!a.normalMap&&!!y.attributes.tangent,vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,vertexUvs:!!a.map||!!a.bumpMap||!!a.normalMap||!!a.specularMap||!!a.alphaMap||!!a.emissiveMap||!!a.roughnessMap||!!a.metalnessMap||!!a.clearcoatMap||!!a.clearcoatRoughnessMap||!!a.clearcoatNormalMap||!!a.iridescenceMap||!!a.iridescenceThicknessMap||!!a.displacementMap||!!a.transmissionMap||!!a.thicknessMap||!!a.specularIntensityMap||!!a.specularColorMap||!!a.sheenColorMap||!!a.sheenRoughnessMap,uvsVertexOnly:!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatNormalMap||a.iridescenceMap||a.iridescenceThicknessMap||a.transmission>0||a.transmissionMap||a.thicknessMap||a.specularIntensityMap||a.specularColorMap||a.sheen>0||a.sheenColorMap||a.sheenRoughnessMap)&&!!a.displacementMap,fog:!!g,useFog:!0===a.fog,fogExp2:g&&g.isFogExp2,flatShading:!!a.flatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===m.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:j,morphTextureStride:T,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:a.toneMapped?e.toneMapping:Re,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===te,flipSided:a.side===ee,useDepthPacking:!!a.depthPacking,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionDerivatives:a.extensions&&a.extensions.derivatives,extensionFragDepth:a.extensions&&a.extensions.fragDepth,extensionDrawBuffers:a.extensions&&a.extensions.drawBuffers,extensionShaderTextureLOD:a.extensions&&a.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||r.has("EXT_shader_texture_lod"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(var r in t.defines)n.push(r),n.push(t.defines[r]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0),t.supportsVertexTextures&&s.enable(1),t.instancing&&s.enable(2),t.instancingColor&&s.enable(3),t.map&&s.enable(4),t.matcap&&s.enable(5),t.envMap&&s.enable(6),t.lightMap&&s.enable(7),t.aoMap&&s.enable(8),t.emissiveMap&&s.enable(9),t.bumpMap&&s.enable(10),t.normalMap&&s.enable(11),t.objectSpaceNormalMap&&s.enable(12),t.tangentSpaceNormalMap&&s.enable(13),t.clearcoat&&s.enable(14),t.clearcoatMap&&s.enable(15),t.clearcoatRoughnessMap&&s.enable(16),t.clearcoatNormalMap&&s.enable(17),t.iridescence&&s.enable(18),t.iridescenceMap&&s.enable(19),t.iridescenceThicknessMap&&s.enable(20),t.displacementMap&&s.enable(21),t.specularMap&&s.enable(22),t.roughnessMap&&s.enable(23),t.metalnessMap&&s.enable(24),t.gradientMap&&s.enable(25),t.alphaMap&&s.enable(26),t.alphaTest&&s.enable(27),t.vertexColors&&s.enable(28),t.vertexAlphas&&s.enable(29),t.vertexUvs&&s.enable(30),t.vertexTangents&&s.enable(31),t.uvsVertexOnly&&s.enable(32),t.fog&&s.enable(33),e.push(s.mask),s.disableAll(),t.useFog&&s.enable(0),t.flatShading&&s.enable(1),t.logarithmicDepthBuffer&&s.enable(2),t.skinning&&s.enable(3),t.morphTargets&&s.enable(4),t.morphNormals&&s.enable(5),t.morphColors&&s.enable(6),t.premultipliedAlpha&&s.enable(7),t.shadowMapEnabled&&s.enable(8),t.physicallyCorrectLights&&s.enable(9),t.doubleSided&&s.enable(10),t.flipSided&&s.enable(11),t.useDepthPacking&&s.enable(12),t.dithering&&s.enable(13),t.specularIntensityMap&&s.enable(14),t.specularColorMap&&s.enable(15),t.transmission&&s.enable(16),t.transmissionMap&&s.enable(17),t.thicknessMap&&s.enable(18),t.sheen&&s.enable(19),t.sheenColorMap&&s.enable(20),t.sheenRoughnessMap&&s.enable(21),t.decodeVideoTexture&&s.enable(22),t.opaque&&s.enable(23),e.push(s.mask)}(n,t),n.push(e.outputEncoding)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t,n=p[e.type];if(n){var r=_a[n];t=ta.clone(r.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){for(var r,i=0,o=c.length;i<o;i++){var s=c[i];if(s.cacheKey===n){++(r=s).usedTimes;break}}return void 0===r&&(r=new _s(e,n,t,a),c.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){var t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){u.remove(e)},programs:c,dispose:function(){u.dispose()}}}function Ts(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Ms(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Cs(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Ds(){var e=[],t=0,n=[],r=[],i=[];function a(n,r,i,a,o,s){var u=e[t];return void 0===u?(u={id:n.id,object:n,geometry:r,material:i,groupOrder:a,renderOrder:n.renderOrder,z:o,group:s},e[t]=u):(u.id=n.id,u.object=n,u.geometry=r,u.material=i,u.groupOrder=a,u.renderOrder=n.renderOrder,u.z=o,u.group=s),t++,u}return{opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,o,s,u,c){var l=a(e,t,o,s,u,c);o.transmission>0?r.push(l):!0===o.transparent?i.push(l):n.push(l)},unshift:function(e,t,o,s,u,c){var l=a(e,t,o,s,u,c);o.transmission>0?r.unshift(l):!0===o.transparent?i.unshift(l):n.unshift(l)},finish:function(){for(var n=t,r=e.length;n<r;n++){var i=e[n];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Ms),r.length>1&&r.sort(t||Cs),i.length>1&&i.sort(t||Cs)}}}function Is(){var e=new WeakMap;return{get:function(t,n){var r;return!1===e.has(t)?(r=new Ds,e.set(t,[r])):n>=e.get(t).length?(r=new Ds,e.get(t).push(r)):r=e.get(t)[n],r},dispose:function(){e=new WeakMap}}}function Ps(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new tr,color:new Gn};break;case"SpotLight":n={position:new tr,direction:new tr,color:new Gn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new tr,color:new Gn,distance:0,decay:0};break;case"HemisphereLight":n={direction:new tr,skyColor:new Gn,groundColor:new Gn};break;case"RectAreaLight":n={color:new Gn,position:new tr,halfWidth:new tr,halfHeight:new tr}}return e[t.id]=n,n}}}var Rs=0;function Ls(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Ns(e,t){for(var n=new Ps,r=function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new An};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new An,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},a=0;a<9;a++)i.probe.push(new tr);var o=new tr,s=new Dr,u=new Dr;return{setup:function(a,o){for(var s=0,u=0,c=0,l=0;l<9;l++)i.probe[l].set(0,0,0);var h=0,d=0,f=0,p=0,v=0,m=0,g=0,y=0;a.sort(Ls);for(var b=!0!==o?Math.PI:1,w=0,x=a.length;w<x;w++){var O=a[w],k=O.color,_=O.intensity,S=O.distance,E=O.shadow&&O.shadow.map?O.shadow.map.texture:null;if(O.isAmbientLight)s+=k.r*_*b,u+=k.g*_*b,c+=k.b*_*b;else if(O.isLightProbe)for(var A=0;A<9;A++)i.probe[A].addScaledVector(O.sh.coefficients[A],_);else if(O.isDirectionalLight){var j=n.get(O);if(j.color.copy(O.color).multiplyScalar(O.intensity*b),O.castShadow){var T=O.shadow,M=r.get(O);M.shadowBias=T.bias,M.shadowNormalBias=T.normalBias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize,i.directionalShadow[h]=M,i.directionalShadowMap[h]=E,i.directionalShadowMatrix[h]=O.shadow.matrix,m++}i.directional[h]=j,h++}else if(O.isSpotLight){var C=n.get(O);if(C.position.setFromMatrixPosition(O.matrixWorld),C.color.copy(k).multiplyScalar(_*b),C.distance=S,C.coneCos=Math.cos(O.angle),C.penumbraCos=Math.cos(O.angle*(1-O.penumbra)),C.decay=O.decay,O.castShadow){var D=O.shadow,I=r.get(O);I.shadowBias=D.bias,I.shadowNormalBias=D.normalBias,I.shadowRadius=D.radius,I.shadowMapSize=D.mapSize,i.spotShadow[f]=I,i.spotShadowMap[f]=E,i.spotShadowMatrix[f]=O.shadow.matrix,y++}i.spot[f]=C,f++}else if(O.isRectAreaLight){var P=n.get(O);P.color.copy(k).multiplyScalar(_),P.halfWidth.set(.5*O.width,0,0),P.halfHeight.set(0,.5*O.height,0),i.rectArea[p]=P,p++}else if(O.isPointLight){var R=n.get(O);if(R.color.copy(O.color).multiplyScalar(O.intensity*b),R.distance=O.distance,R.decay=O.decay,O.castShadow){var L=O.shadow,N=r.get(O);N.shadowBias=L.bias,N.shadowNormalBias=L.normalBias,N.shadowRadius=L.radius,N.shadowMapSize=L.mapSize,N.shadowCameraNear=L.camera.near,N.shadowCameraFar=L.camera.far,i.pointShadow[d]=N,i.pointShadowMap[d]=E,i.pointShadowMatrix[d]=O.shadow.matrix,g++}i.point[d]=R,d++}else if(O.isHemisphereLight){var B=n.get(O);B.skyColor.copy(O.color).multiplyScalar(_*b),B.groundColor.copy(O.groundColor).multiplyScalar(_*b),i.hemi[v]=B,v++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=ka.LTC_FLOAT_1,i.rectAreaLTC2=ka.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=ka.LTC_HALF_1,i.rectAreaLTC2=ka.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=s,i.ambient[1]=u,i.ambient[2]=c;var F=i.hash;(F.directionalLength!==h||F.pointLength!==d||F.spotLength!==f||F.rectAreaLength!==p||F.hemiLength!==v||F.numDirectionalShadows!==m||F.numPointShadows!==g||F.numSpotShadows!==y)&&(i.directional.length=h,i.spot.length=f,i.rectArea.length=p,i.point.length=d,i.hemi.length=v,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=y,i.spotShadowMap.length=y,i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=g,i.spotShadowMatrix.length=y,F.directionalLength=h,F.pointLength=d,F.spotLength=f,F.rectAreaLength=p,F.hemiLength=v,F.numDirectionalShadows=m,F.numPointShadows=g,F.numSpotShadows=y,i.version=Rs++)},setupView:function(e,t){for(var n=0,r=0,a=0,c=0,l=0,h=t.matrixWorldInverse,d=0,f=e.length;d<f;d++){var p=e[d];if(p.isDirectionalLight){var v=i.directional[n];v.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),v.direction.sub(o),v.direction.transformDirection(h),n++}else if(p.isSpotLight){var m=i.spot[a];m.position.setFromMatrixPosition(p.matrixWorld),m.position.applyMatrix4(h),m.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),m.direction.sub(o),m.direction.transformDirection(h),a++}else if(p.isRectAreaLight){var g=i.rectArea[c];g.position.setFromMatrixPosition(p.matrixWorld),g.position.applyMatrix4(h),u.identity(),s.copy(p.matrixWorld),s.premultiply(h),u.extractRotation(s),g.halfWidth.set(.5*p.width,0,0),g.halfHeight.set(0,.5*p.height,0),g.halfWidth.applyMatrix4(u),g.halfHeight.applyMatrix4(u),c++}else if(p.isPointLight){var y=i.point[r];y.position.setFromMatrixPosition(p.matrixWorld),y.position.applyMatrix4(h),r++}else if(p.isHemisphereLight){var b=i.hemi[l];b.direction.setFromMatrixPosition(p.matrixWorld),b.direction.transformDirection(h),l++}}},state:i}}function Bs(e,t){var n=new Ns(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function Fs(e,t){var n=new WeakMap;return{get:function(r){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!1===n.has(r)?(i=new Bs(e,t),n.set(r,[i])):a>=n.get(r).length?(i=new Bs(e,t),n.get(r).push(i)):i=n.get(r)[a],i},dispose:function(){n=new WeakMap}}}var Us=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this)).isMeshDepthMaterial=!0,r.type="MeshDepthMaterial",r.depthPacking=rn,r.map=null,r.alphaMap=null,r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.wireframe=!1,r.wireframeLinewidth=1,r.setValues(e),r}return Object(A.a)(n,[{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}]),n}(mi),zs=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this)).isMeshDistanceMaterial=!0,r.type="MeshDistanceMaterial",r.referencePosition=new tr,r.nearDistance=1,r.farDistance=1e3,r.map=null,r.alphaMap=null,r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.setValues(e),r}return Object(A.a)(n,[{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}]),n}(mi),Vs="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",Gs="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function Hs(e,t,n){var r=new ya,i=new An,a=new An,o=new Qn,s=new Us({depthPacking:an}),u=new zs,c={},l=n.maxTextureSize,h={0:ee,1:$,2:te},d=new ia({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new An},radius:{value:4}},vertexShader:Vs,fragmentShader:Gs}),f=d.clone();f.defines.HORIZONTAL_PASS=1;var p=new Di;p.setAttribute("position",new wi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var v=new Qi(p,d),m=this;function g(n,r){var a=t.update(v);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,f.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Zn(i.x,i.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,a,d,v,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,a,f,v,null)}function y(t,n,r,i,a,o){var l=null,d=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(l=void 0!==d?d:!0===r.isPointLight?u:s,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){var f=l.uuid,p=n.uuid,v=c[f];void 0===v&&(v={},c[f]=v);var m=v[p];void 0===m&&(m=l.clone(),v[p]=m),l=m}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=o===J?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],l.alphaMap=n.alphaMap,l.alphaTest=n.alphaTest,l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.displacementMap=n.displacementMap,l.displacementScale=n.displacementScale,l.displacementBias=n.displacementBias,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,!0===r.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(r.matrixWorld),l.nearDistance=i,l.farDistance=a),l}function b(n,i,a,o,s){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===J)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);var u=t.update(n),c=n.material;if(Array.isArray(c))for(var l=u.groups,h=0,d=l.length;h<d;h++){var f=l[h],p=c[f.materialIndex];if(p&&p.visible){var v=y(n,p,o,a.near,a.far,s);e.renderBufferDirect(a,null,u,v,n,f)}}else if(c.visible){var m=y(n,c,o,a.near,a.far,s);e.renderBufferDirect(a,null,u,m,n,null)}}for(var g=n.children,w=0,x=g.length;w<x;w++)b(g[w],i,a,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Q,this.render=function(t,n,s){if(!1!==m.enabled&&(!1!==m.autoUpdate||!1!==m.needsUpdate)&&0!==t.length){var u=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(ne),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var f=0,p=t.length;f<p;f++){var v=t[f],y=v.shadow;if(void 0!==y){if(!1!==y.autoUpdate||!1!==y.needsUpdate){i.copy(y.mapSize);var w=y.getFrameExtents();if(i.multiply(w),a.copy(y.mapSize),(i.x>l||i.y>l)&&(i.x>l&&(a.x=Math.floor(l/w.x),i.x=a.x*w.x,y.mapSize.x=a.x),i.y>l&&(a.y=Math.floor(l/w.y),i.y=a.y*w.y,y.mapSize.y=a.y)),null===y.map){var x=this.type!==J?{minFilter:Ke,magFilter:Ke}:{};y.map=new Zn(i.x,i.y,x),y.map.texture.name=v.name+".shadowMap",y.camera.updateProjectionMatrix()}e.setRenderTarget(y.map),e.clear();for(var O=y.getViewportCount(),k=0;k<O;k++){var _=y.getViewport(k);o.set(a.x*_.x,a.y*_.y,a.x*_.z,a.y*_.w),d.viewport(o),y.updateMatrices(v,k),r=y.getFrustum(),b(n,s,y.camera,v,this.type)}!0!==y.isPointLightShadow&&this.type===J&&g(y,s),y.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",v,"has no shadow.")}m.needsUpdate=!1,e.setRenderTarget(u,c,h)}}}function Ws(e,t,n){var r,i,a=n.isWebGL2;var o=new function(){var t=!1,n=new Qn,r=null,i=new Qn(0,0,0,0);return{setMask:function(n){r!==n&&!t&&(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,o,s){!0===s&&(t*=o,r*=o,a*=o),n.set(t,r,a,o),!1===i.equals(n)&&(e.clearColor(t,r,a,o),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},s=new function(){var t=!1,n=null,r=null,i=null;return{setTest:function(e){e?z(2929):V(2929)},setMask:function(r){n!==r&&!t&&(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case _e:e.depthFunc(512);break;case Se:e.depthFunc(519);break;case Ee:e.depthFunc(513);break;case Ae:e.depthFunc(515);break;case je:e.depthFunc(514);break;case Te:e.depthFunc(518);break;case Me:e.depthFunc(516);break;case Ce:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},u=new function(){var t=!1,n=null,r=null,i=null,a=null,o=null,s=null,u=null,c=null;return{setTest:function(e){t||(e?z(2960):V(2960))},setMask:function(r){n!==r&&!t&&(e.stencilMask(r),n=r)},setFunc:function(t,n,o){(r!==t||i!==n||a!==o)&&(e.stencilFunc(t,n,o),r=t,i=n,a=o)},setOp:function(t,n,r){(o!==t||s!==n||u!==r)&&(e.stencilOp(t,n,r),o=t,s=n,u=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,a=null,o=null,s=null,u=null,c=null}}},c={},l={},h=new WeakMap,d=[],f=null,p=!1,v=null,m=null,g=null,y=null,b=null,w=null,x=null,O=!1,k=null,S=null,E=null,A=null,j=null,T=e.getParameter(35661),M=!1,C=0,D=e.getParameter(7938);-1!==D.indexOf("WebGL")?(C=parseFloat(/^WebGL (\d)/.exec(D)[1]),M=C>=1):-1!==D.indexOf("OpenGL ES")&&(C=parseFloat(/^OpenGL ES (\d)/.exec(D)[1]),M=C>=2);var I=null,P={},R=e.getParameter(3088),L=e.getParameter(2978),N=(new Qn).fromArray(R),B=(new Qn).fromArray(L);function F(t,n,r){var i=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<r;o++)e.texImage2D(n+o,0,6408,1,1,0,6408,5121,i);return a}var U={};function z(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function V(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}U[3553]=F(3553,3553,1),U[34067]=F(34067,34069,6),o.setClear(0,0,0,1),s.setClear(1),u.setClear(0),z(2929),s.setFunc(Ae),Q(!1),Z(X),z(2884),q(ne);var G=(r={},Object(_.a)(r,ue,32774),Object(_.a)(r,ce,32778),Object(_.a)(r,le,32779),r);if(a)G[he]=32775,G[de]=32776;else{var H=t.get("EXT_blend_minmax");null!==H&&(G[he]=H.MIN_EXT,G[de]=H.MAX_EXT)}var W=(i={},Object(_.a)(i,fe,0),Object(_.a)(i,pe,1),Object(_.a)(i,ve,768),Object(_.a)(i,ge,770),Object(_.a)(i,ke,776),Object(_.a)(i,xe,774),Object(_.a)(i,be,772),Object(_.a)(i,me,769),Object(_.a)(i,ye,771),Object(_.a)(i,Oe,775),Object(_.a)(i,we,773),i);function q(t,n,r,i,a,o,s,u){if(t!==ne){if(!1===p&&(z(3042),p=!0),t===se)a=a||n,o=o||r,s=s||i,(n!==m||a!==b)&&(e.blendEquationSeparate(G[n],G[a]),m=n,b=a),(r!==g||i!==y||o!==w||s!==x)&&(e.blendFuncSeparate(W[r],W[i],W[o],W[s]),g=r,y=i,w=o,x=s),v=t,O=null;else if(t!==v||u!==O){if((m!==ue||b!==ue)&&(e.blendEquation(32774),m=ue,b=ue),u)switch(t){case re:e.blendFuncSeparate(1,771,1,771);break;case ie:e.blendFunc(1,1);break;case ae:e.blendFuncSeparate(0,769,0,1);break;case oe:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case re:e.blendFuncSeparate(770,771,1,771);break;case ie:e.blendFunc(770,1);break;case ae:e.blendFuncSeparate(0,769,0,1);break;case oe:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}g=null,y=null,w=null,x=null,v=t,O=u}}else!0===p&&(V(3042),p=!1)}function Q(t){k!==t&&(t?e.frontFace(2304):e.frontFace(2305),k=t)}function Z(t){t!==Y?(z(2884),t!==S&&(t===X?e.cullFace(1029):t===K?e.cullFace(1028):e.cullFace(1032))):V(2884),S=t}function J(t,n,r){t?(z(32823),(A!==n||j!==r)&&(e.polygonOffset(n,r),A=n,j=r)):V(32823)}function $(t){void 0===t&&(t=33984+T-1),I!==t&&(e.activeTexture(t),I=t)}return{buffers:{color:o,depth:s,stencil:u},enable:z,disable:V,bindFramebuffer:function(t,n){return l[t]!==n&&(e.bindFramebuffer(t,n),l[t]=n,a&&(36009===t&&(l[36160]=n),36160===t&&(l[36009]=n)),!0)},drawBuffers:function(r,i){var a=d,o=!1;if(r)if(void 0===(a=h.get(i))&&(a=[],h.set(i,a)),r.isWebGLMultipleRenderTargets){var s=r.texture;if(a.length!==s.length||36064!==a[0]){for(var u=0,c=s.length;u<c;u++)a[u]=36064+u;a.length=s.length,o=!0}}else 36064!==a[0]&&(a[0]=36064,o=!0);else 1029!==a[0]&&(a[0]=1029,o=!0);o&&(n.isWebGL2?e.drawBuffers(a):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(a))},useProgram:function(t){return f!==t&&(e.useProgram(t),f=t,!0)},setBlending:q,setMaterial:function(e,t){e.side===te?V(2884):z(2884);var n=e.side===ee;t&&(n=!n),Q(n),e.blending===re&&!1===e.transparent?q(ne):q(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),o.setMask(e.colorWrite);var r=e.stencilWrite;u.setTest(r),r&&(u.setMask(e.stencilWriteMask),u.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),u.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),J(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?z(32926):V(32926)},setFlipSided:Q,setCullFace:Z,setLineWidth:function(t){t!==E&&(M&&e.lineWidth(t),E=t)},setPolygonOffset:J,setScissorTest:function(e){e?z(3089):V(3089)},activeTexture:$,bindTexture:function(t,n){null===I&&$();var r=P[I];void 0===r&&(r={type:void 0,texture:void 0},P[I]=r),(r.type!==t||r.texture!==n)&&(e.bindTexture(t,n||U[t]),r.type=t,r.texture=n)},unbindTexture:function(){var t=P[I];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},scissor:function(t){!1===N.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),N.copy(t))},viewport:function(t){!1===B.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),B.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===a&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},I=null,P={},l={},h=new WeakMap,d=[],f=null,p=!1,v=null,m=null,g=null,y=null,b=null,w=null,x=null,O=!1,k=null,S=null,E=null,A=null,j=null,N.set(0,0,e.canvas.width,e.canvas.height),B.set(0,0,e.canvas.width,e.canvas.height),o.reset(),s.reset(),u.reset()}}}function qs(e,t,n,r,i,a,o){var s,u,c,l=i.isWebGL2,h=i.maxTextures,d=i.maxCubemapSize,f=i.maxTextureSize,p=i.maxSamples,v=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,m=/OculusBrowser/g.test(navigator.userAgent),g=new WeakMap,y=new WeakMap,b=!1;try{b=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(W){}function w(e,t){return b?new OffscreenCanvas(e,t):Dn("canvas")}function x(e,t,n,r){var i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){var a=t?Sn:Math.floor,o=a(i*e.width),s=a(i*e.height);void 0===c&&(c=w(o,s));var u=n?w(o,s):c;return u.width=o,u.height=s,u.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),u}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function O(e){return _n(e.width)&&_n(e.height)}function k(e,t){return e.generateMipmaps&&t&&e.minFilter!==Ke&&e.minFilter!==Je}function S(t){e.generateMipmap(t)}function E(n,r,i,a){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===l)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var s=r;return 6403===r&&(5126===i&&(s=33326),5131===i&&(s=33325),5121===i&&(s=33321)),33319===r&&(5126===i&&(s=33328),5131===i&&(s=33327),5121===i&&(s=33323)),6408===r&&(5126===i&&(s=34836),5131===i&&(s=34842),5121===i&&(s=a===nn&&!1===o?35907:32856),32819===i&&(s=32854),32820===i&&(s=32855)),(33325===s||33326===s||33327===s||33328===s||34842===s||34836===s)&&t.get("EXT_color_buffer_float"),s}function A(e,t,n){return!0===k(e,n)||e.isFramebufferTexture&&e.minFilter!==Ke&&e.minFilter!==Je?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function j(e){return e===Ke||e===Qe||e===Ze?9728:9729}function T(e){var t=e.target;t.removeEventListener("dispose",T),function(e){var t=r.get(e);if(void 0===t.__webglInit)return;var n=e.source,i=y.get(n);if(i){var a=i[t.__cacheKey];a.usedTimes--,0===a.usedTimes&&C(e),0===Object.keys(i).length&&y.delete(n)}r.remove(e)}(t),t.isVideoTexture&&g.delete(t)}function M(t){var n=t.target;n.removeEventListener("dispose",M),function(t){var n=t.texture,i=r.get(t),a=r.get(n);if(void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),o.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(var s=0;s<6;s++)e.deleteFramebuffer(i.__webglFramebuffer[s]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[s]);else{if(e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer)for(var u=0;u<i.__webglColorRenderbuffer.length;u++)i.__webglColorRenderbuffer[u]&&e.deleteRenderbuffer(i.__webglColorRenderbuffer[u]);i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(var c=0,l=n.length;c<l;c++){var h=r.get(n[c]);h.__webglTexture&&(e.deleteTexture(h.__webglTexture),o.memory.textures--),r.remove(n[c])}r.remove(n),r.remove(t)}(n)}function C(t){var n=r.get(t);e.deleteTexture(n.__webglTexture);var i=t.source;delete y.get(i)[n.__cacheKey],o.memory.textures--}var D=0;function I(e,t){var i=r.get(e);if(e.isVideoTexture&&function(e){var t=o.render.frame;g.get(e)!==t&&(g.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&i.__version!==e.version){var a=e.image;if(null===a)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==a.complete)return void B(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,i.__webglTexture)}var P=(s={},Object(_.a)(s,qe,10497),Object(_.a)(s,Ye,33071),Object(_.a)(s,Xe,33648),s),R=(u={},Object(_.a)(u,Ke,9728),Object(_.a)(u,Qe,9984),Object(_.a)(u,Ze,9986),Object(_.a)(u,Je,9729),Object(_.a)(u,$e,9985),Object(_.a)(u,et,9987),u);function L(n,a,o){if(o?(e.texParameteri(n,10242,P[a.wrapS]),e.texParameteri(n,10243,P[a.wrapT]),(32879===n||35866===n)&&e.texParameteri(n,32882,P[a.wrapR]),e.texParameteri(n,10240,R[a.magFilter]),e.texParameteri(n,10241,R[a.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),(32879===n||35866===n)&&e.texParameteri(n,32882,33071),(a.wrapS!==Ye||a.wrapT!==Ye)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,j(a.magFilter)),e.texParameteri(n,10241,j(a.minFilter)),a.minFilter!==Ke&&a.minFilter!==Je&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){var s=t.get("EXT_texture_filter_anisotropic");if(a.type===st&&!1===t.has("OES_texture_float_linear")||!1===l&&a.type===ut&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||r.get(a).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy)}}function N(t,n){var r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",T));var i=n.source,a=y.get(i);void 0===a&&(a={},y.set(i,a));var s=function(e){var t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(n);if(s!==t.__cacheKey){void 0===a[s]&&(a[s]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,r=!0),a[s].usedTimes++;var u=a[t.__cacheKey];void 0!==u&&(a[t.__cacheKey].usedTimes--,0===u.usedTimes&&C(n)),t.__cacheKey=s,t.__webglTexture=a[s].texture}return r}function B(t,r,i){var o=3553;r.isDataArrayTexture&&(o=35866),r.isData3DTexture&&(o=32879);var s=N(t,r),u=r.source;if(n.activeTexture(33984+i),n.bindTexture(o,t.__webglTexture),u.version!==u.__currentVersion||!0===s){e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);var c=function(e){return!l&&(e.wrapS!==Ye||e.wrapT!==Ye||e.minFilter!==Ke&&e.minFilter!==Je)}(r)&&!1===O(r.image),h=x(r.image,c,!1,f),d=O(h=H(r,h))||l,p=a.convert(r.format,r.encoding),v=a.convert(r.type),m=E(r.internalFormat,p,v,r.encoding,r.isVideoTexture);L(o,r,d);var g,y=r.mipmaps,b=l&&!0!==r.isVideoTexture,w=void 0===u.__currentVersion||!0===s,_=A(r,h,d);if(r.isDepthTexture)m=6402,l?m=r.type===st?36012:r.type===ot?33190:r.type===ht?35056:33189:r.type===st&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===gt&&6402===m&&r.type!==it&&r.type!==ot&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=ot,v=a.convert(r.type)),r.format===yt&&6402===m&&(m=34041,r.type!==ht&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=ht,v=a.convert(r.type))),w&&(b?n.texStorage2D(3553,1,m,h.width,h.height):n.texImage2D(3553,0,m,h.width,h.height,0,p,v,null));else if(r.isDataTexture)if(y.length>0&&d){b&&w&&n.texStorage2D(3553,_,m,y[0].width,y[0].height);for(var j=0,T=y.length;j<T;j++)g=y[j],b?n.texSubImage2D(3553,j,0,0,g.width,g.height,p,v,g.data):n.texImage2D(3553,j,m,g.width,g.height,0,p,v,g.data);r.generateMipmaps=!1}else b?(w&&n.texStorage2D(3553,_,m,h.width,h.height),n.texSubImage2D(3553,0,0,0,h.width,h.height,p,v,h.data)):n.texImage2D(3553,0,m,h.width,h.height,0,p,v,h.data);else if(r.isCompressedTexture){b&&w&&n.texStorage2D(3553,_,m,y[0].width,y[0].height);for(var M=0,C=y.length;M<C;M++)g=y[M],r.format!==pt?null!==p?b?n.compressedTexSubImage2D(3553,M,0,0,g.width,g.height,p,g.data):n.compressedTexImage2D(3553,M,m,g.width,g.height,0,g.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):b?n.texSubImage2D(3553,M,0,0,g.width,g.height,p,v,g.data):n.texImage2D(3553,M,m,g.width,g.height,0,p,v,g.data)}else if(r.isDataArrayTexture)b?(w&&n.texStorage3D(35866,_,m,h.width,h.height,h.depth),n.texSubImage3D(35866,0,0,0,0,h.width,h.height,h.depth,p,v,h.data)):n.texImage3D(35866,0,m,h.width,h.height,h.depth,0,p,v,h.data);else if(r.isData3DTexture)b?(w&&n.texStorage3D(32879,_,m,h.width,h.height,h.depth),n.texSubImage3D(32879,0,0,0,0,h.width,h.height,h.depth,p,v,h.data)):n.texImage3D(32879,0,m,h.width,h.height,h.depth,0,p,v,h.data);else if(r.isFramebufferTexture){if(w)if(b)n.texStorage2D(3553,_,m,h.width,h.height);else for(var D=h.width,I=h.height,P=0;P<_;P++)n.texImage2D(3553,P,m,D,I,0,p,v,null),D>>=1,I>>=1}else if(y.length>0&&d){b&&w&&n.texStorage2D(3553,_,m,y[0].width,y[0].height);for(var R=0,B=y.length;R<B;R++)g=y[R],b?n.texSubImage2D(3553,R,0,0,p,v,g):n.texImage2D(3553,R,m,p,v,g);r.generateMipmaps=!1}else b?(w&&n.texStorage2D(3553,_,m,h.width,h.height),n.texSubImage2D(3553,0,0,0,p,v,h)):n.texImage2D(3553,0,m,p,v,h);k(r,d)&&S(o),u.__currentVersion=u.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function F(t,i,o,s,u){var c=a.convert(o.format,o.encoding),l=a.convert(o.type),h=E(o.internalFormat,c,l,o.encoding);r.get(i).__hasExternalTextures||(32879===u||35866===u?n.texImage3D(u,0,h,i.width,i.height,i.depth,0,c,l,null):n.texImage2D(u,0,h,i.width,i.height,0,c,l,null)),n.bindFramebuffer(36160,t),G(i)?v.framebufferTexture2DMultisampleEXT(36160,s,u,r.get(o).__webglTexture,0,V(i)):e.framebufferTexture2D(36160,s,u,r.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function U(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){var i=33189;if(r||G(n)){var o=n.depthTexture;o&&o.isDepthTexture&&(o.type===st?i=36012:o.type===ot&&(i=33190));var s=V(n);G(n)?v.renderbufferStorageMultisampleEXT(36161,s,i,n.width,n.height):e.renderbufferStorageMultisample(36161,s,i,n.width,n.height)}else e.renderbufferStorage(36161,i,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){var u=V(n);r&&!1===G(n)?e.renderbufferStorageMultisample(36161,u,35056,n.width,n.height):G(n)?v.renderbufferStorageMultisampleEXT(36161,u,35056,n.width,n.height):e.renderbufferStorage(36161,34041,n.width,n.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else for(var c=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture],l=0;l<c.length;l++){var h=c[l],d=a.convert(h.format,h.encoding),f=a.convert(h.type),p=E(h.internalFormat,d,f,h.encoding),m=V(n);r&&!1===G(n)?e.renderbufferStorageMultisample(36161,m,p,n.width,n.height):G(n)?v.renderbufferStorageMultisampleEXT(36161,m,p,n.width,n.height):e.renderbufferStorage(36161,p,n.width,n.height)}e.bindRenderbuffer(36161,null)}function z(t){var i=r.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(i.depthTexture).__webglTexture||i.depthTexture.image.width!==i.width||i.depthTexture.image.height!==i.height)&&(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),I(i.depthTexture,0);var a=r.get(i.depthTexture).__webglTexture,o=V(i);if(i.depthTexture.format===gt)G(i)?v.framebufferTexture2DMultisampleEXT(36160,36096,3553,a,0,o):e.framebufferTexture2D(36160,36096,3553,a,0);else{if(i.depthTexture.format!==yt)throw new Error("Unknown depthTexture format");G(i)?v.framebufferTexture2DMultisampleEXT(36160,33306,3553,a,0,o):e.framebufferTexture2D(36160,33306,3553,a,0)}}(i.__webglFramebuffer,t)}else if(a){i.__webglDepthbuffer=[];for(var o=0;o<6;o++)n.bindFramebuffer(36160,i.__webglFramebuffer[o]),i.__webglDepthbuffer[o]=e.createRenderbuffer(),U(i.__webglDepthbuffer[o],t,!1)}else n.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),U(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function V(e){return Math.min(p,e.samples)}function G(e){var n=r.get(e);return l&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function H(e,n){var r=e.encoding,i=e.format,a=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===pn||r!==tn&&(r===nn?!1===l?!0===t.has("EXT_sRGB")&&i===pt?(e.format=pn,e.minFilter=Je,e.generateMipmaps=!1):n=Wn.sRGBToLinear(n):(i!==pt||a!==tt)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",r)),n}this.allocateTextureUnit=function(){var e=D;return e>=h&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+h),D+=1,e},this.resetTextureUnits=function(){D=0},this.setTexture2D=I,this.setTexture2DArray=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?B(i,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?B(i,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=function(t,i){var o=r.get(t);t.version>0&&o.__version!==t.version?function(t,r,i){if(6!==r.image.length)return;var o=N(t,r),s=r.source;if(n.activeTexture(33984+i),n.bindTexture(34067,t.__webglTexture),s.version!==s.__currentVersion||!0===o){e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);for(var u=r.isCompressedTexture||r.image[0].isCompressedTexture,c=r.image[0]&&r.image[0].isDataTexture,h=[],f=0;f<6;f++)h[f]=u||c?c?r.image[f].image:r.image[f]:x(r.image[f],!1,!0,d),h[f]=H(r,h[f]);var p,v=h[0],m=O(v)||l,g=a.convert(r.format,r.encoding),y=a.convert(r.type),b=E(r.internalFormat,g,y,r.encoding),w=l&&!0!==r.isVideoTexture,_=void 0===s.__currentVersion||!0===o,j=A(r,v,m);if(L(34067,r,m),u){w&&_&&n.texStorage2D(34067,j,b,v.width,v.height);for(var T=0;T<6;T++){p=h[T].mipmaps;for(var M=0;M<p.length;M++){var C=p[M];r.format!==pt?null!==g?w?n.compressedTexSubImage2D(34069+T,M,0,0,C.width,C.height,g,C.data):n.compressedTexImage2D(34069+T,M,b,C.width,C.height,0,C.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):w?n.texSubImage2D(34069+T,M,0,0,C.width,C.height,g,y,C.data):n.texImage2D(34069+T,M,b,C.width,C.height,0,g,y,C.data)}}}else{p=r.mipmaps,w&&_&&(p.length>0&&j++,n.texStorage2D(34067,j,b,h[0].width,h[0].height));for(var D=0;D<6;D++)if(c){w?n.texSubImage2D(34069+D,0,0,0,h[D].width,h[D].height,g,y,h[D].data):n.texImage2D(34069+D,0,b,h[D].width,h[D].height,0,g,y,h[D].data);for(var I=0;I<p.length;I++){var P=p[I].image[D].image;w?n.texSubImage2D(34069+D,I+1,0,0,P.width,P.height,g,y,P.data):n.texImage2D(34069+D,I+1,b,P.width,P.height,0,g,y,P.data)}}else{w?n.texSubImage2D(34069+D,0,0,0,g,y,h[D]):n.texImage2D(34069+D,0,b,g,y,h[D]);for(var R=0;R<p.length;R++){var B=p[R];w?n.texSubImage2D(34069+D,R+1,0,0,g,y,B.image[D]):n.texImage2D(34069+D,R+1,b,g,y,B.image[D])}}}k(r,m)&&S(34067),s.__currentVersion=s.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}(o,t,i):(n.activeTexture(33984+i),n.bindTexture(34067,o.__webglTexture))},this.rebindTextures=function(e,t,n){var i=r.get(e);void 0!==t&&F(i.__webglFramebuffer,e,e.texture,36064,3553),void 0!==n&&z(e)},this.setupRenderTarget=function(t){var s=t.texture,u=r.get(t),c=r.get(s);t.addEventListener("dispose",M),!0!==t.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=e.createTexture()),c.__version=s.version,o.memory.textures++);var h=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,f=O(t)||l;if(h){u.__webglFramebuffer=[];for(var p=0;p<6;p++)u.__webglFramebuffer[p]=e.createFramebuffer()}else{if(u.__webglFramebuffer=e.createFramebuffer(),d)if(i.drawBuffers)for(var v=t.texture,m=0,g=v.length;m<g;m++){var y=r.get(v[m]);void 0===y.__webglTexture&&(y.__webglTexture=e.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(l&&t.samples>0&&!1===G(t)){var b=d?s:[s];u.__webglMultisampledFramebuffer=e.createFramebuffer(),u.__webglColorRenderbuffer=[],n.bindFramebuffer(36160,u.__webglMultisampledFramebuffer);for(var w=0;w<b.length;w++){var x=b[w];u.__webglColorRenderbuffer[w]=e.createRenderbuffer(),e.bindRenderbuffer(36161,u.__webglColorRenderbuffer[w]);var _=a.convert(x.format,x.encoding),A=a.convert(x.type),j=E(x.internalFormat,_,A,x.encoding),T=V(t);e.renderbufferStorageMultisample(36161,T,j,t.width,t.height),e.framebufferRenderbuffer(36160,36064+w,36161,u.__webglColorRenderbuffer[w])}e.bindRenderbuffer(36161,null),t.depthBuffer&&(u.__webglDepthRenderbuffer=e.createRenderbuffer(),U(u.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}}if(h){n.bindTexture(34067,c.__webglTexture),L(34067,s,f);for(var C=0;C<6;C++)F(u.__webglFramebuffer[C],t,s,36064,34069+C);k(s,f)&&S(34067),n.unbindTexture()}else if(d){for(var D=t.texture,I=0,P=D.length;I<P;I++){var R=D[I],N=r.get(R);n.bindTexture(3553,N.__webglTexture),L(3553,R,f),F(u.__webglFramebuffer,t,R,36064+I,3553),k(R,f)&&S(3553)}n.unbindTexture()}else{var B=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l?B=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(B,c.__webglTexture),L(B,s,f),F(u.__webglFramebuffer,t,s,36064,B),k(s,f)&&S(B),n.unbindTexture()}t.depthBuffer&&z(t)},this.updateRenderTargetMipmap=function(e){for(var t=O(e)||l,i=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture],a=0,o=i.length;a<o;a++){var s=i[a];if(k(s,t)){var u=e.isWebGLCubeRenderTarget?34067:3553,c=r.get(s).__webglTexture;n.bindTexture(u,c),S(u),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(l&&t.samples>0&&!1===G(t)){var i=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],a=t.width,o=t.height,s=16384,u=[],c=t.stencilBuffer?33306:36096,h=r.get(t),d=!0===t.isWebGLMultipleRenderTargets;if(d)for(var f=0;f<i.length;f++)n.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+f,36161,null),n.bindFramebuffer(36160,h.__webglFramebuffer),e.framebufferTexture2D(36009,36064+f,3553,null,0);n.bindFramebuffer(36008,h.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,h.__webglFramebuffer);for(var p=0;p<i.length;p++){u.push(36064+p),t.depthBuffer&&u.push(c);var v=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===v&&(t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024)),d&&e.framebufferRenderbuffer(36008,36064,36161,h.__webglColorRenderbuffer[p]),!0===v&&(e.invalidateFramebuffer(36008,[c]),e.invalidateFramebuffer(36009,[c])),d){var g=r.get(i[p]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,g,0)}e.blitFramebuffer(0,0,a,o,0,0,a,o,s,9728),m&&e.invalidateFramebuffer(36008,u)}if(n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),d)for(var y=0;y<i.length;y++){n.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+y,36161,h.__webglColorRenderbuffer[y]);var b=r.get(i[y]).__webglTexture;n.bindFramebuffer(36160,h.__webglFramebuffer),e.framebufferTexture2D(36009,36064+y,3553,b,0)}n.bindFramebuffer(36009,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=z,this.setupFrameBufferTexture=F,this.useMultisampledRTT=G}function Ys(e,t,n){var r=n.isWebGL2;return{convert:function(n){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n===tt)return 5121;if(n===ct)return 32819;if(n===lt)return 32820;if(n===nt)return 5120;if(n===rt)return 5122;if(n===it)return 5123;if(n===at)return 5124;if(n===ot)return 5125;if(n===st)return 5126;if(n===ut)return r?5131:null!==(i=t.get("OES_texture_half_float"))?i.HALF_FLOAT_OES:null;if(n===dt)return 6406;if(n===pt)return 6408;if(n===vt)return 6409;if(n===mt)return 6410;if(n===gt)return 6402;if(n===yt)return 34041;if(n===bt)return 6403;if(n===ft)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(n===pn)return null!==(i=t.get("EXT_sRGB"))?i.SRGB_ALPHA_EXT:null;if(n===wt)return 36244;if(n===xt)return 33319;if(n===Ot)return 33320;if(n===kt)return 36249;if(n===_t||n===St||n===Et||n===At)if(a===nn){if(null===(i=t.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(n===_t)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===St)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Et)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===At)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(i=t.get("WEBGL_compressed_texture_s3tc")))return null;if(n===_t)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===St)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Et)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===At)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===jt||n===Tt||n===Mt||n===Ct){if(null===(i=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(n===jt)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Tt)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Mt)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Ct)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Dt)return null!==(i=t.get("WEBGL_compressed_texture_etc1"))?i.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===It||n===Pt){if(null===(i=t.get("WEBGL_compressed_texture_etc")))return null;if(n===It)return a===nn?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(n===Pt)return a===nn?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(n===Rt||n===Lt||n===Nt||n===Bt||n===Ft||n===Ut||n===zt||n===Vt||n===Gt||n===Ht||n===Wt||n===qt||n===Yt||n===Xt){if(null===(i=t.get("WEBGL_compressed_texture_astc")))return null;if(n===Rt)return a===nn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Lt)return a===nn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Nt)return a===nn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Bt)return a===nn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Ft)return a===nn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Ut)return a===nn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===zt)return a===nn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Vt)return a===nn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Gt)return a===nn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Ht)return a===nn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Wt)return a===nn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===qt)return a===nn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Yt)return a===nn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Xt)return a===nn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Kt){if(null===(i=t.get("EXT_texture_compression_bptc")))return null;if(n===Kt)return a===nn?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}return n===ht?r?34042:null!==(i=t.get("WEBGL_depth_texture"))?i.UNSIGNED_INT_24_8_WEBGL:null:void 0!==e[n]?e[n]:null}}}var Xs=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Object(E.a)(this,n),(e=t.call(this)).isArrayCamera=!0,e.cameras=r,e}return Object(A.a)(n)}(oa),Ks=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this)).isGroup=!0,e.type="Group",e}return Object(A.a)(n)}(ri),Qs={type:"move"},Zs=function(){function e(){Object(E.a)(this,e),this._targetRay=null,this._grip=null,this._hand=null}return Object(A.a)(e,[{key:"getHandSpace",value:function(){return null===this._hand&&(this._hand=new Ks,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}},{key:"getTargetRaySpace",value:function(){return null===this._targetRay&&(this._targetRay=new Ks,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new tr,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new tr),this._targetRay}},{key:"getGripSpace",value:function(){return null===this._grip&&(this._grip=new Ks,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new tr,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new tr),this._grip}},{key:"dispatchEvent",value:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}},{key:"disconnect",value:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}},{key:"update",value:function(e,t,n){var r=null,i=null,a=null,o=this._targetRay,s=this._grip,u=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(u&&e.hand){a=!0;var c,l=Object(j.a)(e.hand.values());try{for(l.s();!(c=l.n()).done;){var h=c.value,d=t.getJointPose(h,n);if(void 0===u.joints[h.jointName]){var f=new Ks;f.matrixAutoUpdate=!1,f.visible=!1,u.joints[h.jointName]=f,u.add(f)}var p=u.joints[h.jointName];null!==d&&(p.matrix.fromArray(d.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.jointRadius=d.radius),p.visible=null!==d}}catch(y){l.e(y)}finally{l.f()}var v=u.joints["index-finger-tip"],m=u.joints["thumb-tip"],g=v.position.distanceTo(m.position);u.inputState.pinching&&g>.025?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&g<=.015&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(null!==(i=t.getPose(e.gripSpace,n))&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1));null!==o&&(null===(r=t.getPose(e.targetRaySpace,n))&&null!==i&&(r=i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Qs)))}return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==i),null!==u&&(u.visible=null!==a),this}}]),e}(),Js=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o,s,u,c,l,h){var d;if(Object(E.a)(this,n),(h=void 0!==h?h:gt)!==gt&&h!==yt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return void 0===i&&h===gt&&(i=ot),void 0===i&&h===yt&&(i=ht),(d=t.call(this,null,a,o,s,u,c,h,i,l)).isDepthTexture=!0,d.image={width:e,height:r},d.magFilter=void 0!==u?u:Ke,d.minFilter=void 0!==c?c:Ke,d.flipY=!1,d.generateMipmaps=!1,d}return Object(A.a)(n)}(Kn),$s=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;Object(E.a)(this,n),i=t.call(this);var a=Object(x.a)(i),o=null,s=1,u=null,c="local-floor",l=null,h=null,d=null,f=null,p=null,v=null,g=r.getContextAttributes(),y=null,b=null,w=[],O=[],k=new oa;k.layers.enable(1),k.viewport=new Qn;var _=new oa;_.layers.enable(2),_.viewport=new Qn;var A=[k,_],j=new Xs;j.layers.enable(1),j.layers.enable(2);var T=null,M=null;function C(e){var t=O.indexOf(e.inputSource);if(-1!==t){var n=w[t];void 0!==n&&n.dispatchEvent({type:e.type,data:e.inputSource})}}function D(){o.removeEventListener("select",C),o.removeEventListener("selectstart",C),o.removeEventListener("selectend",C),o.removeEventListener("squeeze",C),o.removeEventListener("squeezestart",C),o.removeEventListener("squeezeend",C),o.removeEventListener("end",D),o.removeEventListener("inputsourceschange",I);for(var t=0;t<w.length;t++){var n=O[t];null!==n&&(O[t]=null,w[t].disconnect(n))}T=null,M=null,e.setRenderTarget(y),p=null,f=null,d=null,o=null,b=null,B.stop(),a.isPresenting=!1,a.dispatchEvent({type:"sessionend"})}function I(e){for(var t=0;t<e.removed.length;t++){var n=e.removed[t],r=O.indexOf(n);r>=0&&(O[r]=null,w[r].dispatchEvent({type:"disconnected",data:n}))}for(var i=0;i<e.added.length;i++){var a=e.added[i],o=O.indexOf(a);if(-1===o){for(var s=0;s<w.length;s++){if(s>=O.length){O.push(a),o=s;break}if(null===O[s]){O[s]=a,o=s;break}}if(-1===o)break}var u=w[o];u&&u.dispatchEvent({type:"connected",data:a})}}i.cameraAutoUpdate=!0,i.enabled=!1,i.isPresenting=!1,i.getController=function(e){var t=w[e];return void 0===t&&(t=new Zs,w[e]=t),t.getTargetRaySpace()},i.getControllerGrip=function(e){var t=w[e];return void 0===t&&(t=new Zs,w[e]=t),t.getGripSpace()},i.getHand=function(e){var t=w[e];return void 0===t&&(t=new Zs,w[e]=t),t.getHandSpace()},i.setFramebufferScaleFactor=function(e){s=e,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},i.setReferenceSpaceType=function(e){c=e,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},i.getReferenceSpace=function(){return l||u},i.setReferenceSpace=function(e){l=e},i.getBaseLayer=function(){return null!==f?f:p},i.getBinding=function(){return d},i.getFrame=function(){return v},i.getSession=function(){return o},i.setSession=function(){var t=Object(m.a)(Object(S.a)().mark((function t(n){var i,h,v,m,w;return Object(S.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(o=n)){t.next=35;break}if(y=e.getRenderTarget(),o.addEventListener("select",C),o.addEventListener("selectstart",C),o.addEventListener("selectend",C),o.addEventListener("squeeze",C),o.addEventListener("squeezestart",C),o.addEventListener("squeezeend",C),o.addEventListener("end",D),o.addEventListener("inputsourceschange",I),t.t0=!0!==g.xrCompatible,!t.t0){t.next=14;break}return t.next=14,r.makeXRCompatible();case 14:if(void 0!==o.renderState.layers&&!1!==e.capabilities.isWebGL2){t.next=19;break}i={antialias:void 0!==o.renderState.layers||g.antialias,alpha:g.alpha,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:s},p=new XRWebGLLayer(o,r,i),o.updateRenderState({baseLayer:p}),b=new Zn(p.framebufferWidth,p.framebufferHeight,{format:pt,type:tt,encoding:e.outputEncoding}),t.next=25;break;case 19:h=null,v=null,m=null,g.depth&&(m=g.stencil?35056:33190,h=g.stencil?yt:gt,v=g.stencil?ht:ot),w={colorFormat:32856,depthFormat:m,scaleFactor:s},d=new XRWebGLBinding(o,r),f=d.createProjectionLayer(w),o.updateRenderState({layers:[f]}),b=new Zn(f.textureWidth,f.textureHeight,{format:pt,type:tt,depthTexture:new Js(f.textureWidth,f.textureHeight,v,void 0,void 0,void 0,void 0,void 0,void 0,h),stencilBuffer:g.stencil,encoding:e.outputEncoding,samples:g.antialias?4:0}),e.properties.get(b).__ignoreDepthValues=f.ignoreDepthValues;case 25:return b.isXRRenderTarget=!0,this.setFoveation(1),l=null,t.next=30,o.requestReferenceSpace(c);case 30:u=t.sent,B.setContext(o),B.start(),a.isPresenting=!0,a.dispatchEvent({type:"sessionstart"});case 35:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}();var P=new tr,R=new tr;function L(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}i.updateCamera=function(e){if(null!==o){j.near=_.near=k.near=e.near,j.far=_.far=k.far=e.far,(T!==j.near||M!==j.far)&&(o.updateRenderState({depthNear:j.near,depthFar:j.far}),T=j.near,M=j.far);var t=e.parent,n=j.cameras;L(j,t);for(var r=0;r<n.length;r++)L(n[r],t);j.matrixWorld.decompose(j.position,j.quaternion,j.scale),e.position.copy(j.position),e.quaternion.copy(j.quaternion),e.scale.copy(j.scale),e.matrix.copy(j.matrix),e.matrixWorld.copy(j.matrixWorld);for(var i=e.children,a=0,s=i.length;a<s;a++)i[a].updateMatrixWorld(!0);2===n.length?function(e,t,n){P.setFromMatrixPosition(t.matrixWorld),R.setFromMatrixPosition(n.matrixWorld);var r=P.distanceTo(R),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),u=(i[9]+1)/i[5],c=(i[9]-1)/i[5],l=(i[8]-1)/i[0],h=(a[8]+1)/a[0],d=o*l,f=o*h,p=r/(-l+h),v=p*-l;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(v),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();var m=o+p,g=s+p,y=d-v,b=f+(r-v),w=u*s/g*m,x=c*s/g*m;e.projectionMatrix.makePerspective(y,b,w,x,m,g)}(j,k,_):j.projectionMatrix.copy(k.projectionMatrix)}},i.getCamera=function(){return j},i.getFoveation=function(){return null!==f?f.fixedFoveation:null!==p?p.fixedFoveation:void 0},i.setFoveation=function(e){null!==f&&(f.fixedFoveation=e),null!==p&&void 0!==p.fixedFoveation&&(p.fixedFoveation=e)};var N=null;var B=new ba;return B.setAnimationLoop((function(t,n){if(h=n.getViewerPose(l||u),v=n,null!==h){var r=h.views;null!==p&&(e.setRenderTargetFramebuffer(b,p.framebuffer),e.setRenderTarget(b));var i=!1;r.length!==j.cameras.length&&(j.cameras.length=0,i=!0);for(var a=0;a<r.length;a++){var o=r[a],s=null;if(null!==p)s=p.getViewport(o);else{var c=d.getViewSubImage(f,o);s=c.viewport,0===a&&(e.setRenderTargetTextures(b,c.colorTexture,f.ignoreDepthValues?void 0:c.depthStencilTexture),e.setRenderTarget(b))}var m=A[a];void 0===m&&((m=new oa).layers.enable(a),m.viewport=new Qn,A[a]=m),m.matrix.fromArray(o.transform.matrix),m.projectionMatrix.fromArray(o.projectionMatrix),m.viewport.set(s.x,s.y,s.width,s.height),0===a&&j.matrix.copy(m.matrix),!0===i&&j.cameras.push(m)}}for(var g=0;g<w.length;g++){var y=O[g],x=w[g];null!==y&&void 0!==x&&x.update(y,n,l||u)}N&&N(t,n),v=null})),i.setAnimationLoop=function(e){N=e},i.dispose=function(){},i}return Object(A.a)(n)}(vn);function eu(e,t){function n(n,r){n.opacity.value=r.opacity,r.color&&n.diffuse.value.copy(r.color),r.emissive&&n.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(n.map.value=r.map),r.alphaMap&&(n.alphaMap.value=r.alphaMap),r.bumpMap&&(n.bumpMap.value=r.bumpMap,n.bumpScale.value=r.bumpScale,r.side===ee&&(n.bumpScale.value*=-1)),r.displacementMap&&(n.displacementMap.value=r.displacementMap,n.displacementScale.value=r.displacementScale,n.displacementBias.value=r.displacementBias),r.emissiveMap&&(n.emissiveMap.value=r.emissiveMap),r.normalMap&&(n.normalMap.value=r.normalMap,n.normalScale.value.copy(r.normalScale),r.side===ee&&n.normalScale.value.negate()),r.specularMap&&(n.specularMap.value=r.specularMap),r.alphaTest>0&&(n.alphaTest.value=r.alphaTest);var i,a,o=t.get(r).envMap;if(o&&(n.envMap.value=o,n.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,n.reflectivity.value=r.reflectivity,n.ior.value=r.ior,n.refractionRatio.value=r.refractionRatio),r.lightMap){n.lightMap.value=r.lightMap;var s=!0!==e.physicallyCorrectLights?Math.PI:1;n.lightMapIntensity.value=r.lightMapIntensity*s}r.aoMap&&(n.aoMap.value=r.aoMap,n.aoMapIntensity.value=r.aoMapIntensity),r.map?i=r.map:r.specularMap?i=r.specularMap:r.displacementMap?i=r.displacementMap:r.normalMap?i=r.normalMap:r.bumpMap?i=r.bumpMap:r.roughnessMap?i=r.roughnessMap:r.metalnessMap?i=r.metalnessMap:r.alphaMap?i=r.alphaMap:r.emissiveMap?i=r.emissiveMap:r.clearcoatMap?i=r.clearcoatMap:r.clearcoatNormalMap?i=r.clearcoatNormalMap:r.clearcoatRoughnessMap?i=r.clearcoatRoughnessMap:r.iridescenceMap?i=r.iridescenceMap:r.iridescenceThicknessMap?i=r.iridescenceThicknessMap:r.specularIntensityMap?i=r.specularIntensityMap:r.specularColorMap?i=r.specularColorMap:r.transmissionMap?i=r.transmissionMap:r.thicknessMap?i=r.thicknessMap:r.sheenColorMap?i=r.sheenColorMap:r.sheenRoughnessMap&&(i=r.sheenRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),n.uvTransform.value.copy(i.matrix)),r.aoMap?a=r.aoMap:r.lightMap&&(a=r.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),n.uv2Transform.value.copy(a.matrix))}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,i,a,o){r.isMeshBasicMaterial||r.isMeshLambertMaterial?n(e,r):r.isMeshToonMaterial?(n(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(n(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(n(e,r),function(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,n){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap)),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===ee&&e.clearcoatNormalScale.value.negate())),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap)),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,r,o)):r.isMeshMatcapMaterial?(n(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?n(e,r):r.isMeshDistanceMaterial?(n(e,r),function(e,t){e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?n(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){var i;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?i=t.map:t.alphaMap&&(i=t.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,r,i,a):r.isSpriteMaterial?function(e,t){var n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function tu(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isWebGLRenderer=!0;var t,n=void 0!==e.canvas?e.canvas:function(){var e=Dn("canvas");return e.style.display="block",e}(),r=void 0!==e.context?e.context:null,i=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,u=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",l=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;t=null!==r?r.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;var h=null,d=null,f=[],p=[];this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=tn,this.physicallyCorrectLights=!1,this.toneMapping=Re,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});var v=this,m=!1,g=0,y=0,b=null,w=-1,x=null,O=new Qn,k=new Qn,_=null,S=n.width,E=n.height,A=1,j=null,T=null,M=new Qn(0,0,S,E),C=new Qn(0,0,S,E),D=!1,I=new ya,P=!1,R=!1,L=null,N=new Dr,B=new An,F=new tr,U={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function z(){return null===b?A:1}var V,G,H,q,Y,X,K,Q,Z,J,ne,re,ie,ae,oe,se,ue,ce,le,he,de,fe,pe,ve=r;function me(e,t){for(var r=0;r<e.length;r++){var i=e[r],a=n.getContext(i,t);if(null!==a)return a}return null}try{var ge={alpha:!0,depth:i,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:u,powerPreference:c,failIfMajorPerformanceCaveat:l};if("setAttribute"in n&&n.setAttribute("data-engine","three.js r".concat(W)),n.addEventListener("webglcontextlost",xe,!1),n.addEventListener("webglcontextrestored",Oe,!1),n.addEventListener("webglcontextcreationerror",ke,!1),null===ve){var ye=["webgl2","webgl","experimental-webgl"];if(!0===v.isWebGL1Renderer&&ye.shift(),null===(ve=me(ye,ge)))throw me(ye)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ve.getShaderPrecisionFormat&&(ve.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ge){throw console.error("THREE.WebGLRenderer: "+ge.message),ge}function be(){V=new Ya(ve),G=new ja(ve,V,e),V.init(G),fe=new Ys(ve,V,G),H=new Ws(ve,V,G),q=new Qa,Y=new Ts,X=new qs(ve,V,H,Y,G,fe,q),K=new Ma(v),Q=new qa(v),Z=new wa(ve,G),pe=new Ea(ve,V,Z,G),J=new Xa(ve,Z,q,pe),ne=new to(ve,J,Z,q),le=new eo(ve,G,X),se=new Ta(Y),re=new js(v,K,Q,V,G,pe,se),ie=new eu(v,Y),ae=new Is,oe=new Fs(V,G),ce=new Sa(v,K,H,ne,t,s),ue=new Hs(v,ne,G),he=new Aa(ve,V,q,G),de=new Ka(ve,V,q,G),q.programs=re.programs,v.capabilities=G,v.extensions=V,v.properties=Y,v.renderLists=ae,v.shadowMap=ue,v.state=H,v.info=q}be();var we=new $s(v,ve);function xe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function Oe(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1;var e=q.autoReset,t=ue.enabled,n=ue.autoUpdate,r=ue.needsUpdate,i=ue.type;be(),q.autoReset=e,ue.enabled=t,ue.autoUpdate=n,ue.needsUpdate=r,ue.type=i}function ke(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function _e(e){var t=e.target;t.removeEventListener("dispose",_e),function(e){(function(e){var t=Y.get(e).programs;void 0!==t&&(t.forEach((function(e){re.releaseProgram(e)})),e.isShaderMaterial&&re.releaseShaderCache(e))})(e),Y.remove(e)}(t)}this.xr=we,this.getContext=function(){return ve},this.getContextAttributes=function(){return ve.getContextAttributes()},this.forceContextLoss=function(){var e=V.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=V.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return A},this.setPixelRatio=function(e){void 0!==e&&(A=e,this.setSize(S,E,!1))},this.getSize=function(e){return e.set(S,E)},this.setSize=function(e,t,r){we.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(S=e,E=t,n.width=Math.floor(e*A),n.height=Math.floor(t*A),!1!==r&&(n.style.width=e+"px",n.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(S*A,E*A).floor()},this.setDrawingBufferSize=function(e,t,r){S=e,E=t,A=r,n.width=Math.floor(e*r),n.height=Math.floor(t*r),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(O)},this.getViewport=function(e){return e.copy(M)},this.setViewport=function(e,t,n,r){e.isVector4?M.set(e.x,e.y,e.z,e.w):M.set(e,t,n,r),H.viewport(O.copy(M).multiplyScalar(A).floor())},this.getScissor=function(e){return e.copy(C)},this.setScissor=function(e,t,n,r){e.isVector4?C.set(e.x,e.y,e.z,e.w):C.set(e,t,n,r),H.scissor(k.copy(C).multiplyScalar(A).floor())},this.getScissorTest=function(){return D},this.setScissorTest=function(e){H.setScissorTest(D=e)},this.setOpaqueSort=function(e){j=e},this.setTransparentSort=function(e){T=e},this.getClearColor=function(e){return e.copy(ce.getClearColor())},this.setClearColor=function(){ce.setClearColor.apply(ce,arguments)},this.getClearAlpha=function(){return ce.getClearAlpha()},this.setClearAlpha=function(){ce.setClearAlpha.apply(ce,arguments)},this.clear=function(){var e=0;(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(e|=16384),(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&(e|=256),(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&(e|=1024),ve.clear(e)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",xe,!1),n.removeEventListener("webglcontextrestored",Oe,!1),n.removeEventListener("webglcontextcreationerror",ke,!1),ae.dispose(),oe.dispose(),Y.dispose(),K.dispose(),Q.dispose(),ne.dispose(),pe.dispose(),re.dispose(),we.dispose(),we.removeEventListener("sessionstart",Ee),we.removeEventListener("sessionend",Ae),L&&(L.dispose(),L=null),je.stop()},this.renderBufferDirect=function(e,t,n,r,i,a){null===t&&(t=U);var o=i.isMesh&&i.matrixWorld.determinant()<0,s=function(e,t,n,r,i){!0!==t.isScene&&(t=U),X.resetTextureUnits();var a=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===b?v.outputEncoding:!0===b.isXRRenderTarget?b.texture.encoding:tn,u=(r.isMeshStandardMaterial?Q:K).get(r.envMap||o),c=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,l=!!r.normalMap&&!!n.attributes.tangent,h=!!n.morphAttributes.position,f=!!n.morphAttributes.normal,p=!!n.morphAttributes.color,m=r.toneMapped?v.toneMapping:Re,g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,y=void 0!==g?g.length:0,O=Y.get(r),k=d.state.lights;if(!0===P&&(!0===R||e!==x)){var _=e===x&&r.id===w;se.setState(r,e,_)}var S=!1;r.version===O.__version?(O.needsLights&&O.lightsStateVersion!==k.state.version||O.outputEncoding!==s||i.isInstancedMesh&&!1===O.instancing||!i.isInstancedMesh&&!0===O.instancing||i.isSkinnedMesh&&!1===O.skinning||!i.isSkinnedMesh&&!0===O.skinning||O.envMap!==u||!0===r.fog&&O.fog!==a||void 0!==O.numClippingPlanes&&(O.numClippingPlanes!==se.numPlanes||O.numIntersection!==se.numIntersection)||O.vertexAlphas!==c||O.vertexTangents!==l||O.morphTargets!==h||O.morphNormals!==f||O.morphColors!==p||O.toneMapping!==m||!0===G.isWebGL2&&O.morphTargetsCount!==y)&&(S=!0):(S=!0,O.__version=r.version);var j=O.currentProgram;!0===S&&(j=Ie(r,t,i));var T=!1,M=!1,C=!1,D=j.getUniforms(),I=O.uniforms;if(H.useProgram(j.program)&&(T=!0,M=!0,C=!0),r.id!==w&&(w=r.id,M=!0),T||x!==e){if(D.setValue(ve,"projectionMatrix",e.projectionMatrix),G.logarithmicDepthBuffer&&D.setValue(ve,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),x!==e&&(x=e,M=!0,C=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){var N=D.map.cameraPosition;void 0!==N&&N.setValue(ve,F.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&D.setValue(ve,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||i.isSkinnedMesh)&&D.setValue(ve,"viewMatrix",e.matrixWorldInverse)}if(i.isSkinnedMesh){D.setOptional(ve,i,"bindMatrix"),D.setOptional(ve,i,"bindMatrixInverse");var B=i.skeleton;B&&(G.floatVertexTextures?(null===B.boneTexture&&B.computeBoneTexture(),D.setValue(ve,"boneTexture",B.boneTexture,X),D.setValue(ve,"boneTextureSize",B.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}var z=n.morphAttributes;return(void 0!==z.position||void 0!==z.normal||void 0!==z.color&&!0===G.isWebGL2)&&le.update(i,n,r,j),(M||O.receiveShadow!==i.receiveShadow)&&(O.receiveShadow=i.receiveShadow,D.setValue(ve,"receiveShadow",i.receiveShadow)),M&&(D.setValue(ve,"toneMappingExposure",v.toneMappingExposure),O.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(I,C),a&&!0===r.fog&&ie.refreshFogUniforms(I,a),ie.refreshMaterialUniforms(I,r,A,E,L),os.upload(ve,O.uniformsList,I,X)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(os.upload(ve,O.uniformsList,I,X),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&D.setValue(ve,"center",i.center),D.setValue(ve,"modelViewMatrix",i.modelViewMatrix),D.setValue(ve,"normalMatrix",i.normalMatrix),D.setValue(ve,"modelMatrix",i.matrixWorld),j}(e,t,n,r,i);H.setMaterial(r,o);var u=n.index,c=n.attributes.position;if(null===u){if(void 0===c||0===c.count)return}else if(0===u.count)return;var l=1;!0===r.wireframe&&(u=J.getWireframeAttribute(n),l=2),pe.setup(i,r,s,n,u);var h,f=he;null!==u&&(h=Z.get(u),(f=de).setIndex(h));var p=null!==u?u.count:c.count,m=n.drawRange.start*l,g=n.drawRange.count*l,y=null!==a?a.start*l:0,O=null!==a?a.count*l:1/0,k=Math.max(m,y),_=Math.min(p,m+g,y+O)-1,S=Math.max(0,_-k+1);if(0!==S){if(i.isMesh)!0===r.wireframe?(H.setLineWidth(r.wireframeLinewidth*z()),f.setMode(1)):f.setMode(4);else if(i.isLine){var j=r.linewidth;void 0===j&&(j=1),H.setLineWidth(j*z()),i.isLineSegments?f.setMode(1):i.isLineLoop?f.setMode(2):f.setMode(3)}else i.isPoints?f.setMode(0):i.isSprite&&f.setMode(4);if(i.isInstancedMesh)f.renderInstances(k,S,i.count);else if(n.isInstancedBufferGeometry){var T=Math.min(n.instanceCount,n._maxInstanceCount);f.renderInstances(k,S,T)}else f.render(k,S)}},this.compile=function(e,t){(d=oe.get(e)).init(),p.push(d),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(v.physicallyCorrectLights),e.traverse((function(t){var n=t.material;if(n)if(Array.isArray(n))for(var r=0;r<n.length;r++){Ie(n[r],e,t)}else Ie(n,e,t)})),p.pop(),d=null};var Se=null;function Ee(){je.stop()}function Ae(){je.start()}var je=new ba;function Te(e,t,n,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||I.intersectsSprite(e)){r&&F.setFromMatrixPosition(e.matrixWorld).applyMatrix4(N);var i=ne.update(e),a=e.material;a.visible&&h.push(e,i,a,n,F.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==q.render.frame&&(e.skeleton.update(),e.skeleton.frame=q.render.frame),!e.frustumCulled||I.intersectsObject(e))){r&&F.setFromMatrixPosition(e.matrixWorld).applyMatrix4(N);var o=ne.update(e),s=e.material;if(Array.isArray(s))for(var u=o.groups,c=0,l=u.length;c<l;c++){var f=u[c],p=s[f.materialIndex];p&&p.visible&&h.push(e,o,p,n,F.z,f)}else s.visible&&h.push(e,o,s,n,F.z,null)}for(var v=e.children,m=0,g=v.length;m<g;m++)Te(v[m],t,n,r)}}function Me(e,t,n,r){var i=e.opaque,a=e.transmissive,s=e.transparent;d.setupLightsView(n),a.length>0&&function(e,t,n){var r=G.isWebGL2;null===L&&(L=new Zn(1,1,{generateMipmaps:!0,type:V.has("EXT_color_buffer_half_float")?ut:tt,minFilter:et,samples:r&&!0===o?4:0})),v.getDrawingBufferSize(B),r?L.setSize(B.x,B.y):L.setSize(Sn(B.x),Sn(B.y));var i=v.getRenderTarget();v.setRenderTarget(L),v.clear();var a=v.toneMapping;v.toneMapping=Re,Ce(e,t,n),v.toneMapping=a,X.updateMultisampleRenderTarget(L),X.updateRenderTargetMipmap(L),v.setRenderTarget(i)}(i,t,n),r&&H.viewport(O.copy(r)),i.length>0&&Ce(i,t,n),a.length>0&&Ce(a,t,n),s.length>0&&Ce(s,t,n),H.buffers.depth.setTest(!0),H.buffers.depth.setMask(!0),H.buffers.color.setMask(!0),H.setPolygonOffset(!1)}function Ce(e,t,n){for(var r=!0===t.isScene?t.overrideMaterial:null,i=0,a=e.length;i<a;i++){var o=e[i],s=o.object,u=o.geometry,c=null===r?o.material:r,l=o.group;s.layers.test(n.layers)&&De(s,t,n,u,c,l)}}function De(e,t,n,r,i,a){e.onBeforeRender(v,t,n,r,i,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(v,t,n,r,e,a),!0===i.transparent&&i.side===te?(i.side=ee,i.needsUpdate=!0,v.renderBufferDirect(n,t,r,i,e,a),i.side=$,i.needsUpdate=!0,v.renderBufferDirect(n,t,r,i,e,a),i.side=te):v.renderBufferDirect(n,t,r,i,e,a),e.onAfterRender(v,t,n,r,i,a)}function Ie(e,t,n){!0!==t.isScene&&(t=U);var r=Y.get(e),i=d.state.lights,a=d.state.shadowsArray,o=i.state.version,s=re.getParameters(e,i.state,a,t,n),u=re.getProgramCacheKey(s),c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?Q:K).get(e.envMap||r.environment),void 0===c&&(e.addEventListener("dispose",_e),c=new Map,r.programs=c);var l=c.get(u);if(void 0!==l){if(r.currentProgram===l&&r.lightsStateVersion===o)return Pe(e,s),l}else s.uniforms=re.getUniforms(e),e.onBuild(n,s,v),e.onBeforeCompile(s,v),l=re.acquireProgram(s,u),c.set(u,l),r.uniforms=s.uniforms;var h=r.uniforms;(!e.isShaderMaterial&&!e.isRawShaderMaterial||!0===e.clipping)&&(h.clippingPlanes=se.uniform),Pe(e,s),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=o,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);var f=l.getUniforms(),p=os.seqWithValue(f.seq,h);return r.currentProgram=l,r.uniformsList=p,l}function Pe(e,t){var n=Y.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}je.setAnimationLoop((function(e){Se&&Se(e)})),typeof self<"u"&&je.setContext(self),this.setAnimationLoop=function(e){Se=e,we.setAnimationLoop(e),null===e?je.stop():je.start()},we.addEventListener("sessionstart",Ee),we.addEventListener("sessionend",Ae),this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==m){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===we.enabled&&!0===we.isPresenting&&(!0===we.cameraAutoUpdate&&we.updateCamera(t),t=we.getCamera()),!0===e.isScene&&e.onBeforeRender(v,e,t,b),(d=oe.get(e,p.length)).init(),p.push(d),N.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),I.setFromProjectionMatrix(N),R=this.localClippingEnabled,P=se.init(this.clippingPlanes,R,t),(h=ae.get(e,f.length)).init(),f.push(h),Te(e,t,0,v.sortObjects),h.finish(),!0===v.sortObjects&&h.sort(j,T),!0===P&&se.beginShadows();var n=d.state.shadowsArray;if(ue.render(n,e,t),!0===P&&se.endShadows(),!0===this.info.autoReset&&this.info.reset(),ce.render(h,e),d.setupLights(v.physicallyCorrectLights),t.isArrayCamera)for(var r=t.cameras,i=0,a=r.length;i<a;i++){var o=r[i];Me(h,e,o,o.viewport)}else Me(h,e,t);null!==b&&(X.updateMultisampleRenderTarget(b),X.updateRenderTargetMipmap(b)),!0===e.isScene&&e.onAfterRender(v,e,t),pe.resetDefaultState(),w=-1,x=null,p.pop(),d=p.length>0?p[p.length-1]:null,f.pop(),h=f.length>0?f[f.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return b},this.setRenderTargetTextures=function(e,t,n){Y.get(e.texture).__webglTexture=t,Y.get(e.depthTexture).__webglTexture=n;var r=Y.get(e);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===V.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){var n=Y.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;b=e,g=t,y=n;var r=!0;if(e){var i=Y.get(e);void 0!==i.__useDefaultFramebuffer?(H.bindFramebuffer(36160,null),r=!1):void 0===i.__webglFramebuffer?X.setupRenderTarget(e):i.__hasExternalTextures&&X.rebindTextures(e,Y.get(e.texture).__webglTexture,Y.get(e.depthTexture).__webglTexture)}var a=null,o=!1,s=!1;if(e){var u=e.texture;(u.isData3DTexture||u.isDataArrayTexture)&&(s=!0);var c=Y.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(a=c[t],o=!0):a=G.isWebGL2&&e.samples>0&&!1===X.useMultisampledRTT(e)?Y.get(e).__webglMultisampledFramebuffer:c,O.copy(e.viewport),k.copy(e.scissor),_=e.scissorTest}else O.copy(M).multiplyScalar(A).floor(),k.copy(C).multiplyScalar(A).floor(),_=D;if(H.bindFramebuffer(36160,a)&&G.drawBuffers&&r&&H.drawBuffers(e,a),H.viewport(O),H.scissor(k),H.setScissorTest(_),o){var l=Y.get(e.texture);ve.framebufferTexture2D(36160,36064,34069+t,l.__webglTexture,n)}else if(s){var h=Y.get(e.texture),d=t||0;ve.framebufferTextureLayer(36160,36064,h.__webglTexture,n||0,d)}w=-1},this.readRenderTargetPixels=function(e,t,n,r,i,a,o){if(e&&e.isWebGLRenderTarget){var s=Y.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){H.bindFramebuffer(36160,s);try{var u=e.texture,c=u.format,l=u.type;if(c!==pt&&fe.convert(c)!==ve.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var h=l===ut&&(V.has("EXT_color_buffer_half_float")||G.isWebGL2&&V.has("EXT_color_buffer_float"));if(l!==tt&&fe.convert(l)!==ve.getParameter(35738)&&(l!==st||!(G.isWebGL2||V.has("OES_texture_float")||V.has("WEBGL_color_buffer_float")))&&!h)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&ve.readPixels(t,n,r,i,fe.convert(c),fe.convert(l),a)}finally{var d=null!==b?Y.get(b).__webglFramebuffer:null;H.bindFramebuffer(36160,d)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Math.pow(2,-n),i=Math.floor(t.image.width*r),a=Math.floor(t.image.height*r);X.setTexture2D(t,0),ve.copyTexSubImage2D(3553,n,0,0,e.x,e.y,i,a),H.unbindTexture()},this.copyTextureToTexture=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=t.image.width,a=t.image.height,o=fe.convert(n.format),s=fe.convert(n.type);X.setTexture2D(n,0),ve.pixelStorei(37440,n.flipY),ve.pixelStorei(37441,n.premultiplyAlpha),ve.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?ve.texSubImage2D(3553,r,e.x,e.y,i,a,o,s,t.image.data):t.isCompressedTexture?ve.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):ve.texSubImage2D(3553,r,e.x,e.y,o,s,t.image),0===r&&n.generateMipmaps&&ve.generateMipmap(3553),H.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(v.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var a,o=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,u=e.max.z-e.min.z+1,c=fe.convert(r.format),l=fe.convert(r.type);if(r.isData3DTexture)X.setTexture3D(r,0),a=32879;else{if(!r.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");X.setTexture2DArray(r,0),a=35866}ve.pixelStorei(37440,r.flipY),ve.pixelStorei(37441,r.premultiplyAlpha),ve.pixelStorei(3317,r.unpackAlignment);var h=ve.getParameter(3314),d=ve.getParameter(32878),f=ve.getParameter(3316),p=ve.getParameter(3315),m=ve.getParameter(32877),g=n.isCompressedTexture?n.mipmaps[0]:n.image;ve.pixelStorei(3314,g.width),ve.pixelStorei(32878,g.height),ve.pixelStorei(3316,e.min.x),ve.pixelStorei(3315,e.min.y),ve.pixelStorei(32877,e.min.z),n.isDataTexture||n.isData3DTexture?ve.texSubImage3D(a,i,t.x,t.y,t.z,o,s,u,c,l,g.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ve.compressedTexSubImage3D(a,i,t.x,t.y,t.z,o,s,u,c,g.data)):ve.texSubImage3D(a,i,t.x,t.y,t.z,o,s,u,c,l,g),ve.pixelStorei(3314,h),ve.pixelStorei(32878,d),ve.pixelStorei(3316,f),ve.pixelStorei(3315,p),ve.pixelStorei(32877,m),0===i&&r.generateMipmaps&&ve.generateMipmap(a),H.unbindTexture()}},this.initTexture=function(e){e.isCubeTexture?X.setTextureCube(e,0):e.isData3DTexture?X.setTexture3D(e,0):e.isDataArrayTexture?X.setTexture2DArray(e,0):X.setTexture2D(e,0),H.unbindTexture()},this.resetState=function(){g=0,y=0,b=null,H.reset(),pe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var nu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n)}(tu);nu.prototype.isWebGL1Renderer=!0;var ru=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;Object(E.a)(this,e),this.isFog=!0,this.name="",this.color=new Gn(t),this.near=n,this.far=r}return Object(A.a)(e,[{key:"clone",value:function(){return new e(this.color,this.near,this.far)}},{key:"toJSON",value:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}]),e}(),iu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this)).isScene=!0,e.type="Scene",e.background=null,e.environment=null,e.fog=null,e.overrideMaterial=null,e.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:Object(x.a)(e)})),e}return Object(A.a)(n,[{key:"copy",value:function(e,t){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var t=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this,e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}]),n}(ri),au=function(){function e(t,n){Object(E.a)(this,e),this.isInterleavedBuffer=!0,this.array=t,this.stride=n,this.count=void 0!==t?t.length/n:0,this.usage=dn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=wn()}return Object(A.a)(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"clone",value:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=wn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"toJSON",value:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=wn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}]),e}(),ou=new tr,su=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Object(E.a)(this,e),this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=n,this.offset=r,this.normalized=!0===i}return Object(A.a)(e,[{key:"count",get:function(){return this.data.count}},{key:"array",get:function(){return this.data.array}},{key:"needsUpdate",set:function(e){this.data.needsUpdate=e}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.data.count;t<n;t++)ou.fromBufferAttribute(this,t),ou.applyMatrix4(e),this.setXYZ(t,ou.x,ou.y,ou.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)ou.fromBufferAttribute(this,t),ou.applyNormalMatrix(e),this.setXYZ(t,ou.x,ou.y,ou.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)ou.fromBufferAttribute(this,t),ou.transformDirection(e),this.setXYZ(t,ou.x,ou.y,ou.z);return this}},{key:"setX",value:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}},{key:"setY",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}},{key:"setZ",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}},{key:"setW",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}},{key:"getX",value:function(e){return this.data.array[e*this.data.stride+this.offset]}},{key:"getY",value:function(e){return this.data.array[e*this.data.stride+this.offset+1]}},{key:"getZ",value:function(e){return this.data.array[e*this.data.stride+this.offset+2]}},{key:"getW",value:function(e){return this.data.array[e*this.data.stride+this.offset+3]}},{key:"setXY",value:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}},{key:"setXYZW",value:function(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}},{key:"clone",value:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");for(var n=[],r=0;r<this.count;r++)for(var i=r*this.data.stride+this.offset,a=0;a<this.itemSize;a++)n.push(this.data.array[i+a]);return new wi(new this.array.constructor(n),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new e(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}},{key:"toJSON",value:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");for(var t=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,i=0;i<this.itemSize;i++)t.push(this.data.array[r+i]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}]),e}(),uu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Object(E.a)(this,n),"number"==typeof i&&(o=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),(a=t.call(this,e,r,i)).isInstancedBufferAttribute=!0,a.meshPerAttribute=o,a}return Object(A.a)(n,[{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"toJSON",value:function(){var e=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}]),n}(wi),cu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this)).isLineBasicMaterial=!0,r.type="LineBasicMaterial",r.color=new Gn(16777215),r.linewidth=1,r.linecap="round",r.linejoin="round",r.fog=!0,r.setValues(e),r}return Object(A.a)(n,[{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}]),n}(mi),lu=new tr,hu=new tr,du=new Dr,fu=new Cr,pu=new kr,vu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Di,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new cu;return Object(E.a)(this,n),(e=t.call(this)).isLine=!0,e.type="Line",e.geometry=r,e.material=i,e.updateMorphTargets(),e}return Object(A.a)(n,[{key:"copy",value:function(e,t){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e,t),this.material=e.material,this.geometry=e.geometry,this}},{key:"computeLineDistances",value:function(){var e=this.geometry;if(null===e.index){for(var t=e.attributes.position,n=[0],r=1,i=t.count;r<i;r++)lu.fromBufferAttribute(t,r-1),hu.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=lu.distanceTo(hu);e.setAttribute("lineDistance",new _i(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},{key:"raycast",value:function(e,t){var n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),pu.copy(n.boundingSphere),pu.applyMatrix4(r),pu.radius+=i,!1!==e.ray.intersectsSphere(pu)){du.copy(r).invert(),fu.copy(e.ray).applyMatrix4(du);var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,u=new tr,c=new tr,l=new tr,h=new tr,d=this.isLineSegments?2:1,f=n.index,p=n.attributes.position;if(null!==f)for(var v=Math.max(0,a.start),m=Math.min(f.count,a.start+a.count)-1;v<m;v+=d){var g=f.getX(v),y=f.getX(v+1);if(u.fromBufferAttribute(p,g),c.fromBufferAttribute(p,y),!(fu.distanceSqToSegment(u,c,h,l)>s)){h.applyMatrix4(this.matrixWorld);var b=e.ray.origin.distanceTo(h);b<e.near||b>e.far||t.push({distance:b,point:l.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(var w=Math.max(0,a.start),x=Math.min(p.count,a.start+a.count)-1;w<x;w+=d)if(u.fromBufferAttribute(p,w),c.fromBufferAttribute(p,w+1),!(fu.distanceSqToSegment(u,c,h,l)>s)){h.applyMatrix4(this.matrixWorld);var O=e.ray.origin.distanceTo(h);O<e.near||O>e.far||t.push({distance:O,point:l.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,i=n.length;r<i;r++){var a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}]),n}(ri),mu=new tr,gu=new tr,yu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;return Object(E.a)(this,n),(i=t.call(this,e,r)).isLineSegments=!0,i.type="LineSegments",i}return Object(A.a)(n,[{key:"computeLineDistances",value:function(){var e=this.geometry;if(null===e.index){for(var t=e.attributes.position,n=[],r=0,i=t.count;r<i;r+=2)mu.fromBufferAttribute(t,r),gu.fromBufferAttribute(t,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+mu.distanceTo(gu);e.setAttribute("lineDistance",new _i(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}]),n}(vu),bu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o,s,u,c,l){var h;Object(E.a)(this,n),(h=t.call(this,e,r,i,a,o,s,u,c,l)).isVideoTexture=!0,h.minFilter=void 0!==s?s:Je,h.magFilter=void 0!==o?o:Je,h.generateMipmaps=!1;var d=Object(x.a)(h);return"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){d.needsUpdate=!0,e.requestVideoFrameCallback(t)})),h}return Object(A.a)(n,[{key:"clone",value:function(){return new this.constructor(this.image).copy(this)}},{key:"update",value:function(){var e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}]),n}(Kn),wu=function(){function e(){Object(E.a)(this,e),this.type="Curve",this.arcLengthDivisions=200}return Object(A.a)(e,[{key:"getPoint",value:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}},{key:"getPointAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)}},{key:"getPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}},{key:"getLength",value:function(){var e=this.getLengths();return e[e.length-1]}},{key:"getLengths",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],r=this.getPoint(0),i=0;n.push(0);for(var a=1;a<=e;a++)i+=(t=this.getPoint(a/e)).distanceTo(r),n.push(i),r=t;return this.cacheArcLengths=n,n}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.getLengths()}},{key:"getUtoTmapping",value:function(e,t){var n,r=this.getLengths(),i=0,a=r.length;n=t||e*r[a-1];for(var o,s=0,u=a-1;s<=u;)if((o=r[i=Math.floor(s+(u-s)/2)]-n)<0)s=i+1;else{if(!(o>0)){u=i;break}u=i-1}if(r[i=u]===n)return i/(a-1);var c=r[i];return(i+(n-c)/(r[i+1]-c))/(a-1)}},{key:"getTangent",value:function(e,t){var n=e-1e-4,r=e+1e-4;n<0&&(n=0),r>1&&(r=1);var i=this.getPoint(n),a=this.getPoint(r),o=t||(i.isVector2?new An:new tr);return o.copy(a).sub(i).normalize(),o}},{key:"getTangentAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getTangent(n,t)}},{key:"computeFrenetFrames",value:function(e,t){for(var n=new tr,r=[],i=[],a=[],o=new tr,s=new Dr,u=0;u<=e;u++){var c=u/e;r[u]=this.getTangentAt(c,new tr)}i[0]=new tr,a[0]=new tr;var l=Number.MAX_VALUE,h=Math.abs(r[0].x),d=Math.abs(r[0].y),f=Math.abs(r[0].z);h<=l&&(l=h,n.set(1,0,0)),d<=l&&(l=d,n.set(0,1,0)),f<=l&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),a[0].crossVectors(r[0],i[0]);for(var p=1;p<=e;p++){if(i[p]=i[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(r[p-1],r[p]),o.length()>Number.EPSILON){o.normalize();var v=Math.acos(xn(r[p-1].dot(r[p]),-1,1));i[p].applyMatrix4(s.makeRotationAxis(o,v))}a[p].crossVectors(r[p],i[p])}if(!0===t){var m=Math.acos(xn(i[0].dot(i[e]),-1,1));m/=e,r[0].dot(o.crossVectors(i[0],i[e]))>0&&(m=-m);for(var g=1;g<=e;g++)i[g].applyMatrix4(s.makeRotationAxis(r[g],m*g)),a[g].crossVectors(r[g],i[g])}return{tangents:r,normals:i,binormals:a}}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}},{key:"fromJSON",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}]),e}(),xu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;return Object(E.a)(this,n),(e=t.call(this)).isEllipseCurve=!0,e.type="EllipseCurve",e.aX=r,e.aY=i,e.xRadius=a,e.yRadius=o,e.aStartAngle=s,e.aEndAngle=u,e.aClockwise=c,e.aRotation=l,e}return Object(A.a)(n,[{key:"getPoint",value:function(e,t){for(var n=t||new An,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,a=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=a?0:r),!0===this.aClockwise&&!a&&(i===r?i=-r:i-=r);var o=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var c=Math.cos(this.aRotation),l=Math.sin(this.aRotation),h=s-this.aX,d=u-this.aY;s=h*c-d*l+this.aX,u=h*l+d*c+this.aY}return n.set(s,u)}},{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},{key:"toJSON",value:function(){var e=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}},{key:"fromJSON",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"fromJSON",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}]),n}(wu),Ou=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o,s){var u;return Object(E.a)(this,n),(u=t.call(this,e,r,i,i,a,o,s)).isArcCurve=!0,u.type="ArcCurve",u}return Object(A.a)(n)}(xu);function ku(){var e=0,t=0,n=0,r=0;function i(i,a,o,s){e=i,t=o,n=-3*i+3*a-2*o-s,r=2*i-2*a+o+s}return{initCatmullRom:function(e,t,n,r,a){i(t,n,a*(n-e),a*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,a,o,s){var u=(t-e)/a-(n-e)/(a+o)+(n-t)/o,c=(n-t)/o-(r-t)/(o+s)+(r-n)/s;i(t,n,u*=o,c*=o)},calc:function(i){var a=i*i;return e+t*i+n*a+r*(a*i)}}}var _u=new tr,Su=new ku,Eu=new ku,Au=new ku,ju=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;return Object(E.a)(this,n),(e=t.call(this)).isCatmullRomCurve3=!0,e.type="CatmullRomCurve3",e.points=r,e.closed=i,e.curveType=a,e.tension=o,e}return Object(A.a)(n,[{key:"getPoint",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tr,i=this.points,a=i.length,o=(a-(this.closed?0:1))*e,s=Math.floor(o),u=o-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/a)+1)*a:0===u&&s===a-1&&(s=a-2,u=1),this.closed||s>0?t=i[(s-1)%a]:(_u.subVectors(i[0],i[1]).add(i[0]),t=_u);var c=i[s%a],l=i[(s+1)%a];if(this.closed||s+2<a?n=i[(s+2)%a]:(_u.subVectors(i[a-1],i[a-2]).add(i[a-1]),n=_u),"centripetal"===this.curveType||"chordal"===this.curveType){var h="chordal"===this.curveType?.5:.25,d=Math.pow(t.distanceToSquared(c),h),f=Math.pow(c.distanceToSquared(l),h),p=Math.pow(l.distanceToSquared(n),h);f<1e-4&&(f=1),d<1e-4&&(d=f),p<1e-4&&(p=f),Su.initNonuniformCatmullRom(t.x,c.x,l.x,n.x,d,f,p),Eu.initNonuniformCatmullRom(t.y,c.y,l.y,n.y,d,f,p),Au.initNonuniformCatmullRom(t.z,c.z,l.z,n.z,d,f,p)}else"catmullrom"===this.curveType&&(Su.initCatmullRom(t.x,c.x,l.x,n.x,this.tension),Eu.initCatmullRom(t.y,c.y,l.y,n.y,this.tension),Au.initCatmullRom(t.z,c.z,l.z,n.z,this.tension));return r.set(Su.calc(u),Eu.calc(u),Au.calc(u)),r}},{key:"copy",value:function(e){Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},{key:"toJSON",value:function(){var e=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}},{key:"fromJSON",value:function(e){Object(b.a)(Object(w.a)(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push((new tr).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}]),n}(wu);function Tu(e,t,n,r,i){var a=.5*(r-t),o=.5*(i-n),s=e*e;return(2*n-2*r+a+o)*(e*s)+(-3*n+3*r-2*a-o)*s+a*e+n}function Mu(e,t,n,r){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function Cu(e,t,n,r,i){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}var Du=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new An,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new An,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new An;return Object(E.a)(this,n),(e=t.call(this)).isCubicBezierCurve=!0,e.type="CubicBezierCurve",e.v0=r,e.v1=i,e.v2=a,e.v3=o,e}return Object(A.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An,n=this.v0,r=this.v1,i=this.v2,a=this.v3;return t.set(Cu(e,n.x,r.x,i.x,a.x),Cu(e,n.y,r.y,i.y,a.y)),t}},{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(wu),Iu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tr,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tr,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new tr,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new tr;return Object(E.a)(this,n),(e=t.call(this)).isCubicBezierCurve3=!0,e.type="CubicBezierCurve3",e.v0=r,e.v1=i,e.v2=a,e.v3=o,e}return Object(A.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tr,n=this.v0,r=this.v1,i=this.v2,a=this.v3;return t.set(Cu(e,n.x,r.x,i.x,a.x),Cu(e,n.y,r.y,i.y,a.y),Cu(e,n.z,r.z,i.z,a.z)),t}},{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(wu),Pu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new An,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An;return Object(E.a)(this,n),(e=t.call(this)).isLineCurve=!0,e.type="LineCurve",e.v1=r,e.v2=i,e}return Object(A.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function(e,t){var n=t||new An;return n.copy(this.v2).sub(this.v1).normalize(),n}},{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(wu),Ru=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tr,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tr;return Object(E.a)(this,n),(e=t.call(this)).isLineCurve3=!0,e.type="LineCurve3",e.v1=r,e.v2=i,e}return Object(A.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tr;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(wu),Lu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new An,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new An;return Object(E.a)(this,n),(e=t.call(this)).isQuadraticBezierCurve=!0,e.type="QuadraticBezierCurve",e.v0=r,e.v1=i,e.v2=a,e}return Object(A.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An,n=this.v0,r=this.v1,i=this.v2;return t.set(Mu(e,n.x,r.x,i.x),Mu(e,n.y,r.y,i.y)),t}},{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(wu),Nu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tr,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tr,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new tr;return Object(E.a)(this,n),(e=t.call(this)).isQuadraticBezierCurve3=!0,e.type="QuadraticBezierCurve3",e.v0=r,e.v1=i,e.v2=a,e}return Object(A.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tr,n=this.v0,r=this.v1,i=this.v2;return t.set(Mu(e,n.x,r.x,i.x),Mu(e,n.y,r.y,i.y),Mu(e,n.z,r.z,i.z)),t}},{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(wu),Bu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Object(E.a)(this,n),(e=t.call(this)).isSplineCurve=!0,e.type="SplineCurve",e.points=r,e}return Object(A.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An,n=this.points,r=(n.length-1)*e,i=Math.floor(r),a=r-i,o=n[0===i?i:i-1],s=n[i],u=n[i>n.length-2?n.length-1:i+1],c=n[i>n.length-3?n.length-1:i+2];return t.set(Tu(a,o.x,s.x,u.x,c.x),Tu(a,o.y,s.y,u.y,c.y)),t}},{key:"copy",value:function(e){Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(i.clone())}return this}},{key:"toJSON",value:function(){var e=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var i=this.points[t];e.points.push(i.toArray())}return e}},{key:"fromJSON",value:function(e){Object(b.a)(Object(w.a)(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push((new An).fromArray(i))}return this}}]),n}(wu),Fu=Object.freeze({__proto__:null,ArcCurve:Ou,CatmullRomCurve3:ju,CubicBezierCurve:Du,CubicBezierCurve3:Iu,EllipseCurve:xu,LineCurve:Pu,LineCurve3:Ru,QuadraticBezierCurve:Lu,QuadraticBezierCurve3:Nu,SplineCurve:Bu}),Uu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this)).type="CurvePath",e.curves=[],e.autoClose=!1,e}return Object(A.a)(n,[{key:"add",value:function(e){this.curves.push(e)}},{key:"closePath",value:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Pu(t,e))}},{key:"getPoint",value:function(e,t){for(var n=e*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=n){var a=r[i]-n,o=this.curves[i],s=o.getLength(),u=0===s?0:1-a/s;return o.getPointAt(u,t)}i++}return null}},{key:"getLength",value:function(){var e=this.getCurveLengths();return e[e.length-1]}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}},{key:"getCurveLengths",value:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}},{key:"getPoints",value:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],r=0,i=this.curves;r<i.length;r++)for(var a=i[r],o=a.isEllipseCurve?2*t:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o),u=0;u<s.length;u++){var c=s[u];e&&e.equals(c)||(n.push(c),e=c)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}},{key:"copy",value:function(e){Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}},{key:"toJSON",value:function(){var e=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var i=this.curves[t];e.curves.push(i.toJSON())}return e}},{key:"fromJSON",value:function(e){Object(b.a)(Object(w.a)(n.prototype),"fromJSON",this).call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var i=e.curves[t];this.curves.push((new Fu[i.type]).fromJSON(i))}return this}}]),n}(wu),zu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this)).type="Path",r.currentPoint=new An,e&&r.setFromPoints(e),r}return Object(A.a)(n,[{key:"setFromPoints",value:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}},{key:"moveTo",value:function(e,t){return this.currentPoint.set(e,t),this}},{key:"lineTo",value:function(e,t){var n=new Pu(this.currentPoint.clone(),new An(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,r){var i=new Lu(this.currentPoint.clone(),new An(e,t),new An(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}},{key:"bezierCurveTo",value:function(e,t,n,r,i,a){var o=new Du(this.currentPoint.clone(),new An(e,t),new An(n,r),new An(i,a));return this.curves.push(o),this.currentPoint.set(i,a),this}},{key:"splineThru",value:function(e){var t=[this.currentPoint.clone()].concat(e),n=new Bu(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}},{key:"arc",value:function(e,t,n,r,i,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,r,i,a),this}},{key:"absarc",value:function(e,t,n,r,i,a){return this.absellipse(e,t,n,n,r,i,a),this}},{key:"ellipse",value:function(e,t,n,r,i,a,o,s){var u=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+u,t+c,n,r,i,a,o,s),this}},{key:"absellipse",value:function(e,t,n,r,i,a,o,s){var u=new xu(e,t,n,r,i,a,o,s);if(this.curves.length>0){var c=u.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(u);var l=u.getPoint(1);return this.currentPoint.copy(l),this}},{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.currentPoint.copy(e.currentPoint),this}},{key:"toJSON",value:function(){var e=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this);return e.currentPoint=this.currentPoint.toArray(),e}},{key:"fromJSON",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"fromJSON",this).call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}]),n}(Uu),Vu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new An(0,.5),new An(.5,0),new An(0,-.5)],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;Object(E.a)(this,n),(e=t.call(this)).type="LatheGeometry",e.parameters={points:r,segments:i,phiStart:a,phiLength:o},i=Math.floor(i),o=xn(o,0,2*Math.PI);for(var s=[],u=[],c=[],l=[],h=[],d=1/i,f=new tr,p=new An,v=new tr,m=new tr,g=new tr,y=0,b=0,w=0;w<=r.length-1;w++)switch(w){case 0:y=r[w+1].x-r[w].x,b=r[w+1].y-r[w].y,v.x=1*b,v.y=-y,v.z=0*b,g.copy(v),v.normalize(),l.push(v.x,v.y,v.z);break;case r.length-1:l.push(g.x,g.y,g.z);break;default:y=r[w+1].x-r[w].x,b=r[w+1].y-r[w].y,v.x=1*b,v.y=-y,v.z=0*b,m.copy(v),v.x+=g.x,v.y+=g.y,v.z+=g.z,v.normalize(),l.push(v.x,v.y,v.z),g.copy(m)}for(var x=0;x<=i;x++)for(var O=a+x*d*o,k=Math.sin(O),_=Math.cos(O),S=0;S<=r.length-1;S++){f.x=r[S].x*k,f.y=r[S].y,f.z=r[S].x*_,u.push(f.x,f.y,f.z),p.x=x/i,p.y=S/(r.length-1),c.push(p.x,p.y);var A=l[3*S+0]*k,j=l[3*S+1],T=l[3*S+0]*_;h.push(A,j,T)}for(var M=0;M<i;M++)for(var C=0;C<r.length-1;C++){var D=C+M*r.length,I=D,P=D+r.length,R=D+r.length+1,L=D+1;s.push(I,P,L),s.push(R,L,P)}return e.setIndex(s),e.setAttribute("position",new _i(u,3)),e.setAttribute("uv",new _i(c,2)),e.setAttribute("normal",new _i(h,3)),e}return Object(A.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.points,e.segments,e.phiStart,e.phiLength)}}]),n}(Di),Gu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;Object(E.a)(this,n),(e=t.call(this)).type="CylinderGeometry",e.parameters={radiusTop:r,radiusBottom:i,height:a,radialSegments:o,heightSegments:s,openEnded:u,thetaStart:c,thetaLength:l};var h=Object(x.a)(e);o=Math.floor(o),s=Math.floor(s);var d=[],f=[],p=[],v=[],m=0,g=[],y=a/2,b=0;function w(e){for(var t=m,n=new An,a=new tr,s=0,u=!0===e?r:i,g=!0===e?1:-1,w=1;w<=o;w++)f.push(0,y*g,0),p.push(0,g,0),v.push(.5,.5),m++;for(var x=m,O=0;O<=o;O++){var k=O/o*l+c,_=Math.cos(k),S=Math.sin(k);a.x=u*S,a.y=y*g,a.z=u*_,f.push(a.x,a.y,a.z),p.push(0,g,0),n.x=.5*_+.5,n.y=.5*S*g+.5,v.push(n.x,n.y),m++}for(var E=0;E<o;E++){var A=t+E,j=x+E;!0===e?d.push(j,j+1,A):d.push(j+1,j,A),s+=3}h.addGroup(b,s,!0===e?1:2),b+=s}return function(){for(var e=new tr,t=new tr,n=0,u=(i-r)/a,w=0;w<=s;w++){for(var x=[],O=w/s,k=O*(i-r)+r,_=0;_<=o;_++){var S=_/o,E=S*l+c,A=Math.sin(E),j=Math.cos(E);t.x=k*A,t.y=-O*a+y,t.z=k*j,f.push(t.x,t.y,t.z),e.set(A,u,j).normalize(),p.push(e.x,e.y,e.z),v.push(S,1-O),x.push(m++)}g.push(x)}for(var T=0;T<o;T++)for(var M=0;M<s;M++){var C=g[M][T],D=g[M+1][T],I=g[M+1][T+1],P=g[M][T+1];d.push(C,D,P),d.push(D,I,P),n+=6}h.addGroup(b,n,0),b+=n}(),!1===u&&(r>0&&w(!0),i>0&&w(!1)),e.setIndex(d),e.setAttribute("position",new _i(f,3)),e.setAttribute("normal",new _i(p,3)),e.setAttribute("uv",new _i(v,2)),e}return Object(A.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]),n}(Di),Hu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;return Object(E.a)(this,n),(e=t.call(this,0,r,i,a,o,s,u,c)).type="ConeGeometry",e.parameters={radius:r,height:i,radialSegments:a,heightSegments:o,openEnded:s,thetaStart:u,thetaLength:c},e}return Object(A.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]),n}(Gu),Wu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(E.a)(this,n),(e=t.call(this)).type="PolyhedronGeometry",e.parameters={vertices:r,indices:i,radius:a,detail:o};var s=[],u=[];function c(e,t,n,r){for(var i=r+1,a=[],o=0;o<=i;o++){a[o]=[];for(var s=e.clone().lerp(n,o/i),u=t.clone().lerp(n,o/i),c=i-o,h=0;h<=c;h++)a[o][h]=0===h&&o===i?s:s.clone().lerp(u,h/c)}for(var d=0;d<i;d++)for(var f=0;f<2*(i-d)-1;f++){var p=Math.floor(f/2);f%2===0?(l(a[d][p+1]),l(a[d+1][p]),l(a[d][p])):(l(a[d][p+1]),l(a[d+1][p+1]),l(a[d+1][p]))}}function l(e){s.push(e.x,e.y,e.z)}function h(e,t){var n=3*e;t.x=r[n+0],t.y=r[n+1],t.z=r[n+2]}function d(e,t,n,r){r<0&&1===e.x&&(u[t]=e.x-1),0===n.x&&0===n.z&&(u[t]=r/2/Math.PI+.5)}function f(e){return Math.atan2(e.z,-e.x)}function p(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}return function(e){for(var t=new tr,n=new tr,r=new tr,a=0;a<i.length;a+=3)h(i[a+0],t),h(i[a+1],n),h(i[a+2],r),c(t,n,r,e)}(o),function(e){for(var t=new tr,n=0;n<s.length;n+=3)t.x=s[n+0],t.y=s[n+1],t.z=s[n+2],t.normalize().multiplyScalar(e),s[n+0]=t.x,s[n+1]=t.y,s[n+2]=t.z}(a),function(){for(var e=new tr,t=0;t<s.length;t+=3){e.x=s[t+0],e.y=s[t+1],e.z=s[t+2];var n=f(e)/2/Math.PI+.5,r=p(e)/Math.PI+.5;u.push(n,1-r)}(function(){for(var e=new tr,t=new tr,n=new tr,r=new tr,i=new An,a=new An,o=new An,c=0,l=0;c<s.length;c+=9,l+=6){e.set(s[c+0],s[c+1],s[c+2]),t.set(s[c+3],s[c+4],s[c+5]),n.set(s[c+6],s[c+7],s[c+8]),i.set(u[l+0],u[l+1]),a.set(u[l+2],u[l+3]),o.set(u[l+4],u[l+5]),r.copy(e).add(t).add(n).divideScalar(3);var h=f(r);d(i,l+0,e,h),d(a,l+2,t,h),d(o,l+4,n,h)}})(),function(){for(var e=0;e<u.length;e+=6){var t=u[e+0],n=u[e+2],r=u[e+4],i=Math.max(t,n,r),a=Math.min(t,n,r);i>.9&&a<.1&&(t<.2&&(u[e+0]+=1),n<.2&&(u[e+2]+=1),r<.2&&(u[e+4]+=1))}}()}(),e.setAttribute("position",new _i(s,3)),e.setAttribute("normal",new _i(s.slice(),3)),e.setAttribute("uv",new _i(u,2)),0===o?e.computeVertexNormals():e.normalizeNormals(),e}return Object(A.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.vertices,e.indices,e.radius,e.details)}}]),n}(Di),qu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(E.a)(this,n);var a=(1+Math.sqrt(5))/2,o=1/a,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-a,0,-o,a,0,o,-a,0,o,a,-o,-a,0,-o,a,0,o,-a,0,o,a,0,-a,0,-o,a,0,-o,-a,0,o,a,0,o];return(e=t.call(this,s,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],r,i)).type="DodecahedronGeometry",e.parameters={radius:r,detail:i},e}return Object(A.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(Wu),Yu=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,e)).uuid=wn(),r.type="Shape",r.holes=[],r}return Object(A.a)(n,[{key:"getPointsHoles",value:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}},{key:"extractPoints",value:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}},{key:"copy",value:function(e){Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var i=e.holes[t];this.holes.push(i.clone())}return this}},{key:"toJSON",value:function(){var e=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var i=this.holes[t];e.holes.push(i.toJSON())}return e}},{key:"fromJSON",value:function(e){Object(b.a)(Object(w.a)(n.prototype),"fromJSON",this).call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var i=e.holes[t];this.holes.push((new zu).fromJSON(i))}return this}}]),n}(zu),Xu=function(e,t){var n,r,i,a,o,s,u,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,l=t&&t.length,h=l?t[0]*c:e.length,d=Ku(e,0,h,c,!0),f=[];if(!d||d.next===d.prev)return f;if(l&&(d=function(e,t,n,r){var i,a,o,s,u,c=[];for(i=0,a=t.length;i<a;i++)o=t[i]*r,s=i<a-1?t[i+1]*r:e.length,(u=Ku(e,o,s,r,!1))===u.next&&(u.steiner=!0),c.push(oc(u));for(c.sort(nc),i=0;i<c.length;i++)rc(c[i],n),n=Qu(n,n.next);return n}(e,t,d,c)),e.length>80*c){n=i=e[0],r=a=e[1];for(var p=c;p<h;p+=c)(o=e[p])<n&&(n=o),(s=e[p+1])<r&&(r=s),o>i&&(i=o),s>a&&(a=s);u=0!==(u=Math.max(i-n,a-r))?1/u:0}return Zu(d,f,c,n,r,u),f};function Ku(e,t,n,r,i){var a,o;if(i===function(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}(e,t,n,r)>0)for(a=t;a<n;a+=r)o=mc(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=mc(a,e[a],e[a+1],o);return o&&lc(o,o.next)&&(gc(o),o=o.next),o}function Qu(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!lc(r,r.next)&&0!==cc(r.prev,r,r.next))r=r.next;else{if(gc(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function Zu(e,t,n,r,i,a,o){if(e){!o&&a&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=ac(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,a,o,s,u,c=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,c*=2}while(o>1)}(i)}(e,r,i,a);for(var s,u,c=e;e.prev!==e.next;)if(s=e.prev,u=e.next,a?$u(e,r,i,a):Ju(e))t.push(s.i/n),t.push(e.i/n),t.push(u.i/n),gc(e),e=u.next,c=u.next;else if((e=u)===c){o?1===o?Zu(e=ec(Qu(e),t,n),t,n,r,i,a,2):2===o&&tc(e,t,n,r,i,a):Zu(Qu(e),t,n,r,i,a,1);break}}}function Ju(e){var t=e.prev,n=e,r=e.next;if(cc(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(sc(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&cc(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function $u(e,t,n,r){var i=e.prev,a=e,o=e.next;if(cc(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,u=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,c=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,l=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,h=ac(s,u,t,n,r),d=ac(c,l,t,n,r),f=e.prevZ,p=e.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&sc(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&cc(f.prev,f,f.next)>=0||(f=f.prevZ,p!==e.prev&&p!==e.next&&sc(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&cc(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&sc(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&cc(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&sc(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&cc(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function ec(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!lc(i,a)&&hc(i,r,r.next,a)&&pc(i,a)&&pc(a,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(a.i/n),gc(r),gc(r.next),r=e=a),r=r.next}while(r!==e);return Qu(r)}function tc(e,t,n,r,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&uc(o,s)){var u=vc(o,s);return o=Qu(o,o.next),u=Qu(u,u.next),Zu(o,t,n,r,i,a),void Zu(u,t,n,r,i,a)}s=s.next}o=o.next}while(o!==e)}function nc(e,t){return e.x-t.x}function rc(e,t){if(t=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n;var u,c=n,l=n.x,h=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=l&&i!==r.x&&sc(a<h?i:o,a,l,h,a<h?o:i,a,r.x,r.y)&&(u=Math.abs(a-r.y)/(i-r.x),pc(r,e)&&(u<d||u===d&&(r.x>n.x||r.x===n.x&&ic(n,r)))&&(n=r,d=u)),r=r.next}while(r!==c);return n}(e,t),t){var n=vc(t,e);Qu(t,t.next),Qu(n,n.next)}}function ic(e,t){return cc(e.prev,e,t.prev)<0&&cc(t.next,e,e.next)<0}function ac(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function oc(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function sc(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function uc(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&hc(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(pc(e,t)&&pc(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(cc(e.prev,e,t.prev)||cc(e,t.prev,t))||lc(e,t)&&cc(e.prev,e,e.next)>0&&cc(t.prev,t,t.next)>0)}function cc(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function lc(e,t){return e.x===t.x&&e.y===t.y}function hc(e,t,n,r){var i=fc(cc(e,t,n)),a=fc(cc(e,t,r)),o=fc(cc(n,r,e)),s=fc(cc(n,r,t));return!!(i!==a&&o!==s||0===i&&dc(e,n,t)||0===a&&dc(e,r,t)||0===o&&dc(n,e,r)||0===s&&dc(n,t,r))}function dc(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function fc(e){return e>0?1:e<0?-1:0}function pc(e,t){return cc(e.prev,e,e.next)<0?cc(e,t,e.next)>=0&&cc(e,e.prev,t)>=0:cc(e,t,e.prev)<0||cc(e,e.next,t)<0}function vc(e,t){var n=new yc(e.i,e.x,e.y),r=new yc(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function mc(e,t,n,r){var i=new yc(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function gc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function yc(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var bc=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"area",value:function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}},{key:"isClockWise",value:function(t){return e.area(t)<0}},{key:"triangulateShape",value:function(e,t){var n=[],r=[],i=[];wc(e),xc(n,e);var a=e.length;t.forEach(wc);for(var o=0;o<t.length;o++)r.push(a),a+=t[o].length,xc(n,t[o]);for(var s=Xu(n,r),u=0;u<s.length;u+=3)i.push(s.slice(u,u+3));return i}}]),e}();function wc(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function xc(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var Oc=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(E.a)(this,n);var a=(1+Math.sqrt(5))/2,o=[-1,a,0,1,a,0,-1,-a,0,1,-a,0,0,-1,a,0,1,a,0,-1,-a,0,1,-a,a,0,-1,a,0,1,-a,0,-1,-a,0,1];return(e=t.call(this,o,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],r,i)).type="IcosahedronGeometry",e.parameters={radius:r,detail:i},e}return Object(A.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(Wu),kc=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;Object(E.a)(this,n),(e=t.call(this)).type="SphereGeometry",e.parameters={radius:r,widthSegments:i,heightSegments:a,phiStart:o,phiLength:s,thetaStart:u,thetaLength:c},i=Math.max(3,Math.floor(i)),a=Math.max(2,Math.floor(a));for(var l=Math.min(u+c,Math.PI),h=0,d=[],f=new tr,p=new tr,v=[],m=[],g=[],y=[],b=0;b<=a;b++){var w=[],x=b/a,O=0;0==b&&0==u?O=.5/i:b==a&&l==Math.PI&&(O=-.5/i);for(var k=0;k<=i;k++){var _=k/i;f.x=-r*Math.cos(o+_*s)*Math.sin(u+x*c),f.y=r*Math.cos(u+x*c),f.z=r*Math.sin(o+_*s)*Math.sin(u+x*c),m.push(f.x,f.y,f.z),p.copy(f).normalize(),g.push(p.x,p.y,p.z),y.push(_+O,1-x),w.push(h++)}d.push(w)}for(var S=0;S<a;S++)for(var A=0;A<i;A++){var j=d[S][A+1],T=d[S][A],M=d[S+1][A],C=d[S+1][A+1];(0!==S||u>0)&&v.push(j,T,C),(S!==a-1||l<Math.PI)&&v.push(T,M,C)}return e.setIndex(v),e.setAttribute("position",new _i(m,3)),e.setAttribute("normal",new _i(g,3)),e.setAttribute("uv",new _i(y,2)),e}return Object(A.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}]),n}(Di),_c=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;Object(E.a)(this,n),(e=t.call(this)).type="TorusKnotGeometry",e.parameters={radius:r,tube:i,tubularSegments:a,radialSegments:o,p:s,q:u},a=Math.floor(a),o=Math.floor(o);for(var c=[],l=[],h=[],d=[],f=new tr,p=new tr,v=new tr,m=new tr,g=new tr,y=new tr,b=new tr,w=0;w<=a;++w){var x=w/a*s*Math.PI*2;I(x,s,u,r,v),I(x+.01,s,u,r,m),y.subVectors(m,v),b.addVectors(m,v),g.crossVectors(y,b),b.crossVectors(g,y),g.normalize(),b.normalize();for(var O=0;O<=o;++O){var k=O/o*Math.PI*2,_=-i*Math.cos(k),S=i*Math.sin(k);f.x=v.x+(_*b.x+S*g.x),f.y=v.y+(_*b.y+S*g.y),f.z=v.z+(_*b.z+S*g.z),l.push(f.x,f.y,f.z),p.subVectors(f,v).normalize(),h.push(p.x,p.y,p.z),d.push(w/a),d.push(O/o)}}for(var A=1;A<=a;A++)for(var j=1;j<=o;j++){var T=(o+1)*(A-1)+(j-1),M=(o+1)*A+(j-1),C=(o+1)*A+j,D=(o+1)*(A-1)+j;c.push(T,M,D),c.push(M,C,D)}function I(e,t,n,r,i){var a=Math.cos(e),o=Math.sin(e),s=n/t*e,u=Math.cos(s);i.x=r*(2+u)*.5*a,i.y=r*(2+u)*o*.5,i.z=r*Math.sin(s)*.5}return e.setIndex(c),e.setAttribute("position",new _i(l,3)),e.setAttribute("normal",new _i(h,3)),e.setAttribute("uv",new _i(d,2)),e}return Object(A.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}]),n}(Di),Sc={arraySlice:function(e,t,n){return Sc.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),r=0;r!==t;++r)n[r]=r;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){for(var r=e.length,i=new e.constructor(r),a=0,o=0;o!==r;++a)for(var s=n[a]*t,u=0;u!==t;++u)i[o++]=e[s+u];return i},flattenJSON:function(e,t,n,r){for(var i=1,a=e[0];void 0!==a&&void 0===a[r];)a=e[i++];if(void 0!==a){var o=a[r];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[r])&&(t.push(a.time),n.push.apply(n,o)),a=e[i++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[r])&&(t.push(a.time),o.toArray(n,n.length)),a=e[i++]}while(void 0!==a);else do{void 0!==(o=a[r])&&(t.push(a.time),n.push(o)),a=e[i++]}while(void 0!==a)}},subclip:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,a=e.clone();a.name=t;for(var o=[],s=0;s<a.tracks.length;++s){for(var u=a.tracks[s],c=u.getValueSize(),l=[],h=[],d=0;d<u.times.length;++d){var f=u.times[d]*i;if(!(f<n||f>=r)){l.push(u.times[d]);for(var p=0;p<c;++p)h.push(u.values[d*c+p])}}0!==l.length&&(u.times=Sc.convertArray(l,u.times.constructor),u.values=Sc.convertArray(h,u.values.constructor),o.push(u))}a.tracks=o;for(var v=1/0,m=0;m<a.tracks.length;++m)v>a.tracks[m].times[0]&&(v=a.tracks[m].times[0]);for(var g=0;g<a.tracks.length;++g)a.tracks[g].shift(-1*v);return a.resetDuration(),a},makeClipAdditive:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;r<=0&&(r=30);for(var i=n.tracks.length,a=t/r,o=function(){var t=n.tracks[s],r=t.ValueTypeName;if("bool"===r||"string"===r)return"continue";var i=e.tracks.find((function(e){return e.name===t.name&&e.ValueTypeName===r}));if(void 0===i)return"continue";var o=0,u=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=u/3);var c=0,l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=l/3);var h,d=t.times.length-1;if(a<=t.times[0]){var f=o,p=u-o;h=Sc.arraySlice(t.values,f,p)}else if(a>=t.times[d]){var v=d*u+o,m=v+u-o;h=Sc.arraySlice(t.values,v,m)}else{var g=t.createInterpolant(),y=o,b=u-o;g.evaluate(a),h=Sc.arraySlice(g.resultBuffer,y,b)}"quaternion"===r&&(new er).fromArray(h).normalize().conjugate().toArray(h);for(var w=i.times.length,x=0;x<w;++x){var O=x*l+c;if("quaternion"===r)er.multiplyQuaternionsFlat(i.values,O,h,0,i.values,O);else for(var k=l-2*c,_=0;_<k;++_)i.values[O+_]-=h[_]}},s=0;s<i;++s)o();return e.blendMode=en,e}},Ec=function(){function e(t,n,r,i){Object(E.a)(this,e),this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new n.constructor(r),this.sampleValues=n,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}return Object(A.a)(e,[{key:"evaluate",value:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{var a;n:{r:if(!(e<r)){for(var o=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(i=r,e<(r=t[++n]))break t}a=t.length;break n}if(e>=i)break e;var s=t[1];e<s&&(n=2,i=s);for(var u=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===u)break;if(r=i,e>=(i=t[--n-1]))break t}a=n,n=0}for(;n<a;){var c=n+a>>>1;e<t[c]?a=c:n=c+1}if(r=t[n],void 0===(i=t[n-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}},{key:"getSettings_",value:function(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r,a=0;a!==r;++a)t[a]=n[i+a];return t}},{key:"interpolate_",value:function(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function(){}}]),e}(),Ac=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a){var o;return Object(E.a)(this,n),(o=t.call(this,e,r,i,a))._weightPrev=-0,o._offsetPrev=-0,o._weightNext=-0,o._offsetNext=-0,o.DefaultSettings_={endingStart:$t,endingEnd:$t},o}return Object(A.a)(n,[{key:"intervalChanged_",value:function(e,t,n){var r=this.parameterPositions,i=e-2,a=e+1,o=r[i],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:i=e,o=2*t-n;break;case 2402:o=t+r[i=r.length-2]-r[i+1];break;default:i=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:a=e,s=2*n-t;break;case 2402:a=1,s=n+r[1]-r[0];break;default:a=e-1,s=t}var u=.5*(n-t),c=this.valueSize;this._weightPrev=u/(t-o),this._weightNext=u/(s-n),this._offsetPrev=i*c,this._offsetNext=a*c}},{key:"interpolate_",value:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,c=this._offsetPrev,l=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(n-t)/(r-t),p=f*f,v=p*f,m=-h*v+2*h*p-h*f,g=(1+h)*v+(-1.5-2*h)*p+(-.5+h)*f+1,y=(-1-d)*v+(1.5+d)*p+.5*f,b=d*v-d*p,w=0;w!==o;++w)i[w]=m*a[c+w]+g*a[u+w]+y*a[s+w]+b*a[l+w];return i}}]),n}(Ec),jc=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a){return Object(E.a)(this,n),t.call(this,e,r,i,a)}return Object(A.a)(n,[{key:"interpolate_",value:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,c=(n-t)/(r-t),l=1-c,h=0;h!==o;++h)i[h]=a[u+h]*l+a[s+h]*c;return i}}]),n}(Ec),Tc=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a){return Object(E.a)(this,n),t.call(this,e,r,i,a)}return Object(A.a)(n,[{key:"interpolate_",value:function(e){return this.copySampleValue_(e-1)}}]),n}(Ec),Mc=function(){function e(t,n,r,i){if(Object(E.a)(this,e),void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===n||0===n.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Sc.convertArray(n,this.TimeBufferType),this.values=Sc.convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}return Object(A.a)(e,[{key:"InterpolantFactoryMethodDiscrete",value:function(e){return new Tc(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function(e){return new jc(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function(e){return new Ac(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function(e){var t;switch(e){case Qt:t=this.InterpolantFactoryMethodDiscrete;break;case Zt:t=this.InterpolantFactoryMethodLinear;break;case Jt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}},{key:"getInterpolation",value:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Qt;case this.InterpolantFactoryMethodLinear:return Zt;case this.InterpolantFactoryMethodSmooth:return Jt}}},{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"shift",value:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this}},{key:"scale",value:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this}},{key:"trim",value:function(e,t){for(var n=this.times,r=n.length,i=0,a=r-1;i!==r&&n[i]<e;)++i;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==i||a!==r){i>=a&&(i=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=Sc.arraySlice(n,i,a),this.values=Sc.arraySlice(this.values,i*o,a*o)}return this}},{key:"validate",value:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==i;o++){var s=n[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==r&&Sc.isTypedArray(r))for(var u=0,c=r.length;u!==c;++u){var l=r[u];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,u,l),e=!1;break}}return e}},{key:"optimize",value:function(){for(var e=Sc.arraySlice(this.times),t=Sc.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===Jt,i=e.length-1,a=1,o=1;o<i;++o){var s=!1,u=e[o];if(u!==e[o+1]&&(1!==o||u!==e[0]))if(r)s=!0;else for(var c=o*n,l=c-n,h=c+n,d=0;d!==n;++d){var f=t[c+d];if(f!==t[l+d]||f!==t[h+d]){s=!0;break}}if(s){if(o!==a){e[a]=e[o];for(var p=o*n,v=a*n,m=0;m!==n;++m)t[v+m]=t[p+m]}++a}}if(i>0){e[a]=e[i];for(var g=i*n,y=a*n,b=0;b!==n;++b)t[y+b]=t[g+b];++a}return a!==e.length?(this.times=Sc.arraySlice(e,0,a),this.values=Sc.arraySlice(t,0,a*n)):(this.times=e,this.values=t),this}},{key:"clone",value:function(){var e=Sc.arraySlice(this.times,0),t=Sc.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}],[{key:"toJSON",value:function(e){var t,n=e.constructor;if(n.toJSON!==this.toJSON)t=n.toJSON(e);else{t={name:e.name,times:Sc.convertArray(e.times,Array),values:Sc.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}]),e}();Mc.prototype.TimeBufferType=Float32Array,Mc.prototype.ValueBufferType=Float32Array,Mc.prototype.DefaultInterpolation=Zt;var Cc=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n)}(Mc);Cc.prototype.ValueTypeName="bool",Cc.prototype.ValueBufferType=Array,Cc.prototype.DefaultInterpolation=Qt,Cc.prototype.InterpolantFactoryMethodLinear=void 0,Cc.prototype.InterpolantFactoryMethodSmooth=void 0;var Dc=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n)}(Mc);Dc.prototype.ValueTypeName="color";var Ic=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n)}(Mc);Ic.prototype.ValueTypeName="number";var Pc=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a){return Object(E.a)(this,n),t.call(this,e,r,i,a)}return Object(A.a)(n,[{key:"interpolate_",value:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(r-t),u=e*o,c=u+o;u!==c;u+=4)er.slerpFlat(i,0,a,u-o,a,u,s);return i}}]),n}(Ec),Rc=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n,[{key:"InterpolantFactoryMethodLinear",value:function(e){return new Pc(this.times,this.values,this.getValueSize(),e)}}]),n}(Mc);Rc.prototype.ValueTypeName="quaternion",Rc.prototype.DefaultInterpolation=Zt,Rc.prototype.InterpolantFactoryMethodSmooth=void 0;var Lc=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n)}(Mc);Lc.prototype.ValueTypeName="string",Lc.prototype.ValueBufferType=Array,Lc.prototype.DefaultInterpolation=Qt,Lc.prototype.InterpolantFactoryMethodLinear=void 0,Lc.prototype.InterpolantFactoryMethodSmooth=void 0;var Nc=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n)}(Mc);Nc.prototype.ValueTypeName="vector";var Bc={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Fc=Object(A.a)((function e(t,n,r){Object(E.a)(this,e);var i,a=this,o=!1,s=0,u=0,c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=n,this.onError=r,this.itemStart=function(e){u++,!1===o&&void 0!==a.onStart&&a.onStart(e,s,u),o=!0},this.itemEnd=function(e){s++,void 0!==a.onProgress&&a.onProgress(e,s,u),s===u&&(o=!1,void 0!==a.onLoad&&a.onLoad())},this.itemError=function(e){void 0!==a.onError&&a.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return c.push(e,t),this},this.removeHandler=function(e){var t=c.indexOf(e);return-1!==t&&c.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=c.length;t<n;t+=2){var r=c[t],i=c[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return i}return null}})),Uc=new Fc,zc=function(){function e(t){Object(E.a)(this,e),this.manager=void 0!==t?t:Uc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return Object(A.a)(e,[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,t){var n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setRequestHeader",value:function(e){return this.requestHeader=e,this}}]),e}(),Vc={},Gc=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){return Object(E.a)(this,n),t.call(this,e)}return Object(A.a)(n,[{key:"load",value:function(e,t,n,r){var i=this;void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var a=Bc.get(e);if(void 0!==a)return this.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;if(void 0===Vc[e]){Vc[e]=[],Vc[e].push({onLoad:t,onProgress:n,onError:r});var o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,u=this.responseType;fetch(o).then((function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||void 0===t.body||void 0===t.body.getReader)return t;var n=Vc[e],r=t.body.getReader(),i=t.headers.get("Content-Length"),a=i?parseInt(i):0,o=0!==a,s=0,u=new ReadableStream({start:function(e){!function t(){r.read().then((function(r){var i=r.done,u=r.value;if(i)e.close();else{s+=u.byteLength;for(var c=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:a}),l=0,h=n.length;l<h;l++){var d=n[l];d.onProgress&&d.onProgress(c)}e.enqueue(u),t()}}))}()}});return new Response(u)}throw Error('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText))})).then((function(e){switch(u){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((function(e){return(new DOMParser).parseFromString(e,s)}));case"json":return e.json();default:if(void 0===s)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then((function(e){return r.decode(e)}))}})).then((function(t){Bc.add(e,t);var n=Vc[e];delete Vc[e];for(var r=0,i=n.length;r<i;r++){var a=n[r];a.onLoad&&a.onLoad(t)}})).catch((function(t){var n=Vc[e];if(void 0===n)throw i.manager.itemError(e),t;delete Vc[e];for(var r=0,a=n.length;r<a;r++){var o=n[r];o.onError&&o.onError(t)}i.manager.itemError(e)})).finally((function(){i.manager.itemEnd(e)})),this.manager.itemStart(e)}else Vc[e].push({onLoad:t,onProgress:n,onError:r})}},{key:"setResponseType",value:function(e){return this.responseType=e,this}},{key:"setMimeType",value:function(e){return this.mimeType=e,this}}]),n}(zc),Hc=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Object(E.a)(this,n),(r=t.call(this)).isLight=!0,r.type="Light",r.color=new Gn(e),r.intensity=i,r}return Object(A.a)(n,[{key:"dispose",value:function(){}},{key:"copy",value:function(e,t){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e,t),this.color.copy(e.color),this.intensity=e.intensity,this}},{key:"toJSON",value:function(e){var t=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}]),n}(ri),Wc=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;return Object(E.a)(this,n),(a=t.call(this,e,i)).isHemisphereLight=!0,a.type="HemisphereLight",a.position.copy(ri.DefaultUp),a.updateMatrix(),a.groundColor=new Gn(r),a}return Object(A.a)(n,[{key:"copy",value:function(e,t){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e,t),this.groundColor.copy(e.groundColor),this}}]),n}(Hc),qc=new Dr,Yc=new tr,Xc=new tr,Kc=function(){function e(t){Object(E.a)(this,e),this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new An(512,512),this.map=null,this.mapPass=null,this.matrix=new Dr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ya,this._frameExtents=new An(1,1),this._viewportCount=1,this._viewports=[new Qn(0,0,1,1)]}return Object(A.a)(e,[{key:"getViewportCount",value:function(){return this._viewportCount}},{key:"getFrustum",value:function(){return this._frustum}},{key:"updateMatrices",value:function(e){var t=this.camera,n=this.matrix;Yc.setFromMatrixPosition(e.matrixWorld),t.position.copy(Yc),Xc.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Xc),t.updateMatrixWorld(),qc.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(qc),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}},{key:"getViewport",value:function(e){return this._viewports[e]}},{key:"getFrameExtents",value:function(){return this._frameExtents}},{key:"dispose",value:function(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}},{key:"copy",value:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}]),e}(),Qc=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this,new oa(50,1,.5,500))).isSpotLightShadow=!0,e.focus=1,e}return Object(A.a)(n,[{key:"updateMatrices",value:function(e){var t=this.camera,r=2*bn*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,a=e.distance||t.far;(r!==t.fov||i!==t.aspect||a!==t.far)&&(t.fov=r,t.aspect=i,t.far=a,t.updateProjectionMatrix()),Object(b.a)(Object(w.a)(n.prototype),"updateMatrices",this).call(this,e)}},{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.focus=e.focus,this}}]),n}(Kc),Zc=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return Object(E.a)(this,n),(i=t.call(this,e,r)).isSpotLight=!0,i.type="SpotLight",i.position.copy(ri.DefaultUp),i.updateMatrix(),i.target=new ri,i.distance=a,i.angle=o,i.penumbra=s,i.decay=u,i.shadow=new Qc,i}return Object(A.a)(n,[{key:"power",get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e,t){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(Hc),Jc=new Dr,$c=new tr,el=new tr,tl=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this,new oa(90,1,.5,500))).isPointLightShadow=!0,e._frameExtents=new An(4,2),e._viewportCount=6,e._viewports=[new Qn(2,1,1,1),new Qn(0,1,1,1),new Qn(3,1,1,1),new Qn(1,1,1,1),new Qn(3,0,1,1),new Qn(1,0,1,1)],e._cubeDirections=[new tr(1,0,0),new tr(-1,0,0),new tr(0,0,1),new tr(0,0,-1),new tr(0,1,0),new tr(0,-1,0)],e._cubeUps=[new tr(0,1,0),new tr(0,1,0),new tr(0,1,0),new tr(0,1,0),new tr(0,0,1),new tr(0,0,-1)],e}return Object(A.a)(n,[{key:"updateMatrices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),$c.setFromMatrixPosition(e.matrixWorld),n.position.copy($c),el.copy(n.position),el.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(el),n.updateMatrixWorld(),r.makeTranslation(-$c.x,-$c.y,-$c.z),Jc.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Jc)}}]),n}(Kc),nl=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Object(E.a)(this,n),(i=t.call(this,e,r)).isPointLight=!0,i.type="PointLight",i.distance=a,i.decay=o,i.shadow=new tl,i}return Object(A.a)(n,[{key:"power",get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e,t){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}]),n}(Hc),rl=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this,new Ca(-5,5,5,-5,.5,500))).isDirectionalLightShadow=!0,e}return Object(A.a)(n)}(Kc),il=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;return Object(E.a)(this,n),(i=t.call(this,e,r)).isDirectionalLight=!0,i.type="DirectionalLight",i.position.copy(ri.DefaultUp),i.updateMatrix(),i.target=new ri,i.shadow=new rl,i}return Object(A.a)(n,[{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(Hc),al=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this)).isInstancedBufferGeometry=!0,e.type="InstancedBufferGeometry",e.instanceCount=1/0,e}return Object(A.a)(n,[{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.instanceCount=e.instanceCount,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e=Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this,this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}]),n}(Di),ol=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){return Object(E.a)(this,n),t.call(this,e)}return Object(A.a)(n,[{key:"load",value:function(e,t,n,r){var i=this,a=new Gc(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(a){r?r(a):console.error(a),i.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e){var t={},n={};function r(e,r){if(void 0!==t[r])return t[r];var i=e.interleavedBuffers[r],a=function(e,t){if(void 0!==n[t])return n[t];var r=e.arrayBuffers[t],i=new Uint32Array(r).buffer;return n[t]=i,i}(e,i.buffer),o=Cn(i.type,a),s=new au(o,i.stride);return s.uuid=i.uuid,t[r]=s,s}var i=e.isInstancedBufferGeometry?new al:new Di,a=e.data.index;if(void 0!==a){var o=Cn(a.type,a.array);i.setIndex(new wi(o,1))}var s=e.data.attributes;for(var u in s){var c=s[u],l=void 0;if(c.isInterleavedBufferAttribute){var h=r(e.data,c.data);l=new su(h,c.itemSize,c.offset,c.normalized)}else{var d=Cn(c.type,c.array);l=new(c.isInstancedBufferAttribute?uu:wi)(d,c.itemSize,c.normalized)}void 0!==c.name&&(l.name=c.name),void 0!==c.usage&&l.setUsage(c.usage),void 0!==c.updateRange&&(l.updateRange.offset=c.updateRange.offset,l.updateRange.count=c.updateRange.count),i.setAttribute(u,l)}var f=e.data.morphAttributes;if(f)for(var p in f){for(var v=f[p],m=[],g=0,y=v.length;g<y;g++){var b=v[g],w=void 0;if(b.isInterleavedBufferAttribute){var x=r(e.data,b.data);w=new su(x,b.itemSize,b.offset,b.normalized)}else{var O=Cn(b.type,b.array);w=new wi(O,b.itemSize,b.normalized)}void 0!==b.name&&(w.name=b.name),m.push(w)}i.morphAttributes[p]=m}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);var k=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==k)for(var _=0,S=k.length;_!==S;++_){var E=k[_];i.addGroup(E.start,E.count,E.materialIndex)}var A=e.data.boundingSphere;if(void 0!==A){var j=new tr;void 0!==A.center&&j.fromArray(A.center),i.boundingSphere=new kr(j,A.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}}]),n}(zc),sl=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Object(E.a)(this,e),this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return Object(A.a)(e,[{key:"start",value:function(){this.startTime=ul(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=ul();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}();function ul(){return(typeof performance>"u"?Date:performance).now()}var cl="\\[\\]\\.:\\/",ll=new RegExp("["+cl+"]","g"),hl="[^"+cl+"]",dl="[^"+cl.replace("\\.","")+"]",fl=/((?:WC+[\/:])*)/.source.replace("WC",hl),pl=/(WCOD+)?/.source.replace("WCOD",dl),vl=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",hl),ml=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",hl),gl=new RegExp("^"+fl+pl+vl+ml+"$"),yl=["material","materials","bones"],bl=function(){function e(t,n,r){Object(E.a)(this,e);var i=r||wl.parseTrackName(n);this._targetGroup=t,this._bindings=t.subscribe_(n,i)}return Object(A.a)(e,[{key:"getValue",value:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}},{key:"setValue",value:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}},{key:"bind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}},{key:"unbind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}]),e}(),wl=function(){function e(t,n,r){Object(E.a)(this,e),this.path=n,this.parsedPath=r||e.parseTrackName(n),this.node=e.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}return Object(A.a)(e,[{key:"_getValue_unavailable",value:function(){}},{key:"_setValue_unavailable",value:function(){}},{key:"_getValue_direct",value:function(e,t){e[t]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)e[t++]=n[r]}},{key:"_getValue_arrayElement",value:function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++]}},{key:"_setValue_array_setNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function(e,t){this.bind(),this.getValue(e,t)}},{key:"_setValue_unbound",value:function(e,t){this.bind(),this.setValue(e,t)}},{key:"bind",value:function(){var t=this.node,n=this.parsedPath,r=n.objectName,i=n.propertyName,a=n.propertyIndex;if(t||(t=e.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var o=n.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===o){o=s;break}break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var u=t[i];if(void 0!==u){var c=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?c=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate);var l=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[a]&&(a=t.morphTargetDictionary[a])}l=this.BindingType.ArrayElement,this.resolvedProperty=u,this.propertyIndex=a}else void 0!==u.fromArray&&void 0!==u.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=u):Array.isArray(u)?(l=this.BindingType.EntireArray,this.resolvedProperty=u):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][c]}else{var h=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+i+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")}},{key:"unbind",value:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}],[{key:"create",value:function(t,n,r){return t&&t.isAnimationObjectGroup?new e.Composite(t,n,r):new e(t,n,r)}},{key:"sanitizeNodeName",value:function(e){return e.replace(/\s/g,"_").replace(ll,"")}},{key:"parseTrackName",value:function(e){var t=gl.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==yl.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}},{key:"findNode",value:function(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var r=function e(n){for(var r=0;r<n.length;r++){var i=n[r];if(i.name===t||i.uuid===t)return i;var a=e(i.children);if(a)return a}return null}(e.children);if(r)return r}return null}}]),e}();wl.Composite=bl,wl.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},wl.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},wl.prototype.GetterByBindingType=[wl.prototype._getValue_direct,wl.prototype._getValue_array,wl.prototype._getValue_arrayElement,wl.prototype._getValue_toArray],wl.prototype.SetterByBindingTypeAndVersioning=[[wl.prototype._setValue_direct,wl.prototype._setValue_direct_setNeedsUpdate,wl.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[wl.prototype._setValue_array,wl.prototype._setValue_array_setNeedsUpdate,wl.prototype._setValue_array_setMatrixWorldNeedsUpdate],[wl.prototype._setValue_arrayElement,wl.prototype._setValue_arrayElement_setNeedsUpdate,wl.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[wl.prototype._setValue_fromArray,wl.prototype._setValue_fromArray_setNeedsUpdate,wl.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var xl=function(){function e(t){Object(E.a)(this,e),"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}return Object(A.a)(e,[{key:"clone",value:function(){return new e(void 0===this.value.clone?this.value:this.value.clone())}}]),e}(),Ol=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;Object(E.a)(this,e),this.ray=new Cr(t,n),this.near=r,this.far=i,this.camera=null,this.layers=new Gr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}return Object(A.a)(e,[{key:"set",value:function(e,t){this.ray.set(e,t)}},{key:"setFromCamera",value:function(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}},{key:"intersectObject",value:function(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return _l(e,this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),t.sort(kl),t}},{key:"intersectObjects",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=0,i=e.length;r<i;r++)_l(e[r],this,n,t);return n.sort(kl),n}}]),e}();function kl(e,t){return e.distance-t.distance}function _l(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r)for(var i=e.children,a=0,o=i.length;a<o;a++)_l(i[a],t,n,!0)}var Sl=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(E.a)(this,e),this.radius=t,this.phi=n,this.theta=r,this}return Object(A.a)(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:"makeSafe",value:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(xn(t/this.radius,-1,1))),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),El=new An,Al=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new An(1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An(-1/0,-1/0);Object(E.a)(this,e),this.isBox2=!0,this.min=t,this.max=n}return Object(A.a)(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=El.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return El.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),jl=new tr,Tl=new tr,Ml=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tr;Object(E.a)(this,e),this.start=t,this.end=n}return Object(A.a)(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"getCenter",value:function(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return e.subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){jl.subVectors(e,this.start),Tl.subVectors(this.end,this.start);var n=Tl.dot(Tl),r=Tl.dot(jl)/n;return t&&(r=xn(r,0,1)),r}},{key:"closestPointToPoint",value:function(e,t,n){var r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),Cl=new tr,Dl=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;Object(E.a)(this,n),(i=t.call(this)).light=e,i.light.updateMatrixWorld(),i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i.color=r;for(var a=new Di,o=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],s=0,u=1;s<32;s++,u++){var c=s/32*Math.PI*2,l=u/32*Math.PI*2;o.push(Math.cos(c),Math.sin(c),1,Math.cos(l),Math.sin(l),1)}a.setAttribute("position",new _i(o,3));var h=new cu({fog:!1,toneMapped:!1});return i.cone=new yu(a,h),i.add(i.cone),i.update(),i}return Object(A.a)(n,[{key:"dispose",value:function(){this.cone.geometry.dispose(),this.cone.material.dispose()}},{key:"update",value:function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Cl.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Cl),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}]),n}(ri),Il=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;Object(E.a)(this,n);var o=new kc(r,4,2),s=new gi({wireframe:!0,fog:!1,toneMapped:!1});return(a=t.call(this,o,s)).light=e,a.light.updateMatrixWorld(),a.color=i,a.type="PointLightHelper",a.matrix=a.light.matrixWorld,a.matrixAutoUpdate=!1,a.update(),a}return Object(A.a)(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"update",value:function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}]),n}(Qi),Pl=new tr,Rl=new tr,Ll=new tr,Nl=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;Object(E.a)(this,n),(a=t.call(this)).light=e,a.light.updateMatrixWorld(),a.matrix=e.matrixWorld,a.matrixAutoUpdate=!1,a.color=i,void 0===r&&(r=1);var o=new Di;o.setAttribute("position",new _i([-r,r,0,r,r,0,r,-r,0,-r,-r,0,-r,r,0],3));var s=new cu({fog:!1,toneMapped:!1});return a.lightPlane=new vu(o,s),a.add(a.lightPlane),(o=new Di).setAttribute("position",new _i([0,0,0,0,0,1],3)),a.targetLine=new vu(o,s),a.add(a.targetLine),a.update(),a}return Object(A.a)(n,[{key:"dispose",value:function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}},{key:"update",value:function(){Pl.setFromMatrixPosition(this.light.matrixWorld),Rl.setFromMatrixPosition(this.light.target.matrixWorld),Ll.subVectors(Rl,Pl),this.lightPlane.lookAt(Rl),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Rl),this.targetLine.scale.z=Ll.length()}}]),n}(ri),Bl=new tr,Fl=new aa,Ul=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;Object(E.a)(this,n);var i=new Di,a=new cu({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],s=[],u={};function c(e,t){l(e),l(t)}function l(e){o.push(0,0,0),s.push(0,0,0),void 0===u[e]&&(u[e]=[]),u[e].push(o.length/3-1)}c("n1","n2"),c("n2","n4"),c("n4","n3"),c("n3","n1"),c("f1","f2"),c("f2","f4"),c("f4","f3"),c("f3","f1"),c("n1","f1"),c("n2","f2"),c("n3","f3"),c("n4","f4"),c("p","n1"),c("p","n2"),c("p","n3"),c("p","n4"),c("u1","u2"),c("u2","u3"),c("u3","u1"),c("c","t"),c("p","c"),c("cn1","cn2"),c("cn3","cn4"),c("cf1","cf2"),c("cf3","cf4"),i.setAttribute("position",new _i(o,3)),i.setAttribute("color",new _i(s,3)),(r=t.call(this,i,a)).type="CameraHelper",r.camera=e,r.camera.updateProjectionMatrix&&r.camera.updateProjectionMatrix(),r.matrix=e.matrixWorld,r.matrixAutoUpdate=!1,r.pointMap=u,r.update();var h=new Gn(16755200),d=new Gn(16711680),f=new Gn(43775),p=new Gn(16777215),v=new Gn(3355443);return r.setColors(h,d,f,p,v),r}return Object(A.a)(n,[{key:"setColors",value:function(e,t,n,r,i){var a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,i.r,i.g,i.b),a.setXYZ(41,i.r,i.g,i.b),a.setXYZ(42,i.r,i.g,i.b),a.setXYZ(43,i.r,i.g,i.b),a.setXYZ(44,i.r,i.g,i.b),a.setXYZ(45,i.r,i.g,i.b),a.setXYZ(46,i.r,i.g,i.b),a.setXYZ(47,i.r,i.g,i.b),a.setXYZ(48,i.r,i.g,i.b),a.setXYZ(49,i.r,i.g,i.b),a.needsUpdate=!0}},{key:"update",value:function(){var e=this.geometry,t=this.pointMap;Fl.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),zl("c",t,e,Fl,0,0,-1),zl("t",t,e,Fl,0,0,1),zl("n1",t,e,Fl,-1,-1,-1),zl("n2",t,e,Fl,1,-1,-1),zl("n3",t,e,Fl,-1,1,-1),zl("n4",t,e,Fl,1,1,-1),zl("f1",t,e,Fl,-1,-1,1),zl("f2",t,e,Fl,1,-1,1),zl("f3",t,e,Fl,-1,1,1),zl("f4",t,e,Fl,1,1,1),zl("u1",t,e,Fl,.7,1.1,-1),zl("u2",t,e,Fl,-.7,1.1,-1),zl("u3",t,e,Fl,0,2,-1),zl("cf1",t,e,Fl,-1,0,1),zl("cf2",t,e,Fl,1,0,1),zl("cf3",t,e,Fl,0,-1,1),zl("cf4",t,e,Fl,0,1,1),zl("cn1",t,e,Fl,-1,0,-1),zl("cn2",t,e,Fl,1,0,-1),zl("cn3",t,e,Fl,0,-1,-1),zl("cn4",t,e,Fl,0,1,-1),e.getAttribute("position").needsUpdate=!0}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(yu);function zl(e,t,n,r,i,a,o){Bl.set(i,a,o).unproject(r);var s=t[e];if(void 0!==s)for(var u=n.getAttribute("position"),c=0,l=s.length;c<l;c++)u.setXYZ(s[c],Bl.x,Bl.y,Bl.z)}var Vl=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;Object(E.a)(this,n);var a=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Di;return o.setIndex(new wi(a,1)),o.setAttribute("position",new _i([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),(r=t.call(this,o,new cu({color:i,toneMapped:!1}))).box=e,r.type="Box3Helper",r.geometry.computeBoundingSphere(),r}return Object(A.a)(n,[{key:"updateMatrixWorld",value:function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),Object(b.a)(Object(w.a)(n.prototype),"updateMatrixWorld",this).call(this,e))}}]),n}(yu),Gl=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;Object(E.a)(this,n);var i=[0,0,0,r,0,0,0,0,0,0,r,0,0,0,0,0,0,r],a=new Di;a.setAttribute("position",new _i(i,3)),a.setAttribute("color",new _i([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var o=new cu({vertexColors:!0,toneMapped:!1});return(e=t.call(this,a,o)).type="AxesHelper",e}return Object(A.a)(n,[{key:"setColors",value:function(e,t,n){var r=new Gn,i=this.geometry.attributes.color.array;return r.set(e),r.toArray(i,0),r.toArray(i,3),r.set(t),r.toArray(i,6),r.toArray(i,9),r.set(n),r.toArray(i,12),r.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(yu),Hl=function(){for(var e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),i=new Uint32Array(512),a=0;a<256;++a){var o=a-127;o<-27?(r[a]=0,r[256|a]=32768,i[a]=24,i[256|a]=24):o<-14?(r[a]=1024>>-o-14,r[256|a]=1024>>-o-14|32768,i[a]=-o-1,i[256|a]=-o-1):o<=15?(r[a]=o+15<<10,r[256|a]=o+15<<10|32768,i[a]=13,i[256|a]=13):o<128?(r[a]=31744,r[256|a]=64512,i[a]=24,i[256|a]=24):(r[a]=31744,r[256|a]=64512,i[a]=13,i[256|a]=13)}for(var s=new Uint32Array(2048),u=new Uint32Array(64),c=new Uint32Array(64),l=1;l<1024;++l){for(var h=l<<13,d=0;0===(8388608&h);)h<<=1,d-=8388608;h&=-8388609,d+=947912704,s[l]=h|d}for(var f=1024;f<2048;++f)s[f]=939524096+(f-1024<<13);for(var p=1;p<31;++p)u[p]=p<<23;u[31]=1199570944,u[32]=2147483648;for(var v=33;v<63;++v)u[v]=2147483648+(v-32<<23);u[63]=3347054592;for(var m=1;m<64;++m)32!==m&&(c[m]=1024);return{floatView:t,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:s,exponentTable:u,offsetTable:c}}();Hl.floatView,Hl.uint32View,Hl.baseTable,Hl.shiftTable,Hl.mantissaTable,Hl.exponentTable,Hl.offsetTable;var Wl=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;return Object(E.a)(this,n),console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),(a=t.call(this,e,r,i)).samples=4,a}return Object(A.a)(n)}(Zn);typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:W}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=W);var ql=".",Yl=Symbol("target"),Xl=Symbol("unsubscribe");function Kl(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}var Ql=Array.isArray;function Zl(e){return"symbol"==typeof e}var Jl={after:function(e,t){return Ql(e)?e.slice(t.length):""===t?e:e.slice(t.length+1)},concat:function(e,t){return Ql(e)?(e=Object(v.a)(e),t&&e.push(t),e):t&&void 0!==t.toString?(""!==e&&(e+=ql),Zl(t)?e+t.toString():e+t):e},initial:function(e){if(Ql(e))return e.slice(0,-1);if(""===e)return e;var t=e.lastIndexOf(ql);return-1===t?"":e.slice(0,t)},last:function(e){if(Ql(e))return e[e.length-1]||"";if(""===e)return e;var t=e.lastIndexOf(ql);return-1===t?e:e.slice(t+1)},walk:function(e,t){if(Ql(e)){var n,r=Object(j.a)(e);try{for(r.s();!(n=r.n()).done;){t(n.value)}}catch(o){r.e(o)}finally{r.f()}}else if(""!==e){var i=0,a=e.indexOf(ql);if(-1===a)t(e);else for(;i<e.length;)-1===a&&(a=e.length),t(e.slice(i,a)),i=a+1,a=e.indexOf(ql,i)}},get:function(e,t){return this.walk(t,(function(t){e&&(e=e[t])})),e}},$l=Jl;function eh(e,t,n){return e.isUnsubscribed||t.ignoreSymbols&&Zl(n)||t.ignoreUnderscores&&"_"===n.charAt(0)||"ignoreKeys"in t&&t.ignoreKeys.includes(n)}var th=function(){function e(t){Object(E.a)(this,e),this._equals=t,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}return Object(A.a)(e,[{key:"_getDescriptorCache",value:function(){return void 0===this._descriptorCache&&(this._descriptorCache=new WeakMap),this._descriptorCache}},{key:"_getProperties",value:function(e){var t=this._getDescriptorCache(),n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n}},{key:"_getOwnPropertyDescriptor",value:function(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);var n=this._getProperties(e),r=n[t];return void 0===r&&(r=Reflect.getOwnPropertyDescriptor(e,t),n[t]=r),r}},{key:"getProxy",value:function(e,t,n,r){if(this.isUnsubscribed)return e;var i=e[r],a=i||e;this._pathCache.set(a,t);var o=this._proxyCache.get(a);return void 0===o&&(o=void 0===i?new Proxy(e,n):e,this._proxyCache.set(a,o)),o}},{key:"getPath",value:function(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}},{key:"isDetached",value:function(e,t){return!Object.is(e,$l.get(t,this.getPath(e)))}},{key:"defineProperty",value:function(e,t,n){return!!Reflect.defineProperty(e,t,n)&&(this.isUnsubscribed||(this._getProperties(e)[t]=n),!0)}},{key:"setProperty",value:function(e,t,n,r,i){if(!this._equals(i,n)||!(t in e)){var a=this._getOwnPropertyDescriptor(e,t);return void 0!==a&&"set"in a?Reflect.set(e,t,n,r):Reflect.set(e,t,n)}return!0}},{key:"deleteProperty",value:function(e,t,n){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){var r=this._getDescriptorCache().get(e);r&&(delete r[t],this._pathCache.delete(n))}return!0}return!1}},{key:"isSameDescriptor",value:function(e,t,n){var r=this._getOwnPropertyDescriptor(t,n);return void 0!==e&&void 0!==r&&Object.is(e.value,r.value)&&(e.writable||!1)===(r.writable||!1)&&(e.enumerable||!1)===(r.enumerable||!1)&&(e.configurable||!1)===(r.configurable||!1)&&e.get===r.get&&e.set===r.set}},{key:"isGetInvariant",value:function(e,t){var n=this._getOwnPropertyDescriptor(e,t);return void 0!==n&&!0!==n.configurable&&!0!==n.writable}},{key:"unsubscribe",value:function(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}}]),e}();function nh(e){return"[object Object]"===toString.call(e)}function rh(){return!0}function ih(e,t){return e.length!==t.length||e.some((function(e,n){return t[n]!==e}))}var ah=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),oh=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),sh={push:rh,pop:rh,shift:rh,unshift:rh,copyWithin:ih,reverse:ih,sort:ih,splice:ih,flat:ih,fill:ih},uh=new Set([].concat(Object(v.a)(ah),Object(v.a)(oh),Object(v.a)(Object.keys(sh))));function ch(e,t){if(e.size!==t.size)return!0;var n,r=Object(j.a)(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!t.has(i))return!0}}catch(a){r.e(a)}finally{r.f()}return!1}var lh=["keys","values","entries"],hh=new Set(["has","toString"]),dh={add:ch,clear:ch,delete:ch,forEach:ch},fh=new Set([].concat(Object(v.a)(hh),Object(v.a)(Object.keys(dh)),lh));function ph(e,t){if(e.size!==t.size)return!0;var n,r,i=Object(j.a)(e);try{for(i.s();!(r=i.n()).done;){var a=Object(g.a)(r.value,2),o=a[0],s=a[1];if((n=t.get(o))!==s||void 0===n&&!t.has(o))return!0}}catch(u){i.e(u)}finally{i.f()}return!1}var vh=new Set([].concat(Object(v.a)(hh),["get"])),mh={set:ph,clear:ph,delete:ph,forEach:ph},gh=new Set([].concat(Object(v.a)(vh),Object(v.a)(Object.keys(mh)),lh)),yh=function(){function e(t,n,r,i){Object(E.a)(this,e),this._path=n,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=i,this._changes=i?[]:null,this.clone=void 0===n?t:this._shallowClone(t)}return Object(A.a)(e,[{key:"_shallowClone",value:function(e){var t=this,n=e;if(nh(e))n=Object(p.a)({},e);else if(Ql(e))n=Object(v.a)(e);else if(e instanceof Date)n=new Date(e);else if(e instanceof Set)n=new Set(Object(v.a)(e).map((function(e){return t._shallowClone(e)})));else if(e instanceof Map){n=new Map;var r,i=Object(j.a)(e.entries());try{for(i.s();!(r=i.n()).done;){var a=Object(g.a)(r.value,2),o=a[0],s=a[1];n.set(o,this._shallowClone(s))}}catch(u){i.e(u)}finally{i.f()}}return this._clonedCache.add(n),n}},{key:"preferredThisArg",value:function(e,t,n,r){return e?(Ql(r)?this._onIsChanged=sh[t]:r instanceof Set?this._onIsChanged=dh[t]:r instanceof Map&&(this._onIsChanged=mh[t]),r):n}},{key:"update",value:function(e,t,n){var r=this,i=$l.after(e,this._path);if("length"!==t){var a=this.clone;$l.walk(i,(function(e){a&&a[e]&&(r._clonedCache.has(a[e])||(a[e]=r._shallowClone(a[e])),a=a[e])})),this._hasOnValidate&&this._changes.push({path:i,property:t,previous:n}),a&&a[t]&&(a[t]=n)}this._isChanged=!0}},{key:"undo",value:function(e){for(var t,n=this._changes.length-1;-1!==n;n--)t=this._changes[n],$l.get(e,t.path)[t.property]=t.previous}},{key:"isChanged",value:function(e){return void 0===this._onIsChanged?this._isChanged:this._onIsChanged(this.clone,e)}}],[{key:"isHandledMethod",value:function(e){return ah.has(e)}}]),e}(),bh=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n,null,[{key:"isHandledMethod",value:function(e){return uh.has(e)}}]),n}(yh),wh=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n,[{key:"undo",value:function(e){e.setTime(this.clone.getTime())}},{key:"isChanged",value:function(e,t){return!t(this.clone.valueOf(),e.valueOf())}}]),n}(yh),xh=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n,[{key:"undo",value:function(e){var t,n=Object(j.a)(this.clone);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.add(r)}}catch(s){n.e(s)}finally{n.f()}var i,a=Object(j.a)(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.clone.has(o)||e.delete(o)}}catch(s){a.e(s)}finally{a.f()}}}],[{key:"isHandledMethod",value:function(e){return fh.has(e)}}]),n}(yh),Oh=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n,[{key:"undo",value:function(e){var t,n=Object(j.a)(this.clone.entries());try{for(n.s();!(t=n.n()).done;){var r=Object(g.a)(t.value,2),i=r[0],a=r[1];e.set(i,a)}}catch(c){n.e(c)}finally{n.f()}var o,s=Object(j.a)(e.keys());try{for(s.s();!(o=s.n()).done;){var u=o.value;this.clone.has(u)||e.delete(u)}}catch(c){s.e(c)}finally{s.f()}}}],[{key:"isHandledMethod",value:function(e){return gh.has(e)}}]),n}(yh),kh=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a){var o;return Object(E.a)(this,n),(o=t.call(this,void 0,r,i,a))._arg1=i[0],o._weakValue=e.has(o._arg1),o}return Object(A.a)(n,[{key:"isChanged",value:function(e){return this._weakValue!==e.has(this._arg1)}},{key:"undo",value:function(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}}]),n}(yh),_h=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a){var o;return Object(E.a)(this,n),(o=t.call(this,void 0,r,i,a))._weakKey=i[0],o._weakHas=e.has(o._weakKey),o._weakValue=e.get(o._weakKey),o}return Object(A.a)(n,[{key:"isChanged",value:function(e){return this._weakValue!==e.get(this._weakKey)}},{key:"undo",value:function(e){var t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}}]),n}(yh),Sh=function(){function e(t){Object(E.a)(this,e),this._stack=[],this._hasOnValidate=t}return Object(A.a)(e,[{key:"isCloning",get:function(){return this._stack.length>0}},{key:"start",value:function(e,t,n){var r=yh;Ql(e)?r=bh:e instanceof Date?r=wh:e instanceof Set?r=xh:e instanceof Map?r=Oh:e instanceof WeakSet?r=kh:e instanceof WeakMap&&(r=_h),this._stack.push(new r(e,t,n,this._hasOnValidate))}},{key:"update",value:function(e,t,n){this._stack[this._stack.length-1].update(e,t,n)}},{key:"preferredThisArg",value:function(t,n,r){var i=t.name,a=e.isHandledMethod(r,i);return this._stack[this._stack.length-1].preferredThisArg(a,i,n,r)}},{key:"isChanged",value:function(e,t,n){return this._stack[this._stack.length-1].isChanged(e,t,n)}},{key:"undo",value:function(e){void 0!==this._previousClone&&this._previousClone.undo(e)}},{key:"stop",value:function(){return this._previousClone=this._stack.pop(),this._previousClone.clone}}],[{key:"isHandledType",value:function(e){return nh(e)||Ql(e)||Kl(e)}},{key:"isHandledMethod",value:function(e,t){return nh(e)?yh.isHandledMethod(t):Ql(e)?bh.isHandledMethod(t):e instanceof Set?xh.isHandledMethod(t):e instanceof Map?Oh.isHandledMethod(t):Kl(e)}}]),e}(),Eh={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},Ah=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n=Object(p.a)(Object(p.a)({},Eh),n);var r=Symbol("ProxyTarget"),i=n,a=i.equals,o=i.isShallow,s=i.ignoreDetached,u=i.details,c=new th(a),l="function"==typeof n.onValidate,h=new Sh(l),d=function(e,t,r,i,a){return!l||h.isCloning||!0===n.onValidate($l.concat(c.getPath(e),t),r,i,a)},f=function(t,r,i,a){!eh(c,n,r)&&(!s||!c.isDetached(t,e))&&v(c.getPath(t),r,i,a)},v=function(e,n,r,i,a){h.isCloning?h.update(e,n,i):t($l.concat(e,n),r,i,a)},m=function(e){return e&&(e[r]||e)},g=function(t,i,a,u){return function(e){return("object"==typeof e?null===e:"function"!=typeof e)||e instanceof RegExp}(t)||"constructor"===a||o&&!Sh.isHandledMethod(i,a)||eh(c,n,a)||c.isGetInvariant(i,a)||s&&c.isDetached(i,e)?t:(void 0===u&&(u=c.getPath(i)),c.getProxy(t,$l.concat(u,a),y,r))},y={get:function(e,t,n){if(Zl(t)){if(t===r||t===Yl)return e;if(t===Xl&&!c.isUnsubscribed&&0===c.getPath(e).length)return c.unsubscribe(),e}var i=Kl(e)?Reflect.get(e,t):Reflect.get(e,t,n);return g(i,e,t)},set:function(e,t,n,i){n=m(n);var o=e[r]||e,s=o[t];if(a(s,n)&&t in e)return!0;var u=d(e,t,n,s);return u&&c.setProperty(o,t,n,i,s)?(f(e,t,e[t],s),!0):!u},defineProperty:function(e,t,n){if(!c.isSameDescriptor(n,e,t)){var r=e[t];d(e,t,n.value,r)&&c.defineProperty(e,t,n,r)&&f(e,t,n.value,r)}return!0},deleteProperty:function(e,t){if(!Reflect.has(e,t))return!0;var n=Reflect.get(e,t),r=d(e,t,void 0,n);return r&&c.deleteProperty(e,t,n)?(f(e,t,void 0,n),!0):!r},apply:function(t,n,i){var o=n[r]||n;if(c.isUnsubscribed)return Reflect.apply(t,o,i);if((!1===u||!0!==u&&!u.includes(t.name))&&Sh.isHandledType(o)){var s=$l.initial(c.getPath(t)),l=Sh.isHandledMethod(o,t.name);h.start(o,s,i);var f=Reflect.apply(t,h.preferredThisArg(t,n,o),l?i.map((function(e){return m(e)})):i),p=h.isChanged(o,a),b=h.stop();if(Sh.isHandledType(f)&&l&&(n instanceof Map&&"get"===t.name&&(s=$l.concat(s,i[0])),f=c.getProxy(f,s,y)),p){var w={name:t.name,args:i,result:f},x=h.isCloning?$l.initial(s):s,O=h.isCloning?$l.last(s):"";d($l.get(e,x),O,o,b,w)?v(x,O,o,b,w):h.undo(o)}return(n instanceof Map||n instanceof Set)&&function(e){return"object"==typeof e&&"function"==typeof e.next}(f)?function(e,t,n,r,i){var a=e.next;if("entries"===t.name)e.next=function(){var e=a.call(this);return!1===e.done&&(e.value[0]=i(e.value[0],t,e.value[0],r),e.value[1]=i(e.value[1],t,e.value[0],r)),e};else if("values"===t.name){var o=n[Yl].keys();e.next=function(){var e=a.call(this);return!1===e.done&&(e.value=i(e.value,t,o.next().value,r)),e}}else e.next=function(){var e=a.call(this);return!1===e.done&&(e.value=i(e.value,t,e.value,r)),e};return e}(f,t,n,s,g):f}return Reflect.apply(t,n,i)}},b=c.getProxy(e,n.pathAsArray?[]:"",y);return t=t.bind(b),l&&(n.onValidate=n.onValidate.bind(b)),b};Ah.target=function(e){return e&&e[Yl]||e},Ah.unsubscribe=function(e){return e[Xl]||e};var jh=Ah,Th="object"==typeof e&&e&&e.Object===Object&&e,Mh="object"==typeof self&&self&&self.Object===Object&&self,Ch=Th||Mh||Function("return this")(),Dh=Ch.Symbol,Ih=Object.prototype,Ph=Ih.hasOwnProperty,Rh=Ih.toString,Lh=Dh?Dh.toStringTag:void 0;var Nh=function(e){var t=Ph.call(e,Lh),n=e[Lh];try{e[Lh]=void 0;var r=!0}catch(a){}var i=Rh.call(e);return r&&(t?e[Lh]=n:delete e[Lh]),i},Bh=Object.prototype.toString;var Fh=function(e){return Bh.call(e)},Uh="[object Null]",zh="[object Undefined]",Vh=Dh?Dh.toStringTag:void 0;var Gh=function(e){return null==e?void 0===e?zh:Uh:Vh&&Vh in Object(e)?Nh(e):Fh(e)};var Hh=function(e){return null!=e&&"object"==typeof e},Wh="[object Symbol]";var qh=function(e){return"symbol"==typeof e||Hh(e)&&Gh(e)==Wh};var Yh=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i},Xh=Array.isArray,Kh=1/0,Qh=Dh?Dh.prototype:void 0,Zh=Qh?Qh.toString:void 0;var Jh=function e(t){if("string"==typeof t)return t;if(Xh(t))return Yh(t,e)+"";if(qh(t))return Zh?Zh.call(t):"";var n=t+"";return"0"==n&&1/t==-Kh?"-0":n},$h=/\s/;var ed=function(e){for(var t=e.length;t--&&$h.test(e.charAt(t)););return t},td=/^\s+/;var nd=function(e){return e&&e.slice(0,ed(e)+1).replace(td,"")};var rd=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},id=NaN,ad=/^[-+]0x[0-9a-f]+$/i,od=/^0b[01]+$/i,sd=/^0o[0-7]+$/i,ud=parseInt;var cd=function(e){if("number"==typeof e)return e;if(qh(e))return id;if(rd(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=rd(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=nd(e);var n=od.test(e);return n||sd.test(e)?ud(e.slice(2),n?2:8):ad.test(e)?id:+e};var ld=function(e){return e},hd="[object AsyncFunction]",dd="[object Function]",fd="[object GeneratorFunction]",pd="[object Proxy]";var vd=function(e){if(!rd(e))return!1;var t=Gh(e);return t==dd||t==fd||t==hd||t==pd},md=Ch["__core-js_shared__"],gd=function(){var e=/[^.]+$/.exec(md&&md.keys&&md.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var yd=function(e){return!!gd&&gd in e},bd=Function.prototype.toString;var wd=function(e){if(null!=e){try{return bd.call(e)}catch(t){}try{return e+""}catch(n){}}return""},xd=/^\[object .+?Constructor\]$/,Od=Function.prototype,kd=Object.prototype,_d=Od.toString,Sd=kd.hasOwnProperty,Ed=RegExp("^"+_d.call(Sd).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Ad=function(e){return!(!rd(e)||yd(e))&&(vd(e)?Ed:xd).test(wd(e))};var jd=function(e,t){return null===e||void 0===e?void 0:e[t]};var Td=function(e,t){var n=jd(e,t);return Ad(n)?n:void 0},Md=Td(Ch,"WeakMap"),Cd=Object.create,Dd=function(){function e(){}return function(t){if(!rd(t))return{};if(Cd)return Cd(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}(),Id=Dd;var Pd=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)};var Rd=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},Ld=800,Nd=16,Bd=Date.now;var Fd=function(e){var t=0,n=0;return function(){var r=Bd(),i=Nd-(r-n);if(n=r,i>0){if(++t>=Ld)return arguments[0]}else t=0;return e.apply(void 0,arguments)}};var Ud=function(e){return function(){return e}},zd=function(){try{var e=Td(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),Vd=zd,Gd=Vd?function(e,t){return Vd(e,"toString",{configurable:!0,enumerable:!1,value:Ud(t),writable:!0})}:ld,Hd=Fd(Gd);var Wd=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},qd=9007199254740991,Yd=/^(?:0|[1-9]\d*)$/;var Xd=function(e,t){var n,r=typeof e;return!!(t=null!==(n=t)&&void 0!==n?n:qd)&&("number"==r||"symbol"!=r&&Yd.test(e))&&e>-1&&e%1==0&&e<t};var Kd=function(e,t,n){"__proto__"==t&&Vd?Vd(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var Qd=function(e,t){return e===t||e!==e&&t!==t},Zd=Object.prototype.hasOwnProperty;var Jd=function(e,t,n){var r=e[t];(!Zd.call(e,t)||!Qd(r,n)||void 0===n&&!(t in e))&&Kd(e,t,n)};var $d=function(e,t,n,r){var i=!n;n||(n={});for(var a=-1,o=t.length;++a<o;){var s=t[a],u=r?r(n[s],e[s],s,n,e):void 0;void 0===u&&(u=e[s]),i?Kd(n,s,u):Jd(n,s,u)}return n},ef=Math.max;var tf=function(e,t,n){return t=ef(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,a=ef(r.length-t,0),o=Array(a);++i<a;)o[i]=r[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=r[i];return s[t]=n(o),Pd(e,this,s)}},nf=9007199254740991;var rf=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=nf};var af=function(e){return null!=e&&rf(e.length)&&!vd(e)},of=Object.prototype;var sf=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||of)};var uf=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},cf="[object Arguments]";var lf=function(e){return Hh(e)&&Gh(e)==cf},hf=Object.prototype,df=hf.hasOwnProperty,ff=hf.propertyIsEnumerable,pf=lf(function(){return arguments}())?lf:function(e){return Hh(e)&&df.call(e,"callee")&&!ff.call(e,"callee")},vf=pf;var mf=function(){return!1},gf="object"==typeof exports&&exports&&!exports.nodeType&&exports,yf=gf&&"object"==typeof r&&r&&!r.nodeType&&r,bf=yf&&yf.exports===gf?Ch.Buffer:void 0,wf=(bf?bf.isBuffer:void 0)||mf,xf={};xf["[object Float32Array]"]=xf["[object Float64Array]"]=xf["[object Int8Array]"]=xf["[object Int16Array]"]=xf["[object Int32Array]"]=xf["[object Uint8Array]"]=xf["[object Uint8ClampedArray]"]=xf["[object Uint16Array]"]=xf["[object Uint32Array]"]=!0,xf["[object Arguments]"]=xf["[object Array]"]=xf["[object ArrayBuffer]"]=xf["[object Boolean]"]=xf["[object DataView]"]=xf["[object Date]"]=xf["[object Error]"]=xf["[object Function]"]=xf["[object Map]"]=xf["[object Number]"]=xf["[object Object]"]=xf["[object RegExp]"]=xf["[object Set]"]=xf["[object String]"]=xf["[object WeakMap]"]=!1;var Of=function(e){return Hh(e)&&rf(e.length)&&!!xf[Gh(e)]};var kf=function(e){return function(t){return e(t)}},_f="object"==typeof exports&&exports&&!exports.nodeType&&exports,Sf=_f&&"object"==typeof r&&r&&!r.nodeType&&r,Ef=Sf&&Sf.exports===_f&&Th.process,Af=function(){try{return Sf&&Sf.require&&Sf.require("util").types||Ef&&Ef.binding&&Ef.binding("util")}catch(e){}}(),jf=Af&&Af.isTypedArray,Tf=jf?kf(jf):Of,Mf=Object.prototype.hasOwnProperty;var Cf=function(e,t){var n=Xh(e),r=!n&&vf(e),i=!n&&!r&&wf(e),a=!n&&!r&&!i&&Tf(e),o=n||r||i||a,s=o?uf(e.length,String):[],u=s.length;for(var c in e)(t||Mf.call(e,c))&&(!o||!("length"==c||i&&("offset"==c||"parent"==c)||a&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Xd(c,u)))&&s.push(c);return s};var Df=function(e,t){return function(n){return e(t(n))}},If=Df(Object.keys,Object),Pf=Object.prototype.hasOwnProperty;var Rf=function(e){if(!sf(e))return If(e);var t=[];for(var n in Object(e))Pf.call(e,n)&&"constructor"!=n&&t.push(n);return t};var Lf=function(e){return af(e)?Cf(e):Rf(e)};var Nf=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},Bf=Object.prototype.hasOwnProperty;var Ff=function(e){if(!rd(e))return Nf(e);var t=sf(e),n=[];for(var r in e)"constructor"==r&&(t||!Bf.call(e,r))||n.push(r);return n};var Uf=function(e){return af(e)?Cf(e,!0):Ff(e)},zf=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Vf=/^\w*$/;var Gf=function(e,t){if(Xh(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!qh(e))||(Vf.test(e)||!zf.test(e)||null!=t&&e in Object(t))},Hf=Td(Object,"create");var Wf=function(){this.__data__=Hf?Hf(null):{},this.size=0};var qf=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Yf="__lodash_hash_undefined__",Xf=Object.prototype.hasOwnProperty;var Kf=function(e){var t=this.__data__;if(Hf){var n=t[e];return n===Yf?void 0:n}return Xf.call(t,e)?t[e]:void 0},Qf=Object.prototype.hasOwnProperty;var Zf=function(e){var t=this.__data__;return Hf?void 0!==t[e]:Qf.call(t,e)},Jf="__lodash_hash_undefined__";var $f=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Hf&&void 0===t?Jf:t,this};function ep(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ep.prototype.clear=Wf,ep.prototype.delete=qf,ep.prototype.get=Kf,ep.prototype.has=Zf,ep.prototype.set=$f;var tp=ep;var np=function(){this.__data__=[],this.size=0};var rp=function(e,t){for(var n=e.length;n--;)if(Qd(e[n][0],t))return n;return-1},ip=Array.prototype.splice;var ap=function(e){var t=this.__data__,n=rp(t,e);return!(n<0)&&(n==t.length-1?t.pop():ip.call(t,n,1),--this.size,!0)};var op=function(e){var t=this.__data__,n=rp(t,e);return n<0?void 0:t[n][1]};var sp=function(e){return rp(this.__data__,e)>-1};var up=function(e,t){var n=this.__data__,r=rp(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function cp(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}cp.prototype.clear=np,cp.prototype.delete=ap,cp.prototype.get=op,cp.prototype.has=sp,cp.prototype.set=up;var lp=cp,hp=Td(Ch,"Map");var dp=function(){this.size=0,this.__data__={hash:new tp,map:new(hp||lp),string:new tp}};var fp=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var pp=function(e,t){var n=e.__data__;return fp(t)?n["string"==typeof t?"string":"hash"]:n.map};var vp=function(e){var t=pp(this,e).delete(e);return this.size-=t?1:0,t};var mp=function(e){return pp(this,e).get(e)};var gp=function(e){return pp(this,e).has(e)};var yp=function(e,t){var n=pp(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function bp(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}bp.prototype.clear=dp,bp.prototype.delete=vp,bp.prototype.get=mp,bp.prototype.has=gp,bp.prototype.set=yp;var wp=bp,xp="Expected a function";function Op(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(xp);var n=function n(){var r=arguments,i=t?t.apply(this,r):r[0],a=n.cache;if(a.has(i))return a.get(i);var o=e.apply(this,r);return n.cache=a.set(i,o)||a,o};return n.cache=new(Op.Cache||wp),n}Op.Cache=wp;var kp=Op,_p=500;var Sp=function(e){var t=kp(e,(function(e){return n.size===_p&&n.clear(),e})),n=t.cache;return t},Ep=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ap=/\\(\\)?/g,jp=Sp((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Ep,(function(e,n,r,i){t.push(r?i.replace(Ap,"$1"):n||e)})),t})),Tp=jp;var Mp=function(e){return null==e?"":Jh(e)};var Cp=function(e,t){return Xh(e)?e:Gf(e,t)?[e]:Tp(Mp(e))},Dp=1/0;var Ip=function(e){if("string"==typeof e||qh(e))return e;var t=e+"";return"0"==t&&1/e==-Dp?"-0":t};var Pp=function(e,t){for(var n=0,r=(t=Cp(t,e)).length;null!=e&&n<r;)e=e[Ip(t[n++])];return n&&n==r?e:void 0};var Rp=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},Lp=Dh?Dh.isConcatSpreadable:void 0;var Np=function(e){return Xh(e)||vf(e)||!!(Lp&&e&&e[Lp])};var Bp=function e(t,n,r,i,a){var o=-1,s=t.length;for(r||(r=Np),a||(a=[]);++o<s;){var u=t[o];n>0&&r(u)?n>1?e(u,n-1,r,i,a):Rp(a,u):i||(a[a.length]=u)}return a};var Fp=function(e){return(null==e?0:e.length)?Bp(e,1):[]};var Up=function(e){return Hd(tf(e,void 0,Fp),e+"")},zp=Df(Object.getPrototypeOf,Object),Vp="[object Object]",Gp=Function.prototype,Hp=Object.prototype,Wp=Gp.toString,qp=Hp.hasOwnProperty,Yp=Wp.call(Object);var Xp=function(e){if(!Hh(e)||Gh(e)!=Vp)return!1;var t=zp(e);if(null===t)return!0;var n=qp.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Wp.call(n)==Yp};var Kp=function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var a=Array(i);++r<i;)a[r]=e[r+t];return a};var Qp=function(){this.__data__=new lp,this.size=0};var Zp=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var Jp=function(e){return this.__data__.get(e)};var $p=function(e){return this.__data__.has(e)},ev=200;var tv=function(e,t){var n=this.__data__;if(n instanceof lp){var r=n.__data__;if(!hp||r.length<ev-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new wp(r)}return n.set(e,t),this.size=n.size,this};function nv(e){var t=this.__data__=new lp(e);this.size=t.size}nv.prototype.clear=Qp,nv.prototype.delete=Zp,nv.prototype.get=Jp,nv.prototype.has=$p,nv.prototype.set=tv;var rv=nv;var iv=function(e,t){return e&&$d(t,Lf(t),e)};var av=function(e,t){return e&&$d(t,Uf(t),e)},ov="object"==typeof exports&&exports&&!exports.nodeType&&exports,sv=ov&&"object"==typeof r&&r&&!r.nodeType&&r,uv=sv&&sv.exports===ov?Ch.Buffer:void 0,cv=uv?uv.allocUnsafe:void 0;var lv=function(e,t){if(t)return e.slice();var n=e.length,r=cv?cv(n):new e.constructor(n);return e.copy(r),r};var hv=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,a=[];++n<r;){var o=e[n];t(o,n,e)&&(a[i++]=o)}return a};var dv=function(){return[]},fv=Object.prototype.propertyIsEnumerable,pv=Object.getOwnPropertySymbols,vv=pv?function(e){return null==e?[]:(e=Object(e),hv(pv(e),(function(t){return fv.call(e,t)})))}:dv,mv=vv;var gv=function(e,t){return $d(e,mv(e),t)},yv=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Rp(t,mv(e)),e=zp(e);return t}:dv,bv=yv;var wv=function(e,t){return $d(e,bv(e),t)};var xv=function(e,t,n){var r=t(e);return Xh(e)?r:Rp(r,n(e))};var Ov=function(e){return xv(e,Lf,mv)};var kv=function(e){return xv(e,Uf,bv)},_v=Td(Ch,"DataView"),Sv=Td(Ch,"Promise"),Ev=Td(Ch,"Set"),Av="[object Map]",jv="[object Promise]",Tv="[object Set]",Mv="[object WeakMap]",Cv="[object DataView]",Dv=wd(_v),Iv=wd(hp),Pv=wd(Sv),Rv=wd(Ev),Lv=wd(Md),Nv=Gh;(_v&&Nv(new _v(new ArrayBuffer(1)))!=Cv||hp&&Nv(new hp)!=Av||Sv&&Nv(Sv.resolve())!=jv||Ev&&Nv(new Ev)!=Tv||Md&&Nv(new Md)!=Mv)&&(Nv=function(e){var t=Gh(e),n="[object Object]"==t?e.constructor:void 0,r=n?wd(n):"";if(r)switch(r){case Dv:return Cv;case Iv:return Av;case Pv:return jv;case Rv:return Tv;case Lv:return Mv}return t});var Bv=Nv,Fv=Object.prototype.hasOwnProperty;var Uv=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Fv.call(e,"index")&&(n.index=e.index,n.input=e.input),n},zv=Ch.Uint8Array;var Vv=function(e){var t=new e.constructor(e.byteLength);return new zv(t).set(new zv(e)),t};var Gv=function(e,t){var n=t?Vv(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},Hv=/\w*$/;var Wv=function(e){var t=new e.constructor(e.source,Hv.exec(e));return t.lastIndex=e.lastIndex,t},qv=Dh?Dh.prototype:void 0,Yv=qv?qv.valueOf:void 0;var Xv=function(e){return Yv?Object(Yv.call(e)):{}};var Kv=function(e,t){var n=t?Vv(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)},Qv="[object Boolean]",Zv="[object Date]",Jv="[object Map]",$v="[object Number]",em="[object RegExp]",tm="[object Set]",nm="[object String]",rm="[object Symbol]",im="[object ArrayBuffer]",am="[object DataView]",om="[object Float32Array]",sm="[object Float64Array]",um="[object Int8Array]",cm="[object Int16Array]",lm="[object Int32Array]",hm="[object Uint8Array]",dm="[object Uint8ClampedArray]",fm="[object Uint16Array]",pm="[object Uint32Array]";var vm=function(e,t,n){var r=e.constructor;switch(t){case im:return Vv(e);case Qv:case Zv:return new r(+e);case am:return Gv(e,n);case om:case sm:case um:case cm:case lm:case hm:case dm:case fm:case pm:return Kv(e,n);case Jv:return new r;case $v:case nm:return new r(e);case em:return Wv(e);case tm:return new r;case rm:return Xv(e)}};var mm=function(e){return"function"!=typeof e.constructor||sf(e)?{}:Id(zp(e))},gm="[object Map]";var ym=function(e){return Hh(e)&&Bv(e)==gm},bm=Af&&Af.isMap,wm=bm?kf(bm):ym,xm="[object Set]";var Om=function(e){return Hh(e)&&Bv(e)==xm},km=Af&&Af.isSet,_m=km?kf(km):Om,Sm=1,Em=2,Am=4,jm="[object Arguments]",Tm="[object Function]",Mm="[object GeneratorFunction]",Cm="[object Object]",Dm={};Dm[jm]=Dm["[object Array]"]=Dm["[object ArrayBuffer]"]=Dm["[object DataView]"]=Dm["[object Boolean]"]=Dm["[object Date]"]=Dm["[object Float32Array]"]=Dm["[object Float64Array]"]=Dm["[object Int8Array]"]=Dm["[object Int16Array]"]=Dm["[object Int32Array]"]=Dm["[object Map]"]=Dm["[object Number]"]=Dm[Cm]=Dm["[object RegExp]"]=Dm["[object Set]"]=Dm["[object String]"]=Dm["[object Symbol]"]=Dm["[object Uint8Array]"]=Dm["[object Uint8ClampedArray]"]=Dm["[object Uint16Array]"]=Dm["[object Uint32Array]"]=!0,Dm["[object Error]"]=Dm[Tm]=Dm["[object WeakMap]"]=!1;var Im=function e(t,n,r,i,a,o){var s,u=n&Sm,c=n&Em,l=n&Am;if(r&&(s=a?r(t,i,a,o):r(t)),void 0!==s)return s;if(!rd(t))return t;var h=Xh(t);if(h){if(s=Uv(t),!u)return Rd(t,s)}else{var d=Bv(t),f=d==Tm||d==Mm;if(wf(t))return lv(t,u);if(d==Cm||d==jm||f&&!a){if(s=c||f?{}:mm(t),!u)return c?wv(t,av(s,t)):gv(t,iv(s,t))}else{if(!Dm[d])return a?t:{};s=vm(t,d,u)}}o||(o=new rv);var p=o.get(t);if(p)return p;o.set(t,s),_m(t)?t.forEach((function(i){s.add(e(i,n,r,i,t,o))})):wm(t)&&t.forEach((function(i,a){s.set(a,e(i,n,r,a,t,o))}));var v=h?void 0:(l?c?kv:Ov:c?Uf:Lf)(t);return Wd(v||t,(function(i,a){v&&(i=t[a=i]),Jd(s,a,e(i,n,r,a,t,o))})),s},Pm=1,Rm=4;var Lm=function(e){return Im(e,Pm|Rm)},Nm="__lodash_hash_undefined__";var Bm=function(e){return this.__data__.set(e,Nm),this};var Fm=function(e){return this.__data__.has(e)};function Um(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new wp;++t<n;)this.add(e[t])}Um.prototype.add=Um.prototype.push=Bm,Um.prototype.has=Fm;var zm=Um;var Vm=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1};var Gm=function(e,t){return e.has(t)},Hm=1,Wm=2;var qm=function(e,t,n,r,i,a){var o=n&Hm,s=e.length,u=t.length;if(s!=u&&!(o&&u>s))return!1;var c=a.get(e),l=a.get(t);if(c&&l)return c==t&&l==e;var h=-1,d=!0,f=n&Wm?new zm:void 0;for(a.set(e,t),a.set(t,e);++h<s;){var p=e[h],v=t[h];if(r)var m=o?r(v,p,h,t,e,a):r(p,v,h,e,t,a);if(void 0!==m){if(m)continue;d=!1;break}if(f){if(!Vm(t,(function(e,t){if(!Gm(f,t)&&(p===e||i(p,e,n,r,a)))return f.push(t)}))){d=!1;break}}else if(p!==v&&!i(p,v,n,r,a)){d=!1;break}}return a.delete(e),a.delete(t),d};var Ym=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n};var Xm=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},Km=1,Qm=2,Zm="[object Boolean]",Jm="[object Date]",$m="[object Error]",eg="[object Map]",tg="[object Number]",ng="[object RegExp]",rg="[object Set]",ig="[object String]",ag="[object Symbol]",og="[object ArrayBuffer]",sg="[object DataView]",ug=Dh?Dh.prototype:void 0,cg=ug?ug.valueOf:void 0;var lg=function(e,t,n,r,i,a,o){switch(n){case sg:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case og:return!(e.byteLength!=t.byteLength||!a(new zv(e),new zv(t)));case Zm:case Jm:case tg:return Qd(+e,+t);case $m:return e.name==t.name&&e.message==t.message;case ng:case ig:return e==t+"";case eg:var s=Ym;case rg:var u=r&Km;if(s||(s=Xm),e.size!=t.size&&!u)return!1;var c=o.get(e);if(c)return c==t;r|=Qm,o.set(e,t);var l=qm(s(e),s(t),r,i,a,o);return o.delete(e),l;case ag:if(cg)return cg.call(e)==cg.call(t)}return!1},hg=1,dg=Object.prototype.hasOwnProperty;var fg=function(e,t,n,r,i,a){var o=n&hg,s=Ov(e),u=s.length;if(u!=Ov(t).length&&!o)return!1;for(var c=u;c--;){var l=s[c];if(!(o?l in t:dg.call(t,l)))return!1}var h=a.get(e),d=a.get(t);if(h&&d)return h==t&&d==e;var f=!0;a.set(e,t),a.set(t,e);for(var p=o;++c<u;){var v=e[l=s[c]],m=t[l];if(r)var g=o?r(m,v,l,t,e,a):r(v,m,l,e,t,a);if(!(void 0===g?v===m||i(v,m,n,r,a):g)){f=!1;break}p||(p="constructor"==l)}if(f&&!p){var y=e.constructor,b=t.constructor;y!=b&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b)&&(f=!1)}return a.delete(e),a.delete(t),f},pg=1,vg="[object Arguments]",mg="[object Array]",gg="[object Object]",yg=Object.prototype.hasOwnProperty;var bg=function(e,t,n,r,i,a){var o=Xh(e),s=Xh(t),u=o?mg:Bv(e),c=s?mg:Bv(t),l=(u=u==vg?gg:u)==gg,h=(c=c==vg?gg:c)==gg,d=u==c;if(d&&wf(e)){if(!wf(t))return!1;o=!0,l=!1}if(d&&!l)return a||(a=new rv),o||Tf(e)?qm(e,t,n,r,i,a):lg(e,t,u,n,r,i,a);if(!(n&pg)){var f=l&&yg.call(e,"__wrapped__"),p=h&&yg.call(t,"__wrapped__");if(f||p){var v=f?e.value():e,m=p?t.value():t;return a||(a=new rv),i(v,m,n,r,a)}}return!!d&&(a||(a=new rv),fg(e,t,n,r,i,a))};var wg=function e(t,n,r,i,a){return t===n||(null==t||null==n||!Hh(t)&&!Hh(n)?t!==t&&n!==n:bg(t,n,r,i,e,a))};var xg=function(e,t){return null!=e&&t in Object(e)};var Og=function(e,t,n){for(var r=-1,i=(t=Cp(t,e)).length,a=!1;++r<i;){var o=Ip(t[r]);if(!(a=null!=e&&n(e,o)))break;e=e[o]}return a||++r!=i?a:!!(i=null==e?0:e.length)&&rf(i)&&Xd(o,i)&&(Xh(e)||vf(e))};var kg=function(e,t){return null!=e&&Og(e,t,xg)},_g=function(){return Ch.Date.now()},Sg="Expected a function",Eg=Math.max,Ag=Math.min;var jg=function(e,t,n){var r,i,a,o,s,u,c=0,l=!1,h=!1,d=!0;if("function"!=typeof e)throw new TypeError(Sg);function f(t){var n=r,a=i;return r=i=void 0,c=t,o=e.apply(a,n)}function p(e){var n=e-u;return void 0===u||n>=t||n<0||h&&e-c>=a}function v(){var e=_g();if(p(e))return m(e);s=setTimeout(v,function(e){var n=t-(e-u);return h?Ag(n,a-(e-c)):n}(e))}function m(e){return s=void 0,d&&r?f(e):(r=i=void 0,o)}function g(){var e=_g(),n=p(e);if(r=arguments,i=this,u=e,n){if(void 0===s)return function(e){return c=e,s=setTimeout(v,t),l?f(e):o}(u);if(h)return clearTimeout(s),s=setTimeout(v,t),f(u)}return void 0===s&&(s=setTimeout(v,t)),o}return t=cd(t)||0,rd(n)&&(l=!!n.leading,a=(h="maxWait"in n)?Eg(cd(n.maxWait)||0,t):a,d="trailing"in n?!!n.trailing:d),g.cancel=function(){void 0!==s&&clearTimeout(s),c=0,r=u=i=s=void 0},g.flush=function(){return void 0===s?o:m(_g())},g};var Tg=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0};var Mg=function(e,t){return t.length<2?e:Pp(e,Kp(t,0,-1))};var Cg=function(e,t){return wg(e,t)};var Dg=function(e,t){return t=Cp(t,e),null==(e=Mg(e,t))||delete e[Ip(Tg(t))]};var Ig=function(e){return Xp(e)?void 0:e},Pg=Up((function(e,t){var n={};if(null==e)return n;var r=!1;t=Yh(t,(function(t){return t=Cp(t,e),r||(r=t.length>1),t})),$d(e,kv(e),n),r&&(n=Im(n,7,Ig));for(var i=t.length;i--;)Dg(n,t[i]);return n})),Rg=Pg;var Lg=function(e,t,n,r){if(!rd(e))return e;for(var i=-1,a=(t=Cp(t,e)).length,o=a-1,s=e;null!=s&&++i<a;){var u=Ip(t[i]),c=n;if("__proto__"===u||"constructor"===u||"prototype"===u)return e;if(i!=o){var l=s[u];void 0===(c=r?r(l,u,s):void 0)&&(c=rd(l)?l:Xd(t[i+1])?[]:{})}Jd(s,u,c),s=s[u]}return e};var Ng=function(e,t,n){for(var r=-1,i=t.length,a={};++r<i;){var o=t[r],s=Pp(e,o);n(s,o)&&Lg(a,Cp(o,e),s)}return a};var Bg,Fg=function(e,t){return Ng(e,t,(function(t,n){return kg(e,n)}))},Ug=Up((function(e,t){return null==e?{}:Fg(e,t)})),zg=Ug,Vg=new Promise((function(e){Bg=e})),Gg=!1;function Hg(){return Wg.apply(this,arguments)}function Wg(){return Wg=Object(m.a)(Object(S.a)().mark((function e(){var t;return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Gg){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,n.e(5).then(n.bind(null,82));case 4:return t=e.sent,e.next=7,t.init();case 7:Bg(t),Gg=!0;case 9:case"end":return e.stop()}}),e)}))),Wg.apply(this,arguments)}var qg=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,[{key:"modifyById",value:function(t,n){if(void 0===this[t])throw new Error("not expected");var r=Object(p.a)(Object(p.a)({},this),{},Object(_.a)({},t,n));return Object.setPrototypeOf(r,e.prototype),r}},{key:"add",value:function(e,t){var n,r;return null!==(n=null===(r=this.runOp({type:1,id:e,data:t}))||void 0===r?void 0:r.data)&&void 0!==n?n:this}},{key:"runOp",value:function(t){var n=this;if(1===t.type){var r,i=n[t.id];r=void 0===i?{type:2,id:t.id}:{type:1,id:t.id,data:i};var a=t.id,o=t.data,s=Object(p.a)(Object(p.a)({},n),{},Object(_.a)({},a,o));return Object.setPrototypeOf(s,e.prototype),{data:s,actual:t,reverse:r}}if(2===t.type){var u=t.id,c=n[u];if(void 0===c)return null;var l=Object(p.a)({},n);return Object.setPrototypeOf(l,e.prototype),delete l[u],{data:l,actual:t,reverse:{type:1,id:u,data:c}}}return null}}]),e}();function Yg(e){if(void 0===e.deepFreeze){var t,n=Object.getOwnPropertyNames(e),r=Object(j.a)(n);try{for(r.s();!(t=r.n()).done;){var i=e[t.value];i&&"object"==typeof i&&Yg(i)}}catch(a){r.e(a)}finally{r.f()}return Object.freeze(e)}e.deepFreeze(e)}var Xg=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n)}(Object(f.a)(Error));function Kg(e){var t=Object(p.a)({},e);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function Qg(e,t,n){if(void 0===e?void 0===t?(e=0,t=10):e=t-10:void 0===t&&(t=e+10),e>t){var r=e;e=t,t=r}for(var i=[],a=1/(n+1),o=0;o<n;o++){var s=e+(t-e)*(o+.75+.5*Math.random())*a;i.push(s)}return i}function Zg(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function Jg(e,t){var n,r=Object(j.a)(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;!0!==t(i.id,i.data)&&Jg(i.children,t)}}catch(a){r.e(a)}finally{r.f()}}function $g(e,t){if(!0!==t(e.id,e.data)){var n,r=Object(j.a)(e.children);try{for(r.s();!(n=r.n()).done;){$g(n.value,t)}}catch(i){r.e(i)}finally{r.f()}}}var ey,ty=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;Object(E.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Object.setPrototypeOf(Object(x.a)(e),n.prototype),e}return Object(A.a)(n,[{key:"deepFreeze",value:function(){for(var e=0;e<this.length;)Yg(this[e]),e++}},{key:"fillCaches0",value:function(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);var n,r=Object(j.a)(e.children);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.fillCaches0(i,e.id)}}catch(a){r.e(a)}finally{r.f()}}},{key:"fillCaches",value:function(){if(void 0===this.objCaches){this.objCaches=new Map,this.parentCaches=new Map;var e,t=Object(j.a)(this);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.fillCaches0(n,null)}}catch(r){t.e(r)}finally{t.f()}}}},{key:"randomId",value:function(){this.fillCaches();var e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}},{key:"nonExistOrDescendantOf",value:function(e,t){if(!this.has(e))return!0;for(;e;){var n=this.parent(e);if(n===t)return!0;e=n}return!1}},{key:"isDescendantOf",value:function(e,t){for(;e;){var n=this.parent(e);if(n===t)return!0;e=n}return!1}},{key:"data",value:function(e){var t;return null===(t=this.get(e))||void 0===t?void 0:t.data}},{key:"has",value:function(e){return void 0!==this.childrenOf(e)}},{key:"get",value:function(e){return this.fillCaches(),this.objCaches.get(e)}},{key:"childrenOf",value:function(e){var t;return null===e?this:null===(t=this.get(e))||void 0===t?void 0:t.children}},{key:"traverseFrom",value:function(e,t){if(null===e)this.traverse(t);else{var n=this.get(e);n&&$g(n,t)}}},{key:"traverse",value:function(e){Jg(this,e)}},{key:"totalSize",value:function(){return this.fillCaches(),this.objCaches.size}},{key:"parent",value:function(e){return this.fillCaches(),this.parentCaches.get(e)}},{key:"childrenArray",value:function(e){return null===e?this:this.get(e).children}},{key:"modifyById",value:function(e,t){if(void 0===this.get(e))throw new Error("not expected");var n=this.parent(e),r=this.childrenArray(n),i=r.findIndex((function(t){return t.id===e}));if(i<0)throw new Error("not expected");var a=r[i];return(r=Object(v.a)(r))[i]=Object(p.a)(Object(p.a)({},a),{},{data:t}),this.modifyArrayBy(n,r)}},{key:"modifyArrayBy",value:function(e,t){for(var r=this,i=e,a=t,o=function(){var e=a,t=i;if(void 0===(i=r.parent(i)))throw new Error;var n=(a=r.childrenArray(i)).findIndex((function(e){return e.id===t}));if(n<0)throw new Error;(a=Object(v.a)(a))[n]=Object(p.a)(Object(p.a)({},a[n]),{},{children:e})};null!==i;)o();Object.setPrototypeOf(a,n.prototype);var s=a;return s.fillCaches(),s}},{key:"runOp",value:function(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}},{key:"checkDuplicatedIdRec",value:function(e){var t=e.id,n=e.children;if(void 0!==this.get(t))return!0;var r,i=Object(j.a)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(this.checkDuplicatedIdRec(a))return!0}}catch(o){i.e(o)}finally{i.f()}return!1}},{key:"addOp",value:function(e){var t=e.parent,n=e.fi,r=e.id,i=e.data,a=e.children;if(null!==t&&void 0===this.get(t))return null;if(this.checkDuplicatedIdRec(e))return null;var o=t,s=this.childrenArray(o),u={fi:n,id:r,data:i,children:a};return(s=[].concat(Object(v.a)(s),[u])).sort((function(e,t){return e.fi-t.fi})),e.localIndex=s.indexOf(u),{data:this.modifyArrayBy(o,s),actual:e,reverse:{type:8,id:r}}}},{key:"deleteOp",value:function(e){var t=e.id;if(null===this.get(t))return null;var n=this.parent(t);if(void 0===n)return null;var r=this.childrenArray(n),i=r.findIndex((function(e){return e.id===t}));e.localIndex=i;var a=(r=Object(v.a)(r)).splice(i,1)[0];return{data:this.modifyArrayBy(n,r),actual:e,reverse:Object(p.a)(Object(p.a)({type:7},a),{},{parent:n})}}},{key:"moveOp",value:function(e){var t=e.parent,n=e.fi,r=e.id;if(null!==t&&void 0===this.get(t))return this.deleteOp({type:8,id:r});if(null!==t)for(var i=t;null!==i;){if(void 0===i)throw new Error;if(i===r)throw new Xg("cyclic tree");i=this.parent(i)}var a=this.parent(r);if(void 0===a)return null;var o=a,s=this.childrenArray(a),u=s.findIndex((function(e){return e.id===r})),c=(s=Object(v.a)(s)).splice(u,1)[0],l=this.modifyArrayBy(a,s);a=t,s=l.childrenArray(a);var h=c.fi;return c=Object(p.a)(Object(p.a)({},c),{},{fi:n}),(s=[].concat(Object(v.a)(s),[c])).sort((function(e,t){return e.fi-t.fi})),e.localIndex=s.indexOf(c),{data:l=l.modifyArrayBy(a,s),actual:e,reverse:{type:9,parent:o,fi:h,id:r}}}},{key:"previous",value:function(e,t){if(null===t){var n=this.childrenArray(e);return 0===n.length?null:n[n.length-1].id}var r,i=null,a=Object(j.a)(this.childrenArray(e));try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.id===t)return i;i=o.id}}catch(s){a.e(s)}finally{a.f()}return null}},{key:"traverseSortNext",value:function(e){var t=this.parent(e);if(void 0!==t){var n=this.childrenArray(t),r=n.findIndex((function(t){return t.id===e}))+1;if(r<n.length)return n[r].id;if(t)return this.traverseSortNext(t)}}},{key:"sortNext",value:function(e){var t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}},{key:"traverseSortPrevious",value:function(e){var t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}},{key:"sortPrevious",value:function(e){var t=this.parent(e);if(void 0!==t){var n=this.childrenArray(t),r=n.findIndex((function(t){return t.id===e}))-1;return r>=0?this.traverseSortPrevious(n[r].id):t}}},{key:"getAllSorted",value:function(e){var t,n=[],r=Object(j.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=this.getWithSortKey(i.id);void 0!==a&&n.push(Object(p.a)(Object(p.a)({},i),a))}}catch(u){r.e(u)}finally{r.f()}n.sort((function(e,t){return function(e,t){for(var n=0;n<e.length&&n<t.length;){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1;n+=1}return n!==t.length?-1:n!==e.length?1:0}(e.sortKey,t.sortKey)}));for(var o=0,s=n;o<s.length;o++){delete s[o].sortKey}return n}},{key:"getWithSortKey",value:function(e){var t=e,n=[],r=this.get(t),i=r;if(void 0!==r){for(;t;)n.splice(0,0,r.fi),null!==(t=this.parent(t))&&(r=this.get(t));return Object(p.a)(Object(p.a)({},i),{},{sortKey:n})}}},{key:"insertBeforeHelper",value:function(e,t,n){return this.insertAfterHelper(e,this.previous(e,t),n)}},{key:"insertAfterHelper",value:function(e,t,n){var r=this.childrenArray(e);if(null===t){if(0===r.length)return Qg(0,n,n);var i=r[0].fi;return Qg(i-n,i,n)}var a=this.get(t);if(void 0===a||this.parent(t)!==e)throw new Error("illegal args");var o=r.find((function(e){return e.fi>a.fi}));if(void 0===o){var s=r[r.length-1].fi;return Qg(s,s+n,n)}return Qg(a.fi,o.fi,n)}}]),n}(Object(f.a)(Array));(ey||(ey={})).runOp=function(e,t){if(0!==t.type)return null;if(Array.isArray(e)){var n=t.props,r={},i=Object(v.a)(e),a=!1;if(n)for(var o=0,s=Object.keys(n);o<s.length;o++){var u=s[o],c=parseInt(u);if(isNaN(c))throw new Error("wrong index");r[u]=i[c],i[c]=n[u],a=!0}return a?{data:i,actual:t,reverse:{type:0,props:r}}:null}var l=t.props,h={},d=Object(p.a)({},e),f=!1;if(l)for(var m=0,g=Object.keys(l);m<g.length;m++){var y=g[m];h[y]=d[y];var b=l[y];void 0===b?delete d[y]:d[y]=b,f=!0}return f?{data:d,actual:t,reverse:{type:0,props:h}}:null};var ny=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;Object(E.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Object.setPrototypeOf(Object(x.a)(e),n.prototype),e}return Object(A.a)(n,[{key:"deepFreeze",value:function(){for(var e=0;e<this.length;)Yg(this[e]),e++}},{key:"fillCaches0",value:function(e){this.objCaches.set(e.id,e)}},{key:"fillCaches",value:function(){if(void 0===this.objCaches){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;var e,t=Object(j.a)(this);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.fillCaches0(n)}}catch(r){t.e(r)}finally{t.f()}}}},{key:"randomId",value:function(){this.fillCaches();var e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}},{key:"data",value:function(e){var t;return null===(t=this.get(e))||void 0===t?void 0:t.data}},{key:"get",value:function(e){return this.fillCaches(),this.objCaches.get(e)}},{key:"modifyById",value:function(e,t){if(void 0===this.get(e))throw new Error("not expected");var n=this,r=n.findIndex((function(t){return t.id===e}));if(r<0)throw new Error("not expected");var i=n[r];return(n=Object(v.a)(n))[r]=Object(p.a)(Object(p.a)({},i),{},{data:t}),this.modifyArrayBy(n)}},{key:"modifyArrayBy",value:function(e){Object.setPrototypeOf(e,n.prototype);var t=e;return typeof i<"u"||t.fillCaches(),t}},{key:"runOp",value:function(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}},{key:"addOp",value:function(e){var t=e.fi,n=e.id,r=this,i={fi:t,id:n,data:e.data};return(r=[].concat(Object(v.a)(r),[i])).sort((function(e,t){return e.fi-t.fi})),e.localIndex=r.indexOf(i),{data:this.modifyArrayBy(r),actual:e,reverse:{type:5,id:n}}}},{key:"deleteOp",value:function(e){var t=e.id,n=this,r=n.findIndex((function(e){return e.id===t}));if(-1===r)return null;e.localIndex=r;var i=(n=Object(v.a)(n)).splice(r,1)[0];return{data:this.modifyArrayBy(n),actual:e,reverse:Object(p.a)({type:4},i)}}},{key:"moveOp",value:function(e){var t=e.fi,n=e.id,r=this,i=(r=Object(v.a)(r)).findIndex((function(e){return e.id===n}));if(-1===i)return null;var a=r[i].fi,o=Object(p.a)(Object(p.a)({},r[i]),{},{fi:t});return r[i]=o,r.sort((function(e,t){return e.fi-t.fi})),e.localIndex=r.indexOf(o),{data:this.modifyArrayBy(r),actual:e,reverse:{type:6,fi:a,id:n}}}},{key:"previous",value:function(e){if(null===e)return 0===this.length?null:this[this.length-1].id;var t,n=null,r=Object(j.a)(this);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.id===e)return n;n=i.id}}catch(a){r.e(a)}finally{r.f()}return null}},{key:"insertBeforeHelper",value:function(e,t){return this.insertAfterHelper(this.previous(e),t)}},{key:"insertAfterHelper",value:function(e,t){var n=this;if(null===e){if(0===n.length)return Qg(0,t,t);var r=n[0].fi;return Qg(r-t,r,t)}var i=this.get(e);if(void 0===i)throw new Error("illegal args");var a=n.find((function(e){return e.fi>i.fi}));if(void 0===a){var o=n[n.length-1].fi;return Qg(o,o+t,t)}return Qg(i.fi,a.fi,t)}}]),n}(Object(f.a)(Array));function ry(e){return e&&"object"==typeof e&&e instanceof cy}var iy,ay,oy,sy,uy,cy=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,[{key:"unusedFunOverridesTable",value:function(e){}},{key:"runOp",value:function(t){for(var n=[],r=this,i=0,a={};i<t.path.length;){if(n.push(r),void 0!==(r=void 0===r?void 0:r[t.path[i]])&&!ry(r))return null;i+=1}r=r?Kg(r):new e;for(var o=0,s=Object.entries(t.props);o<s.length;o++){var u=Object(g.a)(s[o],2),c=u[0],l=u[1],h=r[c];a[c]=h,void 0===l?delete r[c]:r[c]=l}for(;i>0;){if(0===Object.keys(r).length){var d=n[i-1];d&&delete(r=Kg(d))[t.path[i-1]]}else{var f=n[i-1];if(f){var v=Kg(f);v[t.path[i-1]]=r,r=v}else{var m=new e;m[t.path[i-1]]=r,r=m}}i-=1}return{data:Object.setPrototypeOf(r,e.prototype),actual:t,reverse:Object(p.a)(Object(p.a)({},t),{},{props:a})}}}]),e}();function ly(e,t){if(void 0!==t){var n=!1,r=e.map((function(e){var r=e.id,i=hy(e.data,t[r]);if(n=n||void 0!==i,void 0===i&&(i=e.data),e.children){var a=ly(e.children,t);return void 0!==a?n=!0:a=e.children,Object(p.a)(Object(p.a)({},e),{},{id:r,data:i,children:a})}return Object(p.a)(Object(p.a)({},e),{},{id:r,data:i})}));return n?r:void 0}}function hy(e,t){if(!ry(t))return t;if(e instanceof ty){var n=ly(e,t);return void 0!==n&&Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}if(e instanceof ny)return function(e,t){if(void 0!==t){var n=!1,r=e.map((function(e){var r=e.id,i=hy(e.data,t[r]);return n=n||void 0!==i,void 0===i&&(i=e.data),Object(p.a)(Object(p.a)({},e),{},{id:r,data:i})}));return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}}(e,t);if(Array.isArray(e)){var r=!1,i=e.map((function(e,n){var i=hy(e,t[n]);return r=r||void 0!==i,void 0===i&&(i=e),i}));return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}if(e instanceof cy)return dy(e,t);if(e&&"object"==typeof e){for(var a={},o=!1,s=0,u=Object.entries(e);s<u.length;s++){var c=Object(g.a)(u[s],2),l=c[0],h=c[1],d=hy(h,t[l]);o=o||void 0!==d,void 0===d&&(d=h),a[l]=d}return o?(Object.setPrototypeOf(a,Object.getPrototypeOf(e)),a):void 0}}function dy(e,t){if(void 0===e)return t;if(void 0===t)return e;if(!ry(t))return t;if(!ry(e))return iy.apply(e,t);for(var n=new Set,r=0,i=Object.keys(e);r<i.length;r++){var a=i[r];n.add(a)}for(var o=0,s=Object.keys(t);o<s.length;o++){var u=s[o];n.add(u)}var c,l=new cy,h=Object(j.a)(n);try{for(h.s();!(c=h.n()).done;){var d=c.value,f=dy(void 0===e?void 0:e[d],void 0===t?void 0:t[d]);l[d]=f}}catch(p){h.e(p)}finally{h.f()}return l}function fy(e,t){var n,r={cur:[],result:[],len:0};return[e=null!==(n=gy(e,t,r))&&void 0!==n?n:e,r.result]}function py(e,t){return null===e?null:(e.cur[e.len]=t,e.len+=1,e)}function vy(e){e&&(e.len-=1)}function my(e,t,n){var r=!1,i=e.map((function(e){var i=e.id,a=t[i];if(void 0!==a&&"string"==typeof a&&(r=!0,i=a,null!==n))throw new Error("not supported");var o=gy(e.data,t,py(n,i));vy(n),r=r||void 0!==o,void 0===o&&(o=e.data);var s=my(e.children,t,n);return void 0!==s?r=!0:s=e.children,Object(p.a)(Object(p.a)({},e),{},{id:i,data:o,children:s})}));if(r)return i}function gy(e,t,n){if(e instanceof ty){var r=my(e,t,n);return void 0!==r&&Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}if(e instanceof ny)return function(e,t,n){var r=!1,i=e.map((function(e){var i=e.id,a=t[i];if(void 0!==a&&"string"==typeof a&&(r=!0,i=a,null!==n))throw new Error("not supported");var o=gy(e.data,t,py(n,i));return vy(n),r=r||void 0!==o,void 0===o&&(o=e.data),Object(p.a)(Object(p.a)({},e),{},{id:i,data:o})}));if(r)return Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}(e,t,n);if(Array.isArray(e)){var i=!1,a=e.map((function(e,r){var a=gy(e,t,py(n,r));return vy(n),i=i||void 0!==a,void 0===a&&(a=e),a}));return i?(Object.setPrototypeOf(a,Object.getPrototypeOf(e)),a):void 0}if(e&&"object"==typeof e&&!Zg(e)){for(var o={},s=!1,u=0,c=Object.entries(e);u<c.length;u++){var l=Object(g.a)(c[u],2),h=l[0],d=l[1];if("name"!==h&&"text"!==h){var f=t[h];if("string"==typeof f){if(null!==n)throw new Error("not supported");s=!0,h=f}var v=gy(d,t,py(n,h));vy(n),s=s||void 0!==v,void 0===v&&(v=d),o[h]=v}else o[h]=d}return s?(Object.setPrototypeOf(o,Object.getPrototypeOf(e)),o):void 0}if("string"==typeof e){var m=t[e];if(void 0!==m){if(36!==e.length)throw new Error("for now you should only call this method when the key is a uuid");!function(e){if(null===e)return null;e.result.push(e.cur.slice(0,e.len))}(n)}return m}}(ay=iy||(iy={})).apply=function(e,t){var n;return null!==(n=hy(e,t))&&void 0!==n?n:e},ay.merge=function(e,t){return dy(e,t)},ay.filterOp=function(e,t){for(var n=0,r=t.path,i=e;n<r.length&&void 0!==i;){if(void 0===(i=My.zoomOnce(i,r[n])))return t;if(!ry(i))return;n+=1}if(void 0===i)return t;if(ry(i)){if(0===t.type){for(var a=Object(p.a)({},t.props),o=0,s=Object.keys(i);o<s.length;o++)delete a[s[o]];return Object(p.a)(Object(p.a)({},t),{},{props:a})}if(1===t.type||4===t.type||7===t.type){var u=ly([t],i);return u?(console.log(u),u):t}return t}},function(e){e.replaceProps=function(e,t){var n=My.zoom(t,e.path);if("object"==typeof n){for(var r={},i=0,a=Object.keys(e.props);i<a.length;i++){var o=a[i];r[o]=n[o]}return Object(p.a)(Object(p.a)({},e),{},{props:r})}return Object(p.a)(Object(p.a)({},e),{},{props:{}})}}(oy||(oy={})),function(e){function t(e,t){for(var n=t.path,r=[];;){var i=void 0;if(e instanceof cy&&0===t.type&&(null===(i=e.runOp(Object(p.a)(Object(p.a)({},t),{},{path:n.slice(r.length)})))&&(i=void 0)),r.length===n.length&&(i=e instanceof ty||e instanceof ny||e instanceof qg?e.runOp(t):ey.runOp(e,t)),void 0!==i){if(null!==i){for(var a=i.data,o=r.length-1;o>=0;o--){var s=n[o],u=r[o];if(u instanceof ty){if("number"==typeof s)throw new Error("illegal arg");a=u.modifyById(s,a)}else if(u instanceof ny){if("number"==typeof s)throw new Error("illegal arg");a=u.modifyById(s,a)}else if(u instanceof qg){if("number"==typeof s)throw new Error("illegal arg");a=u.modifyById(s,a)}else if(u instanceof cy){var c=Object(p.a)(Object(p.a)({},u),{},Object(_.a)({},s,a));a=Object.setPrototypeOf(c,cy.prototype)}else{if("object"!=typeof u)return null;if(Array.isArray(u)){if("string"==typeof s&&(s=parseInt(s),isNaN(s)))throw new Error("Invalid path");var l=a;(a=Object(v.a)(u))[s]=l}else a=Object(p.a)(Object(p.a)({},u),{},Object(_.a)({},s,a))}}return{data:a,actual:Object(p.a)(Object(p.a)({},i.actual),{},{path:n}),reverse:Object(p.a)(Object(p.a)({},i.reverse),{},{path:n})}}return null}var h=n[r.length],d=void 0;if(e instanceof ty){var f;if("number"==typeof h)throw new Error("");d=null===(f=e.get(h))||void 0===f?void 0:f.data}else if(e instanceof ny){var m;if("number"==typeof h)throw new Error("");d=null===(m=e.get(h))||void 0===m?void 0:m.data}else null!==e&&(d=e[h]);if(void 0===d)return null;r.push(e),e=d}}function n(e,t){for(var n=0;n<e.length&&n<t.length;n++)if(e[n]!==t[n])return!0;return!1}function r(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}e.drop=function(e,t){return Object(p.a)(Object(p.a)({},e),{},{path:e.path.slice(t)})},e.applySimple=function(e,n){var r,i;return null!==(r=null===(i=t(e,n))||void 0===i?void 0:i.data)&&void 0!==r?r:e},e.apply=t,e.pathDisjoint=n,e.pathEq=r,e.commutative=function(e,t){return n(e.path,t.path)},e.subsumed=function(e,t){return!(0!==e.type||0!==t.type||!r(e.path,t.path))&&Object.keys(e.props).every((function(e){return void 0!==t.props[e]}))}}(sy||(sy={})),function(e){function t(e,t){var n,r=e,i=[],a=[],o=Object(j.a)(t);try{for(o.s();!(n=o.n()).done;){var s=n.value;try{if(3===s.type){var u=My.zoom(r,[].concat(Object(v.a)(s.path),[s.id])),c=sy.apply(r,Object(p.a)(Object(p.a)({},s),{},{type:2}));if(null!==c){var l=fy(r=c.data,Object(_.a)({},s.id,u)),h=Object(g.a)(l,2),d=h[0],f=h[1];r=d;var m,y=Object(j.a)(f);try{for(y.s();!(m=y.n()).done;){var b=m.value,w=b[b.length-1];b.splice(b.length-1,1),i.push({type:0,path:b,props:Object(_.a)({},w,u)}),a.push({type:0,path:b,props:Object(_.a)({},w,s.id)})}}catch(O){y.e(O)}finally{y.f()}a.push(c.reverse),i.push(c.actual)}}else{var x=sy.apply(r,s);null!==x&&(i.push(x.actual),r=x.data,a.push(x.reverse))}}catch(u){if(u instanceof Xg)return null;throw u}}}catch(O){o.e(O)}finally{o.f()}return{data:r,actual:i,reverse:a.reverse()}}e.empty=function(){return[]},e.removePrefix=function(e,t){var n,r=[],i=Object(j.a)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=Object(d.a)(a.path),s=o[0],u=o.slice(1);s===t&&r.push(Object(p.a)(Object(p.a)({},a),{},{path:u}))}}catch(c){i.e(c)}finally{i.f()}return r},e.addPrefix=function(e,t){return e.map((function(e){return Object(p.a)(Object(p.a)({},e),{},{path:[t].concat(Object(v.a)(e.path))})}))},e.concat=function(e,t){return[].concat(Object(v.a)(e),Object(v.a)(t))},e.compress=function(e,t){return[].concat(Object(v.a)(e.filter((function(e){return!t.some((function(t){return sy.subsumed(e,t)}))}))),Object(v.a)(t))},e.commutative=function(e,t){return e.every((function(e){return t.every((function(t){return sy.commutative(e,t)}))}))},e.applyAll=function(e,n){var r,i=Object(j.a)(n);try{for(i.s();!(r=i.n()).done;){var a=t(e,r.value);null!==a&&(e=a.data)}}catch(o){i.e(o)}finally{i.f()}return e},e.apply=t}(uy||(uy={}));var yy=Symbol(),by=Symbol(),wy=Symbol(),xy=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,[{key:"reportOp",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=this;if(null!==t){r._current=t.data;for(var i=n;!(r instanceof Cy);){var a=r._path,o=r._current;if(""!==a&&i.splice(0,0,a),null===(r=r._parent))return;r.update(a,o)}r.push(i,e,t.actual,t.reverse)}}},{key:"deleteChildren",value:function(e){if(this._children){var t=this._children[e];if(t){var n=t[wy];n&&n(),delete this._children[e]}}}}]),e}(),Oy=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;return Object(E.a)(this,n),(a=t.call(this))._parent=e,a._path=r,a._current=i,a}return Object(A.a)(n,[{key:"update",value:function(e,t){if(Array.isArray(this._current)){if("string"==typeof e&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=Object(v.a)(this._current),this._current[e]=t}else this._current=Object(p.a)(Object(p.a)({},this._current),{},Object(_.a)({},e,t))}},{key:"runOp",value:function(e){this.reportOp(e,ey.runOp(this._current,e),e.path)}}]),n}(xy),ky=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;return Object(E.a)(this,n),(a=t.call(this))._parent=e,a._path=r,a._current=i,a}return Object(A.a)(n,[{key:"update",value:function(e,t){this._current=Object(p.a)(Object(p.a)({},this._current),{},Object(_.a)({},e,t)),Object.setPrototypeOf(this._current,qg.prototype)}},{key:"runOp",value:function(e){this.reportOp(e,this._current.runOp(e))}}]),n}(xy),_y={get:function(e,t){if(t===wy)return function(){e._parent=null};if(t===yy)return e._current;if(t===by)return e;var n=e._current,r=e._children;if("push"===t&&Array.isArray(n))throw new Error("not supported to expand array");var i=void 0===r?void 0:r[t];if(void 0!==i)return i;var a=n[t],o=Dy(e,t,a);return o!==a?(void 0===r&&(r={},e._children=r),r[t]=o,o):a},has:function(e,t){return t in e._current},ownKeys:function(e){return Reflect.ownKeys(e._current)},defineProperty:function(){throw Error("not supported")},getPrototypeOf:function(e){return Object.getPrototypeOf(e._current)},setPrototypeOf:function(){throw Error("not supported")},getOwnPropertyDescriptor:function(e,t){var n=e._current,r=Reflect.getOwnPropertyDescriptor(n,t);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:n[t]}}},Sy=Object(p.a)(Object(p.a)({},_y),{},{set:function(e,t,n){var r,i={type:0,props:Object(_.a)({},t,null!==(r=Ry(n))&&void 0!==r?r:n)};return e.deleteChildren(t),e.runOp(i),!0},deleteProperty:function(e,t){var n={type:0,props:Object(_.a)({},t,void 0)};return e.deleteChildren(t),e.runOp(n),!0}}),Ey=Object(p.a)(Object(p.a)({},_y),{},{set:function(e,t,n){return void 0===n?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:n})),!0},deleteProperty:function(e,t){return e.runOp({type:2,id:t}),!0}}),Ay=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;return Object(E.a)(this,n),(a=t.call(this))._children={},a._parent=e,a._path=r,a._current=i,a[wy]=function(){a._parent=null},a}return Object(A.a)(n,[{key:"unproxy",value:function(){return this._current}},{key:"update",value:function(e,t){this._current=this._current.modifyById(e,t)}},{key:"runOp",value:function(e){this.reportOp(e,this._current.runOp(e))}},{key:"randomId",value:function(){return this._current.randomId()}},{key:"isDescendantOf",value:function(e,t){return this._current.isDescendantOf(e,t)}},{key:"childrenOf",value:function(e){return this._current.childrenOf(e)}},{key:"traverse",value:function(e){var t=this;this._current.traverse((function(n,r){e(n,t.data(n))}))}},{key:"get",value:function(e){return this._current.get(e)}},{key:"parent",value:function(e){return this._current.parent(e)}},{key:"data",value:function(e){var t,n=this._current,r=this._children,i=void 0===r?void 0:r[e];if(void 0!==i)return i;var a=null===(t=n.get(e))||void 0===t?void 0:t.data,o=Dy(this,e,a);return o!==a?(void 0===r&&(r={},this._children=r),r[e]=o,o):a}},{key:"add",value:function(e,t,n,r,i){this.runOp({type:7,parent:e,fi:t,id:n,data:r,children:i})}},{key:"move",value:function(e,t,n){this.runOp({type:9,parent:e,fi:t,id:n})}},{key:"insertAfter",value:function(e,t,n){for(var r=this._current.insertAfterHelper(e,t,n.length),i=0;i<n.length;i++){var a=n[i];this.add(e,r[i],a.id,a.data,a.children)}}},{key:"insertBefore",value:function(e,t,n){for(var r=this._current.insertBeforeHelper(e,t,n.length),i=0;i<n.length;i++){var a=n[i];this.add(e,r[i],a.id,a.data,a.children)}}},{key:"moveAfter",value:function(e,t,n){for(var r=this._current.insertAfterHelper(e,t,n.length),i=0;i<n.length;i++){var a=n[i];this.move(e,r[i],a)}}},{key:"moveBefore",value:function(e,t,n){for(var r=this._current.insertBeforeHelper(e,t,n.length),i=0;i<n.length;i++){var a=n[i];this.move(e,r[i],a)}}},{key:"delete",value:function(e){this.deleteChildren(e),this.runOp({type:8,id:e})}},{key:"sortNext",value:function(e){return this._current.sortNext(e)}},{key:"sortPrevious",value:function(e){return this._current.sortPrevious(e)}},{key:"getAllSorted",value:function(e){return this._current.getAllSorted(e)}}]),n}(xy),jy=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;return Object(E.a)(this,n),(a=t.call(this))._children={},a._parent=e,a._path=r,a._current=i,a[wy]=function(){a._parent=null},a}return Object(A.a)(n,[{key:"unproxy",value:function(){return this._current}},{key:"length",get:function(){return this._current.length}},{key:"forEach",value:function(e){for(var t=this.length,n=0;n<t;n++){var r=this._current[n].id,i=this._current[n].fi;e(this.data(this._current[n].id),r,i)}}},{key:"find",value:function(e){for(var t=this.length,n=0;n<t;n++){var r=this._current[n].id;if(e(this.data(r),r))return this.get(r)}}},{key:"update",value:function(e,t){this._current=this._current.modifyById(e,t)}},{key:"randomId",value:function(){return this._current.randomId()}},{key:"get",value:function(e){return Object(p.a)(Object(p.a)({},this._current.get(e)),{},{data:this.data(e)})}},{key:"data",value:function(e){var t,n=this._current,r=this._children,i=void 0===r?void 0:r[e];if(void 0!==i)return i;var a=null===(t=n.get(e))||void 0===t?void 0:t.data,o=Dy(this,e,a);return o!==a?(void 0===r&&(r={},this._children=r),r[e]=o,o):a}},{key:"runOp",value:function(e){this.reportOp(e,this._current.runOp(e))}},{key:"add",value:function(e,t,n){this.runOp({type:4,fi:e,id:t,data:n})}},{key:"move",value:function(e,t){this.runOp({type:6,fi:e,id:t})}},{key:"insertAfter",value:function(e,t){for(var n=this._current.insertAfterHelper(e,t.length),r=0;r<t.length;r++){var i=t[r];this.add(n[r],i.id,i.data)}}},{key:"insertBefore",value:function(e,t){for(var n=this._current.insertBeforeHelper(e,t.length),r=0;r<t.length;r++){var i=t[r];this.add(n[r],i.id,i.data)}}},{key:"moveAfter",value:function(e,t){for(var n=this._current.insertAfterHelper(e,t.length),r=0;r<t.length;r++){var i=t[r];this.move(n[r],i)}}},{key:"moveBefore",value:function(e,t){for(var n=this._current.insertBeforeHelper(e,t.length),r=0;r<t.length;r++){var i=t[r];this.move(n[r],i)}}},{key:"delete",value:function(e){this.deleteChildren(e),this.runOp({type:5,id:e})}}]),n}(xy);function Ty(e,t,n){if(e.length>0){var r=e[e.length-1];if(0===r.type&&0===t.type&&My.equal(r.path,n))return void Object.assign(r.props,t.props)}e.push(Object(p.a)(Object(p.a)({},t),{},{path:n}))}var My,Cy=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this)).ts=[],r.actual=[],r.reverse=[],r._current=e,r}return Object(A.a)(n,[{key:"update",value:function(e,t){if(""!==e)throw new Error("");this._current=t}},{key:"push",value:function(e,t,n,r){Ty(this.ts,t,e),Ty(this.actual,n,e),Ty(this.reverse,r,e)}},{key:"result",value:function(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}}]),n}(xy);function Dy(e,t,n){return n instanceof ty?new Ay(e,t,n):n instanceof ny?new jy(e,t,n):n instanceof qg?new Proxy(new ky(e,t,n),Ey):null!==n&&"object"==typeof n?Zg(n)?n:new Proxy(new Oy(e,t,n),Sy):n}function Iy(e){var t=new Cy(e);return[Dy(t,"",e),t]}function Py(e,t){var n=Iy(e),r=Object(g.a)(n,2),i=r[0],a=r[1];return t(i),a.result()}function Ry(e){return e instanceof Ay||e instanceof jy?e._current:null!==e&&"object"==typeof e?e[yy]:e}function Ly(e,t){var n=[];if(!(t.length<=e.length))return null;for(var r=0;r<t.length;){if("*"===t[r])n.push(e[r]);else if(e[r]!==t[r])return null;r+=1}return n}!function(e){function t(e,t){return(e instanceof ty||e instanceof Ay)&&"string"==typeof t||(e instanceof ny||e instanceof jy)&&"string"==typeof t?e.data(t):"number"==typeof t&&Array.isArray(e)||"string"==typeof t&&"object"==typeof e&&null!==e?e[t]:void 0}function n(e,n){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;r<n.length&&void 0!==e;)e=t(e,n[r]),r+=1;return e}e.equal=function(e,t){if(t.length!==e.length)return!1;for(var n=0;n<e.length;){if(e[n]!==t[n])return!1;n+=1}return!0},e.removeOverridden=function(e,t,r){var i=n(r,e);if(void 0!==i&&"object"==typeof i&&null!==i){var a=Object(p.a)({},t);return Object.keys(i).forEach((function(e){delete a[e]})),a}return t},e.zoomOnce=t,e.zoom=n}(My||(My={}));var Ny,By=Object(A.a)((function e(){Object(E.a)(this,e)})),Fy=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this)).id=e,r}return Object(A.a)(n)}(By),Uy=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this)).data=e,r}return Object(A.a)(n)}(By);try{Ny=new TextDecoder}catch(NB){}var zy,Vy,Gy,Hy,Wy,qy,Yy,Xy=0,Ky=[],Qy=Ky,Zy=0,Jy={},$y=0,eb=0,tb=[],nb={useRecords:!1,mapsAsObjects:!0},rb=Object(A.a)((function e(){Object(E.a)(this,e)})),ib=new rb;ib.name="MessagePack 0xC1";var ab=!1,ob=function(){function e(t){Object(E.a)(this,e),t&&(!1===t.useRecords&&void 0===t.mapsAsObjects&&(t.mapsAsObjects=!0),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0)),Object.assign(this,t)}return Object(A.a)(e,[{key:"unpack",value:function(t,n){var r=this;if(zy)return Cb((function(){return Db(),r?r.unpack(t,n):e.prototype.unpack.call(nb,t,n)}));Vy=n>-1?n:t.length,Xy=0,Zy=0,eb=0,Hy=null,Qy=Ky,Wy=null,zy=t;try{Yy=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(ay){throw zy=null,t instanceof Uint8Array?ay:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&"object"==typeof t?t.constructor.name:typeof t))}if(this instanceof e){if(Jy=this,this.structures)return Gy=this.structures,sb();(!Gy||Gy.length>0)&&(Gy=[])}else Jy=nb,(!Gy||Gy.length>0)&&(Gy=[]);return sb()}},{key:"unpackMultiple",value:function(e,t){var n,r=0;try{ab=!0;var i=e.length,a=this?this.unpack(e,i):Lb.unpack(e,i);if(!t){for(n=[a];Xy<i;)r=Xy,n.push(sb());return n}for(t(a);Xy<i;)if(r=Xy,!1===t(sb()))return}catch(i){throw i.lastPosition=r,i.values=n,i}finally{ab=!1,Db()}}},{key:"_mergeStructures",value:function(e,t){for(var n=0,r=(e=e||[]).length;n<r;n++){var i=e[n];i&&(i.isShared=!0,n>=32&&(i.highByte=n-32>>5))}for(var a in e.sharedLength=e.length,t||[])if(a>=0){var o=e[a],s=t[a];s&&(o&&((e.restoreStructures||(e.restoreStructures=[]))[a]=o),e[a]=s)}return this.structures=e}},{key:"decode",value:function(e,t){return this.unpack(e,t)}}]),e}();function sb(){try{if(!Jy.trusted&&!ab){var e=Gy.sharedLength||0;e<Gy.length&&(Gy.length=e)}var t=cb();if(Xy==Vy)Gy.restoreStructures&&ub(),Gy=null,zy=null,qy&&(qy=null);else{if(Xy>Vy){var n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}if(!ab)throw new Error("Data read, but end of buffer not reached")}return t}catch(t){throw Gy.restoreStructures&&ub(),Db(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer"))&&(t.incomplete=!0),t}}function ub(){for(var e in Gy.restoreStructures)Gy[e]=Gy.restoreStructures[e];Gy.restoreStructures=null}function cb(){var e,t=zy[Xy++];if(t<160){if(t<128){if(t<64)return t;var n=Gy[63&t]||Jy.getStructures&&fb()[63&t];return n?(n.read||(n.read=hb(n,63&t)),n.read()):t}if(t<144){if(t-=128,Jy.mapsAsObjects){for(var r={},i=0;i<t;i++)r[Ab()]=cb();return r}for(var a=new Map,o=0;o<t;o++)a.set(cb(),cb());return a}t-=144;for(var s=new Array(t),u=0;u<t;u++)s[u]=cb();return s}if(t<192){var c=t-160;if(eb>=Xy)return Hy.slice(Xy-$y,(Xy+=c)-$y);if(0==eb&&Vy<140){var l=c<16?kb(c):Ob(c);if(null!=l)return l}return pb(c)}switch(t){case 192:return null;case 193:return Wy?(e=cb())>0?Wy[1].slice(Wy.position1,Wy.position1+=e):Wy[0].slice(Wy.position0,Wy.position0-=e):ib;case 194:return!1;case 195:return!0;case 196:return _b(zy[Xy++]);case 197:return e=Yy.getUint16(Xy),Xy+=2,_b(e);case 198:return e=Yy.getUint32(Xy),Xy+=4,_b(e);case 199:return Sb(zy[Xy++]);case 200:return e=Yy.getUint16(Xy),Xy+=2,Sb(e);case 201:return e=Yy.getUint32(Xy),Xy+=4,Sb(e);case 202:if(e=Yy.getFloat32(Xy),Jy.useFloat32>2){var h=Ib[(127&zy[Xy])<<1|zy[Xy+1]>>7];return Xy+=4,(h*e+(e>0?.5:-.5)>>0)/h}return Xy+=4,e;case 203:return e=Yy.getFloat64(Xy),Xy+=8,e;case 204:return zy[Xy++];case 205:return e=Yy.getUint16(Xy),Xy+=2,e;case 206:return e=Yy.getUint32(Xy),Xy+=4,e;case 207:return Jy.int64AsNumber?(e=4294967296*Yy.getUint32(Xy),e+=Yy.getUint32(Xy+4)):e=Yy.getBigUint64(Xy),Xy+=8,e;case 208:return Yy.getInt8(Xy++);case 209:return e=Yy.getInt16(Xy),Xy+=2,e;case 210:return e=Yy.getInt32(Xy),Xy+=4,e;case 211:return Jy.int64AsNumber?(e=4294967296*Yy.getInt32(Xy),e+=Yy.getUint32(Xy+4)):e=Yy.getBigInt64(Xy),Xy+=8,e;case 212:if(114==(e=zy[Xy++]))return jb(63&zy[Xy++]);var d=tb[e];if(d)return d.read?(Xy++,d.read(cb())):d.noBuffer?(Xy++,d()):d(zy.subarray(Xy,++Xy));throw new Error("Unknown extension "+e);case 213:return 114==(e=zy[Xy])?(Xy++,jb(63&zy[Xy++],zy[Xy++])):Sb(2);case 214:return Sb(4);case 215:return Sb(8);case 216:return Sb(16);case 217:return e=zy[Xy++],eb>=Xy?Hy.slice(Xy-$y,(Xy+=e)-$y):vb(e);case 218:return e=Yy.getUint16(Xy),eb>=(Xy+=2)?Hy.slice(Xy-$y,(Xy+=e)-$y):mb(e);case 219:return e=Yy.getUint32(Xy),eb>=(Xy+=4)?Hy.slice(Xy-$y,(Xy+=e)-$y):gb(e);case 220:return e=Yy.getUint16(Xy),Xy+=2,bb(e);case 221:return e=Yy.getUint32(Xy),Xy+=4,bb(e);case 222:return e=Yy.getUint16(Xy),Xy+=2,wb(e);case 223:return e=Yy.getUint32(Xy),Xy+=4,wb(e);default:if(t>=224)return t-256;if(void 0===t){var f=new Error("Unexpected end of MessagePack data");throw f.incomplete=!0,f}throw new Error("Unknown MessagePack token "+t)}}var lb=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function hb(e,t){function n(){if(n.count++>2){var r=e.read=new Function("r","return function(){return {"+e.map((function(e){return lb.test(e)?e+":r()":"["+JSON.stringify(e)+"]:r()"})).join(",")+"}}")(cb);return 0===e.highByte&&(e.read=db(t,e.read)),r()}for(var i={},a=0,o=e.length;a<o;a++){i[e[a]]=cb()}return i}return n.count=0,0===e.highByte?db(t,n):n}var db=function(e,t){return function(){var n=zy[Xy++];if(0===n)return t();var r=e<32?-(e+(n<<5)):e+(n<<5),i=Gy[r]||fb()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=hb(i,e)),i.read()}};function fb(){var e=Cb((function(){return zy=null,Jy.getStructures()}));return Gy=Jy._mergeStructures(e,Gy)}var pb=yb,vb=yb,mb=yb,gb=yb;function yb(e){var t;if(e<16&&(t=kb(e)))return t;if(e>64&&Ny)return Ny.decode(zy.subarray(Xy,Xy+=e));var n=Xy+e,r=[];for(t="";Xy<n;){var i=zy[Xy++];if(0===(128&i))r.push(i);else if(192===(224&i)){var a=63&zy[Xy++];r.push((31&i)<<6|a)}else if(224===(240&i)){var o=63&zy[Xy++],s=63&zy[Xy++];r.push((31&i)<<12|o<<6|s)}else if(240===(248&i)){var u=(7&i)<<18|(63&zy[Xy++])<<12|(63&zy[Xy++])<<6|63&zy[Xy++];u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u)}else r.push(i);r.length>=4096&&(t+=xb.apply(String,r),r.length=0)}return r.length>0&&(t+=xb.apply(String,r)),t}function bb(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=cb();return t}function wb(e){if(Jy.mapsAsObjects){for(var t={},n=0;n<e;n++)t[Ab()]=cb();return t}for(var r=new Map,i=0;i<e;i++)r.set(cb(),cb());return r}var xb=String.fromCharCode;function Ob(e){for(var t=Xy,n=new Array(e),r=0;r<e;r++){var i=zy[Xy++];if((128&i)>0)return void(Xy=t);n[r]=i}return xb.apply(String,n)}function kb(e){if(e<4){if(e<2){if(0===e)return"";var t=zy[Xy++];return(128&t)>1?void(Xy-=1):xb(t)}var n=zy[Xy++],r=zy[Xy++];if((128&n)>0||(128&r)>0)return void(Xy-=2);if(e<3)return xb(n,r);var i=zy[Xy++];return(128&i)>0?void(Xy-=3):xb(n,r,i)}var a=zy[Xy++],o=zy[Xy++],s=zy[Xy++],u=zy[Xy++];if((128&a)>0||(128&o)>0||(128&s)>0||(128&u)>0)Xy-=4;else{if(e<6){if(4===e)return xb(a,o,s,u);var c=zy[Xy++];return(128&c)>0?void(Xy-=5):xb(a,o,s,u,c)}if(e<8){var l=zy[Xy++],h=zy[Xy++];if((128&l)>0||(128&h)>0)return void(Xy-=6);if(e<7)return xb(a,o,s,u,l,h);var d=zy[Xy++];return(128&d)>0?void(Xy-=7):xb(a,o,s,u,l,h,d)}var f=zy[Xy++],p=zy[Xy++],v=zy[Xy++],m=zy[Xy++];if((128&f)>0||(128&p)>0||(128&v)>0||(128&m)>0)Xy-=8;else{if(e<10){if(8===e)return xb(a,o,s,u,f,p,v,m);var g=zy[Xy++];return(128&g)>0?void(Xy-=9):xb(a,o,s,u,f,p,v,m,g)}if(e<12){var y=zy[Xy++],b=zy[Xy++];if((128&y)>0||(128&b)>0)return void(Xy-=10);if(e<11)return xb(a,o,s,u,f,p,v,m,y,b);var w=zy[Xy++];return(128&w)>0?void(Xy-=11):xb(a,o,s,u,f,p,v,m,y,b,w)}var x=zy[Xy++],O=zy[Xy++],k=zy[Xy++],_=zy[Xy++];if((128&x)>0||(128&O)>0||(128&k)>0||(128&_)>0)Xy-=12;else{if(e<14){if(12===e)return xb(a,o,s,u,f,p,v,m,x,O,k,_);var S=zy[Xy++];return(128&S)>0?void(Xy-=13):xb(a,o,s,u,f,p,v,m,x,O,k,_,S)}var E=zy[Xy++],A=zy[Xy++];if(!((128&E)>0||(128&A)>0)){if(e<15)return xb(a,o,s,u,f,p,v,m,x,O,k,_,E,A);var j=zy[Xy++];return(128&j)>0?void(Xy-=15):xb(a,o,s,u,f,p,v,m,x,O,k,_,E,A,j)}Xy-=14}}}}function _b(e){return Jy.copyBuffers?Uint8Array.prototype.slice.call(zy,Xy,Xy+=e):zy.subarray(Xy,Xy+=e)}function Sb(e){var t=zy[Xy++];if(tb[t])return tb[t](zy.subarray(Xy,Xy+=e));throw new Error("Unknown extension type "+t)}var Eb=new Array(4096);function Ab(){var e=zy[Xy++];if(!(e>=160&&e<192))return Xy--,cb();if(e-=160,eb>=Xy)return Hy.slice(Xy-$y,(Xy+=e)-$y);if(!(0==eb&&Vy<180))return pb(e);var t,n=4095&(e<<5^(e>1?Yy.getUint16(Xy):e>0?zy[Xy]:0)),r=Eb[n],i=Xy,a=Xy+e-3,o=0;if(r&&r.bytes==e){for(;i<a;){if((t=Yy.getUint32(i))!=r[o++]){i=1879048192;break}i+=4}for(a+=3;i<a;)if((t=zy[i++])!=r[o++]){i=1879048192;break}if(i===a)return Xy=i,r.string;a-=3,i=Xy}for(r=[],Eb[n]=r,r.bytes=e;i<a;)t=Yy.getUint32(i),r.push(t),i+=4;for(a+=3;i<a;)t=zy[i++],r.push(t);var s=e<16?kb(e):Ob(e);return r.string=null!=s?s:pb(e)}var jb=function(e,t){var n=cb(),r=e;void 0!==t&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);var i=Gy[e];return i&&i.isShared&&((Gy.restoreStructures||(Gy.restoreStructures=[]))[e]=i),Gy[e]=n,n.read=hb(n,r),n.read()},Tb="object"==typeof self?self:e;tb[0]=function(){},tb[0].noBuffer=!0,tb[101]=function(){var e=cb();return(Tb[e[0]]||Error)(e[1])},tb[105]=function(e){var t=Yy.getUint32(Xy-4);qy||(qy=new Map);var n,r=zy[Xy],i={target:n=r>=144&&r<160||220==r||221==r?[]:{}};qy.set(t,i);var a=cb();return i.used?Object.assign(n,a):(i.target=a,a)},tb[112]=function(e){var t=Yy.getUint32(Xy-4),n=qy.get(t);return n.used=!0,n.target},tb[115]=function(){return new Set(cb())};var Mb=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map((function(e){return e+"Array"}));function Cb(e){var t,n=Vy,r=Xy,i=Zy,a=$y,o=eb,s=Hy,u=Qy,c=qy,l=Wy,h=new Uint8Array(zy.slice(0,Vy)),d=Gy,f=Gy.slice(0,Gy.length),p=Jy,m=ab,g=e();return Vy=n,Xy=r,Zy=i,$y=a,eb=o,Hy=s,Qy=u,qy=c,Wy=l,zy=h,ab=m,(t=Gy=d).splice.apply(t,[0,Gy.length].concat(Object(v.a)(f))),Jy=p,Yy=new DataView(zy.buffer,zy.byteOffset,zy.byteLength),g}function Db(){zy=null,qy=null,Gy=null}tb[116]=function(e){var t=e[0],n=Mb[t];if(!n)throw new Error("Could not find typed array for code "+t);return new Tb[n](Uint8Array.prototype.slice.call(e,1).buffer)},tb[120]=function(){var e=cb();return new RegExp(e[0],e[1])},tb[98]=function(e){var t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=Xy;Xy+=t-4,(Wy=[cb(),cb()]).position0=0,Wy.position1=0;var r=Xy;Xy=n;try{return cb()}finally{Xy=r}},tb[255]=function(e){return 4==e.length?new Date(1e3*(16777216*e[0]+(e[1]<<16)+(e[2]<<8)+e[3])):8==e.length?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+1e3*(4294967296*(3&e[3])+16777216*e[4]+(e[5]<<16)+(e[6]<<8)+e[7])):12==e.length?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+1e3*((128&e[4]?-281474976710656:0)+1099511627776*e[6]+4294967296*e[7]+16777216*e[8]+(e[9]<<16)+(e[10]<<8)+e[11])):new Date("invalid")};for(var Ib=new Array(147),Pb=0;Pb<256;Pb++)Ib[Pb]=+("1e"+Math.floor(45.15-.30103*Pb));var Rb,Lb=new ob({useRecords:!1}),Nb=(Lb.unpack,Lb.unpackMultiple,Lb.unpack,new Float32Array(1));new Uint8Array(Nb.buffer,0,4);try{Rb=new TextEncoder}catch(BB){}var Bb,Fb,Ub,zb,Vb,Gb=typeof a<"u",Hb=Gb?a.allocUnsafeSlow:Uint8Array,Wb=Gb?a:Uint8Array,qb=Gb?4294967296:2144337920,Yb=0,Xb=null,Kb=/[\u0080-\uFFFF]/,Qb=Symbol("record-id"),Zb=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;Object(E.a)(this,n),(r=t.call(this,e)).offset=0;var i,a,o,s,u,c=0,l=Wb.prototype.utf8Write?function(e,t,n){return Ub.utf8Write(e,t,n)}:!(!Rb||!Rb.encodeInto)&&function(e,t){return Rb.encodeInto(e,Ub.subarray(t)).written},h=Object(x.a)(r);e||(e={});var d=e&&e.sequential,f=e.structures||e.saveStructures,p=e.maxSharedStructures;if(null==p&&(p=f?32:0),p>8160)throw new Error("Maximum maxSharedStructure is 8160");var v=e.maxOwnStructures;null==v&&(v=f?32:64),d&&!e.saveStructures&&(r.structures=[]);var m=p>32||v+p>64,y=p+64,b=p+v+64;if(b>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");var w=[],O=0,k=0;r.pack=r.encode=function(e,t){if(Ub||(Ub=new Hb(8192),zb=new DataView(Ub.buffer,0,8192),Yb=0),(Vb=Ub.length-10)-Yb<2048?(Ub=new Hb(Ub.length),zb=new DataView(Ub.buffer,0,Ub.length),Vb=Ub.length-10,Yb=0):Yb=Yb+7&2147483640,i=Yb,u=h.structuredClone?new Map:null,h.bundleStrings?(Xb=["",""],Ub[Yb++]=214,Ub[Yb++]=98,Xb.position=Yb-i,Yb+=4):Xb=null,a=h.structures){a.uninitialized&&(a=h._mergeStructures(h.getStructures()));var n=a.sharedLength||0;if(n>p)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+a.sharedLength);if(!a.transitions){a.transitions=Object.create(null);for(var r=0;r<n;r++){var l=a[r];if(l){for(var f=void 0,v=a.transitions,m=0,g=l.length;m<g;m++){var y=l[m];(f=v[y])||(f=v[y]=Object.create(null)),v=f}v[Qb]=r+64}}c=n}d||(a.nextId=n+64)}o&&(o=!1),s=a||[];try{if(_(e),Xb){zb.setUint32(Xb.position+i,Yb-Xb.position-i);var b=Xb;Xb=null,_(b[0]),_(b[1])}if(h.offset=Yb,u&&u.idsToInsert){(Yb+=6*u.idsToInsert.length)>Vb&&A(Yb),h.offset=Yb;var x=function(e,t){var n,r=6*t.length,i=e.length-r;for(t.sort((function(e,t){return e.offset>t.offset?1:-1}));n=t.pop();){var a=n.offset,o=n.id;e.copyWithin(a+r,a,i);var s=a+(r-=6);e[s++]=214,e[s++]=105,e[s++]=o>>24,e[s++]=o>>16&255,e[s++]=o>>8&255,e[s++]=255&o,i=a}return e}(Ub.subarray(i,Yb),u.idsToInsert);return u=null,x}return t&rw?(Ub.start=i,Ub.end=Yb,Ub):Ub.subarray(i,Yb)}finally{if(a){if(k<10&&k++,O>1e4)a.transitions=null,k=0,O=0,w.length>0&&(w=[]);else if(w.length>0&&!d){for(var S=0,E=w.length;S<E;S++)w[S][Qb]=0;w=[]}if(o&&h.saveStructures){var j=a.sharedLength||p;a.length>j&&(a=a.slice(0,j));var T=Ub.subarray(i,Yb);return!1===h.saveStructures(a,c)?(h._mergeStructures(h.getStructures()),h.pack(e)):(c=j,T)}}t&iw&&(Yb=i)}};var _=function e(t){Yb>Vb&&(Ub=A(Yb));var n,a=typeof t;if("string"===a){var o,s=t.length;if(Xb&&s>=8&&s<4096){var c=Kb.test(t);return Xb[c?0:1]+=t,Ub[Yb++]=193,void e(c?-s:s)}o=s<32?1:s<256?2:s<65536?3:5;var h=3*s;if(Yb+h>Vb&&(Ub=A(Yb+h)),s<64||!l){var d,f,p,v=Yb+o;for(d=0;d<s;d++)(f=t.charCodeAt(d))<128?Ub[v++]=f:f<2048?(Ub[v++]=f>>6|192,Ub[v++]=63&f|128):55296===(64512&f)&&56320===(64512&(p=t.charCodeAt(d+1)))?(f=65536+((1023&f)<<10)+(1023&p),d++,Ub[v++]=f>>18|240,Ub[v++]=f>>12&63|128,Ub[v++]=f>>6&63|128,Ub[v++]=63&f|128):(Ub[v++]=f>>12|224,Ub[v++]=f>>6&63|128,Ub[v++]=63&f|128);n=v-Yb-o}else n=l(t,Yb+o,h);n<32?Ub[Yb++]=160|n:n<256?(o<2&&Ub.copyWithin(Yb+2,Yb+1,Yb+1+n),Ub[Yb++]=217,Ub[Yb++]=n):n<65536?(o<3&&Ub.copyWithin(Yb+3,Yb+2,Yb+2+n),Ub[Yb++]=218,Ub[Yb++]=n>>8,Ub[Yb++]=255&n):(o<5&&Ub.copyWithin(Yb+5,Yb+3,Yb+3+n),Ub[Yb++]=219,zb.setUint32(Yb,n),Yb+=4),Yb+=n}else if("number"===a)if(t>>>0===t)t<64?Ub[Yb++]=t:t<256?(Ub[Yb++]=204,Ub[Yb++]=t):t<65536?(Ub[Yb++]=205,Ub[Yb++]=t>>8,Ub[Yb++]=255&t):(Ub[Yb++]=206,zb.setUint32(Yb,t),Yb+=4);else if(t>>0===t)t>=-32?Ub[Yb++]=256+t:t>=-128?(Ub[Yb++]=208,Ub[Yb++]=t+256):t>=-32768?(Ub[Yb++]=209,zb.setInt16(Yb,t),Yb+=2):(Ub[Yb++]=210,zb.setInt32(Yb,t),Yb+=4);else{var m;if((m=r.useFloat32)>0&&t<4294967296&&t>=-2147483648){var y;if(Ub[Yb++]=202,zb.setFloat32(Yb,t),m<4||(y=t*Ib[(127&Ub[Yb])<<1|Ub[Yb+1]>>7])>>0===y)return void(Yb+=4);Yb--}Ub[Yb++]=203,zb.setFloat64(Yb,t),Yb+=8}else if("object"===a)if(t){if(u){var b=u.get(t);if(b){if(!b.id){var w=u.idsToInsert||(u.idsToInsert=[]);b.id=w.push(b)}return Ub[Yb++]=214,Ub[Yb++]=112,zb.setUint32(Yb,b.id),void(Yb+=4)}u.set(t,{offset:Yb-i})}var O=t.constructor;if(O===Object)S(t,!0);else if(O===Array){(n=t.length)<16?Ub[Yb++]=144|n:n<65536?(Ub[Yb++]=220,Ub[Yb++]=n>>8,Ub[Yb++]=255&n):(Ub[Yb++]=221,zb.setUint32(Yb,n),Yb+=4);for(var k=0;k<n;k++)e(t[k])}else if(O===Map){(n=t.size)<16?Ub[Yb++]=128|n:n<65536?(Ub[Yb++]=222,Ub[Yb++]=n>>8,Ub[Yb++]=255&n):(Ub[Yb++]=223,zb.setUint32(Yb,n),Yb+=4);var _,E=Object(j.a)(t);try{for(E.s();!(_=E.n()).done;){var T=Object(g.a)(_.value,2),M=T[0],C=T[1];e(M),e(C)}}catch(L){E.e(L)}finally{E.f()}}else{for(var D=function(){var n=Fb[I];if(t instanceof n){var i=Bb[I];if(i.write)return i.type&&(Ub[Yb++]=212,Ub[Yb++]=i.type,Ub[Yb++]=0),e(i.write.call(Object(x.a)(r),t)),{v:void 0};var a,o=Ub,s=zb,u=Yb;Ub=null;try{a=i.pack.call(Object(x.a)(r),t,(function(e){return Ub=o,o=null,(Yb+=e)>Vb&&A(Yb),{target:Ub,targetView:zb,position:Yb-e}}),e)}finally{o&&(zb=s,Yb=u,Vb=(Ub=o).length-10)}return a&&(a.length+Yb>Vb&&A(a.length+Yb),Yb=function(e,t,n,r){var i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=255&i):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=255&i)}return t[n++]=r,t.set(e,n),n+=i,n}(a,Ub,Yb,i.type)),{v:void 0}}},I=0,P=Bb.length;I<P;I++){var R=D();if("object"===typeof R)return R.v}S(t,!t.hasOwnProperty)}}else Ub[Yb++]=192;else if("boolean"===a)Ub[Yb++]=t?195:194;else if("bigint"===a){if(t<BigInt(1)<<BigInt(63)&&t>=-(BigInt(1)<<BigInt(63)))Ub[Yb++]=211,zb.setBigInt64(Yb,t);else if(t<BigInt(1)<<BigInt(64)&&t>0)Ub[Yb++]=207,zb.setBigUint64(Yb,t);else{if(!r.largeBigIntToFloat)throw new RangeError(t+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");Ub[Yb++]=203,zb.setFloat64(Yb,Number(t))}Yb+=8}else if("undefined"===a)r.encodeUndefinedAsNil?Ub[Yb++]=192:(Ub[Yb++]=212,Ub[Yb++]=0,Ub[Yb++]=0);else{if("function"!==a)throw new Error("Unknown type: "+a);e(r.writeFunction&&r.writeFunction())}},S=!1===r.useRecords?r.variableMapSize?function(e){var t,n=Object.keys(e),r=n.length;r<16?Ub[Yb++]=128|r:r<65536?(Ub[Yb++]=222,Ub[Yb++]=r>>8,Ub[Yb++]=255&r):(Ub[Yb++]=223,zb.setUint32(Yb,r),Yb+=4);for(var i=0;i<r;i++)_(t=n[i]),_(e[t])}:function(e,t){Ub[Yb++]=222;var n=Yb-i;Yb+=2;var r=0;for(var a in e)(t||e.hasOwnProperty(a))&&(_(a),_(e[a]),r++);Ub[n+++i]=r>>8,Ub[n+i]=255&r}:function(e){for(var t,n=Object.keys(e),i=s.transitions||(s.transitions=Object.create(null)),a=0,u=0,c=n.length;u<c;u++){var l=n[u];(t=i[l])||(t=i[l]=Object.create(null),a++),i=t}var h=i[Qb];if(h)h>=96&&m?(Ub[Yb++]=96+(31&(h-=96)),Ub[Yb++]=h>>5):Ub[Yb++]=h;else{(h=s.nextId)||(h=64),h<y&&r.shouldShareStructure&&!r.shouldShareStructure(n)?((h=s.nextOwnId)<b||(h=y),s.nextOwnId=h+1):(h>=b&&(h=y),s.nextId=h+1);var d=n.highByte=h>=96&&m?h-96>>5:-1;i[Qb]=h,s[h-64]=n,h<y?(n.isShared=!0,s.sharedLength=h-63,o=!0,d>=0?(Ub[Yb++]=96+(31&h),Ub[Yb++]=d):Ub[Yb++]=h):(d>=0?(Ub[Yb++]=213,Ub[Yb++]=114,Ub[Yb++]=96+(31&h),Ub[Yb++]=d):(Ub[Yb++]=212,Ub[Yb++]=114,Ub[Yb++]=h),a&&(O+=k*a),w.length>=v&&(w.shift()[Qb]=0),w.push(i),_(n))}for(var f=0,p=n.length;f<p;f++)_(e[n[f]])},A=function(e){var t;if(e>16777216){if(e-i>qb)throw new Error("Packed buffer would be larger than maximum buffer size");t=Math.min(qb,4096*Math.round(Math.max((e-i)*(e>67108864?1.25:2),4194304)/4096))}else t=1+(Math.max(e-i<<2,Ub.length-1)>>12)<<12;var n=new Hb(t);return zb=new DataView(n.buffer,0,t),Ub.copy?Ub.copy(n,0,i,e):n.set(Ub.slice(i,e)),Yb-=i,i=0,Vb=n.length-10,Ub=n};return r}return Object(A.a)(n,[{key:"useBuffer",value:function(e){Ub=e,zb=new DataView(Ub.buffer,Ub.byteOffset,Ub.byteLength),Yb=0}}]),n}(ob);function Jb(e,t,n,r){var i=e.byteLength;if(i+1<256){var a=n(4+i),o=a.target,s=a.position;o[s++]=199,o[s++]=i+1}else if(i+1<65536){var u=n(5+i);o=u.target,s=u.position;o[s++]=200,o[s++]=i+1>>8,o[s++]=i+1&255}else{var c=n(7+i),l=(o=c.target,s=c.position,c.targetView);o[s++]=201,l.setUint32(s,i+1),s+=4}o[s++]=116,o[s++]=t,o.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),s)}function $b(e,t){var n=e.byteLength;if(n<256){var r=t(n+2),i=r.target,a=r.position;i[a++]=196,i[a++]=n}else if(n<65536){var o=t(n+3);i=o.target,a=o.position;i[a++]=197,i[a++]=n>>8,i[a++]=255&n}else{var s=t(n+5),u=(i=s.target,a=s.position,s.targetView);i[a++]=198,u.setUint32(a,n),a+=4}i.set(e,a)}function ew(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");Fb.unshift(e.Class),Bb.unshift(e)}!function(e){e.unpack?tb[e.type]=e.unpack:tb[e.type]=e}(e)}Fb=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,rb],Bb=[{pack:function(e,t,n){var r=e.getTime()/1e3;if((this.useTimestamp32||0===e.getMilliseconds())&&r>=0&&r<4294967296){var i=t(6),a=i.target,o=i.targetView,s=i.position;a[s++]=214,a[s++]=255,o.setUint32(s,r)}else if(r>0&&r<17179869184){var u=t(10),c=u.target,l=u.targetView,h=u.position;c[h++]=215,c[h++]=255,l.setUint32(h,4e6*e.getMilliseconds()+(r/1e3/4294967296>>0)),l.setUint32(h+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());var d=t(3),f=d.target,p=(d.targetView,d.position);f[p++]=212,f[p++]=255,f[p++]=255}else{var v=t(15),m=v.target,g=v.targetView,y=v.position;m[y++]=199,m[y++]=12,m[y++]=255,g.setUint32(y,1e6*e.getMilliseconds()),g.setBigInt64(y+4,BigInt(Math.floor(r)))}}},{pack:function(e,t,n){var r=Array.from(e),i=t(this.structuredClone?3:0),a=i.target,o=i.position;this.structuredClone&&(a[o++]=212,a[o++]=115,a[o++]=0),n(r)}},{pack:function(e,t,n){var r=t(this.structuredClone?3:0),i=r.target,a=r.position;this.structuredClone&&(i[a++]=212,i[a++]=101,i[a++]=0),n([e.name,e.message])}},{pack:function(e,t,n){var r=t(this.structuredClone?3:0),i=r.target,a=r.position;this.structuredClone&&(i[a++]=212,i[a++]=120,i[a++]=0),n([e.source,e.flags])}},{pack:function(e,t){this.structuredClone?Jb(e,16,t):$b(Gb?a.from(e):new Uint8Array(e),t)}},{pack:function(e,t){var n=e.constructor;n!==Wb&&this.structuredClone?Jb(e,Mb.indexOf(n.name),t):$b(e,t)}},{pack:function(e,t){var n=t(1);n.target[n.position]=193}}];var tw,nw=new Zb({useRecords:!1}),rw=(nw.pack,nw.pack,512),iw=1024,aw=new Zb({structuredClone:!0});function ow(e){if(Zg(e))return e;if(Array.isArray(e))return e.map(ow);if("object"==typeof e&&null!==e){var t,n={},r=Object(j.a)(Object.keys(e).sort());try{for(r.s();!(t=r.n()).done;){var i=t.value;n[i]=ow(e[i])}}catch(a){r.e(a)}finally{r.f()}return Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}return e}ew({Class:qg.prototype.constructor,type:1,write:function(e){return Object(p.a)({},e)},read:function(e){return Object.setPrototypeOf(e,qg.prototype),e}}),ew({Class:ny.prototype.constructor,type:2,write:function(e){return Object(v.a)(e)},read:function(e){return Object.setPrototypeOf(e,ny.prototype),e}}),ew({Class:ty.prototype.constructor,type:3,write:function(e){return Object(v.a)(e)},read:function(e){return Object.setPrototypeOf(e,ty.prototype),e}}),ew({Class:Fy.prototype.constructor,type:4,write:function(e){return e.id},read:function(e){return new Fy(e)}}),ew({Class:Uy.prototype.constructor,type:5,write:function(e){return e.data},read:function(e){return new Uy(e)}}),ew({Class:cy.prototype.constructor,type:6,write:function(e){return Object(p.a)({},e)},read:function(e){return Object.setPrototypeOf(e,cy.prototype),e}}),function(e){function t(e){return aw.pack(e)}e.serialize=t,e.deserialize=function(e){return aw.unpack(e)},e.checksum=function(e){return function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++)t=(t<<5)-t+e[n],t&=t;return t}(t(ow(e))).toString()}}(tw||(tw={}));var sw,uw,cw,lw,hw,dw,fw,pw,vw,mw,gw,yw,bw,ww,xw,Ow,kw,_w,Sw,Ew,Aw,jw,Tw,Mw,Cw,Dw,Iw,Pw,Rw=(s={},Object(_.a)(s,"LookAt",[]),Object(_.a)(s,"Follow",[]),Object(_.a)(s,"MouseHover",["Transition"]),Object(_.a)(s,"Scroll",["Transition"]),Object(_.a)(s,"Start",["Transition","Audio","Video"]),Object(_.a)(s,"Conditional",["Transition","Audio","Video"]),Object(_.a)(s,"MouseDown",["Transition","Audio","Video","Link","Reset"]),Object(_.a)(s,"MouseUp",["Transition","Audio","Video","Link","Reset"]),Object(_.a)(s,"MousePress",["Transition","Audio","Video","Link","Reset"]),Object(_.a)(s,"KeyDown",["Transition","Audio","Video","Link","Reset"]),Object(_.a)(s,"KeyUp",["Transition","Audio","Video","Link","Reset"]),Object(_.a)(s,"KeyPress",["Transition","Audio","Video","Link","Reset"]),Object(_.a)(s,"GameControl",["Transition","Audio"]),Object(_.a)(s,"Collision",["Transition","Audio"]),s);(uw=sw||(sw={})).is=function(e){return"MouseDown"===e.type||"MouseUp"===e.type||"MousePress"===e.type||"KeyDown"===e.type||"KeyUp"===e.type||"KeyPress"===e.type},uw.defaultData=function(e){return"MouseDown"===e||"MouseUp"===e||"MousePress"===e?{type:e,disabled:!1,toggle:!1,actions:new ny}:{type:e,disabled:!1,key:void 0,toggle:!1,actions:new ny}},function(e){e.propertyDefaultData=function(e){return{type:"Property",value:[null!==e&&void 0!==e?e:null,"position","x"]}},e.valueDefaultData={type:"Literal",value:0}}(cw||(cw={})),function(e){e.comparisonDefaultData=function(e){return{type:"Comparison",operator:"==",lOperand:cw.propertyDefaultData(e),rOperand:Object(p.a)({},cw.valueDefaultData)}},e.distanceDefaultData=function(e){return{type:"Distance",toObject:null!==e&&void 0!==e?e:null,fromObject:null!==e&&void 0!==e?e:null,distance:200}},e.stateDefaultData=function(e,t){return{type:"State",object:null!==e&&void 0!==e?e:null,state:null!==t&&void 0!==t?t:null}}}(lw||(lw={})),function(e){e.is=function(e){return"Conditional"===e.type},e.defaultData=function(e){return{type:"Conditional",disabled:!1,inActions:new ny,outActions:new ny,condition:lw.distanceDefaultData(e)}}}(hw||(hw={})),function(e){e.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,plane:"custom",resetOnPointerLeave:!0}}(dw||(dw={})),function(e){e.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0}}(fw||(fw={})),function(e){e.is=function(e){return"MouseHover"===e.type},e.defaultData=function(){return{type:"MouseHover",disabled:!1,actions:new ny}}}(pw||(pw={})),function(e){e.is=function(e){return"Scroll"===e.type},e.defaultData=function(){return{type:"Scroll",disabled:!1,steps:100,actions:new ny}}}(vw||(vw={})),function(e){e.is=function(e){return"Start"===e.type},e.defaultData=function(){return{type:"Start",disabled:!1,actions:new ny}}}(mw||(mw={})),function(e){e.is=function(e){return"Collision"===e.type},e.defaultData=function(){return{type:"Collision",disabled:!1,toggle:!1,target:"character",actions:new ny}}}(gw||(gw={})),function(e){e.isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]},e.lerp=function(e,t,n){return[e[0]+(t[0]-e[0])*n,e[1]+(t[1]-e[1])*n]}}(yw||(yw={})),(ww=bw||(bw={})).isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},ww.add=function(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]},ww.sub=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},ww.div=function(e,t){return[e[0]/t[0],e[1]/t[1],e[2]/t[2]]},ww.mul=function(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2]]},ww.lerp=function(e,t,n){return[e[0]+(t[0]-e[0])*n,e[1]+(t[1]-e[1])*n,e[2]+(t[2]-e[2])*n]},function(e){e.isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.lerp=function(e,t,n){return[e[0]+(t[0]-e[0])*n,e[1]+(t[1]-e[1])*n,e[2]+(t[2]-e[2])*n,e[3]+(t[3]-e[3])*n]}}(xw||(xw={})),(kw=Ow||(Ow={})).identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],kw.isEqual=function(e,t){for(var n=0;n<16;n++)if(e[n]!==t[n])return!1;return!0},kw.simplify=function(e){return null!==e&&void 0!==e?e:kw.identity},kw.applyMatrix4=function(e,t){for(var n=t.slice(0),r=0,i=t.length;r<i;r+=3){var a=e[3]*t[r]+e[7]*t[r+1]+e[11]*t[r+2]+e[15];n[r]=(e[0]*t[r]+e[4]*t[r+1]+e[8]*t[r+2]+e[12])/a,n[r+1]=(e[1]*t[r]+e[5]*t[r+1]+e[9]*t[r+2]+e[13])/a,n[r+2]=(e[2]*t[r]+e[6]*t[r+1]+e[10]*t[r+2]+e[14])/a}return n},(Sw=_w||(_w={})).isRGB=function(e){return"object"==typeof e&&"number"==typeof e.r&&"number"==typeof e.g&&"number"==typeof e.b},Sw.white={r:1,g:1,b:1},Sw.red={r:1,g:0,b:0},Sw.black={r:0,g:0,b:0},Sw.toRgb255a1=function(e){return{r:Math.round(255*e.r),g:Math.round(255*e.g),b:Math.round(255*e.b),a:1}},Sw.clone=function(e){return{r:e.r,g:e.g,b:e.b}},Sw.fromHex=function(e){return{r:((e=Math.floor(e))>>16&255)/255,g:(e>>8&255)/255,b:(255&e)/255}},Sw.equals=function(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b},Sw.lerp=function(e,t,n){return{r:e.r+(t.r-e.r)*n,g:e.g+(t.g-e.g)*n,b:e.b+(t.b-e.b)*n}},(Aw=Ew||(Ew={})).white=Object(p.a)(Object(p.a)({},_w.white),{},{a:1}),Aw.transparent=Object(p.a)(Object(p.a)({},_w.white),{},{a:0}),Aw.from0to1=function(e){return{r:e[0],g:e[1],b:e[2],a:e[3]}},Aw.fromHexAndA=function(e,t){return Object(p.a)(Object(p.a)({},_w.fromHex(e)),{},{a:t})},Aw.toRgb255a1=function(e){return{r:Math.round(255*e.r),g:Math.round(255*e.g),b:Math.round(255*e.b),a:e.a}},Aw.equals=function(e,t){return _w.equals(e,t)&&e.a===t.a},Aw.lerp=function(e,t,n){return{r:e.r+(t.r-e.r)*n,g:e.g+(t.g-e.g)*n,b:e.b+(t.b-e.b)*n,a:e.a+(t.a-e.a)*n}},function(e){e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]}}(jw||(jw={})),function(e){e.defaultData={mass:1,stiffness:80,damping:10,velocity:0}}(Tw||(Tw={})),function(e){e.defaultData={control1:[.5,.05],control2:[.1,.3]}}(Mw||(Mw={})),function(e){e.all=["PerspectiveCamera","OrthographicCamera"],e.is=function(t){return e.all.includes(t)}}(Cw||(Cw={})),function(e){e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1,autoZoom:!1,autoZoomFrustumSize:790},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset},e.getZoom=function(e){return"PerspectiveCamera"===e.type?e.perspective.zoom:e.orthographic.zoom}}(Dw||(Dw={})),function(e){e.defaultData=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:2*Math.max(e[0],e[1]),start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[e[0]+e[0]*t,0,0]},grid:{count:[2,2,2],size:e.map((function(e){return e*(1+t)})),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}},e.merge=function(e,t){var n=Object(p.a)({},e);if(Gw.forEach((function(r){var i;Object.assign(n,Object(_.a)({},r,null!==(i=t[r])&&void 0!==i?i:e[r]))})),n.radial=Object(p.a)({},e.radial),t.radial){var r=e.radial,i=t.radial;Hw.forEach((function(e){var t;Object.assign(n.radial,Object(_.a)({},e,null!==(t=i[e])&&void 0!==t?t:r[e]))}))}if(n.linear=Object(p.a)({},e.linear),t.linear){var a=e.linear,o=t.linear;Ww.forEach((function(e){var t;Object.assign(n.linear,Object(_.a)({},e,null!==(t=o[e])&&void 0!==t?t:a[e]))}))}if(n.grid=Object(p.a)({},e.grid),t.grid){var s=e.grid,u=t.grid;qw.forEach((function(e){var t;Object.assign(n.grid,Object(_.a)({},e,null!==(t=u[e])&&void 0!==t?t:s[e]))}))}if(n.toObject=Object(p.a)({},e.toObject),t.toObject){var c=e.toObject,l=t.toObject;Yw.forEach((function(e){var t;Object.assign(n.toObject,Object(_.a)({},e,null!==(t=l[e])&&void 0!==t?t:c[e]))}))}if(n.randomnessObject=Object(p.a)({},e.randomnessObject),t.randomnessObject){var h=e.randomnessObject,d=t.randomnessObject;Xw.forEach((function(e){var t;Object.assign(n.randomnessObject,Object(_.a)({},e,null!==(t=d[e])&&void 0!==t?t:h[e]))}))}return n}}(Iw||(Iw={})),function(e){e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};var t=["radial","linear","grid","toObject","randomnessObject"];e.toOps=function(e,n){var r=[];void 0!==e.count&&r.push({type:0,path:n,props:{count:e.count}});var i,a=Object(j.a)(t);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=e[o];s&&Object.keys(s).length>0&&r.push({type:0,path:[].concat(Object(v.a)(n),[o]),props:s})}}catch(u){a.e(u)}finally{a.f()}return r}}(Pw||(Pw={}));var Lw,Nw,Bw,Fw,Uw,zw,Vw,Gw=["count"],Hw=["radius","start","end","position","scale","rotation"],Ww=["position","scale","rotation"],qw=["count","size"],Yw=["count","position","scale","rotation"],Xw=["strength","scale","rotation","position","movement","seed","freqScale"];!function(e){var t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:Object(p.a)(Object(p.a)({},t),{},{blendFunction:16,granularity:15}),bloom:Object(p.a)(Object(p.a)({},t),{},{blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3}),chromaticAberration:Object(p.a)(Object(p.a)({},t),{},{offset:[2,2]}),vignette:Object(p.a)(Object(p.a)({},t),{},{darkness:1,offset:0}),hueSaturation:Object(p.a)(Object(p.a)({},t),{},{hue:3,saturation:0}),brightnessContrast:Object(p.a)(Object(p.a)({},t),{},{brightness:.25,contrast:0}),depthOfField:Object(p.a)(Object(p.a)({},t),{},{focalLength:2,focusDistance:2,bokehScale:2}),noise:Object(p.a)(Object(p.a)({},t),{},{blendFunction:16})}}(Lw||(Lw={})),function(e){e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"],e.is=function(t){return e.all.includes(t)}}(Nw||(Nw={})),function(e){e.defaultData=function(e){return function(e){if("PointLight"===e)return{type:e,color:Ew.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,depth:1e5};if("SpotLight"===e)return{type:e,color:Ew.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,shadowResolution:1024,shadowRadius:1};if("DirectionalLight"===e)return{type:e,color:Ew.white,intensity:1,shadows:!0,size:1e3,depth:1e5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}(e)}}(Bw||(Bw={})),function(e){e.defaultData={castShadow:!0,receiveShadow:!0},e.equals=function(e,t){return e.castShadow===t.castShadow&&e.receiveShadow===t.receiveShadow}}(Fw||(Fw={})),function(e){e.defaultData={flatShading:!1,wireframe:!1,side:0},e.equals=function(e,t){return e.flatShading===t.flatShading&&e.side===t.side&&e.wireframe===t.wireframe}}(Uw||(Uw={})),function(e){e.defaultData=Object(p.a)(Object(p.a)({},Uw.defaultData),Fw.defaultData)}(zw||(zw={})),function(e){e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7}(Vw||(Vw={}));var Kw,Qw,Zw,Jw,$w,ex,tx,nx,rx,ix,ax,ox,sx,ux,cx,lx,hx,dx,fx,px,vx,mx,gx=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],yx=["wrapping","image","video"];function bx(e,t){return Object.setPrototypeOf(e,t),e}!function(e){e.patch=function(e,t){var n=t.texture,r=Object(h.a)(t,T);if(Object.assign(e,r),n){var i=e.texture;i&&Object.assign(i,n)}},e.defaultData=function(e,t){return"light"===e&&t?function(e){switch(e){case"phong":return{category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",alpha:.6,visible:!0,mode:0};case"toon":return{category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1,visible:!0,mode:0};case"lambert":return{category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0};case"physical":return{category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0}}}(t):function(e){switch(e){case"texture":return{alpha:1,visible:!0,size:[128,128],mode:0,axis:"x",side:2,type:"texture",projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0]},crop:!1};case"video":return{alpha:1,visible:!0,size:[128,128],mode:0,axis:"x",side:2,type:"video",projection:0,texture:{video:Vw.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0]},crop:!0};case"color":return{type:"color",alpha:1,visible:!0,mode:0,color:_w.fromHex(4737101)};case"depth":return{type:"depth",alpha:1,visible:!0,mode:0,gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{type:"normal",alpha:1,visible:!0,mode:0,cnormal:[1,1,1]};case"gradient":return{type:"gradient",alpha:1,visible:!0,mode:0,gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{type:"noise",alpha:1,visible:!0,mode:0,size:[100,100,100],noiseType:0,scale:1,move:1,colorA:Object(p.a)(Object(p.a)({},_w.fromHex(6710886)),{},{a:1}),colorB:Object(p.a)(Object(p.a)({},_w.fromHex(6710886)),{},{a:1}),colorC:Object(p.a)(Object(p.a)({},_w.fromHex(16777215)),{},{a:1}),colorD:Object(p.a)(Object(p.a)({},_w.fromHex(16777215)),{},{a:1}),distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8]};case"fresnel":return{type:"fresnel",alpha:1,visible:!0,mode:0,color:Ew.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{type:"rainbow",alpha:1,visible:!0,mode:0,filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{type:"toon",alpha:1,visible:!0,mode:0,positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:Ew.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{type:"outline",alpha:1,visible:!0,mode:0,outlineColor:Ew.fromHexAndA(0,1),contourColor:Ew.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{type:"matcap",alpha:1,visible:!0,mode:0,texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0]}};case"transmission":return{type:"transmission",alpha:1,visible:!0,mode:0,thickness:10,ior:1.5,roughness:1};case"displace":return{type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,visible:!0}}}(e)}}(Kw||(Kw={})),function(e){function t(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"layer1",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layer2",r=new ny;return r.push({fi:0,data:Kw.defaultData("light",e),id:t}),r.push({fi:1,data:Kw.defaultData("color"),id:n}),{layers:r}}e.isMergable=function(e){return!e.layers.some((function(e){return"texture"===e.data.type&&0!==e.data.projection||"depth"===e.data.type&&!e.data.isWorldSpace||"noise"===e.data.type||"displace"===e.data.type}))},e.getHash=function(e){var t="";return e.layers.forEach((function(e){Object.entries(e.data).forEach((function(e){var n=Object(g.a)(e,2),r=n[0],i=n[1];t+="".concat(r).concat(i),Array.isArray(i)?i.forEach((function(e){return t+="".concat(e)})):"object"==typeof i?Object.values(i).forEach((function(e){t+="".concat("number"==typeof e?e.toFixed(4):e)})):t+="".concat(i)}))})),t},e.defaultEmptyData=function(){return{layers:new ny}},e.defaultData=function(){return t("phong",arguments.length>0&&void 0!==arguments[0]?arguments[0]:"layer1",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"layer2")},e.withName=function(e,t){return Object(p.a)(Object(p.a)({},e),{},{name:t})},e.defaultTwoLayerData=t,e.defaultTwoLayerTextureData=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"phong",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layer1",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"layer2",i=Kw.defaultData("texture");Object.assign(i.texture,{image:e});var a=new ny;return a.push({fi:0,data:i,id:n}),a.push({fi:1,data:Kw.defaultData("light",t),id:r}),{layers:a}},e.defaultTwoLayerVideoTextureData=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"phong",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layer1",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"layer2",i=Kw.defaultData("video");Object.assign(i.texture,{video:e});var a=new ny;return a.push({fi:0,data:i,id:n}),a.push({fi:1,data:Kw.defaultData("light",t),id:r}),{layers:a}}}(Qw||(Qw={})),function(e){e.defaultData=function(){return{points:new ny,roundness:0,shapeHoles:[],isClosed:!1}}}(Zw||(Zw={})),function(e){e.is2DParametricMesh=function(e){return"PolygonGeometry"===e||"RectangleGeometry"===e||"StarGeometry"===e||"TriangleGeometry"===e||"EllipseGeometry"===e}}(Jw||(Jw={})),function(e){e.defaultData=function(e){if("RectangleGeometry"===e)return{width:320,height:320,type:e,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("VectorGeometry"===e)return{width:1,height:1,type:e,subdivisions:12,shape:Zw.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("BooleanGeometry"===e)return{type:e,operation:2,width:0,height:0,depth:0,phongAngle:35};if("TextGeometry"===e)return{type:e,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:"",textTransform:1,font:"Roboto_regular",extrudeBevelSize:0,extrudeBevelSegments:1};throw new Error("not implemented")}}($w||($w={})),function(e){e.isComponentRelated=function(e){return"Component"===e||"Instance"===e},e.isEmptyOrComponent=function(e){return"Empty"===e||"Instance"===e}}(ex||(ex={})),function(e){e.identity=Object(p.a)(Object(p.a)({},jw.identity),{},{hiddenMatrix:Ow.identity}),e.fromObject=function(e){return{position:e.position,rotation:e.rotation,scale:e.scale,hiddenMatrix:e.hiddenMatrix}},e.merge=function(e,t){return{position:(null===t||void 0===t?void 0:t.position)||e.position,rotation:(null===t||void 0===t?void 0:t.rotation)||e.rotation,scale:(null===t||void 0===t?void 0:t.scale)||e.scale,hiddenMatrix:(null===t||void 0===t?void 0:t.hiddenMatrix)||e.hiddenMatrix}},e.diff=function(e,t){return{position:bw.isEqual(e.position,t.position)?null:t.position,rotation:bw.isEqual(e.rotation,t.rotation)?null:t.rotation,scale:bw.isEqual(e.scale,t.scale)?null:t.scale,hiddenMatrix:Ow.isEqual(e.hiddenMatrix,t.hiddenMatrix)?null:t.hiddenMatrix}}}(tx||(tx={})),function(e){e.defaultData={fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]}}(nx||(nx={})),function(e){e.defaultData=Object(p.a)(Object(p.a)({states:new ny,events:new ny,visible:!0,raycastLock:!1,physics:null},tx.identity),{},{cloner:null})}(rx||(rx={})),function(e){e.defaultData=Object(p.a)({type:"Empty"},rx.defaultData)}(ix||(ix={})),function(e){e.defaultData=Object(p.a)({type:"Component"},rx.defaultData)}(ax||(ax={})),function(e){e.defaultData=Object(p.a)(Object(p.a)({type:"Mesh"},rx.defaultData),zw.defaultData)}(ox||(ox={})),function(e){e.defaultData=Object(p.a)(Object(p.a)(Object(p.a)({},rx.defaultData),tx.identity),Dw.defaultData)}(sx||(sx={})),function(e){e.defaultData=function(e){return Object(p.a)(Object(p.a)({},rx.defaultData),Bw.defaultData(e))}}(ux||(ux={})),function(e){function t(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n<t.length;){var r=e?e[t[n]]:void 0;if(t.length===n+1)return r;if(!r)return;e=r.descendants,n+=1}}e.resolveWithDes=t,e.resolve=function(e,n){var r=t(e,n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);if(r){var i=Object.keys(r);if(1===i.length&&"descendants"===i[0])return}return r}}(cx||(cx={})),function(e){function t(e,t){return Object(p.a)(Object(p.a)(Object(p.a)({},rx.defaultData),t),{},{component:e,overrides:new cy,physics:void 0,type:"Instance"})}e.rootOverrideProps=["physics"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"],e.ofComponent=t,e.fromComponentData=function(e){var n=tx.fromObject(e.data);return t(e.id,n)}}(lx||(lx={})),(dx=hx||(hx={})).defaultCamera=Object(p.a)({position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:Ow.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:nx.defaultData,states:new ny,events:new ny,cloner:null},Dw.defaultData),dx.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},dx.defaultMeshObject=Object(p.a)(Object(p.a)(Object(p.a)({name:"Rectangle"},rx.defaultData),ox.defaultData),{},{geometry:$w.defaultData("RectangleGeometry"),material:Qw.defaultTwoLayerData("phong","layer1","layer2")}),dx.defaultBooleanObject=Object(p.a)(Object(p.a)(Object(p.a)({name:"Boolean"},rx.defaultData),ox.defaultData),{},{geometry:$w.defaultData("BooleanGeometry"),material:Qw.defaultTwoLayerData("phong","layer1","layer2")}),dx.defaultTextObject=Object(p.a)(Object(p.a)(Object(p.a)({name:"Text"},rx.defaultData),ox.defaultData),{},{geometry:$w.defaultData("TextGeometry"),material:Qw.defaultTwoLayerData("phong","layer1","layer2")}),function(e){e.newEmpty=function(e,t){var n={name:t};return"Mesh"===e.type?(n.geometry={},"material"in e&&(n.material={layers:new cy}),"materials"in e&&(n.materials=e.materials.map((function(e){return{layers:new cy}})))):Cw.is(e.type)&&(n.perspective={},n.orthographic={}),n},e.toOps=function(e,t){var n,r=[],i={orthographic:0,perspective:0,geometry:0};function a(e,t){for(var n=0,i=Object.entries(t.layers);n<i.length;n++){var a=Object(g.a)(i[n],2),o=a[0],s=a[1],u=s.texture,c=Object(h.a)(s,M);if(void 0!==u&&Object.keys(u).length>0){var l={path:[].concat(Object(v.a)(e),["layers",o,"texture"]),props:u,type:0};r.push(l)}if(Object.keys(c).length>0){var d={path:[].concat(Object(v.a)(e),["layers",o]),props:c,type:0};r.push(d)}}}for(var o=0,s=Object.entries(t);o<s.length;o++){var u=Object(g.a)(s[o],2),c=u[0],l=u[1];if("name"!==c)if("cloner"===c)r.push.apply(r,Object(v.a)(Pw.toOps(l,["cloner"])));else if("material"===c)a(["material"],l);else if("materials"===c)for(var d=0,f=Object.entries(l);d<f.length;d++){var p=Object(g.a)(f[d],2);a(["materials",p[0]],p[1])}else if(0===i[c]){if(Object.keys(l).length>0){var m={path:[c],props:l,type:0};r.push(m)}}else void 0===n&&(n={path:[],props:{},type:0},r.push(n)),n.props[c]=l}return r},e.patch=function(e,t){if(void 0===t)return e;var n=Object(p.a)({},e);if(Object.assign(n,tx.merge(n,t)),Cw.is(e.type)){var r,i;n.orthographic=Object(p.a)({},n.orthographic),n.perspective=Object(p.a)({},n.perspective);var a=t;void 0!==(null===(r=a.orthographic)||void 0===r?void 0:r.zoom)&&(n.orthographic.zoom=a.orthographic.zoom),void 0!==(null===(i=a.perspective)||void 0===i?void 0:i.zoom)&&(n.perspective.zoom=a.perspective.zoom),void 0!==a.isUpVectorFlipped&&(n.isUpVectorFlipped=a.isUpVectorFlipped),void 0!==a.targetOffset&&(n.targetOffset=a.targetOffset)}else if("Mesh"===e.type)t.geometry&&(n.geometry=Object(p.a)({},n.geometry),Object.assign(n.geometry,t.geometry)),(t.material||t.materials)&&(n=function(e,t){if(void 0===t)return e;var n=Object(p.a)({},e);return"material"in n&&"material"in t&&t.material&&(n.material=Py(n.material,(function(e){if("string"!=typeof e)for(var n=0,r=Object.entries(t.material.layers);n<r.length;n++){var i=Object(g.a)(r[n],2),a=i[0],o=i[1],s=e.layers.data(a);s&&Kw.patch(s,o)}})).data),n.materials&&t.materials&&(n.materials=Py(n.materials,(function(e){for(var r=0;r<n.materials.length;r++){var i=t.materials[r];if("string"!=typeof i)for(var a=0,o=Object.entries(i.layers);a<o.length;a++){var s,u,c=Object(g.a)(o[a],2),l=c[0],h=c[1],d=null===(s=e[r])||void 0===s||null===(u=s.layers)||void 0===u?void 0:u.data(l);d&&Kw.patch(d,h)}}})).data),n}(n,t)),n.cloner&&"cloner"in t&&Object.assign(n,{cloner:Iw.merge(n.cloner,t.cloner)});else if("Empty"===e.type)n.cloner&&"cloner"in t&&Object.assign(n,{cloner:Iw.merge(n.cloner,t.cloner)});else if(Nw.is(e.type)){var o=t;void 0!==o.intensity&&(n.intensity=o.intensity),void 0!==o.color&&("string"==typeof o.color?n.color=o.color:n.color=_w.clone(o.color))}return n}}(fx||(fx={})),function(e){e.defaultData={enabled:!1,useBackgroundColor:!1,color:_w.white,near:.1,far:2e3}}(px||(px={})),function(e){e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0,autoZoom:!1}}(vx||(vx={})),function(e){e.defaultData={orbitControls:vx.defaultData,playCamera:null,withBackground:!0,preventScroll:!1,hideCursor:!1,settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:typeof window<"u"?Math.floor(window.devicePixelRatio):1,stopMode:"manual",duration:5e3},web:{compress:!0,preset:1,preload:!0}},stopRaycast:!0,joystickSizeAndXYOffset:Array(12).fill(0).map((function(e,t){var n=0,r=0;return t<5?r=-30:t<10&&(r=30),0===t||10===t||5===t?n=30:(4===t||11===t||9===t)&&(n=-30),[120,[n,r],"show"]})),gameControlObject:null}}(mx||(mx={}));!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().includes(" electron/");var wx=!(typeof window>"u")&&window.navigator.platform.toUpperCase().includes("MAC"),xx=!(typeof window>"u")&&(/iPad|iPhone|iPod/.test(window.navigator.userAgent)||wx&&"ontouchend"in document),Ox=!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,kx=!(typeof window>"u")&&("ontouchstart"in window||navigator.maxTouchPoints>0),_x=function(){if(typeof window>"u")return!1;var e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)}(),Sx=Number(function(){if(typeof window>"u")return null;var e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]}());function Ex(e){return Array.isArray(e)?e:[e]}function Ax(e){return wx?e.metaKey:e.ctrlKey}var jx,Tx,Mx,Cx=[],Dx={},Ix={},Px={};function Rx(e){Cx.includes(e)||Cx.push(e)}function Lx(e){delete Dx[e.pointerId];for(var t=0;t<Cx.length;t++)if(Cx[t].pointerId===e.pointerId){Cx.splice(t,1);break}}function Nx(e){if("touch"===e.pointerType){var t=Dx[e.pointerId];void 0===t&&(t={x:0,y:0},Dx[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}}function Bx(e){var t=e.pointerId===Cx[0].pointerId?Cx[1]:Cx[0];return Dx[t.pointerId]}function Fx(e){Ix[e.key]=!0,Px[e.key]=void 0===Px[e.key]?1:Px[e.key]+1}function Ux(e){if(wx&&Ix.Meta)for(var t in Ix)Ix[t]=!1;else Ix[e.key]=!1;Px={}}function zx(e){e.layers.forEach((function(e){if("depth"===e.type&&void 0!==e.colorA){for(var t=e.colorA,n=e.colorB,r=[[t.r,t.g,t.b,t.a],[n.r,n.g,n.b,n.a]],i=[0,1],a=2;a<10;a++)r.push(r[1]),i.push(1);var o=Object(p.a)(Object(p.a)({},zg(Ry(e),"type","visible","isVector","isWorldSpace","origin","alpha","mode")),{},{near:Math.max(0,e.near),far:Math.max(0,e.far),colors:r,steps:i,num:2,direction:[1,0,0],smooth:!1,gradientType:1});Object.assign(e,o)}else if("depth"===e.type&&1===e.gradientType&&(e.near<0||e.far<0)){var s=Object(p.a)(Object(p.a)({},Ry(e)),{},{near:Math.max(e.near,0),far:Math.max(e.far,0)});Object.assign(e,s)}}))}function Vx(e,t){Object.values(e.shared.materials).forEach((function(e){return t(e)}))}function Gx(e,t){e.scene.objects.traverse((function(e,n){"materials"in n?n.materials.forEach((function(e){"string"!=typeof e&&t(e)})):"material"in n&&"string"!=typeof n.material&&t(n.material)}))}function Hx(e){void 0===e.layers&&Object.assign(e,Qw.defaultTwoLayerData("lambert"))}function Wx(e){!e.layers||e.layers.forEach((function(e){if("depth"===e.type&&10===e.colors.length){var t=Object(v.a)(e.colors);t.push(e.colors[9]);var n=Object(v.a)(e.steps);n.push(e.steps[9]);var r=Object(p.a)(Object(p.a)({},Ry(e)),{},{colors:t,steps:n});Object.assign(e,r)}}))}function qx(e){e.scene.objects.traverse((function(e,t){"materials"in t?t.materials.forEach((function(e){"string"!=typeof e&&Wx(e)})):"material"in t&&"string"!=typeof t.material&&Wx(t.material)})),Object.values(e.shared.materials).forEach((function(e){return Wx(e)}))}function Yx(e){e.layers&&e.layers.forEach((function(e){"depth"===e.type&&void 0!==e.num&&(e.colors=e.colors.slice(0,e.num),e.steps=e.steps.slice(0,e.num),delete e.num)}))}function Xx(e){var t,n=null===(t=e.layers.find((function(e){return"light"===e.type})))||void 0===t?void 0:t.data;if("basic"===(null===n||void 0===n?void 0:n.category)){var r=Kw.defaultData("light","phong"),i=n;Object.assign(i,r),i.visible=!1}}function Kx(e){Vx(e,Xx),Gx(e,Xx)}!function(e){e.defaultData={ambientLight:{enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75,depth:100,groundColor:{r:.5098039215686274,g:.5098039215686274,b:.5098039215686274},softShadows:!0,softShadowQuality:"low"},usePhysics:!1,gravity:-10,pixelsPerMeter:200,skinWidthRelative:.02,stepThreshRelative:.3,slopeThresh:65}}(jx||(jx={})),function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{withLight:!0,withSquare:!0},t=new ty,n=hx.defaultMeshObject;return!0===e.withLight&&t.push({fi:-1,data:Object(p.a)(Object(p.a)({},ux.defaultData("DirectionalLight")),{},{position:[200,300,300],name:"Directional Light",intensity:.7}),id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]}),!0===e.withSquare&&t.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:n,children:[]}),t}function n(t){return Object(p.a)(Object(p.a)({},e.defaultData),{},{objects:bx(t,ty.prototype)})}e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",e.defaultData={backgroundColor:Ew.fromHexAndA(1908256,1),postprocessing:Lw.defaultData,fog:px.defaultData,objects:t(),environment:jx.defaultData,publish:mx.defaultData},e.emptyData=function(e){return{backgroundColor:Ew.fromHexAndA(1908256,1),postprocessing:Lw.defaultData,fog:px.defaultData,objects:e?t(e):new ty,environment:jx.defaultData,publish:mx.defaultData}},e.withObjs=n,e.withObj=function(e,t){return n([{id:e,data:t,children:[],fi:0}])}}(Tx||(Tx={})),function(e){e.defaultColors=function(){var e={"89b10010-844c-11ec-a8a3-0242ac120002":{r:.5,g:.5,b:.5,a:1,name:"Default Color"}};return bx(e,qg.prototype)},e.emptyData=function(){return{materials:new qg,images:new qg,videos:new qg,colors:new qg,audios:new qg,fonts:new qg,penumbraSize:[.5,.5,.5]}}}(Mx||(Mx={}));var Qx,Zx,Jx=31;function $x(e){var t,n=null!==(t=e.schema)&&void 0!==t?t:0;n!==Jx&&(console.warn("updating from ",n,"to ",Jx),n<1&&(Gx(e,zx),Vx(e,zx),e.schema=1),n<2&&(function(e){Object.assign(e.scene.publish,{orbitControls:Object(p.a)(Object(p.a)({},vx.defaultData),Ry(e.scene.publish.orbitControls))})}(e),e.schema=2),n<3&&(function(e){function t(e){if(e.layers)for(var t=0,n=Object.values(e.layers);t<n.length;t++){var r=n[t];if(r)for(var i=0,a=Object.entries(r);i<a.length;i++){var o=Object(g.a)(a[i],2),s=o[0],u=o[1];if((gx.includes(s)||"boolean"==typeof u)&&delete r[s],"texture"===s)for(var c=0,l=Object.entries(u);c<l.length;c++){var h=Object(g.a)(l[c],2),d=h[0],f=h[1];(yx.includes(d)||"boolean"==typeof f)&&delete u[d]}}}}e.scene.objects.traverse((function(e,n){n.states.forEach((function(e){var n=e;n.material?t(n.material):n.materials&&n.materials.forEach((function(e){t(e)}))}))}))}(e),e.schema=3),n<4&&(function(e){e.scene.publish.withBackground=!0}(e),e.schema=4),n<5&&(function(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1}}(e),e.schema=5),n<6&&(function(e){e.scene.objects.traverse((function(e,t){var n=t.cloner;n&&(n.radial.scale=n.radial.scale.map((function(e){return e+1})),n.linear.scale=n.linear.scale.map((function(e){return e+1})))}))}(e),e.schema=6),n<7&&(function(e){e.scene.objects.traverse((function(e,t){var n=t.geometry;n&&("DodecahedronGeometry"===n.type||"IcosahedronGeometry"===n.type)&&(n.detail=Math.round(n.detail))}))}(e),e.schema=7),n<8&&(e.schema=8),n<9&&(qx(e),e.schema=9),n<10&&(function(e){e.scene.objects.traverse((function(e,t){"Mesh"===t.type&&("BooleanGeometry"===t.geometry.type||"SubdivGeometry"===t.geometry.type)&&(t.geometry.phongAngle=35)}))}(e),e.schema=10),n<11&&(function(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((function(e,t){("DirectionalLight"===t.type||"SpotLight"===t.type)&&(t.shadowResolution=1024,t.shadowRadius=1,t.depth=1e5)})),e.shared.penumbraSize=new Array(5).fill(.5)}(e),e.schema=11),n<12&&(qx(e),e.schema=12),n<13&&(function(e){e.shared.audios=bx({},qg.prototype)}(e),e.schema=13),n<14&&(function(e){var t=e.shared.materials;Object.entries(t).forEach((function(e){var n=Object(g.a)(e,2),r=n[0];n[1].layers||Object.assign(t,Object(_.a)({},r,{name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]}))}))}(e),e.schema=14),n<15&&(function(e){Object.entries(Ry(e.shared.images)).filter((function(e){return!1===e[1].asset})).map((function(e){return e[0]})).forEach((function(t){delete e.shared.images[t]})),Object.entries(Ry(e.shared.audios)).filter((function(e){return!1===e[1].asset})).map((function(e){return e[0]})).forEach((function(t){delete e.shared.audios[t]}))}(e),e.schema=15),n<16&&(function(e){e.scene.publish.settings.web.preload=!1}(e),e.schema=16),n<17&&(Gx(e,Yx),Vx(e,Yx),e.schema=17),n<18&&(Gx(e,Hx),Vx(e,Hx),e.schema=18),n<19&&(function(e){Object.assign(e.scene.publish.settings,{video:Object(p.a)(Object(p.a)({},mx.defaultData.settings.video),Ry(e.scene.publish.settings.video))})}(e),e.schema=19),n<20&&(function(e){e.shared.fonts=bx({},qg.prototype)}(e),function(e){var t=[];e.scene.objects.traverse((function(n,r){var i=r;if("TextFrame"===i.type){var a=Qw.defaultTwoLayerData("phong"),o="string"==typeof i.color?e.shared.colors[i.color]:i.color;a.layers[1].data.color={r:o.r,g:o.g,b:o.b},a.layers[1].data.alpha=i.alpha;var s=function(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join(" ")}(i.font);void 0===e.shared.fonts[s]&&(e.shared.fonts[s]={name:s});var u=Object(p.a)(Object(p.a)(Object(p.a)({name:i.name},rx.defaultData),ox.defaultData),{},{flatShading:!1,wireframe:!1,geometry:Object(p.a)(Object(p.a)({},$w.defaultData("TextGeometry")),{},{width:i.width,height:i.height,font:s,depth:0,horizontalAlign:i.horizontalAlign,verticalAlign:i.verticalAlign,fontSize:1.40625*i.fontSize,lineHeight:i.lineHeight/1.40625,letterSpacing:i.letterSpacing-1,text:i.text,textTransform:i.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1}),material:a,states:Ry(i.states),events:Ry(i.events),visible:i.visible,raycastLock:i.raycastLock,position:i.position,rotation:i.rotation,scale:i.scale,hiddenMatrix:i.hiddenMatrix}),c=Ry(e.scene.objects).parent(n);e.scene.objects.insertAfter(null!==c&&void 0!==c?c:null,n,[{id:n+"new",data:u,children:[]}]),t.push(n)}})),t.forEach((function(t){e.scene.objects.delete(t)}))}(e),e.schema=20),n<21&&(function(e){var t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((function(e,n){n.events.forEach((function(e){if(t[Number(e.type)])if(Object.assign(e,{type:t[Number(e.type)]}),"Audio"===e.type&&"audioEvent"in e&&(Object.assign(e,{playAudio:e.audioEvent}),delete e.audioEvent),"GameControl"===e.type)Object.assign(e,{gameActions:{idle:new ny,move:new ny,jump:new ny}});else{var n=new ny;Object.assign(e,{actions:n}),("MouseDown"===e.type||"MouseUp"===e.type||"KeyDown"===e.type||"KeyUp"===e.type)&&"url"in e&&n.push({fi:0,id:En.generateUUID(),data:{type:"Link",url:e.url,delay:0}}),"targets"in e&&(e.targets.forEach((function(e,t,r){var i={easing:e.easing,duration:e.duration};6===e.easing?Object.assign(i,zg(e,"mass","stiffness","damping","velocity")):5===e.easing&&Object.assign(i,{control1:Object(p.a)({},e.control1),control2:Object(p.a)({},e.control2)});var a={repeat:e.repeat?-1:0,delay:e.delay,delayDirection:e.delayDirection,direction:e.cycle&&e.rewind?"pingpong-rewind":e.cycle?"pingpong":"normal"},o=Object(p.a)(Object(p.a)({state:e.state},a),i),s={allowSlerp:!0,type:"Transition",object:e.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new ny({fi:0,id:En.generateUUID(),data:{state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4}},{fi:1,id:En.generateUUID(),data:o})};n.push({fi:r,id:t,data:s})})),delete e.targets)}}))}))}(e),function(e){e.scene.objects.traverse((function(e,t){function n(e,n){var r=new ny,i=[];if(t.events.forEach((function(e,t,a){var o;"Audio"===e.type&&e.trigger===n&&(i.push(t),"play"===e.interaction?o=Object(p.a)(Object(p.a)({},zg(e,"interaction","audio","delay","volume","loop")),{},{triggerAfter:"after"in e?e.after:void 0,toggle:"after"in e?e.toggle:void 0,type:"Audio"}):("pause"===e.interaction||"stop"===e.interaction)&&(o=Object(p.a)(Object(p.a)({},zg(e,"interaction","delay","object","playAudio")),{},{type:"Audio"})),o&&r.push({fi:a,id:t,data:o}))})),i.forEach((function(e){return t.events.delete(e)})),r.length){var a,o=null===(a=t.events.find((function(t){return t.type===e})))||void 0===a?void 0:a.data;o?"actions"in o&&o.actions.insertBefore(null,r):t.events.insertBefore(null,[{id:En.generateUUID(),data:{type:e,actions:r}}])}}n("Start","start"),n("MouseDown","mouseDown"),n("MouseUp","mouseUp"),n("KeyDown","keyDown"),n("KeyUp","keyUp")}))}(e),e.schema=21),n<22&&(Kx(e),e.schema=22),n<23&&(function(e){e.scene.objects.traverse((function(e,t){"Mesh"===t.type&&"SubdivGeometry"===t.geometry.type&&(t.geometry.scaleBaked||(t.geometry.scaleBaked=[1,1,1]))}))}(e),e.schema=23),n<24&&(function(e){e.scene.objects.traverse((function(e,t){("Empty"===t.type||"Mesh"===t.type)&&t.cloner&&!t.cloner.randomnessObject&&!t.cloner.toObject&&!t.cloner.randomness&&(t.cloner=Object(p.a)(Object(p.a)({},t.cloner),{},{toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}))}))}(e),e.schema=24),(n<25||void 0===e.shared.videos)&&(function(e){e.shared.videos=bx({},qg.prototype)}(e),n<25&&(e.schema=25)),n<26&&(function(e){e.scene.objects.traverse((function(t,n){var r=e.scene.objects.unproxy().parent(t);if(r){var i=Ry(e.scene.objects.data(r));i&&"Mesh"===i.type&&"BooleanGeometry"===i.geometry.type&&"Mesh"===n.type&&(n.visible=!0!==Ry(n).booleanExclude)}}))}(e),e.schema=26),n<27&&(function(e){e.scene.objects.traverse((function(e,t){if("Mesh"===t.type){var n=t;"NonParametricGeometry"===t.geometry.type?void 0!==n.material&&delete n.material:void 0!==n.materials&&delete n.materials}}))}(e),e.schema=27),n<28&&(Kx(e),e.schema=28),n<29&&(function(e){function t(e){Object.setPrototypeOf(e,cy.prototype),e.texture&&Object.setPrototypeOf(e.texture,cy.prototype)}function n(e){for(var n in Object.setPrototypeOf(e,cy.prototype),e)t(e[n])}e.scene.objects.traverse((function(e,t){t.states.forEach((function(e){var t=e;if(t.material){var r=Ry(t.material).layers;n(r),t.material.layers=r}if(t.materials)for(var i=0;i<t.materials.length;i++){var a=t.materials[i],o=Ry(a).layers;n(o),a.layers=o}}))}))}(e),e.schema=29),n<30&&(function(e){e.scene.objects.traverse((function(e,t){"Mesh"===t.type&&"NonParametricGeometry"===t.geometry.type&&!("material"in t)&&!("materials"in t)&&(t.material=Qw.defaultTwoLayerData("phong"))}))}(e),e.schema=30),n<31&&(function(e){void 0===e.scene.publish.orbitControls.autoZoom&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse((function(e,t){("OrthographicCamera"===t.type||"PerspectiveCamera"===t.type)&&(void 0===t.orthographic.autoZoom&&(t.orthographic.autoZoom=!1),void 0===t.orthographic.autoZoomFrustumSize&&(t.orthographic.autoZoomFrustumSize=790))}))}(e),e.schema=31))}function eO(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),a={},o={},s=e[0].morphTargetsRelative,u=new Di,c=0,l=0;l<e.length;++l){var h=e[l],d=0;if(n!==(null!==h.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+l+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(var f in h.attributes){if(!r.has(f))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+l+'. All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.'),null;void 0===a[f]&&(a[f]=[]),a[f].push(h.attributes[f]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+l+". Make sure all geometries have the same number of attributes."),null;if(s!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+l+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(var p in h.morphAttributes){if(!i.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+l+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===o[p]&&(o[p]=[]),o[p].push(h.morphAttributes[p])}if(u.userData.mergedUserData=u.userData.mergedUserData||[],u.userData.mergedUserData.push(h.userData),t){var v=void 0;if(n)v=h.index.count;else{if(void 0===h.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+l+". The geometry must have either an index or a position attribute"),null;v=h.attributes.position.count}u.addGroup(c,v,l),c+=v}}if(n){for(var m=0,g=[],y=0;y<e.length;++y){for(var b=e[y].index,w=0;w<b.count;++w)g.push(b.getX(w)+m);m+=e[y].attributes.position.count}u.setIndex(g)}for(var x in a){var O=tO(a[x]);if(!O)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+x+" attribute."),null;u.setAttribute(x,O)}for(var k in o){var _=o[k][0].length;if(0===_)break;u.morphAttributes=u.morphAttributes||{},u.morphAttributes[k]=[];for(var S=0;S<_;++S){for(var E=[],A=0;A<o[k].length;++A)E.push(o[k][A][S]);var j=tO(E);if(!j)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+k+" morphAttribute."),null;u.morphAttributes[k].push(j)}}return u}function tO(e){for(var t,n,r,i=0,a=0;a<e.length;++a){var o=e[a];if(o.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===n&&(n=o.itemSize),n!==o.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=o.normalized),r!==o.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;i+=o.array.length}for(var s=new t(i),u=0,c=0;c<e.length;++c)s.set(e[c].array,u),u+=e[c].array.length;return new wi(s,n,r)}!function(e){e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII="}}(Qx||(Qx={})),function(e){e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",speedTranslate:1e3,speedRotate:100,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","\u25b2"],["rotPosY","\u25c0"],["rotNegX","\u25bc"],["rotNegY","\u25b6"],["jump","Space"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:-3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new ny,move:new ny,jump:new ny}}}(Zx||(Zx={}));var nO=Math.pow(2,-24),rO=Object(A.a)((function e(){Object(E.a)(this,e)}));function iO(e,t,n){return n.min.x=t[e],n.min.y=t[e+1],n.min.z=t[e+2],n.max.x=t[e+3],n.max.y=t[e+4],n.max.z=t[e+5],n}function aO(e){for(var t=-1,n=-1/0,r=0;r<3;r++){var i=e[r+3]-e[r];i>n&&(n=i,t=r)}return t}function oO(e,t){t.set(e)}function sO(e,t,n){for(var r,i,a=0;a<3;a++){var o=a+3;r=e[a],i=t[a],n[a]=r<i?r:i,r=e[o],i=t[o],n[o]=r>i?r:i}}function uO(e,t,n){for(var r=0;r<3;r++){var i=t[e+2*r],a=t[e+2*r+1],o=i-a,s=i+a;o<n[r]&&(n[r]=o),s>n[r+3]&&(n[r+3]=s)}}function cO(e){var t=e[3]-e[0],n=e[4]-e[1],r=e[5]-e[2];return 2*(t*n+n*r+r*t)}function lO(e,t,n,r){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=1/0,o=1/0,s=1/0,u=-1/0,c=-1/0,l=-1/0,h=1/0,d=1/0,f=1/0,p=-1/0,v=-1/0,m=-1/0,g=null!==i,y=6*t,b=6*(t+n);y<b;y+=6){var w=e[y+0],x=e[y+1],O=w-x,k=w+x;O<a&&(a=O),k>u&&(u=k),g&&w<h&&(h=w),g&&w>p&&(p=w);var _=e[y+2],S=e[y+3],E=_-S,A=_+S;E<o&&(o=E),A>c&&(c=A),g&&_<d&&(d=_),g&&_>v&&(v=_);var j=e[y+4],T=e[y+5],M=j-T,C=j+T;M<s&&(s=M),C>l&&(l=C),g&&j<f&&(f=j),g&&j>m&&(m=j)}r[0]=a,r[1]=o,r[2]=s,r[3]=u,r[4]=c,r[5]=l,g&&(i[0]=h,i[1]=d,i[2]=f,i[3]=p,i[4]=v,i[5]=m)}var hO=32,dO=function(e,t){return e.candidate-t.candidate},fO=new Array(hO).fill().map((function(){return{count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}})),pO=new Float32Array(6);function vO(e,t){function n(e){d&&d(e/f)}function r(t,i,d){var f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!p&&m>=u&&(p=!0,c&&(console.warn("MeshBVH: Max depth of ".concat(u," reached when generating BVH. Consider increasing maxDepth.")),console.warn(e))),d<=l||m>=u)return n(i+d),t.offset=i,t.count=d,t;var g=function(e,t,n,r,i,a){var o=-1,s=0;if(0===a)-1!==(o=aO(t))&&(s=(t[o]+t[o+3])/2);else if(1===a)-1!==(o=aO(e))&&(s=function(e,t,n,r){for(var i=0,a=t,o=t+n;a<o;a++)i+=e[6*a+2*r];return i/n}(n,r,i,o));else if(2===a)for(var u=cO(e),c=1.25*i,l=6*r,h=6*(r+i),d=0;d<3;d++){var f=t[d],p=(t[d+3]-f)/hO;if(i<hO/4){var m=Object(v.a)(fO);m.length=i;for(var g=0,y=l;y<h;y+=6,g++){var b=m[g];b.candidate=n[y+2*d],b.count=0;for(var w=b.bounds,x=b.leftCacheBounds,O=b.rightCacheBounds,k=0;k<3;k++)O[k]=1/0,O[k+3]=-1/0,x[k]=1/0,x[k+3]=-1/0,w[k]=1/0,w[k+3]=-1/0;uO(y,n,w)}m.sort(dO);for(var _=i,S=0;S<_;S++)for(var E=m[S];S+1<_&&m[S+1].candidate===E.candidate;)m.splice(S+1,1),_--;for(var A=l;A<h;A+=6)for(var j=n[A+2*d],T=0;T<_;T++){var M=m[T];j>=M.candidate?uO(A,n,M.rightCacheBounds):(uO(A,n,M.leftCacheBounds),M.count++)}for(var C=0;C<_;C++){var D=m[C],I=D.count,P=i-D.count,R=D.leftCacheBounds,L=D.rightCacheBounds,N=0;0!==I&&(N=cO(R)/u);var B=0;0!==P&&(B=cO(L)/u);var F=1+1.25*(N*I+B*P);F<c&&(o=d,c=F,s=D.candidate)}}else{for(var U=0;U<hO;U++){var z=fO[U];z.count=0,z.candidate=f+p+U*p;for(var V=z.bounds,G=0;G<3;G++)V[G]=1/0,V[G+3]=-1/0}for(var H=l;H<h;H+=6){var W=~~((n[H+2*d]-f)/p);W>=hO&&(W=hO-1);var q=fO[W];q.count++,uO(H,n,q.bounds)}var Y=fO[hO-1];oO(Y.bounds,Y.rightCacheBounds);for(var X=hO-2;X>=0;X--){var K=fO[X],Q=fO[X+1];sO(K.bounds,Q.rightCacheBounds,K.rightCacheBounds)}for(var Z=0,J=0;J<hO-1;J++){var $=fO[J],ee=$.count,te=$.bounds,ne=fO[J+1].rightCacheBounds;0!==ee&&(0===Z?oO(te,pO):sO(te,pO,pO));var re=0,ie=0;0!==(Z+=ee)&&(re=cO(pO)/u);var ae=i-Z;0!==ae&&(ie=cO(ne)/u);var oe=1+1.25*(re*Z+ie*ae);oe<c&&(o=d,c=oe,s=$.candidate)}}}else console.warn("MeshBVH: Invalid build strategy value ".concat(a," used."));return{axis:o,pos:s}}(t.boundingData,f,o,i,d,h);if(-1===g.axis)return n(i+d),t.offset=i,t.count=d,t;var y=function(e,t,n,r,i){for(var a=n,o=n+r-1,s=i.pos,u=2*i.axis;;){for(;a<=o&&t[6*a+u]<s;)a++;for(;a<=o&&t[6*o+u]>=s;)o--;if(!(a<o))return a;for(var c=0;c<3;c++){var l=e[3*a+c];e[3*a+c]=e[3*o+c],e[3*o+c]=l;var h=t[6*a+2*c+0];t[6*a+2*c+0]=t[6*o+2*c+0],t[6*o+2*c+0]=h;var d=t[6*a+2*c+1];t[6*a+2*c+1]=t[6*o+2*c+1],t[6*o+2*c+1]=d}a++,o--}}(s,o,i,d,g);if(y===i||y===i+d)n(i+d),t.offset=i,t.count=d;else{t.splitAxis=g.axis;var b=new rO,w=i,x=y-i;t.left=b,b.boundingData=new Float32Array(6),lO(o,w,x,b.boundingData,a),r(b,w,x,a,m+1);var O=new rO,k=y,_=d-x;t.right=O,O.boundingData=new Float32Array(6),lO(o,k,_,O.boundingData,a),r(O,k,_,a,m+1)}return t}!function(e,t){if(!e.index){var n,r=e.attributes.position.count,i=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;n=r>65535?new Uint32Array(new i(4*r)):new Uint16Array(new i(2*r)),e.setIndex(new wi(n,1));for(var a=0;a<r;a++)n[a]=a}}(e,t);var i=new Float32Array(6),a=new Float32Array(6),o=function(e,t){var n=e.attributes.position,r=n.array,i=e.index.array,a=i.length/3,o=new Float32Array(6*a),s=n.offset||0,u=3;n.isInterleavedBufferAttribute&&(u=n.data.stride);for(var c=0;c<a;c++)for(var l=3*c,h=6*c,d=i[l+0]*u+s,f=i[l+1]*u+s,p=i[l+2]*u+s,v=0;v<3;v++){var m=r[d+v],g=r[f+v],y=r[p+v],b=m;g<b&&(b=g),y<b&&(b=y);var w=m;g>w&&(w=g),y>w&&(w=y);var x=(w-b)/2,O=2*v;o[h+O+0]=b+x,o[h+O+1]=x+(Math.abs(b)+x)*nO,b<t[v]&&(t[v]=b),w>t[v+3]&&(t[v+3]=w)}return o}(e,i),s=e.index.array,u=t.maxDepth,c=t.verbose,l=t.maxLeafTris,h=t.strategy,d=t.onProgress,f=e.index.count/3,p=!1,m=[],g=function(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];var t,n=[],r=new Set,i=Object(j.a)(e.groups);try{for(i.s();!(t=i.n()).done;){var a=t.value;r.add(a.start),r.add(a.start+a.count)}}catch(l){i.e(l)}finally{i.f()}for(var o=Array.from(r.values()).sort((function(e,t){return e-t})),s=0;s<o.length-1;s++){var u=o[s],c=o[s+1];n.push({offset:u/3,count:(c-u)/3})}return n}(e);if(1===g.length){var y=g[0],b=new rO;b.boundingData=i,function(e,t,n,r){for(var i=1/0,a=1/0,o=1/0,s=-1/0,u=-1/0,c=-1/0,l=6*t,h=6*(t+n);l<h;l+=6){var d=e[l+0];d<i&&(i=d),d>s&&(s=d);var f=e[l+2];f<a&&(a=f),f>u&&(u=f);var p=e[l+4];p<o&&(o=p),p>c&&(c=p)}r[0]=i,r[1]=a,r[2]=o,r[3]=s,r[4]=u,r[5]=c}(o,y.offset,y.count,a),r(b,y.offset,y.count,a),m.push(b)}else{var w,x=Object(j.a)(g);try{for(x.s();!(w=x.n()).done;){var O=w.value,k=new rO;k.boundingData=new Float32Array(6),lO(o,O.offset,O.count,k.boundingData,a),r(k,O.offset,O.count,a),m.push(k)}}catch(_){x.e(_)}finally{x.f()}}return m}var mO=function(){function e(){Object(E.a)(this,e),this.min=1/0,this.max=-1/0}return Object(A.a)(e,[{key:"setFromPointsField",value:function(e,t){for(var n=1/0,r=-1/0,i=0,a=e.length;i<a;i++){var o=e[i][t];n=o<n?o:n,r=o>r?o:r}this.min=n,this.max=r}},{key:"setFromPoints",value:function(e,t){for(var n=1/0,r=-1/0,i=0,a=t.length;i<a;i++){var o=t[i],s=e.dot(o);n=s<n?s:n,r=s>r?s:r}this.min=n,this.max=r}},{key:"isSeparated",value:function(e){return this.min>e.max||e.min>this.max}}]),e}();mO.prototype.setFromBox=function(){var e=new tr;return function(t,n){for(var r=n.min,i=n.max,a=1/0,o=-1/0,s=0;s<=1;s++)for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){e.x=r.x*s+i.x*(1-s),e.y=r.y*u+i.y*(1-u),e.z=r.z*c+i.z*(1-c);var l=t.dot(e);a=Math.min(l,a),o=Math.max(l,o)}this.min=a,this.max=o}}();!function(){var e=new mO}();var gO=function(){var e=new tr,t=new tr,n=new tr;return function(r,i,a){var o=r.start,s=e,u=i.start,c=t;n.subVectors(o,u),e.subVectors(r.end,i.start),t.subVectors(i.end,i.start);var l,h,d=n.dot(c),f=c.dot(s),p=c.dot(c),v=n.dot(s),m=s.dot(s)*p-f*f;h=(d+(l=0!==m?(d*f-v*p)/m:0)*f)/p,a.x=l,a.y=h}}(),yO=function(){var e=new An,t=new tr,n=new tr;return function(r,i,a,o){gO(r,i,e);var s,u,c=e.x,l=e.y;if(c>=0&&c<=1&&l>=0&&l<=1)return r.at(c,a),void i.at(l,o);if(c>=0&&c<=1)return l<0?i.at(0,o):i.at(1,o),void r.closestPointToPoint(o,!0,a);if(l>=0&&l<=1)return c<0?r.at(0,a):r.at(1,a),void i.closestPointToPoint(a,!0,o);s=c<0?r.start:r.end,u=l<0?i.start:i.end;var h=t,d=n;return r.closestPointToPoint(u,!0,t),i.closestPointToPoint(s,!0,n),h.distanceToSquared(u)<=d.distanceToSquared(s)?(a.copy(h),void o.copy(u)):(a.copy(s),void o.copy(d))}}(),bO=function(){var e=new tr,t=new tr,n=new va,r=new Ml;return function(i,a){var o=i.radius,s=i.center,u=a.a,c=a.b,l=a.c;if(r.start=u,r.end=c,r.closestPointToPoint(s,!0,e).distanceTo(s)<=o||(r.start=u,r.end=l,r.closestPointToPoint(s,!0,e).distanceTo(s)<=o)||(r.start=c,r.end=l,r.closestPointToPoint(s,!0,e).distanceTo(s)<=o))return!0;var h=a.getPlane(n);if(Math.abs(h.distanceToPoint(s))<=o){var d=h.projectPoint(s,t);if(a.containsPoint(d))return!0}return!1}}(),wO=1e-15;function xO(e){return Math.abs(e)<wO}var OO=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;Object(E.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).isExtendedTriangle=!0,e.satAxes=new Array(4).fill().map((function(){return new tr})),e.satBounds=new Array(4).fill().map((function(){return new mO})),e.points=[e.a,e.b,e.c],e.sphere=new kr,e.plane=new va,e.needsUpdate=!0,e}return Object(A.a)(n,[{key:"intersectsSphere",value:function(e){return bO(e,this)}},{key:"update",value:function(){var e=this.a,t=this.b,n=this.c,r=this.points,i=this.satAxes,a=this.satBounds,o=i[0],s=a[0];this.getNormal(o),s.setFromPoints(o,r);var u=i[1],c=a[1];u.subVectors(e,t),c.setFromPoints(u,r);var l=i[2],h=a[2];l.subVectors(t,n),h.setFromPoints(l,r);var d=i[3],f=a[3];d.subVectors(n,e),f.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}]),n}(pi);OO.prototype.closestPointToSegment=function(){var e=new tr,t=new tr,n=new Ml;return function(r){for(var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=r.start,u=r.end,c=this.points,l=1/0,h=0;h<3;h++){var d=(h+1)%3;n.start.copy(c[h]),n.end.copy(c[d]),yO(n,r,e,t),(i=e.distanceToSquared(t))<l&&(l=i,a&&a.copy(e),o&&o.copy(t))}return this.closestPointToPoint(s,e),(i=s.distanceToSquared(e))<l&&(l=i,a&&a.copy(e),o&&o.copy(s)),this.closestPointToPoint(u,e),(i=u.distanceToSquared(e))<l&&(l=i,a&&a.copy(e),o&&o.copy(u)),Math.sqrt(l)}}(),OO.prototype.intersectsTriangle=function(){var e=new OO,t=new Array(3),n=new Array(3),r=new mO,i=new mO,a=new tr,o=new tr,s=new tr,u=new tr,c=new Ml,l=new Ml,h=new Ml;return function(d){var f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);var p=this.plane,v=d.plane;if(Math.abs(p.normal.dot(v.normal))>1-1e-10){var m=this.satBounds,g=this.satAxes;n[0]=d.a,n[1]=d.b,n[2]=d.c;for(var y=0;y<4;y++){var b=m[y],w=g[y];if(r.setFromPoints(w,n),b.isSeparated(r))return!1}var x=d.satBounds,O=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(var k=0;k<4;k++){var _=x[k],S=O[k];if(r.setFromPoints(S,t),_.isSeparated(r))return!1}for(var E=0;E<4;E++)for(var A=g[E],j=0;j<4;j++){var T=O[j];if(a.crossVectors(A,T),r.setFromPoints(a,t),i.setFromPoints(a,n),r.isSeparated(i))return!1}return f&&(console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),f.start.set(0,0,0),f.end.set(0,0,0)),!0}for(var M=this.points,C=!1,D=0,I=0;I<3;I++){var P=M[I],R=M[(I+1)%3];c.start.copy(P),c.end.copy(R),c.delta(o);var L=C?l.start:l.end,N=xO(v.distanceToPoint(P));if(xO(v.normal.dot(o))&&N){l.copy(c),D=2;break}if((v.intersectLine(c,L)||N)&&!xO(L.distanceTo(R))){if(D++,C)break;C=!0}}if(1===D&&this.containsPoint(l.start))return f&&(f.start.copy(l.start),f.end.copy(l.start)),!0;if(2!==D)return!1;for(var B=d.points,F=!1,U=0,z=0;z<3;z++){var V=B[z],G=B[(z+1)%3];c.start.copy(V),c.end.copy(G),c.delta(s);var H=F?h.start:h.end,W=xO(p.distanceToPoint(V));if(xO(p.normal.dot(s))&&W){h.copy(c),U=2;break}if((p.intersectLine(c,H)||W)&&!xO(H.distanceTo(G))){if(U++,F)break;F=!0}}if(1===U&&this.containsPoint(h.start))return f&&(f.start.copy(h.start),f.end.copy(h.start)),!0;if(2!==U)return!1;if(l.delta(o),h.delta(s),o.dot(s)<0){var q=h.start;h.start=h.end,h.end=q}var Y=l.start.dot(o),X=l.end.dot(o),K=h.start.dot(o),Q=h.end.dot(o);return(Y===Q||K===X||X<K!==Y<Q)&&(f&&(u.subVectors(l.start,h.start),u.dot(o)>0?f.start.copy(l.start):f.start.copy(h.start),u.subVectors(l.end,h.end),u.dot(o)<0?f.end.copy(l.end):f.end.copy(h.end)),!0)}}(),OO.prototype.distanceToPoint=function(){var e=new tr;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),OO.prototype.distanceToTriangle=function(){var e=new tr,t=new tr,n=["a","b","c"],r=new Ml,i=new Ml;return function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=o||s?r:null;if(this.intersectsTriangle(a,u))return(o||s)&&(o&&u.getCenter(o),s&&u.getCenter(s)),0;for(var c=1/0,l=0;l<3;l++){var h=void 0,d=n[l],f=a[d];this.closestPointToPoint(f,e),(h=f.distanceToSquared(e))<c&&(c=h,o&&o.copy(e),s&&s.copy(f));var p=this[d];a.closestPointToPoint(p,e),(h=p.distanceToSquared(e))<c&&(c=h,o&&o.copy(p),s&&s.copy(e))}for(var v=0;v<3;v++){var m=n[v],g=n[(v+1)%3];r.set(this[m],this[g]);for(var y=0;y<3;y++){var b=n[y],w=n[(y+1)%3];i.set(a[b],a[w]),yO(r,i,e,t);var x=e.distanceToSquared(t);x<c&&(c=x,o&&o.copy(e),s&&s.copy(t))}}return Math.sqrt(c)}}();var kO=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;Object(E.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).isOrientedBox=!0,e.matrix=new Dr,e.invMatrix=new Dr,e.points=new Array(8).fill().map((function(){return new tr})),e.satAxes=new Array(3).fill().map((function(){return new tr})),e.satBounds=new Array(3).fill().map((function(){return new mO})),e.alignedSatBounds=new Array(3).fill().map((function(){return new mO})),e.needsUpdate=!1,e}return Object(A.a)(n,[{key:"set",value:function(e,t,r){Object(b.a)(Object(w.a)(n.prototype),"set",this).call(this,e,t),this.matrix.copy(r),this.needsUpdate=!0}},{key:"copy",value:function(e){Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.matrix.copy(e.matrix),this.needsUpdate=!0}}]),n}(ir);kO.prototype.update=function(){for(var e=this.matrix,t=this.min,n=this.max,r=this.points,i=0;i<=1;i++)for(var a=0;a<=1;a++)for(var o=0;o<=1;o++){var s=r[1*i|2*a|4*o];s.x=i?n.x:t.x,s.y=a?n.y:t.y,s.z=o?n.z:t.z,s.applyMatrix4(e)}for(var u=this.satBounds,c=this.satAxes,l=r[0],h=0;h<3;h++){var d=c[h],f=u[h],p=r[1<<h];d.subVectors(l,p),f.setFromPoints(d,r)}var v=this.alignedSatBounds;v[0].setFromPointsField(r,"x"),v[1].setFromPointsField(r,"y"),v[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},kO.prototype.intersectsBox=function(){var e=new mO;return function(t){this.needsUpdate&&this.update();var n=t.min,r=t.max,i=this.satBounds,a=this.satAxes,o=this.alignedSatBounds;if(e.min=n.x,e.max=r.x,o[0].isSeparated(e)||(e.min=n.y,e.max=r.y,o[1].isSeparated(e))||(e.min=n.z,e.max=r.z,o[2].isSeparated(e)))return!1;for(var s=0;s<3;s++){var u=a[s],c=i[s];if(e.setFromBox(u,t),c.isSeparated(e))return!1}return!0}}(),kO.prototype.intersectsTriangle=function(){var e=new OO,t=new Array(3),n=new mO,r=new mO,i=new tr;return function(a){this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(e.copy(a),e.update(),a=e);var o=this.satBounds,s=this.satAxes;t[0]=a.a,t[1]=a.b,t[2]=a.c;for(var u=0;u<3;u++){var c=o[u],l=s[u];if(n.setFromPoints(l,t),c.isSeparated(n))return!1}for(var h=a.satBounds,d=a.satAxes,f=this.points,p=0;p<3;p++){var v=h[p],m=d[p];if(n.setFromPoints(m,f),v.isSeparated(n))return!1}for(var g=0;g<3;g++)for(var y=s[g],b=0;b<4;b++){var w=d[b];if(i.crossVectors(y,w),n.setFromPoints(i,t),r.setFromPoints(i,f),n.isSeparated(r))return!1}return!0}}(),kO.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},kO.prototype.distanceToPoint=function(){var e=new tr;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),kO.prototype.distanceToBox=function(){var e=["x","y","z"],t=new Array(12).fill().map((function(){return new Ml})),n=new Array(12).fill().map((function(){return new Ml})),r=new tr,i=new tr;return function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.needsUpdate&&this.update(),this.intersectsBox(a))return(s||u)&&(a.getCenter(i),this.closestPointToPoint(i,r),a.closestPointToPoint(r,i),s&&s.copy(r),u&&u.copy(i)),0;for(var c=o*o,l=a.min,h=a.max,d=this.points,f=1/0,p=0;p<8;p++){var v=d[p];i.copy(v).clamp(l,h);var m=v.distanceToSquared(i);if(m<f&&(f=m,s&&s.copy(v),u&&u.copy(i),m<c))return Math.sqrt(m)}for(var g=0,y=0;y<3;y++)for(var b=0;b<=1;b++)for(var w=0;w<=1;w++){var x=(y+1)%3,O=(y+2)%3,k=1<<y|b<<x|w<<O,_=d[b<<x|w<<O],S=d[k];t[g].set(_,S);var E=e[y],A=e[x],j=e[O],T=n[g],M=T.start,C=T.end;M[E]=l[E],M[A]=b?l[A]:h[A],M[j]=w?l[j]:h[A],C[E]=h[E],C[A]=b?l[A]:h[A],C[j]=w?l[j]:h[A],g++}for(var D=0;D<=1;D++)for(var I=0;I<=1;I++)for(var P=0;P<=1;P++){i.x=D?h.x:l.x,i.y=I?h.y:l.y,i.z=P?h.z:l.z,this.closestPointToPoint(i,r);var R=i.distanceToSquared(r);if(R<f&&(f=R,s&&s.copy(r),u&&u.copy(i),R<c))return Math.sqrt(R)}for(var L=0;L<12;L++)for(var N=t[L],B=0;B<12;B++){var F=n[B];yO(N,F,r,i);var U=r.distanceToSquared(i);if(U<f&&(f=U,s&&s.copy(r),u&&u.copy(i),U<c))return Math.sqrt(U)}return Math.sqrt(f)}}();var _O=new tr,SO=new tr,EO=new tr,AO=new An,jO=new An,TO=new An,MO=new tr;function CO(e,t,n,r,i,a,o){_O.fromBufferAttribute(t,r),SO.fromBufferAttribute(t,i),EO.fromBufferAttribute(t,a);var s=function(e,t,n,r,i,a){return null===(a===ee?e.intersectTriangle(r,n,t,!0,i):e.intersectTriangle(t,n,r,a!==te,i))?null:{distance:e.origin.distanceTo(i),point:i.clone()}}(e,_O,SO,EO,MO,o);if(s){n&&(AO.fromBufferAttribute(n,r),jO.fromBufferAttribute(n,i),TO.fromBufferAttribute(n,a),s.uv=pi.getUV(MO,_O,SO,EO,AO,jO,TO,new An));var u={a:r,b:i,c:a,normal:new tr,materialIndex:0};pi.getNormal(_O,SO,EO,u.normal),s.face=u,s.faceIndex=r}return s}function DO(e,t,n,r,i){var a=3*r,o=e.index.getX(a),s=e.index.getX(a+1),u=e.index.getX(a+2),c=CO(n,e.attributes.position,e.attributes.uv,o,s,u,t);return c?(c.faceIndex=r,i&&i.push(c),c):null}function IO(e,t,n){return null===e||(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(n.ray.origin),e.object=t,e.distance<n.near||e.distance>n.far)?null:e}function PO(e,t,n,r){var i=e.a,a=e.b,o=e.c,s=t,u=t+1,c=t+2;n&&(s=n.getX(t),u=n.getX(t+1),c=n.getX(t+2)),i.x=r.getX(s),i.y=r.getY(s),i.z=r.getZ(s),a.x=r.getX(u),a.y=r.getY(u),a.z=r.getZ(u),o.x=r.getX(c),o.y=r.getY(c),o.z=r.getZ(c)}function RO(e,t,n,r,i,a,o){for(var s=n.index,u=n.attributes.position,c=e,l=t+e;c<l;c++)if(PO(o,3*c,s,u),o.needsUpdate=!0,r(o,c,i,a))return!0;return!1}var LO=function(){function e(t){Object(E.a)(this,e),this._getNewPrimitive=t,this._primitives=[]}return Object(A.a)(e,[{key:"getPrimitive",value:function(){var e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}},{key:"releasePrimitive",value:function(e){this._primitives.push(e)}}]),e}();function NO(e,t){return 65535===t[e+15]}function BO(e,t){return t[e+6]}function FO(e,t){return t[e+14]}function UO(e){return e+8}function zO(e,t){return t[e+6]}var VO=new ir,GO=new tr,HO=["x","y","z"];function WO(e,t,n,r,i){var a=2*e,o=ZO,s=JO,u=$O;if(NO(a,s)){!function(e,t,n,r,i,a){for(var o=r,s=r+i;o<s;o++)DO(e,t,n,o,a)}(t,n,r,BO(e,u),FO(a,s),i)}else{var c=UO(e);KO(c,o,r,GO)&&WO(c,t,n,r,i);var l=zO(e,u);KO(l,o,r,GO)&&WO(l,t,n,r,i)}}function qO(e,t,n,r){var i=2*e,a=ZO,o=JO,s=$O;if(NO(i,o))return function(e,t,n,r,i){for(var a=1/0,o=null,s=r,u=r+i;s<u;s++){var c=DO(e,t,n,s);c&&c.distance<a&&(o=c,a=c.distance)}return o}(t,n,r,BO(e,s),FO(i,o));var u,c,l=function(e,t){return t[e+7]}(e,s),h=HO[l],d=r.direction[h]>=0;d?(u=UO(e),c=zO(e,s)):(u=zO(e,s),c=UO(e));var f=KO(u,a,r,GO)?qO(u,t,n,r):null;if(f){var p=f.point[h];if(d?p<=a[c+l]:p>=a[c+l+3])return f}var v=KO(c,a,r,GO)?qO(c,t,n,r):null;return f&&v?f.distance<=v.distance?f:v:f||v||null}var YO=function(){var e,t,n=[],r=new LO((function(){return new ir}));return function(){e=r.getPrimitive(),t=r.getPrimitive(),n.push(e,t);var a=i.apply(void 0,arguments);r.releasePrimitive(e),r.releasePrimitive(t),n.pop(),n.pop();var o=n.length;return o>0&&(t=n[o-1],e=n[o-2]),a};function i(n,r,a,o){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;function l(e){for(var t=2*e,n=JO,r=$O;!NO(t,n);)t=2*(e=UO(e));return BO(e,r)}function h(e){for(var t=2*e,n=JO,r=$O;!NO(t,n);)t=2*(e=zO(e,r));return BO(e,r)+FO(t,n)}var d=2*n,f=ZO,p=JO,v=$O;if(NO(d,p)){var m=BO(n,v),g=FO(d,p);return iO(n,f,e),o(m,g,!1,c,u+n,e)}var y,b,w,x,O=UO(n),k=zO(n,v),_=O,S=k;if(s&&(x=t,iO(_,f,w=e),iO(S,f,x),y=s(w),(b=s(x))<y)){_=k,S=O;var E=y;y=b,b=E,w=x}w||iO(_,f,w=e);var A,j=a(w,NO(2*_,p),y,c+1,u+_);if(2===j){var T=l(_);A=o(T,h(_)-T,!0,c+1,u+_,w)}else A=j&&i(_,r,a,o,s,u,c+1);if(A)return!0;iO(S,f,x=t);var M,C=a(x,NO(2*S,p),b,c+1,u+S);if(2===C){var D=l(S);M=o(D,h(S)-D,!0,c+1,u+S,x)}else M=C&&i(S,r,a,o,s,u,c+1);return!!M}}(),XO=function(){var e=new OO,t=new OO,n=new Dr,r=new kO,i=new kO;return function a(o,s,u,c){var l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=2*o,d=ZO,f=JO,p=$O;if(null===l&&(u.boundingBox||u.computeBoundingBox(),r.set(u.boundingBox.min,u.boundingBox.max,c),l=r),!NO(h,f)){var v=o+8,m=p[o+6];return iO(v,d,VO),!!(l.intersectsBox(VO)&&a(v,s,u,c,l)||(iO(m,d,VO),l.intersectsBox(VO)&&a(m,s,u,c,l)))}var g=s,y=g.index,b=g.attributes.position,w=u.index,x=u.attributes.position,O=BO(o,p),k=FO(h,f);if(n.copy(c).invert(),u.boundsTree)return iO(o,d,i),i.matrix.copy(n),i.needsUpdate=!0,u.boundsTree.shapecast({intersectsBounds:function(e){return i.intersectsBox(e)},intersectsTriangle:function(e){e.a.applyMatrix4(c),e.b.applyMatrix4(c),e.c.applyMatrix4(c),e.needsUpdate=!0;for(var n=3*O,r=3*(k+O);n<r;n+=3)if(PO(t,n,y,b),t.needsUpdate=!0,e.intersectsTriangle(t))return!0;return!1}});for(var _=3*O,S=k+3*O;_<S;_+=3){PO(e,_,y,b),e.a.applyMatrix4(n),e.b.applyMatrix4(n),e.c.applyMatrix4(n),e.needsUpdate=!0;for(var E=0,A=w.count;E<A;E+=3)if(PO(t,E,w,x),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}}();function KO(e,t,n,r){return iO(e,t,VO),n.intersectBox(VO,r)}var QO,ZO,JO,$O,ek=[];function tk(e){QO&&ek.push(QO),QO=e,ZO=new Float32Array(e),JO=new Uint16Array(e),$O=new Uint32Array(e)}function nk(){QO=null,ZO=null,JO=null,$O=null,ek.length&&tk(ek.pop())}var rk=Symbol("skip tree generation"),ik=new ir,ak=new ir,ok=new Dr,sk=new kO,uk=new kO,ck=new tr,lk=new tr,hk=new tr,dk=new tr,fk=new tr,pk=new ir,vk=new LO((function(){return new OO})),mk=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Object(E.a)(this,e),!t.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((n=Object.assign(Object(_.a)({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null},rk,!1),n)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,n[rk]||(this._roots=function(e,t){for(var n,r,i,a=vO(e,t),o=[],s=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,u=0;u<a.length;u++){var c=a[u],l=new s(32*h(c));n=new Float32Array(l),r=new Uint32Array(l),i=new Uint16Array(l),d(0,c),o.push(l)}return o;function h(e){return e.count?1:1+h(e.left)+h(e.right)}function d(e,t){for(var a=e/4,o=e/2,s=!!t.count,u=t.boundingData,c=0;c<6;c++)n[a+c]=u[c];if(s){var l=t.offset,h=t.count;return r[a+6]=l,i[o+14]=h,i[o+15]=65535,e+32}var f,p=t.left,v=t.right,m=t.splitAxis;if((f=d(e+32,p))/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[a+6]=f/4,f=d(f,v),r[a+7]=m,f}}(t,n),!t.boundingBox&&n.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new ir))),this.geometry=t}return Object(A.a)(e,[{key:"refit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&Array.isArray(e)&&(e=new Set(e));var t=this.geometry,n=t.index.array,r=t.attributes.position,i=r.array,a=r.offset||0,o=3;r.isInterleavedBufferAttribute&&(o=r.data.stride);for(var s,u,c,l,h=0,d=this._roots,f=0,p=d.length;f<p;f++)s=d[f],u=new Uint32Array(s),c=new Uint16Array(s),l=new Float32Array(s),v(0,h),h+=s.byteLength;function v(t,r){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=2*t;if(65535===c[h+15]){for(var d=u[t+6],f=1/0,p=1/0,m=1/0,g=-1/0,y=-1/0,b=-1/0,w=3*d,x=3*(d+c[h+14]);w<x;w++){var O=n[w]*o+a,k=i[O+0],_=i[O+1],S=i[O+2];k<f&&(f=k),k>g&&(g=k),_<p&&(p=_),_>y&&(y=_),S<m&&(m=S),S>b&&(b=S)}return(l[t+0]!==f||l[t+1]!==p||l[t+2]!==m||l[t+3]!==g||l[t+4]!==y||l[t+5]!==b)&&(l[t+0]=f,l[t+1]=p,l[t+2]=m,l[t+3]=g,l[t+4]=y,l[t+5]=b,!0)}var E=t+8,A=u[t+6],j=E+r,T=A+r,M=s,C=!1,D=!1;e?M||(C=e.has(j),D=e.has(T),M=!C&&!D):(C=!0,D=!0);var I=M||D,P=!1;(M||C)&&(P=v(E,r,M));var R=!1;I&&(R=v(A,r,M));var L=P||R;if(L)for(var N=0;N<3;N++){var B=E+N,F=A+N,U=l[B],z=l[B+3],V=l[F],G=l[F+3];l[t+N]=U<V?U:V,l[t+N+3]=z>G?z:G}return L}}},{key:"traverse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this._roots[t],r=new Uint32Array(n),i=new Uint16Array(n);!function t(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=2*a,u=65535===i[s+15];if(u){var c=r[a+6],l=i[s+14];e(o,u,new Float32Array(n,4*a,6),c,l)}else{var h=a+8,d=r[a+6],f=r[a+7];e(o,u,new Float32Array(n,4*a,6),f)||(t(h,o+1),t(d,o+1))}}(0)}},{key:"raycast",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$,n=this._roots,r=this.geometry,i=[],a=t.isMaterial,o=Array.isArray(t),s=r.groups,u=a?t.side:t,c=0,l=n.length;c<l;c++){var h=o?t[s[c].materialIndex].side:u,d=i.length;if(tk(n[c]),WO(0,r,h,e,i),nk(),o)for(var f=s[c].materialIndex,p=d,v=i.length;p<v;p++)i[p].face.materialIndex=f}return i}},{key:"raycastFirst",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$,n=this._roots,r=this.geometry,i=t.isMaterial,a=Array.isArray(t),o=null,s=r.groups,u=i?t.side:t,c=0,l=n.length;c<l;c++){var h=a?t[s[c].materialIndex].side:u;tk(n[c]);var d=qO(0,r,h,e);nk(),null!=d&&(null==o||d.distance<o.distance)&&(o=d,a&&(d.face.materialIndex=s[c].materialIndex))}return o}},{key:"intersectsGeometry",value:function(e,t){var n,r=this.geometry,i=!1,a=Object(j.a)(this._roots);try{for(a.s();!(n=a.n()).done;){if(tk(n.value),i=XO(0,r,e,t),nk(),i)break}}catch(o){a.e(o)}finally{a.f()}return i}},{key:"shapecast",value:function(e,t,n){var r=this.geometry;if(e instanceof Function){if(t){var i=t;t=function(e,t,n,r){var a=3*t;return i(e,a,a+1,a+2,n,r)}}e={boundsTraverseOrder:n,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}var a=vk.getPrimitive(),o=e,s=o.boundsTraverseOrder,u=o.intersectsBounds,c=o.intersectsRange,l=o.intersectsTriangle;if(c&&l){var h=c;c=function(e,t,n,i,o){return!!h(e,t,n,i,o)||RO(e,t,r,l,n,i,a)}}else c||(c=l?function(e,t,n,i){return RO(e,t,r,l,n,i,a)}:function(e,t,n){return n});var d,f=!1,p=0,v=Object(j.a)(this._roots);try{for(v.s();!(d=v.n()).done;){var m=d.value;if(tk(m),f=YO(0,r,u,c,s,p),nk(),f)break;p+=m.byteLength}}catch(g){v.e(g)}finally{v.f()}return vk.releasePrimitive(a),f}},{key:"bvhcast",value:function(e,t,n){var r=n.intersectsRanges,i=n.intersectsTriangles,a=this.geometry.index,o=this.geometry.attributes.position,s=e.geometry.index,u=e.geometry.attributes.position;ok.copy(t).invert();var c=vk.getPrimitive(),l=vk.getPrimitive();if(i){var h=function(e,n,r,h,d,f,p,v){for(var m=r,g=r+h;m<g;m++){PO(l,3*m,s,u),l.a.applyMatrix4(t),l.b.applyMatrix4(t),l.c.applyMatrix4(t),l.needsUpdate=!0;for(var y=e,b=e+n;y<b;y++)if(PO(c,3*y,a,o),c.needsUpdate=!0,i(c,l,y,m,d,f,p,v))return!0}return!1};if(r){var d=r;r=function(e,t,n,r,i,a,o,s){return!!d(e,t,n,r,i,a,o,s)||h(e,t,n,r,i,a,o,s)}}else r=h}e.getBoundingBox(ak),ak.applyMatrix4(t);var f=this.shapecast({intersectsBounds:function(e){return ak.intersectsBox(e)},intersectsRange:function(t,n,i,a,o,s){return ik.copy(s),ik.applyMatrix4(ok),e.shapecast({intersectsBounds:function(e){return ik.intersectsBox(e)},intersectsRange:function(e,i,s,u,c){return r(t,n,e,i,a,o,u,c)}})}});return vk.releasePrimitive(c),vk.releasePrimitive(l),f}},{key:"intersectsBox",value:function(e,t){return sk.set(e.min,e.max,t),sk.needsUpdate=!0,this.shapecast({intersectsBounds:function(e){return sk.intersectsBox(e)},intersectsTriangle:function(e){return sk.intersectsTriangle(e)}})}},{key:"intersectsSphere",value:function(e){return this.shapecast({intersectsBounds:function(t){return e.intersectsBox(t)},intersectsTriangle:function(t){return t.intersectsSphere(e)}})}},{key:"closestPointToGeometry",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0;e.boundingBox||e.computeBoundingBox(),sk.set(e.boundingBox.min,e.boundingBox.max,t),sk.needsUpdate=!0;var o=this.geometry,s=o.attributes.position,u=o.index,c=e.attributes.position,l=e.index,h=vk.getPrimitive(),d=vk.getPrimitive(),f=lk,p=hk,v=null,m=null;r&&(v=dk,m=fk);var g=1/0,y=null,b=null;return ok.copy(t).invert(),uk.matrix.copy(ok),this.shapecast({boundsTraverseOrder:function(e){return sk.distanceToBox(e)},intersectsBounds:function(e,t,n){return n<g&&n<a&&(t&&(uk.min.copy(e.min),uk.max.copy(e.max),uk.needsUpdate=!0),!0)},intersectsRange:function(n,r){if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:function(e){return uk.distanceToBox(e)},intersectsBounds:function(e,t,n){return n<g&&n<a},intersectsRange:function(e,a){for(var o=3*e,w=3*(e+a);o<w;o+=3){PO(d,o,l,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(var x=3*n,O=3*(n+r);x<O;x+=3){PO(h,x,u,s),h.needsUpdate=!0;var k=h.distanceToTriangle(d,f,v);if(k<g&&(p.copy(f),m&&m.copy(v),g=k,y=x/3,b=o/3),k<i)return!0}}}});for(var o=0,w=l?l.count:c.count;o<w;o+=3){PO(d,o,l,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(var x=3*n,O=3*(n+r);x<O;x+=3){PO(h,x,u,s),h.needsUpdate=!0;var k=h.distanceToTriangle(d,f,v);if(k<g&&(p.copy(f),m&&m.copy(v),g=k,y=x/3,b=o/3),k<i)return!0}}}}),vk.releasePrimitive(h),vk.releasePrimitive(d),g===1/0?null:(n.point?n.point.copy(p):n.point=p.clone(),n.distance=g,n.faceIndex=y,r&&(r.point?r.point.copy(m):r.point=m.clone(),r.point.applyMatrix4(ok),p.applyMatrix4(ok),r.distance=p.sub(r.point).length(),r.faceIndex=b),n)}},{key:"closestPointToPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,i=n*n,a=r*r,o=1/0,s=null;if(this.shapecast({boundsTraverseOrder:function(t){return ck.copy(e).clamp(t.min,t.max),ck.distanceToSquared(e)},intersectsBounds:function(e,t,n){return n<o&&n<a},intersectsTriangle:function(t,n){t.closestPointToPoint(e,ck);var r=e.distanceToSquared(ck);return r<o&&(lk.copy(ck),o=r,s=n),r<i}}),o===1/0)return null;var u=Math.sqrt(o);return t.point?t.point.copy(lk):t.point=lk.clone(),t.distance=u,t.faceIndex=s,t}},{key:"getBoundingBox",value:function(e){return e.makeEmpty(),this._roots.forEach((function(t){iO(0,new Float32Array(t),pk),e.union(pk)})),e}}],[{key:"serialize",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),e.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});n=Object(p.a)({cloneBuffers:!0},n);var r,i=t.geometry,a=t._roots,o=i.getIndex();return r=n.cloneBuffers?{roots:a.map((function(e){return e.slice()})),index:o.array.slice()}:{roots:a,index:o.array},r}},{key:"deserialize",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("boolean"==typeof r)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),e.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});r=Object(p.a)({setIndex:!0},r);var i=t.index,a=t.roots,o=new e(n,Object(p.a)(Object(p.a)({},r),{},Object(_.a)({},rk,!0)));if(o._roots=a,r.setIndex){var s=n.getIndex();if(null===s){var u=new wi(t.index,1,!1);n.setIndex(u)}else s.array!==i&&(s.array.set(i),s.needsUpdate=!0)}return o}}]),e}(),gk=mk.prototype.raycast;mk.prototype.raycast=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycast" has changed. See docs for new signature.');var r=t[0],i=t[1],a=t[2],o=t[3];return gk.call(this,a,r.material).forEach((function(e){(e=IO(e,r,i))&&o.push(e)})),o}return gk.apply(this,t)};var yk=mk.prototype.raycastFirst;mk.prototype.raycastFirst=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycastFirst" has changed. See docs for new signature.');var r=t[0],i=t[1],a=t[2];return IO(yk.call(this,a,r.material),r,i)}return yk.apply(this,t)};var bk=mk.prototype.closestPointToPoint;mk.prototype.closestPointToPoint=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "closestPointToPoint" has changed. See docs for new signature.'),t.unshift();var r=t[1],i={};return t[1]=i,bk.apply(this,t),r&&r.copy(i.point),i.distance}return bk.apply(this,t)};var wk=mk.prototype.closestPointToGeometry;mk.prototype.closestPointToGeometry=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[2],i=t[3];if(r&&r.isVector3||i&&i.isVector3){console.warn('MeshBVH: The function signature and results frame for "closestPointToGeometry" has changed. See docs for new signature.');var a={},o={},s=t[1];return t[2]=a,t[3]=o,wk.apply(this,t),r&&r.copy(a.point),i&&i.copy(o.point).applyMatrix4(s),a.distance}return wk.apply(this,t)};var xk=mk.prototype.refit;mk.prototype.refit=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],i=t[1];if(i&&(i instanceof Set||Array.isArray(i))){console.warn('MeshBVH: The function signature for "refit" has changed. See docs for new signature.');var a=new Set;i.forEach((function(e){return a.add(e)})),r&&r.forEach((function(e){return a.add(e)})),xk.call(this,a)}else xk.apply(this,t)},["intersectsGeometry","shapecast","intersectsBox","intersectsSphere"].forEach((function(e){var t=mk.prototype[e];mk.prototype[e]=function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(null===r[0]||r[0].isMesh)&&(r.shift(),console.warn('MeshBVH: The function signature for "'.concat(e,'" has changed and no longer takes Mesh. See docs for new signature.'))),t.apply(this,r)}}));var Ok=z(V()),kk=.5*(Math.sqrt(3)-1),_k=(3-Math.sqrt(3))/6,Sk=1/3,Ek=1/6,Ak=(Math.sqrt(5),Math.sqrt(5),function(e){return 0|Math.floor(e)}),jk=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),Tk=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function Mk(){var e=Ck(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random),t=new Float64Array(e).map((function(e){return jk[e%12*2]})),n=new Float64Array(e).map((function(e){return jk[e%12*2+1]}));return function(r,i){var a,o,s=0,u=0,c=0,l=(r+i)*kk,h=Ak(r+l),d=Ak(i+l),f=(h+d)*_k,p=r-(h-f),v=i-(d-f);p>v?(a=1,o=0):(a=0,o=1);var m=p-a+_k,g=v-o+_k,y=p-1+2*_k,b=v-1+2*_k,w=255&h,x=255&d,O=.5-p*p-v*v;if(O>=0){var k=w+e[x];s=(O*=O)*O*(t[k]*p+n[k]*v)}var _=.5-m*m-g*g;if(_>=0){var S=w+a+e[x+o];u=(_*=_)*_*(t[S]*m+n[S]*g)}var E=.5-y*y-b*b;if(E>=0){var A=w+1+e[x+1];c=(E*=E)*E*(t[A]*y+n[A]*b)}return 70*(s+u+c)}}function Ck(e){for(var t=new Uint8Array(512),n=0;n<256;n++)t[n]=n;for(var r=0;r<255;r++){var i=r+~~(e()*(256-r)),a=t[r];t[r]=t[i],t[i]=a}for(var o=256;o<512;o++)t[o]=t[o-256];return t}var Dk,Ik=new pi,Pk=function(){function e(t){Object(E.a)(this,e),this.weightAttribute=null;var n=t.geometry;if(!n.isBufferGeometry||3!==n.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");n.index&&(n=n.toNonIndexed()),this.geometry=n,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}return Object(A.a)(e,[{key:"build",value:function(){for(var e=this.positionAttribute,t=new Float32Array(e.count/3),n=0;n<e.count;n+=3){var r=1;Ik.a.fromBufferAttribute(e,n),Ik.b.fromBufferAttribute(e,n+1),Ik.c.fromBufferAttribute(e,n+2),r*=Ik.getArea(),t[n/3]=r}this.distribution=new Float32Array(e.count/3);for(var i=0,a=0;a<t.length;a++)i+=t[a],this.distribution[a]=i;return this}},{key:"setRandomGenerator",value:function(e){return this.randomFunction=e,this}},{key:"sample",value:function(e,t){if(this.distribution){var n=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*n);return this.sampleFace(r,e,t)}}},{key:"binarySearch",value:function(e){if(!this.distribution)return 0;for(var t=this.distribution,n=0,r=t.length-1,i=-1;n<=r;){var a=Math.ceil((n+r)/2);if(0===a||t[a-1]<=e&&t[a]>e){i=a;break}e<t[a]?r=a-1:n=a+1}return i}},{key:"sampleFace",value:function(e,t,n){var r=this.randomFunction(),i=this.randomFunction();return r+i>1&&(r=1-r,i=1-i),Ik.a.fromBufferAttribute(this.positionAttribute,3*e),Ik.b.fromBufferAttribute(this.positionAttribute,3*e+1),Ik.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(Ik.a,r).addScaledVector(Ik.b,i).addScaledVector(Ik.c,1-(r+i)),Ik.getNormal(n),this}}]),e}(),Rk=z(G()),Lk=new Dr,Nk=new Dr,Bk=new Dr;!function(e){e.is=function(e){return e&&e.__isSPEObject}}(Dk||(Dk={}));var Fk,Uk=function(e){return function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.apply(this,arguments)).hiddenMatrix=new Dr,e.matrixWorldRigid=new Dr,e.shearScale=new Dr,e.shearScaleInv=new Dr,e}return Object(A.a)(n,[{key:"__isSPEObject",get:function(){return!0}},{key:"isDescendantOf",value:function(e){e instanceof ri&&(e=e.uuid);for(var t=this;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}},{key:"updateMatrixWorld",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);var t,n=Object(j.a)(this.children);try{for(n.s();!(t=n.n()).done;){t.value.updateMatrixWorld(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"updateWorldMatrix",value:function(e,t){var n=this.parent;if(e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),t){var r,i=Object(j.a)(this.children);try{for(i.s();!(r=i.n()).done;){r.value.updateWorldMatrix(!1,!0)}}catch(a){i.e(a)}finally{i.f()}}}},{key:"traverseObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!0!==e(this,t)){var n,r=Object(j.a)(this.children);try{for(r.s();!(n=r.n()).done;){var i=n.value;Dk.is(i)&&i.traverseObject(e,t+1)}}catch(a){r.e(a)}finally{r.f()}}}},{key:"updateMatrixWorldSVD",value:function(){var e=this.matrixWorld.elements,t=[[e[0],e[4],e[8]],[e[1],e[5],e[9]],[e[2],e[6],e[10]]],n=(0,Rk.SVD)(t),r=n.u,i=n.v,a=n.q,o=Lk.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),s=Nk.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),u=Bk.copy(s).transpose();this.shearScale.makeScale(a[0],a[1],a[2]).multiply(u).premultiply(s),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(o,u).copyPosition(this.matrixWorld),a.every((function(e){return Math.abs(a[0]-e)<.01}))?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}},{key:"attach",value:function(e,t){this.updateWorldMatrix(!0,!1);var n=(new Dr).copy(this.matrixWorld).invert();return null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),n.multiply(e.parent.matrixWorld)),"hiddenMatrix"in e&&e.hiddenMatrix instanceof Dr?e.hiddenMatrix.premultiply(n):e.applyMatrix4(n),e.updateWorldMatrix(!1,!1),this.add(e),void 0!==t&&(this.children.pop(),this.children.splice(t,0,e)),this}}]),n}(e)},zk=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n)}(Uk(ri)),Vk=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this)).object=e,r.matrixAutoUpdate=!1,r}return Object(A.a)(n,[{key:"expand",value:function(){for(var e=0,t=this.object.entityChildren(e);t;){var r,i=this.children[e];(null===(r=i)||void 0===r?void 0:r.object)!==t&&(i&&this.remove(i),i=new n(t),this.add(i),i.matrixAutoUpdate=!1,i.matrix=t.matrix,i.hiddenMatrix=t.hiddenMatrix),i.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}},{key:"visible",get:function(){var e;return this.object.visible||this.object.dataPatched.visible&&!0===(null===(e=this.object.dataPatched.cloner)||void 0===e?void 0:e.hideBase)},set:function(e){}},{key:"castShadow",get:function(){return this.object.castShadow},set:function(e){}},{key:"receiveShadow",get:function(){return this.object.receiveShadow},set:function(e){}},{key:"isMesh",get:function(){return function(e){return"Mesh"===e.type}(this.object)}},{key:"isLight",get:function(){return this.object.isLight}},{key:"layers",get:function(){return this.object.layers},set:function(e){}},{key:"isCamera",get:function(){return!1}},{key:"geometry",get:function(){if(this.object.geometry)return this.object.geometry}},{key:"material",get:function(){if(this.object.material)return this.object.material}}]),n}(zk),Gk=new tr,Hk=new tr,Wk=new Dr,qk=[new tr(-1,1,1),new tr(-1,-1,1),new tr(1,-1,1),new tr(1,1,1),new tr(-1,1,-1),new tr(-1,-1,-1),new tr(1,-1,-1),new tr(1,1,-1)],Yk=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],Xk=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],Kk=function(e,t,n){e.updateEntityBoxSize(Gk,Hk),Wk.copy(t).multiply(e.matrixWorld),0===Hk.x&&0===Hk.y&&0===Hk.z?n.push(new tr(Gk.x,Gk.y,Gk.z).applyMatrix4(Wk)):qk.forEach((function(e){n.push(e.clone().multiply(Hk).add(Gk).applyMatrix4(Wk))}))},Qk=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.apply(this,arguments)).matrix=new Dr,e.vertices=[],e.faces=[],e.edges=[],e.centerEdges=[],e}return Object(A.a)(n,[{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map((function(e){return e.clone()})),this.faces=e.faces.map((function(e){return e.clone()})),this.edges=e.edges.map((function(e){return e.clone()})),this.centerEdges=e.centerEdges.map((function(e){return e.clone()})),this}},{key:"setFromObjectSize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);var n=(new Dr).copy(e.matrixWorld).invert();return this.expandByObjectSize(e,n,t)}},{key:"expandByObjectSize",value:function(e,t){var n=[];return!0===(arguments.length>2&&void 0!==arguments[2]&&arguments[2])?e.traverseEntity((function(e){e.visible&&Kk(e,t,n)})):Kk(e,t,n),this.setFromPoints(n)}},{key:"getCenter",value:function(e){return(e=Object(b.a)(Object(w.a)(n.prototype),"getCenter",this).call(this,e)).applyMatrix4(this.matrix),e}},{key:"getPositionToCenter",value:function(e){return(e=Object(b.a)(Object(w.a)(n.prototype),"getCenter",this).call(this,e)).applyMatrix4(Wk.copy(this.matrix).setPosition(0,0,0)),e}},{key:"computeVertices",value:function(){this.getSize(Hk).multiplyScalar(.5),this.getCenter(Gk),Wk.copy(this.matrix).setPosition(Gk),this.vertices=qk.map((function(e){return e.clone().multiply(Hk).applyMatrix4(Wk)}))}},{key:"computeEdges",value:function(){var e=this;this.vertices.length>0&&this.computeVertices(),this.edges=Yk.map((function(t){var n=Object(g.a)(t,2),r=n[0],i=n[1];return new Ml(e.vertices[r],e.vertices[i])})),this.centerEdges=this.edges.map((function(e){return e.getCenter(new tr)}))}},{key:"computeFaces",value:function(){var e=this;this.vertices.length>0&&this.computeVertices(),this.faces=Xk.map((function(t){var n=Object(g.a)(t,2),r=n[0],i=n[1];return e.vertices[r].clone().add(e.vertices[i]).multiplyScalar(.5)}))}}]),n}(ir),Zk={Cloner:function(){},changeEntityProptotype:function(){},createEntity:function(){}};!function(e){e.is=function(e){return e&&e.__isEntity}}(Fk||(Fk={}));var Jk=function(e){return Fk.is(e)},$k=function(e){return function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.apply(this,arguments)).raycastLock=!1,e.scaleLock=!1,e.disposed=!1,e.stateSelection=null,e.instances=[],e.prevState=null,e.currentState=null,e.reversibleToState=null,e.currentTransitionEvent=null,e._singleBBox=new Qk,e._recursiveBBox=new Qk,e.singleBBoxNeedsUpdate=!0,e.recursiveBBoxNeedsUpdate=!0,e}return Object(A.a)(n,[{key:"__isEntity",get:function(){return!0}},{key:"entityChildren",value:function(e){var t=this.children[e];if(Fk.is(t))return t}},{key:"isConcreteEntity",get:function(){return"string"==typeof this.identity}},{key:"isVirtualEntity",get:function(){return"string"!=typeof this.identity}},{key:"isInstanceRoot",get:function(){return this.isConcreteEntity&&"Instance"===this.data.type}},{key:"nearestInstanceSelfOrParent",value:function(){for(var e=this;"Instance"!==e.data.type;){var t=e.parent;if(!Fk.is(t))return;e=t}return e}},{key:"forInstancesRec",value:function(e){this.instances.forEach((function(t){t.disposed||e(t),t.forInstancesRec(e)}))}},{key:"super_Entity",value:function(e,t){"string"==typeof e&&(this.uuid=e),this.identity=e,this.data=t,this.matrixAutoUpdate=!1,this.dataPatched=this.data}},{key:"changeSelectedState",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0!==this.data.states.length||r){var i,a=Object(j.a)(this.data.states);try{for(a.s();!(i=a.n()).done;){var o=i.value;fx.toOps(this.data,o.data).forEach((function(e){var r=oy.replaceProps(e,n.data);n.updateByPatchedOp(r,n.data,t)}))}}catch(u){a.e(u)}finally{a.f()}if(null!==e){var s=this.data.states.data(e);s&&(this.dataPatched=fx.patch(this.data,s),fx.toOps(this.data,s).forEach((function(e){n.updateByPatchedOp(e,n.dataPatched,t)})))}else this.dataPatched=this.data;r&&this.updateTransformState(this.dataPatched),this.stateSelection=e}}},{key:"singleBBox",get:function(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}},{key:"recursiveBBox",get:function(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}},{key:"updateEntityBoxSize",value:function(e,t){e.setScalar(0),t.setScalar(0)}},{key:"resetBBoxNeedsUpdateSelf",value:function(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}},{key:"resetBBoxNeedsUpdate",value:function(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors((function(e){Jk(e)&&e.resetBBoxNeedsUpdateSelf()})),this.traverseEntity((function(e){e.resetBBoxNeedsUpdateSelf()}))}},{key:"find",value:function(e){var t;return this.traverseEntity((function(n){n.uuid===e&&(t=n)})),t}},{key:"traverseSortNextHelper",value:function(){var e=this.parent;if(e){var t=e.children,n=t.indexOf(this)+1;if(Fk.is(t[n]))return t[n];if(Fk.is(e))return e.traverseSortNextHelper()}}},{key:"sortNext",value:function(){var e=this.children;return this.children.length>0&&Fk.is(this.children[0])?e[0]:this.traverseSortNextHelper()}},{key:"goUp",value:function(e){for(var t=this;e>0&&null!==t;)t=t.parent,e-=1;return t}},{key:"hasAnccestorOrSelf",value:function(e){return this===e||this.hasAnccestor(e)}},{key:"hasAnccestor",value:function(e){for(var t=this.parent;t;){if(e===t)return!0;t=t.parent}return!1}},{key:"countToAccestor",value:function(e){for(var t=0,n=this;n!==e;){if(null===n)return-1;n=n.parent,t+=1}return t}},{key:"forEachEntity",value:function(e){var t,n=Object(j.a)(this.children);try{for(n.s();!(t=n.n()).done;){var r=t.value;Jk(r)&&e(r)}}catch(i){n.e(i)}finally{n.f()}}},{key:"traverseEntityAncestors",value:function(e){this.traverseAncestors((function(t){Fk.is(t)&&e(t)}))}},{key:"traverseEntity",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!0!==e(this,t)){var n,r=Object(j.a)(this.children);try{for(r.s();!(n=r.n()).done;){var i=n.value;Jk(i)&&i.traverseEntity(e,t+1)}}catch(a){r.e(a)}finally{r.f()}}}},{key:"traverseVisibleEntity",value:function(e){e(this);var t,n=Object(j.a)(this.children);try{for(n.s();!(t=n.n()).done;){var r=t.value;Jk(r)&&r.visible&&r.traverseVisibleEntity(e)}}catch(i){n.e(i)}finally{n.f()}}},{key:"updateMatrix",value:function(){Object(b.a)(Object(w.a)(n.prototype),"updateMatrix",this).call(this),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}},{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e,!1),this.raycastLock=e.raycastLock,this.scaleLock=e.scaleLock,this.hiddenMatrix.copy(e.hiddenMatrix),this}},{key:"hasEntityChild",value:function(){return this.children.some((function(e){return Jk(e)}))}},{key:"isAncestorOf",value:function(e){if(this.uuid===e)return!1;var t=!1;return this.traverseEntity((function(n){n.uuid===e&&(t=!0)})),t}},{key:"toObjectTransformState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.updateWorldMatrix(!0,!1);var t={position:this.position.toArray(),rotation:[this.rotation.x,this.rotation.y,this.rotation.z],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return Rg(t,e)}},{key:"updateTransformState",value:function(e){var t,n=this,r=!1;return e.position&&(this.position.fromArray(e.position),r=!0),e.rotation&&(this.rotation.fromArray(e.rotation),r=!0),e.scale&&(r=!0,this.scale.fromArray(e.scale)),void 0!==e.hiddenMatrix&&(r=!0,this.hiddenMatrix.fromArray(null!==(t=e.hiddenMatrix)&&void 0!==t?t:Ow.identity)),r&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors((function(e){e.invalidateClonerTransform(n)}))),e.position&&e.rotation&&e.scale&&void 0!==e.hiddenMatrix&&this.updateWorldMatrix(!1,!0),r}},{key:"dispose",value:function(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}},{key:"disposeChildrenRecursively",value:function(){var e,t=Object(j.a)(this.children);try{for(t.s();!(e=t.n()).done;){var n=e.value;Fk.is(n)&&n.disposeRecursively()}}catch(r){t.e(r)}finally{t.f()}}},{key:"disposeRecursively",value:function(){this.dispose(),this.children.forEach((function(e){Fk.is(e)&&e.disposeRecursively()}))}},{key:"toState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=Object(p.a)({name:this.name,visible:this.visible,raycastLock:this.raycastLock},this.toObjectTransformState(e));return Rg(t,e)}},{key:"updateByOp",value:function(e,t,n,r){var i=this.data;this.data=t;var a=e,o=Ly(e.path,["states","*"]);if(null!==o){if(0===e.type){var s=Object(g.a)(o,1)[0];if((null===this||void 0===this?void 0:this.stateSelection)===s){var u=Object(p.a)({},e.props);if(Object.values(e.props).some((function(e){return void 0===e}))){var c=this.data;if(void 0!==c){var l=My.zoom(c,e.path.slice(2));if(l)for(var d in e.props)void 0===e.props[d]&&d in l&&(u[d]=l[d])}}a=Object(p.a)(Object(p.a)({},e),{},{props:u,path:e.path.slice(2)})}}}else if(0===e.type){var f=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==f){if(void 0!==e.props.name&&f.name){var m=f;m.name;f=Object(h.a)(m,C)}if(void 0!==e.props.material&&"material"in f){var y=f;y.material;f=Object(h.a)(y,D)}var b=My.removeOverridden(e.path,e.props,f);a=Object(p.a)(Object(p.a)({},e),{},{props:b})}}if(this.updateByPatchedOpBase(a,fx.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),n),Ly(e.path,["overrides"])){var w=[],x=Object(v.a)(e.path);for(w.push(x[1]),x.splice(0,2);x.length>0&&"descendants"===x[0];)w.push(x[1]),x.splice(0,2);if(void 0===w[w.length-1]){if(0===e.type)for(var O=0,k=Object.keys(e.props);O<k.length;O++){var _=k[O];w[w.length-1]=_;var S=n.scene.findInstance([this.uuid].concat(w));S&&(S.overrideData=e.props[_],S.updateState(iy.apply(S.component.data,S.overrideData),n))}}else{var E=n.scene.findInstance([this.uuid].concat(w));if(E){var A=My.zoom(E.component.data,x);if(0===(e=Object(p.a)(Object(p.a)({},e),{},{path:x})).type){var T=e.props;if(A)for(var M=0,I=Object.entries(e.props);M<I.length;M++){var P=Object(g.a)(I[M],2),R=P[0];void 0===P[1]&&(T===e.props&&(T=Object(p.a)({},e.props)),T[R]=A[R])}e=Object(p.a)(Object(p.a)({},e),{},{props:T})}E.overrideData=cx.resolve(t.overrides,w),E.updateByOp(e,sy.applySimple(E.data,e),n,!1)}}}else if(this.instances.length>0){var L;if(0===e.path.length&&0===e.type){var N,B,F=Object(j.a)(lx.rootOverrideProps);try{for(F.s();!(B=F.n()).done;){var U=B.value;U in e.props&&(void 0===N&&(N={}),N[U]=e.props[U])}}catch(H){F.e(H)}finally{F.f()}N&&(L=Object(p.a)(Object(p.a)({},e),{},{props:N}))}else{var z,V=Object(j.a)(lx.rootOverrideProps);try{for(V.s();!(z=V.n()).done;){var G=z.value;if(Ly(e.path,[G])){L=e;break}}}catch(H){V.e(H)}finally{V.f()}}void 0!==L&&this.instances.forEach((function(e){if(e.isInstanceRoot){var t=iy.filterOp(e.overrideData,L);t&&e.updateByOp(t,sy.applySimple(e.data,t),n,!0)}})),this.instances.forEach((function(r){if(!r.isInstanceRoot){var a,o=iy.filterOp(r.overrideData,e);if(o)a=i===r.data&&e===o?t:sy.applySimple(r.data,o),r.updateByOp(o,a,n,!0)}}))}}},{key:"updateByPatchedOpBase",value:function(e,t,n){if(this.dataPatched=t,0===e.path.length&&0===e.type)void 0!==e.props.type&&!Cw.is(e.props.type)&&Zk.changeEntityProptotype(this,t,n);else if(1===e.path.length&&"geometry"===e.path[0]&&0===e.type&&"type"in e.props){Zk.changeEntityProptotype(this,t,n);var r,i=Object(j.a)(this.children);try{for(i.s();!(r=i.n()).done;){var a=r.value;Fk.is(a)&&a.updateVisible()}}catch(o){i.e(o)}finally{i.f()}}this.updateByPatchedOp(e,t,n)}},{key:"updateByPatchedOp",value:function(e,t,n){if(0===e.path.length&&0===e.type&&this.updateState(e.props,n),null!==Ly(e.path,["cloner"])){var r=sy.drop(e,1);0===r.path.length&&0===r.type&&!0===r.props.disabled?this.setFromClonerState(null,n):this.cloner?this.cloner.updateState(t.cloner,n.scene):(this.setFromClonerState(t.cloner,n),this.expandCloner(n.scene)),this.updateVisible()}}},{key:"updateVisible",value:function(){var e,t,n;this.visible=this.dataPatched.visible&&(null===(e=null===(t=this.dataPatched.cloner)||void 0===t?void 0:t.disabled)||void 0===e||e||!0!==(null===(n=this.dataPatched.cloner)||void 0===n?void 0:n.hideBase))}},{key:"updateState_Entity",value:function(e,t){void 0!==e.name&&(this.name=e.name),void 0!==e.raycastLock&&(this.raycastLock=e.raycastLock),void 0!==e.visible&&(this.updateVisible(),this.resetBBoxNeedsUpdate()),"cloner"in e&&void 0!==e.cloner&&(this.setFromClonerState(e.cloner,t),this.updateVisible()),this.updateTransformState(e)}},{key:"attachedSurfaceCloners",get:function(){return this.children.filter((function(e){return e instanceof Zk.Cloner&&"toObject"===e.parameters.type}))}},{key:"setFromClonerState",value:function(e,t){this.disposed||(null===e||e.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):(void 0===this.cloner&&(this.cloner=new Zk.Cloner(this,e),t.scene.addPendingExpandCloner(this)),this.cloner.updateState(e,t.scene)))}},{key:"expandCloner",value:function(e){!this.disposed&&this.cloner&&this.cloner.expandClones(e)}},{key:"invalidateClonerTransform",value:function(e){this.cloner&&this.cloner.invalidateTransform(e)}}]),n}(Uk(e))},e_=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a,o,s=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:0,cornerSegments:8,hollow:0},e.parameters),u=s.width/2,c=null!==(r=s.radiusTop)&&void 0!==r?r:u,l=null!==(i=s.radiusBottom)&&void 0!==i?i:u;return c===l?(c=u,l=u):c>l?l=l*u/(c=u):(c=c*u/l,l=u),{parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(a=s.height)&&void 0!==a?a:s.width),depth:Math.abs(null!==(o=s.depth)&&void 0!==o?o:s.width),radiusTop:c,radiusBottom:l})}}},{key:"build",value:function(e){var t,n=e.parameters,r=n.width,i=n.depth,a=n.height,o=n.radialSegments,s=n.heightSegments,u=n.openEnded,c=n.thetaStart,l=n.thetaLength,h=n.radiusTop,d=n.radiusBottom,f=n.cornerRadius,v=n.cornerSegments,m=n.hollow;return(t=f||m?new r_(h,d,a,o,s,u,c,l*Math.PI/180,f,f,v,m):new Gu(h,d,a,o,s,u,c,l*Math.PI/180)).scale(1,1,i/r),Object.assign(t,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"CylinderGeometry"})})}}]),e}();function t_(e,t,n){n.x=e.x*t.x,n.y=e.y,n.z=e.x*t.y}function n_(e){return new An(e.y,-e.x)}var r_=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o,s,u,c,l,h,d,f){var p,m=arguments.length>12&&void 0!==arguments[12]&&arguments[12];Object(E.a)(this,n),(p=t.call(this)).type="RoundedCylinderBufferGeometry",e=void 0!==e?e:1,r=void 0!==r?r:1,i=i||1,a=Math.floor(a)||8,o=Math.floor(o)||1,s=void 0!==s&&s,u=void 0!==u?u:0,c=void 0!==c?c:2*Math.PI,s&&(l=0,h=0);var g=[],y=[],b=[],w=[],x=0,O=i/2,k=new tr,_=new tr;m&&0==e&&(e=l),m&&0==r&&(r=h);var S=new An(e,O),A=new An(r,-O),T=null,M=null,C=null,D=null,I=S.clone().sub(A),P=0,R=0,L=0;f>0&&(P=Math.min(e,r)*(1-f),R=e-P,L=r-P);var N=S.clone();N.x-=P;var B=Math.PI-I.angle(),F=I.angle(),U=Math.tan(F/2),z=Math.tan(B/2),V=U+z,G=f?V:z,H=f?V:U;if(l=Math.min(l,(e-R)/G,I.length()/V),h=Math.min(h,(r-L)/H,I.length()/V),l>0){var W=l/U;T=S.clone().sub(new An(W,l)),f&&((C=T.clone()).x-=P-V*l),S.sub(I.clone().setLength(W))}if(h>0){var q=h/z;M=A.clone().sub(new An(q,-h)),A.add(I.clone().setLength(q)),f&&((D=M.clone()).x-=P-V*h,N.sub(I.clone().setLength(q)))}for(var Y=(I=S.clone().sub(A)).length()<.5,X=[],K=0;K<=a;K++){var Q=[],Z=K/a,J=Z*c+u,$=new An(Math.sin(J),Math.cos(J));if(D&&M?(de(Q,Z,$,B,h,D,-1,!0),de(Q,Z,$,F,h,M,-1,!1)):M?(fe(Q,$,M.x,0,-1),de(Q,Z,$,F,h,M,-1,!1)):s||fe(Q,$,r,L,-1),t_(n_(I).normalize(),$,k),!Y)for(var ee=0;ee<=o;ee++){var te=ee/o;t_(I.clone().multiplyScalar(te).add(A),$,_),y.push(_.x,_.y,_.z),b.push(k.x,k.y,k.z),w.push(Z,.5+_.y/i),Q.push(x++)}if(C&&T?(de(Q,Z,$,B,l,T,1,!1),de(Q,Z,$,F,l,C,1,!0)):T?(de(Q,Z,$,B,l,T,1,!1),fe(Q,$,T.x,0,1)):s||fe(Q,$,e,R,1),f&&!Y){t_(n_(I).multiplyScalar(-1).normalize(),$,k);for(var ne=0;ne<=o;ne++){var re=ne/o;t_(I.clone().multiplyScalar(-re).add(N),$,_),y.push(_.x,_.y,_.z),b.push(k.x,k.y,k.z),w.push(Z,.5+_.y/i),Q.push(x++)}}f&&!s&&Q.push(Q[0]),X.push(Q)}for(var ie=0;ie<X.length-1;ie++)for(var ae=0;ae<X[0].length-1;ae++)if(!s||!f||ae!=o){var oe=X[ie][ae],se=X[ie+1][ae],ue=X[ie+1][ae+1],ce=X[ie][ae+1],le=y[3*ue+0],he=y[3*ue+2];g.push(oe,se,ce),(0!=le||0!=he)&&g.push(se,ue,ce)}function de(e,t,n,r,a,o,s,u){for(var c=0;c<d+1;c++){var l=c/d,h=s<0?l:1-l;u&&(h-=1),h*=r;var f=new An(Math.sin(h),Math.cos(h)*s);t_(f.clone().multiplyScalar(a).add(o),n,_),y.push(_.x,_.y,_.z),t_(f,n,k),b.push(k.x,k.y,k.z),w.push(t,.5+_.y/i),e.push(x++)}}function fe(e,t,n,r,i){var a=new tr,o=new An,s=[n,r];i<0&&s.reverse();for(var u=0,c=s;u<c.length;u++){var l=c[u];o.set(l,O*i),t_(o,t,a),y.push(a.x,a.y,a.z),b.push(0,i,0),w.push(.5,.5),e.push(x++)}}function pe(t,n,i){var a=new An(Math.sin(i),Math.cos(i)),o=new An(-Math.cos(i),Math.sin(i)),s=new tr,u=t<0?function(e,t,n){return g.push(e,t,n)}:function(e,t,n){return g.push(e,n,t)};t_(new An((e+r+R+L)/4,0),a,s),y.push(s.x,s.y,s.z),b.push(o.x,0,o.y),w.push(.5,.5);var c,l=x++,h=Object(j.a)(n);try{for(h.s();!(c=h.n()).done;){var d=c.value,f=y.slice(3*d,3*d+3);y.push.apply(y,Object(v.a)(f)),b.push(o.x,0,o.y);var p=w.slice(2*d,2*d+2);w.push.apply(w,Object(v.a)(p)),x++}}catch(O){h.e(O)}finally{h.f()}for(var m=l+1;m<x-1;m++)u(l,m,m+1);u(l,x-1,l+1)}return c<2*Math.PI&&(pe(-1,X[0],u),pe(1,X[X.length-1],u+c)),p.setIndex(g),p.setAttribute("position",new _i(y,3)),p.setAttribute("normal",new _i(b,3)),p.setAttribute("uv",new _i(w,2)),p}return Object(A.a)(n)}(Di),i_=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:0,cornerRadiusBottom:0,cornerSegments:8},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(r=a.height)&&void 0!==r?r:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:a.width)})}}},{key:"build",value:function(e){var t,n=e.parameters,r=n.width,i=n.depth,a=n.height,o=n.radialSegments,s=n.heightSegments,u=n.openEnded,c=n.thetaStart,l=n.thetaLength,h=n.cornerRadiusTop,d=n.cornerRadiusBottom,f=n.cornerSegments;return(t=h>0||d>0||l<360?new r_(0,r/2,a,o,s,u,c,l*Math.PI/180,h,d,f,0,!0):new Hu(r/2,a,o,s,u)).scale(1,1,i/r),Object.assign(t,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"ConeGeometry"})})}}]),e}(),a_=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:0,cornerSegments:8},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(r=a.height)&&void 0!==r?r:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:a.width)})}}},{key:"build",value:function(e){var t,n=e.parameters,r=n.width,i=n.height,a=n.depth,o=n.widthSegments,s=n.heightSegments,u=n.depthSegments,c=n.cornerRadius,l=n.cornerSegments;return t=0==c?new Ji(r,i,a,o,s,u):new s_(r,i,a,o,s,u,c,l),Object.assign(t,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"CubeGeometry"})})}}]),e}(),o_=Math.PI/2,s_=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:4;Object(E.a)(this,n),(e=t.call(this)).type="BoxGeometry";var h=Object(x.a)(e);o=Math.floor(o),s=Math.floor(s),u=Math.floor(u),l=Math.floor(l),c=Math.min(c,r/2,i/2,a/2);var d=[],f=[],p=[],v=[],m=0,g=0;function y(e,t,n,r,i,a,o,s,u,l,y){for(var b=(a-2*c)/u,w=(o-2*c)/l,x=a/2-c,O=o/2-c,k=s/2,_=u+1,S=l+1,E=0,A=0,j=new tr,T=0;T<S;T++)for(var M=T*w-O,C=0;C<_;C++){var D=C*b-x;j[e]=D*r,j[t]=M*i,j[n]=k,f.push(j.x,j.y,j.z),j[e]=0,j[t]=0,j[n]=s>0?1:-1,p.push(j.x,j.y,j.z),v.push(C/u),v.push(1-T/l),E+=1}for(var I=0;I<l;I++)for(var P=0;P<u;P++){var R=m+P+_*I,L=m+P+_*(I+1),N=m+(P+1)+_*(I+1),B=m+(P+1)+_*I;d.push(R,L,B),d.push(L,N,B),A+=6}h.addGroup(g,A,y),g+=A,m+=E}function b(e,t,n,r,i,a,o,s,u,y,b){for(var w=(o-2*c)/y,x=o/2-c,O=s/2-c,k=u/2,_=y+1,S=0,E=0,A=new tr,j=new tr,T=0;T<l+1;T++){var M=T/l*o_,C=Math.sin(M)*c,D=(1-Math.cos(M))*c,I=Math.sin(M),P=Math.cos(M);A[t]=(O+C)*i,A[n]=(k-D)*a,j[e]=0,j[t]=I*Math.sign(A[t]),j[n]=P*Math.sign(A[n]);for(var R=0;R<_;R++){var L=R*w-x;A[e]=L*r,f.push(A.x,A.y,A.z),p.push(j.x,j.y,j.z),v.push(R/y),v.push(0),S+=1}}for(var N=0;N<l;N++)for(var B=0;B<y;B++){var F=m+B+_*N,U=m+B+_*(N+1),z=m+(B+1)+_*(N+1),V=m+(B+1)+_*N;d.push(F,U,V),d.push(U,z,V),E+=6}h.addGroup(g,E,b),g+=E,m+=S}function w(e,t,n){var o=new tr,s=new tr(r/2,i/2,a/2);s.subScalar(c);for(var u=[],h=e*t*n>0?function(e,t,n){return d.push(e,t,n)}:function(e,t,n){return d.push(e,n,t)},g=0;g<=l;g++){for(var y=[],b=o_*(1-g/l),w=Math.cos(b),x=Math.sin(b),O=0,k=0;k<=g;k++){var _=Math.cos(O),S=Math.sin(O);o.x=w*_,o.y=x,o.z=w*S;var E=s.clone().addScaledVector(o,c);f.push(e*E.x,t*E.y,n*E.z),p.push(e*o.x,t*o.y,n*o.z),v.push(0,0),y.push(m++),O+=o_/g}u.push(y)}for(var A=u.length-1,j=0;j<A;j++){var T=u[j],M=u[j+1],C=T.length-1;h(T[0],M[1],M[0]);for(var D=1;D<=C;D++)h(T[D-1],T[D],M[D]),h(T[D],M[D+1],M[D])}}return y("z","y","x",-1,-1,a,i,r,u,s,0),y("z","y","x",1,-1,a,i,-r,u,s,1),y("x","z","y",1,1,r,a,i,o,u,2),y("x","z","y",1,-1,r,a,-i,o,u,3),y("x","y","z",1,-1,r,i,a,o,s,4),y("x","y","z",-1,-1,r,i,-a,o,s,5),c>0&&(b("z","y","x",-1,-1,1,a,i,r,u,0),b("z","y","x",1,-1,-1,a,i,r,u,1),b("z","y","x",-1,1,-1,a,i,r,u,1),b("z","y","x",1,1,1,a,i,r,u,0),b("x","y","z",-1,-1,-1,r,i,a,o,0),b("x","y","z",1,-1,1,r,i,a,o,1),b("x","y","z",-1,1,1,r,i,a,o,0),b("x","y","z",1,1,-1,r,i,a,o,1),b("y","x","z",-1,-1,1,i,r,a,s,0),b("y","x","z",1,-1,-1,i,r,a,s,1),b("y","x","z",1,1,1,i,r,a,s,1),b("y","x","z",-1,1,-1,i,r,a,s,0),w(1,1,1),w(-1,1,1),w(1,-1,1),w(-1,-1,1),w(1,1,-1),w(-1,1,-1),w(1,-1,-1),w(-1,-1,-1)),e.setIndex(d),e.setAttribute("position",new _i(f,3)),e.setAttribute("normal",new _i(p,3)),e.setAttribute("uv",new _i(v,2)),e}return Object(A.a)(n)}(Di),u_=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4;Object(E.a)(this,n),(e=t.call(this)).type="PolyhedronGeometryRound";var c=[],l=[],h=[];return function(){0==(s=Math.min(.99999,s))&&(u=0);for(var e={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[a],t=new tr,n=t.clone(),l=new pi,d=s*o,f=o-d,p=u+1,m=new tr,y=function(e,t){return m.subVectors(e,t).normalize()},b=function(e,t){return Array(e).fill(void 0).map(t)},w=b(r.length/3,(function(e,t){return(new tr).fromArray(r,3*t).setLength(o)})),x=[],O=1e6,k=function(){for(var e,t,n,r=w[_],a=[],o=1e10,s=-1;-1!=(s=i.indexOf(_,s+1));){var u=s-s%3;e=i[u+(s+1)%3],t=i[u+(s+2)%3],n=r.distanceToSquared(w[e]),o=Math.min(o,n),a.push([e,t,n])}o+=1e-6;for(var c=[],l=0,h=a.length,d=0;d<h;d++){var f,p=Object(g.a)(a[l],3);e=p[0],t=p[1],n=p[2];var v=1==(null===(f=x[e])||void 0===f?void 0:f.includes(_));n<=o&&c.push(e+ +v*O),l=a.findIndex((function(e){return e[0]==t}))}x.push(c)},_=0;_<w.length;_++)k();for(var S,E,A=[],j=0,T=0,M=3==e,C=0;C<=u;C++){S=C*(C+1)/2,E=(C+1)*(C+2)/2;for(var D=0;D<u-C;D++)j=S+D+C+2,T=E+D+C+3,A.push.apply(A,[S,E].concat(Object(v.a)(M?[T,S]:[j,E]),[T,j])),S=j,E=T;A.push(S,E,S+u+2)}for(var I=t.clone(),P=t.clone(),R=t.clone(),L=t.clone(),N=t.clone(),B=[],F=b(w.length,(function(){return b(e,(function(){return t.clone()}))})),U=0;U<w.length;U++){t.copy(w[U]).normalize(),I.copy(t).multiplyScalar(f);for(var z=x[U],V=0;V<z.length;V++){var G=z[V],H=z[(V+1)%e];l.setFromPointsAndIndices(w,U,G%O,H%O),l.b.sub(l.a).setLength(1e10).add(l.a),l.c.sub(l.a).setLength(1e10).add(l.a),l.closestPointToPoint(I,F[U][V])}var W=[],q=[],Y=[],X=new tr;0==u&&Object(v.a)(F[U]).reduce((function(e,t){return e.add(t)}),X).multiplyScalar(1/e);for(var K=0;K<e;K++){var Q=[],Z=(K-1+e)%e,J=F[U][Z],$=F[U][K];t.copy(J).sub(I),n.copy($).sub(I);var ee=I.angleTo(t),te=t.angleTo(n),ne=Math.cos(ee)*d;0==u?P.copy(X):P.copy(I).setLength(f+ne),q.push(ne);for(var re=[P,J,$],ie=0;ie<2;ie++){var ae=re[ie],oe=re[ie+1];L.subVectors(ae,I),N.subVectors(oe,I),R.crossVectors(L,N).normalize();for(var se=0;se<p;se++){var ue=[ee,te][ie]*se/p;t.copy(L).applyAxisAngle(R,ue).add(I),W.push(t.clone()),ie&&(y(t,I),Q.push([0==se?ae:t.clone(),m.clone()]))}ie&&(y(oe,I),Q.push([oe,m.clone()]))}Y.push(Q)}B.push(Y);for(var ce=2*p,le=function(){for(var n=ce*he,r=ce*((he+1)%e),i=[W[n]],a=1;a<p;a++){L=W[n+a],N=W[r+a],i.push(L);for(var o=1,s=a-2+1;o<=s;o++)t.lerpVectors(L,N,o/(s+1)),t.sub(I).setLength(q[he]).add(I),i.push(t.clone());i.push(N)}for(var u=0;u<p;u++)i.push(W[u+p+n]);i.push(W[r+p]);var l=A.map((function(e){return i[e]}));c.push.apply(c,Object(v.a)(l.map((function(e){return[e.x,e.y,e.z]})).flat())),h.push.apply(h,Object(v.a)(l.map((function(e){return y(e,I),[m.x,m.y,m.z]})).flat()))},he=0;he<e;he++)le()}for(var de=[],fe=function(t){for(var n=0;n<e;n++){var r=x[t][n];if(r<O){for(var i=x[r].findIndex((function(e){return e%O==t})),a=B[t][n],o=B[r][i],s=0;s<p;s++){var u=a[s],l=o[p-s],d=a[s+1];[u,l,d,d,l,o[p-(s+1)]].forEach((function(e){c.push(e[0].x,e[0].y,e[0].z),h.push(e[1].x,e[1].y,e[1].z)}))}de.push(a[0][0],o[p][0],a[p][0],o[0][0])}}},pe=0;pe<x.length;pe++)fe(pe);for(;de.length;){var ve,me=void 0,ge=void 0,ye=void 0,be=de.splice(0,2),we=Object(g.a)(be,2);ve=we[0],me=we[1];for(var xe=[ve];ve!=me;)xe.push(me),ye=(ge=de.indexOf(me))%2,me=de.splice(ge-ye,2)[1-ye];m.subVectors(xe[0],xe[1]).cross(t.subVectors(xe[0],xe[2])).normalize();var Oe=m.dot(xe[0])<0;Oe&&m.negate();for(var ke=1;ke<=xe.length-2;ke++)[xe[ke+ +Oe],xe[ke+1-+Oe],xe[0]].forEach((function(e){c.push(e.x,e.y,e.z),h.push(m.x,m.y,m.z)}))}}(),function(){for(var e=new tr,t=0;t<c.length;t+=3){e.x=c[t+0],e.y=c[t+1],e.z=c[t+2];var n=k(e)/2/Math.PI+.5,r=_(e)/Math.PI+.5;l.push(n,1-r)}for(var i=new tr,a=new tr,o=new tr,s=new tr,u=new An,h=new An,d=new An,f=function(e,t,n,r){r<0&&1===e.x&&(l[t]=e.x-1),0===n.x&&0===n.z&&(l[t]=r/2/Math.PI+.5)},p=0,v=0;p<c.length;p+=9,v+=6){i.set(c[p+0],c[p+1],c[p+2]),a.set(c[p+3],c[p+4],c[p+5]),o.set(c[p+6],c[p+7],c[p+8]),u.set(l[v+0],l[v+1]),h.set(l[v+2],l[v+3]),d.set(l[v+4],l[v+5]),s.copy(i).add(a).add(o).divideScalar(3);var m=k(s);f(u,v+0,i,m),f(h,v+2,a,m),f(d,v+4,o,m)}for(var g=0;g<l.length;g+=6){var y=l[g+0],b=l[g+2],w=l[g+4],x=Math.max(y,b,w),O=Math.min(y,b,w);x>.9&&O<.1&&(y<.2&&(l[g+0]+=1),b<.2&&(l[g+2]+=1),w<.2&&(l[g+4]+=1))}function k(e){return Math.atan2(e.z,-e.x)}function _(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}}(),e.setAttribute("position",new _i(c,3)),e.setAttribute("normal",new _i(h,3)),e.setAttribute("uv",new _i(l,2)),Object(y.a)(e)}return Object(A.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}}]),n}(Di),c_=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(r=a.height)&&void 0!==r?r:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:a.width)})}}},{key:"build",value:function(e){var t=e.parameters,n=t.width,r=t.height,i=t.depth,a=t.detail,o=t.corner,s=t.cornerSides,u=0===a&&0!==o?new l_(.5*n,o,s):new qu(.5*n,a);return u.scale(1,r/n,i/n),Object.assign(u,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"DodecahedronGeometry"})})}}]),e}(),l_=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;Object(E.a)(this,n);var o=(1+Math.sqrt(5))/2,s=1/o,u=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-o,0,-s,o,0,s,-o,0,s,o,-s,-o,0,-s,o,0,s,-o,0,s,o,0,-o,0,-s,o,0,-s,-o,0,s,o,0,s],c="DodecahedronGeometry";return(e=t.call(this,u,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],c,r,i,a)).type=c,e}return Object(A.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.corner,e.cornerSides)}}]),n}(u_),h_=1e-12,d_=function(){function e(t){Object(E.a)(this,e),this.position=new An,this.startPosition=new An,this.uuid=En.generateUUID(),this.position=t.clone()}return Object(A.a)(e,[{key:"start",value:function(){this.reset()}},{key:"reset",value:function(){this.startPosition.copy(this.position)}},{key:"applyOffset",value:function(e){this.position.copy(this.startPosition).add(e)}},{key:"copy",value:function(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}},{key:"clone",value:function(){return new e(this.position).copy(this)}},{key:"toJSON",value:function(){return[this.position.x,this.position.y]}}]),e}(),f_=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,e.position)).parent=e,r}return Object(A.a)(n,[{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this}},{key:"clone",value:function(){return new n(this.parent).copy(this)}}]),n}(d_),p_=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;return Object(E.a)(this,n),(i=t.call(this,r)).controls=[],i.roundness=0,i.areControlsDirectionsMirrored=!0,i.uuid=e,i.controls.push(new f_(Object(x.a)(i)),new f_(Object(x.a)(i))),i}return Object(A.a)(n,[{key:"getOppositeControl",value:function(e){var t=this.controls.indexOf(e);return 0===t?this.controls[1]:1===t?this.controls[0]:null}},{key:"applyOffsetToControls",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,r=this.controls.length;n<r;n++){var i=this.controls[n];this.position.distanceTo(i.position)<=t?i.position.copy(this.position):i.applyOffset(e)}}},{key:"controlsMoved",value:function(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}},{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}},{key:"clone",value:function(){return new n(this.uuid,this.position).copy(this)}},{key:"toJSON",value:function(){return Object(b.a)(Object(w.a)(n.prototype),"toJSON",this).call(this).concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}},{key:"computeTangents",value:function(){var e,t;return[null===(e=this.curveBefore)||void 0===e?void 0:e.getTangentAt(1),null===(t=this.curveAfter)||void 0===t?void 0:t.getTangentAt(0)]}},{key:"computeNormals",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new An,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An,n=this.computeTangents(),r=Object(g.a)(n,2),i=r[0],a=r[1];return i&&a&&(v_(i,e),v_(a,t)),[e,t]}},{key:"computeTangent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new An,t=this.computeTangents(),n=Object(g.a)(t,2),r=n[0],i=n[1];return r&&i&&e.copy(r).add(i).normalize(),e}},{key:"computeNormal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new An,t=this.computeNormals(),n=Object(g.a)(t,2),r=n[0],i=n[1];return e.copy(r).add(i).normalize(),e}}],[{key:"create",value:function(e,t){var r,i,a=new n(e,Object(l.a)(An,Object(v.a)(t.position)));return(r=a.controls[0].position).set.apply(r,Object(v.a)(t.controlPrevious.position)),(i=a.controls[1].position).set.apply(i,Object(v.a)(t.controlNext.position)),a.roundness=t.roundness,a.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,a}}]),n}(d_);function v_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An,n=e.length();return t.set(-e.y/n,e.x/n)}var m_=function(e){return e},g_=new An,y_=new An,b_=new An,w_=new An,x_=new An,O_=new An,k_=new tr,__=new tr;function S_(e){var t=new An;t.addVectors(e.v0,g_.subVectors(e.v1,e.v0).multiplyScalar(2/3));var n=new An;return n.addVectors(e.v2,y_.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new Du(e.v0,t,n,e.v2)}function E_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return Math.abs(e-t)<n}function A_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return e.distanceTo(t)<n}function j_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return e.distanceTo(t)<n}function T_(e,t,n){var r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),i=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)),a=Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2));return Math.acos((i*i+r*r-a*a)/(2*i*r))}function M_(e,t,n){return L_(e,t)&&L_(t,n)&&C_(e.position,t.position,n.position)}function C_(e,t,n){return 0===g_.copy(t).sub(e).cross(y_.copy(n).sub(e))}function D_(e,t,n,r,i){var a=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),o=(e.y+t.y)/2,s=(e.x+t.x)/2,u=Math.sqrt(Math.pow(n,2)-Math.pow(a/2,2))*(e.y-t.y)/a,c=Math.sqrt(Math.pow(n,2)-Math.pow(a/2,2))*(t.x-e.x)/a;return r.set(s+u,o+c),i.set(s-u,o-c),[r,i]}function I_(e,t,n){return e.distanceTo(n)<t.distanceTo(n)?t:e}function P_(e,t,n,r,i,a){var o,s=t.x-e.x,u=t.y-e.y,c=n.x-e.x,l=n.y-e.y,h=Math.sqrt((s+c)*(s+c)+(u+l)*(u+l));return T_(t,e,n)>Math.PI&&(h*=-1),o=E_(l,u)?(u+l)*(r/h-.5)*8/3/(s-c):(s+c)*(r/h-.5)*8/3/(l-u),i.set(t.x-o*u,t.y+o*s),a.set(n.x+o*l,n.y-o*c),[i,a]}function R_(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function L_(e,t){return C_(e.position,e.controls[1].position,t.position)&&C_(e.position,t.controls[0].position,t.position)}function N_(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[],i=0,a=e.length;i<a;i++){var o=e[i],s=0;if(n&&void 0!==o.roundedCurveCorner){var u=.5*B_(o.roundedCurveCorner,t);i>0&&(r[i-1]+=u),s+=u}void 0!==o.curveAfter&&(s+=B_(o.curveAfter,t)),r.push(s)}return e.length>0&&n&&void 0!==e[0].roundedCurveCorner&&(r[e.length-1]+=.5*B_(e[0].roundedCurveCorner,t)),r}function B_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return e&&e instanceof xu?2*t:e&&(e instanceof Pu||e instanceof Ru)?1:e&&e instanceof Bu?t*e.points.length:t}var F_,U_,z_=new An,V_=new An,G_=new An,H_=new An,W_=new An,q_=new An,Y_=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return Object(E.a)(this,n),(e=t.call(this)).points=[],e.shapeHoles=[],e.plane=new va(new tr(0,0,-1)),e.subdivision=0,e.controlSnapDistance=4,e.pointIDs=0,e.isMesh2D=!1,e._roundness=0,e.isClosed=!1,e.useCubicForRoundedCorners=!0,e.uuid=En.generateUUID(),e.needsUpdate=!1,e.roundedCurves=[],e._width=r,e._height=i,e}return Object(A.a)(n,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"roundness",get:function(){return this._roundness},set:function(e){if(this._roundness!==e){this._roundness=e;for(var t=0,n=this.points.length;t<n;t++)this.points[t].roundness=e;this.needsUpdate=!0}}},{key:"getPointsIndexesByIds",value:function(e){var t=this;return e.map((function(e){return t.getPointIndexById(e)})).filter((function(e){return e>=0}))}},{key:"getPointIndexById",value:function(e){var t=this.points.length,n=this.points.findIndex((function(t){return t.uuid===e}));if(n<0)for(var r=t,i=0,a=this.shapeHoles.length;i<a;i++){var o=this.shapeHoles[i],s=o.points.length,u=o.getPointIndexById(e);if(!(u<0))return u+r;r+=s}return n}},{key:"getLineIndexById",value:function(e){return this.getPointIndexById(e)}},{key:"getBezierPoint",value:function(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0)for(var t=this.points.length,n=0,r=this.shapeHoles.length;n<r;n++){var i=this.shapeHoles[n],a=e-t;if(a<=i.points.length-1)return i.points[a];t+=i.points.length}throw new Error("This shape does not have a point for this index: "+e)}},{key:"getBezierPointIndex",value:function(e){var t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(var n=0,r=this.shapeHoles.length;n<r;n++){var i=this.shapeHoles[n],a=i.points.indexOf(e);if(a>=0)return t+a;t+=i.points.length}return-1}},{key:"getAllPoints",value:function(){var e,t=(e=[]).concat.apply(e,Object(v.a)(this.shapeHoles.map((function(e){return e.points}))));return[].concat(Object(v.a)(this.points),Object(v.a)(t))}},{key:"applySize",value:function(e,t){0===e&&(e=.001),0===t&&(t=.001),this._width=e,this._height=t}},{key:"applyScale",value:function(e,t){for(var n=z_.set(e,t),r=0,i=this.points.length;r<i;r++){var a=this.points[r];a.position.multiply(n),a.controls[0].position.multiply(n),a.controls[1].position.multiply(n)}for(var o=0,s=this.shapeHoles.length;o<s;o++)this.shapeHoles[o].applyScale(e,t);this._update()}},{key:"createPoint",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:En.generateUUID();t=e instanceof An?e:new An(e,n);var i=new p_(r,t);return i.roundness=this.roundness,i}},{key:"addPoint",value:function(e){this.points.push(e),this.needsUpdate=!0}},{key:"addPointAt",value:function(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}},{key:"getPointByUuid",value:function(e){for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];if(r.uuid===e)return r}for(var i=0,a=this.shapeHoles.length;i<a;i++){var o=this.shapeHoles[i].getPointByUuid(e);if(o)return o}}},{key:"getFirstPoint",value:function(){return this.points[0]}},{key:"getLastPoint",value:function(){return this.points[this.points.length-1]}},{key:"removePoint",value:function(e){var t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}},{key:"removePointById",value:function(e){var t=this.points.find((function(t){return t.uuid===e}));t&&this.removePoint(t)}},{key:"update",value:function(){for(var e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}},{key:"extractShapePointsToBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t);var r=n?this.roundedCurveDivisions:this.curveDivisions;return function(e,t){for(var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=__.set(0,0,0),o=0,s=[],u=0;u<t.length;u++){var c=m_(t[u]),l=g_,h=B_(c,r);s.push(h);for(var d=0;d<=h;d++)if(c instanceof Du||c instanceof Lu||c instanceof Pu){if(c.getPoint(d/h,l),a.set(l.x,l.y,0),void 0!==n&&j_(n,a))continue;void 0===n&&(n=k_),n.copy(a),e.setXYZ(o,a.x,a.y,a.z),o++}}i&&o>1&&!(e.getX(o-1)===e.getX(0)&&e.getY(o-1)===e.getY(0)&&e.getZ(o-1)===e.getZ(0))&&(e.setXYZ(o,e.getX(0),e.getY(0),e.getZ(0)),o++)}(e,n?this.roundedCurves:this.curves,t,this.autoClose),r.reduce((function(e,t){return e+t}),0)+1}},{key:"computeCurveDivisions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;return this.curveDivisions=N_(this.points,e,!1),this.roundedCurveDivisions=N_(this.points,e,!0),this.curveDivisions}},{key:"extractFilteredShapePointsToBuffer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12;return 2*function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=__.set(0,0,0),o=0,s=[],u=0;u<t.length;u++)if(!1!==n[u]){var c=void 0,l=m_(t[u]),h=g_,d=B_(l,r);s.push(d);for(var f=0;f<=d;f++)if(l instanceof Du||l instanceof Lu||l instanceof Pu){var p;if(l.getPoint(f/d,h),a.set(h.x,h.y,0),null!==(p=c)&&void 0!==p&&p.equals(a))continue;void 0===c?c=k_:(e.setXYZ(o,c.x,c.y,c.z),o++,e.setXYZ(o,a.x,a.y,a.z),o++),c.copy(a)}}return i&&o>1&&!(e.getX(o-1)===e.getX(0)&&e.getY(o-1)===e.getY(0)&&e.getZ(o-1)===e.getZ(0))&&(e.setXYZ(o,e.getX(0),e.getY(0),e.getZ(0)),o++),s}(e,this.curves,t,n,this.autoClose).reduce((function(e,t){return e+t}),0)}},{key:"extractShapePointsToFlatArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t),function(e,t){for(var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=0,o=0;o<t.length;o++)for(var s=m_(t[o]),u=B_(s,r),c=g_,l=0;l<=u;l++)if(s instanceof Du||s instanceof Lu||s instanceof Pu){if(s.getPoint(l/u,c),void 0!==n&&A_(n,c,h_))continue;void 0===n&&(n=y_),n.copy(c),e.push(c.x,c.y),a++}return E_(e[0],e[e.length-2],h_)&&E_(e[1],e[e.length-1],h_)&&(e.pop(),e.pop()),i&&a>1&&!(E_(e[a-1],e[1],h_)&&E_(e[a-2],e[0],h_))&&(e.push(e[0],e[1]),a++),e}(e,this.roundedCurves,t,this.autoClose)}},{key:"getCurveIndexFromVertexId",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=0;void 0===this.curveDivisions&&this.computeCurveDivisions(this.subdivision);var r=t?this.roundedCurveDivisions:this.curveDivisions,i=0;t&&void 0!==this.points[0].roundedCurveCorner&&(i=.5*B_(this.points[0].roundedCurveCorner,this.subdivision));var a=e-i;a<0&&(a+=r.reduce((function(e,t){return e+t}),0));for(var o=0,s=r.length;o<s;o++){var u=r[o];if(a<n+u)return[o,(a-n+1)/u];n+=u}return[0,1]}},{key:"getCurveT",value:function(e,t,n){var r=this.points[e],i=this.points[e>=this.points.length-1?0:e+1],a=this.curveDivisions,o=a[e];if(R_(r,i)){var s=r.position.distanceTo(i.position);return r.position.distanceTo(z_.set(n.x,n.y))/s}for(var u=0,c=0;c<e;c++)u+=a[c];return(t-u)/o}},{key:"dispose",value:function(){}},{key:"_applyCurveForPoint",value:function(e,t){R_(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);var n=this.curves[this.curves.length-1];e.curveBefore=n,t.curveAfter=n;var r=n.clone();e.roundedCurveBefore=r,t.roundedCurveAfter=r,e.roundedCurveCorner=void 0,this.roundedCurves.push(r)}},{key:"_update",value:function(){if(this.curves=[],this.roundedCurves=[],this.points.length){for(var e=0,t=this.points.length;e<t;e++){var n=this.points[e];if(0===e)this.moveTo(n.position.x,n.position.y);else{var r=this.points[e-1];this._applyCurveForPoint(n,r)}}var i=this.getLastPoint();if(null!==i&&void 0!==i&&i.curveAfter&&(i.curveAfter=void 0),this.isClosed){var a=this.points[0],o=this.points[this.points.length-1];this._applyCurveForPoint(a,o)}if(this.points.length>2)for(var s=0,u=0,c=this.points.length;u<c;u++){var l,h,d=this.points[u],f=null!==(l=this.points[u-1])&&void 0!==l?l:this.points[this.points.length-1],p=null!==(h=this.points[u+1])&&void 0!==h?h:this.points[0],v=d.roundness,m=f&&p&&M_(f,d,p);if(!d.controlsMoved()&&v>0&&!m){var y=d.curveBefore,b=d.curveAfter;if(void 0===y||void 0===b)continue;var w=d.roundedCurveBefore,x=d.roundedCurveAfter,O=y.getLength(),k=b.getLength(),_=Math.min(v,.499*O),S=Math.min(v,.499*k),E=Math.min(_,S),A=1-E/O,j=E/k,T=y.getPointAt(A,z_),M=b.getPointAt(j,V_);this._subSplitCurve(y,w,A,T,void 0),this._subSplitCurve(b,x,j,void 0,M);var C=void 0;if(this.useCubicForRoundedCorners){var D=T_(T,d.position,M)/2,I=Math.tan(D)*T.distanceTo(d.position),P=D_(T,M,I,G_,H_),R=Object(g.a)(P,2),L=P_(I_(R[0],R[1],d.position),T,M,I,W_,q_),N=Object(g.a)(L,2),B=N[0],F=N[1];C=new Du(T.clone(),B.clone(),F.clone(),M.clone())}else C=new Lu(T.clone(),d.position.clone(),M.clone());d.roundedCurveCorner=C,this.roundedCurves.splice(u+s,0,C),s++}}}}},{key:"_subSplitCurve",value:function(e,t,n,r,i){if(!(e instanceof Pu)){var a=e,o=t,s=a.getUtoTmapping(n,0),u=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,a=g_.subVectors(t,e).multiplyScalar(i).add(e),o=y_.subVectors(n,t).multiplyScalar(i).add(t),s=b_.subVectors(r,n).multiplyScalar(i).add(n),u=a,c=w_.subVectors(o,a).multiplyScalar(i).add(a),l=x_.subVectors(s,o).multiplyScalar(i).add(o),h=s,d=O_.subVectors(l,c).multiplyScalar(i).add(c);return[e.x,e.y,u.x,u.y,c.x,c.y,d.x,d.y,l.x,l.y,h.x,h.y,r.x,r.y]}(a.v0,a.v1,a.v2,a.v3,s);return void 0!==r&&(o.v0.set(u[0],u[1]),o.v1.set(u[2],u[3]),o.v2.set(u[4],u[5]),o.v3.set(u[6],u[7])),void 0!==i&&(o.v0.set(u[6],u[7]),o.v1.set(u[8],u[9]),o.v2.set(u[10],u[11]),o.v3.set(u[12],u[13])),o}return void 0!==r&&t.v2.copy(r),void 0!==i&&t.v1.copy(i),t}},{key:"clone",value:function(){var e=new n(this._width,this._height);return e.points=this.points.map((function(e){return e.clone()})),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map((function(e){return e.clone()})),e}},{key:"toJSON",value:function(){return{points:this.points.reduce((function(e,t){return e.concat(t.toJSON())}),[]),shapeHoles:this.shapeHoles.map((function(e){return e.toJSON()})),isClosed:this.isClosed,roundness:this.roundness}}},{key:"fromJSON",value:function(e){var t;this.points=[],this.pointIDs=0;for(var r=e.points.length/7,i=0;i<r;i++){var a=7*i,o=e.points[a+0],s=e.points[a+1],u=e.points[a+2],c=e.points[a+3],l=e.points[a+4],h=e.points[a+5],d=e.points[a+6],f=new p_(En.generateUUID(),new An(o,s));f.controls[0].position.set(u,c),f.controls[1].position.set(l,h),f.roundness=d,this.points.push(f)}return this.shapeHoles=null!==(t=e.shapeHoles)&&void 0!==t&&t.length?e.shapeHoles.map((function(e){var t=new n;return t.fromJSON(e),t})):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}},{key:"fromShape",value:function(e){var t=this,r=function(e,t){t instanceof Du&&t.v3.equals(e.position)&&e.controls[0].position.copy(t.v2)};return this.points=function(e){var n,i,a=[];for(n=0,i=e.length;n<i;n++)e[n]instanceof Lu&&(e[n]=S_(e[n]));for(n=0,i=e.length;n<i;n++){var o=e[n],s=n>0?e[n-1]:null,u=void 0;o instanceof Du?(u=t.createPoint(o.v0)).controls[1].position.copy(o.v1):o instanceof Pu&&(u=t.createPoint(o.v1)),void 0!==u&&(null!==s&&r(u,s),a.push(u))}var c=e[e.length-1],l=!1;return c instanceof Du?c.v3.equals(a[0].position)&&(a[0].controls[0].position.copy(c.v2),l=!0):c instanceof Pu&&c.v2.equals(a[0].position)&&(l=!0),t.isClosed=l,a}(e.curves),e instanceof Yu&&(this.shapeHoles=e.holes.map((function(e){var t=new n;return t.fromShape(e),t}))),this.update(),this}},{key:"updatePoint",value:function(e,t){var n=this.getPointByUuid(e);n&&(void 0!==t.position&&n.position.fromArray(t.position),void 0!==t.roundness&&(n.roundness=t.roundness),void 0!==t.areControlsDirectionsMirrored&&(n.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}},{key:"updatePreviousControl",value:function(e,t){var n,r=null===(n=this.getPointByUuid(e))||void 0===n?void 0:n.controls[0];r&&(t.position&&r.position.fromArray(t.position),this.needsUpdate=!0)}},{key:"updateNextControl",value:function(e,t){var n,r=null===(n=this.getPointByUuid(e))||void 0===n?void 0:n.controls[1];r&&(t.position&&r.position.fromArray(t.position),this.needsUpdate=!0)}}],[{key:"createFromState",value:function(e,t,r){var i=new n;return i.isClosed=e.isClosed,i.points=e.points.map((function(e){return p_.create(e.id,e.data)})),"number"==typeof e.roundness&&(i.roundness=e.roundness),i.shapeHoles=e.shapeHoles.map((function(e){return n.createFromState(e)})),void 0!==t&&void 0!==r&&i.applySize(t,r),i.update(),i}}]),n}(Yu),X_=2*Math.PI;function K_(e,t,n,r,i){return{x:e.x*t+r,y:e.y*n+i}}function Q_(e,t){var n=1.5707963267948966===t?.551915024494:-1.5707963267948966===t?-.551915024494:1.3333333333333333*Math.tan(t/4),r=Math.cos(e),i=Math.sin(e),a=Math.cos(e+t),o=Math.sin(e+t);return[{x:r-i*n,y:i+r*n},{x:a+o*n,y:o-a*n},{x:a,y:o}]}function Z_(e,t,n,r){var i=e*r-t*n<0?-1:1,a=Math.min(1,Math.max(-1,e*n+t*r));return i*Math.acos(a)}function J_(e){var t=e.px,n=e.py,r=e.cx,i=e.cy,a=e.rx,o=e.ry,s=e.largeArcFlag,u=e.sweepFlag,c=[];if(0===a||0===o)return[];var l=(t-r)/2,h=(n-i)/2;if(0===l&&0===h)return[];a=Math.abs(a),o=Math.abs(o);var d=Math.pow(l,2)/Math.pow(a,2)+Math.pow(h,2)/Math.pow(o,2);d>1&&(a*=Math.sqrt(d),o*=Math.sqrt(d));var f=function(e,t,n,r,i,a,o,s,u,c){var l=Math.pow(i,2),h=Math.pow(a,2),d=Math.pow(o,2),f=Math.pow(s,2),p=l*h-l*f-h*d;p<0&&(p=0),p/=l*f+h*d;var v=(p=Math.sqrt(p)*(u===c?-1:1))*i/a*s,m=p*-a/i*o,g=v+(e+n)/2,y=m+(t+r)/2,b=(o-v)/i,w=(s-m)/a,x=(-o-v)/i,O=(-s-m)/a,k=Z_(1,0,b,w),_=Z_(b,w,x,O);return!c&&_>0&&(_-=X_),c&&_<0&&(_+=X_),{centerx:g,centery:y,ang1:k,ang2:_}}(t,n,r,i,a,o,l,h,s,u),p=f.ang1,v=f.ang2,m=f.centerx,g=f.centery,y=Math.abs(v)/(X_/4);Math.abs(1-y)<1e-7&&(y=1);var b=Math.max(Math.ceil(y),1);v/=b;for(var w=0;w<b;w++)c.push(Q_(p,v)),p+=v;return c.map((function(e){var t=K_(e[0],a,o,m,g),n=t.x,r=t.y,i=K_(e[1],a,o,m,g),s=i.x,u=i.y,c=K_(e[2],a,o,m,g);return{x1:n,y1:r,x2:s,y2:u,x:c.x,y:c.y}}))}function $_(e,t){if(!e)throw t||"Assertion Failed!"}!function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"}(F_||(F_={})),function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"}(U_||(U_={}));var eS=function(){function e(){}return e.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},e.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},e.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},e.edgeEval=function(t,n,r){$_(e.vertLeq(t,n)&&e.vertLeq(n,r));var i=n.s-t.s,a=r.s-n.s;return i+a>0?i<a?n.t-t.t+(t.t-r.t)*(i/(i+a)):n.t-r.t+(r.t-t.t)*(a/(i+a)):0},e.edgeSign=function(t,n,r){$_(e.vertLeq(t,n)&&e.vertLeq(n,r));var i=n.s-t.s,a=r.s-n.s;return i+a>0?(n.t-r.t)*i+(n.t-t.t)*a:0},e.transEval=function(t,n,r){$_(e.transLeq(t,n)&&e.transLeq(n,r));var i=n.t-t.t,a=r.t-n.t;return i+a>0?i<a?n.s-t.s+(t.s-r.s)*(i/(i+a)):n.s-r.s+(r.s-t.s)*(a/(i+a)):0},e.transSign=function(t,n,r){$_(e.transLeq(t,n)&&e.transLeq(n,r));var i=n.t-t.t,a=r.t-n.t;return i+a>0?(n.s-r.s)*i+(n.s-t.s)*a:0},e.vertCCW=function(e,t,n){return e.s*(t.t-n.t)+t.s*(n.t-e.t)+n.s*(e.t-t.t)>=0},e.interpolate=function(e,t,n,r){return(e=e<0?0:e)<=(n=n<0?0:n)?0===n?(t+r)/2:t+e/(e+n)*(r-t):r+n/(e+n)*(t-r)},e.intersect=function(t,n,r,i,a){var o,s,u;e.vertLeq(t,n)||(u=t,t=n,n=u),e.vertLeq(r,i)||(u=r,r=i,i=u),e.vertLeq(t,r)||(u=t,t=r,r=u,u=n,n=i,i=u),e.vertLeq(r,n)?e.vertLeq(n,i)?((o=e.edgeEval(t,r,n))+(s=e.edgeEval(r,n,i))<0&&(o=-o,s=-s),a.s=e.interpolate(o,r.s,s,n.s)):((o=e.edgeSign(t,r,n))+(s=-e.edgeSign(t,i,n))<0&&(o=-o,s=-s),a.s=e.interpolate(o,r.s,s,i.s)):a.s=(r.s+n.s)/2,e.transLeq(t,n)||(u=t,t=n,n=u),e.transLeq(r,i)||(u=r,r=i,i=u),e.transLeq(t,r)||(u=t,t=r,r=u,u=n,n=i,i=u),e.transLeq(r,n)?e.transLeq(n,i)?((o=e.transEval(t,r,n))+(s=e.transEval(r,n,i))<0&&(o=-o,s=-s),a.t=e.interpolate(o,r.t,s,n.t)):((o=e.transSign(t,r,n))+(s=-e.transSign(t,i,n))<0&&(o=-o,s=-s),a.t=e.interpolate(o,r.t,s,i.t)):a.t=(r.t+n.t)/2},e}(),tS=function(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1},nS=function(){function e(e){this.side=e,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(e){this.Sym.Lface=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(e){this.Sym.Org=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(e){this.Sym.Lnext=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(e){this.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(e){this.Lnext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(e){this.Sym.Onext=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(e){this.Sym.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(e){this.Sym.Lnext.Sym=e},enumerable:!0,configurable:!0}),e}(),rS=function(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0},iS=function(){function e(){var e=new rS,t=new tS,n=new nS(0),r=new nS(1);e.next=e.prev=e,e.anEdge=null,t.next=t.prev=t,n.next=n,n.Sym=r,r.next=r,r.Sym=n,this.vHead=e,this.fHead=t,this.eHead=n,this.eHeadSym=r}return e.prototype.makeEdge_=function(e){var t=new nS(0),n=new nS(1);e.Sym.side<e.side&&(e=e.Sym);var r=e.Sym.next;return n.next=r,r.Sym.next=t,t.next=e,e.Sym.next=n,t.Sym=n,t.Onext=t,t.Lnext=n,t.Org=null,t.Lface=null,t.winding=0,t.activeRegion=null,n.Sym=t,n.Onext=n,n.Lnext=t,n.Org=null,n.Lface=null,n.winding=0,n.activeRegion=null,t},e.prototype.splice_=function(e,t){var n=e.Onext,r=t.Onext;n.Sym.Lnext=t,r.Sym.Lnext=e,e.Onext=r,t.Onext=n},e.prototype.makeVertex_=function(e,t,n){var r=e;$_(r,"Vertex can't be null!");var i=n.prev;r.prev=i,i.next=r,r.next=n,n.prev=r,r.anEdge=t;var a=t;do{a.Org=r,a=a.Onext}while(a!==t)},e.prototype.makeFace_=function(e,t,n){var r=e;$_(r,"Face can't be null");var i=n.prev;r.prev=i,i.next=r,r.next=n,n.prev=r,r.anEdge=t,r.trail=null,r.marked=!1,r.inside=n.inside;var a=t;do{a.Lface=r,a=a.Lnext}while(a!==t)},e.prototype.killEdge_=function(e){e.Sym.side<e.side&&(e=e.Sym);var t=e.next,n=e.Sym.next;t.Sym.next=n,n.Sym.next=t},e.prototype.killVertex_=function(e,t){var n=e.anEdge,r=n;do{r.Org=t,r=r.Onext}while(r!==n);var i=e.prev,a=e.next;a.prev=i,i.next=a},e.prototype.killFace_=function(e,t){var n=e.anEdge,r=n;do{r.Lface=t,r=r.Lnext}while(r!==n);var i=e.prev,a=e.next;a.prev=i,i.next=a},e.prototype.makeEdge=function(){var e=new rS,t=new rS,n=new tS,r=this.makeEdge_(this.eHead);return this.makeVertex_(e,r,this.vHead),this.makeVertex_(t,r.Sym,this.vHead),this.makeFace_(n,r,this.fHead),r},e.prototype.splice=function(e,t){var n=!1,r=!1;if(e!==t){if(t.Org!==e.Org&&(r=!0,this.killVertex_(t.Org,e.Org)),t.Lface!==e.Lface&&(n=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(t,e),!r){var i=new rS;this.makeVertex_(i,t,e.Org),e.Org.anEdge=e}if(!n){var a=new tS;this.makeFace_(a,t,e.Lface),e.Lface.anEdge=e}}},e.prototype.delete=function(e){var t=e.Sym,n=!1;if(e.Lface!==e.Rface&&(n=!0,this.killFace_(e.Lface,e.Rface)),e.Onext===e)this.killVertex_(e.Org,null);else if(e.Rface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev),!n){var r=new tS;this.makeFace_(r,e,e.Lface)}t.Onext===t?(this.killVertex_(t.Org,null),this.killFace_(t.Lface,null)):(e.Lface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),this.killEdge_(e)},e.prototype.addEdgeVertex=function(e){var t=this.makeEdge_(e),n=t.Sym;this.splice_(t,e.Lnext),t.Org=e.Dst;var r=new rS;return this.makeVertex_(r,n,t.Org),t.Lface=n.Lface=e.Lface,t},e.prototype.splitEdge=function(e){var t=this.addEdgeVertex(e).Sym;return this.splice_(e.Sym,e.Sym.Oprev),this.splice_(e.Sym,t),e.Dst=t.Org,t.Dst.anEdge=t.Sym,t.Rface=e.Rface,t.winding=e.winding,t.Sym.winding=e.Sym.winding,t.idx=e.idx,t.Sym.idx=e.Sym.idx,t},e.prototype.connect=function(e,t){var n=!1,r=this.makeEdge_(e),i=r.Sym;if(t.Lface!==e.Lface&&(n=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(r,e.Lnext),this.splice_(i,t),r.Org=e.Dst,i.Org=t.Org,r.Lface=i.Lface=e.Lface,e.Lface.anEdge=i,!n){var a=new tS;this.makeFace_(a,r,e.Lface)}return r},e.prototype.zapFace=function(e){var t,n,r,i,a,o=e.anEdge;n=o.Lnext;do{n=(t=n).Lnext,t.Lface=null,null===t.Rface&&(t.Onext===t?this.killVertex_(t.Org,null):(t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),(r=t.Sym).Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),this.killEdge_(t))}while(t!=o);i=e.prev,(a=e.next).prev=i,i.next=a},e.prototype.countFaceVerts_=function(e){var t=e.anEdge,n=0;do{n++,t=t.Lnext}while(t!==e.anEdge);return n},e.prototype.mergeConvexFaces=function(e){var t,n,r,i,a;for(t=this.fHead.next;t!==this.fHead;t=t.next)if(t.inside)for(a=(n=t.anEdge).Org;r=n.Lnext,(i=n.Sym)&&i.Lface&&i.Lface.inside&&(this.countFaceVerts_(t)+this.countFaceVerts_(i.Lface)-2<=e&&eS.vertCCW(n.Lprev.Org,n.Org,i.Lnext.Lnext.Org)&&eS.vertCCW(i.Lprev.Org,i.Org,n.Lnext.Lnext.Org)&&(r=i.Lnext,this.delete(i),n=null,i=null)),!n||n.Lnext.Org!==a;)n=r;return!0},e.prototype.check=function(){var e,t,n,r,i,a,o=this.fHead,s=this.vHead,u=this.eHead;for(t=o,t=o;(e=t.next)!==o;t=e){$_(e.prev===t),i=e.anEdge;do{$_(i.Sym!==i),$_(i.Sym.Sym===i),$_(i.Lnext.Onext.Sym===i),$_(i.Onext.Sym.Lnext===i),$_(i.Lface===e),i=i.Lnext}while(i!==e.anEdge)}for($_(e.prev===t&&null===e.anEdge),r=s,r=s;(n=r.next)!==s;r=n){$_(n.prev===r),i=n.anEdge;do{$_(i.Sym!==i),$_(i.Sym.Sym===i),$_(i.Lnext.Onext.Sym===i),$_(i.Onext.Sym.Lnext===i),$_(i.Org===n),i=i.Onext}while(i!==n.anEdge)}for($_(n.prev===r&&null===n.anEdge),a=u,a=u;(i=a.next)!==u;a=i)$_(i.Sym.next===a.Sym),$_(i.Sym!==i),$_(i.Sym.Sym===i),$_(null!==i.Org),$_(null!==i.Dst),$_(i.Lnext.Onext.Sym===i),$_(i.Onext.Sym.Lnext===i);$_(i.Sym.next===a.Sym&&i.Sym===this.eHeadSym&&i.Sym.Sym===i&&null===i.Org&&null===i.Dst&&null===i.Lface&&null===i.Rface)},e}(),aS=function(){this.handle=null},oS=function(){this.key=null,this.node=0},sS=function(){function e(e,t){this.leq=t,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=e,this.nodes=[],this.handles=[];for(var n=0;n<e+1;n++)this.nodes[n]=new aS,this.handles[n]=new oS;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(e){var t,n,r,i=this.nodes,a=this.handles;for(t=i[e].handle;;){if((r=e<<1)<this.size&&this.leq(a[i[r+1].handle].key,a[i[r].handle].key)&&++r,$_(r<=this.max),n=i[r].handle,r>this.size||this.leq(a[t].key,a[n].key)){i[e].handle=t,a[t].node=e;break}i[e].handle=n,a[n].node=e,e=r}},e.prototype.floatUp_=function(e){var t,n,r,i=this.nodes,a=this.handles;for(t=i[e].handle;;){if(n=i[r=e>>1].handle,0===r||this.leq(a[n].key,a[t].key)){i[e].handle=t,a[t].node=e;break}i[e].handle=n,a[n].node=e,e=r}},e.prototype.init=function(){for(var e=this.size;e>=1;--e)this.floatDown_(e);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(e){var t,n;if(2*(t=++this.size)>this.max){var r,i;for(this.max*=2,i=this.nodes.length,this.nodes.length=this.max+1,r=i;r<this.nodes.length;r++)this.nodes[r]=new aS;for(i=this.handles.length,this.handles.length=this.max+1,r=i;r<this.handles.length;r++)this.handles[r]=new oS}return 0===this.freeList?n=t:(n=this.freeList,this.freeList=this.handles[n].node),this.nodes[t].handle=n,this.handles[n].node=t,this.handles[n].key=e,this.initialized&&this.floatUp_(t),n},e.prototype.extractMin=function(){var e=this.nodes,t=this.handles,n=e[1].handle,r=t[n].key;return this.size>0&&(e[1].handle=e[this.size].handle,t[e[1].handle].node=1,t[n].key=null,t[n].node=this.freeList,this.freeList=n,--this.size,this.size>0&&this.floatDown_(1)),r},e.prototype.delete=function(e){var t,n=this.nodes,r=this.handles;$_(e>=1&&e<=this.max&&null!==r[e].key),n[t=r[e].node].handle=n[this.size].handle,r[n[t].handle].node=t,--this.size,t<=this.size&&(t<=1||this.leq(r[n[t>>1].handle].key,r[n[t].handle].key)?this.floatDown_(t):this.floatUp_(t)),r[e].key=null,r[e].node=this.freeList,this.freeList=e},e}(),uS=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},cS=function(){this.key=null,this.next=null,this.prev=null},lS=function(){function e(e,t){this.frame=e,this.leq=t,this.head=new cS,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(e){return this.insertBefore(this.head,e)},e.prototype.search=function(e){var t=this.head;do{t=t.next}while(null!==t.key&&!this.leq(this.frame,e,t.key));return t},e.prototype.insertBefore=function(e,t){do{e=e.prev}while(null!==e.key&&!this.leq(this.frame,e.key,t));var n=new cS;return n.key=t,n.next=e.next,e.next.prev=n,n.prev=e,e.next=n,n},e.prototype.delete=function(e){e.next.prev=e.prev,e.prev.next=e.next},e}(),hS=function(){function e(){}return e.regionBelow=function(e){return e.nodeUp.prev.key},e.regionAbove=function(e){return e.nodeUp.next.key},e.debugEvent=function(e){},e.addWinding=function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},e.edgeLeq=function(e,t,n){var r=e.event,i=t.eUp,a=n.eUp;return i.Dst===r?a.Dst===r?eS.vertLeq(i.Org,a.Org)?eS.edgeSign(a.Dst,i.Org,a.Org)<=0:eS.edgeSign(i.Dst,a.Org,i.Org)>=0:eS.edgeSign(a.Dst,r,a.Org)<=0:a.Dst===r?eS.edgeSign(i.Dst,r,i.Org)>=0:eS.edgeEval(i.Dst,r,i.Org)>=eS.edgeEval(a.Dst,r,a.Org)},e.deleteRegion=function(e,t){t.fixUpperEdge&&$_(0===t.eUp.winding),t.eUp.activeRegion=null,e.dict.delete(t.nodeUp)},e.fixUpperEdge=function(e,t,n){$_(t.fixUpperEdge),e.mesh.delete(t.eUp),t.fixUpperEdge=!1,t.eUp=n,n.activeRegion=t},e.topLeftRegion=function(t,n){var r,i=n.eUp.Org;do{n=e.regionAbove(n)}while(n.eUp.Org===i);if(n.fixUpperEdge){if(null===(r=t.mesh.connect(e.regionBelow(n).eUp.Sym,n.eUp.Lnext)))return null;e.fixUpperEdge(t,n,r),n=e.regionAbove(n)}return n},e.topRightRegion=function(t){var n=t.eUp.Dst;do{t=e.regionAbove(t)}while(t.eUp.Dst===n);return t},e.addRegionBelow=function(e,t,n){var r=new uS;return r.eUp=n,r.nodeUp=e.dict.insertBefore(t.nodeUp,r),r.fixUpperEdge=!1,r.sentinel=!1,r.dirty=!1,n.activeRegion=r,r},e.isWindingInside=function(e,t){switch(e.windingRule){case F_.ODD:return 0!==(1&t);case F_.NONZERO:return 0!==t;case F_.POSITIVE:return t>0;case F_.NEGATIVE:return t<0;case F_.ABS_GEQ_TWO:return t>=2||t<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,n){n.windingNumber=e.regionAbove(n).windingNumber+n.eUp.winding,n.inside=e.isWindingInside(t,n.windingNumber)},e.finishRegion=function(t,n){var r=n.eUp,i=r.Lface;i.inside=n.inside,i.anEdge=r,e.deleteRegion(t,n)},e.finishLeftRegions=function(t,n,r){for(var i,a=null,o=n,s=n.eUp;o!==r;){if(o.fixUpperEdge=!1,(i=(a=e.regionBelow(o)).eUp).Org!=s.Org){if(!a.fixUpperEdge){e.finishRegion(t,o);break}i=t.mesh.connect(s.Lprev,i.Sym),e.fixUpperEdge(t,a,i)}s.Onext!==i&&(t.mesh.splice(i.Oprev,i),t.mesh.splice(s,i)),e.finishRegion(t,o),s=a.eUp,o=a}return s},e.addRightEdges=function(t,n,r,i,a,o){var s,u,c,l,h=!0;c=r;do{$_(eS.vertLeq(c.Org,c.Dst)),e.addRegionBelow(t,n,c.Sym),c=c.Onext}while(c!==i);for(null===a&&(a=e.regionBelow(n).eUp.Rprev),u=n,l=a;(c=(s=e.regionBelow(u)).eUp.Sym).Org===l.Org;)c.Onext!==l&&(t.mesh.splice(c.Oprev,c),t.mesh.splice(l.Oprev,c)),s.windingNumber=u.windingNumber-c.winding,s.inside=e.isWindingInside(t,s.windingNumber),u.dirty=!0,!h&&e.checkForRightSplice(t,u)&&(e.addWinding(c,l),e.deleteRegion(t,u),t.mesh.delete(l)),h=!1,u=s,l=c;u.dirty=!0,$_(u.windingNumber-c.winding===s.windingNumber),o&&e.walkDirtyRegions(t,u)},e.spliceMergeVertices=function(e,t,n){e.mesh.splice(t,n)},e.vertexWeights=function(e,t,n){var r=eS.vertL1dist(t,e),i=eS.vertL1dist(n,e),a=.5*i/(r+i),o=.5*r/(r+i);e.coords[0]+=a*t.coords[0]+o*n.coords[0],e.coords[1]+=a*t.coords[1]+o*n.coords[1],e.coords[2]+=a*t.coords[2]+o*n.coords[2]},e.getIntersectData=function(t,n,r,i,a,o){n.coords[0]=n.coords[1]=n.coords[2]=0,n.idx=-1,e.vertexWeights(n,r,i),e.vertexWeights(n,a,o)},e.checkForRightSplice=function(t,n){var r=e.regionBelow(n),i=n.eUp,a=r.eUp;if(eS.vertLeq(i.Org,a.Org)){if(eS.edgeSign(a.Dst,i.Org,a.Org)>0)return!1;eS.vertEq(i.Org,a.Org)?i.Org!==a.Org&&(t.pq.delete(i.Org.pqHandle),e.spliceMergeVertices(t,a.Oprev,i)):(t.mesh.splitEdge(a.Sym),t.mesh.splice(i,a.Oprev),n.dirty=r.dirty=!0)}else{if(eS.edgeSign(i.Dst,a.Org,i.Org)<0)return!1;e.regionAbove(n).dirty=n.dirty=!0,t.mesh.splitEdge(i.Sym),t.mesh.splice(a.Oprev,i)}return!0},e.checkForLeftSplice=function(t,n){var r,i=e.regionBelow(n),a=n.eUp,o=i.eUp;if($_(!eS.vertEq(a.Dst,o.Dst)),eS.vertLeq(a.Dst,o.Dst)){if(eS.edgeSign(a.Dst,o.Dst,a.Org)<0)return!1;e.regionAbove(n).dirty=n.dirty=!0,r=t.mesh.splitEdge(a),t.mesh.splice(o.Sym,r),r.Lface.inside=n.inside}else{if(eS.edgeSign(o.Dst,a.Dst,o.Org)>0)return!1;n.dirty=i.dirty=!0,r=t.mesh.splitEdge(o),t.mesh.splice(a.Lnext,o.Sym),r.Rface.inside=n.inside}return!0},e.checkForIntersect=function(t,n){var r,i,a=e.regionBelow(n),o=n.eUp,s=a.eUp,u=o.Org,c=s.Org,l=o.Dst,h=s.Dst,d=new rS;if($_(!eS.vertEq(h,l)),$_(eS.edgeSign(l,t.event,u)<=0),$_(eS.edgeSign(h,t.event,c)>=0),$_(u!==t.event&&c!==t.event),$_(!n.fixUpperEdge&&!a.fixUpperEdge),u===c||Math.min(u.t,l.t)>Math.max(c.t,h.t))return!1;if(eS.vertLeq(u,c)){if(eS.edgeSign(h,u,c)>0)return!1}else if(eS.edgeSign(l,c,u)<0)return!1;return e.debugEvent(t),eS.intersect(l,u,h,c,d),$_(Math.min(u.t,l.t)<=d.t),$_(d.t<=Math.max(c.t,h.t)),$_(Math.min(h.s,l.s)<=d.s),$_(d.s<=Math.max(c.s,u.s)),eS.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),r=eS.vertLeq(u,c)?u:c,eS.vertLeq(r,d)&&(d.s=r.s,d.t=r.t),eS.vertEq(d,u)||eS.vertEq(d,c)?(e.checkForRightSplice(t,n),!1):!eS.vertEq(l,t.event)&&eS.edgeSign(l,t.event,d)>=0||!eS.vertEq(h,t.event)&&eS.edgeSign(h,t.event,d)<=0?h===t.event?(t.mesh.splitEdge(o.Sym),t.mesh.splice(s.Sym,o),n=e.topLeftRegion(t,n),o=e.regionBelow(n).eUp,e.finishLeftRegions(t,e.regionBelow(n),a),e.addRightEdges(t,n,o.Oprev,o,o,!0),!0):l===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(o.Lnext,s.Oprev),a=n,n=e.topRightRegion(n),i=e.regionBelow(n).eUp.Rprev,a.eUp=s.Oprev,s=e.finishLeftRegions(t,a,null),e.addRightEdges(t,n,s.Onext,o.Rprev,i,!0),!0):(eS.edgeSign(l,t.event,d)>=0&&(e.regionAbove(n).dirty=n.dirty=!0,t.mesh.splitEdge(o.Sym),o.Org.s=t.event.s,o.Org.t=t.event.t),eS.edgeSign(h,t.event,d)<=0&&(n.dirty=a.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),!1):(t.mesh.splitEdge(o.Sym),t.mesh.splitEdge(s.Sym),t.mesh.splice(s.Oprev,o),o.Org.s=d.s,o.Org.t=d.t,o.Org.pqHandle=t.pq.insert(o.Org),e.getIntersectData(t,o.Org,u,l,c,h),e.regionAbove(n).dirty=n.dirty=a.dirty=!0,!1)},e.walkDirtyRegions=function(t,n){for(var r,i,a=e.regionBelow(n);;){for(;a.dirty;)n=a,a=e.regionBelow(a);if(!n.dirty&&(a=n,null===(n=e.regionAbove(n))||!n.dirty))return;if(n.dirty=!1,r=n.eUp,i=a.eUp,r.Dst!==i.Dst&&e.checkForLeftSplice(t,n)&&(a.fixUpperEdge?(e.deleteRegion(t,a),t.mesh.delete(i),i=(a=e.regionBelow(n)).eUp):n.fixUpperEdge&&(e.deleteRegion(t,n),t.mesh.delete(r),r=(n=e.regionAbove(a)).eUp)),r.Org!==i.Org)if(r.Dst===i.Dst||n.fixUpperEdge||a.fixUpperEdge||r.Dst!==t.event&&i.Dst!==t.event)e.checkForRightSplice(t,n);else if(e.checkForIntersect(t,n))return;r.Org===i.Org&&r.Dst===i.Dst&&(e.addWinding(i,r),e.deleteRegion(t,n),t.mesh.delete(r),n=e.regionAbove(a))}},e.connectRightVertex=function(t,n,r){var i,a=r.Onext,o=e.regionBelow(n),s=n.eUp,u=o.eUp,c=!1;s.Dst!==u.Dst&&e.checkForIntersect(t,n),eS.vertEq(s.Org,t.event)&&(t.mesh.splice(a.Oprev,s),n=e.topLeftRegion(t,n),a=e.regionBelow(n).eUp,e.finishLeftRegions(t,e.regionBelow(n),o),c=!0),eS.vertEq(u.Org,t.event)&&(t.mesh.splice(r,u.Oprev),r=e.finishLeftRegions(t,o,null),c=!0),c?e.addRightEdges(t,n,r.Onext,a,a,!0):(i=eS.vertLeq(u.Org,s.Org)?u.Oprev:s,i=t.mesh.connect(r.Lprev,i),e.addRightEdges(t,n,i,i.Onext,i.Onext,!1),i.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,n))},e.connectLeftDegenerate=function(t,n,r){var i,a,o,s,u;return i=n.eUp,eS.vertEq(i.Org,r)?($_(!1),void e.spliceMergeVertices(t,i,r.anEdge)):eS.vertEq(i.Dst,r)?($_(!1),n=e.topRightRegion(n),a=s=(o=(u=e.regionBelow(n)).eUp.Sym).Onext,u.fixUpperEdge&&($_(a!==o),e.deleteRegion(t,u),t.mesh.delete(o),o=a.Oprev),t.mesh.splice(r.anEdge,o),eS.edgeGoesLeft(a)||(a=null),void e.addRightEdges(t,n,o.Onext,s,a,!0)):(t.mesh.splitEdge(i.Sym),n.fixUpperEdge&&(t.mesh.delete(i.Onext),n.fixUpperEdge=!1),t.mesh.splice(r.anEdge,i),void e.sweepEvent(t,r))},e.connectLeftVertex=function(t,n){var r,i,a,o,s,u,c=new uS;if(c.eUp=n.anEdge.Sym,r=t.dict.search(c).key,i=e.regionBelow(r)){if(o=r.eUp,s=i.eUp,0===eS.edgeSign(o.Dst,n,o.Org))return void e.connectLeftDegenerate(t,r,n);if(a=eS.vertLeq(s.Dst,o.Dst)?r:i,r.inside||a.fixUpperEdge){if(a===r)u=t.mesh.connect(n.anEdge.Sym,o.Lnext);else u=t.mesh.connect(s.Dnext,n.anEdge).Sym;a.fixUpperEdge?e.fixUpperEdge(t,a,u):e.computeWinding(t,e.addRegionBelow(t,r,u)),e.sweepEvent(t,n)}else e.addRightEdges(t,r,n.anEdge,n.anEdge,null,!0)}},e.sweepEvent=function(t,n){t.event=n,e.debugEvent(t);for(var r=n.anEdge;null===r.activeRegion;)if((r=r.Onext)===n.anEdge)return void e.connectLeftVertex(t,n);var i=e.topLeftRegion(t,r.activeRegion);$_(null!==i);var a=e.regionBelow(i),o=a.eUp,s=e.finishLeftRegions(t,a,null);s.Onext===o?e.connectRightVertex(t,i,s):e.addRightEdges(t,i,s.Onext,o,o,!0)},e.addSentinel=function(e,t,n,r){var i=new uS,a=e.mesh.makeEdge();a.Org.s=n,a.Org.t=r,a.Dst.s=t,a.Dst.t=r,e.event=a.Dst,i.eUp=a,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=e.dict.insert(i)},e.initEdgeDict=function(t){t.dict=new lS(t,e.edgeLeq);var n=t.bmax[0]-t.bmin[0],r=t.bmax[1]-t.bmin[1],i=t.bmin[0]-n,a=t.bmax[0]+n,o=t.bmin[1]-r,s=t.bmax[1]+r;e.addSentinel(t,i,a,o),e.addSentinel(t,i,a,s)},e.doneEdgeDict=function(t){for(var n,r=0;null!==(n=t.dict.min().key);)n.sentinel||($_(n.fixUpperEdge),$_(1===++r)),$_(0===n.windingNumber),e.deleteRegion(t,n)},e.removeDegenerateEdges=function(t){var n,r,i,a=t.mesh.eHead;for(n=a.next;n!==a;n=r)r=n.next,i=n.Lnext,eS.vertEq(n.Org,n.Dst)&&n.Lnext.Lnext!==n&&(e.spliceMergeVertices(t,i,n),t.mesh.delete(n),i=(n=i).Lnext),i.Lnext===n&&(i!==n&&((i===r||i===r.Sym)&&(r=r.next),t.mesh.delete(i)),(n===r||n===r.Sym)&&(r=r.next),t.mesh.delete(n))},e.initPriorityQ=function(e){var t,n,r,i=0;for(n=(r=e.mesh.vHead).next;n!==r;n=n.next)i++;for(i+=8,t=e.pq=new sS(i,eS.vertLeq),n=(r=e.mesh.vHead).next;n!==r;n=n.next)n.pqHandle=t.insert(n);return n===r&&(t.init(),!0)},e.donePriorityQ=function(e){e.pq=null},e.removeDegenerateFaces=function(t,n){var r,i,a;for(r=n.fHead.next;r!==n.fHead;r=i)i=r.next,$_((a=r.anEdge).Lnext!==a),a.Lnext.Lnext===a&&(e.addWinding(a.Onext,a),t.mesh.delete(a));return!0},e.computeInterior=function(t,n){var r,i;if(void 0===n&&(n=!0),e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);null!==(r=t.pq.extractMin());){for(;null!==(i=t.pq.min())&&eS.vertEq(i,r);)i=t.pq.extractMin(),e.spliceMergeVertices(t,r.anEdge,i.anEdge);e.sweepEvent(t,r)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),!!e.removeDegenerateFaces(t,t.mesh)&&(n&&t.mesh.check(),!0)},e}(),dS=function(){function e(){this.mesh=new iS,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=F_.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.prototype.normalize_=function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(!t)throw"Zero-size vector!";t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},e.prototype.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},e.prototype.computeNormal_=function(e){var t,n,r,i,a,o,s=[0,0,0],u=[0,0,0],c=[0,0,0],l=[0,0,0],h=[0,0,0],d=[null,null,null],f=[null,null,null],p=this.mesh.vHead;t=p.next;for(var v=0;v<3;++v)i=t.coords[v],u[v]=i,f[v]=t,s[v]=i,d[v]=t;for(t=p.next;t!==p;t=t.next)for(var m=0;m<3;++m)(i=t.coords[m])<u[m]&&(u[m]=i,f[m]=t),i>s[m]&&(s[m]=i,d[m]=t);var g=0;if(s[1]-u[1]>s[0]-u[0]&&(g=1),s[2]-u[2]>s[g]-u[g]&&(g=2),u[g]>=s[g])return e[0]=0,e[1]=0,void(e[2]=1);for(o=0,n=f[g],r=d[g],c[0]=n.coords[0]-r.coords[0],c[1]=n.coords[1]-r.coords[1],c[2]=n.coords[2]-r.coords[2],t=p.next;t!==p;t=t.next)l[0]=t.coords[0]-r.coords[0],l[1]=t.coords[1]-r.coords[1],l[2]=t.coords[2]-r.coords[2],h[0]=c[1]*l[2]-c[2]*l[1],h[1]=c[2]*l[0]-c[0]*l[2],h[2]=c[0]*l[1]-c[1]*l[0],(a=h[0]*h[0]+h[1]*h[1]+h[2]*h[2])>o&&(o=a,e[0]=h[0],e[1]=h[1],e[2]=h[2]);o<=0&&(e[0]=e[1]=e[2]=0,e[this.longAxis_(c)]=1)},e.prototype.checkOrientation_=function(){for(var e,t,n=this.mesh.fHead,r=this.mesh.vHead,i=0,a=n.next;a!==n;a=a.next)if(!((t=a.anEdge).winding<=0))do{i+=(t.Org.s-t.Dst.s)*(t.Org.t+t.Dst.t),t=t.Lnext}while(t!==a.anEdge);if(i<0){for(e=r.next;e!==r;e=e.next)e.t=-e.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var e,t,n=this.mesh.vHead,r=[0,0,0],i=!1;r[0]=this.normal[0],r[1]=this.normal[1],r[2]=this.normal[2],!r[0]&&!r[1]&&!r[2]&&(this.computeNormal_(r),i=!0),e=this.sUnit,t=this.tUnit;var a=this.longAxis_(r);e[a]=0,e[(a+1)%3]=1,e[(a+2)%3]=0,t[a]=0,t[(a+1)%3]=0,t[(a+2)%3]=r[a]>0?1:-1;for(var o=n.next;o!==n;o=o.next)o.s=this.dot_(o.coords,e),o.t=this.dot_(o.coords,t);i&&this.checkOrientation_();for(var s=!0,u=n.next;u!==n;u=u.next)s?(this.bmin[0]=this.bmax[0]=u.s,this.bmin[1]=this.bmax[1]=u.t,s=!1):(u.s<this.bmin[0]&&(this.bmin[0]=u.s),u.s>this.bmax[0]&&(this.bmax[0]=u.s),u.t<this.bmin[1]&&(this.bmin[1]=u.t),u.t>this.bmax[1]&&(this.bmax[1]=u.t))},e.prototype.addWinding_=function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},e.prototype.tessellateMonoRegion_=function(e,t){var n,r;if((n=t.anEdge).Lnext===n||n.Lnext.Lnext===n)throw"Mono region invalid";for(;eS.vertLeq(n.Dst,n.Org);n=n.Lprev);for(;eS.vertLeq(n.Org,n.Dst);n=n.Lnext);r=n.Lprev;for(;n.Lnext!==r;)if(eS.vertLeq(n.Dst,r.Org)){for(;r.Lnext!==n&&(eS.edgeGoesLeft(r.Lnext)||eS.edgeSign(r.Org,r.Dst,r.Lnext.Dst)<=0);)r=e.connect(r.Lnext,r).Sym;r=r.Lprev}else{for(;r.Lnext!==n&&(eS.edgeGoesRight(n.Lprev)||eS.edgeSign(n.Dst,n.Org,n.Lprev.Org)>=0);)n=e.connect(n,n.Lprev).Sym;n=n.Lnext}if(r.Lnext===n)throw"Mono region invalid";for(;r.Lnext.Lnext!==n;)r=e.connect(r.Lnext,r).Sym;return!0},e.prototype.tessellateInterior_=function(e){for(var t,n=e.fHead.next;n!==e.fHead;n=t)if(t=n.next,n.inside&&!this.tessellateMonoRegion_(e,n))return!1;return!0},e.prototype.discardExterior_=function(e){for(var t,n=e.fHead.next;n!==e.fHead;n=t)t=n.next,n.inside||e.zapFace(n)},e.prototype.setWindingNumber_=function(e,t,n){for(var r,i=e.eHead.next;i!==e.eHead;i=r)r=i.next,i.Rface.inside!==i.Lface.inside?i.winding=i.Lface.inside?t:-t:n?e.delete(i):i.winding=0},e.prototype.getNeighbourFace_=function(e){return e.Rface&&e.Rface.inside?e.Rface.n:-1},e.prototype.outputPolymesh_=function(e,t,n,r){var i,a,o=0,s=0;n>3&&e.mergeConvexFaces(n);for(var u=e.vHead.next;u!==e.vHead;u=u.next)u.n=-1;for(var c=e.fHead.next;c!==e.fHead;c=c.next)if(c.n=-1,c.inside){i=c.anEdge,a=0;do{-1===(u=i.Org).n&&(u.n=s,s++),a++,i=i.Lnext}while(i!==c.anEdge);if(a>n)throw"Face vertex greater that support polygon";c.n=o,++o}this.elementCount=o,t===U_.CONNECTED_POLYGONS&&(o*=2),this.elements=[],this.elements.length=o*n,this.vertexCount=s,this.vertices=[],this.vertices.length=s*r,this.vertexIndices=[],this.vertexIndices.length=s;for(u=e.vHead.next;u!==e.vHead;u=u.next)if(-1!==u.n){var l=u.n*r;this.vertices[l+0]=u.coords[0],this.vertices[l+1]=u.coords[1],r>2&&(this.vertices[l+2]=u.coords[2]),this.vertexIndices[u.n]=u.idx}var h=0;for(c=e.fHead.next;c!==e.fHead;c=c.next)if(c.inside){i=c.anEdge,a=0;do{u=i.Org;this.elements[h++]=u.n,a++,i=i.Lnext}while(i!==c.anEdge);for(var d=a;d<n;++d)this.elements[h++]=-1;if(t===U_.CONNECTED_POLYGONS){i=c.anEdge;do{this.elements[h++]=this.getNeighbourFace_(i),i=i.Lnext}while(i!==c.anEdge);for(var f=a;f<n;++f)this.elements[h++]=-1}}},e.prototype.outputContours_=function(e,t){var n,r,i=0,a=0;this.vertexCount=0,this.elementCount=0;for(var o=e.fHead.next;o!==e.fHead;o=o.next)if(o.inside){r=n=o.anEdge;do{this.vertexCount++,n=n.Lnext}while(n!==r);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*t,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var s=0,u=0,c=0;i=0;for(o=e.fHead.next;o!==e.fHead;o=o.next)if(o.inside){a=0,r=n=o.anEdge;do{this.vertices[s++]=n.Org.coords[0],this.vertices[s++]=n.Org.coords[1],t>2&&(this.vertices[s++]=n.Org.coords[2]),this.vertexIndices[u++]=this.vertexIdCallback?this.vertexIdCallback(n):n.Org.idx,a++,n=n.Lnext}while(n!==r);this.elements[c++]=i,this.elements[c++]=a,i+=a}},e.prototype.addContour=function(e,t){null===this.mesh&&(this.mesh=new iS),e<2&&(e=2),e>3&&(e=3);for(var n=null,r=0;r<t.length;r+=e)null===n?(n=this.mesh.makeEdge(),this.mesh.splice(n,n.Sym)):(this.mesh.splitEdge(n),n=n.Lnext),n.Org.coords[0]=t[r+0],n.Org.coords[1]=t[r+1],n.Org.coords[2]=e>2?t[r+2]:0,n.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(n),n.winding=1,n.Sym.winding=-1},e.prototype.tesselate=function(e,t,n,r,i,a){if(void 0===e&&(e=F_.ODD),void 0===t&&(t=U_.POLYGONS),void 0===a&&(a=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,i&&(this.normal[0]=i[0],this.normal[1]=i[1],this.normal[2]=i[2]),this.windingRule=e,r<2&&(r=2),r>3&&(r=3),!this.mesh)return!1;this.projectPolygon_(),hS.computeInterior(this,a);var o=this.mesh;return t===U_.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),a&&o.check(),t===U_.BOUNDARY_CONTOURS?this.outputContours_(o,r):this.outputPolymesh_(o,t,n,r),!0},e}();function fS(e){var t=e.windingRule,n=void 0===t?F_.ODD:t,r=e.elementType,i=void 0===r?U_.POLYGONS:r,a=e.polySize,o=void 0===a?3:a,s=e.vertexSize,u=void 0===s?2:s,c=e.normal,l=void 0===c?[0,0,1]:c,h=e.contours,d=void 0===h?[]:h,f=e.strict,p=void 0===f||f,v=e.debug,m=void 0!==v&&v;if(!d&&p)throw new Error("Contours can't be empty");if(d){var g=new dS;e.edgeCreateCallback&&(g.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(g.vertexIdCallback=e.vertexIdCallback);for(var y=0;y<d.length;y++)g.addContour(u||2,d[y]);return g.tesselate(n,i,o,u,l,p),{vertices:g.vertices,vertexIndices:g.vertexIndices,vertexCount:g.vertexCount,elements:g.elements,elementCount:g.elementCount,mesh:m?g.mesh:void 0}}}F_.ODD,F_.NONZERO,F_.POSITIVE,F_.NEGATIVE,F_.ABS_GEQ_TWO,U_.POLYGONS,U_.CONNECTED_POLYGONS,U_.BOUNDARY_CONTOURS;var pS=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r,i,a,o,s,u,c,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(E.a)(this,n),(c=t.call(this)).type="ShapeGeometry",c.windingRule=F_.ODD,c.elementType=U_.POLYGONS,c.polySize=3,c.vertexSize=2,c.strict=!0,c._shape=e,c._curveSegments=l,c._triangulationOptions=Object.assign({windingRule:F_.ODD,elementType:U_.POLYGONS,polySize:3,vertexSize:2,strict:!0},h);for(var d,f,p,m=c._shape.extractShapePointsToFlatArray([],c._curveSegments),g=c._shape.shapeHoles.map((function(e){return e.extractShapePointsToFlatArray([],c._curveSegments)})),y=!0,b=!0,w=0,x=m.length/2;w<x;w++){var O=2*w,k=m[O+0],_=m[O+1];if(void 0!==f&&k!==f&&(y=!1),void 0!==p&&_!==p&&(b=!1),f=k,p=_,!y&&!b)break}!y&&!b&&(d=fS({contours:[m].concat(Object(v.a)(g)),windingRule:c._triangulationOptions.windingRule,elementType:c._triangulationOptions.elementType,polySize:c._triangulationOptions.polySize,vertexSize:c._triangulationOptions.vertexSize,strict:c._triangulationOptions.strict}));var S=null!==(r=null===(i=d)||void 0===i?void 0:i.vertexCount)&&void 0!==r?r:1,A=null!==(a=null===(o=d)||void 0===o?void 0:o.elementCount)&&void 0!==a?a:1;if(c._positionAttribute=new wi(new Float32Array(3*S),3),c._normalAttribute=new wi(new Float32Array(3*S),3),c._uvAttribute=new wi(new Float32Array(2*S),2),c._indexAttribute=new wi(new Uint32Array(3*A),1),d){for(var j=1/0,T=-1/0,M=1/0,C=-1/0,D=0,I=S;D<I;D++){var P=2*D,R=d.vertices[P+0],L=d.vertices[P+1];R<j&&(j=R),R>T&&(T=R),L<M&&(M=L),L>C&&(C=L)}for(var N=T-j,B=C-M,F=0,U=S;F<U;F++){var z=2*F,V=d.vertices[z+0],G=d.vertices[z+1],H=(V-j)/N,W=(G-M)/B;c._positionAttribute.setXYZ(F,V,G,0),c._normalAttribute.setXYZ(F,0,0,1),c._uvAttribute.setXY(F,H,W)}for(var q=0,Y=A;q<Y;q++){var X=3*q,K=d.elements[X+0],Q=d.elements[X+1],Z=d.elements[X+2];c._indexAttribute.setX(X+0,K),c._indexAttribute.setX(X+1,Q),c._indexAttribute.setX(X+2,Z)}}return c.setAttribute("position",c._positionAttribute),c.setAttribute("normal",c._normalAttribute),c.setAttribute("uv",c._uvAttribute),c.setIndex(c._indexAttribute),c.setDrawRange(0,3*(null!==(s=null===(u=d)||void 0===u?void 0:u.elementCount)&&void 0!==s?s:1)),c}return Object(A.a)(n,[{key:"clone",value:function(){var e=new n(this._shape,this._curveSegments);return e.userData=Lm(this.userData),e}}]),n}(Di),vS=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(E.a)(this,e),this.capacity=t,this.size=0,this.debug=n,this.debug&&console.log("allocating with cap ".concat(t));var r=t*e.eSize;this.buffer=new ArrayBuffer(r);var i=Float32Array.BYTES_PER_ELEMENT,a=0;this.positions=new Float32Array(this.buffer,a*i,3*t),a+=3*t,this.normals=new Float32Array(this.buffer,a*i,3*t),a+=3*t,this.uvs=new Float32Array(this.buffer,a*i,2*t)}return Object(A.a)(e,[{key:"realloc",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t<this.size)throw Error("cannot shrink buffer");if(!(t<=this.capacity)||n){this.debug&&console.log("resizing from ".concat(this.capacity," \u2192 ").concat(t));var r=t*e.eSize,i=new ArrayBuffer(r),a=Float32Array.BYTES_PER_ELEMENT,o=0,s=new Float32Array(i,o*a,3*t);o+=3*t;var u=new Float32Array(i,o*a,3*t);o+=3*t;var c=new Float32Array(i,o*a,2*t);s.set(this.positions.slice(0,3*this.size)),u.set(this.normals.slice(0,3*this.size)),c.set(this.uvs.slice(0,2*this.size)),this.buffer=i,this.positions=s,this.normals=u,this.uvs=c,this.capacity=t}}},{key:"get",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.size+e;if(t>this.capacity){for(var n=this.capacity;t>n;)n*=2;this.realloc(n)}var r=this.size;return this.size=t,r}},{key:"reserve",value:function(e){var t=this.size+e;t>this.capacity&&this.realloc(t)}},{key:"shrink",value:function(){this.debug&&console.log("shrinking ".concat(this.capacity," \u2192 ").concat(this.size)),this.realloc(this.size,!0)}}]),e}(),mS=vS;mS.eSize=8*Float32Array.BYTES_PER_ELEMENT;var gS=function(e,t){return function(n){var r=Object(g.a)(n,2),i=r[0],a=r[1];return a<i&&(a+=t),(e>=i?e:e+t)<=a}},yS=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:F_.ODD;Object(E.a)(this,n),(i=t.call(this)).type="ShapeGeometry",i.vertexCache={},i._shape=e,i._depth=r,i._bevel=a,i._curveSegments=o,i._bevelSegmentsInput=s,a<=0?(i._bevelSize=0,i._bevelSegments=0):(i._bevelSize=Math.min(a,r/2-1e-12),i._bevelSegments=Math.floor(s));var c=i._shape.extractShapePointsToFlatArray([],o),l=i._shape.shapeHoles.map((function(e){for(var t=e.extractShapePointsToFlatArray([],o),n=[],r=t.length-1;r>=1;r-=2){var i=t[r-1],a=t[r-0];n.push(i,a)}return n})),h=fS({windingRule:u,elementType:U_.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[c]}),d=fS({windingRule:F_.ODD,elementType:U_.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:Object(v.a)(l)});if(!h)throw new Error("error generating geometry");var f=h.elementCount;if(d){h.elementCount+=d.elementCount;for(var p=0;p<d.elements.length;p++){var m=d.elements[p],y=p%2===0?h.vertexCount:0;h.elements.push(m+y)}for(var b=0;b<d.vertexIndices.length;b++){var w=d.vertexIndices[b],O=h.vertexCount;h.vertexIndices.push(w+O)}for(var k=0;k<d.vertices.length;k++){var _=d.vertices[k];h.vertices.push(_)}}for(var S=1/0,A=-1/0,j=1/0,T=-1/0,M=0,C=h.vertexCount;M<C;M++){var D=2*M,I=h.vertices[D+0],P=h.vertices[D+1];I<S&&(S=I),I>A&&(A=I),P<j&&(j=P),P>T&&(T=P)}i._minX=S,i._minY=j,i._width=A-S,i._height=T-j;var R=2*h.vertexCount*(2+i._bevelSegments);i._buffer=new mS(R);for(var L=[],N=[],B=h.elementCount-1;B>=0;B--){var F=B>=f,U=2*B,z=h.elements[U+0],V=h.elements[U+1],G=z+V,H={start:z,count:V,normals:[],continuous:[],concave:[]},W=z,q=G-1,Y=z+1,X=i._shape.roundedCurves.length;do{var K,Q=W-z,Z=h.vertices[2*q+0],J=h.vertices[2*q+1],$=h.vertices[2*W+0],ee=h.vertices[2*W+1],te=h.vertices[2*Y+0],ne=h.vertices[2*Y+1],re=$-Z,ie=ee-J,ae=Math.sqrt(re*re+ie*ie);re/=ae,ie/=ae;var oe=$-te,se=ee-ne,ue=Math.sqrt(oe*oe+se*se);oe/=ue,se/=ue,H.normals[2*Q+0]=-se,H.normals[2*Q+1]=oe,H.concave[Q]=re*se-ie*oe>0;var ce=h.vertexIndices[W];if(Array.isArray(ce))H.continuous[Q]=!1;else{var le=i._shape.getCurveIndexFromVertexId(ce-1,!0),he=Object(g.a)(le,2),de=he[0],fe=he[1];if(fe>0&&fe<1)H.continuous[Q]=!0;else{var pe=1===fe?de+1:de-1;pe=(pe+X)%X;var ve=1===fe?0:1,me=i._shape.roundedCurves[de].getTangent(fe),ge=i._shape.roundedCurves[pe].getTangent(ve);H.continuous[Q]=me.dot(ge)>.95}}F&&(H.normals[2*Q+0]*=-1,H.normals[2*Q+1]*=-1),q=(K=[W,Y,Y+1])[0],W=K[1],(Y=K[2])>=G&&(Y-=V)}while(Y!==z+1);var ye=[];ye.push({bevelI:0,angle:0,size:0,boundary:{vertices:h.vertices.slice(2*z,2*G),vertexCount:V,vertexIndices:new Array(V).fill(!0).map((function(e,t){return[t,t]})),elements:[0,V],elementCount:1,mesh:null},reverseMap:[],insetPoints:h.vertices.slice(2*z,2*G)});for(var be=function(){for(var e=we/i._bevelSegments*Math.PI/2,t=(1-Math.cos(e))*i._bevelSize,n=[],r=[],a=[],s=[],u=0,c=0;c<V;c++){var l=2*c,d=(c-1+V)%V*2,f=h.vertices[2*H.start+l+0],p=h.vertices[2*H.start+l+1],v=-H.normals[d+0]*t,m=-H.normals[d+1]*t,y=-H.normals[l+0]*t,b=-H.normals[l+1]*t;if(H.concave[c]||!H.concave[c]&&F){var w=Math.atan2(m,v),x=Math.atan2(b,y);x>w&&(x-=2*Math.PI);var O=x-w;if(H.continuous[c]||F){var k=w+O/2,_=Math.cos(k)*t,S=Math.sin(k)*t;n[2*u+0]=f+_*(F?-1:1),n[2*u+1]=p+S*(F?-1:1),s[u]=c,u++}else for(var E=Math.max(1,Math.floor(o/4*Math.abs(O)/Math.PI)),A=0;A<=E;A++){var j=w+O*(A/E),T=Math.cos(j)*t,M=Math.sin(j)*t;n[2*u+0]=f+T,n[2*u+1]=p+M,s[u]=c,u++}}else n[2*u+0]=f+v,n[2*u+1]=p+m,s[u]=c,r[c]=u,n[2*++u+0]=f,n[2*u+1]=p,s[u]=c,n[2*++u+0]=f+y,n[2*u+1]=p+b,s[u]=c,a[c]=u,u++}var C=fS({windingRule:F_.POSITIVE,elementType:U_.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[n],edgeCreateCallback:function(e){var t=e.Org.idx,n=s[t],r=s[(t+1)%s.length];e.idx=[n,r],e.Sym.idx=[r,n]},vertexIdCallback:function(e){var t=e.Lprev.idx;return[t?t[1]:0,e.idx[0]]}});if(!C)throw console.log("Error"),new Error("error generating bevel geometry for ".concat(we,"'th loop"));if(!C.vertexCount)return"break";for(var D=0;D<C.vertexIndices.length;D++){var I=Object(g.a)(C.vertexIndices[D],2),P=I[0],R=I[1];if(P!==R){var L=R;R<P&&(L+=V);for(var N=P;N<L;N++){var B=N%V,U=(N+1)%V;if(!H.continuous[B]||!H.continuous[U]){C.vertexIndices[D]=[P,B],C.vertexIndices.splice(D+1,0,[U,R]),C.vertices.splice(2*(D+1),0,C.vertices[2*D],C.vertices[2*D+1]);break}}}}ye.push({bevelI:we,angle:e,size:t,boundary:C,reverseMap:s,insetPoints:n})},we=1;we<=i._bevelSegments;we++){if("break"===be())break}for(var xe=function(e,t,n){for(var r=0,i=e.boundary.vertexIndices.length;r<i&&n(e.boundary.vertexIndices[t]);)t=(t+1)%i,r++;return r},Oe=L.length,ke=1;ke<ye.length;ke++){var _e=ye[ke-1],Se=ye[ke],Ee=_e.boundary.vertexIndices.length,Ae=Se.boundary.vertexIndices.length;if(!Ee||!Ae)break;for(var je=H.concave.length,Te=0,Me=gS(Te,V);!_e.boundary.vertexIndices.filter(Me).length||!Se.boundary.vertexIndices.filter(Me).length;)Te++,Me=gS(Te,V);var Ce=_e.boundary.vertexIndices.findIndex(Me),De=Se.boundary.vertexIndices.findIndex(Me);do{Ce=(Ce+1)%Ee}while(Me(_e.boundary.vertexIndices[Ce]));do{De=(De+1)%Ae}while(Me(Se.boundary.vertexIndices[De]));var Ie=Te=(Te+1)%V,Pe=i.buildBevelVert(H,_e,(Ce-1+Ee)%Ee),Re=i.buildBevelVert(H,Se,(De-1+Ae)%Ae),Le=void 0,Ne=void 0,Be=!1;do{var Fe=xe(_e,Ce,Me=gS(Te,V)),Ue=xe(Se,De,Me),ze=Be;if(Be=!1,Fe&&!Ue){for(var Ve=0;Ve<Fe;Ve++)Le=i.buildBevelVert(H,_e,(Ce+Ve)%Ee,Ve/(Fe-1)),L.push(Pe.topN,Le.topP,Re.topN),L.push(Le.bottomP,Pe.bottomN,Re.bottomN),Pe=Le;Be=!0}else if(!Fe&&Ue)for(var Ge=0;Ge<Ue;Ge++)Ne=i.buildBevelVert(H,Se,(De+Ge)%Ae,Ge/(Ue-1)),L.push(Re.topN,Pe.topP,Ne.topP),L.push(Pe.bottomP,Re.bottomN,Ne.bottomP),Re=Ne;else if(Fe&&Ue)if(Le=i.buildBevelVert(H,_e,Ce,0),Ne=i.buildBevelVert(H,Se,De,0),ze?(L.push(Pe.topN,Ne.topP,Re.topN),L.push(Pe.topN,Le.topP,Ne.topP),L.push(Ne.bottomP,Pe.bottomN,Re.bottomN),L.push(Ne.bottomP,Le.bottomP,Pe.bottomN)):(L.push(Re.topN,Pe.topN,Le.topP),L.push(Re.topN,Le.topP,Ne.topP),L.push(Le.bottomP,Pe.bottomN,Re.bottomN),L.push(Le.bottomP,Re.bottomN,Ne.bottomP)),Pe=Le,Re=Ne,Fe===Ue)for(var He=1;He<Fe;He++)Le=i.buildBevelVert(H,_e,(Ce+He)%Ee,He/(Fe-1)),Ne=i.buildBevelVert(H,Se,(De+He)%Ae,He/(Ue-1)),L.push(Pe.topN,Le.topP,Re.topN),L.push(Re.topN,Le.topP,Ne.topP),L.push(Le.bottomP,Pe.bottomN,Re.bottomN),L.push(Le.bottomP,Re.bottomN,Ne.bottomP),Pe=Le,Re=Ne;else if(Fe>Ue)for(var We=Fe/Ue,qe=0,Ye=1;Ye<Fe;Ye++)Le=i.buildBevelVert(H,_e,(Ce+Ye)%Ee,Ye/(Fe-1)),L.push(Pe.topN,Le.topP,Re.topN),L.push(Le.bottomP,Pe.bottomN,Re.bottomN),Pe=Le,Ye>(qe+1)*We&&(qe++,Ne=i.buildBevelVert(H,Se,(De+qe)%Ae,qe/(Ue-1)),L.push(Re.topN,Le.topP,Ne.topP),L.push(Le.bottomP,Re.bottomN,Ne.bottomP),Re=Ne);else for(var Xe=Ue/Fe,Ke=0,Qe=1;Qe<Ue;Qe++)Ne=i.buildBevelVert(H,Se,(De+Qe)%Ae,Qe/(Ue-1)),L.push(Re.topN,Le.topP,Ne.topP),L.push(Le.bottomP,Re.bottomN,Ne.bottomP),Re=Ne,Qe>(Ke+1)*Xe&&(Ke++,Le=i.buildBevelVert(H,_e,(Ce+Ke)%Ee,Ke/(Fe-1)),L.push(Pe.topN,Le.topP,Re.topN),L.push(Le.bottomP,Pe.bottomN,Re.bottomN),Pe=Le);Ce=(Ce+Fe)%Ee,De=(De+Ue)%Ae,Te=(Te+1)%je}while(Te!==Ie)}for(var Ze=ye[0],Je=0,$e=Ze.boundary.vertexCount;Je<$e;Je++){var et=i.buildBevelVert(H,Ze,Je),tt=i.buildBevelVert(H,Ze,(Je+1)%$e);L.push(tt.topP,et.topN,et.bottomN),L.push(tt.topP,et.bottomN,tt.bottomP)}if(F){for(var nt=[],rt=L.length-1;rt>=Oe+2;rt-=3){var it=L[rt-2],at=L[rt-1],ot=L[rt-0];nt.push(ot,at,it)}L.splice.apply(L,[Oe,L.length-Oe].concat(nt))}if(F){for(var st=[],ut=ye[ye.length-1].boundary.vertices.length-1;ut>=1;ut-=2){var ct=ye[ye.length-1].boundary.vertices[ut-1],lt=ye[ye.length-1].boundary.vertices[ut-0];st.push(ct,lt)}N.push(st)}if(!F){var ht=ye[ye.length-1],dt=fS({windingRule:ye.length>1?F_.POSITIVE:F_.ODD,elementType:U_.POLYGONS,vertexSize:2,strict:!0,contours:[ht.insetPoints].concat(N)});if(!dt)throw new Error("Error generating geometry for surface");0===l.length&&Object.assign(Object(x.a)(i),{capStartIndex:L.length});for(var ft=0;ft<3*dt.elementCount;ft+=3){var pt=i.buildSurfaceVert(dt,dt.elements[ft+0]),vt=i.buildSurfaceVert(dt,dt.elements[ft+1]),mt=i.buildSurfaceVert(dt,dt.elements[ft+2]);L.push(pt.top,vt.top,mt.top),L.push(mt.bottom,vt.bottom,pt.bottom)}}i.vertexCache={}}i._buffer.shrink();var gt=new wi(Uint32Array.from(L),1),yt=new wi(i._buffer.positions,3),bt=new wi(i._buffer.normals,3),wt=new wi(i._buffer.uvs,2);return yt.needsUpdate=!0,bt.needsUpdate=!0,wt.needsUpdate=!0,gt.needsUpdate=!0,i.setAttribute("position",yt),i.setAttribute("normal",bt),i.setAttribute("uv",wt),i.setIndex(gt),i}return Object(A.a)(n,[{key:"buildSurfaceVert",value:function(e,t){var n=t.toString();if(n in this.vertexCache)return this.vertexCache[n];var r=e.vertices[2*t+0],i=e.vertices[2*t+1],a=(r-this._minX)/this._width,o=(i-this._minY)/this._height,s=this._buffer.get(2),u=3*s,c=2*s,l={top:s+0,bottom:s+1};return this._buffer.positions[u+0]=r,this._buffer.positions[u+1]=i,this._buffer.positions[u+2]=this._depth,this._buffer.normals[u+0]=0,this._buffer.normals[u+1]=0,this._buffer.normals[u+2]=1,this._buffer.uvs[c+0]=a,this._buffer.uvs[c+1]=o,this._buffer.positions[u+3]=r,this._buffer.positions[u+4]=i,this._buffer.positions[u+5]=0,this._buffer.normals[u+3]=0,this._buffer.normals[u+4]=0,this._buffer.normals[u+5]=-1,this._buffer.uvs[c+2]=a,this._buffer.uvs[c+3]=o,this.vertexCache[n]=l,l}},{key:"buildBevelVert",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i="".concat(t.bevelI,":").concat(n);if(i in this.vertexCache)return this.vertexCache[i];var a,o,s,u,c=Object(g.a)(t.boundary.vertexIndices[n],2),l=c[0],h=c[1];l!==h?(o=l,a=h,u=!1,s=e.continuous[o]&&e.continuous[a]):(o=((a=l)-1+e.count)%e.count,u=e.concave[a]&&t.bevelI>0,s=e.continuous[a]||u);var d=Math.cos(t.angle),f=Math.sin(t.angle),p=2*n,v=2*a,m=2*o,y=t.boundary.vertices[p+0],b=t.boundary.vertices[p+1],w=(1-f)*this._bevelSize,x=(y-this._minX)/this._width,O=(b-this._minY)/this._height,k=e.normals[v+0],_=e.normals[v+1],S=e.normals[m+0],E=e.normals[m+1];if(u){k+=(S-k)*(1-r),_+=(E-_)*(1-r);var A=Math.sqrt(k*k+_*_);k/=A,_/=A}var j=this._buffer.get(s?2:4),T=3*j,M=2*j,C={i:n,fi:a,topP:j+0,topN:j+0,bottomP:j+1,bottomN:j+1};return this._buffer.positions[T+0]=y,this._buffer.positions[T+1]=b,this._buffer.positions[T+2]=this._depth-w,this._buffer.normals[T+0]=k*d,this._buffer.normals[T+1]=_*d,this._buffer.normals[T+2]=f,this._buffer.uvs[M+0]=x,this._buffer.uvs[M+1]=O,this._buffer.positions[T+3]=y,this._buffer.positions[T+4]=b,this._buffer.positions[T+5]=w,this._buffer.normals[T+3]=k*d,this._buffer.normals[T+4]=_*d,this._buffer.normals[T+5]=-f,this._buffer.uvs[M+2]=O,this._buffer.uvs[M+3]=x,s||(j+=2,T+=6,M+=4,C.topP=j+0,C.bottomP=j+1,this._buffer.positions[T+0]=y,this._buffer.positions[T+1]=b,this._buffer.positions[T+2]=this._depth-w,this._buffer.normals[T+0]=S*d,this._buffer.normals[T+1]=E*d,this._buffer.normals[T+2]=f,this._buffer.uvs[M+0]=x,this._buffer.uvs[M+1]=O,this._buffer.positions[T+3]=y,this._buffer.positions[T+4]=b,this._buffer.positions[T+5]=w,this._buffer.normals[T+3]=S*d,this._buffer.normals[T+4]=E*d,this._buffer.normals[T+5]=-f,this._buffer.uvs[M+2]=O,this._buffer.uvs[M+3]=x),this.vertexCache[i]=C,C}},{key:"clone",value:function(){var e=new n(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=Lm(this.userData),e}}]),n}(Di),bS=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a,o,s,u,c,l,h=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:F_.ODD},e.parameters),d=Math.abs(h.width),f=Math.abs(null!==(r=h.height)&&void 0!==r?r:h.width),p=Math.abs(null!==(i=h.depth)&&void 0!==i?i:0),v=null!==(a=e.shape)&&void 0!==a?a:null===t||void 0===t?void 0:t.shape,m=null!==(o=null===(s=v)||void 0===s?void 0:s.roundness)&&void 0!==o?o:h.roundness;void 0!==v&&(v instanceof Y_?(v.width!==d||v.height!==f)&&v.applySize(d,f):v=new Y_(d,f).fromJSON(v),void 0!==(null===(u=e.parameters)||void 0===u?void 0:u.roundness)&&(null===(c=e.parameters)||void 0===c?void 0:c.roundness)>0&&v.update());var g=null!==(l=v)&&void 0!==l?l:new Y_(d,f);return{parameters:Object.assign(h,{width:d,height:f,depth:p,roundness:m}),shape:g}}},{key:"build",value:function(e){var t,n=e.parameters,r=n.depth,i=n.extrudeBevelSize,a=n.extrudeBevelSegments,o=n.subdivisions,s=n.roundness,u=n.windingRule;return e.shape.roundness=s,t=r<=0?new pS(e.shape,o,{windingRule:u}):new yS(e.shape,r,i,o,a,u),Object.assign(t,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"VectorGeometry"})})}}]),e}(),wS=2*Math.PI,xS=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof Y_?e.shape:new Y_,parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(r=a.height)&&void 0!==r?r:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:0)})}}},{key:"build",value:function(e){var t=e.parameters,n=t.width,r=t.height,i=t.spikes,a=t.angle,o=t.innerRadius,s=t.depth,u=t.extrudeBevelSize,c=t.extrudeBevelSegments,l=e.shape,h=function(e,t,n,r,i,a){if(r>=wS)return i>30||i%4===0?(function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=.5522847498,s=t*o,u=n*o;e.addPoint(_S(i-t,a,i-t,a-u,i-t,a+u)),e.addPoint(_S(i,a+n,i-s,a+n,i+s,a+n)),e.addPoint(_S(i+t,a,i+t,a+u,i+t,a-u)),e.addPoint(_S(i,a-n,i+s,a-n,i-s,a-n)),r>0&&ES(e,t,n,r)}(e,t,n,a),Math.round(i/4)):OS(e,r,i,t,n,a);r=Math.max(r,.001);var o={x:0,y:n},s=r+.5*Math.PI,u={x:Math.cos(s)*t,y:Math.sin(s)*n},c=J_({px:o.x,py:o.y,cx:u.x,cy:u.y,rx:t,ry:n,largeArcFlag:r>Math.PI,sweepFlag:!0});return i>30||i%c.length===0?function(e,t,n,r,i,a,o,s){var u=Math.round(i/r.length);e.addPoint(kS(t,n));for(var c=0,l=r.length;c<l;c++){var h=r[c],d=e.points[c],f=kS(h.x,h.y);d.controls[1].position.set(h.x1,h.y1),f.controls[0].position.set(h.x2,h.y2),e.addPoint(f)}return s>0?SS(e,a,o,s):e.addPoint(kS(0,0)),u}(e,o.x,o.y,c,i,t,n,a):OS(e,r,i,t,n,a)}(l,.5*n,.5*r,a*Math.PI/180,i,o);l.isClosed=!0,l.update();var d=bS.create({shape:l,parameters:{subdivisions:h,depth:s,extrudeBevelSize:u,extrudeBevelSegments:c}});return Object.assign(d,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"EllipseGeometry"})})}}]),e}();function OS(e,t,n,r,i,a){for(var o=-t/n,s=0;s<=n;s++){var u=o*s,c=Math.sin(u)*r,l=Math.cos(u)*i;e.addPoint(kS(c,l))}return t<wS?a>0?SS(e,r,i,a):e.addPoint(kS(0,0)):(e.removePoint(e.points[e.points.length-1]),a>0&&ES(e,r,i,a)),1}function kS(e,t){return new p_(En.generateUUID(),new An(e,t))}function _S(e,t,n,r,i,a){var o=kS(e,t);return o.controls[0].position.set(n,r),o.controls[1].position.set(i,a),o}function SS(e,t,n,r){AS(e,t,n,r).forEach((function(t){return e.addPoint(t)}))}function ES(e,t,n,r){var i=AS(e,t,n,r),a=new Y_;i.forEach((function(e){return a.addPoint(e)})),a.isClosed=!0,e.shapeHoles.push(a)}function AS(e,t,n,r){var i=r*t/100,a=i*(Math.abs(n)/Math.abs(t)),o=new An(i/t,a/n),s=e.points.map((function(e){var t=e.clone();return t.uuid=En.generateUUID(),t})).reverse();return s.forEach((function(e){e.position.multiply(o);var t=e.controls[0].position.clone().multiply(o),n=e.controls[1].position.clone().multiply(o);e.controls[0].position.copy(n),e.controls[1].position.copy(t)})),s}var jS=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),o=Math.abs(a.width),s=Math.abs(null!==(r=a.height)&&void 0!==r?r:o),u=Math.abs(null!==(i=a.depth)&&void 0!==i?i:o),c=Math.abs(Math.min(o,u))/2;return{parameters:Object.assign(a,{width:o,height:s,depth:u,radius:c,segments:Math.round(a.segments),pathSegments:Math.round(a.pathSegments),cornerSegments:Math.round(a.cornerSegments)})}}},{key:"build",value:function(e){var t=e.parameters,n=t.width,r=t.height,i=t.depth,a=t.radius,o=t.revolutions,s=t.segments,u=t.pathRadius,c=t.pathType,l=t.pathSegments,h=t.cornerRadius,d=t.cornerSegments,f=new TS(!1,n,r,i,a,o,s,u,c,l,h,d);return Object.assign(f,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"HelixGeometry"})})}}]),e}(),TS=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:1,d=arguments.length>12&&void 0!==arguments[12]&&arguments[12];Object(E.a)(this,n),e=t.call(this);var f=r&&1===o;f&&(h=0),l>100&&(l=100);var p,v,m,y,b,w,x,O,k=function(){return new tr},_=new tr,S=k(),A=k(),j=k(),T=k(),M=k(),C=k(),D=k(),I=k(),P=k(),R=k(),L=k(),N=i-2*u+.001,B=N/o,F=Math.ceil(s*o),U=F+1,z=N/F,V=-N/2,G=c+1,H=2*Math.PI/c,W=Math.PI/2/h,q=Math.min((1-l/100)*u,u-.01),Y=u-q,X=0,K=2*h+2,Q=G*K/2,Z=Q+G*U,J=G*(U+K),$=[3,3,2].map((function(e){return Array(J*e).fill(0)})),ee=Object(g.a)($,3),te=ee[0],ne=ee[1],re=ee[2],ie=[],ae=a-u;function oe(e,t){var n=Math.PI/2;w=t*z,O=2*Math.PI*(w%B)/B+n,w+=V,x=Math.sin(O)*ae,b=Math.cos(O)*ae,r?e.set(b,x,w):e.set(b,w,x)}oe(_,-1e-10),oe(S,0),T.copy(_),oe(_,1);for(var se=_.distanceTo(S),ue=f?0:Y+q,ce=se*F+2*ue,le=q,he=ce-ue,de=function(){oe(A,fe),L.subVectors(A,T).normalize(),T.copy(A),P.copy(A).setComponent(+r+1,0).normalize(),R.crossVectors(L,P).normalize();for(var e=0===fe,t=fe===F,n=e?3*Math.PI/2:W,i=e?le:he,a=e?G:Z,o=e?0:J-G,s=L.clone().multiplyScalar(e?-Y:Y).add(A),l=L.clone().multiplyScalar(e?-1:1).normalize(),d=0;d<G;d++){var p=d*H;if(M.addVectors(_.copy(P).multiplyScalar(u*Math.cos(p)),S.copy(R).multiplyScalar(u*Math.sin(p))),C.copy(M).normalize(),e||t){f||(X=o+d,[0,1,2].forEach((function(e){te[3*X+e]=s.getComponent(e),ne[3*X+e]=l.getComponent(e)})),re[2*X]=+t,re[2*X+1]=d/c),S.copy(C).multiplyScalar(q),j.addVectors(A,S);for(var v=0;v<h;v++){var m=v*W+n;D.addVectors(_.copy(L).multiplyScalar(Y*Math.sin(m)),S.copy(C).multiplyScalar(Y*Math.cos(m))),I.copy(D).normalize(),S.addVectors(j,D),D.normalize(),X=a+v*G+d,[0,1,2].forEach((function(e){te[3*X+e]=S.getComponent(e),ne[3*X+e]=I.getComponent(e)}));var g=+e+Math.sin(m);re[2*X]=(i+Y*g)/ce,re[2*X+1]=d/c}}S.addVectors(A,M),X=Q+fe*G+d,[0,1,2].forEach((function(e){te[3*X+e]=S.getComponent(e),ne[3*X+e]=C.getComponent(e)})),re[2*X]=(ue+fe*se)/ce,re[2*X+1]=d/c}},fe=0;fe<=F;fe++)de();var pe=U+2*h+2,ve=pe-1;d&&(ve-=1);for(var me=+f;me<=ve-1;me++)for(var ge=f&&me===ve-1,ye=0;ye<G-1;ye++)v=(p=me*G+ye)+1,m=(ge?ye:p)+G,y=(ge?ye+1:v)+G,0===me?ie.push(v,y,m):me===pe-2?ie.push(p,v,m):ie.push(p,v,m,v,y,m);return e.setIndex(ie),e.setAttribute("position",new _i(te,3)),e.setAttribute("normal",new _i(ne,3)),e.setAttribute("uv",new _i(re,2)),e}return Object(A.a)(n)}(Di),MS=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(r=a.height)&&void 0!==r?r:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:a.width)})}}},{key:"build",value:function(e){var t=e.parameters,n=t.width,r=t.height,i=t.depth,a=t.detail,o=t.corner,s=t.cornerSides,u=0===a&&0!==o?new CS(.5*n,o,s):new Oc(.5*n,a);return u.scale(1,r/n,i/n),Object.assign(u,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"IcosahedronGeometry"})})}}]),e}(),CS=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;Object(E.a)(this,n);var o=(1+Math.sqrt(5))/2,s=[-1,o,0,1,o,0,-1,-o,0,1,-o,0,0,-1,o,0,1,o,0,-1,-o,0,1,-o,o,0,-1,o,0,1,-o,0,-1,-o,0,1],u="IcosahedronGeometry";return(e=t.call(this,s,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],u,r,i,a)).type=u,e}return Object(A.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.corner,e.cornerSides)}}]),n}(u_),DS=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a,o;(null!==(n=null===(r=e.parameters)||void 0===r?void 0:r.points)&&void 0!==n?n:[]).forEach((function(e){Array.isArray(e)&&(e.x=e[0],e.y=e[1])}));var s=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(a=s.height)&&void 0!==a?a:s.width),depth:Math.abs(null!==(o=s.depth)&&void 0!==o?o:s.width)})}}},{key:"build",value:function(e){var t=e.parameters,n=t.points,r=t.segments,i=t.verticalSegments,a=new Yu;a.moveTo(n[0].x,n[0].y),a.bezierCurveTo(n[1].x,n[1].y,n[2].x,n[2].y,n[3].x,n[3].y);var o=new Vu(a.extractPoints(i).shape,r);return o.rotateZ(Math.PI),Object.assign(o,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"LatheGeometry"})})}}]),e}(),IS=new Dr,PS=new ri,RS=new tr,LS=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this)).uuid=En.generateUUID(),e.name="",e.type="Geometry",e.vertices=[],e.colors=[],e.faces=[],e.faceVertexUvs=[[]],e.morphTargets=[],e.morphNormals=[],e.skinWeights=[],e.skinIndices=[],e.lineDistances=[],e.boundingBox=null,e.boundingSphere=null,e.elementsNeedUpdate=!1,e.verticesNeedUpdate=!1,e.uvsNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.lineDistancesNeedUpdate=!1,e.groupsNeedUpdate=!1,e}return Object(A.a)(n,[{key:"applyMatrix4",value:function(e){for(var t=(new jn).getNormalMatrix(e),n=0,r=this.vertices.length;n<r;n++)this.vertices[n].applyMatrix4(e);for(var i=0,a=this.faces.length;i<a;i++){var o=this.faces[i];o.normal.applyMatrix3(t).normalize();for(var s=0,u=o.vertexNormals.length;s<u;s++)o.vertexNormals[s].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}},{key:"rotateX",value:function(e){return IS.makeRotationX(e),this.applyMatrix4(IS),this}},{key:"rotateY",value:function(e){return IS.makeRotationY(e),this.applyMatrix4(IS),this}},{key:"rotateZ",value:function(e){return IS.makeRotationZ(e),this.applyMatrix4(IS),this}},{key:"translate",value:function(e,t,n){return IS.makeTranslation(e,t,n),this.applyMatrix4(IS),this}},{key:"scale",value:function(e,t,n){return IS.makeScale(e,t,n),this.applyMatrix4(IS),this}},{key:"lookAt",value:function(e){return PS.lookAt(e),PS.updateMatrix(),this.applyMatrix4(PS.matrix),this}},{key:"fromBufferGeometry",value:function(e){var t=this,n=null!==e.index?e.index:void 0,r=e.attributes;if(void 0===r.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var i=r.position,a=r.normal,o=r.color,s=r.uv,u=r.uv2;void 0!==u&&(this.faceVertexUvs[1]=[]);for(var c=0;c<i.count;c++)t.vertices.push((new tr).fromBufferAttribute(i,c)),void 0!==o&&t.colors.push((new Gn).fromBufferAttribute(o,c));function l(e,n,r,i){var c=void 0===o?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()],l=void 0===a?[]:[(new tr).fromBufferAttribute(a,e),(new tr).fromBufferAttribute(a,n),(new tr).fromBufferAttribute(a,r)],h=new BS(e,n,r,l,c,i);t.faces.push(h),void 0!==s&&t.faceVertexUvs[0].push([(new An).fromBufferAttribute(s,e),(new An).fromBufferAttribute(s,n),(new An).fromBufferAttribute(s,r)]),void 0!==u&&t.faceVertexUvs[1].push([(new An).fromBufferAttribute(u,e),(new An).fromBufferAttribute(u,n),(new An).fromBufferAttribute(u,r)])}var h=e.groups;if(h.length>0)for(var d=0;d<h.length;d++)for(var f=h[d],p=f.start,v=p,m=p+f.count;v<m;v+=3)void 0!==n?l(n.getX(v),n.getX(v+1),n.getX(v+2),f.materialIndex):l(v,v+1,v+2,f.materialIndex);else if(void 0!==n)for(var g=0;g<n.count;g+=3)l(n.getX(g),n.getX(g+1),n.getX(g+2));else for(var y=0;y<i.count;y+=3)l(y,y+1,y+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(RS).negate(),this.translate(RS.x,RS.y,RS.z),this}},{key:"normalize",value:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,r=new Dr;return r.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(r),this}},{key:"computeFaceNormals",value:function(){for(var e=new tr,t=new tr,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],a=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),i.normal.copy(e)}}},{key:"computeVertexNormals",value:function(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=new Array(this.vertices.length),n=0,r=this.vertices.length;n<r;n++)t[n]=new tr;if(e)for(var i=new tr,a=new tr,o=0,s=this.faces.length;o<s;o++){var u=this.faces[o],c=this.vertices[u.a],l=this.vertices[u.b],h=this.vertices[u.c];i.subVectors(h,l),a.subVectors(c,l),i.cross(a),t[u.a].add(i),t[u.b].add(i),t[u.c].add(i)}else{this.computeFaceNormals();for(var d=0,f=this.faces.length;d<f;d++){var p=this.faces[d];t[p.a].add(p.normal),t[p.b].add(p.normal),t[p.c].add(p.normal)}}for(var v=0,m=this.vertices.length;v<m;v++)t[v].normalize();for(var g=0,y=this.faces.length;g<y;g++){var b=this.faces[g],w=b.vertexNormals;3===w.length?(w[0].copy(t[b.a]),w[1].copy(t[b.b]),w[2].copy(t[b.c])):(w[0]=t[b.a].clone(),w[1]=t[b.b].clone(),w[2]=t[b.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}},{key:"computeFlatVertexNormals",value:function(){this.computeFaceNormals();for(var e=0,t=this.faces.length;e<t;e++){var n=this.faces[e],r=n.vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}},{key:"computeMorphNormals",value:function(){for(var e=0,t=this.faces.length;e<t;e++){var r=this.faces[e];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(var i=0,a=r.vertexNormals.length;i<a;i++)r.__originalVertexNormals[i]?r.__originalVertexNormals[i].copy(r.vertexNormals[i]):r.__originalVertexNormals[i]=r.vertexNormals[i].clone()}var o=new n;o.faces=this.faces;for(var s=0,u=this.morphTargets.length;s<u;s++){if(!this.morphNormals[s]){this.morphNormals[s]={},this.morphNormals[s].faceNormals=[],this.morphNormals[s].vertexNormals=[];for(var c=this.morphNormals[s].faceNormals,l=this.morphNormals[s].vertexNormals,h=0,d=this.faces.length;h<d;h++){var f=new tr,p={a:new tr,b:new tr,c:new tr};c.push(f),l.push(p)}}var v=this.morphNormals[s];o.vertices=this.morphTargets[s].vertices,o.computeFaceNormals(),o.computeVertexNormals();for(var m=0,g=this.faces.length;m<g;m++){var y=this.faces[m],b=v.faceNormals[m],w=v.vertexNormals[m];b.copy(y.normal),w.a.copy(y.vertexNormals[0]),w.b.copy(y.vertexNormals[1]),w.c.copy(y.vertexNormals[2])}}for(var x=0,O=this.faces.length;x<O;x++){var k=this.faces[x];k.normal=k.__originalFaceNormal,k.vertexNormals=k.__originalVertexNormals}}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new ir),this.boundingBox.setFromPoints(this.vertices)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new kr),this.boundingSphere.setFromPoints(this.vertices)}},{key:"merge",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e&&e.isGeometry){var r,i=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,u=e.faces,c=this.colors,l=e.colors;void 0!==t&&(r=(new jn).getNormalMatrix(t));for(var h=0,d=o.length;h<d;h++){var f=o[h].clone();void 0!==t&&f.applyMatrix4(t),a.push(f)}for(var p=0,v=l.length;p<v;p++)c.push(l[p].clone());for(var m=0,g=u.length;m<g;m++){var y=u[m],b=void 0,w=void 0,x=y.vertexNormals,O=y.vertexColors,k=new BS(y.a+i,y.b+i,y.c+i);k.normal.copy(y.normal),void 0!==r&&k.normal.applyMatrix3(r).normalize();for(var _=0,S=x.length;_<S;_++)b=x[_].clone(),void 0!==r&&b.applyMatrix3(r).normalize(),k.vertexNormals.push(b);k.color.copy(y.color);for(var E=0,A=O.length;E<A;E++)w=O[E],k.vertexColors.push(w.clone());k.materialIndex=y.materialIndex+n,s.push(k)}for(var j=0,T=e.faceVertexUvs.length;j<T;j++){var M=e.faceVertexUvs[j];void 0===this.faceVertexUvs[j]&&(this.faceVertexUvs[j]=[]);for(var C=0,D=M.length;C<D;C++){for(var I=M[C],P=[],R=0,L=I.length;R<L;R++)P.push(I[R].clone());this.faceVertexUvs[j].push(P)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)}},{key:"mergeMesh",value:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)}},{key:"mergeVertices",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t={},n=[],r=[],i=Math.pow(10,e),a=0,o=this.vertices.length;a<o;a++){var s=this.vertices[a],u=Math.round(s.x*i)+"_"+Math.round(s.y*i)+"_"+Math.round(s.z*i);void 0===t[u]?(t[u]=a,n.push(this.vertices[a]),r[a]=n.length-1):r[a]=r[t[u]]}for(var c=[],l=0,h=this.faces.length;l<h;l++){var d=this.faces[l];d.a=r[d.a],d.b=r[d.b],d.c=r[d.c];for(var f=[d.a,d.b,d.c],p=0;p<3;p++)if(f[p]===f[(p+1)%3]){c.push(l);break}}for(var v=c.length-1;v>=0;v--){var m=c[v];this.faces.splice(m,1);for(var g=0,y=this.faceVertexUvs.length;g<y;g++)this.faceVertexUvs[g].splice(m,1)}var b=this.vertices.length-n.length;return this.vertices=n,b}},{key:"setFromPoints",value:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];this.vertices.push(new tr(r.x,r.y,r.z||0))}return this}},{key:"sortFacesByMaterialIndex",value:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));var r,i,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===t&&(r=[]),o&&o.length===t&&(i=[]);for(var s=0;s<t;s++){var u=e[s]._id;r&&r.push(a[u]),i&&i.push(o[u])}r&&(this.faceVertexUvs[0]=r),i&&(this.faceVertexUvs[1]=i)}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}for(var r=[],i=0;i<this.vertices.length;i++){var a=this.vertices[i];r.push(a.x,a.y,a.z)}for(var o=[],s=[],u={},c=[],l={},h=[],d={},f=0;f<this.faces.length;f++){var p=this.faces[f],v=void 0!==this.faceVertexUvs[0][f],m=p.normal.length()>0,g=p.vertexNormals.length>0,y=1!==p.color.r||1!==p.color.g||1!==p.color.b,b=p.vertexColors.length>0,w=0;if(w=_(w,0,0),w=_(w,1,!0),w=_(w,2,!1),w=_(w,3,v),w=_(w,4,m),w=_(w,5,g),w=_(w,6,y),w=_(w,7,b),o.push(w),o.push(p.a,p.b,p.c),o.push(p.materialIndex),v){var x=this.faceVertexUvs[0][f];o.push(A(x[0]),A(x[1]),A(x[2]))}if(m&&o.push(S(p.normal)),g){var O=p.vertexNormals;o.push(S(O[0]),S(O[1]),S(O[2]))}if(y&&o.push(E(p.color)),b){var k=p.vertexColors;o.push(E(k[0]),E(k[1]),E(k[2]))}}function _(e,t,n){return n?e|1<<t:e&~(1<<t)}function S(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==u[t]||(u[t]=s.length/3,s.push(e.x,e.y,e.z)),u[t]}function E(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==l[t]||(l[t]=c.length,c.push(e.getHex())),l[t]}function A(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]||(d[t]=h.length/2,h.push(e.x,e.y)),d[t]}return e.data={},e.data.vertices=r,e.data.normals=s,c.length>0&&(e.data.colors=c),h.length>0&&(e.data.uvs=[h]),e.data.faces=o,e}},{key:"clone",value:function(){return(new n).copy(this)}},{key:"copy",value:function(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;for(var t=e.vertices,n=0,r=t.length;n<r;n++)this.vertices.push(t[n].clone());for(var i=e.colors,a=0,o=i.length;a<o;a++)this.colors.push(i[a].clone());for(var s=e.faces,u=0,c=s.length;u<c;u++)this.faces.push(s[u].clone());for(var l=0,h=e.faceVertexUvs.length;l<h;l++){var d=e.faceVertexUvs[l];void 0===this.faceVertexUvs[l]&&(this.faceVertexUvs[l]=[]);for(var f=0,p=d.length;f<p;f++){for(var v=d[f],m=[],g=0,y=v.length;g<y;g++){var b=v[g];m.push(b.clone())}this.faceVertexUvs[l].push(m)}}for(var w=e.morphTargets,x=0,O=w.length;x<O;x++){var k={};if(k.name=w[x].name,void 0!==w[x].vertices){k.vertices=[];for(var _=0,S=w[x].vertices.length;_<S;_++)k.vertices.push(w[x].vertices[_].clone())}if(void 0!==w[x].normals){k.normals=[];for(var E=0,A=w[x].normals.length;E<A;E++)k.normals.push(w[x].normals[E].clone())}this.morphTargets.push(k)}for(var j=e.morphNormals,T=0,M=j.length;T<M;T++){var C={};if(void 0!==j[T].vertexNormals){C.vertexNormals=[];for(var D=0,I=j[T].vertexNormals.length;D<I;D++){var P=j[T].vertexNormals[D],R={};R.a=P.a.clone(),R.b=P.b.clone(),R.c=P.c.clone(),C.vertexNormals.push(R)}}if(void 0!==j[T].faceNormals){C.faceNormals=[];for(var L=0,N=j[T].faceNormals.length;L<N;L++)C.faceNormals.push(j[T].faceNormals[L].clone())}this.morphNormals.push(C)}for(var B=e.skinWeights,F=0,U=B.length;F<U;F++)this.skinWeights.push(B[F].clone());for(var z=e.skinIndices,V=0,G=z.length;V<G;V++)this.skinIndices.push(z[V].clone());for(var H=e.lineDistances,W=0,q=H.length;W<q;W++)this.lineDistances.push(H[W]);var Y=e.boundingBox;null!==Y&&(this.boundingBox=Y.clone());var X=e.boundingSphere;return null!==X&&(this.boundingSphere=X.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}},{key:"toBufferGeometry",value:function(){var e=(new NS).fromGeometry(this),t=new Di,n=new Float32Array(3*e.vertices.length);if(t.setAttribute("position",new wi(n,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(3*e.normals.length);t.setAttribute("normal",new wi(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var i=new Float32Array(3*e.colors.length);t.setAttribute("color",new wi(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var a=new Float32Array(2*e.uvs.length);t.setAttribute("uv",new wi(a,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);t.setAttribute("uv2",new wi(o,2).copyVector2sArray(e.uvs2))}for(var s in t.groups=e.groups,e.morphTargets){for(var u=[],c=e.morphTargets[s],l=0,h=c.length;l<h;l++){var d=c[l],f=new _i(3*d.data.length,3);f.name=d.name,u.push(f.copyVector3sArray(d.data))}t.morphAttributes[s]=u}if(e.skinIndices.length>0){var p=new _i(4*e.skinIndices.length,4);t.setAttribute("skinIndex",p.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var v=new _i(4*e.skinWeights.length,4);t.setAttribute("skinWeight",v.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(t.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(t.boundingBox=e.boundingBox.clone()),t}},{key:"computeTangents",value:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")}},{key:"computeLineDistances",value:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}},{key:"applyMatrix",value:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}],[{key:"createBufferGeometryFromObject",value:function(e){var t=new Di,n=e.geometry;if(e.isPoints||e.isLine){var r=new _i(3*n.vertices.length,3),i=new _i(3*n.colors.length,3);if(t.setAttribute("position",r.copyVector3sArray(n.vertices)),t.setAttribute("color",i.copyColorsArray(n.colors)),n.lineDistances&&n.lineDistances.length===n.vertices.length){var a=new _i(n.lineDistances.length,1);t.setAttribute("lineDistance",a.copyArray(n.lineDistances))}null!==n.boundingSphere&&(t.boundingSphere=n.boundingSphere.clone()),null!==n.boundingBox&&(t.boundingBox=n.boundingBox.clone())}else e.isMesh&&(t=n.toBufferGeometry());return t}}]),n}(vn);LS.prototype.isGeometry=!0;var NS=function(){function e(){Object(E.a)(this,e),this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}return Object(A.a)(e,[{key:"computeGroups",value:function(e){var t,n,r,i=[],a=e.faces;for(n=0;n<a.length;n++){var o=a[n];o.materialIndex!==r&&(r=o.materialIndex,void 0!==t&&(t.count=3*n-t.start,i.push(t)),t={start:3*n,materialIndex:r})}void 0!==t&&(t.count=3*n-t.start,i.push(t)),this.groups=i}},{key:"fromGeometry",value:function(e){var t,n=e.faces,r=e.vertices,i=e.faceVertexUvs,a=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=e.morphTargets,u=s.length;if(u>0){t=[];for(var c=0;c<u;c++)t[c]={name:s[c].name,data:[]};this.morphTargets.position=t}var l,h=e.morphNormals,d=h.length;if(d>0){l=[];for(var f=0;f<d;f++)l[f]={name:h[f].name,data:[]};this.morphTargets.normal=l}var p=e.skinIndices,v=e.skinWeights,m=p.length===r.length,g=v.length===r.length;r.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var y=0;y<n.length;y++){var b=n[y];this.vertices.push(r[b.a],r[b.b],r[b.c]);var w=b.vertexNormals;if(3===w.length)this.normals.push(w[0],w[1],w[2]);else{var x=b.normal;this.normals.push(x,x,x)}var O=b.vertexColors;if(3===O.length)this.colors.push(O[0],O[1],O[2]);else{var k=b.color;this.colors.push(k,k,k)}if(!0===a){var _=i[0][y];void 0!==_?this.uvs.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",y),this.uvs.push(new An,new An,new An))}if(!0===o){var S=i[1][y];void 0!==S?this.uvs2.push(S[0],S[1],S[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",y),this.uvs2.push(new An,new An,new An))}for(var E=0;E<u;E++){var A=s[E].vertices;t[E].data.push(A[b.a],A[b.b],A[b.c])}for(var j=0;j<d;j++){var T=h[j].vertexNormals[y];l[j].data.push(T.a,T.b,T.c)}m&&this.skinIndices.push(p[b.a],p[b.b],p[b.c]),g&&this.skinWeights.push(v[b.a],v[b.b],v[b.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}}]),e}(),BS=function(){function e(t,n,r,i,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;Object(E.a)(this,e),this.a=t,this.b=n,this.c=r,this.normal=i&&i.isVector3?i:new tr,this.vertexNormals=Array.isArray(i)?i:[],this.color=a&&a.isColor?a:new Gn,this.vertexColors=Array.isArray(a)?a:[],this.materialIndex=o}return Object(A.a)(e,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var r=0,i=e.vertexColors.length;r<i;r++)this.vertexColors[r]=e.vertexColors[r].clone();return this}}]),e}(),FS=["a","b","c"];function US(e,t){switch(t){case"c":return e.c;case"b":return e.b;default:return e.a}}function zS(e,t,n){var r=Math.min(e,t)+"_"+Math.max(e,t);return n.get(r)}function VS(e,t,n,r,i,a){var o,s=Math.min(e,t),u=Math.max(e,t),c=s+"_"+u;r.has(c)?o=r.get(c):(o={a:n[s],b:n[u],newEdge:null,faces:[]},r.set(c,o));o.faces.push(i),a[e].edges.push(o),a[t].edges.push(o)}function GS(e,t,n,r,i){e.push(new BS(t,n,r,void 0,void 0,i))}function HS(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function WS(e,t,n,r){e.push([t.clone(),n.clone(),r.clone()])}var qS=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;Object(E.a)(this,e),this.subdivisions=t}return Object(A.a)(e,[{key:"modify",value:function(e){(e=e instanceof Di?(new LS).fromBufferGeometry(e):e.clone()).mergeVertices();for(var t=this.subdivisions;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}},{key:"_smooth",value:function(e){var t,n,r,i,a,o=new tr,s=e.vertices,u=e.faces,c=e.faceVertexUvs[0],l=void 0!==c&&c.length>0,h=[],d=new Map;!function(e,t,n,r){var i,a,o;for(i=0,a=e.length;i<a;i++)n[i]={edges:[]};for(i=0,a=t.length;i<a;i++)VS((o=t[i]).a,o.b,e,r,o,n),VS(o.b,o.c,e,r,o,n),VS(o.c,o.a,e,r,o,n)}(s,u,h,d);for(var f,p,v,m,g,y,b,w=[],x=0,O=Array.from(d.keys());x<O.length;x++){var k=O[x];for(p=d.get(k),v=new tr,g=3/8,y=1/8,2!=(b=p.faces.length)&&(g=.5,y=0),v.addVectors(p.a,p.b).multiplyScalar(g),o.set(0,0,0),i=0;i<b;i++){for(m=p.faces[i],a=0;a<3&&((f=s[US(m,FS[a])])===p.a||f===p.b);a++);f&&o.add(f)}o.multiplyScalar(y),v.add(o),p.newEdge=w.length,w.push(v)}var _,S,E,A,j,T,M,C=[];for(n=0,r=s.length;n<r;n++){for(T=s[n],3==(t=(j=h[n].edges).length)?_=3/16:t>3&&(_=3/(8*t)),S=1-t*Number(_),E=_,t<=2&&(2==t&&(S=3/4,E=1/8)),M=T.clone().multiplyScalar(S),o.set(0,0,0),i=0;i<t;i++)f=(A=j[i]).a!==T?A.a:A.b,o.add(f);o.multiplyScalar(Number(E)),M.add(o),C.push(M)}var D,I,P,R,L,N,B,F=C.concat(w),U=C.length,z=[],V=[],G=new An,H=new An,W=new An;for(n=0,r=u.length;n<r;n++)m=u[n],GS(z,D=Number(zS(m.a,m.b,d).newEdge)+U,I=Number(zS(m.b,m.c,d).newEdge)+U,P=Number(zS(m.c,m.a,d).newEdge)+U,m.materialIndex),GS(z,m.a,D,P,m.materialIndex),GS(z,m.b,I,D,m.materialIndex),GS(z,m.c,P,I,m.materialIndex),l&&(L=(R=c[n])[0],N=R[1],B=R[2],G.set(HS(L.x,N.x),HS(L.y,N.y)),H.set(HS(N.x,B.x),HS(N.y,B.y)),W.set(HS(L.x,B.x),HS(L.y,B.y)),WS(V,G,H,W),WS(V,L,G,W),WS(V,N,H,G),WS(V,B,W,H));e.vertices=F,e.faces=z,l&&(e.faceVertexUvs[0]=V)}}]),e}(),YS=new tr,XS=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a=null!==(n=null!==(r=e.geometry)&&void 0!==r?r:null===t||void 0===t?void 0:t.geometry)&&void 0!==n?n:(new Di).copy(new Ji(100,100,100));void 0===t?(a.computeBoundingBox(),a.boundingBox.getSize(YS),i={width:YS.x,height:YS.y,depth:YS.z,subdivisions:0}):i=t.parameters;var o=Object(p.a)(Object(p.a)({},i),e.parameters);return{parameters:{width:Math.abs(o.width),height:Math.abs(o.height),depth:Math.abs(o.depth),subdivisions:Math.abs(o.subdivisions)},geometry:a}}},{key:"build",value:function(e){var t,n=e.parameters,r=n.width,i=n.height,a=n.depth,o=n.subdivisions,s=null!==(t=e.geometry)&&void 0!==t?t:(new Di).copy(new Ji(100,100,100)),u=s.userData.parameters;void 0===u?(s.computeBoundingBox(),s.boundingBox.getSize(YS)):YS.set(u.width,u.height,u.depth),(r!==YS.x||i!==YS.y||a!==YS.z)&&s.scale(0===YS.x?1:r/YS.x,0===YS.y?1:i/YS.y,0===YS.z?1:a/YS.z);var c=s.originalGeometry;return o>0?(void 0===c||(null===u||void 0===u?void 0:u.subdivisions)!==o)&&(void 0===c&&(c=s),s=new qS(o).modify(c).toBufferGeometry()):(void 0!==c&&(s=c),c=void 0,void 0===s.getAttribute("normal")&&s.computeVertexNormals()),void 0!==c&&Object.assign(s,{originalGeometry:c}),delete e.geometry,Object.assign(s,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"NonParametricGeometry"})})}},{key:"loadFromUrl",value:function(e,t,n){var r=this;new ol(n).load(e,(function(e){var n=r.normalizeInputs({geometry:e});e.boundingBox.getSize(YS);var i=100/YS.x;Object.assign(n.parameters,{width:100,height:YS.y*i,depth:YS.z*i}),t(r.build(n))}))}}]),e}(),KS=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof Y_?e.shape:new Y_,parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(r=a.height)&&void 0!==r?r:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:0)})}}},{key:"build",value:function(e){for(var t=e.parameters,n=t.width,r=t.height,i=t.spikes,a=t.cornerRadius,o=t.depth,s=t.extrudeBevelSize,u=t.extrudeBevelSegments,c=e.shape,l=.5*n,h=.5*r,d=2*Math.PI/i,f=0;f<i;f++){var v=d*f,m=0+Math.sin(v)*l,g=0+Math.cos(v)*h;c.addPoint(c.createPoint(m,g))}c.isClosed=!0;for(var y=0,b=c.points.length;y<b;y++)c.points[y].roundness=a;c.roundness=a,c.update();var w=bS.create({shape:c,parameters:{roundness:a,depth:o,extrudeBevelSize:s,extrudeBevelSegments:u}});return Object.assign(w,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"PolygonGeometry"})})}}]),e}(),QS=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(r=a.height)&&void 0!==r?r:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:a.width)})}}},{key:"build",value:function(e){var t=e.parameters,n=t.width,r=t.height,i=t.depth,a=t.radialSegments,o=t.heightSegments,s=t.openEnded,u=t.cornerRadius,c=t.cornerSegments,l=new eE(.5*n,r,a,o,s,u,c);return l.scale(1,1,i/n),Object.assign(l,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"PyramidGeometry"})})}}]),e}();function ZS(e,t,n){n.x=e.x*t.x,n.y=e.y,n.z=e.x*t.y}function JS(e,t,n,r,i,a){var o=t.clone().sub(e),s=n.clone().sub(e),u=o.angleTo(s);if(o.normalize(),s.normalize(),r===i){var c=o.add(s).normalize();a.copy(e).addScaledVector(c,r/Math.sin(u/2))}else{var l=o.angleTo(s);a.copy(e),a.addScaledVector(o,i/Math.sin(l)),a.addScaledVector(s,r/Math.sin(l))}}function $S(e,t,n){var r=e.clone().sub(t),i=n.clone().sub(t);return r.projectOnVector(i),r.add(t)}var eE=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:4;Object(E.a)(this,n),e=t.call(this),a=Math.floor(Math.max(3,a)),o=Math.floor(o),c=Math.floor(c);var l,h=[],d=[],f=[],p=[],v=0,m=i/2,y=Math.PI/a,b=r*Math.cos(Math.PI/a),w=2*Math.PI/a,x=(a-2)*Math.PI/a,O=Math.PI-x,k=new tr(0,-m,0),_=new tr(0,m,0),S=new An(r,-m),A=new An(b,-m),j=new An(0,_.y).sub(A),T=new An(0,_.y).sub(S),M=new An(j.y,-j.x).normalize(),C=new An(T.y,-T.x).normalize(),D=r*Math.cos(Math.PI/a)*Math.tan((Math.PI-j.angle())/2)-1e-8;u=Math.min(u,D);var I=new tr(M.x,M.y,0),P=new tr(Math.cos(w)*I.x,I.y,Math.sin(w)*I.x);l=I.angleTo(P);var R=u/Math.tan((Math.PI-j.angle())/2),L=u/Math.tan((Math.PI-l)/2),N=new tr;if(!s){d.push(k.x,k.y,k.z),f.push(0,-1,0),p.push(0,0);var B=v++,F=[],U=S.clone(),z=R/Math.cos(Math.PI/a);U.x-=z;for(var V=0;V<a;V++){var G=V/a*Math.PI*2+y;ZS(U,new An(Math.sin(G),Math.cos(G)),N),d.push(N.x,N.y,N.z),f.push(0,-1,0),p.push(0,0),F.push(v++)}for(var H=0;H<F.length;H++)h.push(F[H],B,F[(H+1)%F.length])}for(var W=[],q=new tr,Y=new tr,X=new tr,K=new tr,Q=new tr,Z=new tr,J=0;J<a;J++){var $=J/a*Math.PI*2+y,ee=(J+.5)/a*Math.PI*2+y,te=(J+1)/a*Math.PI*2+y,ne=new An(Math.sin($),Math.cos($)),re=new An(Math.sin(ee),Math.cos(ee)),ie=new An(Math.sin(te),Math.cos(te));ZS(S,ne,Y),ZS(S,ie,X),ZS(M,re,q),JS(_,Y,X,L,L,K),d.push(K.x,K.y,K.z),JS(Y,_,X,L,R,Q),d.push(Q.x,Q.y,Q.z),JS(X,Y,_,R,L,Z),d.push(Z.x,Z.y,Z.z),f.push(q.x,q.y,q.z),f.push(q.x,q.y,q.z),f.push(q.x,q.y,q.z),p.push(0,0),p.push(0,0),p.push(0,0);var ae=v++,oe=v++,se=v++;if(h.push(ae,oe,se),u>0){var ue=Y.clone().add(X).multiplyScalar(.5),ce=_.clone().sub(ue).normalize(),le=k.clone().sub(ue).normalize().add(ce).normalize().multiplyScalar(-1);ze(ue,Z.clone().sub(Q),le,j.angle());var he,de=void 0,fe=new tr;ZS(C,ie,fe);var pe=Z.clone().add(K).multiplyScalar(.5),ve=ze(pe=$S(pe,X,_),Z.clone().sub(K),fe,l,K.y),me=Object(g.a)(ve,2);he=me[0],de=me[1];var ge=he,ye=ge.clone().setY(0).normalize(),be=new tr(0,-1,0),we=ye.clone().cross(be);Ve(ge,ye,be,we),W.concat(de);var xe=j.angle(),Oe=Math.PI-xe,ke=_.clone();ke.y-=u/Math.sin(xe-Math.PI/2);for(var _e=new tr,Se=[],Ee=0;Ee<c;Ee++){for(var Ae=[],je=Math.PI/2-Oe*Ee/c,Te=Math.cos(je),Me=Math.sin(je),Ce=ee,De=0;De<=Ee;De++){var Ie=Math.cos(Ce),Pe=Math.sin(Ce);q.x=Te*Pe,q.y=Me,q.z=Te*Ie,_e.copy(ke).addScaledVector(q,u),d.push(_e.x,_e.y,_e.z),f.push(q.x,q.y,q.z),p.push(0,0),Ae.push(v++),Ce+=2*Math.PI/Ee/a}Se.push(Ae)}de.reverse(),Se.push(de);for(var Re=Se.length-1,Le=0;Le<Re;Le++){var Ne=Se[Le],Be=Se[Le+1],Fe=Ne.length-1;h.push(Be[1],Ne[0],Be[0]);for(var Ue=1;Ue<=Fe;Ue++)h.push(Ne[Ue],Ne[Ue-1],Be[Ue]),h.push(Be[Ue+1],Ne[Ue],Be[Ue])}}}function ze(e,t,n,r,i){var a=-r/2,o=(Math.PI-r)/2,s=t.clone().normalize().cross(n);e.addScaledVector(n,-u/Math.sin(o));for(var l=new tr,m=new tr,g=v,y=[],b=0;b<=c;b++){var w=a+b/c*r;m.set(0,0,0),m.addScaledVector(s,Math.sin(w)),m.addScaledVector(n,Math.cos(w));for(var x=0;x<=1;x++){var O=x/1-.5;if(l.copy(e),l.addScaledVector(t,O),l.addScaledVector(m,u),null!=i){var k=Math.max(0,l.y-i);l.addScaledVector(t,-k/t.y)}d.push(l.x,l.y,l.z),f.push(m.x,m.y,m.z),p.push(0,0),0===x&&y.push(v),v++}}for(var _=0;_<c;_++)for(var S=0;S<1;S++){var E=g+S+2*_,A=E+2,j=A+1,T=E+1;h.push(E,A,T),h.push(A,j,T)}return[e.clone().addScaledVector(t,.5),y]}function Ve(e,t,n,r){for(var i=Math.PI/2,a=T.angle()-i,o=[],s=new tr,l=new tr,m=0;m<=c;m++){for(var g=[],y=m/c,b=0;b<=m;b++){var w=((m?b/m:0)-.5)*O,x=Math.cos(w),k=Math.sin(w),_=(i+Math.atan(Math.tan(a)*x))*y,S=Math.cos(_),E=Math.sin(_);s.set(0,0,0),s.addScaledVector(t,E*x),s.addScaledVector(n,S),s.addScaledVector(r,E*k),l.copy(e).addScaledVector(s,u),d.push(l.x,l.y,l.z),f.push(s.x,s.y,s.z),p.push(0,0),g.push(v++)}o.push(g)}for(var A=o.length-1,j=0;j<A;j++){var M=o[j],C=o[j+1],D=M.length-1;h.push(M[0],C[1],C[0]);for(var I=1;I<=D;I++)h.push(M[I-1],M[I],C[I]),h.push(M[I],C[I+1],C[I])}}return e.setIndex(h),e.setAttribute("position",new _i(d,3)),e.setAttribute("normal",new _i(f,3)),e.setAttribute("uv",new _i(p,2)),e}return Object(A.a)(n)}(Di),tE=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a,o=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),s=Object.assign(null!==(r=null===t||void 0===t?void 0:t.ui)&&void 0!==r?r:{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof Y_?e.shape:new Y_,parameters:Object.assign(o,{width:Math.abs(o.width),height:Math.abs(null!==(i=o.height)&&void 0!==i?i:o.width),depth:Math.abs(null!==(a=o.depth)&&void 0!==a?a:0)}),ui:s}}},{key:"build",value:function(e){var t=e.shape,n=e.parameters,r=n.width,i=n.height,a=n.cornerRadius,o=n.cornerType,s=n.depth,u=n.extrudeBevelSize,c=n.extrudeBevelSegments,l={x:.5*r,y:.5*i},h={x:-l.x,y:-l.y},d={x:l.x,y:l.y};function f(e,t,n){return t>r&&n>i?Math.min(e*r/t,e*i/n):t>r?e*r/t:n>i?e*i/n:e}var v=[];v[0]=0===a[0]?0:f(a[0],a[0]+a[3],a[0]+a[1]),v[1]=0===a[1]?0:f(a[1],a[1]+a[2],a[1]+a[0]),v[2]=0===a[2]?0:f(a[2],a[2]+a[1],a[2]+a[3]),v[3]=0===a[3]?0:f(a[3],a[3]+a[0],a[3]+a[2]);var m=h.x,g=d.x,y=d.y,b=h.y;t.addPoint(t.createPoint(m,y)),t.addPoint(t.createPoint(g,y)),t.addPoint(t.createPoint(g,b)),t.addPoint(t.createPoint(m,b)),t.isClosed=!0;for(var w=!0,x=0,O=t.points.length;x<O;x++)t.points[x].roundness=v[x],x>0&&v[x]!==v[x-1]&&(w=!1);w&&(t.roundness=v[0]),t.useCubicForRoundedCorners=1!==o,t.update();var k=bS.create({shape:t,parameters:{depth:s,extrudeBevelSize:u,extrudeBevelSegments:c}});return Object.assign(k,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"RectangleGeometry"})})}}]),e}(),nE=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(r=a.height)&&void 0!==r?r:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:a.width)})}}},{key:"build",value:function(e){var t=e.parameters,n=t.width,r=void 0===n?100:n,i=t.height,a=void 0===i?r:i,o=t.depth,s=void 0===o?r:o,u=t.widthSegments,c=void 0===u?64:u,l=t.heightSegments,h=void 0===l?64:l,d=t.phiStart,f=t.phiLength,v=t.thetaStart,m=t.thetaLength,g=new kc(.5*r,c,h,d,f,v,m);return g.scale(1,a/r,s/r),Object.assign(g,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"SphereGeometry"})})}}]),e}(),rE=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(null!==(r=i.height)&&void 0!==r?r:i.width),depth:0})}}},{key:"build",value:function(e){var t=e.parameters,n=t.width,r=void 0===n?100:n,i=t.height,a=void 0===i?r:i,o=t.widthSegments,s=void 0===o?8:o,u=t.heightSegments,c=new xa(r,a,s,void 0===u?8:u);return c.scale(1,1,1),Object.assign(c,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"PlaneGeometry"})})}}]),e}(),iE=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(r=a.height)&&void 0!==r?r:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:a.width)})}}},{key:"build",value:function(e){var t=e.parameters,n=t.width,r=t.height,i=t.depth,a=t.angle,o=t.cornerRadius,s=t.cornerSegments,u=new aE(n,r,i,a,o,s);return Object.assign(u,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"BackdropGeometry"})})}}]),e}(),aE=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:90,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:24;Object(E.a)(this,n),(e=t.call(this)).type="BackdropGeometry";var c=[],l=[],h=[],d=.001;0==s&&(u=1),u=Math.max(1,Math.floor(u)),s=Math.min(s,100),o=Math.min(180-d,o),o*=Math.PI/180;var f=[],p=Math.PI/2,v=function(){return new tr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)},m=v(),y=v(),b=i/2,w=r/2,x=a/2,O=-w,k=+w,_=[v(O,-b,+x),v(O,-b,-x),v(O,+b,-x)],S=_[0],A=_[1],j=_[2],T=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Math.sin(e-Math.PI/(+t+1))},M=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Math.cos(e-Math.PI/(+t+1))};j.y=Math.sin(o)*i-b;var C=Math.cos(o)*i-x,D=S.z-d;o<=p?(j.z=Math.min(C,D),j.z==D&&(j.y-=(C-D)/Math.tan(p-o))):A.z=Math.min(A.z-C-x,S.z-d),m.subVectors(S,A),y.subVectors(j,A);var I=Math.min(m.length(),y.length())*s/100,P=I*Math.tan(o/2),R=I/Math.cos(o/2),L=m.clone().normalize().add(y.normalize()).setLength(R).add(A);m.set(0,T(o,!0),M(o,!0)),f.push([j,m.clone()]);for(var N=(Math.PI-o)/u,B=0;B<=u;B++){var F=p+o+B*N;m.set(0,Math.sin(F)*P,Math.cos(F)*P),m.add(L),y.set(0,T(F),M(F)),f.push([m.clone(),y.clone()])}f.push([S,v(0,1,0)]);var U=Math.sin(N/2)*P*2,z=f.length-1,V=f[0][0].distanceTo(f[1][0]),G=V+U*u+f[z-1][0].distanceTo(f[z][0]);f[0].push(1);for(var H=0;H<=u;H++)f[H+1].push(1-(V+H*U)/G);f[z].push(0);for(var W,q,Y,X=Object(g.a)(f[0],3),K=X[0],Q=X[1],Z=X[2],J=1;J<f.length;J++){var $;W=($=Object(g.a)(f[J],3))[0],q=$[1],Y=$[2],c.push(O,K.y,K.z,O,W.y,W.z,k,K.y,K.z,k,K.y,K.z,O,W.y,W.z,k,W.y,W.z),l.push(0,Q.y,Q.z,0,q.y,q.z,0,Q.y,Q.z,0,Q.y,Q.z,0,q.y,q.z,0,q.y,q.z),h.push(0,Z,0,Y,1,Z,1,Z,0,Y,1,Y),K=W,Q=q,Z=Y}return e.setAttribute("position",new _i(c,3)),e.setAttribute("normal",new _i(l,3)),e.setAttribute("uv",new _i(h,2)),e}return Object(A.a)(n)}(Di),oE=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof Y_?e.shape:new Y_,parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(r=a.height)&&void 0!==r?r:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:0)})}}},{key:"build",value:function(e){var t=e.parameters,n=t.width,r=t.height,i=t.innerRadiusPercent,a=t.spikes,o=t.cornerRadius,s=t.angle,u=t.depth,c=t.extrudeBevelSize,l=t.extrudeBevelSegments,h=e.shape,d=.5*n,f=.5*r,v=s*Math.PI/360/a,m=Math.PI/2*3*-1,g=d*i/100,y=f*i/100;if(3===a&&50===i){v=2*Math.PI/a;for(var b=0;b<a;b++){var w=v*b,x=0+Math.sin(w)*d,O=0+Math.cos(w)*f;h.addPoint(h.createPoint(x,O))}}else for(var k=0;k<a;k++){var _=0+Math.cos(m)*d,S=0+Math.sin(m)*f;h.addPoint(h.createPoint(_,S)),m+=v,_=0+Math.cos(m)*g,S=0+Math.sin(m)*y,h.addPoint(h.createPoint(_,S)),m+=v}h.isClosed=!0;for(var E=0,A=h.points.length;E<A;E++)h.points[E].roundness=o;h.roundness=o,h.update();var j=bS.create({shape:h,parameters:{roundness:o,depth:u,extrudeBevelSize:c,extrudeBevelSegments:l}});return Object.assign(j,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"StarGeometry"})})}}]),e}(),sE=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,depth:0},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(r=a.height)&&void 0!==r?r:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:0)})}}},{key:"build",value:function(e){var t=e.parameters,n=t.width,r=t.height,i=new xa(n,r);return Object.assign(i,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"TextFrameGeometry"})})}}]),e}(),uE=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,radialSegments:32,tubularSegments:64,arc:2*Math.PI,cornerRadius:30,cornerSegments:8},e.parameters),o=Math.abs(a.width),s=Math.abs(null!==(r=a.height)&&void 0!==r?r:a.width),u=Math.round(Math.abs(null!==(i=a.depth)&&void 0!==i?i:.25*a.width));return{parameters:Object.assign(a,{width:o,height:s,depth:u})}}},{key:"build",value:function(e){var t=e.parameters,n=t.width,r=t.height,i=t.depth,a=t.radialSegments,o=t.tubularSegments,s=function(e,t,n,r,i,a,o,s,u,c,l){var h;return h=[n,t],t=h[0],n=h[1],o=t/2,i/=2*Math.PI,1==i&&(c=0),new TS(!0,e,t,n,r,i,a,o,s,u,c,l)}(n,r,i,.5*n,t.arc,o,0,0,a,t.cornerRadius,t.cornerSegments);return s.scale(1,r/n,1),Object.assign(s,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"TorusGeometry"})})}}]),e}();var cE=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a,o=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(o,{width:Math.abs(o.width),height:Math.abs(null!==(r=o.height)&&void 0!==r?r:o.width),depth:Math.abs(null!==(i=o.depth)&&void 0!==i?i:o.width),tube:null!==(a=o.tube)&&void 0!==a?a:.125*o.width})}}},{key:"build",value:function(e){var t=e.parameters,n=t.width,r=t.tube,i=t.tubularSegments,a=t.radialSegments,o=t.p,s=t.q,u=.5*n;u!==r&&(u-=r);var c=new _c(u,r,i,a,o,s);return Object.assign(c,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"TorusKnotGeometry"})})}}]),e}(),lE=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var n,r,i,a=Object.assign({},null!==(n=null===t||void 0===t?void 0:t.parameters)&&void 0!==n?n:{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof Y_?e.shape:new Y_,parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(r=a.height)&&void 0!==r?r:a.width*(a.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:0)})}}},{key:"build",value:function(e){var t=e.parameters,n=t.width,r=void 0===n?100:n,i=t.height,a=t.cornerRadius,o=t.depth,s=t.extrudeBevelSize,u=t.extrudeBevelSegments,c=t.isRect,l=e.shape,h=.5*r,d=.5*i;c?(l.addPoint(l.createPoint(-h,d)),l.addPoint(l.createPoint(h,-d)),l.addPoint(l.createPoint(-h,-d))):(l.addPoint(l.createPoint(0,d)),l.addPoint(l.createPoint(h,-d)),l.addPoint(l.createPoint(-h,-d))),l.isClosed=!0;for(var f=0,v=l.points.length;f<v;f++)l.points[f].roundness=a;l.roundness=a,l.update();var m=bS.create({shape:l,parameters:{roundness:a,depth:o,extrudeBevelSize:s,extrudeBevelSegments:u}});return Object.assign(m,{userData:Object(p.a)(Object(p.a)({},e),{},{type:"TriangleGeometry"})})}}]),e}();var hE=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;Object(E.a)(this,n),(i=t.call(this)).charWidths=[],i.charCoords=[],i.wrappedText=[],i.isLowResolution=!1,i.vectorShapes=[],i.userData={parameters:e,type:"TextGeometry"};var a=r.getFont(e.font);return null!==a&&void 0!==a&&a.isLoaded?(i.font=a,i.update(e)):i.updateFont(e.font,r).then((function(){i.update(e),null===r||void 0===r||r.requestRender()})),i}return Object(A.a)(n,[{key:"updateFont",value:function(){var e=Object(m.a)(Object(S.a)().mark((function e(t,n){var r;return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.getFont(t),e.t0=r,!e.t0){e.next=6;break}return this.font=r,e.next=6,r.loadingPromise;case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"update",value:function(e){var t=this,n=this.font;if(this.userData={parameters:e,type:"TextGeometry"},null!==n&&void 0!==n&&n.isLoaded){var r=e.width,i=e.height,a=e.depth,o=e.extrudeBevelSize,s=e.extrudeBevelSegments,u=e.text,c=e.textTransform,l=function(e,t,n){var r;n=null!==(r=n)&&void 0!==r?r:e.text;var i,a=[""],o="",s=Object(j.a)(n);try{for(s.s();!(i=s.n()).done;){var u=i.value;o+=u," "===u||"\n"===u?(a[a.length-1]+=o,o="","\n"===u&&a.push("")):t.getTextWidth(a[a.length-1]+o,e)>e.width&&(a[a.length-1].length&&a.push(""),t.getTextWidth(a[a.length-1]+o,e)>e.width&&(1===o.length?(a[a.length-1]+=o,o=""):(a[a.length-1]+=o.slice(0,-1),o=o[o.length-1],a.push(""))))}}catch(c){s.e(c)}finally{s.f()}return a[a.length-1]+=o,a}(e,n,2===c?u.toUpperCase():3===c?u.toLowerCase():u),h=n.generateShapes(l,e),d=h.shapes,f=h.charWidths,p=h.charCoords,v=.5*r,m=.5*i,y=d.map((function(e){return(new Y_).fromShape(e)}));this.vectorShapes=y;var b=y.map((function(e){return bS.create({shape:e,parameters:{depth:a,extrudeBevelSegments:s,extrudeBevelSize:o,windingRule:a<=0?F_.NONZERO:F_.ODD,subdivisions:t.isLowResolution&&a>0?1:12}})})),w=b.length?eO(b):function(){var e=new Di;return e.setAttribute("position",new wi(new Float32Array([]),3)),e.setIndex(new wi(new Uint16Array([]),1)),e}();w.translate(-v,m,0),this.dispose(),this.wrappedText=l,this.charCoords=p,this.charWidths=f,this.deleteAttribute("extrudeNormal"),Object.entries(w.attributes).forEach((function(e){var n=Object(g.a)(e,2),r=n[0],i=n[1];t.setAttribute(r,i)})),this.setIndex(w.index),this.computeBoundingSphere()}else console.warn("Cannot update text because its font is not loaded")}},{key:"clone",value:function(){var e=bx(new Di,n.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}},{key:"copy",value:function(e){var t=this;return Object.entries(e.attributes).forEach((function(e){var n=Object(g.a)(e,2),r=n[0],i=n[1];t.setAttribute(r,i)})),this.setIndex(e.index),this.userData={parameters:Object(p.a)({},e.userData.parameters),type:"TextGeometry"},this}},{key:"setText",value:function(){var e=Object(m.a)(Object(S.a)().mark((function e(t){return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.font,!e.t0){e.next=4;break}return e.next=4,this.font.loadingPromise;case 4:return e.next=6,this.update(Object(p.a)(Object(p.a)({},this.userData.parameters),{},{text:t}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"text",get:function(){var e;return null!==(e=this.userData.parameters.text)&&void 0!==e?e:""}}]),n}(Di);var dE,fE=new Promise((function(e){dE=e})),pE=!1;function vE(){return mE.apply(this,arguments)}function mE(){return mE=Object(m.a)(Object(S.a)().mark((function e(){var t,r,i,a,o,s;return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!pE){e.next=2;break}return e.abrupt("return");case 2:return"https://unpkg.com/@splinetool/modelling-wasm@0.9.210/build",e.next=5,Promise.all([n.e(6).then(n.bind(null,83)),fetch("".concat("https://unpkg.com/@splinetool/modelling-wasm@0.9.210/build","/process.wasm")).then((function(e){return e.arrayBuffer()}))]);case 5:return t=e.sent,r=Object(g.a)(t,2),i=r[0],a=r[1],o=i.default,e.next=12,o({wasmBinary:a});case 12:s=e.sent,dE(s),pE=!0;case 14:case"end":return e.stop()}}),e)}))),mE.apply(this,arguments)}function gE(e,t,n){var r,i={parameters:e,type:e.type};if("VectorGeometry"===e.type){var a=Y_.createFromState(e.shape,e.width,e.height);i.shape=a}else if("NonParametricGeometry"===e.type)e.data.groups&&e.data.groups.forEach((function(e){var t;return e.materialIndex=Math.max(null!==(t=e.materialIndex)&&void 0!==t?t:0,0)})),i.geometry=(new ol).parse(e);else{if("SubdivGeometry"===e.type)return new EE(e,n);if("TextGeometry"===e.type)return new hE(e,t)}try{r=QE(i)}catch(a){console.error(a)}if(!r){var o=Y_.createFromState(Zw.defaultData(),100,100);i.shape=o,r=QE(i)}return r}var yE=new Dr;function bE(e,t,n,r){for(var i,a,o,s=e.position.array,u=e.normal.array,c=yE.makeScale(t,n,r).invert().elements,l=0,h=s.length;l<h;l+=3)s[l]*=t,s[l+1]*=n,s[l+2]*=r,i=u[l],a=u[l+1],o=u[l+2],u[l]=c[0]*i+c[4]*a+c[8]*o,u[l+1]=c[1]*i+c[5]*a+c[9]*o,u[l+2]=c[2]*i+c[6]*a+c[10]*o;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var wE,xE=new ir,OE=new tr;fE.then((function(e){wE=e}));var kE=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),_E=new Uint32Array([0,1,2,3]),SE=new Uint8Array([4]),EE=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;return Object(E.a)(this,n),(i=t.call(this)).data=e,i.flatShading=r,i.subdivPointer=0,i.rebuild(),i.freeSubdivPointer(),i}return Object(A.a)(n,[{key:"mutateDirectlyScaleBaked",value:function(e,t){this.freeSubdivPointer();var n=this.data.scaleBaked,r=bw.div(t,n);this.subdividedGeometry&&bE.apply(void 0,[this.subdividedGeometry.attributes].concat(Object(v.a)(r))),this.originalGeometry&&bE.apply(void 0,[this.originalGeometry.attributes].concat(Object(v.a)(r))),this.data=e;var i=this.userData.parameters;this.userData.parameters={width:i.width*r[0],height:i.height*r[1],depth:i.depth*r[2]},this.originalGeometry.boundingSphere.center.multiply(OE.fromArray(r));var a=OE.set(i.width,i.height,i.depth).length();this.originalGeometry.boundingSphere.radius=a/2}},{key:"ensureSubdivPointer",value:function(){return 0===this.subdivPointer&&this.rebuild(),this.subdivPointer}},{key:"rebuild",value:function(){var e,t,r,i,a;try{var o=n.build(this.data,void 0,!this.flatShading,void 0);r=o.originalGeometry,i=o.subdividedGeometry,a=o.subdivPointer}catch(u){r=new Ji(100,100,100),a=0}this.subdivPointer=a,this.originalGeometry=r,this.subdividedGeometry=null!==(e=i)&&void 0!==e?e:void 0;var s=null!==(t=this.subdividedGeometry)&&void 0!==t?t:this.originalGeometry;Object.assign(this,s),this.calcBoundingBox()}},{key:"freeSubdivPointer",value:function(){this.subdivPointer&&(n.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}},{key:"dispose",value:function(){Object(b.a)(Object(w.a)(n.prototype),"dispose",this).call(this),this.freeSubdivPointer()}},{key:"calcBoundingBox",value:function(){var e=this.originalGeometry;null===e.boundingSphere&&(e.boundingSphere=new kr,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));var t=e.attributes.position,n=e.boundingSphere.center;xE.setFromBufferAttribute(t),xE.getCenter(n),e.boundingSphere.radius=n.distanceTo(xE.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),xE.getSize(OE);var r={width:OE.x,height:OE.y,depth:OE.z};return this.userData.parameters=r,r}}],[{key:"build",value:function(e,t,r,i){var a,o,s,u,c=null!==(a=null===e||void 0===e?void 0:e.phongAngle)&&void 0!==a?a:35;!1===r&&(c=-1),t&&(wE.free_bvh(t),wE.free_subdivision_surface(t));try{o=n.allocate(e,i)}catch(l){console.error(l,e),o=n.allocate({positionWASM:kE,indexWASM:_E,verticesPerFaceWASM:SE},i)}if(wE.set_destination_refinement_level(o,0),s=n.buildLevel(o,!0,c),e.subdivisions>0)try{wE.set_destination_refinement_level(o,e.subdivisions),u=n.buildLevel(o,!1,c)}catch(h){try{wE.set_destination_refinement_level(o,e.subdivisions-1),u=n.buildLevel(o,!1,c)}catch(d){u=null}}else u=null;return{subdivPointer:o,originalGeometry:s,subdividedGeometry:u}}},{key:"primitiveToQuads",value:function(e,t,n){var r,i,a,o;if(e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),"DodecahedronGeometry"===e.type&&(e.detail=0),"TorusGeometry"===e.type&&e.arc===2*Math.PI){var s=e.width,u=e.height,c=e.depth,l=e.arc,h=e.tubularSegments,d=e.radialSegments;i=new TS(!0,s,c,u,.5*s,l/(2*Math.PI),h,c/2,0,d,0,0,!0)}else i=void 0!==e.shape?t.geometry:gE(e,n,!1);var f,p=jE(i.getAttribute("position"),i.getIndex());if(a=p.positions,o=p.triIndices,"CylinderGeometry"===e.type&&0===e.cornerRadius&&0===e.hollow&&!1===e.openEnded){var v=e.radialSegments*e.heightSegments*3*2;f=[v,v+3*e.radialSegments]}return{positions:a,indices:(r=IE(a,o,i,f)).indices,verticesPerFace:r.verticesPerFace}}},{key:"allocate",value:function(e,t){var n,r,i,a,o,s=[],u=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,a=e.indexWASM,o=e.verticesPerFaceWASM):(i=kE,a=_E,o=SE);var c,l=i.length,h=a.length,d=o.length,f=i.length+s.length+u.length,p=a.length+o.length,m=f*Float32Array.BYTES_PER_ELEMENT+p*Uint32Array.BYTES_PER_ELEMENT,g=f*Float32Array.BYTES_PER_ELEMENT,y=(Uint32Array.BYTES_PER_ELEMENT,wE._malloc(m)),b=new Float32Array(wE.HEAPF32.buffer,y,f),w=new Uint32Array(wE.HEAPU32.buffer,y+g,p);b.set(i,0),b.set(s,i.length),b.set(u,i.length+s.length),w.set(a,0),w.set(o,a.length),null!==e&&void 0!==e&&null!==(n=e.scaleBaked)&&void 0!==n&&n.some((function(e){return 1!==e}))&&(c=(r=new Dr).makeScale.apply(r,Object(v.a)(e.scaleBaked))),t&&(c?c.premultiply(t):c=t);var x=c?wE.alloc_subdivision_surface2(y,l,y+g,h,y+g+a.length*Uint32Array.BYTES_PER_ELEMENT,d,c.elements):wE.alloc_subdivision_surface(y,l,y+g,h,y+g+a.length*Uint32Array.BYTES_PER_ELEMENT,d);return wE._free(y),x}},{key:"buildLevel",value:function(e,t,n,r,i){var a=i?wE.get_mesh_data2(e,t?wE.Level.CONTROL:wE.Level.REFINED,n,i.elements):wE.get_mesh_data(e,t?wE.Level.CONTROL:wE.Level.REFINED,n),o=wE.HEAPU32.subarray(a>>2,8+(a>>2)),s=o.subarray(4,8),u=0,c=wE.HEAPU32[o[u]>>2],l=wE.HEAPF32.subarray(c>>2,(c>>2)+s[u]);u++;var h=wE.HEAPU32[o[u]>>2],d=wE.HEAPF32.subarray(h>>2,(h>>2)+s[u]);u++;var f=wE.HEAPU32[o[u]>>2],p=wE.HEAPU32.subarray(f>>2,(f>>2)+s[u]);u++;var v=wE.HEAPU32[o[u]>>2],m=wE.HEAPU32.subarray(v>>2,(v>>2)+s[u]);if(u++,void 0===r){var g=new Di;if(g.setIndex(new Oi(m,1)),g.setAttribute("position",new _i(l,3)),g.setAttribute("normal",new _i(d,3)),t){g.setAttribute("faceMap",new Oi(p,1));var y=new Float32Array(d.length/3*4).fill(0);g.setAttribute("color",new wi(y,4))}return wE.free_mesh_data(a),g.userData.type="SubdivGeometry",g}r.getAttribute("position").copyArray(l),r.getAttribute("normal").copyArray(d),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,wE.free_mesh_data(a)}},{key:"freeSubdivPointer",value:function(e){wE.free_bvh(e),wE.free_subdivision_surface(e)}},{key:"buildControlCageWireframe",value:function(e,t,n){var r=wE.get_wireframe_data_for_base_level(e),i=wE.HEAPU32.subarray(r>>2,4+(r>>2)),a=i.subarray(2,4),o=0,s=wE.HEAPU32[i[o]>>2],u=wE.HEAPF32.subarray(s>>2,(s>>2)+a[o]);o++;var c=wE.HEAPU32[i[o]>>2],l=wE.HEAPU32.subarray(c>>2,(c>>2)+a[o]);if(void 0===t){var h=new Di;h.setAttribute("position",new _i(u,3));for(var d=new Float32Array(u.length),f=0,p=u.length;f<p;)d[f++]=n.r,d[f++]=n.g,d[f++]=n.b;return h.setAttribute("color",new wi(d,3)),h.setIndex(new Oi(l,1)),wE.free_wireframe_data_for_base_level(r),h}t.getAttribute("position").copyArray(u),t.attributes.position.needsUpdate=!0,wE.free_wireframe_data_for_base_level(r)}},{key:"updateCollabMesh",value:function(e,t,n){var r=0===t;r||wE.set_destination_refinement_level(e,t);var i=n?wE.get_topological_data2(e,r?wE.Level.CONTROL:wE.Level.REFINED,n.elements):wE.get_topological_data(e,r?wE.Level.CONTROL:wE.Level.REFINED),a=wE.HEAPU32.subarray(i>>2,6+(i>>2)),o=a.subarray(3,6),s=0,u=wE.HEAPU32[a[s]>>2],c=new Float32Array(wE.HEAPF32.subarray(u>>2,(u>>2)+o[s]));s++;var l=wE.HEAPU32[a[s]>>2],h=new Uint32Array(wE.HEAPU32.subarray(l>>2,(l>>2)+o[s]));s++;var d=wE.HEAPU32[a[s]>>2],f=new Uint8Array(wE.HEAPU32.subarray(d>>2,(d>>2)+o[s]));return wE.free_topological_data(i),{positions:c,indices:h,verticesPerFace:f}}}]),n}(Di),AE=["getX","getY","getZ"];function jE(e,t){for(var n={},r=t?t.count:e.count,i=0,a=[],o=[],s=0;s<r;s++){for(var u=t?t.getX(s):s,c="",l=0;l<3;l++)c+="".concat(~~(1e4*e[AE[l]](u)),",");if(c in n)a.push(n[c]);else{for(var h=0;h<3;h++)o.push(e[AE[h]](u));n[c]=i,a.push(i),i++}}for(var d=[],f=0;f<a.length;f+=3)a[f]===a[f+1]||a[f]===a[f+2]||a[f+1]===a[f+2]||d.push(a[f],a[f+1],a[f+2]);return{positions:o,triIndices:d}}var TE=new tr,ME=new tr,CE=new tr,DE=new tr;function IE(e,t,n,r){var i=[],a=[];if(void 0!==n.userData.shape&&0===n.userData.parameters.depth&&0===n.userData.shape.shapeHoles.length){var o=n.userData.shape.extractShapePointsToFlatArray([]),s=n.userData.parameters.spikes;if("EllipseGeometry"===n.userData.type&&s<=24&&s%4===0&&n.userData.parameters.angle>=360){var u=o.length/2/s;o=o.filter((function(e,t){return Math.floor(t/2)%u===0}))}for(var c=0,l=0;l<o.length;l+=2)c+=(o[l]-o[(0===l?o.length:l)-2])*(o[l+1]+o[(0===l?o.length:l)-1]);e.length=0;var h=0;if(c<0)for(var d=0;d<o.length;d+=2)e.push(o[d],o[d+1],0),i.push(h++);else for(var f=o.length-2;f>=0;f-=2)e.push(o[f],o[f+1],0),i.push(h++);return a.push(h),{indices:i,verticesPerFace:a}}for(var p=function(n){if(t[n+1]===t[n+3]&&t[n+2]===t[n+5]||t[n+0]===t[n+3]&&t[n+2]===t[n+4]){TE.set(e[3*t[n]],e[3*t[n]+1],e[3*t[n]+2]),ME.set(e[3*t[n+1]],e[3*t[n+1]+1],e[3*t[n+1]+2]),CE.set(e[3*t[n+4]],e[3*t[n+4]+1],e[3*t[n+4]+2]),DE.set(e[3*t[n+5]],e[3*t[n+5]+1],e[3*t[n+5]+2]),ME.sub(TE).normalize(),CE.sub(TE).normalize(),DE.sub(TE).normalize();var o=ME.cross(CE).dot(DE);Math.abs(o)>.005||r&&r.some((function(e,t){return t%2!==1&&(n>=r[t]&&n<r[t+1])}))?(i.push(t[n],t[n+1],t[n+2]),a.push(3),n+=3):(i.push(t[n],t[n+1],t[n+4],t[n+5]),a.push(4),n+=6)}else i.push(t[n],t[n+1],t[n+2]),a.push(3),n+=3;v=n},v=0,m=null!==(g=n.capStartIndex)&&void 0!==g?g:t.length;v<m;){var g;p(v)}if(void 0!==n.capStartIndex){for(var y=[],b=[],w=0,x=new Float32Array([n.userData.parameters.depth])[0],O=0,k=0;O<e.length;O+=3,k++)0===e[O+2]&&(y.push(k),w++),e[O+2]===x&&b.push(k);if(0===n.userData.parameters.extrudeBevelSize){var _=b[0];b[0]=b[1],b[1]=_}y.reverse(),i.push.apply(i,y.concat(b)),a.push(w,w)}return{indices:i,verticesPerFace:a}}var PE={};!function(e,t){for(var n in t)R(e,n,{get:t[n],enumerable:!0})}(PE,{calcBoolean:function(){return WE},calcBooleanTopological:function(){return HE},freeMeshSet:function(){return XE},getMeshSet:function(){return qE},transformMeshSet:function(){return YE}});var RE,LE,NE,BE=new Promise((function(e){RE=e})),FE=!1;function UE(){return zE.apply(this,arguments)}function zE(){return zE=Object(m.a)(Object(S.a)().mark((function e(){var t,r,i,a,o,s;return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!FE){e.next=2;break}return e.abrupt("return");case 2:return"https://unpkg.com/@splinetool/boolean-wasm@0.9.210/build",e.next=5,Promise.all([n.e(3).then(n.bind(null,84)),fetch("".concat("https://unpkg.com/@splinetool/boolean-wasm@0.9.210/build","/boolean.wasm")).then((function(e){return e.arrayBuffer()}))]);case 5:return t=e.sent,r=Object(g.a)(t,2),i=r[0],a=r[1],o=i.default,e.next=12,o({wasmBinary:a});case 12:s=e.sent,RE(s),FE=!0;case 14:case"end":return e.stop()}}),e)}))),zE.apply(this,arguments)}function VE(e){var t=e.length,n=t*Uint32Array.BYTES_PER_ELEMENT,r=t*Float32Array.BYTES_PER_ELEMENT,i=Number.isInteger(e[0])?n:r,a=LE._malloc(i);return(Number.isInteger(e[0])?new Uint32Array(LE.HEAPU32.buffer,a,t):new Float32Array(LE.HEAPF32.buffer,a,t)).set(e,0),a}function GE(e){switch(e){case 0:return LE.OP.UNION;case 1:return LE.OP.INTERSECTION;case 2:return LE.OP.A_MINUS_B;case 3:return LE.OP.B_MINUS_A;case 4:return LE.OP.SYMMETRIC_DIFFERENCE;case 5:return LE.OP.ALL;default:throw new Error("Unknown boolean operation "+e)}}function HE(e,t){void 0===NE&&(NE=LE.init_csg());var n=VE(e),r=LE.csg_calc_topological(NE,n,e.length,GE(t));LE._free(n);var i=LE.HEAPU32.subarray(r>>2,6+(r>>2)),a=i.subarray(3,6),o=0,s=LE.HEAPU32[i[o]>>2],u=new Float32Array(LE.HEAPF32.subarray(s>>2,(s>>2)+a[o]));o++;var c=LE.HEAPU32[i[o]>>2],l=new Uint32Array(LE.HEAPU32.subarray(c>>2,(c>>2)+a[o]));o++;var h=LE.HEAPU32[i[o]>>2],d=new Uint8Array(LE.HEAPU32.subarray(h>>2,(h>>2)+a[o]));return LE.free_mesh_data(r),{positions:u,indices:l,verticesPerFace:d}}function WE(e,t,n,r){void 0===NE&&(NE=LE.init_csg());var i=VE(e),a=LE.csg_calc(NE,i,e.length,r,GE(t));LE._free(i);var o=LE.HEAPU32.subarray(a>>2,5+(a>>2)),s=o.subarray(2,5),u=0,c=LE.HEAPU32[o[u]>>2],l=LE.HEAPF32.subarray(c>>2,(c>>2)+s[u]);u++;var h=LE.HEAPU32[o[u]>>2],d=LE.HEAPF32.subarray(h>>2,(h>>2)+s[u]),f=s[++u];n.setAttribute("position",new _i(l,3)),n.setAttribute("normal",new _i(d,3));var p=LE.HEAPF32.subarray(5+(a>>2),5+(a>>2)+6);return null===n.boundingSphere&&(n.boundingSphere=new kr),n.boundingSphere.center.set(p[0],p[1],p[2]),n.boundingSphere.radius=Math.pow(Math.pow(p[3],2)+Math.pow(p[4],2)+Math.pow(p[5],2),.5),n.userData.parameters={width:2*p[3],height:2*p[4],depth:2*p[5]},LE.free_mesh_data(a),f}function qE(e,t,n){if(void 0===LE)return-1;var r,i,a;if(t&&void 0!==e.userData.positions){var o=e.userData;a=o.verticesPerFace.length,r=o.positions,i=Array(o.verticesPerFace.reduce((function(e,t){return e+t}),0)+a);for(var s=0,u=0,c=0;s<o.verticesPerFace.length;s++){i[c++]=o.verticesPerFace[s];for(var l=0;l<o.verticesPerFace[s];l++)i[c++]=o.indices[u++]}}else{var h=function(e,t,n){var r,i,a=jE(e.getAttribute("position"),e.getIndex()),o=a.positions,s=a.triIndices;if(t&&n){var u=IE(o,s,e),c=u.indices,l=u.verticesPerFace;i=l.length,r=[];for(var h=0,d=0;h<i;h++){r.push(l[h]);for(var f=0;f<l[h];f++)r.push(c[d++])}}else{var p=s.length;r=Array(p+p/3),i=0;for(var v=0,m=0;m<r.length;)r[m++]=3,i++,r[m++]=s[v++],r[m++]=s[v++],r[m++]=s[v++]}return{positions:o,faceIndices:r,nFaces:i}}(e,t,n);r=h.positions,i=h.faceIndices,a=h.nFaces}var d=r.length,f=i.length,p=r.length,v=i.length,m=p*Float32Array.BYTES_PER_ELEMENT+v*Uint32Array.BYTES_PER_ELEMENT,g=p*Float32Array.BYTES_PER_ELEMENT,y=(Uint32Array.BYTES_PER_ELEMENT,LE._malloc(m)),b=new Float32Array(LE.HEAPF32.buffer,y,p),w=new Uint32Array(LE.HEAPU32.buffer,y+g,v);return b.set(r,0),w.set(i,0),LE.get_csg_mesh(y,d,y+g,f,a)}function YE(e,t){LE.transform_csg_mesh(e,t.elements)}function XE(e){LE.free_csg_mesh(e)}BE.then((function(e){return LE=e}));var KE={ConeGeometry:i_,CubeGeometry:a_,CylinderGeometry:e_,DodecahedronGeometry:c_,EllipseGeometry:xS,HelixGeometry:jS,IcosahedronGeometry:MS,LatheGeometry:DS,NonParametricGeometry:XS,PolygonGeometry:KS,PyramidGeometry:QS,RectangleGeometry:tE,SphereGeometry:nE,PlaneGeometry:rE,BackdropGeometry:iE,StarGeometry:oE,TextFrameGeometry:sE,TorusGeometry:uE,TorusKnotGeometry:cE,TriangleGeometry:lE,VectorGeometry:bS},QE=function(e){return KE[e.type].create(e)};function ZE(e){return null!==e&&"booleanOp"in e}var JE=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.apply(this,arguments)).booleanMeshSetAddress=-1,e.booleanWasTransformed=!1,e.booleanMatrixInvOld=new Dr,e}return Object(A.a)(n,[{key:"updateVisible",value:function(){Object(b.a)(Object(w.a)(n.prototype),"updateVisible",this).call(this),this.visible=!ZE(this.parent)&&this.visible,ZE(this.parent)&&this.parent.invalidateDownstreamBooleanData()}},{key:"freeBooleanPointer",value:function(){-1!==this.booleanMeshSetAddress&&(PE.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}},{key:"invalidateDownstreamBooleanData",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.booleanWasTransformed=!0:this.freeBooleanPointer(),ZE(this.parent)?this.parent.invalidateDownstreamBooleanData():this}},{key:"invalidateUpstreamBooleanData",value:function(){this.freeBooleanPointer();var e,t=Object(j.a)(this.children);try{for(t.s();!(e=t.n()).done;){var r=e.value;r instanceof n&&(r.freeBooleanPointer(),ZE(r)&&r.invalidateUpstreamBooleanData())}}catch(i){t.e(i)}finally{t.f()}}},{key:"updateTransformState",value:function(e){var t=Object(b.a)(Object(w.a)(n.prototype),"updateTransformState",this).call(this,e);return t&&ZE(this.parent)&&this.invalidateDownstreamBooleanData(!0),t}}]),n}($k(Qi)),$E=new ir;function eA(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.count,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,a=1/0,o=1/0,s=1/0,u=-1/0,c=-1/0,l=-1/0,h=t;h<n;h++){var d=e.getX(h),f=e.getY(h),p=e.getZ(h);d<a&&(a=d),f<o&&(o=f),p<s&&(s=p),d>u&&(u=d),f>c&&(c=f),p>l&&(l=p)}$E.min.set(a,o,s),$E.max.set(u,c,l),$E.getCenter(r),$E.getSize(i).multiplyScalar(.5)}var tA=new Di,nA=new gi,rA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;return Object(E.a)(this,n),(i=t.call(this,tA,nA)).super_Entity(e,r),i}return Object(A.a)(n,[{key:"updateState",value:function(e,t){this.updateState_Entity(e,t)}},{key:"updateEntityBoxSize",value:function(e,t){var r=this.geometry.getAttribute("position");void 0!==r?eA(r,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:r.count,e,t):Object(b.a)(Object(w.a)(n.prototype),"updateEntityBoxSize",this).call(this,e,t)}}]),n}(JE),iA=function(){function e(t){var n;Object(E.a)(this,e),t=null!==(n=t)&&void 0!==n?n:{},this.name=t.name,this.type=t.type,this.node=t.node,this.size=t.size,this.needsUpdate=t.needsUpdate}return Object(A.a)(e,[{key:"value",get:function(){return this.node.value},set:function(e){this.node.value=e}}]),e}(),aA=function(){function e(t){Object(E.a)(this,e),this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},this.uuid=En.generateUUID(),this.type=t,this.name=""}return Object(A.a)(e,[{key:"analyze",value:function(e,t){var n;t=null!==(n=t)&&void 0!==n?n:{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}},{key:"analyzeAndFlow",value:function(e,t,n){var r;return n=null!==(r=n)&&void 0!==r?r:{},this.analyze(e,n),this.flow(e,t,n)}},{key:"flow",value:function(e,t,n){var r;n=null!==(r=n)&&void 0!==r?r:{},e.addFlow(n.slot,n.cache,n.context);var i={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),i}},{key:"build",value:function(e,t,n){var r;t=null!==(r=t)&&void 0!==r?r:this.getType(e,t);var i=e.getNodeData(null!==n&&void 0!==n?n:this);return e.analyzing&&this.appendDepsNode(e,i,t),-1===e.nodes.indexOf(this)&&e.nodes.push(this),void 0!==this.updateFrame&&-1===e.updaters.indexOf(this)&&e.updaters.push(this),this.generate(e,t,n)}},{key:"updateFrame",value:function(e){}},{key:"generateReadonly",value:function(e,t,n,r,i,a){return""}},{key:"generate",value:function(e,t,n,r,i){return""}},{key:"parse",value:function(e,t,n,r){}},{key:"appendDepsNode",value:function(e,t,n){t.deps=(t.deps||0)+1;var r=e.getTypeLength(n);(r>(t.outputMax||0)||this.getType(e,n))&&(t.outputMax=r,t.output=n)}},{key:"setName",value:function(e){this.name=e}},{key:"getName",value:function(){return this.name}},{key:"getType",value:function(e,t){return"sampler2D"===t||"samplerCube"===t?t:this.type}},{key:"getHash",value:function(){var t,n,r="{";for(t in this)(n=this[t])instanceof e&&(r+='"'+t+'":'+n.getHash()+",");if(this.hashProperties)for(var i=0;i<this.hashProperties.length;i++)n=this[t=this.hashProperties[i]],r+='"'+t+'":"'+String(n)+'",';return r+='"id":"'+this.uuid+'"}'}}]),e}(),oA=function(){function e(){Object(E.a)(this,e),this.nodes={},this.keywords={}}return Object(A.a)(e,[{key:"add",value:function(e){this.nodes[e.name]=e}},{key:"addKeyword",value:function(e,t,n){n=void 0===n||n,this.keywords[e]={callback:t,cache:n}}},{key:"remove",value:function(e){delete this.nodes[e.name]}},{key:"removeKeyword",value:function(e){delete this.keywords[e]}},{key:"get",value:function(e){return this.nodes[e]}},{key:"getKeyword",value:function(e,t){return this.keywords[e].callback(t)}},{key:"getKeywordData",value:function(e){return this.keywords[e]}},{key:"contains",value:function(e){return void 0!==this.nodes[e]}},{key:"containsKeyword",value:function(e){return void 0!==this.keywords[e]}}]),e}(),sA=new oA,uA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i,a;return Object(E.a)(this,n),(a=t.call(this,e)).scope="",r=null!==(i=r)&&void 0!==i?i:{},a.shared=void 0===r.shared||r.shared,a.unique=void 0!==r.unique&&r.unique,a}return Object(A.a)(n,[{key:"build",value:function(e,t,r,i){var a;if(t=null!==(a=t)&&void 0!==a?a:this.getType(e),this.getShared(e,t)){var o,s=this.getUnique(e,t);s&&void 0===this.uuid&&(this.uuid=En.generateUUID()),r=e.getUUID(null!==(o=r)&&void 0!==o?o:this.getUUID(),!s);var u=e.getNodeData(r),c=u.output||this.getType(e);if(e.analyzing)return(u.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,u,t),this.generate(e,t,r)):Object(b.a)(Object(w.a)(n.prototype),"build",this).call(this,e,t,r);if(s)return u.name=u.name||Object(b.a)(Object(w.a)(n.prototype),"build",this).call(this,e,t,r),u.name;if(!this.getLabel()&&(!this.getShared(e,c)||e.context.ignoreCache||1===u.deps))return Object(b.a)(Object(w.a)(n.prototype),"build",this).call(this,e,t,r);r=this.getUUID(!1);var l=this.getTemp(e,r);if(l)return e.format(l,c,t);l=Object(b.a)(Object(w.a)(n.prototype),"generate",this).call(this,e,t,r,u.output,i);var h=this.generate(e,c,r);return e.addNodeCode(l+" = "+h+";"),e.format(l,c,t)}return Object(b.a)(Object(w.a)(n.prototype),"build",this).call(this,e,t,r)}},{key:"getShared",value:function(e,t){return"sampler2D"!==t&&"samplerCube"!==t&&this.shared}},{key:"getUnique",value:function(e,t){return this.unique}},{key:"setLabel",value:function(e){return this.label=e,this}},{key:"getLabel",value:function(){return this.label}},{key:"getUUID",value:function(e){var t=this.uuid;return"string"==typeof this.scope&&(t=this.scope+"-"+t),t}},{key:"getTemp",value:function(e,t){t=t||this.uuid;var n=e.getVars()[t];return n?n.name:void 0}},{key:"generate",value:function(e,t,n,r,i){var a;return this.getShared(e,t)||console.error("TempNode is not shared"),n=null!==(a=n)&&void 0!==a?a:this.uuid,e.getTempVar(n,null!==r&&void 0!==r?r:this.getType(e),i,this.getLabel()).name}}]),n}(aA),cA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i,a;return Object(E.a)(this,n),(r=null!==(i=r)&&void 0!==i?i:{}).shared=void 0!==r.shared&&r.shared,(a=t.call(this,e,r)).readonly=!1,a}return Object(A.a)(n,[{key:"setReadonly",value:function(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}},{key:"getReadonly",value:function(){return this.readonly}},{key:"generate",value:function(e,t,n,r,i,a){var o,s;n=e.getUUID(null!==(o=n)&&void 0!==o?o:this.getUUID()),r=null!==(s=r)&&void 0!==s?s:this.getType(e);var u=e.getNodeData(n);return this.getReadonly()&&void 0!==this.generateReadonly?this.generateReadonly(e,t,n,r,i,a):e.isShader("vertex")?(u.vertex||(u.vertex=e.createVertexUniform(r,this,i,a,this.getLabel())),e.format(u.vertex.name,r,t)):(u.fragment||(u.fragment=e.createFragmentUniform(r,this,i,a,this.getLabel())),e.format(u.fragment.name,r,t))}}]),n}(uA),lA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;return Object(E.a)(this,n),(e=t.call(this,"v2")).nodeType="Vector2",e.value=r instanceof An?r:new An(r,i),e}return Object(A.a)(n,[{key:"x",get:function(){return this.value.x},set:function(e){this.value.x=e}},{key:"y",get:function(){return this.value.y},set:function(e){this.value.y=e}},{key:"generateReadonly",value:function(e,t,n,r,i,a){return e.format("vec2("+this.value.x+", "+this.value.y+")",r,t)}}]),n}(cA),hA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;return Object(E.a)(this,n),(e=t.call(this,"v3")).nodeType="Vector3",e.value=r instanceof tr?r:new tr(r,i,a),e}return Object(A.a)(n,[{key:"x",get:function(){return this.value.x},set:function(e){this.value.x=e}},{key:"y",get:function(){return this.value.y},set:function(e){this.value.y=e}},{key:"z",get:function(){return this.value.z},set:function(e){this.value.z=e}},{key:"generateReadonly",value:function(e,t,n,r,i,a){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",r,t)}}]),n}(cA),dA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a){var o;return Object(E.a)(this,n),(o=t.call(this,e,r,i)).isColorA=!0,o.a=a,o}return Object(A.a)(n,[{key:"setRGBA",value:function(e,t,r,i){Object(b.a)(Object(w.a)(n.prototype),"setRGB",this).call(this,e,t,r),this.a=i}},{key:"copy",value:function(e){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e),this.a="a"in e?e.a:1,this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b,this.a)}},{key:"x",get:function(){return this.r},set:function(e){this.r=e}},{key:"y",get:function(){return this.g},set:function(e){this.g=e}},{key:"z",get:function(){return this.b},set:function(e){this.b=e}},{key:"w",get:function(){return this.a},set:function(e){this.a=e}}]),n}(Gn),fA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,"v4")).nodeType="Vector4",r.value=e instanceof dA?e:new dA(e.r,e.g,e.b,e.a),r}return Object(A.a)(n,[{key:"generateReadonly",value:function(e,t,n,r,i,a){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,t)}}]),n}(cA),pA=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,vA=/[a-z_0-9]+/gi,mA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o){var s;return Object(E.a)(this,n),(s=t.call(this,o)).src="",s.nodeType="Function",s.useKeywords=!0,s.includes=[],s.extensions={},s.keywords={},s.isMethod=void 0===o,s.isInterface=!1,s.parse(e,r,i,a),s}return Object(A.a)(n,[{key:"getShared",value:function(e,t){return!this.isMethod}},{key:"getType",value:function(e){return e.getTypeByFormat(this.type)}},{key:"getInputByName",value:function(e){if(this.inputs)for(var t=this.inputs.length;t--;)if(this.inputs[t].name===e)return this.inputs[t]}},{key:"getIncludeByName",value:function(e){if(this.includes)for(var t=this.includes.length;t--;)if(this.includes[t].name===e)return this.includes[t]}},{key:"generate",value:function(e,t,n,r,i){var a,o=0,s=this.src;if(this.includes)for(var u=0;u<this.includes.length;u++)e.include(this.includes[u],this);for(var c in this.extensions)e.extensions[c]=!0;for(var l=[];a=vA.exec(this.src);)l.push(a);for(var h=0;h<l.length;h++){var d=l[h],f=d[0],p=!this.isMethod||!this.getInputByName(f),v=f;if(this.keywords[f]||this.useKeywords&&p&&sA.containsKeyword(f)){var m=this.keywords[f];if(!m){var g=sA.getKeywordData(f);g.cache&&(m=e.keywords[f]),m=m||sA.getKeyword(f,e),g.cache&&(e.keywords[f]=m)}v=m.build(e)}f!==v&&"."!==s[d.index+o-1]&&(s=s.substring(0,d.index+o)+v+s.substring(d.index+f.length+o),o+=v.length-f.length),void 0===this.getIncludeByName(v)&&sA.contains(v)&&e.include(sA.get(v))}return"source"===t?s:this.isMethod?(this.isInterface||e.include(this,void 0,s),this.name):e.format("( "+s+" )",this.getType(e),t)}},{key:"parse",value:function(e,t,n,r){if(this.src=e||"",this.includes=null!==t&&void 0!==t?t:[],this.extensions=null!==n&&void 0!==n?n:{},this.keywords=null!==r&&void 0!==r?r:{},this.isMethod){var i=pA.exec(this.src);if(this.inputs=[],i&&4==i.length){this.type=i[1],this.name=i[2];var a=i[3].match(vA);if(a)for(var o=0;o<a.length;){var s=a[o++],u=void 0;"in"===s||"out"===s||"inout"===s?u=a[o++]:(u=s,s="");var c=a[o++];this.inputs.push({name:c,type:u,qualifier:s})}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}}}]),n}(uA),gA=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,yA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0;return Object(E.a)(this,n),(e=t.call(this)).src="",e.useDefine=!1,e.nodeType="Const",e.parse(r||n.PI,void 0,void 0,void 0,i),e}return Object(A.a)(n,[{key:"getType",value:function(e){return e.getTypeByFormat(this.type)}},{key:"parse",value:function(e,t,n,r,i){this.src=e||"";var a,o,s="",u=gA.exec(e);this.useDefine=null!==i&&void 0!==i?i:"#"===this.src.charAt(0),u&&u.length>1?(o=u[1],a=u[2],s=u[3]):(a=this.src,o="f"),this.name=a,this.type=o,this.value=s}},{key:"build",value:function(e,t){if("source"===t){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}},{key:"generate",value:function(e,t,n,r,i){return e.format(this.name,this.getType(e),t)}}]),n}(uA),bA=yA;bA.PI="PI",bA.PI2="PI2",bA.RECIPROCAL_PI="RECIPROCAL_PI",bA.RECIPROCAL_PI2="RECIPROCAL_PI2",bA.LOG2="LOG2",bA.EPSILON="EPSILON";var wA=new RegExp("^structs*([a-z_0-9]+)s*{s*((.|\n)*?)}","gim"),xA=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),OA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object(E.a)(this,n),(e=t.call(this)).inputs=[],e.src="",e.nodeType="Struct",e.parse(r),e}return Object(A.a)(n,[{key:"getType",value:function(e){return e.getTypeByFormat(this.name)}},{key:"getInputByName",value:function(e){for(var t=this.inputs.length;t--;)if(this.inputs[t].name===e)return this.inputs[t]}},{key:"generate",value:function(e,t,n,r,i){return"source"===t?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}},{key:"parse",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.src=e,this.inputs=[];var t=wA.exec(e);if(t){for(var n,r=t[2];n=xA.exec(r);)this.inputs.push({type:n[1],name:n[2]});this.name=t[1]}else this.name="";this.type=this.name}}]),n}(uA),kA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,"v2",{shared:!1})).nodeType="UV",r.index=null!==e&&void 0!==e?e:0,r}return Object(A.a)(n,[{key:"generate",value:function(e,t){e.requires.uv[this.index]=!0;var n=this.index>0?this.index+1:"",r=e.isShader("vertex")?"uv"+n:"vUv"+n;return e.format(r,this.getType(e),t)}}]),n}(uA);sA.addKeyword("uv",(function(){return new kA})),sA.addKeyword("uv2",(function(){return new kA(1)}));var _A=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;return Object(E.a)(this,n),(i=t.call(this,"v4")).nodeType="ColorSpace",i.input=e,i.method=null!==r&&void 0!==r?r:n.LINEAR_TO_LINEAR,i.hashProperties=["method"],i}return Object(A.a)(n,[{key:"generate",value:function(e,t){var r,i=this.input.build(e,"v4"),a=this.getType(e),o=n.Nodes[this.method],s=e.include(o);if(s===n.LINEAR_TO_LINEAR)return e.format(i,a,t);if(2===(null===(r=o.inputs)||void 0===r?void 0:r.length)){var u=this.factor.build(e,"f");return e.format(s+"( "+i+", "+u+" )",a,t)}return e.format(s+"( "+i+" )",a,t)}},{key:"fromEncoding",value:function(e){var t=n.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}},{key:"fromDecoding",value:function(e){var t=n.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}}],[{key:"getEncodingComponents",value:function(e){switch(e){case tn:return["Linear"];case nn:return["sRGB"];default:return[]}}}]),n}(uA),SA=_A;SA.Nodes={LinearToLinear:new mA(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),sRGBToLinear:new mA(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),LinearTosRGB:new mA(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n"))},SA.LINEAR_TO_LINEAR="LinearToLinear",SA.SRGB_TO_LINEAR="sRGBToLinear",SA.LINEAR_TO_SRGB="LinearTosRGB";var EA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;return Object(E.a)(this,n),(e=t.call(this,r,s,o,a,i)).nodeType="Expression",e}return Object(A.a)(n)}(mA),AA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Kn,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;return Object(E.a)(this,n),(e=t.call(this,"v4",{shared:!0})).nodeType="Texture",e.value=r,e.uv=null!==i&&void 0!==i?i:new kA,e.bias=a,e.project=void 0!==o&&o,e}return Object(A.a)(n,[{key:"getTexture",value:function(e,t){return Object(b.a)(Object(w.a)(n.prototype),"generate",this).call(this,e,t,this.value.uuid,"t")}},{key:"generate",value:function(e,t){var n;if("sampler2D"===t)return this.getTexture(e,t);var r,i,a=this.getTexture(e,t),o=this.uv.build(e,this.project?"v4":"v2"),s=this.bias?this.bias.build(e,"f"):void 0;void 0===s&&e.context.bias&&(s=e.context.bias.setTexture(this).build(e,"f")),r=this.project?"texture2DProj":s?"tex2DBias":"tex2D",i=s?r+"( "+a+", "+o+", "+s+" )":r+"( "+a+", "+o+" )";var u={include:e.isShader("vertex"),ignoreCache:!0},c=this.getType(e);return e.addContext(u),this.colorSpace=null!==(n=this.colorSpace)&&void 0!==n?n:new SA(new EA("",c)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(i),i=this.colorSpace.build(e,c),e.removeContext(),e.format(i,c,t)}}]),n}(cA),jA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,"f")).nodeType="Float",r.value=null!==e&&void 0!==e?e:0,r}return Object(A.a)(n,[{key:"generateReadonly",value:function(e,t,n,r,i,a){return e.format(this.value+(this.value%1?"":".0"),r,t)}}]),n}(cA),TA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;return Object(E.a)(this,n),(i=t.call(this)).inputs=[],i.nodeType="FunctionCall",i.value=e,i.inputs=null!==r&&void 0!==r?r:[],i}return Object(A.a)(n,[{key:"getFunction",value:function(){return this.value}},{key:"getType",value:function(e){return this.value.getType(e)}},{key:"generate",value:function(e,t,n,r,i){r=this.getType(e);var a=this.value,o=a.build(e,t)+"( ",s=[];if(a.inputs){for(var u=0;u<a.inputs.length;u++){var c=a.inputs[u],l=this.inputs[u]||this.inputs[c.name];s.push(l.build(e,e.getTypeByFormat(c.type)))}o+=s.join(", ")+" )"}return e.format(o,r,t)}}]),n}(uA),MA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.ADD;return Object(E.a)(this,n),(i=t.call(this)).nodeType="Operator",i.type=e.type,i.a=e,i.b=r,i.op=a,i}return Object(A.a)(n,[{key:"getType",value:function(e){var t=this.a.getType(e),n=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(n)>e.getTypeLength(t)?n:t}},{key:"generate",value:function(e,t){var n=this.getType(e);this.type=n;var r=this.a.build(e,n),i=this.b.build(e,n);return e.format("( "+r+" "+this.op+" "+i+" )",n,t)}}]),n}(uA),CA=MA;CA.ADD="+",CA.SUB="-",CA.MUL="*",CA.DIV="/";var DA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.ABS,a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;return Object(E.a)(this,n),(r=t.call(this)).nodeType="Math",r.a=e,"string"!=typeof i?r.b=i:o=i,"string"!=typeof a?r.c=a:o=a,r.method=o,r.hashProperties=["method"],r}return Object(A.a)(n,[{key:"getNumInputs",value:function(e){switch(this.method){case n.MIX:case n.CLAMP:case n.REFRACT:case n.SMOOTHSTEP:case n.FACEFORWARD:return 3;case n.MIN:case n.MAX:case n.MOD:case n.STEP:case n.REFLECT:case n.DISTANCE:case n.DOT:case n.CROSS:case n.POW:return 2;default:return 1}}},{key:"getInputType",value:function(e){var t=e.getTypeLength(this.a.getType(e)),n=this.b?e.getTypeLength(this.b.getType(e)):0,r=this.c?e.getTypeLength(this.c.getType(e)):0;return t>n&&t>r?this.a.getType(e):n>r?this.b.getType(e):this.c.getType(e)}},{key:"getType",value:function(e){switch(this.method){case n.LENGTH:case n.DISTANCE:case n.DOT:return"f";case n.CROSS:return"v3"}return this.getInputType(e)}},{key:"generate",value:function(e,t){var r,i,a,o=this.a?e.getTypeLength(this.a.getType(e)):0,s=this.b?e.getTypeLength(this.b.getType(e)):0,u=this.c?e.getTypeLength(this.c.getType(e)):0,c=this.getInputType(e),l=this.getType(e);switch(this.type=l,this.method){case n.NEGATE:return e.format("( -"+this.a.build(e,c)+" )",c,t);case n.INVERT:return e.format("( 1.0 - "+this.a.build(e,c)+" )",c,t);case n.CROSS:r=this.a.build(e,"v3"),i=this.b.build(e,"v3");break;case n.STEP:r=this.a.build(e,1===o?"f":c),i=this.b.build(e,c);break;case n.MIN:case n.MAX:case n.MOD:r=this.a.build(e,c),i=this.b.build(e,1===s?"f":c);break;case n.REFRACT:r=this.a.build(e,c),i=this.b.build(e,c),a=this.c.build(e,"f");break;case n.MIX:r=this.a.build(e,c),i=this.b.build(e,c),a=this.c.build(e,1===u?"f":c);break;default:r=this.a.build(e,c),this.b&&(i=this.b.build(e,c)),this.c&&(a=this.c.build(e,c))}var h=[];h.push(r),i&&h.push(i),a&&h.push(a);var d=this.getNumInputs(e);if(h.length!==d)throw Error('Arguments not match used in "'.concat(this.method,'". Require ').concat(d,", currently ").concat(h.length,"."));return e.format(this.method+"( "+h.join(", ")+" )",l,t)}}]),n}(uA),IA=DA;IA.RAD="radians",IA.DEG="degrees",IA.EXP="exp",IA.EXP2="exp2",IA.LOG="log",IA.LOG2="log2",IA.SQRT="sqrt",IA.INV_SQRT="inversesqrt",IA.FLOOR="floor",IA.CEIL="ceil",IA.NORMALIZE="normalize",IA.FRACT="fract",IA.SATURATE="saturate",IA.SIN="sin",IA.COS="cos",IA.TAN="tan",IA.ASIN="asin",IA.ACOS="acos",IA.ARCTAN="atan",IA.ABS="abs",IA.SIGN="sign",IA.LENGTH="length",IA.NEGATE="negate",IA.INVERT="invert",IA.MIN="min",IA.MAX="max",IA.MOD="mod",IA.STEP="step",IA.REFLECT="reflect",IA.DISTANCE="distance",IA.DOT="dot",IA.CROSS="cross",IA.POW="pow",IA.MIX="mix",IA.CLAMP="clamp",IA.REFRACT="refract",IA.SMOOTHSTEP="smoothstep",IA.FACEFORWARD="faceforward";var PA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;return Object(E.a)(this,n),(a=t.call(this,"v4")).nodeType="TextureCubeUV",a.value=e,a.uv=r,a.bias=i,a}return Object(A.a)(n,[{key:"bilinearCubeUV",value:function(e,t,r,i){var a,o,s,u,c=new TA(n.Nodes.bilinearCubeUV,[t,r,i]);this.colorSpaceTL=null!==(a=this.colorSpaceTL)&&void 0!==a?a:new SA(new EA("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(c.build(e)+".tl"),this.colorSpaceTR=null!==(o=this.colorSpaceTR)&&void 0!==o?o:new SA(new EA("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(c.build(e)+".tr"),this.colorSpaceBL=null!==(s=this.colorSpaceBL)&&void 0!==s?s:new SA(new EA("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(c.build(e)+".bl"),this.colorSpaceBR=null!==(u=this.colorSpaceBR)&&void 0!==u?u:new SA(new EA("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(c.build(e)+".br");var l={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(l),this.colorSpaceTLExp=new EA(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new EA(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new EA(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new EA(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();var h=new EA("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return h.keywords.cubeUV_TL=this.colorSpaceTLExp,h.keywords.cubeUV_TR=this.colorSpaceTRExp,h.keywords.cubeUV_BL=this.colorSpaceBLExp,h.keywords.cubeUV_BR=this.colorSpaceBRExp,h.keywords.cubeUV=c,h}},{key:"generate",value:function(e,t){if(e.isShader("fragment")){var r=this.uv,i=this.bias||e.context.roughness,a=new TA(n.Nodes.roughnessToMip,[i]),o=new IA(a,n.Nodes.m0,n.Nodes.cubeUV_maxMipLevel,IA.CLAMP),s=new IA(o,IA.FLOOR),u=new IA(o,IA.FRACT),c=this.bilinearCubeUV(e,this.value,r,s),l=this.bilinearCubeUV(e,this.value,r,new CA(s,new jA(1).setReadonly(!0),CA.ADD)),h=new IA(c,l,u,IA.MIX);return e.format(h.build(e),"v4",t)}return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}}]),n}(uA),RA=PA;RA.Nodes=function(){var e=new OA("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),t=new bA("float cubeUV_maxMipLevel 8.0",!0),n=new bA("float cubeUV_minMipLevel 4.0",!0),r=new bA("float cubeUV_maxTileSize 256.0",!0),i=new bA("float cubeUV_minTileSize 16.0",!0),a=new mA("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");a.useKeywords=!1;var o=new mA("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");o.useKeywords=!1;var s=new mA("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[e,a,o,t,n,r,i]);s.useKeywords=!1;var u=new bA("float r0 1.0",!0),c=new bA("float v0 0.339",!0),l=new bA("float m0 -2.0",!0),h=new bA("float r1 0.8",!0),d=new bA("float v1 0.276",!0),f=new bA("float m1 -1.0",!0),p=new bA("float r4 0.4",!0),v=new bA("float v4 0.046",!0),m=new bA("float m4 2.0",!0),g=new bA("float r5 0.305",!0),y=new bA("float v5 0.016",!0),b=new bA("float m5 3.0",!0),w=new bA("float r6 0.21",!0),x=new bA("float v6 0.0038",!0),O=new bA("float m6 4.0",!0);return{bilinearCubeUV:s,roughnessToMip:new mA("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",[u,c,l,h,d,f,p,v,m,g,y,b,w,x,O]),m0:l,cubeUV_maxMipLevel:t}}();var LA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,"v3")).nodeType="Normal",r.scope=null!==e&&void 0!==e?e:n.VIEW,r}return Object(A.a)(n,[{key:"getShared",value:function(){return this.scope===n.WORLD}},{key:"build",value:function(e,t,r,i){var a=e.context[this.scope+"Normal"];return a?a.build(e,t,r,i):Object(b.a)(Object(w.a)(n.prototype),"build",this).call(this,e,t,r)}},{key:"generate",value:function(e,t,r,i,a){var o;switch(this.scope){case n.VIEW:o=e.isShader("vertex")?"transformedNormal":"geometryNormal";break;case n.LOCAL:e.isShader("vertex")?o="objectNormal":(e.requires.normal=!0,o="vObjectNormal");break;case n.WORLD:e.isShader("vertex")?o="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,o="vWNormal")}return e.format(o,this.getType(e),t)}}]),n}(uA),NA=LA;NA.LOCAL="local",NA.WORLD="world",NA.VIEW="view",NA.NORMAL="normal",sA.addKeyword("viewNormal",(function(){return new NA(NA.VIEW)})),sA.addKeyword("localNormal",(function(){return new NA(NA.NORMAL)})),sA.addKeyword("worldNormal",(function(){return new NA(NA.WORLD)}));var BA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,"v3")).nodeType="Position",r.scope=null!==e&&void 0!==e?e:n.LOCAL,r}return Object(A.a)(n,[{key:"getType",value:function(){return this.scope===n.PROJECTION?"v4":this.type}},{key:"getShader",value:function(){switch(this.scope){case n.LOCAL:case n.WORLD:return!1}return!0}},{key:"generate",value:function(e,t,r,i,a){var o;switch(this.scope){case n.LOCAL:e.isShader("vertex")?o="transformed":(e.requires.position=!0,o="vPosition");break;case n.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,o="vWPosition";break;case n.VIEW:o=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case n.PROJECTION:o=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return e.format(o,this.getType(),t)}}]),n}(uA),FA=BA;FA.LOCAL="local",FA.WORLD="world",FA.VIEW="view",FA.PROJECTION="projection",sA.addKeyword("position",(function(){return new FA})),sA.addKeyword("worldPosition",(function(){return new FA(FA.WORLD)})),sA.addKeyword("viewPosition",(function(){return new FA(FA.VIEW)}));var UA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,"v3")).nodeType="Reflect",r.scope=null!==e&&void 0!==e?e:n.CUBE,r}return Object(A.a)(n,[{key:"getUnique",value:function(e){return!e.context.viewNormal}},{key:"getType",value:function(){return this.scope===n.SPHERE?"v2":this.type}},{key:"generate",value:function(e,t){var r=this.getUnique(e);if(e.isShader("fragment")){var i;switch(this.scope){case n.VECTOR:var a=new NA(NA.VIEW),o=e.context.roughness,s=a.build(e,"v3"),u=new FA(FA.VIEW).build(e,"v3"),c=o?o.build(e,"f"):void 0,l="reflect( -normalize( ".concat(u," ), ").concat(s," )");c&&(l="normalize( mix( ".concat(l,", ").concat(s,", ").concat(c," * ").concat(c," ) )"));var h="inverseTransformDirection( ".concat(l,", viewMatrix )");r?(e.addNodeCode("vec3 reflectVec = ".concat(h,";")),i="reflectVec"):i=h;break;case n.CUBE:var d=new n(n.VECTOR).build(e,"v3"),f="vec3( -"+d+".x, "+d+".yz )";r?(e.addNodeCode("vec3 reflectCubeVec = ".concat(f,";")),i="reflectCubeVec"):i=f;break;case n.SPHERE:var p="normalize( ( viewMatrix * vec4( "+new n(n.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";r?(e.addNodeCode("vec2 reflectSphereVec = ".concat(p,";")),i="reflectSphereVec"):i=p}return e.format(i,this.getType(),t)}return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}}]),n}(uA),zA=UA;zA.CUBE="cube",zA.SPHERE="sphere",zA.VECTOR="vector";for(var VA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new AA,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;return Object(E.a)(this,n),(e=t.call(this,"v4")).nodeType="TextureCube",e.value=r,e.radianceNode=new RA(e.value,null!==i&&void 0!==i?i:new zA(zA.VECTOR),a),e.irradianceNode=new RA(e.value,new NA(NA.WORLD),new jA(1).setReadonly(!0)),e}return Object(A.a)(n,[{key:"generate",value:function(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),("irradiance"===e.slot?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}}]),n}(uA),GA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new la,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;return Object(E.a)(this,n),(e=t.call(this,"v4",{shared:!0})).nodeType="CubeTexture",e.value=r,e.uv=null!==i&&void 0!==i?i:new zA,e.bias=a,e}return Object(A.a)(n,[{key:"getTexture",value:function(e,t){return Object(b.a)(Object(w.a)(n.prototype),"generate",this).call(this,e,t,this.value.uuid,"tc")}},{key:"generate",value:function(e,t){var n,r;if("samplerCube"===t)return this.getTexture(e,t);var i,a=this.getTexture(e,t),o=null===(n=this.uv)||void 0===n?void 0:n.build(e,"v3"),s=this.bias?this.bias.build(e,"f"):void 0;void 0===s&&e.context.bias&&(s=e.context.bias.setTexture(this).build(e,"f")),i=s?"texCubeBias( "+a+", "+o+", "+s+" )":"texCube( "+a+", "+o+" )";var u={include:e.isShader("vertex"),ignoreCache:!0},c=this.getType(e);return e.addContext(u),this.colorSpace=null!==(r=this.colorSpace)&&void 0!==r?r:new SA(new EA("",c)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(i),i=this.colorSpace.build(e,c),e.removeContext(),e.format(i,c,t)}}]),n}(cA),HA=["x","y","z","w"],WA=["float","vec2","vec3","vec4"],qA={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},YA={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},XA=function(){function e(){Object(E.a)(this,e),this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.getIncludesCode=function(){function e(e,t){return e.deps.length-t.deps.length}return function(t,n){var r=this.getIncludes(t,n);if(!r)return"";var i="";r=r.sort(e);for(var a=0;a<r.length;a++)r[a].src&&(i+=r[a].src+"\n");return i}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","\n\t\t\t// NOTE: Include Spline's blending modes. This could be part of BlendNode\n\t\t\t#define SPE_BLENDING_NORMAL 0\n\t\t\t#define SPE_BLENDING_MULTIPLY 1\n\t\t\t#define SPE_BLENDING_SCREEN 2\n\t\t\t#define SPE_BLENDING_OVERLAY 3\n\n\t\t\tvec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, a * b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );\n\t\t\t\treturn mix( a, tmp, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );\n\t\t\t\treturn clamp( mix( a, tmp, alpha ), 0.0, 1.0 );\n\t\t\t}\n\n\t\t\tvec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {\n\t\t\t\tif ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );\n\t\t\t\treturn vec3( 1.0 );\n\t\t\t}\n\t\t\t","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join("\n"),fragment:["float accumAlpha = 0.0;","void accumulateAlpha(float alpha) {\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * alpha;\n\t\t\t\t}",""].join("\n")},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}return Object(A.a)(e,[{key:"build",value:function(e,t){this.buildShader("vertex",e),this.buildShader("fragment",t);for(var n=0;n<this.requires.uv.length;n++)if(this.requires.uv[n]){var r=n>0?n+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),n>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this}},{key:"buildShader",value:function(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}},{key:"setMaterial",value:function(e,t){return this.defines={},this}},{key:"addFlow",value:function(e,t,n){return this.addSlot(e).addCache(t).addContext(n)}},{key:"removeFlow",value:function(){return this.removeSlot().removeCache().removeContext()}},{key:"addCache",value:function(e){return this.cache=null!==e&&void 0!==e?e:"",this.caches.push(this.cache),this}},{key:"removeCache",value:function(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}},{key:"addContext",value:function(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}},{key:"removeContext",value:function(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}},{key:"addSlot",value:function(e){return this.slot=e||"",this.slots.push(this.slot),this}},{key:"removeSlot",value:function(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}},{key:"addFragmentVariable",value:function(e,t){void 0===this.fragmentVariables[e]&&(this.addFragmentCode("".concat(t," ").concat(e,";")),this.fragmentVariables[e]="")}},{key:"addFragmentParsVariable",value:function(e,t){void 0===this.fragmentParsVariables[e]&&(this.addFragmentParsCode("".concat(t," ").concat(e,";")),this.fragmentParsVariables[e]="")}},{key:"addVertexParsVariable",value:function(e,t){void 0===this.vertexParsVariables[e]&&(this.addVertexParsCode("".concat(t," ").concat(e,";")),this.vertexParsVariables[e]="")}},{key:"addVertexCode",value:function(e){this.addCode(e,"vertex")}},{key:"addFragmentCode",value:function(e){this.addCode(e,"fragment")}},{key:"addCode",value:function(e,t){this.code[null!==t&&void 0!==t?t:this.shader]+=e+"\n"}},{key:"addVertexNodeCode",value:function(e){this.addNodeCode(e,"vertex")}},{key:"addFragmentNodeCode",value:function(e){this.addNodeCode(e,"fragment")}},{key:"addNodeCode",value:function(e,t){this.nodeCode[null!==t&&void 0!==t?t:this.shader]+=e+"\n"}},{key:"clearNodeCode",value:function(e){var t;e=null!==(t=e)&&void 0!==t?t:this.shader;var n=this.nodeCode[e];return this.nodeCode[e]="",n}},{key:"clearVertexNodeCode",value:function(){return this.clearNodeCode("vertex")}},{key:"clearFragmentNodeCode",value:function(){return this.clearNodeCode("fragment")}},{key:"addVertexFinalCode",value:function(e){this.addFinalCode(e,"vertex")}},{key:"addFragmentFinalCode",value:function(e){this.addFinalCode(e,"fragment")}},{key:"addFinalCode",value:function(e,t){this.finalCode[null!==t&&void 0!==t?t:this.shader]+=e+"\n"}},{key:"addVertexParsCode",value:function(e){this.addParsCode(e,"vertex")}},{key:"addFragmentParsCode",value:function(e){this.addParsCode(e,"fragment")}},{key:"addParsCode",value:function(e,t){this.parsCode[null!==t&&void 0!==t?t:this.shader]+=e+"\n"}},{key:"addVaryCode",value:function(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}},{key:"isCache",value:function(e){return-1!==this.caches.indexOf(e)}},{key:"isSlot",value:function(e){return-1!==this.slots.indexOf(e)}},{key:"define",value:function(e,t){this.defines[e]=void 0===t?1:t}},{key:"require",value:function(e){this.requires[e]=!0}},{key:"isDefined",value:function(e){return void 0!==this.defines[e]}},{key:"getVar",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"varying",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"V",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",o=this.getVars(r),s=o[e];if(!s){var u=o.length;s={name:n||"node"+i+u+(a?"_"+a:""),type:t},o.push(s),o[e]=s}return s}},{key:"getTempVar",value:function(e,t,n,r){return this.getVar(e,t,n,this.shader,"T",r)}},{key:"getAttribute",value:function(e,t){if(!this.attributes[e]){var n=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(n.name+" = "+e+";"),this.attributes[e]={varying:n,name:e,type:t}}return this.attributes[e]}},{key:"getCode",value:function(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join("\n")}},{key:"getVarListCode",value:function(e,t){var n;t=null!==(n=t)&&void 0!==n?n:"";for(var r="",i=0,a=e.length;i<a;++i){var o=e[i],s=o.type,u=o.name,c=o.size,l=this.getFormatByType(s);if(void 0===l)throw new Error("Node pars "+l+" not found.");l.includes("[]")?r+=t+" "+l.substring(0,l.length-2)+" "+u+"[".concat(c,"];\n"):r+=t+" "+l+" "+u+";\n"}return r}},{key:"getVars",value:function(e){return this.inputs.vars[null!==e&&void 0!==e?e:this.shader]}},{key:"getNodeData",value:function(e){var t=e instanceof aA?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}},{key:"createUniform",value:function(e,t,n,r,i,a){if(t.includes("[]")){var o=this.inputs.arrayUniforms,s=o.list.length,u=new iA({type:t,size:n.size,name:r||"nodeUA"+s+(a?"_"+a:""),node:n,needsUpdate:i});return o.list.push(u),o[e].push(u),o[e][u.name]=u,this.uniforms[u.name]=u,u}var c=this.inputs.uniforms,l=c.list.length,h=new iA({type:t,name:r||"nodeU"+l+(a?"_"+a:""),node:n,needsUpdate:i});return c.list.push(h),c[e].push(h),c[e][h.name]=h,this.uniforms[h.name]=h,h}},{key:"createVertexUniform",value:function(e,t,n,r,i){return this.createUniform("vertex",e,t,n,r,i)}},{key:"createFragmentUniform",value:function(e,t,n,r,i){return this.createUniform("fragment",e,t,n,r,i)}},{key:"include",value:function(e,t,n){var r;if(e="string"==typeof e?sA.get(e):e,!1===this.context.include)return e.name;e instanceof mA?r=this.includes.functions:e instanceof bA?r=this.includes.consts:e instanceof OA&&(r=this.includes.structs);var i=r[this.shader]=r[this.shader]||[];if(e){var a,o=i[e.name];if(o||(o=i[e.name]={node:e,deps:[]},i.push(o),o.src=e.build(this,"source")),e instanceof mA&&t&&i[t.name]&&-1===i[t.name].deps.indexOf(e)&&(i[t.name].deps.push(e),null!==(a=e.includes)&&void 0!==a&&a.length)){var s=0;do{this.include(e.includes[s++],t)}while(s<e.includes.length)}return n&&(o.src=n),e.name}throw new Error("Include not found.")}},{key:"colorToVectorProperties",value:function(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}},{key:"colorToVector",value:function(e){return e.replace(/c/g,"v3")}},{key:"getIncludes",value:function(e,t){return this.includes[e][t||this.shader]}},{key:"getConstructorFromLength",value:function(e){return WA[e-1]}},{key:"isTypeMatrix",value:function(e){return/^m/.test(e)}},{key:"getTypeLength",value:function(e){return"f"===e?1:parseInt(this.colorToVector(e).substr(1))}},{key:"getTypeFromLength",value:function(e){return 1===e?"f":"v"+e}},{key:"findNode",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<arguments.length;r++){var i=t[r];if(null!==i&&void 0!==i&&i.isNode)return i}}},{key:"resolve",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<arguments.length;r++){var i=t[r];if(void 0!==i){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case ze:case Ve:return new GA(i);case We:return new VA(new AA(i));default:return new AA(i)}else{if(i.isVector2)return new lA(i);if(i.isVector3)return new hA(i);if(i.isVector4)return new fA(i)}}}}},{key:"format",value:function(e,t,n){switch(this.colorToVector(n+" <- "+t)){case"f <- v2":case"f <- v3":case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}},{key:"getTypeByFormat",value:function(e){return qA[e]||e}},{key:"getFormatByType",value:function(e){return YA[e]||e}},{key:"getUUID",value:function(e,t){return(t=void 0===t||t)&&this.cache&&(e=this.cache+"-"+e),e}},{key:"getElementByIndex",value:function(e){return HA[e]}},{key:"getIndexByElement",value:function(e){return HA.indexOf(e)}},{key:"isShader",value:function(e){return this.shader===e}},{key:"setShader",value:function(e){return this.shader=e,this}},{key:"mergeDefines",value:function(e){for(var t in e)this.defines[t]=e[t];return this.defines}},{key:"mergeUniform",value:function(e){for(var t in e)this.uniforms[t]=e[t];return this.uniforms}},{key:"getTextureEncodingFromMap",value:function(e){var t;return e?e.isTexture&&(t=e.encoding):t=tn,t===tn&&this.context.gamma&&(t=nn),t}}]),e}(),KA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;return Object(E.a)(this,n),(e=t.call(this,"c")).nodeType="Color",e.value=r instanceof dA?r:new dA(r||0,i,a,o),e}return Object(A.a)(n,[{key:"setRGBA",value:function(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}},{key:"generate",value:function(e,t,n,r,i,a){var o,s;n=e.getUUID(null!==(o=n)&&void 0!==o?o:this.getUUID()),r=null!==(s=r)&&void 0!==s?s:this.getType(e);var u=e.getNodeData(n),c=this.getReadonly()&&void 0!==this.generateReadonly;if(this.alpha){var l=this.alpha.build(e,"f");e.addFragmentNodeCode("accumAlpha += ( 1.0 - accumAlpha ) * ".concat(l,";"))}return c?this.generateReadonly(e,t,n,r,i,a):e.isShader("vertex")?(u.vertex||(u.vertex=e.createVertexUniform(r,this,i,a,this.getLabel())),e.format(u.vertex.name,r,t)):(u.fragment||(u.fragment=e.createFragmentUniform(r,this,i,a,this.getLabel())),e.format(u.fragment.name,r,t))}},{key:"generateReadonly",value:function(e,t,n,r,i,a){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,t)}}]),n}(cA),QA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,"i")).nodeType="Int",r.value=Math.floor(null!==e&&void 0!==e?e:0),r}return Object(A.a)(n,[{key:"generateReadonly",value:function(e,t,n,r,i,a){return e.format(this.value.toString(),r,t)}}]),n}(cA),ZA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this,"basic")).nodeType="Basic",e.color=new KA(5855577),e.shadingAlpha=new jA(1),e.shadingBlend=new QA(0),e}return Object(A.a)(n,[{key:"category",get:function(){return"phong"}},{key:"generate",value:function(e){var t;if(e.isShader("vertex")){var n=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(ta.merge([ka.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join("\n"));var r=["#include <beginnormal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];n&&r.push(n.code,n.result?"displaced_position = "+n.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","\tvNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join("\n")}else{void 0===this.color&&(this.color=new KA(5855577)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});var i=this.color.flow(e,"c",{slot:"color"}),a=this.alpha?this.alpha.flow(e,"f"):void 0,o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=void 0!==a,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join("\n"));var s=["#include <normal_fragment_begin>",i.code];a&&s.push(a.code,"#ifdef ALPHATEST"," if ( "+a.result+" <= ALPHATEST ) discard;","#endif"),o?s.push(o.code,"vec3 outgoingLight = ".concat(i.result,";"),"vec3 finalColor = spe_blend(outgoingLight, ".concat(o.result,", 1.0, SPE_BLENDING_NORMAL);")):s.push("vec3 finalColor = ".concat(i.result,";")),a?s.push("gl_FragColor = vec4( finalColor, accumAlpha * ".concat(a.result," );")):s.push("gl_FragColor = vec4("+i.result+", 1.0 );"),s.push("#include <fog_fragment>","#include <dithering_fragment>"),t=s.join("\n")}return t}}]),n}(aA),JA=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1?arguments[1]:void 0;return Object(E.a)(this,n),(e=t.call(this,"f[]")).nodeType="FloatArray",e.size=r,e.value=Array.isArray(i)?i:"number"==typeof i?new Array(r).fill(i):new Array(r).fill(0),e}return Object(A.a)(n)}(cA),$A={normalRenderTarget:new AA,normalRenderTargetDepth:new AA,transmissionRenderTarget:new AA,transmissionSize:new lA(2048,2048),transmissionRenderTargetDepth:new AA,pixelRatioNode:new jA(1),resolution:new lA,penumbraSize:new JA(5,.5)},ej=0,tj=Object.values($A);ej<tj.length;ej++){tj[ej].isRenderGlobal=!0}var nj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this,"lambert")).nodeType="Lambert",e.color=new KA(5855577),e.emissive=new KA(0),e.emissiveIntensity=new jA(1),e.shadingAlpha=new jA(1),e.shadingBlend=new QA(0),e}return Object(A.a)(n,[{key:"category",get:function(){return"lambert"}},{key:"build",value:function(e){var t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){var n=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(ta.merge([ka.fog,ka.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var r=["#include <beginnormal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];n&&r.push(n.code,n.result?"displaced_position = "+n.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\n\t\t\t\t\tvec3 diffuse = vec3( 1.0 );\n\t\t\t\t\tGeometricContext geometry;\n\t\t\t\t\tgeometry.position = mvPosition.xyz;\n\t\t\t\t\tgeometry.normal = normalize( transformedNormal );\n\t\t\t\t\tgeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\t\t\t\t\tGeometricContext backGeometry;\n\t\t\t\t\tbackGeometry.position = geometry.position;\n\t\t\t\t\tbackGeometry.normal = -geometry.normal;\n\t\t\t\t\tbackGeometry.viewDir = geometry.viewDir;\n\t\t\t\t\tvLightFront = vec3( 0.0 );\n\t\t\t\t\tvIndirectFront = vec3( 0.0 );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvLightBack = vec3( 0.0 );\n\t\t\t\t\t\tvIndirectBack = vec3( 0.0 );\n\t\t\t\t\t#endif\n\t\t\t\t\tIncidentLight directLight;\n\t\t\t\t\tfloat dotNL;\n\t\t\t\t\tvec3 directLightColor_Diffuse;\n\t\t\t\t\tvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\tvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\t\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_POINT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_DIR_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_HEMI_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join("\n")}else{e.mergeUniform({penumbraSize:$A.penumbraSize}),void 0===this.color&&(this.color=new KA(5855577)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);var i=this.color.flow(e,"c",{slot:"color"}),a=this.emissive.flow(e,"c",{slot:"emissive"}),o=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),s=this.shadingAlpha.flow(e,"f"),u=this.shadingBlend.flow(e,"i"),c=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=void 0!==l,e.addParsCode(["uniform float penumbraSize[".concat(5,"];"),"varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));var h=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx, viewdy));\n\t\t\t\tbool isFrontFacing = (dot(normal, faceNormal) >= 0.0);\n\t\t\t\t","#include <clipping_planes_fragment>"];h.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),l&&h.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),h.push("#ifdef DOUBLE_SIDED","\treflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","\treflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","\treflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","\treflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),a&&h.push(a.code,"reflectedLight.directDiffuse += "+a.result+" * "+o.result+";"),h.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;"),h.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(s.result," * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(s.result,", ").concat(u.result," );\n\t\t\t\t}\n\t\t\t\t")),c&&h.push(c.code,"outgoingLight = spe_blend(outgoingLight, ".concat(c.result,", 1.0, SPE_BLENDING_NORMAL);")),l?h.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(l.result," );")):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join("\n")}return t}}]),n}(aA),rj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this,"phong")).nodeType="Phong",e.color=new KA(5855577),e.specular=new KA(1118481),e.shininess=new jA(30),e.shadingAlpha=new jA(1),e.shadingBlend=new QA(0),e}return Object(A.a)(n,[{key:"category",get:function(){return"phong"}},{key:"build",value:function(e){var t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){var n=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(ta.merge([ka.fog,ka.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var r=["#include <beginnormal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];n&&r.push(n.code,n.result?"displaced_position = "+n.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join("\n")}else{e.mergeUniform({penumbraSize:$A.penumbraSize}),void 0===this.color&&(this.color=new KA(5855577)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);var i=this.color.flow(e,"c",{slot:"color"}),a=this.specular.flow(e,"c"),o=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),u=this.shadingBlend.flow(e,"i"),c=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=void 0!==l,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[".concat(5,"];"),"#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));var h=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tBlinnPhongMaterial material;"];h.push(i.code,"\tvec3 diffuseColor = "+i.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","\tvec3 totalEmissiveRadiance = emissive;",a.code,"\tvec3 specular = "+a.result+";",o.code,"\tfloat shininess = max( 0.0001, "+o.result+" );","\tfloat specularStrength = 1.0;"),l&&h.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;"),h.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(s.result," * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(s.result,", ").concat(u.result," );\n\t\t\t\t}\n\t\t\t\t")),c&&h.push(c.code,"outgoingLight = spe_blend(outgoingLight, ".concat(c.result,", 1.0, SPE_BLENDING_NORMAL);")),l?h.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(l.result," );")):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join("\n")}return t}}]),n}(aA),ij=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this,"standard")).nodeType="Standard",e.color=new KA(5855577),e.roughness=new jA(.3),e.metalness=new jA(0),e.reflectivity=new jA(.5),e.shadingAlpha=new jA(1),e.shadingBlend=new QA(0),e}return Object(A.a)(n,[{key:"category",get:function(){return"physical"}},{key:"build",value:function(e){var t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){var n=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(ta.merge([ka.fog,ka.lights])),ka.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var r=["#include <beginnormal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];n&&r.push(n.code,n.result?"displaced_position = "+n.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join("\n")}else{e.mergeUniform({penumbraSize:$A.penumbraSize});var i={gamma:!0};void 0===this.color&&(this.color=new KA(5855577)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);var a=this.color.flow(e,"c",{slot:"color",context:i}),o=this.roughness.flow(e,"f"),s=this.metalness.flow(e,"f"),u=this.shadingAlpha.flow(e,"f"),c=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(e,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=void 0!==h,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[".concat(5,"];"),"#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join("\n"));var f=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];f.push(a.code,"\tvec3 diffuseColor = "+a.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",o.code,"\tfloat roughnessFactor = "+o.result+";",s.code,"\tfloat metalnessFactor = "+s.result+";"),h&&f.push(h.code,"#ifdef ALPHATEST","\tif ( "+h.result+" <= ALPHATEST ) discard;","#endif"),f.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),f.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?f.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):f.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),f.push("#include <lights_fragment_begin>"),f.push("#include <lights_fragment_end>"),f.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),f.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(u.result," * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(u.result,", ").concat(c.result," );\n\t\t\t\t}\n\t\t\t\t")),l&&f.push(l.code,"outgoingLight = spe_blend(outgoingLight, ".concat(l.result,", 1.0, SPE_BLENDING_NORMAL);")),h?f.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(h.result," );")):f.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),f.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=f.join("\n")}return t}}]),n}(aA),aj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this,"toon")).nodeType="Toon",e.color=new KA(5855577),e.specular=new KA(1118481),e.shininess=new jA(30),e.shadingAlpha=new jA(1),e.shadingBlend=new QA(0),e}return Object(A.a)(n,[{key:"category",get:function(){return"toon"}},{key:"build",value:function(e){var t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){var n=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(ta.merge([ka.fog,ka.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var r=["#include <beginnormal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];n&&r.push(n.code,n.result?"displaced_position = "+n.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join("\n")}else{e.mergeUniform({penumbraSize:$A.penumbraSize}),void 0===this.color&&(this.color=new KA(5855577)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);var i=this.color.flow(e,"c",{slot:"color"}),a=this.specular.flow(e,"c"),o=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),u=this.shadingBlend.flow(e,"i"),c=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=void 0!==l,e.addParsCode(["uniform float penumbraSize[".concat(5,"];"),"varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>","\n\t\t\t\t\tvarying vec3 vViewPosition;\n\t\t\t\t\tstruct ToonMaterial {\n\t\t\t\t\t\tvec3\tdiffuseColor;\n\t\t\t\t\t\tvec3\tspecularColor;\n\t\t\t\t\t\tfloat\tspecularShininess;\n\t\t\t\t\t\tfloat\tspecularStrength;\n\t\t\t\t\t};\n\t\t\t\t\tvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t\t\t\n\t\t\t\t\t\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n\t\t\t\t\t}\n\t\t\t\t\tvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t}\n\t\t\t\t\t#define RE_Direct\t\t\t\tRE_Direct_Toon\n\t\t\t\t\t#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\t\t\t\t\t#define Material_LightProbeLOD( material )\t(0)\n\t\t\t\t\t","#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join("\n"));var h=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tToonMaterial material;"];h.push(i.code,"\tvec3 diffuseColor = "+i.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"\tvec3 specular = "+a.result+";",o.code,"\tfloat shininess = max( 0.0001, "+o.result+" );","\tfloat specularStrength = 1.0;"),l&&h.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),h.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(s.result," * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(s.result,", ").concat(u.result," );\n\t\t\t\t}\n\t\t\t\t")),c&&h.push(c.code,"outgoingLight = spe_blend(outgoingLight, ".concat(c.result,", 1.0, SPE_BLENDING_NORMAL);")),l?h.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(l.result," );")):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join("\n")}return t}}]),n}(aA),oj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,"b")).nodeType="Bool",r.value=null!==e&&void 0!==e&&e,r}return Object(A.a)(n,[{key:"generateReadonly",value:function(e,t,n,r){return e.format(this.value?"true":"false",r,t)}}]),n}(cA),sj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,"m3")).nodeType="Matrix3",r.value=null!==e&&void 0!==e?e:new jn,r}return Object(A.a)(n,[{key:"generateReadonly",value:function(e,t,n,r,i,a){return e.format("mat3("+this.value.elements.join(", ")+")",r,t)}},{key:"elements",get:function(){return this.value.elements},set:function(e){this.value.fromArray(e)}}]),n}(cA),uj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1?arguments[1]:void 0;return Object(E.a)(this,n),(e=t.call(this,"v4[]")).nodeType="Vector4Array",e.size=r,e.value=Array.isArray(i)?i:i instanceof Qn?new Array(r).fill(i):new Array(r).fill(new Qn(0)),e}return Object(A.a)(n)}(cA),cj=function(e){return e.SIMPLEX="simplex3d",e.SIMPLEX_FRACTAL="simplex3dFractal",e.ASHIMA="simplexAshima",e.FBM="fbm",e.PERLIN="perlin",e}(cj||{}),lj=function(){var e=new mA("vec3 random3(vec3 c) {\n\t\t\tfloat j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n\t\t\tvec3 r;\n\t\t\tr.z = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.x = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.y = fract(512.0*j);\n\t\t\treturn r-0.5;\n\t\t}"),t=new mA("float simplex3d(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t \n\t\t\t vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t vec3 x1 = x - i1 + G3;\n\t\t\t vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(s), x);\n\t\t\t d.y = dot(random3(s + i1), x1);\n\t\t\t d.z = dot(random3(s + i2), x2);\n\t\t\t d.w = dot(random3(s + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}",[e]);t.keywords.F3=new bA("float F3 0.3333333"),t.keywords.G3=new bA("float G3 0.1666667");var n=new mA("float simplex3dFractal(vec3 m) {\n\t\t\tmat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);\n\t\t\tmat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);\n\t\t\tmat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);\n\t\t\treturn 0.5333333 * simplex3d(m * rot1)\n\t\t\t\t + 0.2666667 * simplex3d(2.0 * m * rot2)\n\t\t\t\t + 0.1333333 * simplex3d(4.0 * m * rot3)\n\t\t\t\t + 0.0666667 * simplex3d(8.0 * m);\n\t\t}",[t]),r=new mA("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),i=new mA("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new mA("float simplexAshima(vec3 v) {\n\t\t  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\t\t  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\t\t  vec3 i  = floor(v + dot(v, C.yyy) );\n\t\t  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\t\t  vec3 g = step(x0.yzx, x0.xyz);\n\t\t  vec3 l = 1.0 - g;\n\t\t  vec3 i1 = min( g.xyz, l.zxy );\n\t\t  vec3 i2 = max( g.xyz, l.zxy );\n\t\t  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n\t\t  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n\t\t  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\t\t  i = mod(i, 289.0 ); \n\t\t  vec4 p = permute( permute( permute( \n\t\t\t\t\t i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t\t   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n\t\t\t\t   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\t\t  float n_ = 1.0/7.0; // N=7\n\t\t  vec3  ns = n_ * D.wyz - D.xzx;\n\t\t  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\n\t\t  vec4 x_ = floor(j * ns.z);\n\t\t  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\t\t  vec4 x = x_ *ns.x + ns.yyyy;\n\t\t  vec4 y = y_ *ns.x + ns.yyyy;\n\t\t  vec4 h = 1.0 - abs(x) - abs(y);\n\t\t  vec4 b0 = vec4( x.xy, y.xy );\n\t\t  vec4 b1 = vec4( x.zw, y.zw );\n\t\t  vec4 s0 = floor(b0)*2.0 + 1.0;\n\t\t  vec4 s1 = floor(b1)*2.0 + 1.0;\n\t\t  vec4 sh = -step(h, vec4(0.0));\n\t\t  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\t\t  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\t\t  vec3 p0 = vec3(a0.xy,h.x);\n\t\t  vec3 p1 = vec3(a0.zw,h.y);\n\t\t  vec3 p2 = vec3(a1.xy,h.z);\n\t\t  vec3 p3 = vec3(a1.zw,h.w);\n\t\t  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\t\t  p0 *= norm.x;\n\t\t  p1 *= norm.y;\n\t\t  p2 *= norm.z;\n\t\t  p3 *= norm.w;\n\t\t  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\t\t  m = m * m;\n\t\t  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n\t\t\t\t\t\t\t\t\t\tdot(p2,x2), dot(p3,x3) ) );\n\t\t}",[r,i]),o=new mA("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),s=new mA("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),u=new mA("float noise(vec3 p){\n\t\t\tvec3 a = floor(p);\n\t\t\tvec3 d = p - a;\n\t\t\td = d * d * (3.0 - 2.0 * d);\n\t\t\tvec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n\t\t\tvec4 k1 = perm(b.xyxy);\n\t\t\tvec4 k2 = perm(k1.xyxy + b.zzww);\n\t\t\tvec4 c = k2 + a.zzzz;\n\t\t\tvec4 k3 = perm(c);\n\t\t\tvec4 k4 = perm(c + 1.0);\n\t\t\tvec4 o1 = fract(k3 * (1.0 / 41.0));\n\t\t\tvec4 o2 = fract(k4 * (1.0 / 41.0));\n\t\t\tvec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n\t\t\tvec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\t\t\treturn o4.y * d.y + o4.x * (1.0 - d.y);\n\t\t}",[s]),c=new mA("float fbm(vec3 x) {\n\t\t\tfloat v = 0.0;\n\t\t\tfloat a = 0.5;\n\t\t\tvec3 shift = vec3(100);\n\t\t\tfor (int i = 0; i < NUM_OCTAVES; ++i) {\n\t\t\t\tv += a * noise(x);\n\t\t\t\tx = x * 2.0 + shift;\n\t\t\t\ta *= 0.5;\n\t\t\t}\n\t\t\treturn v;\n\t\t}",[u]);c.keywords.NUM_OCTAVES=new bA("int NUM_OCTAVES ".concat(5));var l=new mA("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}");return{simplex:t,simplexFractal:n,simplexAshima:a,fbm:c,perlin:new mA("float perlin(vec3 P){\n\t\t  vec3 Pi0 = floor(P);\n\t\t  vec3 Pi1 = Pi0 + vec3(1.0);\n\t\t  Pi0 = mod(Pi0, 289.0);\n\t\t  Pi1 = mod(Pi1, 289.0);\n\t\t  vec3 Pf0 = fract(P);\n\t\t  vec3 Pf1 = Pf0 - vec3(1.0);\n\t\t  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\t\t  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n\t\t  vec4 iz0 = Pi0.zzzz;\n\t\t  vec4 iz1 = Pi1.zzzz;\n\t\t  vec4 ixy = permute(permute(ix) + iy);\n\t\t  vec4 ixy0 = permute(ixy + iz0);\n\t\t  vec4 ixy1 = permute(ixy + iz1);\n\t\t  vec4 gx0 = ixy0 / 7.0;\n\t\t  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n\t\t  gx0 = fract(gx0);\n\t\t  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\t\t  vec4 sz0 = step(gz0, vec4(0.0));\n\t\t  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\t\t  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\t\t  vec4 gx1 = ixy1 / 7.0;\n\t\t  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n\t\t  gx1 = fract(gx1);\n\t\t  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\t\t  vec4 sz1 = step(gz1, vec4(0.0));\n\t\t  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\t\t  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\t\t  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\t\t  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\t\t  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\t\t  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\t\t  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\t\t  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\t\t  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\t\t  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\t\t  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\t\t  g000 *= norm0.x;\n\t\t  g010 *= norm0.y;\n\t\t  g100 *= norm0.z;\n\t\t  g110 *= norm0.w;\n\t\t  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\t\t  g001 *= norm1.x;\n\t\t  g011 *= norm1.y;\n\t\t  g101 *= norm1.z;\n\t\t  g111 *= norm1.w;\n\t\t  float n000 = dot(g000, Pf0);\n\t\t  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\t\t  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\t\t  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\t\t  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\t\t  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\t\t  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\t\t  float n111 = dot(g111, Pf1);\n\t\t  vec3 fade_xyz = fade(Pf0);\n\t\t  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\t\t  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\t\t  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n\t\t  return 2.2 * n_xyz;\n\t\t}",[r,i,l])}}(),hj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o,s,u,c,l,h,d,f){var p;return Object(E.a)(this,n),(p=t.call(this,"v3")).nodeType="Noise",p.scale=e,p.size=r,p.move=i,p.fA=a,p.fB=o,p.distortion=s,p.colorA=u,p.colorB=c,p.colorC=l,p.colorD=h,p.alpha=d,p.noiseType=f,p.calpha="g".concat(p.uuid.toString().replace(/-/g,""),"_calpha"),p}return Object(A.a)(n,[{key:"generate",value:function(e,t,n,r,i){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");var a=Object.values(cj)[this.noiseType.value],o=new mA("vec3 ".concat(a,"customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, float alpha, out float calpha) {\n                vec3 st = position / size;\n\t\t\t\tst /= scale;\n\t\t\t\tvec3 q = vec3(").concat(a,"(st),\n\t\t\t\t\t\t\t  ").concat(a,"(st + vec3(1.0)),\n\t\t\t\t\t\t\t  ").concat(a,"(st + vec3(1.0)));\n\t\t\t\tvec3 r = vec3(").concat(a,"(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),\n\t\t\t\t\t\t\t  ").concat(a,"(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), \n\t\t\t\t\t\t\t  ").concat(a,"(st * q));\n\t\t\t\tfloat f = ").concat(a,"(st + r);\n\t\t\t\tvec4 color;\n\t\t\t\tcolor = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));\n\t\t\t\tcolor = mix(color, colorC, clamp(length(q), 0.0, 1.0));\n\t\t\t\tcolor = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));\n\n                float lalpha = alpha * color.a;\n                calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\n\t\t\t    accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t}"),[lj.simplex,lj.simplexFractal,lj.simplexAshima,lj.fbm,lj.perlin]),s=e.include(o),u=[];return u.push(this.scale.build(e,"f")),u.push(this.size.build(e,"v3")),u.push(this.move.build(e,"f")),u.push(this.fA.build(e,"v2")),u.push(this.fB.build(e,"v2")),u.push(this.distortion.build(e,"v2")),u.push(this.colorA.build(e,"v4")),u.push(this.colorB.build(e,"v4")),u.push(this.colorC.build(e,"v4")),u.push(this.colorD.build(e,"v4")),u.push(this.alpha.build(e,"f")),u.push(this.calpha),e.format(s+"("+u.join(",")+")",this.getType(e),t)}}]),n}(uA);hj.numOctaves=5;var dj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o,s,u){var c;return Object(E.a)(this,n),(c=t.call(this,"v3")).nodeType="Fresnel",c.color=e,c.bias=r,c.scale=i,c.intensity=a,c.factor=o,c.alpha=s,c.mode=u,c.calpha="g".concat(c.uuid.toString().replace(/-/g,""),"_calpha"),c}return Object(A.a)(n,[{key:"generate",value:function(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");var r=e.include(n.Nodes.fresnel),i=[];return i.push(this.color.build(e,"c")),i.push(this.bias.build(e,"f")),i.push(this.scale.build(e,"f")),i.push(this.intensity.build(e,"f")),i.push(this.factor.build(e,"f")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),i.push(this.calpha),e.format(r+"("+i.join(",")+")",this.getType(e),t)}return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}}]),n}(uA),fj=dj;fj.Nodes={fresnel:new mA("vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, float alpha, int mode, out float calpha) {\n\t\t\t\tfloat fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );\n\n\t\t\t\tfloat lalpha = clamp( fresnel, 0.0, 1.0 ) * alpha;\n\t\t\t\tcalpha = lalpha / clamp(lalpha + accumAlpha, 0.001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\t\t\t\treturn color;\n\t\t\t}")};var pj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o,s,u){var c;return Object(E.a)(this,n),(c=t.call(this,"v3")).nodeType="Rainbow",c.filmThickness=e,c.movement=r,c.wavelengths=i,c.noiseStrength=a,c.noiseScale=o,c.offset=s,c.alpha=u,c.calpha="g".concat(c.uuid.toString().replace(/-/g,""),"_calpha"),c}return Object(A.a)(n,[{key:"generate",value:function(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");var r=e.include(n.Nodes.rainbow),i=[];return i.push(this.filmThickness.build(e,"f")),i.push(this.movement.build(e,"f")),i.push(this.wavelengths.build(e,"v3")),i.push(this.noiseStrength.build(e,"f")),i.push(this.noiseScale.build(e,"f")),i.push(this.offset.build(e,"v3")),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(r+"("+i.join(",")+")",this.getType(e),t)}return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}}]),n}(uA),vj=pj;vj.Nodes=function(){var e=new mA("vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {\n                 vec3 st = position / noiseScale;\n\t\t\t\t vec3 q = vec3(simplex3d(st),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(1.0)),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(1.0)));\n\n\t\t\t\t vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),\n\t\t\t\t\t\t\t  simplex3d(st * q));\n\n                 float noise = simplex3d(st + r);\n\n                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);\n             }",[lj.simplex]);return{rainbow:new mA("vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, float alpha, out float calpha) {\n                 vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);\n\n                 float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);\n                 float lalpha = alpha * rainbowContribution;\n                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\n                 return res;\n             }",[e])}}();var mj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o,s,u,c,l,h,d,f,p,v,m,g){var y;return Object(E.a)(this,n),(y=t.call(this,"v3")).nodeType="Outline",y.firstTime=!0,y.outlineColor=e,y.contourColor=r,y.outlineWidth=i,y.contourWidth=a,y.contourThreshold=o,y.outlineThreshold=s,y.contourFrequency=u,y.outlineSmoothing=c,y.contourDirection=l,y.positionalLines=h,y.compensation=d,y.resolution=f,y.normalMap=p,y.depthMap=v,y.pixelRatio=m,y.alpha=g,y.calpha="g".concat(y.uuid.toString().replace(/-/g,""),"_calpha"),y}return Object(A.a)(n,[{key:"generate",value:function(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.firstTime){var r=this.outlineWidth.build(e,"f"),i=this.resolution.build(e,"v2"),a=this.compensation.build(e,"b"),o=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(r,"uniform float"),e.addVertexParsVariable(i,"uniform vec2"),e.addVertexParsVariable(a,"uniform bool"),e.addVertexParsVariable(o,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float");var s="g".concat(this.uuid.toString().replace(/-/g,""));e.addVertexFinalCode("\n                vID = randomColor.r;\n                if (".concat(a,") {\n                    vec4 ").concat(s,"_clipPosition = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));\n                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the\n                    // normals face the camera directly. So we hackily fix this by offsetting the normal\n                    // by a tiny amount.\n                    vec3 ").concat(s,"_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;\n                    vec2 ").concat(s,"_offset = normalize(").concat(s,"_clipNormal.xy) / ").concat(i," * (").concat(r," / 2.0) * ").concat(s,"_clipPosition.w * 2.0 * ").concat(o,";\n                    ").concat(s,"_clipPosition.xy += ").concat(s,"_offset;\n                    // TODO(MAX): To handle multiple outline layers, we only want to extrude\n                    // if this offset is the biggest of all the potential offsets\n                    gl_Position = ").concat(s,"_clipPosition;\n                }\n            "))}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");var u=e.include(n.Nodes.outline),c=[];return c.push(this.outlineColor.build(e,"c")),c.push(this.contourColor.build(e,"c")),c.push(this.outlineWidth.build(e,"f")),c.push(this.contourWidth.build(e,"f")),c.push(this.contourThreshold.build(e,"f")),c.push(this.outlineThreshold.build(e,"f")),c.push(this.contourFrequency.build(e,"f")),c.push(this.outlineSmoothing.build(e,"f")),c.push(this.contourDirection.build(e,"v3")),c.push(this.positionalLines.build(e,"b")),c.push(this.resolution.build(e,"v2")),c.push(this.normalMap.getTexture(e,"t")),c.push(this.depthMap.getTexture(e,"t")),c.push(this.pixelRatio.build(e,"f")),c.push(this.compensation.build(e,"b")),c.push(this.alpha.build(e,"f")),c.push(this.calpha),this.firstTime=!this.firstTime,e.format(u+"("+c.join(",")+")",this.getType(e),t)}return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}}]),n}(uA),gj=mj;gj.Nodes=function(){var e=new mA("\nfloat sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)\n{\n    vec2 texelSize = (vec2(1.0) / resolution) * outlineWidth * pixelRatio;\n\n    vec2 uvSamples[9];\n    vec4 normalSamples[9];\n\n\tuvSamples[0] = uv + vec2( -texelSize.x, -texelSize.y);\n\tuvSamples[1] = uv + vec2(0.0, -texelSize.y);\n\tuvSamples[2] = uv + vec2(  texelSize.x, -texelSize.y);\n\tuvSamples[3] = uv + vec2( -texelSize.x, 0.0);\n\tuvSamples[4] = uv;\n\tuvSamples[5] = uv + vec2(  texelSize.x, 0.0);\n\tuvSamples[6] = uv + vec2( -texelSize.x, texelSize.y);\n\tuvSamples[7] = uv + vec2(0.0, texelSize.y);\n\tuvSamples[8] = uv + vec2(  texelSize.x, texelSize.y);\n\n\n    normalSamples[0] = texture2D(t, uvSamples[0]);\n    normalSamples[1] = texture2D(t, uvSamples[1]);\n    normalSamples[2] = texture2D(t, uvSamples[2]);\n    normalSamples[3] = texture2D(t, uvSamples[3]);\n    normalSamples[4] = texture2D(t, uvSamples[4]);\n    normalSamples[5] = texture2D(t, uvSamples[5]);\n    normalSamples[6] = texture2D(t, uvSamples[6]);\n    normalSamples[7] = texture2D(t, uvSamples[7]);\n    normalSamples[8] = texture2D(t, uvSamples[8]);\n\n    float depthBias = 0.0001;\n    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!\n    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n\n    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    vec4 sobel_edge_h = normalSamples[2] + (2.0*normalSamples[5]) + normalSamples[8] - (normalSamples[0] + (2.0*normalSamples[3]) + normalSamples[6]);\n  \tvec4 sobel_edge_v = normalSamples[0] + (2.0*normalSamples[1]) + normalSamples[2] - (normalSamples[6] + (2.0*normalSamples[7]) + normalSamples[8]);\n\n    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));\n    return edgeNormal;\n}\n");return{outline:new mA("vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float alpha, out float calpha) {\n                vec3 result = outlineColor;\n                float resultAlpha = 0.0;\n\n                vec3 N = normalize(vWNormal);\n                vec2 nuv = (gl_FragCoord.xy / resolution);\n                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);\n                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);\n\n                float t = 1.0 - contourThreshold;\n                if(positionalLines) {\n                    vec3 NDir = position * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float f  = fract(NT * contourFrequency * 0.01);\n                    float df = fwidth(NT * contourFrequency);\n\n                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);\n                    if (g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0;\n                    }\n                 }\n                 else {\n                    vec3 NDir = N * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float df = fwidth(NT * contourThreshold);\n                    float f = sin(NT * 1.0 * contourFrequency);\n                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);\n\n                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0 - g;\n                    }\n                 }\n\n                 float lalpha = alpha * resultAlpha;\n                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n                 return result;\n             }",[e])}}();var yj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o,s,u,c){var l;return Object(E.a)(this,n),(l=t.call(this,"v3")).nodeType="Transmission",l.thickness=e,l.ior=r,l.roughness=i,l.transmissionSamplerSize=a,l.transmissionSamplerMap=o,l.transmissionDepthMap=s,l.aspectRatio=u,l.alpha=c,l.calpha="g".concat(l.uuid.toString().replace(/-/g,""),"_calpha"),l}return Object(A.a)(n,[{key:"generate",value:function(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",30),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");var r=e.include(n.Nodes.transmission),i=[];return i.push(this.thickness.build(e,"f")),i.push(this.ior.build(e,"f")),i.push(this.roughness.build(e,"f")),i.push(this.transmissionSamplerSize.build(e,"v2")),i.push(this.transmissionSamplerMap.getTexture(e,"t")),i.push(this.transmissionDepthMap.getTexture(e,"t")),i.push(this.aspectRatio.build(e,"v2")),i.push("normal"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(r+"("+i.join(",")+")",this.getType(e),t)}return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}}]),n}(uA),bj=yj;bj.Nodes=function(){var e=new mA("\n            float gaussian(vec2 i) {\n                const float sigma = float(NUM_SAMPLES) * .25;\n                return exp( -.5* dot(i/=sigma,i) ) / ( 6.28 * sigma*sigma );\n            }"),t=new mA("\n            vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {\n                // Slightly modified version of this:\n                // https://www.shadertoy.com/view/ltScRG\n\n                const int LOD = 2;\n                const int sLOD = 4; // tile size = 2^LOD\n\n                vec3 O = vec3(0);\n                float a = 0.0;\n                const int s = NUM_SAMPLES/sLOD;\n                for ( int i = 0; i < s*s; i++ ) {\n                    int modulo = (i)-((i)/(s))*(s);\n                    vec2 d = vec2(float(modulo), float(i/s))*float(sLOD) - float(NUM_SAMPLES)/2.;\n                    vec2 uv = U + (scale * aspectRatio) * d;\n                    // What is the depth of the opaque object we're trying to sample\n                    float opaqueDepth = unpackRGBAToDepth(texture2D(dm, uv));\n                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {\n                        uv = unrefractedU + ((scale * min(lod / 2., 1.)) * aspectRatio) * d;\n                        lod = lod > 4.0 ? lod : lod / 2.0;\n                    }\n                    float gaussian = gaussian(d);\n\t\t            #ifdef TEXTURE_LOD_EXT\n                    O += gaussian * texture2DLodEXT( sp, uv, lod).rgb;\n                    #else\n                    O += gaussian * textureLod( sp, uv, lod).rgb;\n                    #endif\n                    a += gaussian;\n                }\n                return O / a;\n            }",[e]),n=new mA("\n            vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\t        // Direction of refracted light.\n\t\t        vec3 refractionVector = refract( -v,  n, 1.0 / ior );\n\t\t        // Compute rotation-independant scaling of the model matrix.\n\t\t        vec3 modelScale;\n\t\t        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\t        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\t        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\t        // The thickness is specified in local space.\n\t\t        return normalize( refractionVector ) * thickness * modelScale;\n\t        }"),r=new mA("\nfloat applyIorToRoughness( float roughness, float ior ) {\n\t\t// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n\t\t// an IOR of 1.5 results in the default amount of microfacet refraction.\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t} "),i=new mA("\nvec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n        float lod = applyIorToRoughness(roughness, ior);\n\n        return blur(transmissionSamplerMap, fragCoord, vec2(lod / (transmissionSamplerSize.x / 2.)), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);\n\t}",[r,t]),a=new mA("\nvec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {\n        vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n        vec3 refractedRayExit = position + transmissionRay;\n\n        // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n        vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );\n        vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n        refractionCoords += 1.0;\n        refractionCoords /= 2.0;\n\n        vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );\n        vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;\n        unrefractedCoords += 1.0;\n        unrefractedCoords /= 2.0;\n\n        // Sample framebuffer to get pixel the refracted ray hits.\n        return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );\n    }",[i,n]);return{transmission:new mA("\n            vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float alpha, out float calpha) {\n                vec3 v = vec3(0.);\n                if (isOrthographic) {\n                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n                } else {\n                    v = normalize(vWPosition - cameraPosition);\n                }\n                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );\n                float lalpha = alpha;\n\n                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n                 return transmission;\n            }",[a])}}();var wj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o,s,u,c,l,h,d){var f;return Object(E.a)(this,n),(f=t.call(this,"v3")).nodeType="Depth",f.gradientType=e,f.smooth=r,f.near=i,f.far=a,f.isVector=o,f.isWorldSpace=s,f.origin=u,f.direction=c,f.colors=l,f.steps=h,f.alpha=d,f.calpha="g".concat(f.uuid.toString().replace(/-/g,""),"_calpha"),f}return Object(A.a)(n,[{key:"generate",value:function(e,t){var r="g".concat(this.uuid.toString().replace(/-/g,"")),i=new mA("vec3 ".concat(r,"_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[").concat(r,"_MAX_COLORS], float steps[").concat(r,"_MAX_COLORS], float alpha, out float calpha) {\n               vec4 color = colors[0];\n               #ifdef ").concat(r,"_IS_VECTOR\n                   #ifdef ").concat(r,"_LINEAR\n                       #ifdef ").concat(r,"_WORLDSPACE\n                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);\n                       #else\n                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);\n                       #endif\n                   #else\n                       #ifdef ").concat(r,"_WORLDSPACE\n                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);\n                       #else\n                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);\n                       #endif\n                   #endif\n               #else\n                   float dist = length(vWPosition - cameraPosition);\n\t\t\t       float depth = ( dist - near ) / ( far - near );\n               #endif\n\n\n              float p;\n              #ifdef ").concat(r,"_SMOOTH\n\t\t\t\tfor ( int i = 1; i < ").concat(r,"_MAX_COLORS; i++ ) {\n\t\t\t\t\t\tp = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n              #else\n                for ( int i = 1; i < ").concat(r,"_MAX_COLORS; i++ ) {\n                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);\n                   color = mix(color, colors[i], p);\n                 }\n              #endif\n\n               float lalpha = alpha * color.a;\n               calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\n\t\t\t   accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n               return color.rgb;\n\t\t\t}"),[n.Nodes.vectorLinearWorldSpaceDepth,n.Nodes.vectorLinearObjectSpaceDepth,n.Nodes.vectorSphericalObjectSpaceDepth,n.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define("".concat(r,"_MAX_COLORS"),this.colors.value.length),this.smooth.value&&e.define("".concat(r,"_SMOOTH")),this.isVector.value>.5&&e.define("".concat(r,"_IS_VECTOR")),0===this.gradientType.value&&e.define("".concat(r,"_LINEAR")),this.isWorldSpace.value>.5&&e.define("".concat(r,"_WORLDSPACE")),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");var a=e.include(i),o=[];return o.push(this.near.build(e,"f")),o.push(this.far.build(e,"f")),o.push(this.origin.build(e,"v3")),o.push(this.direction.build(e,"v3")),o.push(this.colors.build(e,"v4[]")),o.push(this.steps.build(e,"f[]")),o.push(this.alpha.build(e,"f")),o.push(this.calpha),e.format(a+"("+o.join(",")+")",this.getType(e),t)}return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}}]),n}(uA),xj=wj;xj.Nodes={vectorLinearWorldSpaceDepth:new mA("float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorLinearObjectSpaceDepth:new mA("float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalWorldSpaceDepth:new mA("float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(vWPosition - origin);\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalObjectSpaceDepth:new mA("float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(position - origin);\n               return ( dist - near ) / ( far - near );\n            }")};var Oj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a){var o;return Object(E.a)(this,n),(o=t.call(this,"v3")).nodeType="Blend",o.a=e,o.b=r,o.alpha=i,o.mode=a,o}return Object(A.a)(n,[{key:"generate",value:function(e,t){if(e.isShader("fragment")){var n=[];return n.push(this.a.build(e,"c")),n.push(this.b.build(e,"c")),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),e.format("spe_blend("+n.join(",")+")",this.getType(e),t)}return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}}]),n}(uA),kj=function(e){return e.NOISE="noise",e.MAP="map",e}(kj||{}),_j=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o){var s;return Object(E.a)(this,n),(s=t.call(this,"v3")).displacementTypeIndex=new QA(0),s.nodeType="VertexDisplacement",s.intensity=e,s.movementOrTexture=r,"map"===Object.values(kj)[s.displacementTypeIndex.value]&&(s.mat=new sj(s.movementOrTexture.value.matrix)),s.cropOrOffset=i,s.scale=a,s.noiseFunctionIndex=o,s}return Object(A.a)(n,[{key:"generate",value:function(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");var r,i=[];switch(i.push("displaced_position"),i.push("displaced_normal"),Object.values(kj)[this.displacementTypeIndex.value]){case"map":r=e.include(n.Nodes.map),i.push(this.movementOrTexture.getTexture(e,"t")),i.push("uv"),i.push(this.cropOrOffset.build(e,"f")),this.mat&&i.push(this.mat.build(e,"mat3"));break;case"noise":var a=Object.values(cj)[this.noiseFunctionIndex.value],o=new mA("vec3 orthogonal(vec3 v) {\n\t\t\t\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t\t\t\t}"),s=new mA("vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement) {\n\t\t\t\t\t\t\treturn p + n * ".concat(a,"((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;\n\t\t\t\t\t\t}"),[lj.simplex,lj.simplexFractal,lj.simplexAshima,lj.fbm,lj.perlin]),u=new mA("vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, float intensity, out vec3 displaced_normal) {\n\t\t\t\t\t\t\tvec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement);\n\t\t\t\t\t\t\tvec3 tangent1 = orthogonal(normal);\n\t\t\t\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\n                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.\n                            // This caused some small oval/circular visual artifacts in the lighting.\n                            // For now, simply using neighbors further away betters the problem,\n                            // but we should figure out the underlying cause when we have some time.\n                            // Maybe its related to how we calculate the tangent and bitangent?\n\t\t\t\t\t\t\tvec3 nearby1 = position + tangent1;\n\t\t\t\t\t\t\tvec3 nearby2 = position + tangent2;\n\t\t\t\t\t\t\tvec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement);\n\t\t\t\t\t\t\tvec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement);\n\t\t\t\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\t\t\t\treturn displaced_position;\n\t\t\t\t\t\t}",[s,o]);r=e.include(u),i.push(this.scale.build(e,"f")),i.push(this.cropOrOffset.build(e,"v3")),i.push(this.movementOrTexture.build(e,"f"))}return i.push(this.intensity.build(e,"f")),i.push("displaced_normal"),e.format(r+"("+i.join(",")+")",this.getType(e),t)}return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}}]),n}(uA),Sj=_j;Sj.Nodes=function(){var e=new mA("vec3 orthogonal(vec3 v) {\n\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t}"),t=new mA("float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {\n\t\t\t\tvec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;\n\t\t\t\tvec4 tmp = texture2D(tex, uvs);\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tif (crop > 0.5) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\treturn 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn col.r;\n\t\t\t}");return{map:new mA("vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {\n\t\t\t\tvec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;\n\t\t\t\tvec3 tangent1 = normalize(orthogonal(normal));\n\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\t\t\t\tvec3 nearby1 = position + tangent1 * 0.1;\n\t\t\t\tvec3 nearby2 = position + tangent2 * 0.1;\n\t\t\t\tvec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tvec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\treturn displaced_position;\n\t\t\t}",[e,t])}}();var Ej=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o,s,u,c){var l;return Object(E.a)(this,n),(l=t.call(this,"v3")).nodeType="Gradient",l.gradientType=e,l.smooth=r,l.colors=i,l.steps=a,l.offset=o,l.morph=s,l.angle=u,l.alpha=c,l.calpha="g".concat(l.uuid.toString().replace(/-/g,""),"_calpha"),l}return Object(A.a)(n,[{key:"generate",value:function(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");var r=e.include(n.Nodes.gradient),i=[];return i.push(this.gradientType.build(e,"i")),i.push(this.smooth.build(e,"b")),i.push(this.colors.build(e,"v4[]")),i.push(this.steps.build(e,"f[]")),i.push(this.offset.build(e,"v2")),i.push(this.morph.build(e,"v2")),i.push(this.angle.build(e,"f")),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(r+"("+i.join(",")+")",this.getType(e),t)}return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}}]),n}(uA),Aj=Ej;Aj.Nodes={gradient:new mA("vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, float alpha, out float calpha) {\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tvec2 m = morph / vUv.xy;\n\t\t\t\tvec2 rot = vec2( 0.5 + m.x, m.y );\n\t\t\t\tvec2 dt = vec2(\n\t\t\t\t\tcos( angle ) * rot.x - sin( angle ) * rot.y,\n\t\t\t\t\tsin( angle ) * rot.x + cos( angle ) * rot.y\n\t\t\t\t);\n\t\t\t\tvec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;\n\t\t\t\tfloat t = dot( pt, dt ) / dot( dt, dt );\n\t\t\t\tif ( gradientType == 1 ) {\n\t\t\t\t\tt = distance (\n\t\t\t\t\t\t( vUv + morph ) * 3.0,\n\t\t\t\t\t\t( vUv + offset ) + 1.0\n\t\t\t\t\t) + angle;\n\t\t\t\t} else if ( gradientType == 2 ) {\n\t\t\t\t\tfloat polar = atan(\n\t\t\t\t\t\tvUv.x + morph.x - 0.5 + offset.x,\n\t\t\t\t\t\tvUv.y + morph.y - 0.5 + offset.y\n\t\t\t\t\t) * -1.0;\n\t\t\t\t\tt = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );\n\t\t\t\t}\n\n\t\t\t\tfloat p;\n\t\t\t\tif (smoothed) {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfloat lalpha = alpha * color.a;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\n\t\t\t\treturn color.xyz;\n\t\t\t}")};var jj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o,s,u,c,l,h){var d;return Object(E.a)(this,n),(d=t.call(this,"v3")).nodeType="CustomTexture",d.firstTime=!0,d.texture=e,d.textureSize=r,d.crop=i,d.projection=a,d.axis=o,d.side=s,d.size=u,d.mat=c,d.alpha=l,d.mode=h,d.calpha="g".concat(d.uuid.toString().replace(/-/g,""),"_calpha"),d}return Object(A.a)(n,[{key:"generate",value:function(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;var r,i="g".concat(this.uuid.toString().replace(/-/g,""));switch(this.projection.value){case 3:r=e.include(n.Nodes.cylindrical);break;case 2:r=e.include(n.Nodes.spherical);break;case 1:var a=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],o=new mA("\n\t\tvec3 ".concat(i,"_planarTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {\n\n\t\t\t\tvec2 uvs = ( mat * vec3( (").concat(i,"_vCustomUv * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\t").concat(2===this.side.value?"":"lalpha *= step(0.0, ".concat(1===this.side.value?"-1.0 * ":"","dot(vObjectNormal, mat * ").concat(a,"));"),"\n\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\treturn col;\n\t\t\t}"));r=e.include(o);break;default:r=e.include(n.Nodes.uv)}if(1===this.projection.value&&this.firstTime){e.addVertexParsCode("varying vec2 ".concat(i,"_vCustomUv;")),e.addFragmentParsCode("varying vec2 ".concat(i,"_vCustomUv;"));var s=["zy","xz","xy"][this.axis.value];e.addVertexFinalCode("".concat(i,"_vCustomUv = (1. + (transformed.").concat(s,")) / 2.;"))}e.addFragmentVariable(this.calpha,"float");var u=[];return u.push(this.texture.generate(e,"t")),u.push(this.textureSize.build(e,"v2")),u.push(this.crop.build(e,"f")),u.push(this.mat.build(e,"mat3")),u.push(this.size.build(e,"v2")),u.push(this.alpha.build(e,"f")),u.push(this.mode.build(e,"i")),u.push(this.calpha),this.firstTime=!this.firstTime,e.format(r+"("+u.join(",")+")",this.getType(e),t)}}]),n}(uA),Tj=jj;Tj.Nodes={cylindrical:new mA("\nvec3 cylindricalTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {\n                vec3 posN = normalize(position);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float scaledHeight = position.y / (size.y * 0.5);\n                float v =  (scaledHeight / 2.) + .5;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\treturn col;\n\t\t\t}\n"),spherical:new mA("\nvec3 sphericalTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {\n                vec3 posN = normalize(vPosition);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float v = 0.5 + asin(posN.y) / 3.1415;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\treturn col;\n\t\t\t}\n"),uv:new mA("vec3 uvTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {\n\n\t\t\t\tvec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\treturn col;\n\t\t\t}")};var Mj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;return Object(E.a)(this,n),(i=t.call(this,"v3")).nodeType="CustomNormal",i.cnormal=e,i.alpha=r,i}return Object(A.a)(n,[{key:"generate",value:function(e,t){if(e.isShader("fragment")){var r=e.include(n.Nodes.customNormal),i=[];return i.push(this.cnormal.build(e,"v3")),i.push("normal"),i.push(this.alpha.build(e,"f")),e.format(r+"("+i.join(",")+")",this.getType(e),t)}return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}}]),n}(uA),Cj=Mj;function Dj(e,t){return t.color(e)}function Ij(e,t){switch(e.type){case"fresnel":return function(e,t){var n=e.bias,r=e.scale,i=e.intensity,a=e.factor,o=e.color;return Object(p.a)(Object(p.a)({},Pj(e)),{},{color:Dj(o,t),bias:n,scale:r,intensity:i,factor:a})}(e,t);case"gradient":return function(e){var t=e.gradientType,n=e.smooth,r=e.colors,i=e.steps,a=e.angle,o=e.offset,s=e.morph;return Object(p.a)(Object(p.a)({},Pj(e)),{},{gradientType:t,smooth:n,colors:r.map((function(e){return new Qn(e[0],e[1],e[2],e[3])})),num:r.length,steps:i,offset:Object(l.a)(An,Object(v.a)(o)),morph:Object(l.a)(An,Object(v.a)(s)),angle:a})}(e);case"depth":return function(e){var t=e.gradientType,n=e.near,r=e.far,i=e.isVector,a=e.isWorldSpace,o=e.origin,s=e.direction,u=e.colors,c=e.steps,h=e.smooth;return Object(p.a)(Object(p.a)({},Pj(e)),{},{gradientType:t,near:n,far:r,isVector:i,isWorldSpace:a,origin:Object(l.a)(tr,Object(v.a)(o)),direction:s?Object(l.a)(tr,Object(v.a)(s)):new tr(1,0,0),colors:u.map((function(e){return void 0!==e?new Qn(e[0],e[1],e[2],e[3]):new Qn(0,0,0,0)})),steps:c.slice(0,u.length),smooth:h})}(e);case"normal":return function(e){var t=e.cnormal;return Object(p.a)(Object(p.a)({},Pj(e)),{},{cnormal:new tr(t[0],t[1],t[2])})}(e);case"noise":return function(e,t){return Object(p.a)(Object(p.a)({},Pj(e)),{},{scale:e.scale,move:e.move,fA:Object(l.a)(An,Object(v.a)(e.fA)),fB:Object(l.a)(An,Object(v.a)(e.fB)),size:Object(l.a)(tr,Object(v.a)(e.size)),distortion:Object(l.a)(An,Object(v.a)(e.distortion)),colorA:Dj(e.colorA,t),colorB:Dj(e.colorB,t),colorC:Dj(e.colorC,t),colorD:Dj(e.colorD,t),noiseType:e.noiseType})}(e,t);case"rainbow":return function(e){return Object(p.a)(Object(p.a)({},Pj(e)),{},{filmThickness:e.filmThickness,movement:e.movement,wavelengths:Object(l.a)(tr,Object(v.a)(e.wavelengths)),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:Object(l.a)(tr,Object(v.a)(e.offset))})}(e);case"toon":return function(e,t){return Object(p.a)(Object(p.a)({},Pj(e)),{},{positioning:e.positioning,colors:e.colors.map((function(e){return new Qn(e[0],e[1],e[2],e[3])})),num:e.colors.length,steps:e.steps,source:Object(l.a)(tr,Object(v.a)(e.source)),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:Dj(e.shadowColor,t),offset:Object(l.a)(tr,Object(v.a)(e.offset))})}(e,t);case"outline":return function(e,t){return Object(p.a)(Object(p.a)({},Pj(e)),{},{outlineColor:Dj(e.outlineColor,t),contourColor:Dj(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:Object(l.a)(tr,Object(v.a)(e.contourDirection)),positionalLines:e.positionalLines,compensation:e.compensation})}(e,t);case"transmission":return function(e,t){return Object(p.a)(Object(p.a)({},Pj(e)),{},{thickness:e.thickness,ior:e.ior,roughness:e.roughness})}(e);case"color":return function(e,t){return Object(p.a)(Object(p.a)({},Pj(e)),{},{color:Dj(e.color,t)})}(e,t)}}function Pj(e){var t=e.alpha,n=e.mode;return Object(p.a)(Object(p.a)({},function(e){return{type:e.type}}(e)),{},{alpha:t,mode:n})}Cj.Nodes={customNormal:new mA("vec3 customNormal(vec3 cnormal, vec3 norm, float alpha) {\n\t\t\t\tvec3 normal = packNormalToRGB( norm ).rgb;\n\t\t\t\tnormal *= step( vec3(0.5), cnormal );\n\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * alpha;\n\n\t\t\t\treturn normal;\n\t\t\t}")};var Rj,Lj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n)}(dA),Nj=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;Object(E.a)(this,e),this.timeout=t,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}return Object(A.a)(e,[{key:"log",value:function(){}},{key:"remove",value:function(e){var t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}},{key:"scheduleCleanup",value:function(){var e=this;this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout((function(){e.hasClean=!1,e.log("cleaning");for(var t=Date.now(),n=e.head.next;n.time<t-e.timeout;)e.dispose(n.src,n.data),e.cache.delete(n.src),(n=n.next).prev=e.head,e.head.next=n;e.head.next!==e.tail?e.scheduleCleanup():e.log("no more cleanup")}),this.timeout+1e3))}},{key:"has",value:function(e){var t;return null===(t=this.cache.get(e))||void 0===t?void 0:t.data}},{key:"load",value:function(e){var t=Date.now(),n=this.cache.get(e);return void 0===n?(n={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,n)):(n.time=t,n.prev.next=n.next,n.next.prev=n.prev),n.prev=this.tail.prev,n.next=this.tail,this.tail.prev.next=n,this.tail.prev=n,this.scheduleCleanup(),n.data}}]),e}(),Bj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n,[{key:"create",value:function(e){return URL.createObjectURL(new Blob([e]))}},{key:"dispose",value:function(e,t){URL.revokeObjectURL(t)}}]),n}(Nj);function Fj(e){return"string"==typeof e?e:(Rj||(Rj=new Bj),Rj.load(e))}var Uj=function(){function e(t,n){Object(E.a)(this,e),this.data=t,this.cache=n,this.refCount=0}return Object(A.a)(e,[{key:"deref",value:function(){this.refCount,this.refCount-=1,0===this.refCount&&(this.cache.remove(this),this.dispose())}},{key:"dispose",value:function(){this.refCount,0}}]),e}(),zj=function(){function e(){Object(E.a)(this,e),this.cache=new Map}return Object(A.a)(e,[{key:"remove",value:function(e){this.cache.delete(e.data),0}},{key:"load",value:function(e){var t=this.cache.get(e);return void 0===t&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}}]),e}(),Vj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;return Object(E.a)(this,n),(i=t.call(this,e,r.imageHolderCache)).data=e,i.shared=r,i.loaded=!1,i.isVideo=!1,i.isVideo="video"==e.type,i.updateSrc(e.data),i}return Object(A.a)(n,[{key:"updateSrc",value:function(){var e=Object(m.a)(Object(S.a)().mark((function e(t){var n,r,i,a=this;return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(typeof document>"u")){e.next=2;break}return e.abrupt("return");case 2:if(this.disposeTextures(),this.loaded=!1,n=function(){a.loaded=!0;for(var e=0,t=[1e3,1001,1002];e<t.length;e++){var n=a[t[e]];n&&(n.image=a.img,n.needsUpdate=!0)}a.shared.requestRender()},!this.isVideo){e.next=17;break}if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,"string"==typeof t){e.next=13;break}return(r=new FileReader).readAsDataURL(new Blob([t],{type:"video/mp4"})),e.next=10,new Promise((function(e){r.onloadend=function(t){var n;i=null===(n=t.target)||void 0===n?void 0:n.result,e(null)}}));case 10:this.img.src=i,e.next=14;break;case 13:this.img.src=t;case 14:this.img.onloadeddata=function(){n()},e.next=18;break;case 17:this.img=new Image,this.img.src=Fj(t),this.img.onload=n;case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTexture",value:function(e){var t,n=this[e];return n||(t=this.isVideo?new bu(this.img,void 0,e,e):new Kn(this.img,void 0,e,e),this.loaded&&(t.needsUpdate=!0),this[e]=t,t)}},{key:"disposeTextures",value:function(){var e,t,n;null!==(e=this[1e3])&&void 0!==e&&e.dispose(),this[1e3]=void 0,null!==(t=this[1001])&&void 0!==t&&t.dispose(),this[1001]=void 0,null!==(n=this[1002])&&void 0!==n&&n.dispose(),this[1002]=void 0}},{key:"dispose",value:function(){Object(b.a)(Object(w.a)(n.prototype),"dispose",this).call(this),this.disposeTextures()}}]),n}(Uj),Gj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n)}(Vj),Hj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n)}(cA),Wj={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],depth:["smooth","isWorldSpace","gradientType","isVector"]},qj={depth:["colors"]};function Yj(e,t,n){var r=Wj[e.type],i=qj[e.type];if(void 0!==i){var a=e.color;if(i.includes(t)){var o,s,u=null===(o=a[t])||void 0===o||null===(s=o.value)||void 0===s?void 0:s.length;if(void 0!==u&&u!==n.length)return!0}}return void 0!==r&&r.includes(t)}function Xj(e,t,n){var r=n.uniforms["f".concat(n.id,"_texture")];if(!r)return!1;var i=e;if("image"in i){var a=i.image,o=t.image(a),s=r;s.image instanceof Gj||s.image.deref(),s.image=o}if("video"in i){var u=i.video,c=t.video(u),l=r;l.image instanceof Gj||l.image.deref(),l.image=c}"wrapping"in i&&(r.wrap=i.wrapping);if("repeat"in i||"offset"in i){var h=n.uniforms["f".concat(n.id,"_").concat("mat")];"repeat"in i&&(h.repeat=i.repeat),"offset"in i&&(h.offset=i.offset),h.updateMatrix()}return!1}var Kj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;return Object(E.a)(this,n),(a=t.call(this,"v3")).nodeType="Matcap",a.texture=e,a.alpha=r,a.mode=i,a.calpha="g".concat(a.uuid.toString().replace(/-/g,""),"_calpha"),a}return Object(A.a)(n,[{key:"generate",value:function(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");var r=e.include(n.Nodes.matcap);e.require("normal"),e.requires.normal=!0;var i=[];return i.push(this.texture.generate(e,"t")),i.push("normal"),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),i.push(this.calpha),e.format(r+"("+i.join(",")+")",this.getType(e),t)}return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}}]),n}(uA),Qj=Kj;Qj.Nodes={matcap:new mA("vec3 matcap(sampler2D matcapTex, vec3 normal, float alpha, int mode, out float calpha) {\n                vec3 viewDir = normalize( vViewPosition );\n                vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n                vec3 y = cross( viewDir, x );\n                vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n                vec4 matcapColor = texture2D( matcapTex, uv );\n\n                calpha =  alpha / clamp( alpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * alpha;\n                \n                return matcapColor.rgb;\n            }\n            ")};var Zj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;return Object(E.a)(this,n),(i=t.call(this,"t")).image=e,i.wrap=r,i}return Object(A.a)(n,[{key:"value",get:function(){return this.image.getTexture(this.wrap)}}]),n}(Hj),Jj=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,"v3")).image=e,r._value=new tr,r}return Object(A.a)(n,[{key:"value",get:function(){var e,t;return this._value.x=this.image.isVideo?null!==(e=this.image.img.videoWidth)&&void 0!==e?e:0:this.image.img.width,this._value.y=this.image.isVideo?null!==(t=this.image.img.videoHeight)&&void 0!==t?t:0:this.image.img.height,this._value}}]),n}(Hj),$j=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o,s,u,c,l,h){var d;return Object(E.a)(this,n),(d=t.call(this,"v3")).nodeType="Toon",d.positioning=e,d.colors=r,d.steps=i,d.source=a,d.isWorldSpace=o,d.noiseStrength=s,d.noiseScale=u,d.shadowColor=c,d.offset=l,d.alpha=h,d.calpha="g".concat(d.uuid.toString().replace(/-/g,""),"_calpha"),d}return Object(A.a)(n,[{key:"generate",value:function(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");var r=e.include(n.Nodes.toon),i=[];return i.push(this.positioning.build(e,"i")),i.push(this.colors.build(e,"v4[]")),i.push(this.steps.build(e,"f[]")),i.push(this.source.build(e,"v3")),i.push(this.isWorldSpace.build(e,"b")),i.push(this.noiseStrength.build(e,"f")),i.push(this.noiseScale.build(e,"f")),i.push(this.shadowColor.build(e,"v4")),i.push(this.offset.build(e,"v3")),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(r+"("+i.join(",")+")",this.getType(e),t)}return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}}]),n}(uA),eT=$j;function tT(e,t,n){e.setUvTransform(n[0],n[1],t[0],t[1],0,0,0)}eT.Nodes=function(){var e=new mA("float rand(float n) {\n\t\t\t\treturn fract(sin(n) * 43758.5453123);\n\t\t\t}"),t=new mA("float hash1(float p) { \n\t\t\t\tp = fract(p * 0.011); \n\t\t\t\tp *= p + 7.5; \n\t\t\t\tp *= p + p; \n\t\t\t\treturn fract(p); \n\t\t\t}"),n=new mA("float valueNoise(vec3 x) {\n\t\t\t\tconst vec3 step = vec3(110, 241, 171);\n\t\t\t\n\t\t\t\tvec3 i = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\t\t\t \n\t\t\t\t// For performance, compute the base input to a 1D hash from the integer part of the argument and the \n\t\t\t\t// incremental change to the 1D based on the 3D -> 1D wrapping\n\t\t\t\tfloat n = dot(i, step);\n\t\t\t\n\t\t\t\tvec3 u = f * f * (3.0 - 2.0 * f);\n\t\t\t\treturn mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),\n\t\t\t\t\t\t   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);\n\t\t\t}",[t]),r=new mA("vec3 hash3(vec3 x) {\n\t\t\t\tx = vec3(dot(x,vec3(127.1, 311.7, 74.7)),\n\t\t\t\t\t\t dot(x,vec3(269.5, 183.3, 246.1)),\n\t\t\t\t\t\t dot(x,vec3(113.5, 271.9, 124.6)));\n\t\t\t\n\t\t\t\treturn fract(sin(x)*43758.5453123);\n\t\t\t}"),i=new mA('vec3 voronoiNoise(in vec3 x)\n\t\t\t{\n\t\t\t\tvec3 p = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\n\t\t\t\tfloat id = 0.0;\n\t\t\t\tvec2 res = vec2(100.0);\n\n\t\t\t\tfor(int k=-1; k<=1; k++)\n\t\t\t\tfor(int j=-1; j<=1; j++)\n\t\t\t\tfor(int i=-1; i<=1; i++)\n\t\t\t\t{\n\t\t\t\t\tvec3 b = vec3(float(i), float(j), float(k));\n\n\t\t\t\t\t// Comment out the "+ hash(p + b);" part below to get "square" cells\n\t\t\t\t\tvec3 r = vec3(b) - f + hash3(p + b);\n\t\t\t\t\tfloat d = dot(r, r);\n\n\t\t\t\t\tif (d < res.x)\n\t\t\t\t\t{\n\t\t\t\t\t\tid = dot(p + b, vec3(1.0, 57.0, 113.0));\n\t\t\t\t\t\tres = vec2(d, res.x);\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\telse if (d < res.y)\n\t\t\t\t\t{\n\t\t\t\t\t\tres.y = d;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn vec3(sqrt(res), abs(id));\n\t\t\t}\n\t\t\t',[r]);return{toon:new mA('vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float alpha, out float calpha) {\n\t\t\t\tfloat t = 0.0;\n\t\t\t\tfloat shadow = 1.0;\n\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\t// Can\'t do this mode if lighting is "none"\n\t\t\t\t\t#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))\n\n\t\t\t\t\t\t// Algorithm from Chapter 10 of Graphics Shaders\n\t\t\t\t\t\tconst vec3 weights = vec3(0.2125, 0.7154, 0.0721);\n\t\t\t\t\t\tvec3 lpos;\n\t\t\t\t\t\tvec3 l;\n\t\t\t\t\t\tfloat dproduct;\n\n\t\t\t\t\t\t#if (NUM_POINT_LIGHTS > 0)\n\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tPointLightShadow pointLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Light positions are in view-space for some reason?\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// TODO: we want to use "intensity" but it isn\'t available in the shader code\n\t\t\t\t\t\t\t\t//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);\n\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tpointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getPointShadow( \n\t\t\t\t\t\t\t\t\t\t\tpointShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowRadius,\n\t\t\t\t\t\t\t\t\t\t\tvPointShadowCoord[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraNear, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraFar);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_DIR_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tDirectionalLightShadow directionalLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Use the direction vector for directional lights instead\n\t\t\t\t\t\t\t\tl = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;\n\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tdirectionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow( \n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tdirectionalShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tSpotLightShadow spotLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tspotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow(\n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tspotShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvSpotShadowCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\tt = clamp(t, 0.0, 1.0);\n\t\t\t\t\n\t\t\t\t\t#endif\n\n\t\t\t\t} else if (positioning == 1) {\n\t\t\t\t\t\n\t\t\t\t\tvec3 origin = mix(position, worldPosition, float(isWorldSpace));\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\n\t\t\t\t} else {\n\n\t\t\t\t\tvec3 origin = worldPosition;\n\t\t\t\t\tvec3 source = cameraPosition - offset;\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\tif (noiseStrength > 0.0) {\n\t\t\t\t\t// Distort with noise\n\t\t\t\t\tvec3 st = position / noiseScale;\n\t\t\t\t\t\n\t\t\t\t\t// Voronoi "smooth" noise\n\t\t\t\t\tfloat noise = 1.0 - voronoiNoise(st).x;\n\n\t\t\t\t\t// Voronoi cellular noise\n\t\t\t\t\t//float noise = 1.0 - rand(voronoiNoise(st).z);\n\n\t\t\t\t\t// Position warp noise\n\t\t\t\t\t// vec3 offset = vec3(\n\t\t\t\t\t// \tsimplex3d(st),\n\t\t\t\t\t// \tsimplex3d(st + vec3(111.1, 143.89, 217.19)),\n\t\t\t\t\t// \tsimplex3d(st + vec3(171.1, 247.89, 117.23))\n\t\t\t\t\t// );\n\t\t\t\t\t// st += offset;\n\t\t\t\t\t// float noise = valueNoise(st);\n\n\t\t\t\t\tt += noise * noiseStrength;\n\t\t\t\t}\n\n\t\t\t\tt = clamp(t, 0.0, 1.0);\n\n\t\t\t\t// Compute ramp color\n\t\t\t\tfloat p;\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tfor (int i = 1; i < COLORS_MAX; i++) {\n\t\t\t\t\tp = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);\n\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t}\n\n\t\t\t\t// Incorporate custom shadow color\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\tvec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);\n\t\t\t\t\tcolor.rgb = mix(blendedShadow, color.rgb, shadow);\n\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\t// Accumulate alpha as usual\n\t\t\t\tfloat lalpha = alpha * color.a;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color.xyz;\n\n            }',[lj.simplex,e,n,i])}}();var nT=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;return Object(E.a)(this,n),(i=t.call(this,new jn)).repeat=e,i.offset=r,tT(i.value,e,r),i}return Object(A.a)(n,[{key:"updateMatrix",value:function(){tT(this.value,this.repeat,this.offset)}}]),n}(sj),rT=function(){function e(t,n,r,i){for(var a in Object(E.a)(this,e),this.id=t,this.uuid=n,this.data=r,this.uniforms={},i)this.uniforms["f".concat(this.id,"_").concat(a)]=i[a];for(var o in r)uT(o,this,r)}return Object(A.a)(e,[{key:"type",get:function(){return this.data.type}},{key:"updateByOp",value:function(e,t,n){var r,i=e;if(void 0===i.path[0]){if(0===i.type)return"type"in i.props||"category"in i.props?(null!==(r=n.scene)&&void 0!==r&&r.markNeedsUpdateRendererDirty(),!0):function(e,t,n,r){for(var i=!1,a=0,o=Object.entries(e);a<o.length;a++){var s=Object(g.a)(o[a],2),u=s[0],c=s[1];if(u&&void 0!==c)if(uT(u,n,r))"visible"===u&&"light"===n.type&&(i=!0);else{n.visible=r.visible;var h=n.uniforms["f".concat(n.id,"_").concat(u)];if(h&&!(h instanceof Hj))switch(i=i||Yj(n,u,c),h.constructor){case KA:if("string"==typeof c){var d=t.getColor(c);d&&(h.value=d);break}var f=c;h.value instanceof Lj?h.value=new dA(f.r,f.g,f.b,f.a):h.setRGBA(f);break;case fA:if("string"==typeof c){var p=t.getColor(c);p&&(h.value=p);break}var m=c;h.value instanceof Lj?h.value=new dA(m.r,m.g,m.b,m.a):h.value.setRGBA(m.r,m.g,m.b,m.a);break;case lA:var y=c;h.value.setX(y[0]),h.value.setY(y[1]);break;case hA:var b=c;h.value.setX(b[0]),h.value.setY(b[1]),h.value.setZ(b[2]);break;case AA:Xj(c,t,n);break;case uj:h.value=c.map((function(e){return Object(l.a)(Qn,Object(v.a)(e))}));break;default:h.value=c}}}return i}(i.props,n.shared,this,t)}else if("texture"===i.path[0])return!("texture"in t)&&!("video"in t)||Xj(i.props,n.shared,this);return!1}},{key:"dispose",value:function(){if(sT(this)){var e=this.uniforms["f".concat(this.id,"_texture")];if(!e)return!1;var t=e;t.image instanceof Gj||t.image.deref()}}},{key:"hasValueByKey",value:function(e){return void 0!==this.uniforms[e]}},{key:"hasValue",value:function(e){return this.hasValueByKey("f".concat(this.id,"_").concat(e))}},{key:"setValue",value:function(e,t){var n="f".concat(this.id,"_").concat(e);this.hasValueByKey(n)&&void 0!==t&&(this.uniforms[n].value=t)}},{key:"getNode",value:function(e){var t="f".concat(this.id,"_").concat(e);if(this.hasValueByKey(t))return this.uniforms[t]}},{key:"getValue",value:function(e){var t="f".concat(this.id,"_").concat(e);if(this.hasValueByKey(t))return this.uniforms[t].value}},{key:"getName",value:function(e){var t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log("Layer.getName: error ".concat(e))}},{key:"getNames",value:function(){var e=[];for(var t in this.uniforms){var n=this.getName(t);n&&e.push(n)}return e}}],[{key:"create",value:function(e,t,n,r){if("light"===n.type)return oT.createLigherLayer(e,t,n,r);if("texture"===n.type||"video"===n.type){var i,a,o,s,u,c="texture"===n.type?r.image(n.texture.image):r.video(n.texture.video),h=new Zj(c,n.texture.wrapping),d=new Jj(c),f=new nT(n.texture.repeat,n.texture.offset),p=new jA(n.crop?1:0),m=new QA(null!==(i=n.projection)&&void 0!==i?i:0),g=new QA(null!==(a=["x","y","z"].indexOf(n.axis))&&void 0!==a?a:0),y=new QA(null!==(o=n.side)&&void 0!==o?o:0),b=new lA(n.size?new An(n.size[0],n.size[1]):new An(100,100)),w=new jA(null!==(s=n.alpha)&&void 0!==s?s:1),x=new QA(null!==(u=n.mode)&&void 0!==u?u:0),O=new Tj(h,d,p,m,g,y,b,f,w,x),k=new EA(O.calpha,"f");return new iT(e,t,n,{texture:h,textureSize:d,crop:p,projection:m,axis:g,side:y,size:b,mat:f,alpha:w,mode:x},O,x,k)}if("matcap"===n.type){var _,S,E=r.image(n.texture.image),A=new Zj(E,n.texture.wrapping),j=new jA(null!==(_=n.alpha)&&void 0!==_?_:1),T=new QA(null!==(S=n.mode)&&void 0!==S?S:0),M=new Qj(A,j,T),C=new EA(M.calpha,"f");return new iT(e,t,n,{texture:A,alpha:j,mode:T},M,T,C)}if("displace"===n.type){if("noise"===n.displacementType){var D,I,P,R,L=new hA(Object(l.a)(tr,Object(v.a)(n.offset))),N=new jA(null!==(D=n.scale)&&void 0!==D?D:10),B=new jA(null!==(I=n.intensity)&&void 0!==I?I:8),F=new jA(null!==(P=n.movement)&&void 0!==P?P:1),U=new QA(null!==(R=n.noiseType)&&void 0!==R?R:0),z=new Sj(B,F,L,N,U);return new aT(e,t,n,{offset:L,scale:N,intensity:B,movement:F,noiseType:U},z)}throw new Error}return function(e,t,n,r){var i=Ij(n,r);return function(e,t,n,r){switch(e.type){case"color":var i,a,o,s=new KA(null!==(i=r.color)&&void 0!==i?i:5855577),u=new jA(null!==(a=r.alpha)&&void 0!==a?a:1),c=new EA("alpha / clamp(alpha + accumAlpha, 0.00001, 1.0 )","f");c.keywords.alpha=u;var l=new QA(null!==(o=r.mode)&&void 0!==o?o:0);return s.alpha=u,new iT(t,n,e,{color:s,alpha:u,mode:l},s,l,c);case"fresnel":var h,d,f,p,v,m,g,y=new KA(null!==(h=r.color)&&void 0!==h?h:16777215),b=new jA(null!==(d=r.bias)&&void 0!==d?d:.1),w=new jA(null!==(f=r.scale)&&void 0!==f?f:1),x=new jA(null!==(p=r.intensity)&&void 0!==p?p:2),O=new jA(null!==(v=r.factor)&&void 0!==v?v:1),k=new jA(null!==(m=r.alpha)&&void 0!==m?m:1),_=new QA(null!==(g=r.mode)&&void 0!==g?g:0),S=new fj(y,b,w,x,O,k,_),E=new EA(S.calpha,"f");return new iT(t,n,e,{color:y,bias:b,scale:w,intensity:x,factor:O,alpha:k,mode:_},S,_,E);case"rainbow":var A,j,T,M,C,D,I,P,R=new jA(null!==(A=r.filmThickness)&&void 0!==A?A:30),L=new jA(null!==(j=r.movement)&&void 0!==j?j:0),N=new hA(null!==(T=r.wavelengths)&&void 0!==T?T:new tr(0,0,0)),B=new jA(null!==(M=r.noiseStrength)&&void 0!==M?M:0),F=new jA(null!==(C=r.noiseScale)&&void 0!==C?C:1),U=new hA(null!==(D=r.offset)&&void 0!==D?D:new tr(0,0,0)),z=new jA(null!==(I=r.alpha)&&void 0!==I?I:1),V=new vj(R,L,N,B,F,U,z),G=new EA(V.calpha,"f"),H=new QA(null!==(P=r.mode)&&void 0!==P?P:0);return new iT(t,n,e,{filmThickness:R,movement:L,wavelengths:N,noiseStrength:B,noiseScale:F,offset:U,alpha:z,mode:H},V,H,G);case"transmission":var W,q,Y,X,K,Q=new jA(null!==(W=r.thickness)&&void 0!==W?W:10),Z=new jA(null!==(q=r.ior)&&void 0!==q?q:1.5),J=new jA(null!==(Y=r.roughness)&&void 0!==Y?Y:.5),$=$A.transmissionSize,ee=$A.transmissionRenderTarget,te=$A.transmissionRenderTargetDepth,ne=window.innerWidth,re=window.innerHeight,ie=ne>=re?new lA(re/ne,1):new lA(1,ne/re),ae=new jA(null!==(X=r.alpha)&&void 0!==X?X:1),oe=new bj(Q,Z,J,$,ee,te,ie,ae),se=new EA(oe.calpha,"f"),ue=new QA(null!==(K=r.mode)&&void 0!==K?K:0);return new iT(t,n,e,{thickness:Q,ior:Z,roughness:J,aspectRatio:ie,alpha:ae,mode:ue},oe,ue,se);case"toon":var ce,le,he,de,fe,pe,ve,me,ge,ye,be=new QA(null!==(ce=r.positioning)&&void 0!==ce?ce:0);r.colors?ge=new uj(r.colors.length,r.colors):(ge=new uj(10,new Qn(0,0,0,1))).value[1]=new Qn(1,1,1,1),r.steps?ye=new JA(r.steps.length,r.steps):(ye=new JA(10,1)).value[0]=0;var we=new hA(null!==(le=r.source)&&void 0!==le?le:new tr(0,0,0)),xe=new oj(null===(he=r.isWorldSpace)||void 0===he||he),Oe=new jA(null!==(de=r.noiseStrength)&&void 0!==de?de:0),ke=new jA(null!==(fe=r.noiseScale)&&void 0!==fe?fe:1),_e=new fA(r.shadowColor),Se=new hA(null!==(pe=r.offset)&&void 0!==pe?pe:new tr(0,0,0)),Ee=new jA(null!==(ve=r.alpha)&&void 0!==ve?ve:1),Ae=new eT(be,ge,ye,we,xe,Oe,ke,_e,Se,Ee),je=new EA(Ae.calpha,"f"),Te=new QA(null!==(me=r.mode)&&void 0!==me?me:0);return new iT(t,n,e,{positioning:be,colors:ge,steps:ye,source:we,isWorldSpace:xe,noiseStrength:Oe,noiseScale:ke,shadowColor:_e,offset:Se,alpha:Ee,mode:Te},Ae,Te,je);case"outline":var Me,Ce,De,Ie,Pe,Re,Le,Ne,Be,Fe,Ue,ze,Ve,Ge=new KA(null!==(Me=r.outlineColor)&&void 0!==Me?Me:16777215),He=new KA(null!==(Ce=r.contourColor)&&void 0!==Ce?Ce:16777215),We=new jA(null!==(De=r.outlineWidth)&&void 0!==De?De:.1),qe=new jA(null!==(Ie=r.contourWidth)&&void 0!==Ie?Ie:.1),Ye=new jA(null!==(Pe=r.outlineThreshold)&&void 0!==Pe?Pe:.1),Xe=new jA(null!==(Re=r.contourThreshold)&&void 0!==Re?Re:.1),Ke=new jA(null!==(Le=r.outlineSmoothing)&&void 0!==Le?Le:.1),Qe=new jA(null!==(Ne=r.contourFrequency)&&void 0!==Ne?Ne:.1),Ze=new hA(null!==(Be=r.contourDirection)&&void 0!==Be?Be:new tr(0,1,0)),Je=new oj(null!==(Fe=r.positionalLines)&&void 0!==Fe&&Fe),$e=new oj(null===(Ue=r.compensation)||void 0===Ue||Ue),et=$A.normalRenderTarget,tt=$A.normalRenderTargetDepth,nt=$A.pixelRatioNode,rt=$A.resolution,it=new jA(null!==(ze=r.alpha)&&void 0!==ze?ze:1),at=new gj(Ge,He,We,qe,Ye,Xe,Ke,Qe,Ze,Je,$e,rt,et,tt,nt,it),ot=new EA(at.calpha,"f"),st=new QA(null!==(Ve=r.mode)&&void 0!==Ve?Ve:0);return new iT(t,n,e,{outlineColor:Ge,contourColor:He,outlineWidth:We,contourWidth:qe,outlineThreshold:Ye,contourThreshold:Xe,outlineSmoothing:Ke,contourFrequency:Qe,contourDirection:Ze,positionalLines:Je,compensation:$e,alpha:it,mode:st},at,st,ot);case"depth":var ut,ct,lt,ht,dt,ft,pt,vt,mt,gt,yt,bt,wt=new QA(null!==(ut=r.gradientType)&&void 0!==ut?ut:0),xt=new oj(null!==(ct=r.smooth)&&void 0!==ct&&ct),Ot=new jA(null!==(lt=r.near)&&void 0!==lt?lt:50),kt=new jA(null!==(ht=r.far)&&void 0!==ht?ht:200),_t=new jA(null!==(dt=r.isVector)&&void 0!==dt?dt:1),St=new jA(null!==(ft=r.isWorldSpace)&&void 0!==ft?ft:0),Et=new hA(null!==(pt=r.origin)&&void 0!==pt?pt:new tr),At=new hA(null!==(vt=r.direction)&&void 0!==vt?vt:new tr);r.colors?yt=new uj(r.colors.length,r.colors):(yt=new uj(2,new Qn(0,0,0,1))).value[1]=new Qn(1,1,1,1),r.steps?bt=new JA(r.steps.length,r.steps):(bt=new JA(2,1)).value[0]=0;var jt=new jA(null!==(mt=r.alpha)&&void 0!==mt?mt:1),Tt=new QA(null!==(gt=r.mode)&&void 0!==gt?gt:0),Mt=new xj(wt,xt,Ot,kt,_t,St,Et,At,yt,bt,jt),Ct=new EA(Mt.calpha,"f");return new iT(t,n,e,{gradientType:wt,smooth:xt,near:Ot,far:kt,isVector:_t,isWorldSpace:St,origin:Et,direction:At,colors:yt,steps:bt,alpha:jt,mode:Tt},Mt,Tt,Ct);case"noise":var Dt,It,Pt,Rt,Lt,Nt,Bt,Ft,Ut,zt=new jA(null!==(Dt=r.scale)&&void 0!==Dt?Dt:1),Vt=new hA(null!==(It=r.size)&&void 0!==It?It:new tr(100,100,100)),Gt=new jA(null!==(Pt=r.move)&&void 0!==Pt?Pt:1),Ht=new lA(null!==(Rt=r.fA)&&void 0!==Rt?Rt:new An(1.7,9.2)),Wt=new lA(null!==(Lt=r.fB)&&void 0!==Lt?Lt:new An(8.3,2.8)),qt=new lA(null!==(Nt=r.distortion)&&void 0!==Nt?Nt:new An(1,1)),Yt=new fA(r.colorA),Xt=new fA(r.colorB),Kt=new fA(r.colorC),Qt=new fA(r.colorD),Zt=new jA(null!==(Bt=r.alpha)&&void 0!==Bt?Bt:1),Jt=new QA(null!==(Ft=r.mode)&&void 0!==Ft?Ft:0),$t=new QA(null!==(Ut=r.noiseType)&&void 0!==Ut?Ut:0),en=new hj(zt,Vt,Gt,Ht,Wt,qt,Yt,Xt,Kt,Qt,Zt,$t),tn=new EA(en.calpha,"f");return new iT(t,n,e,{scale:zt,size:Vt,move:Gt,fA:Ht,fB:Wt,distortion:qt,colorA:Yt,colorB:Xt,colorC:Kt,colorD:Qt,alpha:Zt,mode:Jt,noiseType:$t},en,Jt,tn);case"normal":var nn,rn,an,on=new hA(null!==(nn=r.cnormal)&&void 0!==nn?nn:new tr(1,1,1)),sn=new jA(null!==(rn=r.alpha)&&void 0!==rn?rn:1),un=new QA(null!==(an=r.mode)&&void 0!==an?an:0),cn=new Cj(on,sn),ln=new EA("alpha / clamp(alpha + accumAlpha, 0.00001, 1.0 )","f");return ln.keywords.alpha=sn,new iT(t,n,e,{cnormal:on,alpha:sn,mode:un},cn,un,ln);case"gradient":var hn,dn,fn,pn,vn,mn,gn,yn,bn,wn=new QA(null!==(hn=r.gradientType)&&void 0!==hn?hn:0),xn=new oj(null!==(dn=r.smooth)&&void 0!==dn&&dn);r.colors?yn=new uj(r.colors.length,r.colors):(yn=new uj(10,new Qn(0,0,0,1))).value[1]=new Qn(1,1,1,1),r.steps?bn=new JA(r.steps.length,r.steps):(bn=new JA(10,1)).value[0]=0;var On=new lA(null!==(fn=r.offset)&&void 0!==fn?fn:new An(0,0)),kn=new lA(null!==(pn=r.morph)&&void 0!==pn?pn:new An(0,0)),_n=new jA(null!==(vn=r.angle)&&void 0!==vn?vn:0),Sn=new jA(null!==(mn=r.alpha)&&void 0!==mn?mn:1),En=new QA(null!==(gn=r.mode)&&void 0!==gn?gn:0),jn=new Aj(wn,xn,yn,bn,On,kn,_n,Sn),Tn=new EA(jn.calpha,"f");return new iT(t,n,e,{gradientType:wn,smooth:xn,colors:yn,steps:bn,offset:On,morph:kn,angle:_n,alpha:Sn,mode:En},jn,En,Tn);default:var Mn=new KA(1,0,0,1),Cn=new jA(1),Dn=new EA("alpha / clamp(alpha + accumAlpha, 0.00001, 1.0 )","f");Dn.keywords.alpha=Cn;var In=new QA(0);return Mn.alpha=Cn,new iT(t,n,e,{color:Mn,alpha:Cn,mode:In},Mn,In,Dn)}}(n,e,t,i)}(e,t,n,r)}}]),e}(),iT=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o,s,u){var c;return Object(E.a)(this,n),(c=t.call(this,e,r,i,a)).params=a,c.color=o,c.mode=s,c.alpha=u,c}return Object(A.a)(n)}(rT),aT=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o){var s;return Object(E.a)(this,n),(s=t.call(this,e,r,i,a)).position=o,s}return Object(A.a)(n)}(rT),oT=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o){var s;return Object(E.a)(this,n),(s=t.call(this,e,r,i,o)).node=a,s}return Object(A.a)(n,[{key:"category",get:function(){return this.node.category}}],[{key:"createLigherLayer",value:function(e,t,r,i){var a,o,s=new jA(r.alpha),u=new QA(r.mode);if(r.visible)if("lambert"===r.category){var c;a=new nj;var l=new KA(null!==(c=i.color(r.emissive))&&void 0!==c?c:0);o={emissive:l},a.emissive=l}else if("toon"===r.category){var h,d;a=new aj;var f=new jA(null!==(h=r.shininess)&&void 0!==h?h:30),p=new KA(null!==(d=i.color(r.specular))&&void 0!==d?d:1118481);o={shininess:f,specular:p},a.shininess=f,a.specular=p}else if("physical"===r.category){var v,m,g;a=new ij;var y=new jA(null!==(v=r.roughness)&&void 0!==v?v:.3),b=new jA(null!==(m=r.metalness)&&void 0!==m?m:0),w=new jA(null!==(g=r.reflectivity)&&void 0!==g?g:.5);o={roughness:y,metalness:b,reflectivity:w},a.roughness=y,a.metalness=b,a.reflectivity=w}else{var x,O;a=new rj;var k=new jA(null!==(x=r.shininess)&&void 0!==x?x:30),_=new KA(void 0!==r.specular&&null!==(O=i.color(r.specular))&&void 0!==O?O:1118481);o={shininess:k,specular:_},a.shininess=k,a.specular=_}else a=new ZA,o={};return a.alpha=new jA(1),a.shadingAlpha=s,a.shadingBlend=u,o.alpha=a.shadingAlpha,o.mode=a.shadingBlend,new n(e,t,r,a,o)}}]),n}(rT);function sT(e){var t=e instanceof rT?e.type:e;return"texture"===t||"video"===t||"displace_map"===t||"matcap"===t}function uT(e,t,n){if("displace"===n.type&&("intensity"===e||"visible"===e)){var r=t.uniforms["f".concat(t.id,"_intensity")];return r?(r.value=n.intensity*(n.visible?1:0),r):void 0}if("displace"!==n.type&&("alpha"===e||"visible"===e)){var i=t.uniforms["f".concat(t.id,"_alpha")];if(!i)return;if(i.value=n.alpha*(n.visible?1:0),"outline"===n.type&&"visible"===e){var a=t.uniforms["f".concat(t.id,"_compensation")];a&&(a.value=n.compensation&&n.visible)}return i}}function cT(e,t){var n,r=0,i=Object(j.a)(e.layers);try{for(i.s();!(n=i.n()).done;){var a=n.value;if("displace"!==a.data.type&&"alpha"in a.data&&"light"!==a.data.type&&"fresnel"!==a.data.type&&"texture"!==a.data.type&&"matcap"!==a.data.type&&"rainbow"!==a.data.type&&"outline"!==a.data.type){var o=a.data.visible?a.data.alpha:0;if(1==o&&"depth"==a.data.type||"gradient"==a.data.type){var s,u=Object(j.a)(a.data.colors);try{for(u.s();!(s=u.n()).done;){var c=s.value;if(c[3]<1){o=c[3];break}}}catch(v){u.e(v)}finally{u.f()}}else if(1==o&&"noise"==a.data.type){var l=t.color(a.data.colorA).a,h=t.color(a.data.colorB).a,d=t.color(a.data.colorC).a,f=t.color(a.data.colorD).a,p=Math.min(l,Math.min(h,Math.min(d,f)));p<1&&(o=p)}r+=(1-r)*o}}}catch(v){i.e(v)}finally{i.f()}return r<1}var lT=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this,void 0)).flatShading=!1,e.cacheKey="",e.fog=!0,e.dithering=!0,e.vertexColors=!0,e.transparent=!0,e}return Object(A.a)(n,[{key:"customProgramCacheKey",value:function(){return this.cacheKey}}]),n}(ia),hT=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a){var o;return Object(E.a)(this,n),(o=t.call(this)).flatShading=e,o.side=r,o.wireframe=i,o.root=a,o}return Object(A.a)(n,[{key:"updateAfterBuild",value:function(){var e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}},{key:"onBeforeCompile",value:function(e,t){this.root.onBeforeCompile(e)}},{key:"data",get:function(){return this.root.data}},{key:"category",get:function(){return this.root.category}},{key:"getFlavor",value:function(e,t,n){return this.root.getFlavor(e,t,n)}},{key:"layers",get:function(){return this.root.layers}},{key:"fragment",get:function(){return this.root.fragment}},{key:"getLayersOfType",value:function(e){return this.root.getLayersOfType(e)}},{key:"getLayerByUuid",value:function(e){return this.root.getLayerByUuid(e)}},{key:"updateByOp",value:function(e,t,n){this.root.updateByOp(e,t,n)}},{key:"nodeMaterialDispose",value:function(){this.root.nodeMaterialDispose()}}]),n}(lT),dT=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;return Object(E.a)(this,n),(i=t.call(this)).data=e,i.layerIdGen=0,i.flavors=[],i.type="NodeMaterial",i.updaters=[],i.reset0(e,r),i}return Object(A.a)(n,[{key:"nodeMaterial",get:function(){return this}},{key:"getFlavor",value:function(e,t,n){var r=n?6:(e?3:0)+t;if(0===r)return this;void 0===this.flavors&&(this.flavors=[]),r-=1;var i=this.flavors[r];return void 0===i&&(i=new hT(e,t,n,this),this.flavors[r]=i,i.flatShading=e,i.side=t,i.updateAfterBuild()),i}},{key:"fragment",get:function(){return this.lightLayer.node}},{key:"category",get:function(){return this.lightLayer.category}},{key:"reset",value:function(e,t){this.data!==e&&this.reset0(e,t)}},{key:"reset0",value:function(e,t){var n,r,i=this;this.data=e;var a=null!==(n=e.layers)&&void 0!==n?n:Qw.defaultTwoLayerData("phong").layers;this.layers=a.map((function(e){return rT.create(i.layerIdGen++,e.id,e.data,t.shared)})),this.layers.reverse(),this.name=null!==(r=e.name)&&void 0!==r?r:"Untitled Material",this.onUpdate(),this.transparent=cT(e,t.shared)}},{key:"getLayersOfType",value:function(e){return this.layers.filter((function(t){return t.type===e}))}},{key:"getLayerByUuid",value:function(e){return this.layers.find((function(t){return t.uuid===e}))}},{key:"onUpdate",value:function(){this.cacheKey=this.computeCacheKey(),this.lightLayer=this.layers.find((function(e){return e instanceof oT})),void 0===this.lightLayer&&(this.lightLayer=new oT(0,"",Object(p.a)(Object(p.a)({},Kw.defaultData("light","phong")),{},{visible:!1}),new ZA,{})),this.dispose(),this.needsUpdate=!0,this.blendColors(),this.blendAfterColors(),this.blendPositions()}},{key:"updateByOp",value:function(e,t,n){if(this.data=t,this.transparent=cT(t,n.shared),"layers"===e.path[0]){this.data=t;var r=n.shared,i=e.path[1];if(void 0===i){var a;if(this.layers.reverse(),4===e.type){var o,s=rT.create(this.layerIdGen++,e.id,e.data,n.shared);this.layers.splice(e.localIndex,0,s),null===(o=n.scene)||void 0===o||o.markNeedsUpdateRendererDirty()}else if(5===e.type)this.layers.splice(e.localIndex,1)[0].dispose(),null===(a=n.scene)||void 0===a||a.markNeedsUpdateRendererDirty();else if(6===e.type){var u,c=this.layers.findIndex((function(t){return t.uuid===e.id})),l=this.layers[c];this.layers.splice(c,1),this.layers.splice(e.localIndex,0,l),null===(u=n.scene)||void 0===u||u.markNeedsUpdateRendererDirty()}this.layers.reverse(),this.onUpdate()}else{var h=this.layers.find((function(e){return e.uuid===i}));if(h){var d=t.layers.data(i);if(h.updateByOp(Object(p.a)(Object(p.a)({},e),{},{path:e.path.slice(2)}),d,n)){var f=rT.create(this.layerIdGen++,i,d,r);this.layers.splice(this.layers.findIndex((function(e){return e.uuid===i})),1,f),this.onUpdate()}}}}else this.reset(t,n)}},{key:"blendColors",value:function(){var e=this.layers.findIndex((function(e){return e instanceof iT})),t=this.layers.findIndex((function(e){return e instanceof oT}));if(-1!==e&&e<t){for(var n=this.layers[e].color,r=e+1;r<t;++r){var i=this.layers[r];i instanceof iT&&(n=new Oj(n,i.color,i.alpha,i.mode))}this.fragment.color=n}else this.fragment.color=void 0}},{key:"blendAfterColors",value:function(){var e=new EA("outgoingLight","f"),t=this.layers.findIndex((function(e){return e instanceof oT}));if(this.layers.length>t+1){for(var n=t+1;n<this.layers.length;++n){var r=this.layers[n];r instanceof iT&&(e=new Oj(e,r.color,r.alpha,r.mode))}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}},{key:"blendPositions",value:function(){var e=this.layers.filter((function(e){return e instanceof aT}));if(e.length>0){for(var t=e[0].position,n=1;n<e.length;++n)e[n]&&(t=new CA(t,e[n].position,CA.ADD),t=new CA(t,new jA(.5).setReadonly(!0),CA.MUL));this.fragment.position=t}else this.fragment.position=void 0}},{key:"getDefines",value:function(){return this.defines}},{key:"getUniforms",value:function(){return this.uniforms}},{key:"getVertexShader",value:function(){return this.vertexShader}},{key:"getFragmentShader",value:function(){return this.fragmentShader}},{key:"onBeforeCompile",value:function(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=!0===this.extensions.derivatives,e.extensionFragDepth=!0===this.extensions.fragDepth,e.extensionDrawBuffers=!0===this.extensions.drawBuffers,e.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD}},{key:"clampUniformsForPreview",value:function(e,t){var n,r=function(e,t,n){return Math.min(Math.max(e,t),n)},i=Object(j.a)(this.layers);try{for(i.s();!(n=i.n()).done;){var a=n.value;if("displace"===a.type){var o=r(a.uniforms["f".concat(a.id,"_intensity")].value,e,t);a.uniforms["f".concat(a.id,"_intensity")].value=o}}}catch(s){i.e(s)}finally{i.f()}}},{key:"computeCacheKey",value:function(){var e,t="[",n=Object(j.a)(this.data.layers);try{var r=function(){var n=e.value.data;if("light"===n.type)t+='"'.concat(n.visible?n.category.toUpperCase():"Basic",'"');else{var r,i,a=(null!==(r=Wj[n.type])&&void 0!==r?r:[]).map((function(e){return n[e]})),o=(null!==(i=qj[n.type])&&void 0!==i?i:[]).map((function(e){var t,r;return null!==(t=null===(r=n[e])||void 0===r?void 0:r.length)&&void 0!==t?t:0})),s=[].concat(Object(v.a)(a),Object(v.a)(o));s.length?t+='["'.concat(n.type,'", "').concat(s.join('","'),'"],'):t+='"'.concat(n.type,'",')}};for(n.s();!(e=n.n()).done;)r()}catch(i){n.e(i)}finally{n.f()}return t=t.slice(0,-1)+"]"}},{key:"updateFrame",value:function(e){for(var t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}},{key:"build",value:function(){var e=new XA;this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;var t,n=Object(j.a)(this.flavors);try{for(n.s();!(t=n.n()).done;){var r=t.value;r&&r.updateAfterBuild()}}catch(i){n.e(i)}finally{n.f()}return this}},{key:"nodeMaterialDispose",value:function(){this.layers.forEach((function(e){return e.dispose()})),Object(b.a)(Object(w.a)(n.prototype),"dispose",this).call(this);var e,t=Object(j.a)(this.flavors);try{for(t.s();!(e=t.n()).done;){var r=e.value;r&&r.dispose()}}catch(i){t.e(i)}finally{t.f()}}},{key:"assetsLoaded",value:function(){var e,t=Object(j.a)(this.layers);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n instanceof iT){var r=n.params.texture;if(r instanceof Zj&&!r.image.loaded)return!1}}}catch(i){t.e(i)}finally{t.f()}return!0}},{key:"getHash",value:function(){var e="{";return e+='"fragment":'+this.fragment.getHash(),e+="}"}}]),n}(lT);Object.defineProperties(lT.prototype,{properties:{get:function(){return this.fragment.properties}}});var fT=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n)}(dT),pT=z(H()),vT=new Map;function mT(e){if("string"==typeof e)return e;var t=vT.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},vT.set(e,t)),t.url}var gT,yT=function(){function e(t){var n,r=this,i=t.src,a=t.volume,o=t.delay,s=t.loop;Object(E.a)(this,e),this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=function(){r.loopsRemaining===1/0?r.replay():r.loopsRemaining>1?(r.replay(),r.loopsRemaining--):(r._status="stopped",r.loopsRemaining=r._loop)},n="string"==typeof i?{src:i}:{src:mT(i),format:"wav"},this.sound=new pT.Howl(n),this.sound.on("end",this.onEnd),this.src=i,void 0!==a&&(this.volume=a),void 0!==o&&(this.delay=o),void 0!==s&&(this.loop=s)}return Object(A.a)(e,[{key:"status",get:function(){return this._status}},{key:"volume",get:function(){return this._volume},set:function(e){this._volume=e,this.sound.volume(e)}},{key:"loop",get:function(){return this._loop},set:function(e){this._loop=e,this.loopsRemaining=e}},{key:"replay",value:function(){var e=this;this.clearDelay(),this.delayTimerId=window.setTimeout((function(){e.sound.play(),e.clearDelay()}),this.delay)}},{key:"fade",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout((function(){t.sound.fade(t._volume,0,n),t.clearFade()}),e)):this.sound.fade(this._volume,0,n)}},{key:"on",value:function(e,t,n){this.sound.on(e,t,n)}},{key:"off",value:function(e,t,n){this.sound.off(e,t,n)}},{key:"play",value:function(){"playing"===this._status||this.sound.playing()||("paused"===this._status?(0===this.sound.seek()?this.replay():this.sound.play(),this._status="playing"):"stopped"===this._status&&(this.replay(),this._status="playing"))}},{key:"pause",value:function(){"playing"===this._status&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}},{key:"stop",value:function(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}},{key:"clearFade",value:function(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}},{key:"clearDelay",value:function(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},{key:"dispose",value:function(){this.off(),this.stop(),this.clearFade(),this.clearDelay()}}]),e}(),bT=function(){function e(){Object(E.a)(this,e),this.type="ShapePath",this.color=new Gn,this.subPaths=[],this.currentPath=null}return Object(A.a)(e,[{key:"moveTo",value:function(e,t){return this.currentPath=new zu,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}},{key:"lineTo",value:function(e,t){var n;return null!==(n=this.currentPath)&&void 0!==n&&n.lineTo(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,r){var i;return null!==(i=this.currentPath)&&void 0!==i&&i.quadraticCurveTo(e,t,n,r),this}},{key:"bezierCurveTo",value:function(e,t,n,r,i,a){var o;return null!==(o=this.currentPath)&&void 0!==o&&o.bezierCurveTo(e,t,n,r,i,a),this}},{key:"splineThru",value:function(e){var t;return null!==(t=this.currentPath)&&void 0!==t&&t.splineThru(e),this}},{key:"toShapes",value:function(){var e=this,t={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},n={loc:t.ORIGIN,t:0};function r(e,r,a,o){var s=e.x,u=r.x,c=a.x,l=o.x,h=e.y,d=r.y,f=a.y,p=o.y,v=(l-c)*(h-f)-(p-f)*(s-c),m=(p-f)*(u-s)-(l-c)*(d-h),g=v/m,y=((u-s)*(h-f)-(d-h)*(s-c))/m;if(0===m&&0!==v||g<=0||g>=1||y<0||y>1)return null;if(0===v&&0===m){for(var b=0;b<2;b++){if(i(0===b?a:o,e,r),n.loc===t.ORIGIN){var w=0===b?a:o;return{x:w.x,y:w.y,t:n.t}}if(n.loc===t.BETWEEN)return{x:+(s+n.t*(u-s)).toPrecision(10),y:+(h+n.t*(d-h)).toPrecision(10),t:n.t}}return null}for(var x=0;x<2;x++)if(i(0===x?a:o,e,r),n.loc===t.ORIGIN){var O=0===x?a:o;return{x:O.x,y:O.y,t:n.t}}return{x:+(s+g*(u-s)).toPrecision(10),y:+(h+g*(d-h)).toPrecision(10),t:g}}function i(e,r,i){var a,o=i.x-r.x,s=i.y-r.y,u=e.x-r.x,c=e.y-r.y,l=o*c-u*s;if(e.x===r.x&&e.y===r.y)return n.loc=t.ORIGIN,void(n.t=0);if(e.x===i.x&&e.y===i.y)return n.loc=t.DESTINATION,void(n.t=1);l<-Number.EPSILON?n.loc=t.LEFT:l>Number.EPSILON?n.loc=t.RIGHT:o*u<0||s*c<0?n.loc=t.BEHIND:Math.sqrt(o*o+s*s)<Math.sqrt(u*u+c*c)?n.loc=t.BEYOND:(a=0!==o?u/o:c/s,n.loc=t.BETWEEN,n.t=a)}function a(e,t,n){var i=new An;t.getCenter(i);var a=[];return n.forEach((function(t){t.boundingBox.containsPoint(i)&&function(e,t){for(var n=[],i=[],a=1;a<e.length;a++)for(var o=e[a-1],s=e[a],u=function(){var e=t[c-1],a=t[c],u=r(o,s,e,a);null!==u&&void 0===n.find((function(e){return e.t<=u.t+Number.EPSILON&&e.t>=u.t-Number.EPSILON}))&&(n.push(u),i.push(new An(u.x,u.y)))},c=1;c<t.length;c++)u();return i}(e,t.points).forEach((function(e){a.push({identifier:t.identifier,isCW:t.isCW,point:e})}))})),a.sort((function(e,t){return e.point.x-t.point.x})),a}var o=0,s=999999999,u=-999999999,c=[];this.subPaths.forEach((function(e){for(var t=e.getPoints(),n=-999999999,r=999999999,i=-999999999,a=999999999,l=0;l<t.length;l++){var h=t[l];h.y>n&&(n=h.y),h.y<r&&(r=h.y),h.x>i&&(i=h.x),h.x<a&&(a=h.x)}u<=i&&(u=i+1),s>=a&&(s=a-1),t.length&&c.push({curves:e.curves,points:t,isCW:bc.isClockWise(t),identifier:o++,boundingBox:new Al(new An(a,r),new An(i,n))})}));var l=c.map((function(t){var n;return function(e,t,n,r,i){(null==i||""===i)&&(i="nonzero");var o=new An;e.boundingBox.getCenter(o);var s=a([new An(n,o.y),new An(r,o.y)],e.boundingBox,t);s.sort((function(e,t){return e.point.x-t.point.x}));var u=[],c=[];s.forEach((function(t){t.identifier===e.identifier?u.push(t):c.push(t)}));for(var l=u[0].point.x,h=[],d=0;d<c.length&&c[d].point.x<l;)h.length>0&&h[h.length-1]===c[d].identifier?h.pop():h.push(c[d].identifier),d++;if(h.push(e.identifier),"evenodd"===i){var f=h.length%2===0,p=h[h.length-2];return{identifier:e.identifier,isHole:f,for:p}}if("nonzero"===i){for(var v=!0,m=null,g=null,y=0;y<h.length;y++){var b=h[y];t[b]&&(v?(g=t[b].isCW,v=!1,m=b):g!==t[b].isCW&&(g=t[b].isCW,v=!0))}return{identifier:e.identifier,isHole:v,for:m}}console.warn('fill-rule: "'+i+'" is currently not implemented.')}(t,c,s,u,null===(n=e.userData)||void 0===n?void 0:n.style.fillRule)})),h=[];return c.forEach((function(e){var t=l[e.identifier];if(t&&!t.isHole){var n=new Yu;n.curves=e.curves,l.filter((function(t){return(null===t||void 0===t?void 0:t.isHole)&&t.for===e.identifier})).forEach((function(e){if(e){var t=c[e.identifier],r=new zu;r.curves=t.curves,n.holes.push(r)}})),h.push(n)}})),h}}]),e}(),wT=new Promise((function(e){gT=e})),xT=!1;function OT(){return kT.apply(this,arguments)}function kT(){return kT=Object(m.a)(Object(S.a)().mark((function e(){var t;return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!xT){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,n.e(4).then(n.bind(null,85));case 4:t=e.sent,gT(t),xT=!0;case 6:case"end":return e.stop()}}),e)}))),kT.apply(this,arguments)}var _T=function(){function e(){Object(E.a)(this,e)}return Object(A.a)(e,[{key:"load",value:function(){var e=Object(m.a)(Object(S.a)().mark((function e(t,n){var r,i,a=arguments;return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:function(){},e.next=3,wT;case 3:i=e.sent,(0,i.load)(t,(function(e,t){e||!t?r(null!==e&&void 0!==e?e:"Something went wrong"):n(t)}));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"parse",value:function(){var e=Object(m.a)(Object(S.a)().mark((function e(t){var n,r,i,a,o,s;return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wT;case 2:return n=e.sent,r=n.parse,i=n.Bidi,e.prev=5,a=r(t),o=new i,s=function(e){return a.charToGlyphIndex(e.char)},e.abrupt("return",(o.registerModifier("glyphIndex",null,s),o.applyFeatures(a,a.defaultRenderOptions.features),{font:a,bidi:o}));case 10:e.prev=10,e.t0=e.catch(5),console.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[5,10]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();function ST(e){return ET.apply(this,arguments)}function ET(){return ET=Object(m.a)(Object(S.a)().mark((function e(t){return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return e.next=4,e.sent.arrayBuffer();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),ET.apply(this,arguments)}var AT=new _T;function jT(e){return TT.apply(this,arguments)}function TT(){return TT=Object(m.a)(Object(S.a)().mark((function e(t){var n,r,i,a;return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!1,!t.url){e.next=9;break}return e.next=4,ST(t.url);case 4:n=e.sent,r=t.url,i=t.url.startsWith("/"),e.next=10;break;case 9:t.data&&(n=t.data.buffer);case 10:if(!n){e.next=16;break}return e.next=13,AT.parse(n);case 13:if(!(a=e.sent)){e.next=16;break}return e.abrupt("return",{font:a.font,url:r,intercepted:i,arr:n,bidi:a.bidi});case 16:case"end":return e.stop()}}),e)}))),TT.apply(this,arguments)}function MT(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var CT=function(){function e(t){var n,r=this;Object(E.a)(this,e),this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=null!==(n=t.isUserFont)&&void 0!==n&&n,this._loadingPromise=jT(t).then((function(e){e&&(r._arrayBuffer=e.arr,r._url=e.url,r.font=e.font,r._intercepted=e.intercepted,r._isLoaded=!0,r._bidi=e.bidi)}))}return Object(A.a)(e,[{key:"update",value:function(e){var t,n=this;this._isLoaded=!1,this._isUserFont=null!==(t=e.isUserFont)&&void 0!==t&&t,this._loadingPromise=jT(e).then((function(e){e&&(n._arrayBuffer=e.arr,n._url=e.url,n.font=e.font,n._intercepted=e.intercepted,n._isLoaded=!0,n._bidi=e.bidi)}))}},{key:"url",get:function(){return this._url}},{key:"intercepted",get:function(){return this._intercepted}},{key:"isLoaded",get:function(){return this._isLoaded}},{key:"loadingPromise",get:function(){return this._loadingPromise}},{key:"reverseLigaturesTable",value:function(e,t,n){if(!this._bidi)return[];var r=this._bidi;r.getTextGlyphs(t);for(var i=r.tokenizer.tokens,a=[],o=0,s=n.length===i.length,u=0;u<n.length;u++){var c=n[u].index,l=String.fromCharCode(n[u].unicode),h=i[o];if(MT(c,h)||s)a.push({char:l,index:c,replacements:[h.state.glyphIndex],replacementChars:[h.char]}),o++;else{for(var d=h.char,f="",p=[h.state.glyphIndex],v=[],m=!1;!m;)o++,d+=f=t.charAt(o),p.push(e.charToGlyphIndex(f)),1===(v=e.stringToGlyphs(d)).length&&v[0].index===c&&(m=!0),o>t.length&&(m=!0);a.push({char:l,index:c,replacements:p,replacementChars:Array.from(d)}),o++}}return a}},{key:"generateShapes",value:function(e,t){var n=this;if(this._isLoaded){for(var r,i=this.font,a=t.fontSize/this.unitsPerEm,o=t.fontSize*t.lineHeight,s=e.map((function(e){return n.getTextWidth(e,t)})),u=t.width,c=this.getCharWidth("\n",t),l=1===t.horizontalAlign?c:0,h=this.computeSpaceWidthForLine(e,0,t),d=this.getLineInitialOffsetX(s[0],u,t.horizontalAlign,e[0],c),f=this.getLineInitialOffsetY(o,e.length,t.height,a,t.verticalAlign),p=[],m=e.map((function(e){return[]})),g=e.map((function(e){return[]})),y=0;y<e.length;y++){var b=e[y],w=[];try{w=i.stringToGlyphs(b,{features:{liga:!0}})}catch(k){console.warn(k)}d=this.getLineInitialOffsetX(s[y],u,t.horizontalAlign,b,c);var x=[];try{x=this.reverseLigaturesTable(i,b,w)}catch(k){console.warn(k)}h=this.computeSpaceWidthForLine(e,y,t);for(var O=function(){var e=w[k],o=0===e.index?"\n":e.unicode?String.fromCharCode(e.unicode):void 0,s=x[k],u=0,c=0;0===k&&2===t.horizontalAlign&&void 0!==e.leftSideBearing&&(c=-e.leftSideBearing*a),r&&(u=i.getKerningValue(e,r)*a),d+=c+u;var v=0;if("\n"===o)v=l;else if(" "===o)v=h;else{var b=n.createPath(e,a,d,f,t);b&&(v=b.offsetX-(u+c),p.push(b.path))}if(1===s.replacements.length)g[y].push([d,f]),m[y].push(v);else for(var O=s.replacements.map((function(e){var t;return(null!==(t=i.glyphs.get(e).advanceWidth)&&void 0!==t?t:0)*a})),_=O.reduce((function(e,t){return e+t}),0),S=O.map((function(e){return e/_})),E=d,A=0;A<S.length;A++){var j=v*S[A];g[y].push([E,f]),m[y].push(j),E+=j}d+=v,r=e},k=0;k<w.length;k++)O();f-=o}for(var _=[],S=0,E=p.length;S<E;S++)_.push.apply(_,Object(v.a)(p[S].toShapes()));return{shapes:_,charWidths:m,lineWidths:s,charCoords:g}}}},{key:"isUserFont",get:function(){return this._isUserFont}},{key:"arrayBuffer",get:function(){return this._arrayBuffer}},{key:"ascender",get:function(){var e,t;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.ascender)&&void 0!==e?e:0}},{key:"descender",get:function(){var e,t;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.descender)&&void 0!==e?e:0}},{key:"familyName",get:function(){var e,t;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.names.fontFamily)&&void 0!==e?e:""}},{key:"subfamilyName",get:function(){var e,t;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.names.fontSubfamily)&&void 0!==e?e:""}},{key:"unitsPerEm",get:function(){var e,t;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.unitsPerEm)&&void 0!==e?e:1}},{key:"getLineInitialOffsetX",value:function(e,t,n,r,i){return(3===n||2===n)&&r.indexOf("\n")>=0&&(e-=i),3===n?.5*t-.5*e:2===n?t-e:0}},{key:"getLineInitialOffsetY",value:function(e,t,n,r,i){var a=t*e,o=e-Math.abs(this.ascender-this.descender)*r,s=-this.ascender*r-o/2;return 3===i?-(n-a-s):2===i?-(.5*n-.5*a-s):s}},{key:"createPath",value:function(e,t,n,r,i){var a,o=e.getPath(n,-r,i.fontSize,{kerning:!1,letterSpacing:i.letterSpacing});if(o){var s=new bT,u=(null!==(a=e.advanceWidth)&&void 0!==a?a:1)*t;if(e){var c,l=Object(j.a)(o.commands);try{for(l.s();!(c=l.n()).done;){var h,d=c.value,f=null===(h=s.currentPath)||void 0===h?void 0:h.currentPoint;if(!f||"Z"===d.type||f.x!==d.x||-f.y!==d.y)switch(d.type){case"M":s.moveTo(d.x,-d.y);break;case"L":s.lineTo(d.x,-d.y);break;case"Q":s.quadraticCurveTo(d.x1,-d.y1,d.x,-d.y);break;case"C":s.bezierCurveTo(d.x1,-d.y1,d.x2,-d.y2,d.x,-d.y)}}}catch(p){l.e(p)}finally{l.f()}}return s.subPaths.forEach((function(e){var t=function(e){if(e.length){var t=e[0];if(t instanceof Pu)return t.v1;if(t instanceof Du||t instanceof Lu)return t.v0}}(e.curves);void 0!==t&&e.currentPoint.distanceTo(t)>0&&e.lineTo(t.x,t.y)})),{offsetX:u+i.fontSize*i.letterSpacing,path:s}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".")}},{key:"getCharWidth",value:function(e,t){var n,r;return null!==(n=null===(r=this.font)||void 0===r?void 0:r.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))&&void 0!==n?n:0}},{key:"getTextWidth",value:function(e,t){var n,r;return null!==(n=null===(r=this.font)||void 0===r?void 0:r.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))&&void 0!==n?n:0}},{key:"computeSpaceWidthForLine",value:function(e,t,n){var r=this.getCharWidth(" ",n),i=e[t];if(i){var a=this.countSpaces(i.trimEnd());if(4===n.horizontalAlign&&t<e.length-1&&a)return(n.width-(this.getTextWidth(i,n)-a*r))/a}return r}},{key:"countSpaces",value:function(e){return(e.match(/ /g)||[]).length}}]),e}();var DT=function(){function e(){Object(E.a)(this,e),this.objects=new Map,this.unreachable=new Set}return Object(A.a)(e,[{key:"getCached",value:function(e){return this.objects.get(e)}},{key:"size",get:function(){return this.objects.size}},{key:"get",value:function(e,t){var n=this.objects.get(e);return void 0===n?(n=this.createObject(e,t),this.objects.set(e,n)):n.isShared=!0,n}},{key:"mutateIfUnique",value:function(e,t){var n=this.objects.get(e);if(n&&!0!==n.isShared)return this.objects.delete(e),this.objects.set(t,n),n}},{key:"startGc",value:function(){this.unreachable=new Set(this.objects.keys())}},{key:"markAsReachable",value:function(e,t){t===this.objects.get(e)&&this.unreachable.delete(e)}},{key:"endGc",value:function(){var e=this;this.unreachable.forEach((function(t){e.disposeObject(e.objects.get(t)),e.objects.delete(t)})),this.unreachable.clear()}},{key:"dispose",value:function(){var e=this;this.objects.forEach((function(t){e.disposeObject(t)})),this.objects.clear()}}]),e}(),IT=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this)).flatShading=e,r}return Object(A.a)(n,[{key:"disposeObject",value:function(e){e.dispose()}},{key:"createObject",value:function(e,t){var n=gE(e,t,this.flatShading);return n.computeBoundingSphere(),n}}]),n}(DT),PT={find:function(e){},markNeedsUpdateRendererDirty:function(){},markGeometryCacheDirty:function(){},addPendingExpandCloner:function(e){},addPendingUpdateCloner:function(e){}},RT=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this)).shared=e,r}return Object(A.a)(n,[{key:"create",value:function(e){return new Vj(e,this.shared)}}]),n}(zj),LT=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Object(E.a)(this,e),this.geometryCache=new IT(!0),this.geometryCache2=new IT(!1),this.imageHolderCache=new RT(this),this.thisContext={scene:PT,shared:this},this.deletedMaterial=new fT(Qw.defaultTwoLayerData("phong"),this.thisContext),this.deletedImage=new Gj(Qx.emptyImage,this),this.deletedVideo=new Gj(Vw.defaultVideo,this),this.materials={},this.images={},this.videos={},this.colors={},this.audios={},this.fonts={},this.penumbraSize=[],this.requestRender=function(){n._requestRender&&n._requestRender()},r.images)for(var i=0,a=Object.entries(r.images);i<a.length;i++){var o=Object(g.a)(a[i],2),s=o[0],u=o[1];this.addImage(s,u)}if(r.videos)for(var c=0,l=Object.entries(r.videos);c<l.length;c++){var h=Object(g.a)(l[c],2),d=h[0],f=h[1];this.addVideo(d,f)}if(r.audios)for(var p=0,v=Object.entries(r.audios);p<v.length;p++){var m=Object(g.a)(v[p],2),y=m[0],b=m[1];this.addAudio(y,b.data)}this.reset(t)}return Object(A.a)(e,[{key:"setRequestRender",value:function(e){this._requestRender=e}},{key:"reset",value:function(e){for(var t=0,n=Object.entries(e.images);t<n.length;t++){var r=Object(g.a)(n[t],2),i=r[0],a=r[1];this.addImage(i,a)}for(var o=0,s=Object.entries(e.videos);o<s.length;o++){var u=Object(g.a)(s[o],2),c=u[0],l=u[1];this.addVideo(c,l)}for(var h=0,d=Object.entries(e.colors);h<d.length;h++){var f=Object(g.a)(d[h],2),p=f[0],v=f[1];this.addColor(p,v)}for(var m=0,y=Object.entries(e.materials);m<y.length;m++){var b=Object(g.a)(y[m],2),w=b[0],x=b[1];this.addMaterial(w,new fT(x,this.thisContext))}for(var O=0,k=Object.entries(e.audios);O<k.length;O++){var _=Object(g.a)(k[O],2),S=_[0],E=_[1];this.addAudio(S,E.data)}for(var A=0,j=Object.entries(e.fonts);A<j.length;A++){var T=Object(g.a)(j[A],2),M=T[0],C=T[1];this.addFont(M,C)}this.penumbraSize=e.penumbraSize}},{key:"addMaterial",value:function(e,t){t.uuid=e,this.materials[e]=t}},{key:"deleteMaterial",value:function(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}},{key:"getMaterial",value:function(e){return this.materials[e]}},{key:"getMaterialOrDeletedPlaceholder",value:function(e){var t;return null!==(t=this.materials[e])&&void 0!==t?t:this.deletedMaterial}},{key:"material",value:function(e){return"string"==typeof e?this.getMaterialOrDeletedPlaceholder(e):new dT(e,this.thisContext)}},{key:"getMaterials",value:function(){return this.materials}},{key:"addImage",value:function(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new Gj(t,this),!1)}},{key:"deleteImage",value:function(e){var t=this.images[e];t&&(t.dispose(),delete this.images[e])}},{key:"getDefaultImage",value:function(){return this.images.image_0}},{key:"getImage",value:function(e){var t;return null!==(t=this.images[e])&&void 0!==t?t:this.deletedImage}},{key:"image",value:function(e){return"string"==typeof e?this.getImage(e):this.imageHolderCache.load(e)}},{key:"addVideo",value:function(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new Gj(t,this),!1)}},{key:"deleteVideo",value:function(e){var t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}},{key:"getVideo",value:function(e){var t;return null!==(t=this.videos[e])&&void 0!==t?t:this.deletedVideo}},{key:"video",value:function(e){return"string"==typeof e?this.getVideo(e):this.imageHolderCache.load(e)}},{key:"addColor",value:function(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):(this.colors[e]=new Lj(t.r,t.g,t.b,"a"in t?t.a:1),!1)}},{key:"updateColor",value:function(e,t){if(this.colors[e]){var n,r,i,a;this.onColorOrImageUpdate&&this.onColorOrImageUpdate();var o=this.colors[e];return this.colors[e].r=null!==(n=t.r)&&void 0!==n?n:o.r,this.colors[e].g=null!==(r=t.g)&&void 0!==r?r:o.g,this.colors[e].b=null!==(i=t.b)&&void 0!==i?i:o.b,this.colors[e].a=null!==(a=t.a)&&void 0!==a?a:o.a,!0}return!1}},{key:"deleteColor",value:function(e){this.colors[e]&&delete this.colors[e]}},{key:"getColor",value:function(e){return this.colors[e]}},{key:"color",value:function(e){var t;if("string"!=typeof e)return new dA(e.r,e.g,e.b,"a"in e?e.a:1);var n=this.getColor(e);return n?t=n:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new dA(0,0,0,0)),t}},{key:"addAudio",value:function(e,t){this.audios[e]=t}},{key:"getAudio",value:function(e){var t=this.audios[e];if(t instanceof yT)return t;var n=new yT({src:t});return this.audios[e]=n,n}},{key:"deleteAudio",value:function(e){var t=this.audios[e];t&&(t instanceof yT&&t.dispose(),delete this.audios[e])}},{key:"addFont",value:function(e,t){var n=this;this.fonts[e]=new CT(t),this.fonts[e].loadingPromise.then((function(){return n.requestRender()}))}},{key:"getFont",value:function(e){return this.fonts[e]}},{key:"deleteFont",value:function(e){this.fonts[e]&&delete this.fonts[e]}},{key:"dispose",value:function(){var e=this;Object.keys(this.materials).forEach((function(t){return e.deleteMaterial(t)})),this._requestRender=void 0,Object.values(this.audios).forEach((function(e){e instanceof yT&&e.dispose()})),this.audios={},this.geometryCache.dispose(),this.geometryCache2.dispose()}}]),e}(),NT=(new LT(Mx.emptyData()),function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n,[{key:"updateByPatchedOp",value:function(e,t,r){if(Object(b.a)(Object(w.a)(n.prototype),"updateByPatchedOp",this).call(this,e,t,r),null!==function(e,t){var n=[];if(t.length!==e.length)return null;for(var r=0;r<e.length;){if("*"===t[r])n.push(e[r]);else if(e[r]!==t[r])return null;r+=1}return n}(e.path,["materials"])&&0===e.type&&Array.isArray(this.material))for(var i=0,a=Object.entries(e.props);i<a.length;i++){var o=Object(g.a)(a[i],2),s=o[0],u=o[1],c=r.shared.material(u);this.material[Number(s)]=c}else if(Ly(e.path,["material"])&&this.material instanceof lT)"material"in t&&"string"!=typeof t.material&&this.material.updateByOp(sy.drop(e,1),t.material,r);else if(Ly(e.path,["materials","*"])&&Array.isArray(this.material)){var l=e.path[1];if("materials"in t&&l<this.material.length){var h=t.materials[l];"string"!=typeof h&&this.material[l].updateByOp(sy.drop(e,2),h,r)}}}},{key:"updateState",value:function(e,t){var r,i,a,o,s;Object(b.a)(Object(w.a)(n.prototype),"updateState",this).call(this,e,t),void 0!==e.castShadow&&(this.castShadow=e.castShadow),void 0!==e.receiveShadow&&(this.receiveShadow=e.receiveShadow);var u=this.dataPatched;if("NonParametricGeometry"!==(null===(r=e.geometry)||void 0===r?void 0:r.type)&&"material"in e&&void 0!==e.material&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(u.flatShading,u.side,u.wireframe),null!==(i=t.scene)&&void 0!==i&&i.markNeedsUpdateRendererDirty()),"NonParametricGeometry"===(null===(a=e.geometry)||void 0===a?void 0:a.type)&&("materials"in e&&void 0!==e.materials?(this.disposeMaterial(),this.material=e.materials.map((function(e){return t.shared.material(e).getFlavor(u.flatShading,u.side,u.wireframe)})),null===(o=t.scene)||void 0===o||o.markNeedsUpdateRendererDirty()):"material"in e&&void 0!==e.material&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(u.flatShading,u.side,u.wireframe)],null===(s=t.scene)||void 0===s||s.markNeedsUpdateRendererDirty())),void 0!==e.flatShading||void 0!==e.wireframe||void 0!==e.side)if(Array.isArray(this.material))for(var c=0;c<this.material.length;c++)this.material[c]=this.material[c].getFlavor(u.flatShading,u.side,u.wireframe);else this.material=this.material.getFlavor(u.flatShading,u.side,u.wireframe)}},{key:"disposeMaterial",value:function(){this.material&&Ex(this.material).forEach((function(e){e instanceof lT&&(e instanceof fT||e.nodeMaterialDispose())}))}},{key:"dispose",value:function(){this.disposeMaterial(),Object(b.a)(Object(w.a)(n.prototype),"dispose",this).call(this)}}]),n}(rA)),BT=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;return Object(E.a)(this,n),(a=t.call(this,e,r)).data=r,a.localGeometry=void 0,a}return Object(A.a)(n,[{key:"chooseGeoemtryCache",value:function(e){return e.geometryCache}},{key:"markGeometryAsReachable",value:function(e){this.geometryCreateDeleyed instanceof Di&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}},{key:"geometry",get:function(){if(void 0!==this.localGeometry)return this.localGeometry;if(this.geometryCreateDeleyed instanceof LT){var e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e)}return this.geometryCreateDeleyed},set:function(e){this.localGeometry=e}},{key:"is2DAndNoDepth",get:function(){var e=this.dataPatched.geometry;return Jw.is2DParametricMesh(e.type)&&0===e.depth}},{key:"is2DType",get:function(){return Jw.is2DParametricMesh(this.geometry.userData.type)}},{key:"updateByPatchedOp",value:function(e,t,r){Object(b.a)(Object(w.a)(n.prototype),"updateByPatchedOp",this).call(this,e,t,r),Ly(e.path,["geometry"])&&this.updateByPatchedOpGeometry(sy.drop(e,1),t.geometry,r)}},{key:"removeInteractionGeometry",value:function(){var e;null!==(e=this.localGeometry)&&void 0!==e&&e.dispose(),this.localGeometry=void 0}},{key:"updateGeometryInteractions",value:function(e,t){this.invalidateDownstreamBooleanData();var n=this.data.geometry.type;if("NonParametricGeometry"===n||"SubdivGeometry"===n){var r,i,a,o,s,u,c=e;if(void 0===this.localGeometry){var l=Object(p.a)(Object(p.a)({},this.data.geometry),c);this.localGeometry=gE(l,t,this.data.flatShading)}c.scaleBaked?(r=c.scaleBaked,o=(i=Object(g.a)(r,3))[0],s=i[1],u=i[2]):(o=(a=c).width,s=a.height,u=a.depth);var h=this.localGeometry.userData;void 0!==h.sxPrev&&bE(this.localGeometry.attributes,o/h.sxPrev,s/h.syPrev,u/h.szPrev),h.sxPrev=o,h.syPrev=s,h.szPrev=u}else{var d,f=Object(p.a)(Object(p.a)({},this.data.geometry),e);null!==(d=this.localGeometry)&&void 0!==d&&d.dispose(),this.localGeometry=gE(f,t,this.data.flatShading)}}},{key:"refreshAttachedCloners",value:function(e){var t,n=Object(j.a)(this.attachedSurfaceCloners);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.scene.addPendingUpdateCloner(r.object)}}catch(i){n.e(i)}finally{n.f()}}},{key:"createGeometryDelayed",value:function(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e)}},{key:"updateByPatchedOpGeometry",value:function(e,t,n){var r,i=!1;0===e.type&&0===e.path.length&&Cg(["scaleBaked"],Object.keys(e.props))&&this.geometryCreateDeleyed instanceof EE&&this.chooseGeoemtryCache(n.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(i=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(n)),i||(null!==(r=n.scene)&&void 0!==r&&r.markGeometryCacheDirty(),this.createGeometryDelayed(n)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}},{key:"updateGeometryOnStateUpdate",value:function(e,t){this.createGeometryDelayed(t)}},{key:"updateState",value:function(e,t){void 0!==e.geometry&&this.updateGeometryOnStateUpdate(e.geometry,t),Object(b.a)(Object(w.a)(n.prototype),"updateState",this).call(this,e,t)}},{key:"updateGeometryGroupsIfNeeded",value:function(){var e,t;Array.isArray(this.material)&&0===this.geometry.groups.length&&this.geometry.addGroup(0,Math.max(null!==(e=null===(t=this.geometry.getIndex())||void 0===t?void 0:t.count)&&void 0!==e?e:0,this.geometry.getAttribute("position").count),0)}},{key:"updateEntityBoxSize",value:function(e,t){var n,r=this.geometry.userData.parameters;this.is2DType?e.set(0,0,.5*r.depth):e.setScalar(0),t.set(r.width,r.height,null!==(n=r.depth)&&void 0!==n?n:0).multiplyScalar(.5)}}]),n}(NT);function FT(e){if(Array.isArray(e.material)){var t,n=Object(j.a)(e.material);try{for(n.s();!(t=n.n()).done;){if(0===t.value.getLayersOfType("outline").length)return}}catch(r){n.e(r)}finally{n.f()}}else if(!(e.material instanceof lT)||0===e.material.getLayersOfType("outline").length)return;e instanceof BT&&e.is2DAndNoDepth?function(e){if(!e.geometry.attributes.extrudeNormals&&e.geometry.attributes.position){for(var t=e.geometry.attributes.position.array,n=new Float32Array(t.length),r=new tr,i=0;i<t.length;i+=3)r.set(t[i],t[i+1],t[i+2]).normalize(),n[i]=r.x,n[i+1]=r.y,n[i+2]=r.z;e.geometry.setAttribute("extrudeNormal",new _i(n,3))}}(e):function(e){if(!e.geometry.attributes.extrudeNormal&&e.geometry.attributes.position&&e.geometry.attributes.normal){for(var t=new Map,n=e.geometry.attributes.position.array,i=e.geometry.attributes.normal.array,a=new Float32Array(n.length),o=0;o<n.length;o+=3){var s,u="".concat(n[o],"_").concat(n[o+1],"_").concat(n[o+2]),c=new tr(i[o],i[o+1],i[o+2]);t.has(u)?null===(s=t.get(u))||void 0===s||s.normals.push(c):t.set(u,{normals:[c],result:new tr})}t.forEach((function(e,t){var n,i=Object(j.a)(e.normals);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.result.add(a)}}catch(r){i.e(r)}finally{i.f()}e.result.divideScalar(e.normals.length)}));for(var l=0;l<n.length;l+=3){var h,d="".concat(n[l],"_").concat(n[l+1],"_").concat(n[l+2]),f=null===(h=t.get(d))||void 0===h?void 0:h.result;f&&(a[l]=f.x,a[l+1]=f.y,a[l+2]=f.z)}e.geometry.setAttribute("extrudeNormal",new _i(a,3))}}(e)}function UT(e){if(e.geometry.attributes.position){for(var t=e.geometry.attributes.position.array,n=new Float32Array(t.length),r=parseInt(e.uuid.replace(/\D/g,"")),i=[En.seededRandom(r),En.seededRandom(r+1e4),En.seededRandom(r+2e4)],a=0;a<t.length;a++)n[a]=i[a%3];e.geometry.setAttribute("randomColor",new wi(n,3))}}fE.then((function(e){e}));var zT=new ir,VT=new tr;function GT(e){var t=!1;return e.scene.objects.traverse((function(e,n){"Mesh"===n.type&&"SubdivGeometry"===n.geometry.type&&(t=!0)})),t}var HT=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;return Object(E.a)(this,n),(a=t.call(this,e,r,i)).data=r,a.hiddenMatrixOld=new Dr,a.smoothShading=!0,a.skipReactionUpdate=!1,a}return Object(A.a)(n,[{key:"chooseGeoemtryCache",value:function(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}},{key:"subdivPointerNew",get:function(){return void 0!==this.localGeometry?this.subdivPointer:this.geometry.ensureSubdivPointer()}},{key:"originalGeometryNew",get:function(){return void 0!==this.localGeometry?this.originalGeometry:this.geometry.originalGeometry}},{key:"phongAngle",get:function(){var e;return null!==(e=this.data.geometry.phongAngle)&&void 0!==e?e:45}},{key:"updateEntityBoxSize",value:function(e,t){var n,r=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(r.width,r.height,null!==(n=r.depth)&&void 0!==n?n:0).multiplyScalar(.5)}},{key:"createGeometryByControls",value:function(e){var t,n,r,i;if(!0!==this.skipReactionUpdate){var a=null===(t=this.localGeometry)||void 0===t?void 0:t.uuid,o=EE.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0),s=o.originalGeometry,u=o.subdividedGeometry,c=o.subdivPointer;this.subdivPointer=c,void 0!==s&&(null!==(n=this.originalGeometry)&&void 0!==n&&n.dispose(),this.originalGeometry=s),void 0!==u&&(null!==(r=this.subdividedGeometry)&&void 0!==r&&r.dispose(),this.subdividedGeometry=null!==u&&void 0!==u?u:void 0),this.localGeometry=null!==(i=this.subdividedGeometry)&&void 0!==i?i:this.originalGeometry,FT(this),UT(this),this.calcBoundingBox(),a&&(this.localGeometry.uuid=a)}}},{key:"updateState",value:function(e,t){if(Object(b.a)(Object(w.a)(n.prototype),"updateState",this).call(this,e,t),void 0!==e.flatShading){var r=this.material;this.material=r.getFlavor(!1,r.side,r.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}},{key:"updateMesh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];EE.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&EE.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}},{key:"updateTopology",value:function(){var e;this.originalGeometry.dispose(),this.originalGeometry=EE.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=EE.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=null!==(e=this.subdividedGeometry)&&void 0!==e?e:this.originalGeometry}},{key:"raycast",value:function(e,t){var n=this.localGeometry;this.localGeometry=this.originalGeometryNew,rA.prototype.raycast.call(this,e,t),this.localGeometry=n}},{key:"activateSVDCompensation",value:function(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}},{key:"deactivateSVDCompensation",value:function(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}},{key:"calcBoundingBox",value:function(){var e=this.originalGeometry;null===e.boundingSphere&&(e.boundingSphere=new kr,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));var t=e.attributes.position,n=e.boundingSphere.center;zT.setFromBufferAttribute(t),zT.getCenter(n),e.boundingSphere.radius=n.distanceTo(zT.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),zT.getSize(VT),this.hasNonUniformScale&&VT.divide(this.scale);var r={width:VT.x,height:VT.y,depth:VT.z};return this.geometry.userData.parameters=r,r}},{key:"updateBoundingSphere",value:function(e){var t=this.originalGeometry;zT.min.set(e[0],e[2],e[4]),zT.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(zT.min.applyMatrix4(this.shearScaleInv),zT.max.applyMatrix4(this.shearScaleInv)),null===t.boundingSphere&&(t.boundingSphere=new kr);var n=t.boundingSphere.center;zT.getCenter(n),t.boundingSphere.radius=n.distanceTo(zT.max)}},{key:"freeSubdivPointer",value:function(){var e,t;this.subdivPointer&&(EE.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,null!==(e=this.originalGeometry)&&void 0!==e&&e.dispose(),null===(t=this.subdividedGeometry)||void 0===t||t.dispose()}},{key:"dispose",value:function(){Object(b.a)(Object(w.a)(n.prototype),"dispose",this).call(this),this.freeSubdivPointer()}},{key:"updateByPatchedOpGeometry",value:function(e,t,r){Object(b.a)(Object(w.a)(n.prototype),"updateByPatchedOpGeometry",this).call(this,e,t,r),this.localGeometry&&this.createGeometryByControls(t)}}]),n}(BT),WT={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},qT={polygon_center:0,edge:1,vertex:2},YT=function(e,t){return function(n,r){return t&&0!==n&&0!==e?e*r/100:0}},XT=function(e,t){var n=Math.abs(t),r=-1*n;return(e- -1)*(n-r)/2+r};var KT=new tr,QT=new tr,ZT=new tr,JT=new tr;function $T(e,t){var n=ZT.fromArray(e),r=JT.fromArray(t);QT.copy(r).sub(n);var i=QT.length();return QT.normalize().multiplyScalar(.5*i),KT.copy(n).add(QT).toArray()}var eM=new pi,tM=new tr,nM=new tr,rM=new tr;var iM=4,aM=.5,oM=function(e){return.5*(1-Math.cos(e*Math.PI))},sM=function(){function e(){Object(E.a)(this,e),this.perlin=new Array(4096)}return Object(A.a)(e,[{key:"noise",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null==this.perlin){this.perlin=new Array(4096);for(var r=0;r<4096;r++)this.perlin[r]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),n<0&&(n=-n);for(var i,a,o,s,u,c=Math.floor(e),l=Math.floor(t),h=Math.floor(n),d=e-c,f=t-l,p=n-h,v=0,m=.5,g=0;g<iM;g++){var y=c+(l<<4)+(h<<8);i=oM(d),a=oM(f),o=this.perlin[4095&y],o+=i*(this.perlin[y+1&4095]-o),s=this.perlin[y+16&4095],o+=a*((s+=i*(this.perlin[y+16+1&4095]-s))-o),y+=256,s=this.perlin[4095&y],s+=i*(this.perlin[y+1&4095]-s),u=this.perlin[y+16&4095],s+=a*((u+=i*(this.perlin[y+16+1&4095]-u))-s),v+=(o+=oM(p)*(s-o))*m,m*=aM,c<<=1,l<<=1,h<<=1,(d*=2)>=1&&(c++,d--),(f*=2)>=1&&(l++,f--),(p*=2)>=1&&(h++,p--)}return v}},{key:"noiseSeed",value:function(e){var t=function(){var e,t;return{setSeed:function(n){t=e=(null!==n&&void 0!==n?n:4294967296*Math.random())>>>0},getSeed:function(){return e},rand:function(){return(t=(1664525*t+1013904223)%4294967296)/4294967296}}}();t.setSeed(e),this.perlin=new Array(4096);for(var n=0;n<4096;n++)this.perlin[n]=t.rand()}}]),e}(),uM=sM,cM=new tr,lM=new Dr,hM=new Cr;function dM(e){var t=!1;return e.scene.objects.traverse((function(e,n){"Mesh"===n.type&&"TextGeometry"===n.geometry.type&&(t=!0)})),t}var fM,pM,vM,mM,gM=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;return Object(E.a)(this,n),(a=t.call(this,e,r,i)).data=r,a}return Object(A.a)(n,[{key:"textGeometry",get:function(){return this.geometry}},{key:"charWidths",get:function(){return this.textGeometry.charWidths}},{key:"charCoords",get:function(){return this.textGeometry.charCoords}},{key:"wrappedText",get:function(){return this.textGeometry.wrappedText}},{key:"font",get:function(){return this.textGeometry.font}},{key:"initialOffsetY",get:function(){var e,t,n=this.dataPatched;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,n.geometry.height,this.fontScale,n.geometry.verticalAlign))&&void 0!==e?e:0}},{key:"fontScale",get:function(){var e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}},{key:"AD",get:function(){return Math.abs(this.ascender-this.descender)}},{key:"ascender",get:function(){var e,t;return(null!==(e=null===(t=this.font)||void 0===t?void 0:t.ascender)&&void 0!==e?e:1)*this.fontScale}},{key:"descender",get:function(){var e,t;return(null!==(e=null===(t=this.font)||void 0===t?void 0:t.descender)&&void 0!==e?e:1)*this.fontScale}},{key:"lineHeight",get:function(){var e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}},{key:"raycast",value:function(e,t){var n=this.matrixWorld;if(!isNaN(e.ray.origin.x)&&(lM.copy(n).invert(),hM.copy(e.ray).applyMatrix4(lM),hM.intersectBox(this.singleBBox,cM))){var r=cM.applyMatrix4(n),i=e.ray.origin.distanceTo(r);t.push({distance:i,point:r.clone(),object:this})}}}]),n}(BT),yM=1e-4,bM=new tr,wM=new tr;fE.then((function(e){pM=[(fM=e).get_face_center,fM.get_edge_midpoint,fM.get_vertex_position],vM=[fM.get_face_normal,fM.get_edge_normal,fM.get_vertex_normal],mM=[fM.face_count,fM.edge_count,fM.vertex_count]}));var xM=new Dr,OM=new Dr,kM=new tr,_M=new tr,SM=new tr,EM=new tr,AM=new tr,jM=new tr,TM=new uM,MM=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;return Object(E.a)(this,n),(i=t.call(this)).parameters=r,i.objectForSample=void 0,i._pendingMediaLoad=!1,i.object=e,i}return Object(A.a)(n,[{key:"resetOnMove",value:function(){this.removeFromParent(),this.parent=null}},{key:"expandClones",value:function(e){if(null===this.parent)this.updateState(this.parameters,e);else{var t,n=Object(j.a)(this.children);try{for(n.s();!(t=n.n()).done;){var r=t.value;r instanceof Vk&&r.expand()}}catch(i){n.e(i)}finally{n.f()}}}},{key:"invalidateTransform",value:function(e){this.matrixWorldNeedsUpdate=!0,this.traverse((function(t){t instanceof Vk&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)}))}},{key:"onObjUpdateMatrix",value:function(){"toObject"!==this.parameters.type&&(this.matrixWorldNeedsUpdate=!0)}},{key:"update",value:function(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}var e,t=Object(j.a)(this.children);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.updateMatrix(),n.hasNonUniformScale&&(n.updateMatrixWorld(),n.updateMatrixWorldSVD())}}catch(r){t.e(r)}finally{t.f()}}},{key:"_updateCount",value:function(e){var t;if(t=void 0!==e?e:"grid"===this.parameters.type?this.parameters.grid.count[0]*this.parameters.grid.count[1]*this.parameters.grid.count[2]:this.parameters.count,"toObject"===this.parameters.type&&!this.parameters.toObject.object&&(t=0),"toObject"===this.parameters.type&&this.objectForSample){for(var n=0,r=this.children.length;n<r;++n)this.remove(this.children[0]);var i=this.children;if(i.length===t)return;if(i.length<t)for(var a=0,o=t-i.length;a<o;++a){var s=new Vk(this.object);s.expand(),this.add(s)}else for(var u=0,c=i.length-t;u<c;++u)this.remove(i[u])}else{if(this.children.length===t)return;if(this.children.length<t)for(var l=0,h=t-this.children.length;l<h;++l){var d=new Vk(this.object);d.expand(),this.add(d)}else for(var f=0,p=this.children.length-t;f<p;++f)this.remove(this.children[0])}}},{key:"_updateRadial",value:function(e){var t,n,r=e.radial,i=r.start*En.DEG2RAD,a=i-r.end*En.DEG2RAD,o=new Vr(r.rotation[0],r.rotation[1],r.rotation[2]);switch(r.axis){case"z":n=new tr(0,0,1);break;case"y":n=new tr(0,1,0);break;default:n=new tr(1,0,0)}var s=null!==(t=e.randomnessObject)&&void 0!==t?t:Iw.defaultData([1,1,1]).randomnessObject,u="perlin"===s.noiseType;TM.noiseSeed(s.seed);var c,l=Mk((0,Ok.default)(s.seed)),h=YT(s.strength,this.parameters.randomness),d=Object(j.a)(this.children.entries());try{for(d.s();!(c=d.n()).done;){var f=Object(g.a)(c.value,2),p=f[0],v=f[1],m=p*(s.freqScale/10)+s.movement,y=u?TM.noise(m):l(m,m);v.scale.x=r.scale[0]+h(p,XT(y,s.scale[0]))||yM,v.scale.y=r.scale[1]+h(p,XT(y,s.scale[1]))||yM,v.scale.z=r.scale[2]+h(p,XT(y,s.scale[2]))||yM,v.position.setScalar(0);var b=a/e.count*p-i;switch(r.axis){case"x":v.rotation.set(0,b,0);break;case"y":v.rotation.set(0,0,b);break;case"z":v.rotation.set(b,0,0)}v.translateOnAxis(n,r.radius),v.position.x+=r.position[0]+h(p,XT(y,s.position[0])),v.position.y+=r.position[1]+h(p,XT(y,s.position[1])),v.position.z+=r.position[2]+h(p,XT(y,s.position[2]));var w=h(p,XT(y,s.rotation[0])),x=h(p,XT(y,s.rotation[1])),O=h(p,XT(y,s.rotation[2]));!0===r.alignment?(v.rotation.x+=o.x+w,v.rotation.y+=o.y+x,v.rotation.z+=o.z+O):v.rotation.set(o.x+w,o.y+x,o.z+O)}}catch(k){d.e(k)}finally{d.f()}}},{key:"_updateLinear",value:function(e){var t;if("linear"!==e.type)throw new Error;var n=e.linear,r=new Vr(n.rotation[0],n.rotation[1],n.rotation[2]),i=null!==(t=e.randomnessObject)&&void 0!==t?t:Iw.defaultData([1,1,1]).randomnessObject,a="perlin"===i.noiseType;TM.noiseSeed(i.seed);var o,s=Mk((0,Ok.default)(i.seed)),u=YT(i.strength,this.parameters.randomness),c=Object(j.a)(this.children.entries());try{for(c.s();!(o=c.n()).done;){var l=Object(g.a)(o.value,2),h=l[0],d=l[1],f=h*(i.freqScale/10)+i.movement,p=a?TM.noise(f):s(f,f),v=u(h,XT(p,i.rotation[0])),m=u(h,XT(p,i.rotation[1])),y=u(h,XT(p,i.rotation[2]));d.scale.x=1+(n.scale[0]-1)*h+u(h,XT(p,i.scale[0]))||yM,d.scale.y=1+(n.scale[1]-1)*h+u(h,XT(p,i.scale[1]))||yM,d.scale.z=1+(n.scale[2]-1)*h+u(h,XT(p,i.scale[2]))||yM,d.rotation.x=r.x*h+v,d.rotation.y=r.y*h+m,d.rotation.z=r.z*h+y,d.position.x=n.position[0]*h+u(h,XT(p,i.position[0])),d.position.y=n.position[1]*h+u(h,XT(p,i.position[1])),d.position.z=n.position[2]*h+u(h,XT(p,i.position[2]))}}catch(b){c.e(b)}finally{c.f()}}},{key:"_updateGrid",value:function(e){var t,n=0,r=e.grid,i=null!==(t=e.randomnessObject)&&void 0!==t?t:Iw.defaultData([1,1,1]).randomnessObject,a=YT(i.strength,this.parameters.randomness),o="perlin"===i.noiseType;TM.noiseSeed(i.seed);var s=function(){var e=Ck(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random),t=new Float64Array(e).map((function(e){return Tk[e%12*3]})),n=new Float64Array(e).map((function(e){return Tk[e%12*3+1]})),r=new Float64Array(e).map((function(e){return Tk[e%12*3+2]}));return function(i,a,o){var s,u,c,l,h,d,f,p,v,m,g=(i+a+o)*Sk,y=Ak(i+g),b=Ak(a+g),w=Ak(o+g),x=(y+b+w)*Ek,O=i-(y-x),k=a-(b-x),_=o-(w-x);O>=k?k>=_?(h=1,d=0,f=0,p=1,v=1,m=0):O>=_?(h=1,d=0,f=0,p=1,v=0,m=1):(h=0,d=0,f=1,p=1,v=0,m=1):k<_?(h=0,d=0,f=1,p=0,v=1,m=1):O<_?(h=0,d=1,f=0,p=0,v=1,m=1):(h=0,d=1,f=0,p=1,v=1,m=0);var S=O-h+Ek,E=k-d+Ek,A=_-f+Ek,j=O-p+2*Ek,T=k-v+2*Ek,M=_-m+2*Ek,C=O-1+3*Ek,D=k-1+3*Ek,I=_-1+3*Ek,P=255&y,R=255&b,L=255&w,N=.6-O*O-k*k-_*_;if(N<0)s=0;else{var B=P+e[R+e[L]];s=(N*=N)*N*(t[B]*O+n[B]*k+r[B]*_)}var F=.6-S*S-E*E-A*A;if(F<0)u=0;else{var U=P+h+e[R+d+e[L+f]];u=(F*=F)*F*(t[U]*S+n[U]*E+r[U]*A)}var z=.6-j*j-T*T-M*M;if(z<0)c=0;else{var V=P+p+e[R+v+e[L+m]];c=(z*=z)*z*(t[V]*j+n[V]*T+r[V]*M)}var G=.6-C*C-D*D-I*I;if(G<0)l=0;else{var H=P+1+e[R+1+e[L+1]];l=(G*=G)*G*(t[H]*C+n[H]*D+r[H]*I)}return 32*(s+u+c+l)}}((0,Ok.default)(i.seed));if(!0===r.useCenter)for(var u={x:r.count[0]%2===0?2:1,y:r.count[1]%2===0?2:1,z:r.count[2]%2===0?2:1},c=new tr(r.size[0]*(r.count[0]-u.x)*.5,r.size[1]*(r.count[1]-u.y)*.5,r.size[2]*(r.count[2]-u.z)*.5),l=0;l<r.count[0];l++)for(var h=0;h<r.count[1];h++)for(var d=0;d<r.count[2];d++){var f=[(l+1)*(i.freqScale/10)+i.movement,(h+1)*(i.freqScale/10)+i.movement,(d+1)*(i.freqScale/10)+i.movement],p=o?TM.noise.apply(TM,f):s.apply(void 0,f),v=this.children[n++];v.scale.x=1+a(n,XT(p,i.scale[0]))||yM,v.scale.y=1+a(n,XT(p,i.scale[1]))||yM,v.scale.z=1+a(n,XT(p,i.scale[2]))||yM;var m=a(n,XT(p,i.rotation[0])),g=a(n,XT(p,i.rotation[1])),y=a(n,XT(p,i.rotation[2]));v.rotation.set(m,g,y),v.position.x=r.size[0]*l-c.x+a(n,XT(p,i.position[0])),v.position.y=r.size[1]*h-c.y+a(n,XT(p,i.position[1])),v.position.z=r.size[2]*d-c.z+a(n,XT(p,i.position[2]))}else for(var b=0;b<r.count[0];b++)for(var w=0;w<r.count[1];w++)for(var x=0;x<r.count[2];x++){var O=[(b+1)*(i.freqScale/10)+i.movement,(w+1)*(i.freqScale/10)+i.movement,(x+1)*(i.freqScale/10)+i.movement],k=o?TM.noise.apply(TM,O):s.apply(void 0,O),_=this.children[n++];_.scale.x=1+a(n,XT(k,i.scale[0]))||yM,_.scale.y=1+a(n,XT(k,i.scale[1]))||yM,_.scale.z=1+a(n,XT(k,i.scale[2]))||yM;var S=a(n,XT(k,i.rotation[0])),E=a(n,XT(k,i.rotation[1])),A=a(n,XT(k,i.rotation[2]));_.rotation.set(S,E,A),_.position.x=r.size[0]*b+a(n,XT(k,i.position[0])),_.position.y=-r.size[1]*w+a(n,XT(k,i.position[1])),_.position.z=-r.size[2]*x+a(n,XT(k,i.position[2]))}}},{key:"_updateToObject",value:function(e){var t,n;if("toObject"!==e.type)throw new Error;var r=e.toObject,i=new Vr(r.rotation[0],r.rotation[1],r.rotation[2]),a=null!==(t=e.randomnessObject)&&void 0!==t?t:Iw.defaultData([1,1,1]).randomnessObject,o="perlin"===a.noiseType;TM.noiseSeed(a.seed);var s=Mk((0,Ok.default)(a.seed)),u=YT(a.strength,this.parameters.randomness);if(r.object){if(this.objectForSample){if(this.objectForSample instanceof gM){if(null===(n=this.objectForSample.font)||void 0===n||!n.isLoaded||void 0===this.objectForSample.geometry.attributes.position)return void(this._pendingMediaLoad=!0);this._pendingMediaLoad=!1}if(void 0!==this.objectForSample.geometry||this.object.parent!==this.objectForSample){var c=this.getSubdivData(),l=[],h=function(e){var t=e.length,n=e.map((function(e){return e[0]})).reduce((function(e,t){return e+t}),0),r=e.map((function(e){return e[1]})).reduce((function(e,t){return e+t}),0),i=e.map((function(e){return e[2]})).reduce((function(e,t){return e+t}),0);return[n/t,r/t,i/t]},d=function(e){return Math.round(1e6*e)/1e6};c.forEach((function(e){var t=c.filter((function(t){return d(e.pos[0])===d(t.pos[0])&&d(e.pos[1])===d(t.pos[1])&&d(e.pos[2])===d(t.pos[2])}));t.length>1?l.push({pos:e.pos,norm:h(t.map((function(e){return e.norm})))}):l.push(e)}));var f=function(e){for(var t=[],n={},r=0,i=e.length;r<i;r++){var a=JSON.stringify(e[r].pos.map((function(e){return Math.round(1e4*e)/1e4})));n[a]||(t.push(e[r]),n[a]=!0)}return t}(l);if(c.length>0){var p=Math.round(f.length*r.count/100);this._updateCount(p)}this.objectForSample.updateMatrixWorld();var v=new Pk(this.objectForSample).build(),m=WT[r.axis],y=this.children;v.setRandomGenerator((0,Ok.default)(this.object.uuid+r.seed));var b,w=Object(j.a)(y.entries());try{for(w.s();!(b=w.n()).done;){var x=Object(g.a)(b.value,2),O=x[0],k=x[1],_=O*(a.freqScale/10)+a.movement,S=o?TM.noise(_):s(_,_),E=u(O,XT(S,a.rotation[0])),A=u(O,XT(S,a.rotation[1])),T=u(O,XT(S,a.rotation[2]));"random"===r.spreadType?v.sample(SM,EM):(f.length&&(SM.fromArray(f[O].pos),EM.fromArray(f[O].norm)),this.objectForSample instanceof HT&&SM.applyMatrix4(xM.copy(this.objectForSample.matrixWorld).invert())),SM.applyMatrix4(this.object.hiddenMatrix.clone().invert()),k.position.copy(SM),kM.fromArray(m);var M="normal"===r.align?EM:this.object.getWorldDirection(jM),C=_M.fromArray(r.position);_M.x+=_M.x+u(O,XT(S,a.position[0])),_M.y+=_M.y+u(O,XT(S,a.position[1])),_M.z+=_M.z+u(O,XT(S,a.position[2]));var D=Math.acos(M.dot(kM)),I=AM.crossVectors(kM,M).normalize(),P=OM.makeRotationAxis(I,D),R=M.clone().cross(this.object.up).normalize(),L=R.clone().cross(M).normalize(),N=(new Dr).makeBasis(R,M,L),B=new tr(kM.y,kM.z,kM.x).normalize(),F=B.clone().cross(kM).normalize(),U=(new Dr).makeBasis(B,kM,F).invert(),z=(new Dr).multiplyMatrices(N,U);k.rotation.setFromRotationMatrix(z),C.applyMatrix4(P),k.position.add(C),k.rotation.x=k.rotation.x+i.x+E,k.rotation.y=k.rotation.y+i.y+A,k.rotation.z=k.rotation.z+i.z+T,k.scale.setScalar(1),k.scale.x=k.scale.x+r.scale[0]+u(O,XT(S,a.scale[0]))||yM,k.scale.y=k.scale.y+r.scale[1]+u(O,XT(S,a.scale[1]))||yM,k.scale.z=k.scale.z+r.scale[2]+u(O,XT(S,a.scale[2]))||yM,k.scale.multiply(this.object.scale),k.hiddenMatrix=this.object.hiddenMatrix}}catch(W){w.e(W)}finally{w.f()}}else console.warn('Oh no! The object "'.concat(this.object.name,'" (').concat(this.object.uuid,") seem to be a child of the object it's being cloned to. Please re-parent it so that they are siblings instead."))}}else{var V,G=Object(j.a)(this.children.entries());try{for(G.s();!(V=G.n()).done;){var H=Object(g.a)(V.value,2)[1];H.position.set(0,0,0),H.scale.setScalar(1),H.rotation.set(0,0,0)}}catch(W){G.e(W)}finally{G.f()}this.objectForSample=void 0}}},{key:"getSubdivData",value:function(){if(!this.objectForSample)return[];var e=this.parameters.toObject.spreadType;if("random"===e)return[];if(this.objectForSample instanceof HT){for(var t=this.objectForSample,n=qT[e],r=mM[n],i=pM[n],a=vM[n],o=[],s=r(t.subdivPointerNew),u=0;u<=s-1;u++){var c=i(t.subdivPointerNew,u),l=a(t.subdivPointerNew,u);bM.fromArray(c).applyMatrix4(t.matrixWorld),wM.fromArray(l),o.push({pos:bM.toArray(),norm:wM.toArray()})}return o}return(this.objectForSample.geometry.index?function(e){for(var t=[],n=0;n<=e.index.count;n++)if(tM.fromArray(e.index.array,3*n),eM.setFromAttributeAndIndices(e.attributes.position,tM.x,tM.y,tM.z),eM.getNormal(nM),eM.getMidpoint(rM),!(isNaN(rM.x)||isNaN(rM.y)||isNaN(rM.z))){var r=eM.a,i=eM.b,a=eM.c,o=r.toArray(),s=i.toArray(),u=a.toArray(),c=r.distanceTo(i),l=i.distanceTo(a),h=a.distanceTo(r),d=$T(o,s),f=$T(s,u),p=$T(u,o),v=[c,l,h],m=Math.max.apply(Math,v),g=v.filter((function(e){return Math.round(e)===Math.round(m)})).length>1,y=[],b=eM.getMidpoint(rM).toArray();m===c&&!g&&(y=[f,p,p],b=d),m===l&&!g&&(y=[d,p,p],b=f),m===h&&!g&&(y=[d,f,f],b=p),g&&(y=[d,f,p]),t.push({vertices:[o,s,u],faceCenters:y,midpoint:b,norm:eM.getNormal(nM).toArray()})}return t}(this.objectForSample.geometry):function(e){for(var t=[],n=e.attributes.position,r=0;r<n.count;r++){eM.setFromAttributeAndIndices(n,3*r,3*r+1,3*r+2),eM.getNormal(nM),eM.getMidpoint(rM);var i=eM.a.toArray(),a=eM.b.toArray(),o=eM.c.toArray();t.push({vertices:[i,a,o],faceCenters:[$T(i,a),$T(a,o),$T(o,i)],midpoint:rM.toArray(),norm:nM.toArray()})}return t}(this.objectForSample.geometry)).map((function(t,n){return"polygon_center"===e?{pos:t.midpoint,norm:t.norm}:"vertex"===e?[{pos:t.vertices[0],norm:t.norm},{pos:t.vertices[1],norm:t.norm},{pos:t.vertices[2],norm:t.norm}]:"edge"===e?[{pos:t.faceCenters[0],norm:t.norm},{pos:t.faceCenters[1],norm:t.norm},{pos:t.faceCenters[2],norm:t.norm}]:[]})).flat()}},{key:"updateState",value:function(e,t){var n;if(this.parameters=Lm(e),"toObject"!==this.parameters.type)(null===this.parent||this.parent!==this.object)&&(this.removeFromParent(),null!==(n=this.object.parent)&&void 0!==n&&n.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(null===this.parent||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();var r=t.find(this.parameters.toObject.object);this.objectForSample=r instanceof rA?r:void 0,this.matrix=new Dr,this.hiddenMatrix=new Dr,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,r&&r.add(this)}this.update()}},{key:"pendingMediaLoad",get:function(){return this._pendingMediaLoad}}]),n}(Uk(ri)),CM=function(e){var t;return t=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n)}(e),t.geometryHelper=new Ji(30,30,30),t},DM=new Cr,IM=new kr,PM=new Dr,RM=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=t,o=e.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),IM.copy(a.boundingSphere),IM.applyMatrix4(o),!1!==n.ray.intersectsSphere(IM)&&(PM.copy(o).invert(),DM.copy(n.ray).applyMatrix4(PM),null===a.boundingBox||!1!==DM.intersectsBox(a.boundingBox))){var s,u,c,l,h,d,f=a.index,p=a.attributes.position,v=a.drawRange;if(!1===i){for(h=Math.max(0,v.start),d=Math.min(f.count,v.start+v.count);h<d;h+=3)if(u=f.getX(h),c=f.getX(h+1),l=f.getX(h+2),s=E(e,n,DM,p,u,c,l))return s.faceIndex=Math.floor(h/3),void r.push(s)}else for(var m=a.attributes.position,g=new tr,y=new tr,b=new tr,w=new tr,x=1/((e.scale.x+e.scale.y+e.scale.z)/3),O=x*x,k=Math.max(0,v.start),_=Math.min(m.count,v.start+v.count)-1;k<_;k+=2)if(g.fromBufferAttribute(m,k),y.fromBufferAttribute(m,k+1),!(DM.distanceSqToSegment(g,y,w,b)>O)){w.applyMatrix4(e.matrixWorld);var S=n.ray.origin.distanceTo(w);S<n.near||S>n.far||r.push({distance:S,point:b.clone().applyMatrix4(e.matrixWorld),object:e})}}function E(e,t,n,r,i,a,o){var s=new tr,u=new tr,c=new tr,l=new tr,h=new tr;if(s.fromBufferAttribute(r,i),u.fromBufferAttribute(r,a),c.fromBufferAttribute(r,o),null===n.intersectTriangle(s,u,c,!1,l))return null;h.copy(l),h.applyMatrix4(e.matrixWorld);var d=t.ray.origin.distanceTo(h);return d<t.near||d>t.far?null:{faceIndex:1,distance:d,point:h.clone(),object:e}}},LM=new tr,NM=new aa,BM=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;Object(E.a)(this,n);var i=new Di,a=new cu({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],s=[],u={},c=new Gn(15711266),l=new Gn(15711266),h=new Gn(2857471);function d(e,t,n){f(e,n),f(t,n)}function f(e,t){o.push(0,0,0),s.push(t.r,t.g,t.b),void 0===u[e]&&(u[e]=[]),u[e].push(o.length/3-1)}return d("n1","n2",c),d("n2","n4",c),d("n4","n3",c),d("n3","n1",c),d("f1","f2",c),d("f2","f4",c),d("f4","f3",c),d("f3","f1",c),d("n1","f1",c),d("n2","f2",c),d("n3","f3",c),d("n4","f4",c),d("p","n1",l),d("p","n2",l),d("p","n3",l),d("p","n4",l),d("u1","u2",h),d("u2","u3",h),d("u3","u1",h),i.setAttribute("position",new _i(o,3)),i.setAttribute("color",new _i(s,3)),(r=t.call(this,i,a)).type="CameraHelper",r.camera=e,r.camera.updateProjectionMatrix&&r.camera.updateProjectionMatrix(),r.matrix=e.matrixWorld,r.matrixAutoUpdate=!1,r.pointMap=u,r.update(),r}return Object(A.a)(n,[{key:"update",value:function(){var e=this.geometry,t=this.pointMap;NM.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];var n=.8;FM("n1",t,e,NM,-1,-1,n),FM("n2",t,e,NM,1,-1,n),FM("n3",t,e,NM,-1,1,n),FM("n4",t,e,NM,1,1,n);var r=n;FM("f1",t,e,NM,-1,-1,r),FM("f2",t,e,NM,1,-1,r),FM("f3",t,e,NM,-1,1,r),FM("f4",t,e,NM,1,1,r);FM("u1",t,e,NM,.35,1.1,.8),FM("u2",t,e,NM,-.35,1.1,.8),FM("u3",t,e,NM,0,1.55,.8),e.getAttribute("position").needsUpdate=!0}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(yu);function FM(e,t,n,r,i,a,o){LM.set(i,a,o).unproject(r);var s=t[e];if(void 0!==s)for(var u=n.getAttribute("position"),c=0,l=s.length;c<l;c++)u.setXYZ(s[c],LM.x,LM.y,LM.z)}var UM,zM=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,e)).object=e,r.object=e,r.name="CombinedCameraHelper: ".concat(e.uuid),r}return Object(A.a)(n,[{key:"updateMatrixWorld",value:function(e){Object(b.a)(Object(w.a)(n.prototype),"updateMatrixWorld",this).call(this,e),this.updateTarget()}},{key:"updateTarget",value:function(){var e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}},{key:"raycast",value:function(e,t){RM(this.object,this.geometry,e,t,!0)}}]),n}(CM(BM));!function(e){e.is=function(e){return"objectHelper"in e}}(UM||(UM={}));var VM=function(e,t){return function(e){Object(O.a)(r,e);var n=Object(k.a)(r);function r(){var e;return Object(E.a)(this,r),(e=n.apply(this,arguments)).objectHelper=new t(Object(x.a)(e)),e.gizmos={},e}return Object(A.a)(r,[{key:"geometryHelper",get:function(){return t.geometryHelper}},{key:"raycast",value:function(e,t){this.objectHelper.raycast(e,t)}},{key:"showGizmos",value:function(){for(var e in this.gizmos){var t=this.gizmos[e];t instanceof Vl&&(t.visible=!0)}}},{key:"updateEntityBoxSize",value:function(e,t){this.objectHelper.visible&&this.geometryHelper instanceof Ji?(e.setScalar(0),t.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):Object(b.a)(Object(w.a)(r.prototype),"updateEntityBoxSize",this).call(this,e,t)}},{key:"hideGizmos",value:function(){for(var e in this.gizmos){var t=this.gizmos[e];t instanceof Vl&&(t.visible=!1)}}}]),r}($k(e))},GM=790,HM=new tr,WM=new tr,qM=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(p.a)(Object(p.a)({},sx.defaultData),{},{name:""});Object(E.a)(this,n),(e=t.call(this))._cameraType="OrthographicCamera",e.targetOffset=Dw.DefaultTargetOffset,e.isUpVectorFlipped=!1,e.angleOffsetFromUp=0,e.super_Entity(r,i),e.matrixAutoUpdate=!0,e.width=window.innerWidth,e.height=window.innerHeight;var a=e.width,o=e.height;if(i.orthographic.autoZoom){var s,u=null!==(s=i.orthographic.autoZoomFrustumSize)&&void 0!==s?s:GM,c=a/o,l=a>o?c:1,h=a>o?1:c;e.orthoCamera=new Ca(.5*-u*l,.5*u*l,.5*u*(1/h),.5*-u*(1/h),-5e4,1e4)}else e.orthoCamera=new Ca(-.5*a,.5*a,.5*o,-.5*o,-5e4,1e4);return e.perspCamera=new oa(45,a/o,50,1e4),e.left=e.orthoCamera.left,e.right=e.orthoCamera.right,e.top=e.orthoCamera.top,e.bottom=e.orthoCamera.bottom,e.far=e.orthoCamera.far,e.view=e.orthoCamera.view,e.aspect=e.perspCamera.aspect,e.focus=e.perspCamera.focus,e.filmGauge=e.perspCamera.filmGauge,e.filmOffset=e.perspCamera.filmOffset,e.objectHelper.update(),e}return Object(A.a)(n,[{key:"isPerspectiveCamera",get:function(){return"PerspectiveCamera"===this.cameraType}},{key:"isOrthographicCamera",get:function(){return!this.isPerspectiveCamera}},{key:"cameraType",get:function(){return this._cameraType},set:function(e){"PerspectiveCamera"===e?this.toPerspective():"OrthographicCamera"===e&&this.toOrthographic()}},{key:"fov",get:function(){return this.perspCamera.fov},set:function(e){this.perspCamera.fov=e}},{key:"setNear",value:function(e,t){"PerspectiveCamera"===e?this.perspCamera.near=t:this.orthoCamera.near=t}},{key:"setZoom",value:function(e,t){t>=0&&("PerspectiveCamera"===e?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}},{key:"near",get:function(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.near:this.orthoCamera.near},set:function(e){"PerspectiveCamera"===this._cameraType?this.perspCamera.near=e:this.orthoCamera.near=e}},{key:"zoom",get:function(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.zoom:this.orthoCamera.zoom},set:function(e){e>=0&&("PerspectiveCamera"===this._cameraType?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}},{key:"lookAt",value:function(e){Object(b.a)(Object(w.a)(n.prototype),"lookAt",this).call(this,e),this.getWorldPosition(HM),this.targetOffset=HM.distanceTo(e)}},{key:"getTarget",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tr;return this.getWorldDirection(WM),this.getWorldPosition(HM),WM.multiplyScalar(this.targetOffset),e.copy(HM).add(WM),e}},{key:"getDistanceToTarget",value:function(){var e=this.getTarget();return this.getWorldPosition(HM),HM.distanceTo(e)}},{key:"updateUp",value:function(){var e=this.getWorldQuaternion(new er),t=new tr(0,0,1).applyQuaternion(e),n=(new tr).copy(ri.DefaultUp);this.isUpVectorFlipped&&n.negate(),n.applyQuaternion(e);var r=(new tr).copy(ri.DefaultUp).projectOnPlane(t),i=(new tr).crossVectors(r,n).dot(t)>=0?1:-1;this.angleOffsetFromUp=r.angleTo(n)*i}},{key:"updateTransformState",value:function(e){var t=Object(b.a)(Object(w.a)(n.prototype),"updateTransformState",this).call(this,e);return void 0!==e.isUpVectorFlipped&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),t}},{key:"getViewFrontToObject",value:function(e){var t=e.getWorldPosition(new tr),n=e.getWorldDirection(new tr).multiplyScalar(this.targetOffset);return{position:t.clone().add(n),target:t}}},{key:"getViewToObject",value:function(e){var t=e.getWorldPosition(new tr),n=this.getWorldDirection(new tr).multiplyScalar(this.targetOffset);return{position:t.clone().sub(n),target:t}}},{key:"setViewplaneSize",value:function(e,t){if(this.aspect=e/t,"OrthographicCamera"===this.data.type&&this.data.orthographic.autoZoom){var n,r=null!==(n=this.data.orthographic.autoZoomFrustumSize)&&void 0!==n?n:GM,i=e>t?this.aspect:1,a=e>t?1:this.aspect;this.left=.5*-r*i,this.right=.5*r*i,this.top=.5*r*(1/a),this.bottom=.5*-r*(1/a)}else this.left=.5*-e,this.right=.5*e,this.top=.5*t,this.bottom=.5*-t;this.updateProjectionMatrix()}},{key:"toOrthographic",value:function(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}},{key:"toPerspective",value:function(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}},{key:"setFocalLength",value:function(e){this.perspCamera.setFocalLength(e),this.toPerspective()}},{key:"getFocalLength",value:function(){return this.perspCamera.getFocalLength()}},{key:"getEffectiveFOV",value:function(){return this.perspCamera.getEffectiveFOV()}},{key:"getFilmWidth",value:function(){return this.perspCamera.getFilmWidth()}},{key:"getFilmHeight",value:function(){return this.perspCamera.getFilmHeight()}},{key:"setViewOffset",value:function(e,t,n,r,i,a){"PerspectiveCamera"===this._cameraType?this.perspCamera.setViewOffset(e,t,n,r,i,a):this.orthoCamera.setViewOffset(e,t,n,r,i,a)}},{key:"clearViewOffset",value:function(){"PerspectiveCamera"===this._cameraType?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}},{key:"updateProjectionMatrix",value:function(){"PerspectiveCamera"===this._cameraType?this.toPerspective():"OrthographicCamera"===this._cameraType&&this.toOrthographic()}},{key:"updateMatrixWorld",value:function(e){Object(b.a)(Object(w.a)(n.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(e,t){Object(b.a)(Object(w.a)(n.prototype),"updateWorldMatrix",this).call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"copy",value:function(e,t){return Object(b.a)(Object(w.a)(n.prototype),"copy",this).call(this,e,t),this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=null===e.view?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}},{key:"toCameraState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom,autoZoom:!0,autoZoomFrustumSize:GM},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return Rg(t,e)}},{key:"updateCameraSubtype",value:function(e,t){var n="perspective"===e?"PerspectiveCamera":"OrthographicCamera";void 0!==t.zoom&&this.setZoom(n,t.zoom),void 0!==t.near&&this.setNear(n,t.near),void 0!==t.fov&&"PerspectiveCamera"===n&&(this.fov=t.fov)}},{key:"updateState",value:function(e){this.updateCameraState(e)}},{key:"updateCameraState",value:function(e){this.updateState_Entity(e,{}),void 0!==e.far&&(this.far=e.far),void 0!==e.orthographic&&this.updateCameraSubtype("orthographic",e.orthographic),void 0!==e.perspective&&this.updateCameraSubtype("perspective",e.perspective),void 0!==e.type&&(this.cameraType=e.type),void 0!==e.up&&this.up.fromArray(e.up),void 0!==e.targetOffset&&(this.targetOffset=e.targetOffset),void 0!==e.isUpVectorFlipped&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}},{key:"updateByPatchedOp",value:function(e,t,r){Object(b.a)(Object(w.a)(n.prototype),"updateByPatchedOp",this).call(this,e,t,r),1===e.path.length&&0===e.type&&this.updateCameraSubtype(e.path[0],e.props)}},{key:"toState",value:function(e){return Object(p.a)(Object(p.a)(Object(p.a)({},Object(b.a)(Object(w.a)(n.prototype),"toState",this).call(this,e)),this.toCameraState(e)),{},{type:this.cameraType})}}]),n}(VM(aa,zM)),YM=new Dr;function XM(e){var t=!1;return e.scene.objects.traverse((function(e,n){var r;"BooleanGeometry"===(null===(r=n.geometry)||void 0===r?void 0:r.type)&&(t=!0)})),t}var KM,QM=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;return Object(E.a)(this,n),(a=t.call(this,e,r)).data=r,a.meshSetAddresses=[],a.needsTransformForDownstream=!1,a.geometry=new Di,a.geometry.userData.parameters={width:0,height:0,depth:0},a}return Object(A.a)(n,[{key:"booleanOp",get:function(){return this.data.geometry.operation}},{key:"phongAngle",get:function(){var e;return null!==(e=this.data.geometry.phongAngle)&&void 0!==e?e:45}},{key:"isLOD",get:function(){return this.recomputeBoolean(),!1}},{key:"updateByPatchedOp",value:function(e,t,r){Object(b.a)(Object(w.a)(n.prototype),"updateByPatchedOp",this).call(this,e,t,r),1===e.path.length&&"geometry"===e.path[0]&&0===e.type&&void 0!==e.props.operation&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}},{key:"freeBooleanPointer",value:function(){Object(b.a)(Object(w.a)(n.prototype),"freeBooleanPointer",this).call(this),this.geometry.dispose()}},{key:"recomputeBoolean",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(-1===this.booleanMeshSetAddress||e){for(var r=0;r<this.children.length;r++){var i=this.children[r];i instanceof n&&i.recomputeBoolean(!0===e,t)}this.meshSetAddresses=[];for(var a=0;a<this.children.length;a++){var o,s=this.children[a];if(s instanceof rA&&!0===s.dataPatched.visible&&(null===(o=s.geometry.attributes.position)||void 0===o?void 0:o.count)>0&&s.geometry.drawRange.count>0){if(-1===s.booleanMeshSetAddress){var u;if((null!==(u=s.geometry.index)&&void 0!==u?u:s.geometry.getAttribute("position")).count/3<15e5&&(s.booleanMeshSetAddress=PE.getMeshSet(s.geometry,!0===e,t)),-1===s.booleanMeshSetAddress)return;PE.transformMeshSet(s.booleanMeshSetAddress,s.matrix),s.booleanMatrixInvOld.copy(s.matrix).invert(),s.booleanWasTransformed=!1}else s instanceof n&&!0===s.needsTransformForDownstream?(PE.transformMeshSet(s.booleanMeshSetAddress,s.matrix),s.needsTransformForDownstream=!1):!0===s.booleanWasTransformed&&(YM.multiplyMatrices(s.matrix,s.booleanMatrixInvOld),PE.transformMeshSet(s.booleanMeshSetAddress,YM),s.booleanMatrixInvOld.copy(s.matrix).invert(),s.booleanWasTransformed=!1);this.meshSetAddresses.push(s.booleanMeshSetAddress)}}if(0===this.meshSetAddresses.length)return this.geometry.setAttribute("position",new ki([],0)),void this.geometry.setDrawRange(0,0);if(!0===e)return PE.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);var c=this.geometry;c.dispose(),this.geometry=new Di,this.geometry.userData=c.userData,this.geometry.boundingSphere=c.boundingSphere;try{this.booleanMeshSetAddress=PE.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(r){this.booleanMeshSetAddress=0,console.error(r)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,FT(this),UT(this)}}},{key:"dispose",value:function(){Object(b.a)(Object(w.a)(n.prototype),"dispose",this).call(this),this.geometry.dispose()}}]),n}(NT);!function(e){e.is=function(e){return Fk.is(e)&&e instanceof Hc}}(KM||(KM={}));var ZM=function(e,t){return function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(A.a)(n,[{key:"updateState_Light",value:function(e,t){this.updateState_Entity(e,t),void 0!==e.color&&(this.color=t.shared.color(e.color)),void 0!==e.intensity&&(this.intensity=e.intensity),void 0!==e.depth&&(this.shadow.camera.far=e.depth,this.shadow.needsUpdate=!0),void 0!==e.shadows&&(this.castShadow=e.shadows)}}]),n}(VM(e,t))},JM=function(e){return e instanceof rA},$M=function(e){return null!==e&&e instanceof QM},eC=function(e){return e instanceof qM},tC=function(e){return KM.is(e)},nC=function(e){return UM.is(e)},rC=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;return Object(E.a)(this,n),(r=t.call(this,i)).object=e,r.object.updateMatrixWorld(),r.name="EmptyObjectHelper: ".concat(e.uuid),r.matrix=e.matrixWorld,r.matrixAutoUpdate=!1,r}return Object(A.a)(n,[{key:"raycast",value:function(e,t){RM(this.object,n.geometryHelper,e,t)}},{key:"update",value:function(){}}]),n}(CM(Gl)),iC=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;return Object(E.a)(this,n),(i=t.call(this)).super_Entity(e,r),i.objectHelper.update(),i}return Object(A.a)(n,[{key:"updateState",value:function(e,t){this.updateState_Entity(e,t)}}]),n}(VM(Ks,rC)),aC=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10066329;return Object(E.a)(this,n),(r=t.call(this,e,i,a)).object=e,r.added=!1,r.name="DirectionalLightHelper: ".concat(e.uuid),r}return Object(A.a)(n,[{key:"raycast",value:function(e,t){RM(this.object,n.geometryHelper,e,t)}}]),n}(CM(Nl)),oC=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6710886;return Object(E.a)(this,n),(r=t.call(this,e,i,a)).object=e,r.name="PointLightHelper: ".concat(e.uuid),r}return Object(A.a)(n,[{key:"raycast",value:function(e,t){RM(this.object,n.geometryHelper,e,t)}}]),n}(CM(Il)),sC=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6710886;return Object(E.a)(this,n),(r=t.call(this,e,i)).object=e,r.name="SpotLightHelper: ".concat(e.uuid),r}return Object(A.a)(n,[{key:"raycast",value:function(e,t){RM(this.object,n.geometryHelper,e,t)}},{key:"update",value:function(){if(void 0!==this.object){var e=n._vector,t=this.object.distance?this.object.distance:1e3,r=t*Math.tan(this.object.angle);this.cone.scale.set(r,r,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);var i=void 0!==this.color?this.color:this.light.color;if(this.cone.material instanceof Array)for(var a=0,o=this.cone.material.length;a<o;a++)this.cone.material[a].color.set(i);else this.cone.material.color.set(i)}}}]),n}(CM(Dl)),uC=sC;uC._vector=new tr;var cC=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;Object(E.a)(this,n),(a=t.call(this)).super_Entity(e,r),a.castShadow=!0,a.shadow.mapSize.width=2048,a.shadow.mapSize.height=2048,a.shadow.normalBias=1,a.layers.enable(3);var o=a.shadow.camera;o.top=1250,o.bottom=-1250,o.right=1250,o.left=-1250,o.near=-1e4,o.far=2500;var s=new Ul(a.shadow.camera);return s.visible=!1,a.gizmos.shadowmap=s,a}return Object(A.a)(n,[{key:"update",value:function(){for(var e in this.shadow.camera.updateProjectionMatrix(),this.gizmos){var t=this.gizmos[e];t instanceof Ul&&t.update()}}},{key:"updateMatrixWorld",value:function(e){Object(b.a)(Object(w.a)(n.prototype),"updateMatrixWorld",this).call(this,e),this.objectHelper&&this.objectHelper.update()}},{key:"updateState",value:function(e,t){this.updateState_Light(e,t);var n=void 0!==e.depth&&e.depth!==this.shadow.camera.far||void 0!==e.size&&e.size/2!==this.shadow.camera.right;void 0!==e.size&&function(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}(this,e.size),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),n&&this.update()}}]),n}(ZM(il,aC)),lC=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;Object(E.a)(this,n),(a=t.call(this)).super_Entity(e,r),a.castShadow=!0,a.shadow.mapSize.width=1024,a.shadow.mapSize.height=1024,a.shadow.normalBias=1,a.layers.enable(3);var o=a.shadow.camera;o.fov=90,o.aspect=1,o.near=100,o.far=2500;var s=new tr(-o.far+a.position.x,-o.far+a.position.y,-o.far+a.position.z),u=new tr(o.far+a.position.x,o.far+a.position.y,o.far+a.position.z),c=new ir(s,u),l=new Vl(c,new Gn(16755200));return l.visible=!1,a.gizmos.shadowmap=l,a.update(),a}return Object(A.a)(n,[{key:"update",value:function(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(var e in this.gizmos){var t=this.gizmos[e];if(t instanceof Vl){var n=this.shadow.camera,r=new tr(-n.far+this.position.x,-n.far+this.position.y,-n.far+this.position.z),i=new tr(n.far+this.position.x,n.far+this.position.y,n.far+this.position.z);t.box.set(r,i),t.updateMatrixWorld(!0)}}}},{key:"updateMatrixWorld",value:function(e){Object(b.a)(Object(w.a)(n.prototype),"updateMatrixWorld",this).call(this,e),this.objectHelper&&this.objectHelper.update()}},{key:"updateState",value:function(e,t){this.updateState_Light(e,t),void 0!==e.distance&&(this.distance=e.distance),void 0!==e.decay&&(this.decay=e.decay),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}}]),n}(ZM(nl,oC)),hC=new tr,dC=new tr,fC=new er,pC=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;Object(E.a)(this,n),(a=t.call(this)).super_Entity(e,r),a.castShadow=!0,a.shadow.mapSize.width=1024,a.shadow.mapSize.height=1024,a.shadow.normalBias=1,a.layers.enable(3);var o=a.shadow.camera;o.fov=2*En.RAD2DEG*a.angle,o.aspect=1,o.near=100,o.far=2500;var s=new Ul(a.shadow.camera);return s.visible=!1,a.gizmos.shadowmap=s,a.update(),a}return Object(A.a)(n,[{key:"update",value:function(){for(var e in this.shadow.camera.updateProjectionMatrix(),this.gizmos){var t=this.gizmos[e];t instanceof Ul&&t.update()}}},{key:"updateMatrixWorld",value:function(e){Object(b.a)(Object(w.a)(n.prototype),"updateMatrixWorld",this).call(this,e),dC.setFromMatrixPosition(this.matrixWorld),fC.setFromRotationMatrix(this.matrixWorld),hC.copy(this.up).applyQuaternion(fC).negate().multiplyScalar(this.distance),this.target.position.copy(dC).add(hC),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}},{key:"updateState",value:function(e,t){this.updateState_Light(e,t),void 0!==e.distance&&(this.distance=e.distance),void 0!==e.decay&&(this.decay=e.decay),void 0!==e.angle&&(this.angle=e.angle),void 0!==e.penumbra&&(this.penumbra=e.penumbra),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}}]),n}(ZM(Zc,uC)),vC=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){return Object(E.a)(this,n),t.call(this,e,r,i)}return Object(A.a)(n,[{key:"forceComputeSize",get:function(){return!0}},{key:"shape",get:function(){return this.geometry.userData.shape}},{key:"updateEntityBoxSize",value:function(e,t){var r=this.geometry.getAttribute("position");void 0!==r?eA(r,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:r.count,e,t):Object(b.a)(Object(w.a)(n.prototype),"updateEntityBoxSize",this).call(this,e,t)}}]),n}(BT),mC=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;return Object(E.a)(this,n),a=t.call(this),"Instance"===r.type&&"string"==typeof e&&(r=a.transformAssignData(r,i)),a.super_Entity(e,r),a.objectHelper.update(),a}return Object(A.a)(n,[{key:"isComponentRoot",get:function(){return"Component"===this.data.type&&"string"==typeof this.identity}},{key:"isInstanceRoot",get:function(){return"Instance"===this.data.type&&"string"==typeof this.identity}},{key:"transformAssignData",value:function(e,t){var n=t.scene.data.objects.get(e.component);if(n){var r,i,a,o,s=Object(j.a)(lx.rootOverrideProps);try{for(s.s();!(o=s.n()).done;){var u=o.value;void 0===e[u]?(void 0===i&&(i=Object(p.a)({},e)),i[u]=n.data[u]):(void 0===a&&(a={}),a[u]=e[u])}}catch(c){s.e(c)}finally{s.f()}return this.overrideData=a,null!==(r=i)&&void 0!==r?r:e}return e}},{key:"updateByOp",value:function(e,t,r,i){var a,o;if(this.isInstanceRoot&&!i&&(t=this.transformAssignData(t,r),0===e.type&&0===e.path.length&&this.component)){var s,u=Object(j.a)(lx.rootOverrideProps);try{for(u.s();!(s=u.n()).done;){var c=s.value;c in e.props&&void 0===e.props[c]&&(void 0===o&&(o=Object(p.a)(Object(p.a)({},e),{},{props:Object(p.a)({},e.props)})),o.props[c]=this.component.data[c])}}catch(l){u.e(l)}finally{u.f()}}Object(b.a)(Object(w.a)(n.prototype),"updateByOp",this).call(this,null!==(a=o)&&void 0!==a?a:e,t,r,i)}},{key:"updateState",value:function(e,t){this.updateState_Entity(e,t)}},{key:"expandInstanceChildren",value:function(e){var t=this.data;if(void 0===this.component){var n;this.component=null!==(n=e.scene.find(t.component))&&void 0!==n?n:null;var r=!1;if(this.component!==this.oldComponent){if(this.oldComponent){var i,a=0,o=Object(j.a)(this.children);try{for(o.s();!(i=o.n()).done;){var s=i.value;if(!Fk.is(s))break;e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),gC(s),a+=1}}catch(u){o.e(u)}finally{o.f()}this.children.splice(0,a)}r=!0}this.component&&bC(e,[this.uuid],t.overrides,this,this.component,this.component,0,r),this.oldComponent=this.component}}}]),n}(VM(Ks,rC));function gC(e){if(e.component){var t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);var n,r=Object(j.a)(e.children);try{for(r.s();!(n=r.n()).done;){var i=n.value;Fk.is(i)&&gC(i)}}catch(a){r.e(a)}finally{r.f()}}}function yC(e,t,n,r){return e.component===t&&Cg(e.identity,r)?e.overrideData===n?2:1:0}function bC(e,t,n,r,i,a,o,s){if(o>50)return!1;if(r.component!==i){if(r.component){var u=r.component.instances.indexOf(r);u>=0&&r.component.instances.splice(u,1)}i.instances.push(r),r.component=i}i instanceof mC&&i.isInstanceRoot&&i.expandInstanceChildren(e);var c,l=0,h=Object(j.a)(i.children);try{for(h.s();!(c=h.n()).done;){var d=c.value;if(Fk.is(d)){var f=[].concat(Object(v.a)(t),Object(v.a)("string"==typeof d.identity?[d.identity]:d.identity)),m=cx.resolve(n,f,1),g=null,y=void 0;if(!s){var b,w=r.children[l];if(null!==(g=Fk.is(w)?w:null)){var x=yC(g,d,m,f);y=x>=1?g.stateSelection:void 0,2!==x&&(g=null)}if(null===g&&null!==(g=null!==(b=e.scene.findInstance(f))&&void 0!==b?b:null)){var O=yC(g,d,m,f);if(y=O>=1?g.stateSelection:void 0,2!==O)g=null;else{var k=g.parent.children.indexOf(g);g.parent.children.splice(k,1),r.children.splice(l,0,g),g.parent===r?k<=l&&console.error("not possible"):(g.parent=r,g.matrixWorldNeedsUpdate=!0,g.resetBBoxNeedsUpdate(),g.updateVisible(),e.pendingDeletes.delete(g))}}}if(null===g){var _=m?iy.apply(d.data,m):d.data;Cw.is(_.type)&&(_=Object(p.a)(Object(p.a)({},_),{},{type:"Empty"})),(g=Zk.createEntity(f,_,e)).overrideData=m,r.add(g),r.children.splice(r.children.length-1,1),r.children.splice(l,0,g),g.updateState(g.data,e),y&&g.changeSelectedState(y,e),e.scene.registerInstanceAndSetUuid(g)}l+=1,bC(e,t,n,g,d,a,o+1,s)}}}catch(A){h.e(A)}finally{h.f()}if(!s){for(var S=l;;){var E=r.children[l];if(!Fk.is(E))break;e.pendingDeletes.add(E),l+=1}r.children.splice(S,l-S)}return!0}function wC(e,t,n){return"Mesh"===t.type?function(e,t,n){return"TextGeometry"===t.geometry.type?new gM(e,t,n):"SubdivGeometry"===t.geometry.type?new HT(e,t,n):"VectorGeometry"===t.geometry.type?new vC(e,t,n):"BooleanGeometry"===t.geometry.type?new QM(e,t,n):new BT(e,t,n)}(e,t,n):"Empty"===t.type?new iC(e,t):"PointLight"===t.type?new lC(e,t,n):"SpotLight"===t.type?new pC(e,t,n):"DirectionalLight"===t.type?new cC(e,t,n):"Component"===t.type||"Instance"===t.type?new mC(e,t,n):Cw.is(t.type)?new qM(e,t):(console.error(t),new iC(e,t))}function xC(e,t){var n=!1,r=t.getLayersOfType("transmission"),i=t.getLayersOfType("outline");return i.length>0&&(e.layers.set(8),r.length>0&&e.layers.enable(3),n=!0,UT(e),FT(e)),0===r.length&&0===i.length&&e.layers.set(0),n}function OC(e,t){if(!t.layers)return!1;var n=!1,r=t.getLayersOfType("transmission"),i=t.getLayersOfType("outline");return r.length>0&&(e.layers.set(3),i.length>0&&e.layers.enable(8),n=!0),0===r.length&&0===i.length&&e.layers.set(0),n}Zk.createEntity=wC,Zk.changeEntityProptotype=function(e,t,n){var r=wC(e.identity,t,n),i=e.children,a=e.parent,o=e.component,s=e.instances,u=e.overrideData,c=e.uuid,l=e.stateSelection;e.dispose();for(var h=0,d=Object.keys(e);h<d.length;h++){delete e[d[h]]}Object.setPrototypeOf(e,Object.getPrototypeOf(r));for(var f=0,p=Object.keys(r);f<p.length;f++){var m=p[f];e[m]=r[m]}e.children=[].concat(Object(v.a)(e.children),Object(v.a)(i)),e.parent=a,e.component=o,e.instances=s,e.uuid=c,e.overrideData=u,e.updateState(e.data,n),l&&e.changeSelectedState(l,n),e.resetBBoxNeedsUpdate()},Zk.Cloner=MM;var kC=new Ol,_C=new Dr,SC=new Cr;function EC(e,t,n){var r=e.cloner;if(r){var i,a=Object(j.a)(r.children);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=_C.copy(o.matrixWorld).invert(),u=SC.copy(t.ray).applyMatrix4(s),c=e.matrixWorld;u.applyMatrix4(c);var l=kC;l.set(u.origin,u.direction),l.near=t.near,l.far=t.far,l.intersectObject(e,!1).length>0&&n.push({object:e})}}catch(h){a.e(h)}finally{a.f()}}}var AC=function(e){return"\n\n// PCSS implementation based on:\n// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/\n// NOTE: This number affects how big the shadow blur can\n// possibly get. Bigger number == bigger blur, but less precise results\n\nconst float  gPenumbraFilterSize = 80.0;\nconst int   gPenumbraSamples = ".concat(e,";\nconst int gShadowSamples = ").concat(e,";\nconst float gShadowSamplesRpc = 1.0f / float(gShadowSamples);\n\nvec2 vogelDiskSample(int sample_index, int sample_count, float angle)\n{\n  const float goldenAngle = 2.399963f; // radians\n  float r = sqrt(float(sample_index) + 0.5f) / sqrt(float(sample_count));\n  float theta = float(sample_index) * goldenAngle + angle;\n  float sine = sin(theta);\n  float cosine = cos(theta);\n  return vec2(cosine, sine) * r;\n}\n\n// NOTE: For now we aren't using this screen-space noise. But we should enable\n// it again once we do some sort of temporal AA. Then we could potentially lower\n// the number of samples needed and still get a pretty smooth result.\n// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso\nfloat getNoiseInterleavedGradient(vec2 screenPos)\n{\n    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);\n    return fract(magic.z * fract(dot(screenPos, magic.xy)));\n}\n\n#ifdef USE_SHADOWMAP\n    #if NUM_DIR_LIGHT_SHADOWS > 0\n\n        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n        struct DirectionalLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_SPOT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n        varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n        struct SpotLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_POINT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n        struct PointLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n            float shadowCameraNear;\n            float shadowCameraFar;\n        };\n\n        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n    #endif\n\n    /*\n    #if NUM_RECT_AREA_LIGHTS > 0\n\n        // TODO (abelnation): create uniforms for area light shadows\n\n    #endif\n    */\n\nfloat computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)\n{\n    float penumbra = 1.0;\n    float blockerDepthAvg = 0.0;\n    float blockerCount = 0.0;\n\n    #pragma unroll_loop_start\n    for(int i = 0; i < gPenumbraSamples; i ++)\n    {\n        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;\n        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );\n\n        if(depth < compare + 0.0001)\n        {\n            blockerDepthAvg += depth;\n            blockerCount++;\n        }\n    }\n    #pragma unroll_loop_end\n\n    if (blockerCount > 0.0)\n    {\n        blockerDepthAvg /= blockerCount;\n\n        // Compute penumbra\n        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);\n        penumbra *= penumbra;\n        penumbra *= 200.0 * penumbraSize[min(index, ",5," - 1)]; // Magic number that affects how quickly the penumbra grows\n\n        return clamp(penumbra, 0.00, 1.0);\n    }\n    return 0.0;\n}\n\nvec4 shadowmod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 shadowperm(vec4 x){return shadowmod289(((x * 34.0) + 1.0) * x);}\nfloat shadowNoise(vec3 p){\n            vec3 a = floor(p);\n            vec3 d = p - a;\n            d = d * d * (3.0 - 2.0 * d);\n            vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n            vec4 k1 = shadowperm(b.xyxy);\n            vec4 k2 = shadowperm(k1.xyxy + b.zzww);\n            vec4 c = k2 + a.zzzz;\n            vec4 k3 = shadowperm(c);\n            vec4 k4 = shadowperm(c + 1.0);\n            vec4 o1 = fract(k3 * (1.0 / 41.0));\n            vec4 o2 = fract(k4 * (1.0 / 41.0));\n            vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n            vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n            return o4.y * d.y + o4.x * (1.0 - d.y);\n        }\n\nfloat vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)\n{\n    float shadow         = 0.0f;\n    float temporalOffset = shadowNoise(floor(vWPosition * 10.));\n\n    // NOTE: When using TAA, we should use screen space interleaved gradient noise\n    //float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy);\n    float temporalAngle  = temporalOffset * PI2;\n\n    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);\n    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);\n    if (penumbra == -1.0) {\n        return 1.0;\n    }\n\n    #pragma unroll_loop_start\n    for (int i = 0; i < gShadowSamples; i++)\n    {\n        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n        // Overall blurring offset\n        vec2 offset = vogelSample * (shadowRadius * 2.);\n\n        // Penumbra offset\n        offset += vogelSample * (penumbra * texelScalar);\n\n        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );\n    }\n    #pragma unroll_loop_end\n\n    return shadow * gShadowSamplesRpc;\n}\n\n\n    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n    }\n\n    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n        return unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n    }\n\n    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n        float occlusion = 1.0;\n\n        vec2 distribution = texture2DDistribution( shadow, uv );\n\n        float hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n        if (hard_shadow != 1.0 ) {\n\n            float distance = compare - distribution.x ;\n            float variance = max( 0.00000, distribution.y * distribution.y );\n            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n        }\n        return occlusion;\n\n    }\n\n    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n        float shadow = 1.0;\n\n        shadowCoord.xyz /= shadowCoord.w;\n        shadowCoord.z += shadowBias;\n\n        // if ( something && something ) breaks ATI OpenGL shader compiler\n        // if ( all( something, something ) ) using this instead\n\n        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n        bool inFrustum = all( inFrustumVec );\n\n        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n        bool frustumTest = all( frustumTestVec );\n\n        if ( frustumTest ) {\n\n        #if defined( SHADOWMAP_TYPE_PCF )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            float dx = texelSize.x;\n            float dy = texelSize.y;\n\n            vec2 uv = shadowCoord.xy;\n            vec2 f = fract( uv * shadowMapSize + 0.5 );\n            uv -= f * texelSize;\n\n            shadow = (\n                texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n                          f.x ),\n                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n                          f.x ),\n                     f.y )\n            ) * ( 1.0 / 9.0 );\n\n        #elif defined( SHADOWMAP_TYPE_VSM )\n\n            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #else // no percentage-closer filtering:\n\n            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #endif\n\n        }\n\n        return shadow;\n\n    }\n\n    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n    // vector suitable for 2D texture mapping. This code uses the following layout for the\n    // 2D texture:\n    //\n    // xzXZ\n    //  y Y\n    //\n    // Y - Positive y direction\n    // y - Negative y direction\n    // X - Positive x direction\n    // x - Negative x direction\n    // Z - Positive z direction\n    // z - Negative z direction\n    //\n    // Source and test bed:\n    // https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n    vec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n        // Number of texels to avoid at the edge of each square\n\n        vec3 absV = abs( v );\n\n        // Intersect unit cube\n\n        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n        absV *= scaleToCube;\n\n        // Apply scale to avoid seams\n\n        // two texels less per square (one texel will do for NEAREST)\n        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n        // Unwrap\n\n        // space: -1 ... 1 range for each square\n        //\n        // #X##         dim    := ( 4 , 2 )\n        //  # #         center := ( 1 , 1 )\n\n        vec2 planar = v.xy;\n\n        float almostATexel = 1.5 * texelSizeY;\n        float almostOne = 1.0 - almostATexel;\n\n        if ( absV.z >= almostOne ) {\n\n            if ( v.z > 0.0 )\n                planar.x = 4.0 - v.x;\n\n        } else if ( absV.x >= almostOne ) {\n\n            float signX = sign( v.x );\n            planar.x = v.z * signX + 2.0 * signX;\n\n        } else if ( absV.y >= almostOne ) {\n\n            float signY = sign( v.y );\n            planar.x = v.x + 2.0 * signY + 2.0;\n            planar.y = v.z * signY - 2.0;\n\n        }\n\n        // Transform to UV space\n\n        // scale := 0.5 / dim\n        // translate := ( center + 0.5 ) / dim\n        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n    }\n\n    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n        float shadow = 1.0;\n        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n        // for point lights, the uniform @vShadowCoord is re-purposed to hold\n        // the vector from the light to the world-space position of the fragment.\n        vec3 lightToPosition = shadowCoord.xyz;\n\n        // dp = normalized distance from light to fragment position\n        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n        compare += shadowBias;\n\n        // bd3D = base direction 3D\n        vec3 bd3D = normalize( lightToPosition );\n\n        float temporalOffset = shadowNoise(floor(vWPosition * 10.));\n        float temporalAngle  = temporalOffset * PI2;\n\n\n        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )\n            for (int i = 0; i < gShadowSamples; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                // NOTE: Removed for now\n                // Penumbra offset\n                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * gShadowSamplesRpc;\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n            for (int i = 0; i < 16; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * (1.0 / 16.0);\n        #else // no percentage-closer filtering\n\n            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );\n\n        #endif\n\n    }\n\n#endif\n")},jC=Oa.lights_fragment_begin,TC=Oa.shadowmask_pars_fragment,MC=!1,CC=function(e){switch(e){case"low":return 8;case"medium":default:return 16;case"high":return 32}},DC=function(){if(!MC){MC=!0;var e=CC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"medium");Oa.shadowmap_pars_fragment=AC(e);var t=jC.slice();t=(t=t.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + ".concat(3,", spotShadowMap[ i ]"))).replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),Oa.lights_fragment_begin=t;var n=TC.slice();n=n.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),Oa.shadowmask_pars_fragment=n}},IC=new ia({vertexShader:"\nattribute vec3 randomColor;\nvarying vec3 vNormal;\nflat out vec3 vColor;\n\nvoid main()\n{\nvNormal = normal;\nvColor = randomColor;\ngl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));\n}\n",fragmentShader:"\nuniform float depthContrast;\nvarying vec3 vNormal;\nflat in vec3 vColor;\nvoid main()\n{\nvec3 normal = (normalize(vNormal)).rgb;\n\nfloat contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;\n\nvec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);\ngl_FragColor = vec4(resultColor, vColor.r);\n}\n",uniforms:{depthContrast:{value:1}}}),PC=new gi;PC.wireframe=!0;var RC=new tr,LC=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;return Object(E.a)(this,n),(i=t.call(this)).data=e,i.backupFog=new ru(16777215,.1,2e3),i.fogUseBGColor=!1,i.enableHelpers=!1,i.wireframeState=!1,i.needsTransmissionDirty=!0,i.needsNormalDirty=!0,i._needsTransmission=!1,i._needsNormal=!1,i.geometryCacheChanged=!1,i.bgColor=new dA(1,1,1,1),i.entityByUuid={},i.entityIdentityToEntity={},i.toExpandCloner=new Set,i.toUpdateCloner=new Set,i.needsRecomputeInstances=!1,i.ambientLight=new Wc(13882323,8553090,.75),i.ambientLight.name="Default Ambient Light",i.ambientLight.layers.enable(3),i.personalCamera=i.createPersonalCamera(),i.activeCamera=i.personalCamera,i.postprocessing=e.postprocessing,i.init(e,r),i.matrixAutoUpdate=!1,i}return Object(A.a)(n,[{key:"markGeometryCacheDirty",value:function(){this.geometryCacheChanged=!0}},{key:"markNeedsUpdateRendererDirty",value:function(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}},{key:"needsTransmission",value:function(){return this.needsTransmissionDirty&&(this._needsTransmission=function(e){var t=!1;return e.traverseEntity((function(e){if(e instanceof NT)if(Array.isArray(e.material))for(var n=0;n<e.material.length;n++)OC(e,e.material[n])&&(t=!0);else OC(e,e.material)&&(t=!0)})),t}(this),this.needsTransmissionDirty=!1),this._needsTransmission}},{key:"needsNormal",value:function(){return this.needsNormalDirty&&(this._needsNormal=function(e){var t=!1;return e.traverseEntity((function(e){if(e instanceof NT)if(Array.isArray(e.material))for(var n=0;n<e.material.length;n++)xC(e,e.material[n])&&(t=!0);else xC(e,e.material)&&(t=!0)})),t}(this),this.needsNormalDirty=!1),this._needsNormal}},{key:"registerInstanceAndSetUuid",value:function(e){var t=e.identity.join("-"),n=this.entityIdentityToEntity[t];n&&(e.uuid=n.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}},{key:"findInstance",value:function(e){return this.entityIdentityToEntity[e.join("-")]}},{key:"getWithSortKey",value:function(e){var t=this.find(e);if(void 0!==t){for(var n=[],r=t;r!==this;){var i=r,a=(r=r.parent).children.indexOf(i);n.splice(0,0,a)}return{entity:t,sortKey:n}}}},{key:"getAllSorted",value:function(e){var t,n=[],r=Object(j.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=this.getWithSortKey(i.id);void 0!==a&&n.push(a)}}catch(o){r.e(o)}finally{r.f()}return n.sort((function(e,t){return function(e,t){for(var n=0;n<e.length&&n<t.length;){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1;n+=1}return n!==t.length?-1:n!==e.length?1:0}(e.sortKey,t.sortKey)})),n.map((function(e){return e.entity}))}},{key:"nonExistOrDescendantOf",value:function(e,t){var n=this.find(e);if(void 0===n)return!0;for(;n;){if(n.uuid===t)return!0;n=n.parent}return!1}},{key:"find",value:function(e){if(""!==e&&void 0!==e){var t=this.entityByUuid[e];return void 0===t?this.getObjectByProperty("uuid",e):t}}},{key:"debugEnsureEntity",value:function(e){var t=this.find(e);t?Array.isArray(t.identity)&&void 0===this.findInstance(t.identity)&&console.error("not found instance"):console.error("not found")}},{key:"addPendingExpandCloner",value:function(e){this.toExpandCloner.add(e)}},{key:"addPendingUpdateCloner",value:function(e){this.toUpdateCloner.add(e)}},{key:"markToExpandCloner",value:function(e){var t=this;this.toExpandCloner.add(e),e.traverseEntityAncestors((function(e){t.toExpandCloner.add(e)}))}},{key:"doPendingExpandCloner",value:function(){var e=this;this.toExpandCloner.forEach((function(t){t.expandCloner(e)})),this.toExpandCloner.clear()}},{key:"doPendingUpdateCloner",value:function(){this.toUpdateCloner.forEach((function(e){var t;null===(t=e.cloner)||void 0===t||t.update()})),this.toUpdateCloner.clear()}},{key:"doPendingUpdates",value:function(){this.doPendingExpandCloner(),this.doPendingUpdateCloner()}},{key:"updateTreeByOp",value:function(e,t){if(0===e.path.length&&7===e.type){var n=null===e.parent?this:this.find(e.parent);if(void 0===n)throw new Error("unexpected");var r=this.createObject(e.id,e.data,e.children,n,e.localIndex,t);r.updateVisible(),r.resetBBoxNeedsUpdate(),JM(r)&&$M(r.parent)&&(r.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(r),this.markToExpandCloner(r)}else if(0===e.path.length&&8===e.type){var i=this.find(e.id);if(void 0===i)throw new Error("unexpected");this.markToExpandCloner(i),i.resetBBoxNeedsUpdate(),this.unregisterObject(i);var a=i.parent;this.markNeedsRecomputeInstancesForAncessors(a),this.markNeedsRecomputeInstancesForChildren(i),i.parent.remove(i),$M(i.parent)&&(i.parent.invalidateUpstreamBooleanData(),i.parent.invalidateDownstreamBooleanData().recomputeBoolean()),JM(i)&&(i.freeBooleanPointer(),a instanceof QM&&a.invalidateDownstreamBooleanData().recomputeBoolean()),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(i)}else if(0===e.path.length&&9===e.type){var o,s=this.find(e.id);if(void 0===s)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(s);var u=s.parent;this.markNeedsRecomputeInstancesForAncessors(u),null!==(o=s.cloner)&&void 0!==o&&o.resetOnMove(),this.markToExpandCloner(s);var c=null===e.parent?this:this.find(e.parent);if(void 0===c)throw new Error("unexpected");c.add(s),this.markNeedsRecomputeInstancesForAncessors(c),this.markToExpandCloner(s),s.invalidateClonerTransform(s),s.updateVisible(),s.resetBBoxNeedsUpdate();var l=e.localIndex;c.children.splice(l,0,c.children.pop()),JM(s)&&(s.invalidateUpstreamBooleanData(),$M(s.parent)?s.parent.invalidateDownstreamBooleanData().recomputeBoolean():u instanceof QM&&u.invalidateDownstreamBooleanData().recomputeBoolean())}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}},{key:"updateEntityByOp",value:function(e,t,n,r){if(0===t.type&&(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),t.path.includes("overrides")&&"states"in t.props)){var i=t.props,a=i.states,o=i.rest;t=Object(p.a)(Object(p.a)({},t),{},{props:o}),this.markNeedsRecomputeInstances()}var s=this.find(e);if(s)try{(function(e,t,n,r){e.updateByOp(t,n,r,!1)})(s,t,n,{scene:this,shared:r}),s instanceof BT&&s.updateGeometryGroupsIfNeeded()}catch(a){console.error(a)}}},{key:"enableFog",get:function(){return null!==this.fog},set:function(e){this.fog=!0===e?this.backupFog:null}},{key:"init",value:function(e,t){if(this.createChildrenObjects(e.objects,this,t),this.personalCamera.removeFromParent(),this.add(this.personalCamera),this.ambientLight.removeFromParent(),this.add(this.ambientLight),this.setBackgroundColor(Dj(e.backgroundColor,t)),this.updateFog(e.fog,t),this.updateAmbientLight(e.environment.ambientLight,t),this.activeCamera=this.personalCamera,null!==e.publish.playCamera){var n=this.find(e.publish.playCamera);n instanceof qM&&this.switchActiveCamera(n)}this.expandInstances(t,!0),this.traverseEntity((function(e){$M(e)&&e.recomputeBoolean()})),this.doPendingExpandCloner()}},{key:"markNeedsRecomputeInstances",value:function(){this.needsRecomputeInstances=!0}},{key:"markNeedsRecomputeInstancesForChildren",value:function(e){var t=this;e.traverseEntity((function(e){("Component"===e.data.type||"Instance"===e.data.type)&&t.markNeedsRecomputeInstances()}))}},{key:"markNeedsRecomputeInstancesForAncessors",value:function(e){var t=this;Fk.is(e)&&("Component"===e.data.type&&this.markNeedsRecomputeInstances(),e.traverseAncestors((function(e){Fk.is(e)&&"Component"===e.data.type&&t.markNeedsRecomputeInstances()})))}},{key:"relativeizeInner",value:function(e,t,n,r,i,a,o){var s=this;e&&e!==r.uuid&&r.find(e)&&i.forInstancesRec((function(r){r.isInstanceRoot||(r.data=Py(r.data,(function(i){var u=i.events.data(o.id),c=r.goUp(a);if(c){var l=[].concat(Object(v.a)(Ex(c.identity)),[e]).join("-"),h=s.entityIdentityToEntity[l];if(h){var d=h.uuid;My.zoom(u,t)[n]=d}else console.warn("cannot find instance")}})).data)}))}},{key:"rewriteEventsBeforeGoToPlayMode",value:function(){var e=this;this.traverseEntity((function(t){if(t instanceof mC&&"string"==typeof t.identity&&"Component"===t.data.type)return t.traverseEntity((function(n,r){n.data.events.forEach((function(i){"GameControl"===i.data.type?n.forInstancesRec((function(e){e.isInstanceRoot||(e.data=Py(e.data,(function(e){e.events.delete(i.id)})).data)})):"Conditional"===i.data.type?("Distance"===i.data.condition.type?(e.relativeizeInner(i.data.condition.fromObject,["condition"],"fromObject",t,n,r,i),e.relativeizeInner(i.data.condition.toObject,["condition"],"toObject",t,n,r,i)):"State"===i.data.condition.type?e.relativeizeInner(i.data.condition.object,["condition"],"object",t,n,r,i):"Comparison"===i.data.condition.type&&("Property"===i.data.condition.lOperand.type&&e.relativeizeInner(i.data.condition.lOperand.value[0],["condition","lOperand","value"],0,t,n,r,i),"Property"===i.data.condition.rOperand.type&&e.relativeizeInner(i.data.condition.rOperand.value[0],["condition","rOperand","value"],0,t,n,r,i)),i.data.inActions.forEach((function(a){"Transition"===a.data.type&&e.relativeizeInner(a.data.object,["inActions",a.id],"object",t,n,r,i)})),i.data.outActions.forEach((function(a){"Transition"===a.data.type&&e.relativeizeInner(a.data.object,["outActions",a.id],"object",t,n,r,i)}))):"actions"in i.data&&i.data.actions.forEach((function(a){"Transition"===a.data.type&&e.relativeizeInner(a.data.object,["actions",a.id],"object",t,n,r,i)}))}))})),!0}))}},{key:"expandInstances",value:function(e,t){var n=this,r=new Set;this.traverseEntity((function(i){if(i instanceof mC&&i.isInstanceRoot)return i.expandInstanceChildren({scene:n,shared:e,pendingDeletes:r}),t||i.resetBBoxNeedsUpdate(),!0}));var i,a=Object(j.a)(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(o),gC(o)}}catch(s){a.e(s)}finally{a.f()}}},{key:"recomputeInstances",value:function(e){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity((function(e){e instanceof mC&&e.isInstanceRoot&&(e.component=void 0)})),this.expandInstances(e,!1))}},{key:"disposeAndUnregisterEntityRecursivelyIfNotReregistered",value:function(e){var t=this;e.traverseEntity((function(e){var n="string"==typeof e.identity?e.identity:e.identity.join("-");t.entityIdentityToEntity[n]===e&&(delete t.entityByUuid[e.uuid],delete t.entityIdentityToEntity[n]),e.dispose()}))}},{key:"clearScene",value:function(){var e,t=Object(j.a)(this.children);try{for(t.s();!(e=t.n()).done;){var n=e.value;Jk(n)&&n.disposeRecursively()}}catch(r){t.e(r)}finally{t.f()}this.children.length=0}},{key:"resetAfterClear",value:function(e,t){this.init(e,t)}},{key:"createPersonalCamera",value:function(){var e=new qM(n.PERSONAL_CAMERA_ID,Object(p.a)(Object(p.a)({},sx.defaultData),{},{name:"Personal Camera"}));return e.objectHelper.visible=!1,this.registerObjectCreatedInLegacy(e),e}},{key:"raycast",value:function(e){var t=this,n=[];return function r(i){var a,o=Object(j.a)(i.children);try{for(o.s();!(a=o.n()).done;){var s=a.value;Jk(s)&&!s.raycastLock&&s.visible&&((JM(s)||nC(s)&&t.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,n),EC(s,e,n)),r(s))}}catch(u){o.e(u)}finally{o.f()}}(this),n}},{key:"forEachEntity",value:function(e){var t,n=Object(j.a)(this.children);try{for(n.s();!(t=n.n()).done;){var r=t.value;Jk(r)&&e(r)}}catch(i){n.e(i)}finally{n.f()}}},{key:"traverseEntity",value:function(e){var t,n=Object(j.a)(this.children);try{for(n.s();!(t=n.n()).done;){var r=t.value;Jk(r)&&r.traverseEntity(e)}}catch(i){n.e(i)}finally{n.f()}}},{key:"traverseObject",value:function(e){var t,n=Object(j.a)(this.children);try{for(n.s();!(t=n.n()).done;){var r=t.value;Dk.is(r)&&r.traverseObject(e)}}catch(i){n.e(i)}finally{n.f()}}},{key:"traverseVisibleEntity",value:function(e){var t,n=Object(j.a)(this.children);try{for(n.s();!(t=n.n()).done;){var r=t.value;Jk(r)&&r.visible&&r.traverseVisibleEntity(e)}}catch(i){n.e(i)}finally{n.f()}}},{key:"updateFog",value:function(e,t){this.enableFog=e.enabled,this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=Dj(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}},{key:"dispose",value:function(){this.clearScene()}},{key:"updateAmbientLight",value:function(e,t){void 0!==e.color&&(this.ambientLight.color=Dj(e.color,t)),void 0!==e.intensity&&(this.ambientLight.intensity=e.intensity),void 0!==e.groundColor&&(this.ambientLight.groundColor=Dj(e.groundColor,t)),void 0!==e.enabled&&(this.ambientLight.visible=e.enabled)}},{key:"switchActiveCamera",value:function(e){this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1}},{key:"setBackgroundColor",value:function(e){this.bgColor=e,!0===this.fogUseBGColor&&(this.backupFog.color=e)}},{key:"createChildrenObjects",value:function(e,t,n){var r,i=0,a=Object(j.a)(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;this.createObject(o.id,o.data,o.children,t,i,n),i+=1}}catch(s){a.e(s)}finally{a.f()}}},{key:"registerObjectCreatedInLegacy",value:function(e){this.entityByUuid[e.uuid]=e}},{key:"unregisterObject",value:function(e){delete this.entityByUuid[e.uuid];var t,n=Object(j.a)(e.children);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.unregisterObject(r)}}catch(i){n.e(i)}finally{n.f()}}},{key:"createObject",value:function(e,t,n,r,i,a){var o={scene:this,shared:a},s=wC(e,t,o);return s&&(this.entityByUuid[e]=s,r.add(s),r.children.splice(i,0,r.children.pop()),n.length>0&&(s.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(n,s,a)),s.updateState(t,o),s instanceof BT&&s.updateGeometryGroupsIfNeeded(),s.updateVisible(),s.cloner&&this.toExpandCloner.add(s)),s}},{key:"getCenter",value:function(e){for(var t=[],n=0,r=e.length;n<r;++n){var i=e[n],a=i.id,o=i.recursive,s=this.find(a),u=o?s.recursiveBBox:s.singleBBox;t.push.apply(t,Object(v.a)(u.vertices))}var c=new ir;return c.setFromPoints(t),c.getCenter(RC),RC}},{key:"copyMatrixWorld",value:function(e,t){if(null!==e){var n=this.find(e);n?t.copy(n.matrixWorld):t.identity()}else t.identity()}},{key:"copyParentMatrixWorld",value:function(e,t){var n;if(null!==e){var r=null===(n=this.find(e))||void 0===n?void 0:n.parent;r?t.copy(r.matrixWorld):t.identity()}else t.identity()}},{key:"traverseMaterial",value:function(e){this.traverseEntity((function(t){if(t instanceof rA)if(Array.isArray(t.material))for(var n=0;n<t.material.length;n++)t.material[n]instanceof lT&&e(t.material[n]);else t.material instanceof lT&&e(t.material)}))}},{key:"updateCanvasSize",value:function(e,t){var n,r;this.activeCamera.setViewplaneSize(e,t),e>=t?(n=t/e,r=1):(n=1,r=e/t),this.traverseMaterial((function(e){e.getLayersOfType("transmission").forEach((function(e){e.uniforms["f".concat(e.id,"_aspectRatio")].value.x=n,e.uniforms["f".concat(e.id,"_aspectRatio")].value.y=r}))}))}}]),n}(iu),NC=LC;NC.PERSONAL_CAMERA_ID="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera";var BC=function(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)},FC=function(e){return e*(Math.PI/180)},UC=function(e){return e*(180/Math.PI)},zC=new Map,VC=function(e){zC.has(e)&&clearTimeout(zC.get(e)),zC.set(e,setTimeout(e,100))},GC=function(e,t,n){for(var r,i=t.split(/[ ,]+/g),a=0;a<i.length;a+=1)r=i[a],e.addEventListener?e.addEventListener(r,n,!1):e.attachEvent&&e.attachEvent(r,n)},HC=function(e,t,n){for(var r,i=t.split(/[ ,]+/g),a=0;a<i.length;a+=1)r=i[a],e.removeEventListener?e.removeEventListener(r,n):e.detachEvent&&e.detachEvent(r,n)},WC=function(e){return e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e},qC=function(){if(!(typeof window>"u"))return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},YC=function(e,t){t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},XC=function(e,t,n){var r=KC(e);for(var i in r)if(r.hasOwnProperty(i))if("string"==typeof t)r[i]=t+" "+n;else{for(var a="",o=0,s=t.length;o<s;o+=1)a+=t[o]+" "+n+", ";r[i]=a.slice(0,-2)}return r},KC=function(e){var t={};return t[e]="",["webkit","Moz","o"].forEach((function(n){t[n+e.charAt(0).toUpperCase()+e.slice(1)]=""})),t},QC=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},ZC=function(e,t){if(e.length)for(var n=0,r=e.length;n<r;n+=1)t(e[n]);else t(e)};typeof window<"u"&&(JC="ontouchstart"in window,$C=!!window.PointerEvent,eD=!!window.MSPointerEvent);var JC,$C,eD,tD,nD={start:"mousedown",move:"mousemove",end:"mouseup"},rD={};function iD(){}$C?tD={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:eD?tD={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:JC?(tD={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},rD=nD):tD=nD,iD.prototype.on=function(e,t){var n,r=this,i=e.split(/[ ,]+/g);r._handlers_=r._handlers_||{};for(var a=0;a<i.length;a+=1)n=i[a],r._handlers_[n]=r._handlers_[n]||[],r._handlers_[n].push(t);return r},iD.prototype.off=function(e,t){var n=this;return n._handlers_=n._handlers_||{},void 0===e?n._handlers_={}:void 0===t?n._handlers_[e]=null:n._handlers_[e]&&n._handlers_[e].indexOf(t)>=0&&n._handlers_[e].splice(n._handlers_[e].indexOf(t),1),n},iD.prototype.trigger=function(e,t){var n,r=this,i=e.split(/[ ,]+/g);r._handlers_=r._handlers_||{};for(var a=0;a<i.length;a+=1)n=i[a],r._handlers_[n]&&r._handlers_[n].length&&r._handlers_[n].forEach((function(e){e.call(r,{type:n,target:r},t)}))},iD.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=function(e,t){var n={};for(var r in e)e.hasOwnProperty(r)&&t.hasOwnProperty(r)?n[r]=t[r]:e.hasOwnProperty(r)&&(n[r]=e[r]);return n}(t.options,e))},iD.prototype.bindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},n._domHandlers_[t]=function(){"function"==typeof n["on"+t]?n["on"+t].apply(n,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},GC(e,tD[t],n._domHandlers_[t]),rD[t]&&GC(e,rD[t],n._domHandlers_[t]),n},iD.prototype.unbindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},HC(e,tD[t],n._domHandlers_[t]),rD[t]&&HC(e,rD[t],n._domHandlers_[t]),delete n._domHandlers_[t],this};var aD=iD;function oD(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=oD.id,oD.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}oD.prototype=new aD,oD.constructor=oD,oD.id=0,oD.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},oD.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=function(e,t){var n=KC(e);for(var r in n)n.hasOwnProperty(r)&&(n[r]=t);return n}("borderRadius","50%"),n=XC("transition","opacity",e),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},QC(r.el,n),"circle"===this.options.shape&&QC(r.back,t),QC(r.front,t),this.applyStyles(r),this},oD.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var n in e[t])this.ui[t].style[n]=e[t][n];return this},oD.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},oD.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},oD.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},oD.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout((function(){t.ui.el.style.opacity=1}),0),t.showTimeout=setTimeout((function(){t.trigger("shown",t.instance),"function"==typeof e&&e.call(this)}),t.options.fadeTime)),t},oD.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout((function(){var n="dynamic"===t.options.mode?"none":"block";t.ui.el.style.display=n,"function"==typeof e&&e.call(t),t.trigger("hidden",t.instance)}),t.options.fadeTime),t.options.restJoystick){var n=t.options.restJoystick,r={};r.x=!0===n||!1!==n.x?0:t.instance.frontPosition.x,r.y=!0===n||!1!==n.y?0:t.instance.frontPosition.y,t.setPosition(e,r)}return t},oD.prototype.setPosition=function(e,t){var n=this;n.frontPosition={x:t.x,y:t.y};var r=n.options.fadeTime+"ms",i={};i.front=XC("transition",["top","left"],r);var a={front:{}};a.front={left:n.frontPosition.x+"px",top:n.frontPosition.y+"px"},n.applyStyles(i),n.applyStyles(a),n.restTimeout=setTimeout((function(){"function"==typeof e&&e.call(n),n.restCallback()}),n.options.fadeTime)},oD.prototype.restCallback=function(){var e=this,t={};t.front=XC("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)},oD.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},oD.prototype.computeDirection=function(e){var t,n,r,i=e.angle.radian,a=Math.PI/4,o=Math.PI/2;if(i>a&&i<3*a&&!e.lockX?t="up":i>-a&&i<=a&&!e.lockY?t="left":i>3*-a&&i<=-a&&!e.lockX?t="down":e.lockY||(t="right"),e.lockY||(n=i>-o&&i<o?"left":"right"),e.lockX||(r=i>0?"up":"down"),e.force>this.options.threshold){var s,u={};for(s in this.direction)this.direction.hasOwnProperty(s)&&(u[s]=this.direction[s]);var c={};for(s in this.direction={x:n,y:r,angle:t},e.direction=this.direction,u)u[s]===this.direction[s]&&(c[s]=!0);if(c.x&&c.y&&c.angle)return e;(!c.x||!c.y)&&this.trigger("plain",e),c.x||this.trigger("plain:"+n,e),c.y||this.trigger("plain:"+r,e),c.angle||this.trigger("dir dir:"+t,e)}else this.resetDirection();return e};var sD=oD;function uD(e,t){var n=this;n.nipples=[],n.idles=[],n.actives=[],n.ids=[],n.pressureIntervals={},n.manager=e,n.id=uD.id,uD.id+=1,n.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},n.config(t),("static"===n.options.mode||"semi"===n.options.mode)&&(n.options.multitouch=!1),n.options.multitouch||(n.options.maxNumberOfNipples=1);var r=getComputedStyle(n.options.zone.parentElement);return r&&"flex"===r.display&&(n.parentIsFlex=!0),n.updateBox(),n.prepareNipples(),n.bindings(),n.begin(),n.nipples}uD.prototype=new aD,uD.constructor=uD,uD.id=0,uD.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(e){if(void 0===e)return t[0];for(var n=0,r=t.length;n<r;n+=1)if(t[n].identifier===e)return t[n];return!1}},uD.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"},uD.prototype.begin=function(){var e=this,t=e.options;if("static"===t.mode){var n=e.createNipple(t.position,e.manager.getIdentifier());n.add(),e.idles.push(n)}},uD.prototype.createNipple=function(e,t){var n=this,r=n.manager.scroll,i={},a=n.options,o=n.parentIsFlex?r.x:r.x+n.box.left,s=n.parentIsFlex?r.y:r.y+n.box.top;if(e.x&&e.y)i={x:e.x-o,y:e.y-s};else if(e.top||e.right||e.bottom||e.left){var u=document.createElement("DIV");u.style.display="hidden",u.style.top=e.top,u.style.right=e.right,u.style.bottom=e.bottom,u.style.left=e.left,u.style.position="absolute",a.zone.appendChild(u);var c=u.getBoundingClientRect();a.zone.removeChild(u),i=e,e={x:c.left+r.x,y:c.top+r.y}}var l=new sD(n,{color:a.color,size:a.size,threshold:a.threshold,fadeTime:a.fadeTime,dataOnly:a.dataOnly,restJoystick:a.restJoystick,restOpacity:a.restOpacity,mode:a.mode,identifier:t,position:e,zone:a.zone,frontPosition:{x:0,y:0},shape:a.shape});return a.dataOnly||(YC(l.ui.el,i),YC(l.ui.front,l.frontPosition)),n.nipples.push(l),n.trigger("added "+l.identifier+":added",l),n.manager.trigger("added "+l.identifier+":added",l),n.bindNipple(l),l},uD.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},uD.prototype.bindNipple=function(e){var t,n=this,r=function(e,r){t=e.type+" "+r.id+":"+e.type,n.trigger(t,r)};e.on("destroyed",n.onDestroyed.bind(n)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)},uD.prototype.pressureFn=function(e,t,n){var r=this,i=0;clearInterval(r.pressureIntervals[n]),r.pressureIntervals[n]=setInterval(function(){var n=e.force||e.pressure||e.webkitForce||0;n!==i&&(t.trigger("pressure",n),r.trigger("pressure "+t.identifier+":pressure",n),i=n)}.bind(r),100)},uD.prototype.onstart=function(e){var t=this,n=t.options,r=e;e=WC(e),t.updateBox();return ZC(e,(function(i){t.actives.length<n.maxNumberOfNipples?t.processOnStart(i):r.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach((function(n){if(Object.values(r.touches).findIndex((function(e){return e.identifier===n}))<0){var i=[e[0]];i.identifier=n,t.processOnEnd(i)}})),t.actives.length<n.maxNumberOfNipples&&t.processOnStart(i))})),t.manager.bindDocument(),!1},uD.prototype.processOnStart=function(e){var t,n=this,r=n.options,i=n.manager.getIdentifier(e),a=e.force||e.pressure||e.webkitForce||0,o={x:e.pageX,y:e.pageY},s=n.getOrCreate(i,o);s.identifier!==i&&n.manager.removeIdentifier(s.identifier),s.identifier=i;var u=function(t){t.trigger("start",t),n.trigger("start "+t.id+":start",t),t.show(),a>0&&n.pressureFn(e,t,t.identifier),n.processOnMove(e)};if((t=n.idles.indexOf(s))>=0&&n.idles.splice(t,1),n.actives.push(s),n.ids.push(s.identifier),"semi"!==r.mode)u(s);else{if(!(BC(o,s.position)<=r.catchDistance))return s.destroy(),void n.processOnStart(e);u(s)}return s},uD.prototype.getOrCreate=function(e,t){var n,r=this,i=r.options;return/(semi|static)/.test(i.mode)?(n=r.idles[0])?(r.idles.splice(0,1),n):"semi"===i.mode?r.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1):n=r.createNipple(t,e)},uD.prototype.processOnMove=function(e){var t=this,n=t.options,r=t.manager.getIdentifier(e),i=t.nipples.get(r),a=t.manager.scroll;if(function(e){return isNaN(e.buttons)?0!==e.pressure:0!==e.buttons}(e)){if(!i)return console.error("Found zombie joystick with ID "+r),void t.manager.removeIdentifier(r);if(n.dynamicPage){var o=i.el.getBoundingClientRect();i.position={x:a.x+o.left,y:a.y+o.top}}i.identifier=r;var s=i.options.size/2,u={x:e.pageX,y:e.pageY};n.lockX&&(u.y=i.position.y),n.lockY&&(u.x=i.position.x);var c,l,h=BC(u,i.position),d=function(e,t){var n=t.x-e.x,r=t.y-e.y;return UC(Math.atan2(r,n))}(u,i.position),f=FC(d),p=h/s,v={distance:h,position:u};if("circle"===i.options.shape?(c=Math.min(h,s),l=function(e,t,n){var r={x:0,y:0};return n=FC(n),r.x=e.x-t*Math.cos(n),r.y=e.y-t*Math.sin(n),r}(i.position,c,d)):(l=function(e,t,n){return{x:Math.min(Math.max(e.x,t.x-n),t.x+n),y:Math.min(Math.max(e.y,t.y-n),t.y+n)}}(u,i.position,s),c=BC(l,i.position)),n.follow){if(h>s){var m=u.x-l.x,g=u.y-l.y;i.position.x+=m,i.position.y+=g,i.el.style.top=i.position.y-(t.box.top+a.y)+"px",i.el.style.left=i.position.x-(t.box.left+a.x)+"px",h=BC(u,i.position)}}else u=l,h=c;var y=u.x-i.position.x,b=u.y-i.position.y;i.frontPosition={x:y,y:b},n.dataOnly||YC(i.ui.front,i.frontPosition);var w={identifier:i.identifier,position:u,force:p,pressure:e.force||e.pressure||e.webkitForce||0,distance:h,angle:{radian:f,degree:d},vector:{x:y/s,y:-b/s},raw:v,instance:i,lockX:n.lockX,lockY:n.lockY};(w=i.computeDirection(w)).angle={radian:FC(180-d),degree:180-d},i.trigger("move",w),t.trigger("move "+i.id+":move",w)}else this.processOnEnd(e)},uD.prototype.processOnEnd=function(e){var t=this,n=t.options,r=t.manager.getIdentifier(e),i=t.nipples.get(r),a=t.manager.removeIdentifier(i.identifier);!i||(n.dataOnly||i.hide((function(){"dynamic"===n.mode&&(i.trigger("removed",i),t.trigger("removed "+i.id+":removed",i),t.manager.trigger("removed "+i.id+":removed",i),i.destroy())})),clearInterval(t.pressureIntervals[i.identifier]),i.resetDirection(),i.trigger("end",i),t.trigger("end "+i.id+":end",i),t.ids.indexOf(i.identifier)>=0&&t.ids.splice(t.ids.indexOf(i.identifier),1),t.actives.indexOf(i)>=0&&t.actives.splice(t.actives.indexOf(i),1),/(semi|static)/.test(n.mode)?t.idles.push(i):t.nipples.indexOf(i)>=0&&t.nipples.splice(t.nipples.indexOf(i),1),t.manager.unbindDocument(),/(semi|static)/.test(n.mode)&&(t.manager.ids[a.id]=a.identifier))},uD.prototype.onDestroyed=function(e,t){var n=this;n.nipples.indexOf(t)>=0&&n.nipples.splice(n.nipples.indexOf(t),1),n.actives.indexOf(t)>=0&&n.actives.splice(n.actives.indexOf(t),1),n.idles.indexOf(t)>=0&&n.idles.splice(n.idles.indexOf(t),1),n.ids.indexOf(t.identifier)>=0&&n.ids.splice(n.ids.indexOf(t.identifier),1),n.manager.removeIdentifier(t.identifier),n.manager.unbindDocument()},uD.prototype.destroy=function(){var e=this;for(var t in e.unbindEvt(e.options.zone,"start"),e.nipples.forEach((function(e){e.destroy()})),e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var cD=uD;function lD(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=qC(),t.config(e),t.prepareCollections();var n=function(){var e;t.collections.forEach((function(n){n.forEach((function(n){e=n.el.getBoundingClientRect(),n.position={x:t.scroll.x+e.left,y:t.scroll.y+e.top}}))}))};if(typeof window>"u")return t.collections;GC(window,"resize",(function(){VC(n)}));var r=function(){t.scroll=qC()};return GC(window,"scroll",(function(){VC(r)})),t.collections}lD.prototype=new aD,lD.constructor=lD,lD.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var n;return e.collections.every((function(e){return!(n=e.get(t))})),n}},lD.prototype.create=function(e){return this.createCollection(e)},lD.prototype.createCollection=function(e){var t=this,n=new cD(t,e);return t.bindCollection(n),t.collections.push(n),n},lD.prototype.bindCollection=function(e){var t,n=this,r=function(e,r){t=e.type+" "+r.id+":"+e.type,n.trigger(t,r)};e.on("destroyed",n.onDestroyed.bind(n)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)},lD.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)},lD.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||!0===e)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)},lD.prototype.getIdentifier=function(e){var t;return e?void 0===(t=void 0===e.identifier?e.pointerId:e.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},lD.prototype.removeIdentifier=function(e){var t={};for(var n in this.ids)if(this.ids[n]===e){t.id=n,t.identifier=this.ids[n],delete this.ids[n];break}return t},lD.prototype.onmove=function(e){return this.onAny("move",e),!1},lD.prototype.onend=function(e){return this.onAny("end",e),!1},lD.prototype.oncancel=function(e){return this.onAny("end",e),!1},lD.prototype.onAny=function(e,t){var n,r=this,i="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=WC(t);var a=function(e,t,n){n.ids.indexOf(t)>=0&&(n[i](e),e._found_=!0)};return ZC(t,(function(e){n=r.getIdentifier(e),ZC(r.collections,a.bind(null,e,n)),e._found_||r.removeIdentifier(n)})),!1},lD.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach((function(e){e.destroy()})),e.off()},lD.prototype.onDestroyed=function(e,t){var n=this;if(n.collections.indexOf(t)<0)return!1;n.collections.splice(n.collections.indexOf(t),1)};var hD=new lD,dD={create:function(e){return hD.create(e)},factory:hD},fD=z(G());function pD(e,t){var n=new Di;if(!e.getAttribute("position"))return n.setAttribute("position",new _i([],3)),n.setIndex([]),n;var r=jE(e.getAttribute("position"),e.getIndex()),i=r.positions,a=r.triIndices;return n.setAttribute("position",new _i(i,3)),n.setIndex(a),t&&n.applyMatrix4(t),n}var vD=new Dr,mD=new Dr,gD=[[0,0,0],[0,0,0],[0,0,0]];function yD(e){var t=e.elements;gD[0][0]=t[0],gD[0][1]=t[4],gD[0][2]=t[8],gD[1][0]=t[1],gD[1][1]=t[5],gD[1][2]=t[9],gD[2][0]=t[2],gD[2][1]=t[6],gD[2][2]=t[10];var n=(0,fD.SVD)(gD),r=n.u,i=n.v,a=vD.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),o=mD.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1);return a.multiply(o.transpose())}var bD=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this)).layers.enable(3),e.layers.enable(8),e}return Object(A.a)(n,[{key:"setFromCamera",value:function(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}},{key:"intersectVisibleObjects",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e.forEach((function(e){e.visible&&t.intersectObject(e,n,r)})),r}},{key:"createRaycastLineHelper",value:function(){var e=new cu({color:65280,linewidth:10}),t=new tr(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),n=new tr(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),r=this.camera.far-this.camera.near,i=(new tr).addVectors(t,n.multiplyScalar(r)),a=new Di;return a.setFromPoints([t,i]),new vu(a,e)}}]),n}(Ol),wD=function(e){return e instanceof iC||e instanceof mC};function xD(e,t){return e.distance-t.distance}function OD(e,t,n){if(Jk(t)&&t.visible&&!t.raycastLock){JM(t)&&t.raycast(e,n);var r,i=Object(j.a)(t.children);try{for(i.s();!(r=i.n()).done;){OD(e,r.value,n)}}catch(a){i.e(a)}finally{i.f()}}}function kD(e,t,n){if(!n.some((function(t){return void 0!==SD(e,t)})))return[];var r=[];return t.children.forEach((function(t){return OD(e,t,r)})),r.sort(xD),r}function _D(e){var t=[];if(e.length){var n=e[0].object;Jk(n)&&t.push(n);for(var r=n.parent;r;)wD(r)&&t.push(r),r=r.parent}return t}function SD(e,t){if(JM(t)){if(!t.raycastLock&&t.visible){var n=[];return t.raycast(e,n),n.length?n[0]:void 0}}else if(wD(t))return ED(e,t)}function ED(e,t){if(Jk(t)&&t.visible&&!t.raycastLock){if(JM(t)){var n=[];if(t.raycast(e,n),n.length)return n[0]}var r,i=Object(j.a)(t.children);try{for(i.s();!(r=i.n()).done;){var a=ED(e,r.value);if(a)return a}}catch(o){i.e(o)}finally{i.f()}}}function AD(e){var t=e.getViewport(new Qn),n=function(e){if(""!==e.style.transform){var t=getComputedStyle(e).getPropertyValue("transform");if("none"!==t){var n=t.replace("matrix(","").split(",");return{x:parseFloat(n[0]),y:parseFloat(n[3])}}}return{x:1,y:1}}(e.domElement);return{left:t.x*n.x,top:t.y*n.y,width:t.z*n.x,height:t.w*n.y}}var jD=function(){function e(t,n,r,i,a,o){Object(E.a)(this,e),this.isExport=o,this.raycaster=new bD,this.raycasterNeedsUpdate=!0,this.stopRaycast=!1,this.sharedAssets=new LT(Mx.emptyData()),this.scene=new NC(Object(p.a)({},Tx.defaultData),this.sharedAssets),this.camera=new qM,this.renderer=t,this.domElement=t.domElement,this._domRect=this.domElement.getBoundingClientRect(),this._viewRect=AD(this.renderer),this.stopRaycast=a,this.sharedAssets=i,this.scene=n,this.camera=r}return Object(A.a)(e,[{key:"domRect",get:function(){return this._domRect}},{key:"viewRect",get:function(){return this._viewRect}},{key:"updaterRect",value:function(){this._domRect=this.domElement.getBoundingClientRect(),this._viewRect=AD(this.renderer)}},{key:"updateRaycaster",value:function(e){if(this.raycasterNeedsUpdate){this.raycasterNeedsUpdate=!1;var t=void 0!==e.touches&&e.touches.length>0?e.touches[0]:e,n=t.pageX,r=t.pageY;this.raycaster.setFromCamera(function(e,t,n,r){var i=n.height-r.height,a=(e-r.left-n.left)*(n.width/r.width),o=(t-i+r.top-n.top)*(n.height/r.height);return{x:a/n.width*2-1,y:-o/n.height*2+1}}(n,r,this._domRect,this._viewRect),this.camera)}}}]),e}(),TD=function(e){return e[e.keydown=0]="keydown",e[e.keyup=1]="keyup",e[e.pointerdown=2]="pointerdown",e[e.pointerup=3]="pointerup",e[e.pointermove=4]="pointermove",e[e.wheel=5]="wheel",e}(TD||{}),MD=function(){function e(t){Object(E.a)(this,e),this.eventContext=t,this.domEventsNeeded=new Set,this.hasVideoAction=!1}return Object(A.a)(e,[{key:"connect",value:function(){}},{key:"disconnect",value:function(){}}]),e}(),CD=new Map,DD=new Map,ID=function(){function e(t,n,r,i){Object(E.a)(this,e),this.data=n;var a=n.audio,o=n.volume,s=n.delay,u=n.loop;if(!a)throw new Error("Missing property");var c="string"==typeof a?i.getAudio(a).src:a.data;this.audioPlayer=new yT({src:c,volume:o,delay:s,loop:u}),DD.has(r.uuid)?DD.get(r.uuid).push(this):DD.set(r.uuid,[this]),CD.set(t,this)}return Object(A.a)(e,[{key:"playByToggle",value:function(){"stop"===this.data.toggle?"playing"===this.audioPlayer.status?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):"pause"===this.data.toggle?"playing"===this.audioPlayer.status?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}},{key:"dispose",value:function(){this.audioPlayer.stop()}}]),e}(),PD=function(){function e(t){Object(E.a)(this,e),this.data=t}return Object(A.a)(e,[{key:"dispatch",value:function(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}},{key:"pauseAudio",value:function(e){var t=this,n=CD.get(e);!n||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((function(){n.audioPlayer[t.data.interaction](),t.disposeDelay()}),this.data.delay)):n.audioPlayer[this.data.interaction]())}},{key:"pauseAllAudiosFromObject",value:function(e){var t=this,n=DD.get(e);null===n||void 0===n||!n.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((function(){n.forEach((function(e){return e.audioPlayer[t.data.interaction]()})),t.disposeDelay()}),this.data.delay)):n.forEach((function(e){return e.audioPlayer[t.data.interaction]()})))}},{key:"pauseAllAudios",value:function(){var e=this,t=Object(v.a)(DD.values());!t.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((function(){t.forEach((function(t){t.forEach((function(t){t.audioPlayer[e.data.interaction]()}))})),e.disposeDelay()}),this.data.delay)):t.forEach((function(t){t.forEach((function(t){t.audioPlayer[e.data.interaction]()}))})))}},{key:"disposeDelay",value:function(){clearTimeout(this.timeoutId),delete this.timeoutId}},{key:"dispose",value:function(){clearTimeout(this.timeoutId),delete this.timeoutId}}]),e}(),RD=function(){function e(t,n,r,i){if(Object(E.a)(this,e),this.data=n,"play"===n.interaction)this.interaction=new ID(t,n,r,i);else{if("pause"!==n.interaction&&"stop"!==n.interaction)throw new Error("Missing property");this.interaction=new PD(n)}}return Object(A.a)(e,[{key:"dispatchBasic",value:function(){this.interaction instanceof ID?this.interaction.playByToggle():this.interaction.dispatch()}},{key:"dispatchConditional",value:function(){this.interaction instanceof ID?this.interaction.audioPlayer.play():this.interaction.dispatch()}},{key:"dispatchGameControl",value:function(e){this.interaction instanceof ID&&("start"===e?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}},{key:"dispose",value:function(){this.interaction.dispose()}}]),e}();var LD=new Map,ND=new Map,BD=function(){function e(t,n,r){Object(E.a)(this,e),this.data=n,this.delay=0,this.status="stopped";var i=n.layerId,a=n.loop,o=n.volume,s=n.delay;if(this.object=r,void 0===i)throw new Error("Missing property");var u=function(e,t){var n=e.material.layers.find((function(e){return e.uuid===t}));return n.color.texture.image.img instanceof HTMLVideoElement?n.color.texture.image.img:void 0}(r,i);if(!u)throw new Error("Missing property");this.videoElement=u,this.videoElement.loop=a===1/0,this.videoElement.autoplay=!0,void 0!==o&&(this.videoElement.volume=o),void 0!==s&&(this.delay=s),ND.has(r.uuid)?ND.get(r.uuid).push(this):ND.set(r.uuid,[this]),LD.set(t,this),this.pause()}return Object(A.a)(e,[{key:"mute",value:function(){this.videoElement.muted=!0}},{key:"unMute",value:function(){this.videoElement.muted=!1}},{key:"play",value:function(e){var t=this,n=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?this.mute():n?(this.mute(),window.setTimeout((function(){t.unMute()}),100)):this.unMute(),this.delayTimerId=window.setTimeout((function(){t.videoElement.play(),t.clearDelay()}),this.delay),this.status="playing"}},{key:"clearDelay",value:function(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},{key:"pause",value:function(){this.videoElement.pause(),this.status="paused"}},{key:"stop",value:function(){this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay()}},{key:"playByToggle",value:function(){"stop"===this.data.toggle?"playing"===this.status?this.stop():(this.stop(),this.play()):"pause"===this.data.toggle?"playing"===this.status?this.pause():this.play():(this.stop(),this.play())}},{key:"dispose",value:function(){this.stop(),this.videoElement.muted=!0}}]),e}(),FD=function(){function e(t){Object(E.a)(this,e),this.data=t}return Object(A.a)(e,[{key:"dispatch",value:function(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}},{key:"pauseVideo",value:function(e){var t=this,n=LD.get(e);!n||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((function(){n[t.data.interaction](),t.disposeDelay()}),this.data.delay)):n[this.data.interaction]())}},{key:"pauseAllVideosFromObject",value:function(e){var t=this,n=ND.get(e);null===n||void 0===n||!n.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((function(){n.forEach((function(e){return e[t.data.interaction]()})),t.disposeDelay()}),this.data.delay)):n.forEach((function(e){return e[t.data.interaction]()})))}},{key:"pauseAllVideos",value:function(){var e=this,t=Object(v.a)(ND.values());!t.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((function(){t.forEach((function(t){t.forEach((function(t){t[e.data.interaction]()}))})),e.disposeDelay()}),this.data.delay)):t.forEach((function(t){t.forEach((function(t){t[e.data.interaction]()}))})))}},{key:"disposeDelay",value:function(){clearTimeout(this.timeoutId),delete this.timeoutId}},{key:"dispose",value:function(){clearTimeout(this.timeoutId),delete this.timeoutId}}]),e}(),UD=function(){function e(t,n,r){if(Object(E.a)(this,e),this.data=n,"play"===n.interaction)this.interaction=new BD(t,n,r);else{if("pause"!==n.interaction&&"stop"!==n.interaction)throw new Error("Missing property");this.interaction=new FD(n)}}return Object(A.a)(e,[{key:"dispatchBasic",value:function(){this.interaction instanceof BD?this.interaction.playByToggle():this.interaction.dispatch()}},{key:"dispatchConditional",value:function(){this.interaction instanceof BD?this.interaction.play():this.interaction.dispatch()}},{key:"dispose",value:function(){this.interaction.dispose()}}]),e}(),zD=function(e,t){return t.some((function(t){return t instanceof RegExp?t.test(e):t===e}))},VD=function(e,t){var n=t.stripHash,r=Object(c.a)(/^data:([^,]*?),([^#]*?)(?:#(.*))?$/,{type:1,data:2,hash:3}).exec(e);if(!r)throw new Error("Invalid URL: ".concat(e));var i=r.groups,a=i.type,o=i.data,s=i.hash,u=a.split(";");s=n?"":s;var l=!1;"base64"===u[u.length-1]&&(u.pop(),l=!0);var h=(u.shift()||"").toLowerCase(),d=Object(v.a)(u.map((function(e){var t=e.split("=").map((function(e){return e.trim()})),n=Object(g.a)(t,2),r=n[0],i=n[1],a=void 0===i?"":i;return"charset"===r&&"us-ascii"===(a=a.toLowerCase())?"":"".concat(r).concat(a?"=".concat(a):"")})).filter(Boolean));return l&&d.push("base64"),(d.length>0||h&&"text/plain"!==h)&&d.unshift(h),"data:".concat(d.join(";"),",").concat(l?o.trim():o).concat(s?"#".concat(s):"")};var GD=function(){function e(t,n){var r=t.url,i=t.context;if(Object(E.a)(this,e),this.managers=n,!r)throw new Error("Missing property");this.url=r.startsWith("mailto:")?r:function(e,t){if(t=Object(p.a)({defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0},t),e=e.trim(),/^data:/i.test(e))return VD(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");var n=e.startsWith("//");!n&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));var r=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&"https:"===r.protocol&&(r.protocol="http:"),t.forceHttps&&"http:"===r.protocol&&(r.protocol="https:"),t.stripAuthentication&&(r.username="",r.password=""),t.stripHash?r.hash="":t.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){for(var i=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,a=0,o="";;){var s=i.exec(r.pathname);if(!s)break;var u=s[0],c=s.index;o+=r.pathname.slice(a,c).replace(/\/{2,}/g,"/"),o+=u,a=c+u.length}o+=r.pathname.slice(a,r.pathname.length).replace(/\/{2,}/g,"/"),r.pathname=o}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch(y){}if(!0===t.removeDirectoryIndex&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){var l=r.pathname.split("/"),h=l[l.length-1];zD(h,t.removeDirectoryIndex)&&(l=l.slice(0,-1),r.pathname=l.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(var d=0,f=Object(v.a)(r.searchParams.keys());d<f.length;d++){var m=f[d];zD(m,t.removeQueryParameters)&&r.searchParams.delete(m)}if(!0===t.removeQueryParameters&&(r.search=""),t.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch(b){}}t.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));var g=e;return e=r.toString(),!t.removeSingleSlash&&"/"===r.pathname&&!g.endsWith("/")&&""===r.hash&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||"/"===r.pathname)&&""===r.hash&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),n&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}(r,{removeTrailingSlash:!1,removeSingleSlash:!1}),this.context=null!==i&&void 0!==i?i:"tab"}return Object(A.a)(e,[{key:"dispatch",value:function(){var e;xx?window.location.assign(this.url):("tab"===this.context?window.open(this.url,"_blank"):"window"===this.context?window.open(this.url,"_blank","width=".concat(window.innerWidth,", height=").concat(window.innerHeight)):window.open(this.url,"_parent"),null!==(e=this.managers.controlsManager.orbitControls)&&void 0!==e&&e.onPointerUp(Cx[0]),Cx.splice(0,Cx.length))}}]),e}(),HD=function(){function e(t,n,r,i){Object(E.a)(this,e),this.scene=n,this.sharedAssets=r,this.sceneData=t,this.managers=i}return Object(A.a)(e,[{key:"dispatch",value:function(){var e,t,n;gP(this.sceneData,this.scene,this.sharedAssets,!0),null!==(e=this.managers.eventManager)&&void 0!==e&&e.reset(),null!==(t=this.managers.controlsManager.orbitControls)&&void 0!==t&&t.reset(),null===(n=this.managers.controlsManager)||void 0===n||n.gameControls.forEach((function(e){return e.reset(!0)}))}}]),e}(),WD={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},qD={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},YD=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],XD={CSS:{},springs:{}};function KD(e,t,n){return Math.min(Math.max(e,t),n)}function QD(e,t){return e.indexOf(t)>-1}function ZD(e,t){return e.apply(null,t)}var JD={arr:function(e){return Array.isArray(e)},obj:function(e){return QD(Object.prototype.toString.call(e),"Object")},pth:function(e){return JD.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||JD.svg(e))},str:function(e){return"string"==typeof e},fnc:function(e){return"function"==typeof e},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return JD.hex(e)||JD.rgb(e)||JD.hsl(e)},key:function(e){return!WD.hasOwnProperty(e)&&!qD.hasOwnProperty(e)&&"targets"!==e&&"keyframes"!==e}};function $D(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map((function(e){return parseFloat(e)})):[]}function eI(e,t){var n=$D(e),r=KD(JD.und(n[0])?1:n[0],.1,100),i=KD(JD.und(n[1])?100:n[1],.1,100),a=KD(JD.und(n[2])?10:n[2],.1,100),o=KD(JD.und(n[3])?0:n[3],.1,100),s=Math.sqrt(i/r),u=a/(2*Math.sqrt(i*r)),c=u<1?s*Math.sqrt(1-u*u):0,l=1,h=u<1?(u*s-o)/c:-o+s;function d(e){var n=t?t*e/1e3:e;return n=u<1?Math.exp(-n*u*s)*(l*Math.cos(c*n)+h*Math.sin(c*n)):(l+h*n)*Math.exp(-n*s),0===e||1===e?e:1-n}return t?d:function(){var t=XD.springs[e];if(t)return t;for(var n=1/6,r=0,i=0;;)if(1===d(r+=n)){if(++i>=16)break}else i=0;var a=r*n*1e3;return XD.springs[e]=a,a}}function tI(e){return void 0===e&&(e=10),function(t){return Math.ceil(KD(t,1e-6,1)*e)*(1/e)}}var nI=function(){var e=11,t=1/(e-1);function n(e,t){return 1-3*t+3*e}function r(e,t){return 3*t-6*e}function i(e){return 3*e}function a(e,t,a){return((n(t,a)*e+r(t,a))*e+i(t))*e}function o(e,t,a){return 3*n(t,a)*e*e+2*r(t,a)*e+i(t)}return function(n,r,i,s){if(0<=n&&n<=1&&0<=i&&i<=1){var u=new Float32Array(e);if(n!==r||i!==s)for(var c=0;c<e;++c)u[c]=a(c*t,n,i);return function(e){return n===r&&i===s||0===e||1===e?e:a(l(e),r,s)}}function l(r){for(var s=0,c=1,l=e-1;c!==l&&u[c]<=r;++c)s+=t;--c;var h=s+(r-u[c])/(u[c+1]-u[c])*t,d=o(h,n,i);return d>=.001?function(e,t,n,r){for(var i=0;i<4;++i){var s=o(t,n,r);if(0===s)return t;t-=(a(t,n,r)-e)/s}return t}(r,h,n,i):0===d?h:function(e,t,n,r,i){var o,s,u=0;do{(o=a(s=t+(n-t)/2,r,i)-e)>0?n=s:t=s}while(Math.abs(o)>1e-7&&++u<10);return s}(r,s,s+t,n,i)}}}(),rI=function(){var e={linear:function(){return function(e){return e}}},t={Sine:function(){return function(e){return 1-Math.cos(e*Math.PI/2)}},Circ:function(){return function(e){return 1-Math.sqrt(1-e*e)}},Back:function(){return function(e){return e*e*(3*e-2)}},Bounce:function(){return function(e){for(var t,n=4;e<((t=Math.pow(2,--n))-1)/11;);return 1/Math.pow(4,3-n)-7.5625*Math.pow((3*t-2)/22-e,2)}},Elastic:function(e,t){void 0===e&&(e=1),void 0===t&&(t=.5);var n=KD(e,1,10),r=KD(t,.1,2);return function(e){return 0===e||1===e?e:-n*Math.pow(2,10*(e-1))*Math.sin((e-1-r/(2*Math.PI)*Math.asin(1/n))*(2*Math.PI)/r)}}};return["Quad","Cubic","Quart","Quint","Expo"].forEach((function(e,n){t[e]=function(){return function(e){return Math.pow(e,n+2)}}})),Object.keys(t).forEach((function(n){var r=t[n];e["easeIn"+n]=r,e["easeOut"+n]=function(e,t){return function(n){return 1-r(e,t)(1-n)}},e["easeInOut"+n]=function(e,t){return function(n){return n<.5?r(e,t)(2*n)/2:1-r(e,t)(-2*n+2)/2}}})),e}();function iI(e,t){if(JD.fnc(e))return e;var n=e.split("(")[0],r=rI[n],i=$D(e);switch(n){case"spring":return eI(e,t);case"cubicBezier":return ZD(nI,i);case"steps":return ZD(tI,i);default:return ZD(r,i)}}function aI(e){try{return document.querySelectorAll(e)}catch(t){return}}function oI(e,t){for(var n=e.length,r=arguments.length>=2?arguments[1]:void 0,i=[],a=0;a<n;a++)if(a in e){var o=e[a];t.call(r,o,a,e)&&i.push(o)}return i}function sI(e){return e.reduce((function(e,t){return e.concat(JD.arr(t)?sI(t):t)}),[])}function uI(e){return JD.arr(e)?e:(JD.str(e)&&(e=aI(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function cI(e,t){return e.some((function(e){return e===t}))}function lI(e){var t={};for(var n in e)t[n]=e[n];return t}function hI(e,t){var n=lI(e);for(var r in e)n[r]=t.hasOwnProperty(r)?t[r]:e[r];return n}function dI(e,t){var n=lI(e);for(var r in t)n[r]=JD.und(e[r])?t[r]:e[r];return n}function fI(e){return JD.rgb(e)?function(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}(e):JD.hex(e)?function(e){var t=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,n,r){return t+t+n+n+r+r})),n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return"rgba("+parseInt(n[1],16)+","+parseInt(n[2],16)+","+parseInt(n[3],16)+",1)"}(e):JD.hsl(e)?function(e){var t,n,r,i=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),a=parseInt(i[1],10)/360,o=parseInt(i[2],10)/100,s=parseInt(i[3],10)/100,u=i[4]||1;function c(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}if(0==o)t=n=r=s;else{var l=s<.5?s*(1+o):s+o-s*o,h=2*s-l;t=c(h,l,a+1/3),n=c(h,l,a),r=c(h,l,a-1/3)}return"rgba("+255*t+","+255*n+","+255*r+","+u+")"}(e):void 0}function pI(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function vI(e,t){return JD.fnc(e)?e(t.target,t.id,t.total):e}function mI(e,t){return e.getAttribute(t)}function gI(e,t,n){if(cI([n,"deg","rad","turn"],pI(t)))return t;var r=XD.CSS[t+n];if(!JD.und(r))return r;var i=document.createElement(e.tagName),a=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;a.appendChild(i),i.style.position="absolute",i.style.width=100+n;var o=100/i.offsetWidth;a.removeChild(i);var s=o*parseFloat(t);return XD.CSS[t+n]=s,s}function yI(e,t,n){if(t in e.style){var r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),i=e.style[t]||getComputedStyle(e).getPropertyValue(r)||"0";return n?gI(e,i,n):i}}function bI(e,t){return JD.dom(e)&&!JD.inp(e)&&(mI(e,t)||JD.svg(e)&&e[t])?"attribute":JD.dom(e)&&cI(YD,t)?"transform":JD.dom(e)&&"transform"!==t&&yI(e,t)?"css":null!=e[t]?"object":void 0}function wI(e){if(JD.dom(e)){for(var t,n=e.style.transform||"",r=/(\w+)\(([^)]*)\)/g,i=new Map;t=r.exec(n);)i.set(t[1],t[2]);return i}}function xI(e,t,n,r){var i=QD(t,"scale")?1:0+function(e){return QD(e,"translate")||"perspective"===e?"px":QD(e,"rotate")||QD(e,"skew")?"deg":void 0}(t),a=wI(e).get(t)||i;return n&&(n.transforms.list.set(t,a),n.transforms.last=t),r?gI(e,a,r):a}function OI(e,t,n,r){switch(bI(e,t)){case"transform":return xI(e,t,r,n);case"css":return yI(e,t,n);case"attribute":return mI(e,t);default:return e[t]||0}}function kI(e,t){var n=/^(\*=|\+=|-=)/.exec(e);if(!n)return e;var r=pI(e)||0,i=parseFloat(t),a=parseFloat(e.replace(n[0],""));switch(n[0][0]){case"+":return i+a+r;case"-":return i-a+r;case"*":return i*a+r}}function _I(e,t){if(JD.col(e))return fI(e);if(/\s/g.test(e))return e;var n=pI(e),r=n?e.substr(0,e.length-n.length):e;return t?r+t:r}function SI(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function EI(e){for(var t,n=e.points,r=0,i=0;i<n.numberOfItems;i++){var a=n.getItem(i);i>0&&(r+=SI(t,a)),t=a}return r}function AI(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return function(e){return 2*Math.PI*mI(e,"r")}(e);case"rect":return function(e){return 2*mI(e,"width")+2*mI(e,"height")}(e);case"line":return function(e){return SI({x:mI(e,"x1"),y:mI(e,"y1")},{x:mI(e,"x2"),y:mI(e,"y2")})}(e);case"polyline":return EI(e);case"polygon":return function(e){var t=e.points;return EI(e)+SI(t.getItem(t.numberOfItems-1),t.getItem(0))}(e)}}function jI(e,t){var n=t||{},r=n.el||function(e){for(var t=e.parentNode;JD.svg(t)&&JD.svg(t.parentNode);)t=t.parentNode;return t}(e),i=r.getBoundingClientRect(),a=mI(r,"viewBox"),o=i.width,s=i.height,u=n.viewBox||(a?a.split(" "):[0,0,o,s]);return{el:r,viewBox:u,x:u[0]/1,y:u[1]/1,w:o/u[2],h:s/u[3]}}function TI(e,t){function n(n){void 0===n&&(n=0);var r=t+n>=1?t+n:0;return e.el.getPointAtLength(r)}var r=jI(e.el,e.svg),i=n(),a=n(-1),o=n(1);switch(e.property){case"x":return(i.x-r.x)*r.w;case"y":return(i.y-r.y)*r.h;case"angle":return 180*Math.atan2(o.y-a.y,o.x-a.x)/Math.PI}}function MI(e,t){var n=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=_I(JD.pth(e)?e.totalLength:e,t)+"";return{original:r,numbers:r.match(n)?r.match(n).map(Number):[0],strings:JD.str(e)||t?r.split(n):[]}}function CI(e){return oI(e?sI(JD.arr(e)?e.map(uI):uI(e)):[],(function(e,t,n){return n.indexOf(e)===t}))}function DI(e){var t=CI(e);return t.map((function(e,n){return{target:e,id:n,total:t.length,transforms:{list:wI(e)}}}))}function II(e,t){var n=lI(t);if(/^spring/.test(n.easing)&&(n.duration=eI(n.easing)),JD.arr(e)){var r=e.length;2===r&&!JD.obj(e[0])?e={value:e}:JD.fnc(t.duration)||(n.duration=t.duration/r)}var i=JD.arr(e)?e:[e];return i.map((function(e,n){var r=JD.obj(e)&&!JD.pth(e)?e:{value:e};return JD.und(r.delay)&&(r.delay=n?0:t.delay),JD.und(r.endDelay)&&(r.endDelay=n===i.length-1?t.endDelay:0),r})).map((function(e){return dI(e,n)}))}function PI(e,t){var n=[],r=t.keyframes;for(var i in r&&(t=dI(function(e){for(var t=oI(sI(e.map((function(e){return Object.keys(e)}))),(function(e){return JD.key(e)})).reduce((function(e,t){return e.indexOf(t)<0&&e.push(t),e}),[]),n={},r=function(r){var i=t[r];n[i]=e.map((function(e){var t={};for(var n in e)JD.key(n)?n==i&&(t.value=e[n]):t[n]=e[n];return t}))},i=0;i<t.length;i++)r(i);return n}(r),t)),t)JD.key(i)&&n.push({name:i,tweens:II(t[i],e)});return n}function RI(e,t){var n;return e.tweens.map((function(r){var i=function(e,t){var n={};for(var r in e){var i=vI(e[r],t);JD.arr(i)&&(i=i.map((function(e){return vI(e,t)})),1===i.length&&(i=i[0])),n[r]=i}return n.duration=parseFloat(n.duration),n.delay=parseFloat(n.delay),n}(r,t),a=i.value,o=JD.arr(a)?a[1]:a,s=pI(o),u=OI(t.target,e.name,s,t),c=n?n.to.original:u,l=JD.arr(a)?a[0]:c,h=pI(l)||pI(u),d=s||h;return JD.und(o)&&(o=c),i.from=MI(l,d),i.to=MI(kI(o,l),d),i.start=n?n.end:0,i.end=i.start+i.delay+i.duration+i.endDelay,i.easing=iI(i.easing,i.duration),i.isPath=JD.pth(a),i.isColor=JD.col(i.from.original),i.isColor&&(i.round=1),n=i,i}))}var LI={css:function(e,t,n){return e.style[t]=n},attribute:function(e,t,n){return e.setAttribute(t,n)},object:function(e,t,n){return e[t]=n},transform:function(e,t,n,r,i){if(r.list.set(t,n),t===r.last||i){var a="";r.list.forEach((function(e,t){a+=t+"("+e+") "})),e.style.transform=a}}};function NI(e,t){DI(e).forEach((function(e){for(var n in t){var r=vI(t[n],e),i=e.target,a=pI(r),o=OI(i,n,a,e),s=kI(_I(r,a||pI(o)),o),u=bI(i,n);LI[u](i,n,s,e.transforms,!0)}}))}function BI(e,t){return oI(sI(e.map((function(e){return t.map((function(t){return function(e,t){var n=bI(e.target,t.name);if(n){var r=RI(t,e),i=r[r.length-1];return{type:n,property:t.name,animatable:e,tweens:r,duration:i.end,delay:r[0].delay,endDelay:i.endDelay}}}(e,t)}))}))),(function(e){return!JD.und(e)}))}function FI(e,t){var n=e.length,r=function(e){return e.timelineOffset?e.timelineOffset:0},i={};return i.duration=n?Math.max.apply(Math,e.map((function(e){return r(e)+e.duration}))):t.duration,i.delay=n?Math.min.apply(Math,e.map((function(e){return r(e)+e.delay}))):t.delay,i.endDelay=n?i.duration-Math.max.apply(Math,e.map((function(e){return r(e)+e.duration-e.endDelay}))):t.endDelay,i}var UI=0;var zI,VI=[],GI=[],HI=function(){function e(){zI=requestAnimationFrame(t)}function t(t){var n=VI.length;if(n){for(var r=0;r<n;){var i=VI[r];i.paused?(VI.splice(r,1),n-=1):(i.tick(t),r++)}e()}else zI=cancelAnimationFrame(zI)}return e}();function WI(e){void 0===e&&(e={});var t,n=0,r=0,i=0,a=0,o=null;function s(e){var t=window.Promise&&new Promise((function(e){return o=e}));return e.finished=t,t}var u=function(e){var t=hI(WD,e),n=hI(qD,e),r=PI(n,e),i=DI(e.targets),a=BI(i,r),o=FI(a,n),s=UI;return UI++,dI(t,{id:s,children:[],animatables:i,animations:a,duration:o.duration,delay:o.delay,endDelay:o.endDelay})}(e);s(u);function c(){var e=u.direction;"alternate"!==e&&(u.direction="normal"!==e?"normal":"reverse"),u.reversed=!u.reversed,t.forEach((function(e){return e.reversed=u.reversed}))}function l(e){return u.reversed?u.duration-e:e}function h(){n=0,r=l(u.currentTime)*(1/WI.speed)}function d(e,t){t&&t.seek(e-t.timelineOffset)}function f(e){var t=0,n=u.animations,r=n.length;for(!0===u.reversePlayback&&!1===u.rewind&&(e=u.duration+u.delay-u.endDelay-e);t<r;){var i=n[t],a=i.animatable,o=i.tweens,s=o.length-1,c=o[s];s&&(c=oI(o,(function(t){return e<t.end}))[0]||c);for(var l=KD(e-c.start-c.delay,0,c.duration)/c.duration,h=isNaN(l)?1:c.easing(l),d=c.to.strings,f=c.round,p=[],v=c.to.numbers.length,m=void 0,g=0;g<v;g++){var y=void 0;if(!0===u.reversePlayback&&!1===u.rewind)var b=c.to.numbers[g],w=c.from.numbers[g]||0;else w=c.to.numbers[g],b=c.from.numbers[g]||0;y=c.isPath?TI(c.value,h*w):b+h*(w-b),f&&(c.isColor&&g>2||(y=Math.round(y*f)/f)),p.push(y)}var x=d.length;if(x){m=d[0];for(var O=0;O<x;O++){d[O];var k=d[O+1],_=p[O];isNaN(_)||(m+=k?_+k:_+" ")}}else m=p[0];LI[i.type](a.target,i.property,m,a.transforms),i.currentValue=m,t++}}function p(e){u[e]&&!u.passThrough&&u[e](u)}function v(e){var h=u.duration,v=u.delay,m=h-u.endDelay,g=l(e);u.progress=KD(g/h*100,0,100),u.reversePlayback=g<u.currentTime,t&&function(e){if(u.reversePlayback)for(var n=a;n--;)d(e,t[n]);else for(var r=0;r<a;r++)d(e,t[r])}(g),!u.began&&u.currentTime>=0&&(u.began=!0,p("begin")),!u.loopBegan&&u.currentTime>0&&(u.loopBegan=!0,p("loopBegin")),g<=v&&0!==u.currentTime&&(f(0),p("change")),(g>=m&&u.currentTime!==h||!h)&&(f(h),p("change")),g>v&&g<m?(u.changeBegan||(u.changeBegan=!0,u.changeCompleted=!1,p("changeBegin")),p("change"),f(g)):u.changeBegan?(u.changeCompleted=!0,u.changeBegan=!1,p("change"),p("changeComplete")):u.began&&g>m&&(p("change"),p("changeComplete")),u.currentTime=KD(g,0,h),u.began&&p("update"),e>=h&&(r=0,u.remaining&&!0!==u.remaining&&u.remaining--,u.remaining?(n=i,p("loopComplete"),u.loopBegan=!1,"alternate"===u.direction&&c()):(u.paused=!0,u.completed||(u.completed=!0,p("loopComplete"),p("complete"),!u.passThrough&&"Promise"in window&&(o(),s(u)))))}return u.reset=function(){var e=u.direction;u.passThrough=!1,u.currentTime=0,u.progress=0,u.paused=!0,u.began=!1,u.loopBegan=!1,u.changeBegan=!1,u.completed=!1,u.changeCompleted=!1,u.reversePlayback=!1,u.reversed="reverse"===e,u.remaining=u.loop,t=u.children;for(var n=a=t.length;n--;)u.children[n].reset();(u.reversed&&!0!==u.loop||"alternate"===e&&1===u.loop)&&u.remaining++,f(u.reversed?u.duration:0)},u.set=function(e,t){return NI(e,t),u},u.tick=function(e){i=e,n||(n=i),v((i+(r-n))*WI.speed)},u.seek=function(e){v(l(e))},u.pause=function(){u.paused=!0,h()},u.play=function(){!u.paused||(u.completed&&u.reset(),u.paused=!1,VI.push(u),h(),zI||HI())},u.reverse=function(){c(),u.completed=!u.reversed,h()},u.restart=function(){u.reset(),u.play()},u.reset(),u.autoplay&&u.play(),u}function qI(e,t){for(var n=t.length;n--;)cI(e,t[n].animatable.target)&&t.splice(n,1)}typeof document<"u"&&document.addEventListener("visibilitychange",(function(){document.hidden?(VI.forEach((function(e){return e.pause()})),GI=VI.slice(0),WI.running=VI=[]):GI.forEach((function(e){return e.play()}))})),WI.version="3.2.0",WI.speed=1,WI.running=VI,WI.remove=function(e){for(var t=CI(e),n=VI.length;n--;){var r=VI[n],i=r.animations,a=r.children;qI(t,i);for(var o=a.length;o--;){var s=a[o],u=s.animations;qI(t,u),!u.length&&!s.children.length&&a.splice(o,1)}!i.length&&!a.length&&r.pause()}},WI.get=OI,WI.set=NI,WI.convertPx=gI,WI.path=function(e,t){var n=JD.str(e)?aI(e)[0]:e,r=t||100;return function(e){return{property:e,el:n,svg:jI(n),totalLength:AI(n)*(r/100)}}},WI.setDashoffset=function(e){var t=AI(e);return e.setAttribute("stroke-dasharray",t),t},WI.stagger=function(e,t){void 0===t&&(t={});var n=t.direction||"normal",r=t.easing?iI(t.easing):null,i=t.grid,a=t.axis,o=t.from||0,s="first"===o,u="center"===o,c="last"===o,l=JD.arr(e),h=parseFloat(l?e[0]:e),d=l?parseFloat(e[1]):0,f=pI(l?e[1]:e)||0,p=t.start||0+(l?h:0),v=[],m=0;return function(e,t,g){if(s&&(o=0),u&&(o=(g-1)/2),c&&(o=g-1),!v.length){for(var y=0;y<g;y++){if(i){var b=u?(i[0]-1)/2:o%i[0],w=u?(i[1]-1)/2:Math.floor(o/i[0]),x=b-y%i[0],O=w-Math.floor(y/i[0]),k=Math.sqrt(x*x+O*O);"x"===a&&(k=-x),"y"===a&&(k=-O),v.push(k)}else v.push(Math.abs(o-y));m=Math.max.apply(Math,v)}r&&(v=v.map((function(e){return r(e/m)*m}))),"reverse"===n&&(v=v.map((function(e){return a?e<0?-1*e:-e:Math.abs(m-e)})))}return p+(l?(d-h)/m:h)*(Math.round(100*v[t])/100)+f}},WI.timeline=function(e){void 0===e&&(e={});var t=WI(e);return t.duration=0,t.add=function(n,r){var i=VI.indexOf(t),a=t.children;function o(e){e.passThrough=!0}i>-1&&VI.splice(i,1);for(var s=0;s<a.length;s++)o(a[s]);var u=dI(n,hI(qD,e));u.targets=u.targets||e.targets;var c=t.duration;u.autoplay=!1,u.direction=t.direction,u.timelineOffset=JD.und(r)?c:kI(r,c),o(t),u.rewind=t.rewind,t.seek(u.timelineOffset);var l=WI(u);o(l),a.push(l);var h=FI(a,e);return t.delay=h.delay,t.endDelay=h.endDelay,t.duration=h.duration,t.seek(0),t.reset(),t.autoplay&&t.play(),t},t},WI.easing=iI,WI.penner=rI,WI.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var YI=WI,XI=new tr,KI=new tr,QI=new er;function ZI(e,t,n,r,i){var a=n[e]?n[e]:void 0,o=r[e];if(null!=o){var s=null!==a&&void 0!==a?a:t[e],u=o;return s!==u?{update:function(n){var r=En.lerp(s,u,n);t[e]=i?Math.trunc(r):r},start:function(){t[e]=s},end:function(){t[e]=u}}:void 0}}function JI(e,t,n,r,i){var a=n[e]?n[e]:void 0,o=r[e];if(o){var s=t[e],u=Object(v.a)(null!==a&&void 0!==a?a:s),c=Object(v.a)(o);return u.length!==c.length||Cg(u,c)?void 0:{update:function(n){u.forEach((function(r,a){var o=En.lerp(r,c[a],n);t[e][a]=i?Math.trunc(o):o}))},start:function(){Object.assign(t[e],u)},end:function(){Object.assign(t[e],c)}}}}function $I(e,t,n,r){var i=n[e]?n[e]:void 0,a=r[e];if(a){var o=t[e],s=i?(new tr).fromArray(i):o.clone(),u=(new tr).fromArray(a);return s.equals(u)?void 0:{update:function(e){o.lerpVectors(s,u,e)},start:function(){o.copy(s)},end:function(){o.copy(u)}}}}function eP(e,t,n,r){var i=[];if(void 0!==n.intensity){var a=ZI("intensity",e,t,n);a&&i.push(a)}if(void 0!==n.color){var o=function(e,t,n,r,i){var a=n[e]?n[e]:void 0,o=r[e];if(o){var s=t[e],u=a?"string"==typeof a?i.getColor(a).clone():(new Gn).setRGB(a.r,a.g,a.b):s.clone(),c="string"==typeof o?i.getColor(o).clone():(new Gn).setRGB(o.r,o.g,o.b);if(!u.equals(c)){var l=s.clone();return t[e]=l,{update:function(e){l.lerpColors(u,c,e)},start:function(){l.copy(u)},end:function(){l.copy(c)}}}}}("color",e,t,n,r);o&&i.push(o)}return i}function tP(e,t,n,r){var i=[];e.transparent=cT(n,r);var a,o=Object(j.a)(e.layers);try{for(o.s();!(a=o.n()).done;){var s,u,c,l=a.value,h=null===(s=t.layers)||void 0===s?void 0:s.data(l.uuid),d=n.layers.data(l.uuid);if(d&&(null===(u=l.visible)||void 0===u||u)&&(null===(c=d.visible)||void 0===c||c)){var f,p=l.getNames().filter((function(e){return!gx.some((function(t){return e.includes(t)}))})),m=Object(j.a)(p);try{for(m.s();!(f=m.n()).done;){var g=f.value;try{var y=l.getValue(g),b=void 0;if("colors"===g)b=uP(l,h,d,g);else if(Array.isArray(y))"steps"===g&&(b=sP(l,h,d,g));else if("number"==typeof y)b=nP(l,h,d,g);else{if("boolean"==typeof y)continue;y instanceof An?b=rP(l,h,d,g):y instanceof tr?b=iP(l,h,d,g):y instanceof dA?b=oP(l,h,d,g,r):y instanceof Gn?b=aP(l,h,d,g,r):"isTexture"in y&&(b=cP(l,h,d,g))}b&&(Array.isArray(b)?i.push.apply(i,Object(v.a)(b)):i.push(b))}catch(y){console.error("lerpMaterial: unexpected material layer for ".concat(g),y)}}}catch(w){m.e(w)}finally{m.f()}}}}catch(w){o.e(w)}finally{o.f()}return i}function nP(e,t,n,r){if(e.hasValue(r)&&r in n){var i=t?t[r]:e.getValue(r),a=n[r];return i!==a?{update:function(t){e.setValue(r,En.lerp(i,a,t))},start:function(){e.setValue(r,i)},end:function(){e.setValue(r,a)}}:void 0}}function rP(e,t,n,r){if(e.hasValue(r)&&r in n){var i=e.getValue(r),a=t?(new An).fromArray(t[r]):i.clone(),o=(new An).fromArray(n[r]);return a.equals(o)?void 0:{update:function(e){i.lerpVectors(a,o,e)},start:function(){i.copy(a)},end:function(){i.copy(o)}}}}function iP(e,t,n,r){if(e.hasValue(r)&&r in n){var i=e.getValue(r),a=t?(new tr).fromArray(t[r]):i.clone(),o=(new tr).fromArray(n[r]);return a.equals(o)?void 0:{update:function(e){i.lerpVectors(a,o,e)},start:function(){i.copy(a)},end:function(){i.copy(o)}}}}function aP(e,t,n,r,i){if(e.hasValue(r)&&r in n){var a=t?t[r]:void 0,o=n[r],s=e.getValue(r),u=a?"string"==typeof a?i.getColor(a).clone():(new Gn).setRGB(a.r,a.g,a.b):s.clone(),c="string"==typeof o?i.getColor(o).clone():(new Gn).setRGB(o.r,o.g,o.b);if(!u.equals(c)){var l=s.clone();return e.setValue(r,l),{update:function(e){l.lerpColors(u,c,e)},start:function(){l.copy(u)},end:function(){l.copy(c)}}}}}function oP(e,t,n,r,i){if(e.hasValue(r)&&r in n){var a=t?t[r]:void 0,o=n[r],s=e.getValue(r),u=a?"string"==typeof a?i.getColor(a).clone():(new Gn).setRGB(a.r,a.g,a.b):s.clone(),c="string"==typeof o?i.getColor(o).clone():new dA(o.r,o.g,o.b,o.a);if(!u.equals(c)){var l=s.clone();return e.setValue(r,l),{update:function(e){l.lerpColors(u,c,e)},start:function(){l.copy(u)},end:function(){l.copy(c)}}}}}function sP(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(e.hasValue(r)&&r in n){for(var i=[],a=e.getValue(r),o=t?t[r]:a,s=n[r],u=function(e){var t=o[e],n=s[e];t!==n&&i.push({update:function(r){a[e]=En.lerp(t,n,r)},start:function(){a[e]=t},end:function(){a[e]=n}})},c=0;c<a.length;++c)u(c);return i.length?i:void 0}}function uP(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"colors";if(e.hasValue(r)&&r in n){for(var i=[],a=e.getValue(r),o=t?t[r]:a.map((function(e){return e.toArray()})),s=n[r],u=function(e){var t=Object(v.a)(o[e]),n=Object(v.a)(s[e]);xw.isEqual(t,n)||i.push({update:function(r){a[e].fromArray(xw.lerp(t,n,r))},start:function(){a[e].fromArray(t)},end:function(){a[e].fromArray(n)}})},c=0;c<a.length;++c)u(c);return i.length?i:void 0}}function cP(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"texture";if(e.hasValue(r)&&r in n){var i=e.getNode("mat");if(i){var a=t?t[r]:i,o=n[r],s=Object(v.a)(a.repeat),u=Object(v.a)(a.offset),c=Object(v.a)(o.repeat),l=Object(v.a)(o.offset);return yw.isEqual(s,c)&&yw.isEqual(u,l)?void 0:{update:function(e){i.repeat=yw.lerp(s,c,e),i.offset=yw.lerp(u,l,e),i.updateMatrix()},start:function(){i.repeat=Object(v.a)(s),i.offset=Object(v.a)(u),i.updateMatrix()},end:function(){i.repeat=Object(v.a)(c),i.offset=Object(v.a)(l),i.updateMatrix()}}}}}var lP=new tr,hP=new Vr;function dP(e,t,n,r){var i=[],a=$I("position",e,t,n);a&&i.push(a);var o=$I("scale",e,t,n);o&&i.push(o);var s=function(e,t,n,r){var i=null!==t&&void 0!==t&&t.rotation?t.rotation:void 0,a=n.rotation;if(!a)return;var o=i?(new tr).fromArray(i):(new tr).setFromEuler(e.rotation),s=(new tr).fromArray(a);if(o.equals(s))return;var u=lP.subVectors(s,o);if(r&&u.toArray().every((function(e){return Math.abs(e)<2*Math.PI}))){var c=(new er).setFromEuler(hP.setFromVector3(o)),l=(new er).setFromEuler(hP.setFromVector3(s));return{update:function(t){!function(e,t,n,r){if(0===r)return n.copy(e);if(1===r)return n.copy(t);var i=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(i>=1)return n.copy(e);var a=1-i*i;if(a<=Number.EPSILON){var o=1-r;return n.w=o*e.w+r*t.w,n.x=o*e.x+r*t.x,n.y=o*e.y+r*t.y,n.z=o*e.z+r*t.z,n.normalize(),n}var s=Math.sqrt(a),u=Math.atan2(s,i),c=Math.sin((1-r)*u)/s,l=Math.sin(r*u)/s;n.w=e.w*c+t.w*l,n.x=e.x*c+t.x*l,n.y=e.y*c+t.y*l,n.z=e.z*c+t.z*l}(c,l,e.quaternion,t)},start:function(){e.rotation.setFromVector3(o)},end:function(){e.rotation.setFromVector3(s)}}}return{update:function(t){lP.lerpVectors(o,s,t),e.rotation.setFromVector3(lP)},start:function(){e.rotation.setFromVector3(o)},end:function(){e.rotation.setFromVector3(s)}}}(e,t,n,r);s&&i.push(s);var u=function(e,t,n,r){var i=n[e]?n[e]:void 0,a=r[e];if(a){var o=t[e],s=i?(new Dr).fromArray(i):o.clone(),u=new tr,c=new er,l=new tr;s.decompose(u,c,l);var h=(new Dr).fromArray(a),d=new tr,f=new er,p=new tr;return h.decompose(d,f,p),s.equals(h)?void 0:{update:function(e){QI.slerpQuaternions(c,f,e),XI.lerpVectors(u,d,e),KI.lerpVectors(l,p,e),o.compose(XI,QI,KI)},start:function(){o.compose(u,c,l)},end:function(){o.compose(d,f,p)}}}}("hiddenMatrix",e,t,n);if(u&&i.push(u),a||o||s||u){var c=function(){var t;e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),null!==(t=e.parent)&&void 0!==t&&t.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),JM(e)&&$M(e.parent)&&e.invalidateDownstreamBooleanData(!0)};i.push({update:c,start:c,end:c})}return i}function fP(e,t,n,r){return"number"==typeof t[e]?ZI(e,t,null!==n&&void 0!==n?n:{},r):Array.isArray(t[e])?JI(e,t,null!==n&&void 0!==n?n:{},r):void 0}function pP(e,t,n){var r=[];if(!("cloner"in n)||!e.cloner)return r;var i=e.cloner,a="cloner"in t?t.cloner:{},o=n.cloner;Gw.forEach((function(e){var t;(t="count"===e?ZI("count",i.parameters,a,o,!0):fP(e,i.parameters,null!==a&&void 0!==a?a:{},o))&&r.push(t)}));var s=function(e,t,n){if("radial"!==e.parameters.type)return;var r=t.radial,i=n.radial;if(!i)return;var a=e.parameters.radial,o=[];return Hw.forEach((function(e){var t=fP(e,a,null!==r&&void 0!==r?r:{},i);t&&o.push(t)})),o}(i,a,o);(null===s||void 0===s?void 0:s.length)&&r.push.apply(r,Object(v.a)(s));var u=function(e,t,n){if("linear"!==e.parameters.type)return;var r=t.linear,i=n.linear;if(!i)return;var a=[],o=e.parameters.linear;return Ww.forEach((function(e){var t=fP(e,o,null!==r&&void 0!==r?r:{},i);t&&a.push(t)})),a}(i,a,o);(null===u||void 0===u?void 0:u.length)&&r.push.apply(r,Object(v.a)(u));var c=function(e,t,n){if("grid"!==e.parameters.type)return;var r=t.grid,i=n.grid;if(!i)return;var a=[],o=e.parameters.grid;return qw.forEach((function(e){var t;(t="count"===e?JI(e,o,null!==r&&void 0!==r?r:{},i,!0):fP(e,o,null!==r&&void 0!==r?r:{},i))&&a.push(t)})),a}(i,a,o);(null===c||void 0===c?void 0:c.length)&&r.push.apply(r,Object(v.a)(c));var l=function(e,t,n){if("toObject"!==e.parameters.type)return;var r=t.toObject,i=n.toObject;if(!i)return;var a=[],o=e.parameters.toObject;return Yw.forEach((function(e){var t;(t="count"===e?ZI(e,o,null!==r&&void 0!==r?r:{},i,!0):fP(e,o,null!==r&&void 0!==r?r:{},i))&&a.push(t)})),a}(i,a,o);(null===l||void 0===l?void 0:l.length)&&r.push.apply(r,Object(v.a)(l));var h=function(e,t,n){if(!e.parameters.randomness)return;var r=t.randomnessObject,i=n.randomnessObject;if(!i)return;var a=[],o=e.parameters.randomnessObject;return Xw.forEach((function(e){var t=fP(e,o,null!==r&&void 0!==r?r:{},i);t&&a.push(t)})),a}(i,a,o);return null!==h&&void 0!==h&&h.length&&r.push.apply(r,Object(v.a)(h)),r.length&&r.push({update:function(){i.update()}}),r}function vP(e,t,n,r,i){var a=[];return e.data.visible&&a.push.apply(a,Object(v.a)(dP(e,t,n,i))),e.data.visible&&a.push.apply(a,Object(v.a)(pP(e,t,n))),JM(e)?(e instanceof BT&&e.data.visible&&a.push.apply(a,Object(v.a)(function(e,t,n,r){var i=[];if(!("geometry"in n))return i;var a="geometry"in t?t.geometry:{},o=n.geometry;if(e instanceof HT){var s,u,c=null!==(s=a.scaleBaked)&&void 0!==s?s:e.data.geometry.scaleBaked,l=null!==(u=o.scaleBaked)&&void 0!==u?u:e.data.geometry.scaleBaked;return bw.isEqual(c,l)||i.push({update:function(t){e.updateGeometryInteractions({scaleBaked:[En.lerp(c[0],l[0],t),En.lerp(c[1],l[1],t),En.lerp(c[2],l[2],t)]},r),e.invalidateDownstreamBooleanData()},start:function(){e.updateGeometryInteractions({scaleBaked:c},r),e.invalidateDownstreamBooleanData()},end:function(){e.updateGeometryInteractions({scaleBaked:l},r),e.invalidateDownstreamBooleanData()}}),i}var h=a.width,d=a.height,f=a.depth,p=o.width,v=o.height,m=o.depth;if(void 0!==p||void 0!==v||void 0!==m){var g=e.geometry.userData.parameters,y=g.width,b=g.height,w=g.depth,x=null!==h&&void 0!==h?h:y,O=null!==d&&void 0!==d?d:b,k=null!==f&&void 0!==f?f:w,_=null!==p&&void 0!==p?p:y,S=null!==v&&void 0!==v?v:b,E=null!==m&&void 0!==m?m:w;(x!==_||O!==S||k!==E)&&i.push({update:function(t){e.updateGeometryInteractions({width:En.lerp(x,_,t),height:En.lerp(O,S,t),depth:En.lerp(k,E,t)},r),e.updateGeometryGroupsIfNeeded(),e.invalidateDownstreamBooleanData()},start:function(){e.updateGeometryInteractions({width:x,height:O,depth:k},r),e.invalidateDownstreamBooleanData()},end:function(){e.updateGeometryInteractions({width:_,height:S,depth:E},r),e.invalidateDownstreamBooleanData()}})}return i}(e,t,n,r))),e.data.visible&&a.push.apply(a,Object(v.a)(function(e,t,n,r){var i=[];if(Array.isArray(e.material)){if(!("materials"in n)||!n.materials)return i;var a="materials"in t&&t.materials?t.materials:[],o=n.materials;e.material.forEach((function(e,t){var n;if(o[t]){var s=null!==(n=a[t])&&void 0!==n?n:{},u=o[t];"string"==typeof s||"string"==typeof u||i.push.apply(i,Object(v.a)(tP(e,s,u,r)))}}))}else{if(!("material"in n)||!n.material)return i;var s="material"in t&&t.material?t.material:{},u=n.material;if("string"==typeof s||"string"==typeof u)return i;i.push.apply(i,Object(v.a)(tP(e.material,s,u,r)))}return i}(e,t,n,r)))):tC(e)?e.data.visible&&a.push.apply(a,Object(v.a)(eP(e,t,n,r))):eC(e)&&a.push.apply(a,Object(v.a)(function(e,t,n){var r,i,a,o,s=[],u="OrthographicCamera"===e.cameraType?null===(r=t.orthographic)||void 0===r?void 0:r.zoom:null===(i=t.perspective)||void 0===i?void 0:i.zoom,c="OrthographicCamera"===e.cameraType?null===(a=n.orthographic)||void 0===a?void 0:a.zoom:null===(o=n.perspective)||void 0===o?void 0:o.zoom;if(void 0!==c){var l=null!==u&&void 0!==u?u:e.zoom,h=c;l!==h&&s.push({update:function(t){e.zoom=En.lerp(l,h,t),e.updateProjectionMatrix()},start:function(){e.zoom=l,e.updateProjectionMatrix()},end:function(){e.zoom=h,e.updateProjectionMatrix()}})}if(void 0!==n.targetOffset){var d=ZI("targetOffset",e,t,n);d&&s.push(d)}return s}(e,t,n))),a.length?{update:function(e){a.forEach((function(t){return t.update(e)}))},start:function(e){a.forEach((function(t){var n;return null===(n=t.start)||void 0===n?void 0:n.call(t,e)}))},end:function(e){a.forEach((function(t){var n;return null===(n=t.end)||void 0===n?void 0:n.call(t,e)}))}}:void 0}var mP=new tr;function gP(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=[];t.traverseObject((function(a){var o,s,u,c,l;if(r&&(null!==(o=a.rigidBody)&&void 0!==o&&o.setTranslation(a.position0,!0),null!==(s=a.rigidBody)&&void 0!==s&&s.setRotation(a.rotation0,!0),null!==(u=a.rigidBody)&&void 0!==u&&u.setLinvel(mP,!0),null!==(c=a.rigidBody)&&void 0!==c&&c.setAngvel(mP,!0)),Fk.is(a)){var h=a.uuid,d=a.data;if(delete a.states,d.states){var f=!1;i.some((function(t){return e.objects.isDescendantOf(h,t)}))?f=!0:!0===(null===(l=d.physics)||void 0===l?void 0:l.fusedBody)&&"dynamic"===d.physics.rigidBody&&i.push(h),a.data=d,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;var p,v=Object(j.a)(d.states);try{for(v.s();!(p=v.n()).done;){var m=p.value;!0===e.environment.usePhysics&&d.physics&&("dynamic"===d.physics.rigidBody||f)&&(void 0!==m.data.position||void 0!==m.data.rotation||void 0!==m.data.hiddenMatrix)||(a.states||(a.states={}),a.states[m.id]=fx.patch(d,m.data))}}catch(g){v.e(g)}finally{v.f()}!function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];t instanceof BT&&t.removeInteractionGeometry(),t.changeSelectedState(n,{scene:e,shared:r},i),t instanceof BT&&t.updateGeometryGroupsIfNeeded()}(t,a,null,n,void 0!==d.events.find((function(e){return"Follow"===e.data.type||"LookAt"===e.data.type})))}}}))}var yP=function(){function e(t,n,r,i,a,o){var s=this;if(Object(E.a)(this,e),this.object=t,this.data=i,this.sharedAssets=a,this.allowSlerp=o,this.targets={t:0},this.firstLoop=!0,this.reverse=!1,this._playing=!1,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=function(){s.callback&&(s.callback.update(s.targets.t),s.object.dispatchEvent({type:"requestRender"})),0===s.targets.t||1===s.targets.t?s._changeCompleted||(s._changeCompleted=!0,s._changeBegan=!1,s.onChangeComplete()):(s._changeCompleted&&(s._changeCompleted=!1),s._changeBegan||(s._changeBegan=!0,s.onChangeBegin()))},this.onChangeBegin=function(){var e,t;s.reverse?(e=s.to,t=s.from):(e=s.from,t=s.to),s.object.reversibleToState=t.id;var n=s.targets.t>.5?e.id:t.id;s.object.prevState!==s.object.currentState&&(s.object.prevState=s.object.currentState),s.object.currentState=n,s.object.dispatchEvent({type:"beginState",state:n})},this.onChangeComplete=function(){var e,t;s.reverse?(e=s.to,t=s.from):(e=s.from,t=s.to),s.firstLoop&&(s.onFirstLoop(),s.firstLoop=!1),s.object.reversibleToState=t.id;var n=s.targets.t<.5?e.id:t.id;s.object.prevState!==s.object.currentState&&(s.object.prevState=s.object.currentState),s.object.currentState=n,s.object.dispatchEvent({type:"completeState",state:n})},this.onFirstLoop=function(){var e,t;s.useCurrentState&&(s.reverse?(e=s.to,t=s.from):(e=s.from,t=s.to),s.callback=vP(s.object,e.data,t.data,s.sharedAssets,s.allowSlerp))},n===r)throw new Error("Missing property");if(void 0===n){var u=this.getState(this.object.currentState===r?this.object.prevState:this.object.currentState);if(!u)throw new Error("Missing property");this.from=u}else{var c=this.getState(n);if(!c)throw new Error("Missing property");this.from=c}if(void 0===r)throw new Error("Missing property");var l=this.getState(r);if(!l)throw new Error("Missing property");this.to=l,this.useCurrentState=void 0===n||void 0===r,this.params=Object(p.a)(Object(p.a)(Object(p.a)({targets:this.targets,t:1,autoplay:!1},function(e){var t={delay:0,repeatDelay:0,loop:-1===e.repeat||e.repeat+1};if(0===e.repeat)t.direction="normal",t.rewind="pingpong-rewind"===e.direction;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1}switch(e.delayDirection){case"start-once":break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay}return t}(i)),function(e){var t;switch(e.easing){case 0:t="cubicBezier( 0, 0, 1, 1 )";break;case 1:t="cubicBezier( .25, .1, .25, 1 )";break;case 2:t="cubicBezier( .42, 0, 1, 1 )";break;case 3:t="cubicBezier( 0, 0, .58, 1 )";break;case 4:t="cubicBezier( .42, 0, .58, 1 )";break;case 5:var n=e.control1,r=e.control2;t="cubicBezier(\n\t\t\t\t".concat(n[0],", ").concat(n[1],", ").concat(r[0],", ").concat(r[1],"\n\t\t\t)");break;case 6:var i=e.mass,a=e.stiffness,o=e.damping,s=e.velocity;t="spring( ".concat(i,", ").concat(a,", ").concat(o,", ").concat(s," )");break;default:t="linear"}return{duration:e.duration,easing:t}}(i)),{},{change:this.onChange}),this.callback=vP(this.object,void 0===n?{}:this.from.data,void 0===r?{}:this.to.data,this.sharedAssets,this.allowSlerp),this.core=YI(Object(p.a)({},this.params)),this.core.finished.then((function(){return s._playing=!1}))}return Object(A.a)(e,[{key:"changeBegan",get:function(){return this._changeBegan}},{key:"changeCompleted",get:function(){return this._changeCompleted}},{key:"playing",get:function(){return this._playing}},{key:"getState",value:function(e){var t,n,r;if("string"==typeof e?(n=e,r=null===(t=this.object.states)||void 0===t?void 0:t[n]):null===e&&(n=null,r=this.object.data),void 0!==n&&void 0!==r)return{id:n,data:r}}},{key:"play",value:function(){if(this._playing)return!1;this.core.play(),this._playing=!0}},{key:"pause",value:function(){var e;null!==(e=this.core)&&void 0!==e&&e.pause(),this._playing=!1}},{key:"stop",value:function(){var e;this.pause(),this.seek(0),null!==(e=this.core)&&void 0!==e&&e.reset(),this._playing=!1}},{key:"seek",value:function(e){var t,n,r,i=e*(null!==(t=null===(n=this.core)||void 0===n?void 0:n.duration)&&void 0!==t?t:1);null===(r=this.core)||void 0===r||r.seek(i)}},{key:"alternateDirection",value:function(){var e;this._changeBegan=!1,this._changeCompleted=!0,this.targets.t=0,this.object.reversibleToState===this.from.id?(this.reverse=!1,e=this.to):(this.reverse=!0,e=this.from),this.callback=vP(this.object,{},e.data,this.sharedAssets,this.allowSlerp),this.core=YI(Object(p.a)({},this.params))}},{key:"changeDirectionToNormal",value:function(){this._changeBegan=!1,this._changeCompleted=!0,this.targets.t=0,this.reverse=!1,this.callback=vP(this.object,{},this.to.data,this.sharedAssets,this.allowSlerp),this.core=YI(Object(p.a)({},this.params))}},{key:"changeDirectionToReverse",value:function(){this._changeBegan=!1,this._changeCompleted=!0,this.targets.t=0,this.reverse=!0,this.callback=vP(this.object,{},this.from.data,this.sharedAssets,this.allowSlerp),this.core=YI(Object(p.a)(Object(p.a)({},this.params),{},{loop:0}))}},{key:"dispose",value:function(){this.pause()}}]),e}(),bP=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;if(Object(E.a)(this,n),(a=t.call(this)).data=e,a.scene=r,a.sharedAssets=i,!e.object)throw new Error("Missing property");var o=r.find(e.object);if(!o)throw new Error("Missing property");if(!o.states)throw new Error("Missing property");if(a.object=o,e.tweens.length<1)throw new Error("Missing property");return a.startOnceDelay="start-once"===e.tweens[1].data.delayDirection?e.tweens[1].data.delay:0,a}return Object(A.a)(n,[{key:"playing",get:function(){var e,t;return null!==(e=null===(t=this.tween)||void 0===t?void 0:t.playing)&&void 0!==e&&e}},{key:"init",value:function(){try{var e,t,n=this.data.tweens[0],r=this.data.tweens[1];null!==(e=this.tween)&&void 0!==e&&e.pause(),this.tween=new yP(this.object,n.data.state,r.data.state,r.data,this.sharedAssets,null!==(t=this.data.allowSlerp)&&void 0!==t&&t)}catch(n){n instanceof Error&&console.error(n.message)}}},{key:"play",value:function(){var e=this;if(this.playing)return!1;clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout((function(){try{var t;e.init(),null===(t=e.tween)||void 0===t||t.play()}catch(uw){uw instanceof Error&&console.error(uw.message)}}),this.startOnceDelay)}},{key:"pause",value:function(){var e;null!==(e=this.tween)&&void 0!==e&&e.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}},{key:"stop",value:function(){var e;null!==(e=this.tween)&&void 0!==e&&e.stop(),clearTimeout(this.timeoutId),delete this.timeoutId}},{key:"seek",value:function(e){var t;null===(t=this.tween)||void 0===t||t.seek(e)}},{key:"toggle",value:function(){var e=this;!this.tween||(clearTimeout(this.timeoutId),this.tween.changeCompleted?this.timeoutId=window.setTimeout((function(){e.tween&&(e.tween.pause(),e.tween.alternateDirection(),e.tween.play())}),this.startOnceDelay):(this.tween.pause(),this.tween.alternateDirection(),this.tween.play()))}},{key:"playFromCurrent",value:function(){var e=this;!this.tween||(clearTimeout(this.timeoutId),this.tween.changeCompleted?this.timeoutId=window.setTimeout((function(){e.tween&&(e.tween.pause(),e.tween.changeDirectionToNormal(),e.tween.play())}),this.startOnceDelay):(this.tween.pause(),this.tween.changeDirectionToNormal(),this.tween.play()))}},{key:"reverseFromCurrent",value:function(){var e=this;!this.tween||(clearTimeout(this.timeoutId),this.tween.changeCompleted?this.timeoutId=window.setTimeout((function(){e.tween&&(e.tween.pause(),e.tween.changeDirectionToReverse(),e.tween.play())}),this.startOnceDelay):(this.tween.pause(),this.tween.changeDirectionToReverse(),this.tween.play()))}},{key:"dispose",value:function(){var e;null===(e=this.tween)||void 0===e||e.dispose()}}]),n}(vn);function wP(e,t,n,r,i,a){var o={Audio:[],Video:[],Link:[],Reset:[],Transition:[]};return t.forEach((function(t){var s=t.id,u=t.data;try{"Audio"===u.type?Rw[e.type].includes("Audio")&&o.Audio.push(new RD(s,u,n,i)):"Video"===u.type?Rw[e.type].includes("Video")&&o.Video.push(new UD(s,u,n)):"Link"===u.type?Rw[e.type].includes("Link")&&o.Link.push(new GD(u,a)):"Reset"===u.type?Rw[e.type].includes("Reset")&&o.Reset.push(new HD(r.data,r,i,a)):"Transition"===u.type&&Rw[e.type].includes("Transition")&&o.Transition.push(new bP(u,r,i))}catch(c){}})),o}function xP(e){Object.values(e).forEach((function(e){e.forEach((function(e){(e instanceof RD||e instanceof UD||e instanceof bP)&&e.dispose()}))}))}var OP,kP=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],_P=function(e){var t;return null===(t=kP.find((function(t){var n=Object(g.a)(t,2);n[0];return n[1]===e})))||void 0===t?void 0:t[0]},SP=function(e){var t;return null===(t=kP.find((function(t){return Object(g.a)(t,1)[0]===e})))||void 0===t?void 0:t[1]},EP=function(e,t){var n=_P(e);if(n){var r=new CustomEvent(n,{bubbles:!0});return Object.defineProperty(r,"target",{writable:!1,value:t}),r}},AP=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,e)).objectsPerEvents=new Map,r.splineEvents={},r.onBeginEvent=function(e){var t;if(e.eventName&&e.target){var n=null===(t=r.splineEvents[_P(e.eventName)])||void 0===t?void 0:t[e.target.uuid];if(n)"Scroll"===e.eventName&&void 0!==e.deltaY&&Object.assign(n,{deltaY:e.deltaY}),r.eventContext.domElement.dispatchEvent(n)}},r.eventContext.scene.traverseEntity((function(e){var t;if(null!==(t=e.data)&&void 0!==t&&t.events.length){var n,i=Object(j.a)(kP);try{var a=function(){var t=Object(g.a)(n.value,2),i=t[0],a=t[1];if(e.data.events.some((function(e){return e.data.type===a&&!e.data.disabled}))){var o;r.objectsPerEvents.has(i)?null===(o=r.objectsPerEvents.get(i))||void 0===o||o.push(e):r.objectsPerEvents.set(i,[e]);var s={id:e.uuid,name:e.name},u=EP(a,s),c=r.splineEvents[i];c?c[e.uuid]=u:r.splineEvents[i]=Object(_.a)({},e.uuid,u)}};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}}})),r}return Object(A.a)(n,[{key:"connect",value:function(){var e=this;this.objectsPerEvents.forEach((function(t){t.forEach((function(t){t.addEventListener("beginEvent",e.onBeginEvent)}))}))}},{key:"disconnect",value:function(){var e=this;this.objectsPerEvents.forEach((function(t){t.forEach((function(t){t.removeEventListener("beginEvent",e.onBeginEvent)}))}))}}]),n}(MD),jP=function(){function e(t,n,r,i,a,o){if(Object(E.a)(this,e),this.id=t,this.data=n,this.object=r,this.entered=!1,this.useToggle=n.toggle,("KeyDown"===n.type||"KeyUp"===n.type||"KeyPress"===n.type)&&!n.key)throw new Error("Missing property");this.actions=wP(n,n.actions,r,i,a,o)}return Object(A.a)(e,[{key:"disconnect",value:function(){xP(this.actions)}},{key:"dispatch",value:function(){this.useToggle?(this.object.currentTransitionEvent!==this.id&&(this.object.currentTransitionEvent=this.id,this.actions.Transition.forEach((function(e){e.init()}))),this.actions.Transition.forEach((function(e){e.toggle()}))):"MousePress"===this.data.type||"KeyPress"===this.data.type?(this.object.currentTransitionEvent!==this.id&&(this.object.currentTransitionEvent=this.id,this.actions.Transition.forEach((function(e){e.init()}))),this.entered||(this.entered=!0,this.actions.Transition.forEach((function(e){return e.playFromCurrent()})))):this.actions.Transition.some((function(e){return e.playing}))||this.actions.Transition.forEach((function(e){e.play()})),this.actions.Link.forEach((function(e){e.dispatch()})),this.actions.Reset.forEach((function(e){e.dispatch()})),this.actions.Audio.forEach((function(e){e.dispatchBasic()})),this.actions.Video.forEach((function(e){e.dispatchBasic()}))}},{key:"dispatchRelease",value:function(){this.entered&&(this.entered=!1,this.actions.Transition.forEach((function(e){return e.reverseFromCurrent()})))}},{key:"dispatchUserEvent",value:function(e){this.object.currentTransitionEvent!==this.id&&(this.object.currentTransitionEvent=this.id,this.actions.Transition.forEach((function(e){e.init()}))),e?this.actions.Transition.forEach((function(e){return e.reverseFromCurrent()})):this.actions.Transition.forEach((function(e){return e.playFromCurrent()})),this.actions.Link.forEach((function(e){e.dispatch()})),this.actions.Reset.forEach((function(e){e.dispatch()})),this.actions.Audio.forEach((function(e){e.dispatchBasic()})),this.actions.Video.forEach((function(e){e.dispatchBasic()}))}}]),e}(),TP=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;Object(E.a)(this,n),(a=t.call(this,e)).objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},a.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},a.heldKeys={},a.heldKeysPress={},a._prevObjects=[],a.onMouseDown=function(e){Cx.length>1||(a.eventContext.updateRaycaster(e),a.handleMouseEvent("MouseDown"))},a.onMouseUp=function(e){Cx.length>1||(a.eventContext.updateRaycaster(e),a.handleMouseEvent("MouseUp"))},a.onMousePressDown=function(e){Cx.length>1||(a.eventContext.updateRaycaster(e),a.handleMousePressEvent())},a.onMousePressRelease=function(e){Cx.length>1||(a.eventContext.updateRaycaster(e),a.handleMousePressEvent(!0))},a.onKeyDown=function(e){a.heldKeys[e.key]||a.handleKeyEvent(e,"KeyDown"),a.heldKeys[e.key]=!0},a.onKeyUp=function(e){a.handleKeyEvent(e,"KeyUp")},a.onKeyPressDown=function(e){a.heldKeysPress[e.key]||a.handleKeyEvent(e,"KeyPress"),a.heldKeysPress[e.key]=!0},a.onKeyPressUp=function(e){a.handleKeyEvent(e,"KeyPress",!0)},a.releaseHeldKey=function(e){delete a.heldKeys[e.key]},a.releaseHeldKeyPress=function(e){delete a.heldKeysPress[e.key]},a._onUserEvent=function(e){var t,n,r,i,o=e.eventName,s=e.target,u=e.reverse;if(o&&s){var c=SP(o);c&&("MouseDown"===c||"MouseUp"===c||"MousePress"===c?(s.dispatchEvent({type:"beginEvent",eventName:c}),null===(t=a.eventsPerObjects[c])||void 0===t||null===(n=t[s.uuid])||void 0===n||n.forEach((function(e){e.dispatchUserEvent(u)}))):("KeyDown"===c||"KeyUp"===c||"KeyPress"===c)&&(s.dispatchEvent({type:"beginEvent",eventName:c}),null===(r=a.eventsPerObjects[c])||void 0===r||null===(i=r[s.uuid])||void 0===i||i.forEach((function(e){e.dispatchUserEvent()}))))}};var o=a.eventContext,s=o.scene,u=o.sharedAssets;return s.traverseEntity((function(e){var t;if(null!==(t=e.data)&&void 0!==t&&t.events.length)for(var n=e.visible?["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"]:["KeyDown","KeyUp","KeyPress"],o=function(){var t,n=l[c],o=a.eventsPerObjects[n];e.data.events.filter((function(e){var t=e.data;return t.type===n&&!0!==t.disabled})).forEach((function(t){var n=t.id,c=t.data;try{var l=new jP(n,c,e,s,u,{controlsManager:r,eventManager:i});l.actions.Video.length&&(a.hasVideoAction=!0),o[e.uuid]?o[e.uuid].push(l):o[e.uuid]=[l]}catch(h){}})),(null===(t=o[e.uuid])||void 0===t?void 0:t.length)&&a.objectsPerTypes[n].push(e)},c=0,l=n;c<l.length;c++)o()})),a}return Object(A.a)(n,[{key:"connect",value:function(){var e,t,n,r,i,a,o=this,s=this.eventContext.domElement;this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),null!==(e=this.objectsPerTypes.MouseDown)&&void 0!==e&&e.length&&(this.domEventsNeeded.add("pointerdown"),s.addEventListener("pointerdown",this.onMouseDown)),null!==(t=this.objectsPerTypes.MouseUp)&&void 0!==t&&t.length&&(this.domEventsNeeded.add("pointerup"),s.addEventListener("pointerup",this.onMouseUp)),null!==(n=this.objectsPerTypes.MousePress)&&void 0!==n&&n.length&&(this.domEventsNeeded.add("pointerdown"),s.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),s.addEventListener("pointerup",this.onMousePressRelease)),null!==(r=this.objectsPerTypes.KeyDown)&&void 0!==r&&r.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),null!==(i=this.objectsPerTypes.KeyUp)&&void 0!==i&&i.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),null!==(a=this.objectsPerTypes.KeyPress)&&void 0!==a&&a.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach((function(e){var t=Object(g.a)(e,2);t[0];t[1].forEach((function(e){e.addEventListener("userEvent",o._onUserEvent)}))}))}},{key:"disconnect",value:function(){var e=this,t=this.eventContext.domElement;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},t.removeEventListener("pointerdown",this.onMouseDown),t.removeEventListener("pointerdown",this.onMousePressDown),t.removeEventListener("pointerup",this.onMouseUp),t.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach((function(e){Object.values(e).forEach((function(e){e.forEach((function(e){e.disconnect()}))}))})),Object.entries(this.objectsPerTypes).forEach((function(t){var n=Object(g.a)(t,2);n[0];n[1].forEach((function(t){t.removeEventListener("userEvent",e._onUserEvent)}))}))}},{key:"handleMouseEvent",value:function(e){var t=this,n=this.eventContext,r=n.stopRaycast,i=n.raycaster,a=n.scene,o=this.objectsPerTypes[e];if(o.length)if(r){_D(kD(i,a,o)).forEach((function(n){t.eventsPerObjects[e][n.uuid]&&t.handleObjectMouseEventDispatch(n,e)}))}else o.forEach((function(n){SD(i,n)&&t.handleObjectMouseEventDispatch(n,e)}))}},{key:"handleMousePressEvent",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n="MousePress",r=this.objectsPerTypes[n],i=[];if(r.length){if(!t){var a=this.eventContext,o=a.stopRaycast,s=a.raycaster,u=a.scene;if(o){var c=kD(s,u,r);i=_D(c)}else r.forEach((function(e){SD(s,e)&&i.push(e)}))}this._prevObjects.length&&this._prevObjects.forEach((function(t){i.includes(t)||e.handleObjectMouseEventDispatchRelease(t,n)})),i.length&&i.forEach((function(t){e.handleObjectMouseEventDispatch(t,n)})),this._prevObjects=i}}},{key:"handleObjectMouseEventDispatch",value:function(e,t){var n,r;e.dispatchEvent({type:"beginEvent",eventName:t}),null===(n=this.eventsPerObjects[t])||void 0===n||null===(r=n[e.uuid])||void 0===r||r.forEach((function(e){e.dispatch()}))}},{key:"handleObjectMouseEventDispatchRelease",value:function(e,t){var n,r;e.dispatchEvent({type:"beginEvent",eventName:t}),null===(n=this.eventsPerObjects[t])||void 0===n||null===(r=n[e.uuid])||void 0===r||r.forEach((function(e){e.dispatchRelease()}))}},{key:"handleKeyEvent",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.objectsPerTypes[t].forEach((function(i){var a=n.eventsPerObjects[t][i.uuid];a.some((function(t){var n=t.data;return"key"in n&&n.key===e.key}))&&i.dispatchEvent({type:"beginEvent",eventName:t}),a.forEach((function(t){"key"in t.data&&t.data.key===e.key&&(r?t.dispatchRelease():t.dispatch())}))}))}}]),n}(MD),MP=new tr,CP=new tr,DP=function(){function e(t,n,r,i){Object(E.a)(this,e),this.actionsIn=wP(t,t.inActions,n,r,i),this.actionsOut=wP(t,t.outActions,n,r,i)}return Object(A.a)(e,[{key:"disconnect",value:function(){xP(this.actionsIn),xP(this.actionsOut)}}]),e}(),IP=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o){var s;Object(E.a)(this,n),(s=t.call(this,r,i,a,o)).id=e,s.data=r,s.object=i,s.stage="out",s.objects=[],s.onUpdateMatrix=function(){var e=MP.setFromMatrixPosition(s.objects[0].matrixWorld),t=CP.setFromMatrixPosition(s.objects[1].matrixWorld),n=e.distanceTo(t)<=s.distance?"in":"out";if(s.stage!==n){("in"===s.stage?s.actionsIn:s.actionsOut).Transition.forEach((function(e){return e.pause()}));var r="in"===n?s.actionsIn:s.actionsOut;r.Audio.forEach((function(e){return e.dispatchConditional()})),r.Video.forEach((function(e){return e.dispatchConditional()})),s.object.currentTransitionEvent=s.id,r.Transition.forEach((function(e){return e.play()})),s.stage=n}};var u=r.condition,c=u.distance,l=u.fromObject,h=u.toObject;s.distance=c;for(var d=0,f=[l,h];d<f.length;d++){var p=f[d];if(!p)throw new Error("Missing property");var v=a.find(p);if(!v)throw new Error("Missing property");s.objects.push(v)}return s}return Object(A.a)(n,[{key:"connect",value:function(){var e=this;this.objects.forEach((function(t){t.addEventListener("updateMatrix",e.onUpdateMatrix)})),this.onUpdateMatrix()}},{key:"disconnect",value:function(){var e=this;Object(b.a)(Object(w.a)(n.prototype),"disconnect",this).call(this),this.stage="out",this.objects.forEach((function(t){t.removeEventListener("updateMatrix",e.onUpdateMatrix)}))}}]),n}(DP),PP=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o){var s,u;Object(E.a)(this,n),(u=t.call(this,r,i,a,o)).id=e,u.data=r,u.object=i,u.onBegin=function(e){e.target;var t=e.state;u.toState!==t&&(u.actionsOut.Audio.forEach((function(e){return e.dispatchConditional()})),u.actionsOut.Video.forEach((function(e){return e.dispatchConditional()})),u.actionsIn.Transition.forEach((function(e){return e.pause()})),u.object.currentTransitionEvent=u.id,u.actionsOut.Transition.forEach((function(e){return e.play()})))},u.onComplete=function(e){e.target;var t=e.state;u.toState===t&&(u.actionsIn.Audio.forEach((function(e){return e.dispatchConditional()})),u.actionsIn.Video.forEach((function(e){return e.dispatchConditional()})),u.actionsOut.Transition.forEach((function(e){return e.pause()})),u.object.currentTransitionEvent=u.id,u.actionsIn.Transition.forEach((function(e){return e.play()})))};var c=r.condition;if(!c.object)throw new Error("Missing property");var l=a.find(c.object);if(!l)throw new Error("Missing property");if(u.toObject=l,c.state&&(null===(s=u.toObject.states)||void 0===s||!s[c.state]))throw new Error("Missing property");return u.toState=c.state,u}return Object(A.a)(n,[{key:"connect",value:function(){(this.actionsOut.Audio.length||this.actionsOut.Video.length||this.actionsOut.Transition.length)&&this.toObject.addEventListener("beginState",this.onBegin),(this.actionsIn.Audio.length||this.actionsIn.Video.length||this.actionsIn.Transition.length)&&this.toObject.addEventListener("completeState",this.onComplete)}},{key:"disconnect",value:function(){Object(b.a)(Object(w.a)(n.prototype),"disconnect",this).call(this),(this.actionsOut.Audio.length||this.actionsOut.Video.length||this.actionsOut.Transition.length)&&this.toObject.removeEventListener("beginState",this.onBegin),(this.actionsIn.Audio.length||this.actionsIn.Video.length||this.actionsIn.Transition.length)&&this.toObject.removeEventListener("completeState",this.onComplete)}}]),n}(DP),RP=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;Object(E.a)(this,n),(r=t.call(this,e)).eventsPerConditions={Comparison:[],Distance:[],State:[]},r.hasVideoAction=!1;var i=r.eventContext,a=i.scene,o=i.sharedAssets;return a.traverseEntity((function(e){var t;if(null!==(t=e.data)&&void 0!==t&&t.events.length){var n,i=Object(j.a)(e.data.events);try{for(i.s();!(n=i.n()).done;){var s=n.value,u=s.id,c=s.data;if(!c.disabled&&"Conditional"===c.type)try{var l=void 0;"Comparison"===c.condition.type||("Distance"===c.condition.type?l=new IP(u,c,e,a,o):"State"===c.condition.type&&(l=new PP(u,c,e,a,o))),l&&(r.eventsPerConditions[c.condition.type].push(l),(l.actionsIn.Video.length||l.actionsOut.Video.length)&&(r.hasVideoAction=!0))}catch(h){}}}catch(d){i.e(d)}finally{i.f()}}})),r}return Object(A.a)(n,[{key:"connect",value:function(){Object(b.a)(Object(w.a)(n.prototype),"connect",this).call(this),Object.values(this.eventsPerConditions).forEach((function(e){return e.forEach((function(e){return e.connect()}))}))}},{key:"disconnect",value:function(){Object(b.a)(Object(w.a)(n.prototype),"disconnect",this).call(this),Object.values(this.eventsPerConditions).forEach((function(e){return e.forEach((function(e){return e.disconnect()}))}))}}]),n}(MD),LP=new tr,NP=new tr,BP=new tr,FP=new tr,UP=new va,zP={type:"requestRender"},VP=function(){var e=new tr,t=new tr;return function(n,r,i){return i>0?(e.subVectors(n,r),e.length()<=i?n:t.copy(r).add(e.normalize().multiplyScalar(i))):r}}(),GP=function(){var e=new Dr;return function(t,n){t.position.copy(n),null!==t.parent&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof rA&&$M(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),HP=Object(A.a)((function e(t,n,r){var i,a;Object(E.a)(this,e),this.data=t,this.object=n,this.tempPosition=new tr,this.started=!1,this.paused=!0,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new tr,this.target=t.target?r.find(t.target):void 0,this.maxDelta=null!==(i=t.maxDelta)&&void 0!==i?i:0,this.dampingFactor=t.dampingFactor?Math.max(t.dampingFactor,1):1,this.plane=null!==(a=t.plane)&&void 0!==a?a:"custom",this.snapDampingFactor=8,this.currentDampingFactor=this.snapDampingFactor,this.object.getWorldPosition(this.worldPosition0)})),WP=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;Object(E.a)(this,n),(r=t.call(this,e)).events=[],r.onTargetChangeCallbacks=[],r.onMouseMove=function(e){if(!(Cx.length>1)){r.eventContext.updateRaycaster(e);var t,n=Object(j.a)(r.events);try{for(n.s();!(t=n.n()).done;){var i=t.value;void 0===i.target&&r.updateSingleEvent(i)}}catch(a){n.e(a)}finally{n.f()}}},r.onMouseEnter=function(e){var t,n=Object(j.a)(r.events);try{for(n.s();!(t=n.n()).done;){var i=t.value;void 0===i.target&&(i.tempPosition.copy(i.object.position),i.snapComplete=!1,i.isReset=!1,i.currentDampingFactor=i.snapDampingFactor)}}catch(a){n.e(a)}finally{n.f()}},r.onMouseLeave=function(e){var t,n=Object(j.a)(r.events);try{for(n.s();!(t=n.n()).done;){var i,a=t.value;void 0===a.target&&(a.tempPosition.copy(a.object.position),a.snapComplete=!1,null!==(i=a.data.resetOnPointerLeave)&&void 0!==i&&i&&(a.isReset=!0,a.currentDampingFactor=a.snapDampingFactor),r.updateSingleEvent(a))}}catch(o){n.e(o)}finally{n.f()}},r.onTargetChange=function(e){return function(){r.updateSingleEvent(e)}};var i=r.eventContext.scene;return i.traverseEntity((function(e){var t,n,a=null===(t=e.data)||void 0===t?void 0:t.events.find((function(e){return"Follow"===e.data.type&&!e.data.disabled}));a&&(!i.data.environment.usePhysics||"dynamic"!==(null===(n=e.dataPatched.physics)||void 0===n?void 0:n.rigidBody))&&r.events.push(new HP(a.data,e,i))})),r}return Object(A.a)(n,[{key:"connect",value:function(){if(this.events.length){var e=this.eventContext.domElement;this.domEventsNeeded.clear(),kx&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),e.addEventListener("pointermove",this.onMouseMove),e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave);var t,n=Object(j.a)(this.events);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(void 0!==r.target){var i=this.onTargetChange(r);this.onTargetChangeCallbacks.push(i),r.target.addEventListener("requestRender",i)}}}catch(a){n.e(a)}finally{n.f()}}}},{key:"disconnect",value:function(){if(this.events.length){var e=this.eventContext.domElement;this.domEventsNeeded.clear(),kx&&e.removeEventListener("pointerdown",this.onMouseMove),e.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);var t,n=0,r=Object(j.a)(this.events);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.started=!1,i.paused=!0,void 0!==i.target&&i.target.removeEventListener("requestRender",this.onTargetChangeCallbacks[n++])}}catch(a){r.e(a)}finally{r.f()}}}},{key:"onAnimationFrameDamping",value:function(){var e,t=Object(j.a)(this.events);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.paused||this.updateSingleEvent(n)}}catch(r){t.e(r)}finally{t.f()}}},{key:"updateSingleEvent",value:function(e){var t,n=e.tempPosition,r=e.object,i=e.maxDelta,a=e.plane;if(r.getWorldPosition(BP),e.isReset)FP.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(FP);else{var o=this.eventContext,s=o.camera,u=o.raycaster;if("custom"===a?(s.getWorldDirection(NP),NP.negate(),LP.copy(NP)):"xy"===a?LP.set(0,0,1):"xz"===a?LP.set(0,1,0):"yz"===a&&LP.set(1,0,0),UP.setFromNormalAndCoplanarPoint(LP,BP),!u.ray.intersectPlane(UP,FP))return}var c=VP(BP,FP,i);if(e.currentDampingFactor>1||!1===e.snapComplete){e.started||(e.started=!0,n.copy(c));var l=LP.subVectors(c,n).divideScalar(e.currentDampingFactor);n.add(l),GP(r,n),e.paused=l.length()<.01,e.snapComplete=l.length()<1,e.snapComplete&&(e.currentDampingFactor=e.dampingFactor)}else GP(r,c),e.paused=!0;null!==(t=e.object)&&void 0!==t&&t.dispatchEvent({type:"beginEvent",eventName:"Follow"}),r.dispatchEvent(zP)}}]),n}(MD),qP=new tr,YP=new tr,XP=new Dr,KP=new er,QP=new er,ZP=new tr,JP=new tr,$P=new tr,eR=new va,tR=1e-5,nR={type:"requestRender"},rR={type:"changeRotation"},iR=function(){var e=new Dr,t=new tr,n=new tr,r=new tr;return function(i,a){return"x"===a?(t.set(0,0,1),n.set(0,1,0),r.set(-1,0,0)):"y"===a?(t.set(1,0,0),n.set(0,0,1),r.set(0,-1,0)):(t.set(1,0,0),n.set(0,1,0),r.set(0,0,1)),t.applyMatrix4(i),n.applyMatrix4(i),r.applyMatrix4(i),e.makeBasis(t,n,r)}}(),aR=function(){var e=new Dr;return function(t,n){null!==t.parent?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),n.premultiply(yD(e).invert()),t.rotation.setFromRotationMatrix(n),t.updateMatrix(),t instanceof rA&&$M(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),oR=Object(A.a)((function e(t,n,r){var i,a,o,s;Object(E.a)(this,e),this.data=t,this.object=n,this.paused=!0,this.snapComplete=!1,this.isReset=!1,this.worldQuaternion0=new er,this.target=t.target?r.find(t.target):void 0,this.dampingFactor=t.dampingFactor?Math.max(t.dampingFactor,1):1,this.distance=null!==(i=t.distance)&&void 0!==i?i:0,this.tilt=null!==(a=t.tilt)&&void 0!==a?a:"up",this.axis=null!==(o=t.axis)&&void 0!==o?o:"z",this.plane=null!==(s=t.plane)&&void 0!==s?s:"custom",this.snapDampingFactor=8,this.currentDampingFactor=this.dampingFactor,this.object.getWorldQuaternion(this.worldQuaternion0)})),sR=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;Object(E.a)(this,n),(r=t.call(this,e)).events=[],r.onTargetChangeCallbacks=[],r.onMouseMove=function(e){if(!(Cx.length>1)){r.eventContext.updateRaycaster(e);var t,n=Object(j.a)(r.events);try{for(n.s();!(t=n.n()).done;){var i=t.value;void 0===i.target&&r.updateSingleEvent(i)}}catch(a){n.e(a)}finally{n.f()}}},r.onMouseEnter=function(e){var t,n=Object(j.a)(r.events);try{for(n.s();!(t=n.n()).done;){var i=t.value;void 0===i.target&&(i.snapComplete=!1,i.isReset=!1,i.currentDampingFactor=i.snapDampingFactor)}}catch(a){n.e(a)}finally{n.f()}},r.onMouseLeave=function(e){var t,n=Object(j.a)(r.events);try{for(n.s();!(t=n.n()).done;){var i,a=t.value;void 0===a.target&&(a.snapComplete=!1,null!==(i=a.data.resetOnPointerLeave)&&void 0!==i&&i&&(a.isReset=!0,a.currentDampingFactor=a.snapDampingFactor),r.updateSingleEvent(a))}}catch(o){n.e(o)}finally{n.f()}},r.onTargetChange=function(e){return function(){r.updateSingleEvent(e)}};var i=r.eventContext.scene;return i.traverseEntity((function(e){var t,n,a=null===(t=e.data)||void 0===t?void 0:t.events.find((function(e){return"LookAt"===e.data.type&&!e.data.disabled}));a&&(!i.data.environment.usePhysics||"dynamic"!==(null===(n=e.dataPatched.physics)||void 0===n?void 0:n.rigidBody))&&r.events.push(new oR(a.data,e,i))})),r}return Object(A.a)(n,[{key:"connect",value:function(){if(this.events.length){var e=this.eventContext.domElement;this.domEventsNeeded.clear(),kx&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),e.addEventListener("pointermove",this.onMouseMove),e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave);var t,n=Object(j.a)(this.events);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(void 0!==r.target){var i=this.onTargetChange(r);this.onTargetChangeCallbacks.push(i),r.target.addEventListener("requestRender",i)}}}catch(a){n.e(a)}finally{n.f()}}}},{key:"disconnect",value:function(){if(this.events.length){var e=this.eventContext.domElement;this.domEventsNeeded.clear(),kx&&e.removeEventListener("pointerdown",this.onMouseMove),e.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);var t,n=0,r=Object(j.a)(this.events);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.paused=!0,void 0!==i.target&&i.target.removeEventListener("requestRender",this.onTargetChangeCallbacks[n++])}}catch(a){r.e(a)}finally{r.f()}}}},{key:"onAnimationFrameDamping",value:function(){var e,t=Object(j.a)(this.events);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.paused||this.updateSingleEvent(n)}}catch(r){t.e(r)}finally{t.f()}}},{key:"updateSingleEvent",value:function(e){var t,n=e.target,r=e.tilt,i=e.axis,a=e.distance,o=e.plane,s=e.object,u=this.eventContext,c=u.camera,l=u.raycaster;if(s.getWorldPosition(ZP),!e.isReset)if(e.target)e.target.getWorldPosition(JP);else if("custom"===o?(c.getWorldDirection(YP),YP.negate(),a>0?eR.set(YP,-a):eR.setFromNormalAndCoplanarPoint(YP,ZP)):("xy"===o?qP.set(0,0,1):"xz"===o?qP.set(0,1,0):"yz"===o&&qP.set(1,0,0),eR.setFromNormalAndCoplanarPoint(qP,ZP)),!l.ray.intersectPlane(eR,JP))return;e.isReset||(n?"up"===r?$P.set(0,1,0):"target"===r&&$P.copy(n.up).applyMatrix4(XP.extractRotation(n.matrixWorld)).normalize():"custom"===o?$P.set(0,1,0):$P.copy(qP)),e.isReset?QP.copy(e.worldQuaternion0):(XP.lookAt(JP,ZP,$P),XP.copy(iR(XP,i)),QP.setFromRotationMatrix(XP)),e.currentDampingFactor>1||!1===e.snapComplete?(s.updateWorldMatrix(!0,!1),KP.setFromRotationMatrix(yD(s.matrixWorld)),KP.slerp(QP,1/e.currentDampingFactor),aR(s,XP.makeRotationFromQuaternion(KP)),e.paused=8*(1-KP.dot(QP))<tR,e.snapComplete=8*(1-KP.dot(QP))<.001,e.snapComplete&&(e.currentDampingFactor=e.dampingFactor)):(aR(s,XP.makeRotationFromQuaternion(QP)),e.paused=!0),null!==(t=e.object)&&void 0!==t&&t.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),s.dispatchEvent(nR),s.dispatchEvent(rR)}}]),n}(MD),uR=function(){function e(t,n,r,i,a){Object(E.a)(this,e),this.id=t,this.data=n,this.object=r,this.entered=!1,this.actions=wP(n,n.actions,r,i,a)}return Object(A.a)(e,[{key:"disconnect",value:function(){xP(this.actions)}},{key:"dispatchEnter",value:function(){this.object.currentTransitionEvent!==this.id&&(this.object.currentTransitionEvent=this.id,this.actions.Transition.forEach((function(e){e.init()}))),this.entered||(this.entered=!0,this.actions.Transition.forEach((function(e){return e.playFromCurrent()})))}},{key:"dispatchLeave",value:function(){this.object.currentTransitionEvent!==this.id&&(this.object.currentTransitionEvent=this.id,this.actions.Transition.forEach((function(e){e.init()}))),this.entered&&(this.entered=!1,this.actions.Transition.forEach((function(e){return e.reverseFromCurrent()})))}},{key:"dispatchUserEvent",value:function(e){this.object.currentTransitionEvent!==this.id&&(this.object.currentTransitionEvent=this.id,this.actions.Transition.forEach((function(e){e.init()}))),e?this.actions.Transition.forEach((function(e){return e.reverseFromCurrent()})):this.actions.Transition.forEach((function(e){return e.playFromCurrent()}))}}]),e}(),cR=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;Object(E.a)(this,n),(r=t.call(this,e)).eventsPerObjects={},r.objects=[],r._prevObjects=[],r.onMouseDown=function(e){Cx.length>1||(r.eventContext.updateRaycaster(e),r.handleMouseHoverEvent())},r.onMouseUp=function(e){Cx.length>1||r.handleMouseHoverEvent(!0)},r.onMouseMove=function(e){Cx.length>1||(r.eventContext.updateRaycaster(e),r.handleMouseHoverEvent())},r.onUserEvent=function(e){var t,n=e.eventName,i=e.target,a=e.reverse;if(n&&i){var o=SP(n);o&&"MouseHover"===o&&(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),null===(t=r.eventsPerObjects[i.uuid])||void 0===t||t.forEach((function(e){return e.dispatchUserEvent(a)})))}};var i=r.eventContext,a=i.scene,o=i.sharedAssets;return a.traverseEntity((function(e){var t;if(e.visible&&null!==(t=e.data)&&void 0!==t&&t.events.length){var n,i,s=Object(j.a)(e.data.events);try{for(s.s();!(i=s.n()).done;){var u=i.value,c=u.id,l=u.data;if(!l.disabled&&"MouseHover"===l.type)try{var h=new uR(c,l,e,a,o);r.eventsPerObjects[e.uuid]?r.eventsPerObjects[e.uuid].push(h):r.eventsPerObjects[e.uuid]=[h]}catch(d){}}}catch(f){s.e(f)}finally{s.f()}(null===(n=r.eventsPerObjects[e.uuid])||void 0===n?void 0:n.length)&&r.objects.push(e)}})),r}return Object(A.a)(n,[{key:"connect",value:function(){var e=this;if(this.objects.length){var t=this.eventContext.domElement;this.domEventsNeeded.clear(),kx&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),t.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),t.addEventListener("pointermove",this.onMouseMove),this.objects.forEach((function(t){t.addEventListener("userEvent",e.onUserEvent)}))}}},{key:"disconnect",value:function(){var e=this;if(this.objects.length){var t=this.eventContext.domElement;this.domEventsNeeded.clear(),kx&&(t.removeEventListener("pointerdown",this.onMouseDown),t.removeEventListener("pointerup",this.onMouseUp)),t.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach((function(e){e.forEach((function(e){e.disconnect()}))})),this.objects.forEach((function(t){t.removeEventListener("userEvent",e.onUserEvent)}))}}},{key:"handleMouseHoverEvent",value:function(){var e=this,t=[];if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){var n=this.eventContext,r=n.stopRaycast,i=n.raycaster,a=n.scene;if(r){var o=kD(i,a,this.objects);t=_D(o)}else this.objects.forEach((function(e){SD(i,e)&&t.push(e)}))}this._prevObjects.length&&this._prevObjects.forEach((function(n){var r;t.includes(n)||(n.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),null===(r=e.eventsPerObjects[n.uuid])||void 0===r||r.forEach((function(e){return e.dispatchLeave()})))})),t.length&&t.forEach((function(t){var n;t.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),null===(n=e.eventsPerObjects[t.uuid])||void 0===n||n.forEach((function(e){return e.dispatchEnter()}))})),this._prevObjects=t}}]),n}(MD),lR=function(){function e(t,n,r,i,a){Object(E.a)(this,e),this.id=t,this.data=n,this.object=r,this.scrollCounter=0,this.actions=wP(n,n.actions,r,i,a)}return Object(A.a)(e,[{key:"connect",value:function(){this.scrollCounter=0}},{key:"disconnect",value:function(){xP(this.actions)}},{key:"dispatch",value:function(e){this.object.currentTransitionEvent!==this.id&&(this.object.currentTransitionEvent=this.id,this.actions.Transition.forEach((function(e){e.init()})));var t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);var n=this.scrollCounter/this.data.steps;this.actions.Transition.forEach((function(e){return e.seek(n)}))}},{key:"dispatchUserEvent",value:function(e){this.object.currentTransitionEvent!==this.id&&(this.object.currentTransitionEvent=this.id,this.actions.Transition.forEach((function(e){e.init()}))),e?this.actions.Transition.forEach((function(e){return e.reverseFromCurrent()})):this.actions.Transition.forEach((function(e){e.playFromCurrent()}))}}]),e}(),hR=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;Object(E.a)(this,n),(r=t.call(this,e)).eventsPerObject=new Map,r.onWheel=function(e){Object(v.a)(r.eventsPerObject.entries()).forEach((function(t){var n=Object(g.a)(t,2),r=n[0],i=n[1];r.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:e.deltaY}),i.forEach((function(t){return t.dispatch(e.deltaY)}))}))},r.onUserEvent=function(e){var t,n=e.eventName,i=e.target,a=e.reverse;if(n&&i){var o=SP(n);o&&"Scroll"===o&&(i.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),null===(t=r.eventsPerObject.get(i))||void 0===t||t.forEach((function(e){e.dispatchUserEvent(a)})))}};var i=r.eventContext,a=i.scene,o=i.sharedAssets;return a.traverseEntity((function(e){var t;if(null!==(t=e.data)&&void 0!==t&&t.events.length){var n,i=Object(j.a)(e.data.events);try{for(i.s();!(n=i.n()).done;){var s,u=n.value,c=u.id,l=u.data;if(!l.disabled&&"Scroll"===l.type){var h=new lR(c,l,e,a,o);r.eventsPerObject.has(e)?null===(s=r.eventsPerObject.get(e))||void 0===s||s.push(h):r.eventsPerObject.set(e,[h])}}}catch(d){i.e(d)}finally{i.f()}}})),r}return Object(A.a)(n,[{key:"connect",value:function(){var e=this;Object(v.a)(this.eventsPerObject.entries()).forEach((function(t){var n=Object(g.a)(t,2),r=n[0];n[1].forEach((function(e){return e.connect()})),r.addEventListener("userEvent",e.onUserEvent)})),Object(v.a)(this.eventsPerObject.values()).some((function(e){return e.length}))&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel))}},{key:"disconnect",value:function(){var e=this;window.removeEventListener("wheel",this.onWheel),this.domEventsNeeded.clear(),Object(v.a)(this.eventsPerObject.entries()).forEach((function(t){var n=Object(g.a)(t,2),r=n[0];n[1].forEach((function(e){return e.disconnect()})),r.removeEventListener("userEvent",e.onUserEvent)}))}}]),n}(MD),dR=function(){function e(t,n,r,i,a){Object(E.a)(this,e),this.id=t,this.data=n,this.object=r,this.actions=wP(n,n.actions,r,i,a)}return Object(A.a)(e,[{key:"disconnect",value:function(){xP(this.actions)}},{key:"dispatch",value:function(){this.actions.Transition.forEach((function(e){e.play()}))}},{key:"dispatchAfter",value:function(e){this.actions.Audio.forEach((function(t){var n;(null!==(n=t.interaction.data.triggerAfter)&&void 0!==n?n:"any")===e&&(t.interaction instanceof ID?t.interaction.audioPlayer.play():t.interaction instanceof PD&&t.interaction.dispatch())})),this.actions.Video.forEach((function(t){var n,r=null!==(n=t.interaction.data.triggerAfter)&&void 0!==n?n:"autoplay";r===e&&(t.interaction instanceof BD?t.interaction.play("autoplay"===r):t.interaction instanceof FD&&t.interaction.dispatch())}))}},{key:"dispatchUserEvent",value:function(e){this.object.currentTransitionEvent!==this.id&&(this.object.currentTransitionEvent=this.id,this.actions.Transition.forEach((function(e){e.init()}))),e?this.actions.Transition.forEach((function(e){return e.reverseFromCurrent()})):this.actions.Transition.forEach((function(e){return e.playFromCurrent()})),this.actions.Audio.forEach((function(e){e.interaction instanceof ID?e.interaction.audioPlayer.play():e.interaction instanceof PD&&e.interaction.dispatch()})),this.actions.Video.forEach((function(e){e.interaction instanceof BD?e.interaction.play():e.interaction instanceof FD&&e.interaction.dispatch()}))}}]),e}(),fR=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;Object(E.a)(this,n),(r=t.call(this,e)).eventsPerObject=new Map,r.eventsAfterPerObject=new Map,r.onMouseDown=function(){Object(v.a)(r.eventsAfterPerObject.entries()).forEach((function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];n.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach((function(e){e.dispatchAfter("mouseDown")}))}))},r.onKeyDown=function(){Object(v.a)(r.eventsAfterPerObject.entries()).forEach((function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];n.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach((function(e){e.dispatchAfter("keyDown")}))}))},r.onAny=function(){var e=r.eventContext,t=e.domElement;(e.isExport?document:t).removeEventListener("pointerdown",r.onAny),document.removeEventListener("keydown",r.onAny),Object(v.a)(r.eventsAfterPerObject.entries()).forEach((function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];n.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach((function(e){e.dispatchAfter("any")}))}))},r.onPlay=function(){Object(v.a)(r.eventsAfterPerObject.entries()).forEach((function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];n.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach((function(e){e.dispatchAfter("autoplay")}))}))},r.onUserEvent=function(e){var t,n,i=e.eventName,a=e.target,o=e.reverse;if(i&&a){var s=SP(i);s&&"Start"===s&&(a.dispatchEvent({type:"beginEvent",eventName:"Start"}),null!==(t=r.eventsPerObject.get(a))&&void 0!==t&&t.forEach((function(e){e.dispatchUserEvent(o)})),null===(n=r.eventsAfterPerObject.get(a))||void 0===n||n.forEach((function(e){e.dispatchUserEvent(o)})))}};var i=r.eventContext,a=i.scene,o=i.sharedAssets;return a.traverseEntity((function(e){var t;if(null!==(t=e.data)&&void 0!==t&&t.events.length){var n,i=Object(j.a)(e.data.events);try{for(i.s();!(n=i.n()).done;){var s,u,c,l=n.value,h=l.id,d=l.data;if(!d.disabled&&"Start"===d.type){var f=new dR(h,d,e,a,o);f.actions.Transition.length&&(r.eventsPerObject.has(e)?null===(s=r.eventsPerObject.get(e))||void 0===s||s.push(f):r.eventsPerObject.set(e,[f])),f.actions.Audio.length&&(r.eventsAfterPerObject.has(e)?null===(u=r.eventsAfterPerObject.get(e))||void 0===u||u.push(f):r.eventsAfterPerObject.set(e,[f])),f.actions.Video.length&&(r.hasVideoAction=!0,r.eventsAfterPerObject.has(e)?null===(c=r.eventsAfterPerObject.get(e))||void 0===c||c.push(f):r.eventsAfterPerObject.set(e,[f]))}}}catch(p){i.e(p)}finally{i.f()}}})),r}return Object(A.a)(n,[{key:"connect",value:function(){var e=this;if(Object(v.a)(this.eventsAfterPerObject.values()).some((function(e){return e.length}))){var t=this.eventContext,n=t.domElement,r=t.isExport?document:n;r.addEventListener("pointerdown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),r.addEventListener("pointerdown",this.onAny),document.addEventListener("keydown",this.onAny),Object(v.a)(this.eventsAfterPerObject.entries()).forEach((function(t){var n=Object(g.a)(t,2),r=n[0];n[1];r.addEventListener("userEvent",e.onUserEvent)})),this.onPlay()}Object(v.a)(this.eventsPerObject.entries()).forEach((function(t){var n=Object(g.a)(t,2),r=n[0],i=n[1];r.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((function(e){return e.dispatch()})),r.addEventListener("userEvent",e.onUserEvent)}))}},{key:"disconnect",value:function(){var e=this;if(Object(v.a)(this.eventsAfterPerObject.values()).some((function(e){return e.length}))){var t=this.eventContext,n=t.domElement,r=t.isExport?document:n;r.removeEventListener("pointerdown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),r.removeEventListener("pointerdown",this.onAny),document.removeEventListener("keydown",this.onAny),Object(v.a)(this.eventsAfterPerObject.entries()).forEach((function(t){var n=Object(g.a)(t,2),r=n[0],i=n[1];r.removeEventListener("userEvent",e.onUserEvent),i.forEach((function(e){return e.disconnect()}))}))}Object(v.a)(this.eventsPerObject.entries()).forEach((function(t){var n=Object(g.a)(t,2),r=n[0],i=n[1];r.removeEventListener("userEvent",e.onUserEvent),i.forEach((function(e){return e.disconnect()}))}))}}]),n}(MD),pR=function(){function e(t,n,r,i,a){Object(E.a)(this,e),this.id=t,this.data=n,this.object=r,this.disabled=!0,this.actions=wP(n,n.actions,r,i,a),this.target=n.target,this.useToggle=n.toggle}return Object(A.a)(e,[{key:"disconnect",value:function(){xP(this.actions)}},{key:"dispatch",value:function(){this.disabled||(this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.useToggle?(this.object.currentTransitionEvent!==this.id&&(this.object.currentTransitionEvent=this.id,this.actions.Transition.forEach((function(e){e.init()}))),this.actions.Transition.forEach((function(e){e.toggle()}))):this.actions.Transition.forEach((function(e){e.play()})),this.actions.Link.forEach((function(e){e.dispatch()})),this.actions.Audio.forEach((function(e){e.dispatchBasic()})),this.actions.Video.forEach((function(e){e.dispatchBasic()})))}}]),e}();Vg.then((function(e){return OP=e}));new Dr,new tr(1,1,1);var vR=new tr,mR=new er,gR=new tr,yR=new Vr(0,0,0,"YXZ"),bR={type:"updateMatrix"},wR={type:"beginEvent",eventName:"Collision"};function xR(e){if(e.scene.environment.usePhysics)return!0;var t=!1;return e.scene.objects.traverse((function(e,n){var r,i=Object(j.a)(n.events);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(!0!==a.data.disabled&&"GameControl"===a.data.type&&a.data.collisionEnabled){t=!0;break}}}catch(o){i.e(o)}finally{i.f()}})),t}var OR=function(e){return e.states.some((function(e){return void 0!==e.data.position||void 0!==e.data.rotation||void 0!==e.data.hiddenMatrix||void 0!==e.data.cloner}))},kR=function(e){return e.events.find((function(e){return!0!==e.data.disabled&&"Follow"===e.data.type}))},_R=function(){function e(t,n,r,i,a){var o,s,u,c,l,h=this,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];Object(E.a)(this,e),this.scene=n,this.sharedAssets=a,this.isExport=d,this.orbitControlsNeedsUpdate=!0,this.gameControls=[],this.gameControlStates=[],this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],eventsPerObjects:{},colliderToEntity:{},gamePads:[]},this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.processRigidBody=function(e){if(e.bodyType()===OP.RigidBodyType.Dynamic){e.isSleeping()||h.nActiveRigidBodies++;var t=h.rigidBodyToMesh.get(e.handle),n=Object(g.a)(t,3),r=n[0],i=n[1],a=n[2];if(vR.copy(e.translation()).multiplyScalar(h.pixelsPerMeter),mR.copy(e.rotation()),r.matrixWorld.compose(vR,mR,i),r.hasNonUniformScale&&r.matrixWorld.multiply(r.shearScale),r.dispatchEvent(bR),a){var o=r.cloner;if(o&&void 0===o.objectForSample){o.matrixWorld.copy(r.matrixWorld);var s,u=Object(j.a)(o.children);try{for(u.s();!(s=u.n()).done;){s.value.updateMatrixWorld(!0)}}catch(d){u.e(d)}finally{u.f()}}var c,l=Object(j.a)(r.children);try{for(l.s();!(c=l.n()).done;){c.value.updateMatrixWorld(!0)}}catch(d){l.e(d)}finally{l.f()}}}},this.handleCollisionEvents=function(e,t,n){if(!1!==n)if(h.gameControls.some((function(t){return t.object===h.sharedGameControlGlobals.colliderToEntity[e]}))){var r=h.sharedGameControlGlobals.colliderToEntity[t],i=h.sharedGameControlGlobals.eventsPerObjects[r.uuid];if(void 0===i)return;var a,o=Object(j.a)(i);try{for(o.s();!(a=o.n()).done;){var s=a.value;"character"===s.data.target&&h.dispatchCollisionEvent(s,r)}}catch(_){o.e(_)}finally{o.f()}}else if(h.gameControls.some((function(e){return e.object===h.sharedGameControlGlobals.colliderToEntity[t]}))){var u=h.sharedGameControlGlobals.colliderToEntity[e],c=h.sharedGameControlGlobals.eventsPerObjects[u.uuid];if(void 0===c)return;var l,d=Object(j.a)(c);try{for(d.s();!(l=d.n()).done;){var f=l.value;"character"===f.data.target&&h.dispatchCollisionEvent(f,u)}}catch(_){d.e(_)}finally{d.f()}}else{var p=h.sharedGameControlGlobals.colliderToEntity[e],v=h.sharedGameControlGlobals.eventsPerObjects[p.uuid];if(void 0!==v){var m,g=Object(j.a)(v);try{for(g.s();!(m=g.n()).done;){var y=m.value;"scene"===y.data.target&&h.dispatchCollisionEvent(y,p)}}catch(_){g.e(_)}finally{g.f()}}var b=h.sharedGameControlGlobals.colliderToEntity[t],w=h.sharedGameControlGlobals.eventsPerObjects[null===b||void 0===b?void 0:b.uuid];if(void 0!==w){var x,O=Object(j.a)(w);try{for(O.s();!(x=O.n()).done;){var k=x.value;"scene"===k.data.target&&h.dispatchCollisionEvent(k,b)}}catch(_){O.e(_)}finally{O.f()}}}},this.onBeginState=function(){h.orbitControls&&(h.orbitControls.enabled=!1,h.orbitControlsNeedsUpdate=!1)},this.onCompleteState=function(e){var t=e.target;h.orbitControls&&(h.orbitControls.enabled=!0,h.orbitControls.resetTo(t.getTarget(vR),t.position,t.zoom,t.isUpVectorFlipped),t.prevState=null,t.currentState=null,t.reversibleToState=null,t.currentTransitionEvent=null,h.orbitControlsNeedsUpdate=!0)},this.domElement=r.domElement,l=null===t.scene.publish.playCamera?NC.PERSONAL_CAMERA_ID:t.scene.publish.playCamera;var f,v=this.scene.find(l),m=!1,y=5,b=8,w=9,x="drag";if(this.usePhysics=null!==(o=t.scene.environment.usePhysics)&&void 0!==o?o:jx.defaultData.usePhysics,this.pixelsPerMeter=null!==(s=t.scene.environment.pixelsPerMeter)&&void 0!==s?s:jx.defaultData.pixelsPerMeter,null!==(u=t.scene.objects.data(t.scene.publish.gameControlObject))&&void 0!==u&&u.events.forEach((function(e){!0!==e.data.disabled&&"GameControl"===e.data.type&&(f=e.data.keyAssignments,y=e.data.joystickPosLoc,b=e.data.joystickRotLoc,w=e.data.jumpTouchButtonLoc,x=e.data.rotByTouch)})),this.scene.traverseEntity((function(e){e.dataPatched.events.forEach((function(t){if(!t.data.disabled&&"GameControl"===t.data.type){for(var n=e;null!==(null===(r=n=n.parent)||void 0===r?void 0:r.parent);){var r,i;if(null!==(i=n.dataPatched.physics)&&void 0!==i&&i.fusedBody)return}t.data.collisionEnabled&&(h.needsCollisionDetection=!0),h.gameControlStates.push([e,t.data])}}))})),this.usePhysics&&this.initPhysics(null!==(c=t.scene.environment.gravity)&&void 0!==c?c:jx.defaultData.gravity),this.gameControlStates.forEach((function(e){var n=Object(g.a)(e,2),o=n[0],s=n[1];m=m||s.camera===v.uuid||o.uuid===v.uuid;var u=new eL(o,r.domElement,Object(p.a)(Object(p.a)({},s),{},{keyAssignments:f}),t.scene.environment,h.sharedGameControlGlobals,o.uuid!==v.uuid&&s.camera===v.uuid,v,h.scene,a);u.addEventListener("change",i),u.addEventListener("end",i),u.addEventListener("start",i),h.gameControls.push(u),kx&&s.touchControl&&(void 0!==h.joystickToGameControls[y]?h.joystickToGameControls[y].push([u,"pos"]):h.joystickToGameControls[y]=[[u,"pos"]],"walk"===s.moveMode&&(void 0!==h.joystickToGameControls[w]?h.joystickToGameControls[w].push([u,"jmp"]):h.joystickToGameControls[w]=[[u,"jmp"]]),"joystick"===x&&(void 0!==h.joystickToGameControls[b]?h.joystickToGameControls[b].push([u,"rot"]):h.joystickToGameControls[b]=[[u,"rot"]]))})),!1===m){var O=t.scene.publish.orbitControls,k=O.enableRotate,_=O.enablePan,S=O.enableZoom,A=O.autoRotate,T=O.hoverRotatePanMode;if(k||_||S||A||0!==T){this.orbitControls=new bL(v,r.domElement,this.isExport),this.orbitControls.addEventListener("change",i),this.orbitControls.addEventListener("end",i),this.orbitControls.addEventListener("start",i),this.orbitControls.fromJSON(t.scene.publish.orbitControls),this.orbitControls.useKeyEvents=!1,this.orbitControls.connect(),this.orbitControls.update();var M=this.orbitControls.object;M.addEventListener("beginState",this.onBeginState),M.addEventListener("completeState",this.onCompleteState)}}var C=r.domElement.width/r.getPixelRatio(),D=r.domElement.height/r.getPixelRatio();this.joystickToGameControls.forEach((function(e,n){var r,a=document.body.appendChild(document.createElement("div")),o=Object(g.a)((null!==(r=t.scene.publish.joystickSizeAndXYOffset)&&void 0!==r?r:mx.defaultData.joystickSizeAndXYOffset)[n],3),s=o[0],u=o[1],c=o[2],l=(C-5*s)/4+s,d={},f=e.some((function(e){return"jmp"===e[1]})),p=f?0:s;for(var v in n<10?(n<5?d.top=p/2:d.bottom=p/2,d.left=p/2+n%5*l):10===n?(d.left=p/2,d.top=D/2):(d.right=p/2,d.top=D/2),d.top?d.top-=u[1]:d.bottom+=u[1],d.left?d.left+=u[0]:d.right-=u[0],d)d[v]+="px";if(f){var m=a.appendChild(document.createElement("div"));Object.assign(m.style,d,{position:"absolute",width:s+"px",height:s+"px",backgroundColor:"rgba(255,255,255,".concat("show"===c?.4:0,")"),zIndex:"9999",borderRadius:s+"px",border:"show"===c?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});var y=s/16*16*.4;return"show"===c&&(m.innerHTML='\n\t\t\t\t\t\t<svg width="'.concat(y,'" height="').concat(.4*s,'" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t')),m.addEventListener("pointerdown",(function(){e.forEach((function(e){e[0].movementState.jump=1})),i()})),m.addEventListener("touchend",(function(e){return e.preventDefault()})),void(h.joysticks[n]=[void 0,a])}var b={zone:a,mode:"static",position:d,size:s};"hide"===c&&(b.restOpacity=0);var w=dD.create(b);w.on("move",(function(t,n){e.forEach((function(e){var t=e[0];"pos"===e[1]?n.force<.2?t.moveForce=0:(t.movementState.movePosZ=Math.sin(-n.angle.radian),t.movementState.movePosX=Math.cos(-n.angle.radian),n.force<.3?t.moveForce=(n.force-.2)/.1:t.moveForce=1):n.force<.2?t.rotForce=0:(t.movementState.rotPosX=n.vector.y,t.movementState.rotPosY=-n.vector.x,n.force<.3?t.rotForce=(n.force-.2)/.1:t.rotForce=1)})),i()})),w.on("end",(function(t,n){e.forEach((function(e){var t=e[0];"pos"===e[1]?(t.movementState.movePosZ=0,t.movementState.movePosX=0,t.moveForce=1):(t.movementState.rotPosX=0,t.movementState.rotPosY=0,t.rotForce=1)}))})),h.joysticks[n]=[w,a]})),!1===this.usePhysics&&this.needsCollisionDetection&&this.initBVH(),this.initializationCounter++,window.setTimeout((function(){return h.collisionEvents.forEach((function(e){return e.disabled=!1}))}),80)}return Object(A.a)(e,[{key:"attachVRControllers",value:function(e){var t=this;e.forEach((function(e){e.addEventListener("connected",(function(e){"gamepad"in e.data&&"axes"in e.data.gamepad&&t.sharedGameControlGlobals.gamePads.push(e.data.gamepad)}))}))}},{key:"initBVH",value:function(){var e=this,t=[];if(this.scene.traverseObject((function(n){var r;if(!(n instanceof MM)){var i=(r=n instanceof Vk?n.object:n).dataPatched;if(!i.visible)return!0;var a=n.geometry;if(OR(i)||kR(i)||r.dataPatched.events.some((function(e){return!0!==e.data.disabled&&"GameControl"===e.data.type}))){n.updateMatrixWorldSVD();var o=[];if(void 0!==(null===a||void 0===a?void 0:a.getAttribute("position"))&&o.push(pD(a,n.shearScale)),n.traverseObject(e.gatherChildrenGeom(n,o)),n.children.forEach((function(e){return e.updateMatrixWorld(!0)})),o.length>0){var s=eO(o,!1);n.boundsTree=new mk(s),e.sharedGameControlGlobals.entitiesWithTransformAnim.push(n)}return!0}a&&t.push(pD(a,n.matrixWorld))}})),t.length>0){var n=eO(t,!1);this.sharedGameControlGlobals.staticMeshBVH=new mk(n)}}},{key:"addCollider",value:function(e,t,n,r,i){var a,o,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(0!==(null===r||void 0===r?void 0:r.getAttribute("position").count)&&0!==(null===r||void 0===r||null===(a=r.getIndex())||void 0===a?void 0:a.count)){var u;void 0!==i?u="sphere"===i.collider.type?OP.ColliderDesc.ball(i.collider.radius/this.pixelsPerMeter):"capsule"===i.collider.type?OP.ColliderDesc.capsule((i.collider.height/2-i.collider.radius)/this.pixelsPerMeter,i.collider.radius/this.pixelsPerMeter):OP.ColliderDesc.cuboid(i.collider.width/this.pixelsPerMeter/2,i.collider.height/this.pixelsPerMeter/2,i.collider.depth/this.pixelsPerMeter/2):r&&(u="trimesh"===n.colliderType?OP.ColliderDesc.trimesh(r.getAttribute("position").array,r.getIndex().array):OP.ColliderDesc.convexMesh(r.getAttribute("position").array,s?r.getIndex().array:void 0)),u.setFrictionCombineRule(OP.CoefficientCombineRule.Average).setRestitutionCombineRule(OP.CoefficientCombineRule.Average).setDensity(n.density).setFriction(n.friction).setRestitution(n.restitution);var c=this.sharedGameControlGlobals.rapierWorld.createCollider(u,t);if(this.sharedGameControlGlobals.colliderToEntity[c.handle]=e,void 0!==i){vR.fromArray(i.collider.position).multiply(gR.setFromMatrixScale(e.matrixWorld)).divideScalar(this.pixelsPerMeter),c.setTranslationWrtParent(vR);var l=(new er).setFromEuler((new Vr).setFromVector3((new tr).fromArray(i.collider.rotation)));c.setRotationWrtParent(l),c.setActiveEvents(OP.ActiveEvents.COLLISION_EVENTS)}else(null===(o=this.sharedGameControlGlobals.eventsPerObjects[e.uuid])||void 0===o?void 0:o.some((function(e){return"scene"===e.target})))&&c.setActiveEvents(OP.ActiveEvents.COLLISION_EVENTS)}}},{key:"gatherChildrenGeom",value:function(e,t){return function(n,r){if(0!==r){1===r?e.hasNonUniformScale?n.matrixWorld.multiplyMatrices(e.shearScale,n.hiddenMatrix):n.matrixWorld.copy(e.hiddenMatrix):n.matrixWorld.multiplyMatrices(n.parent.matrixWorld,n.hiddenMatrix),n.matrixWorld.multiply(n.matrix);var i=n.geometry;void 0!==(null===i||void 0===i?void 0:i.getAttribute("position"))&&t.push(pD(i,n.matrixWorld))}}}},{key:"initPhysics",value:function(e){var t=this;this.sharedGameControlGlobals.rapierWorld=new OP.World(new OP.Vector3(0,null!==e&&void 0!==e?e:-10,0)),this.events=new OP.EventQueue(!0);var n=[];if(this.scene.traverseObject((function(e){var r,i;if(e instanceof MM){if(!e.objectForSample)return!0===e.object.dataPatched.physics.fusedBody&&"dynamic"===e.object.dataPatched.physics.rigidBody||void 0;if(e.objectForSample.dataPatched.physics.fusedBody)return;i=e.object}else i=e instanceof Vk?e.object:e;var a=i.dataPatched;if(!a.physics||!a.visible)return!0;e.updateMatrixWorldSVD();var o,s,u=OR(a),c=kR(a),l=!1,h=Object(j.a)(a.events);try{for(h.s();!(s=h.n()).done;){var d=s.value;if(!0!==d.data.disabled)if("GameControl"===d.data.type)o=d.data;else if("Collision"===d.data.type){l=!0;var f=new pR(d.id,d.data,i,t.scene,t.sharedAssets);t.collisionEvents.push(f),t.sharedGameControlGlobals.eventsPerObjects[i.uuid]?t.sharedGameControlGlobals.eventsPerObjects[i.uuid].push(f):t.sharedGameControlGlobals.eventsPerObjects[i.uuid]=[f]}}}catch(A){h.e(A)}finally{h.f()}"dynamic"===a.physics.rigidBody&&!1===a.physics.fusedBody&&(e.matrixWorldFusedFalse=e.matrixWorld.clone());var p=e.geometry;if("dynamic"===a.physics.rigidBody||u||c||l||void 0!==o){var m=[];if(void 0!==(null===p||void 0===p?void 0:p.getAttribute("position"))&&m.push(pD(p,e.shearScale)),a.physics.fusedBody){var g=t.gatherChildrenGeom(e,m);e.traverseObject(g),e.children.forEach((function(e){return e.updateMatrixWorld(!0)}));var y=e.cloner;y&&void 0===y.objectForSample&&"dynamic"===a.physics.rigidBody&&(y.traverseObject(g),y.children.forEach((function(e){return e.updateMatrixWorld(!0)})))}if(m.length>0||void 0!==o){var b,w,x,O,k,_;void 0!==o?k=OP.RigidBodyDesc.kinematicPositionBased():"dynamic"===a.physics.rigidBody?(b=(w=(k=OP.RigidBodyDesc.dynamic()).setLinearDamping(a.physics.damping).setAdditionalMass(1e-9).setGravityScale(a.physics.gravityScale)).enabledRotations.apply(w,Object(v.a)(a.physics.enabledRotation))).enabledTranslations.apply(b,Object(v.a)(a.physics.enabledTranslation)):u||c?(k=OP.RigidBodyDesc.kinematicPositionBased(),t.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):k=OP.RigidBodyDesc.fixed(),_=m.length>0?eO(m):void 0,(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(vR,mR,gR),e.position0=vR.clone().divideScalar(t.pixelsPerMeter),e.rotation0=mR.clone(),vR.divideScalar(t.pixelsPerMeter),k.setTranslation(vR.x,vR.y,vR.z).setRotation(mR),p?null===(x=_)||void 0===x||x.scale(1/t.pixelsPerMeter,1/t.pixelsPerMeter,1/t.pixelsPerMeter):null===(O=_)||void 0===O||O.scale(gR.x/t.pixelsPerMeter,gR.y/t.pixelsPerMeter,gR.z/t.pixelsPerMeter);var S=t.sharedGameControlGlobals.rapierWorld.createRigidBody(k);void 0===o&&"dynamic"===a.physics.rigidBody&&t.rigidBodyToMesh.set(S.handle,[e,gR.clone(),a.physics.fusedBody]),e.rigidBody=S;var E=!(void 0===a.geometry||"SubdivGeometry"===a.geometry.type||"NonParametricGeometry"===a.geometry.type||"BooleanGeometry"===a.geometry.type||"VectorGeometry"===a.geometry.type||"StarGeometry"===a.geometry.type||"RectangleGeometry"===a.geometry.type||"EllipseGeometry"===a.geometry.type||"TriangleGeometry"===a.geometry.type||"TorusGeometry"===a.geometry.type||"HelixGeometry"===a.geometry.type);try{t.addCollider(i,S,a.physics,_,o,E)}catch(T){try{t.addCollider(i,S,a.physics,_,o,!1)}catch(M){console.error(M)}}}}else p&&n.push(pD(p,e.matrixWorld)),a.physics.fusedBody&&e.traverse((function(t){!t.geometry||t===e||n.push(pD(t.geometry,t.matrixWorld))}));return!(!0!==(null===(r=a.physics)||void 0===r?void 0:r.fusedBody)&&!o)||void 0})),0!==n.length){var r=eO(n);r.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);var i=OP.RigidBodyDesc.fixed(),a=this.sharedGameControlGlobals.rapierWorld.createRigidBody(i),o=OP.ColliderDesc.trimesh(r.getAttribute("position").array,r.getIndex().array).setFrictionCombineRule(OP.CoefficientCombineRule.Multiply).setRestitutionCombineRule(OP.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(o,a)}}},{key:"updatePositions",value:function(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}},{key:"dispose",value:function(){var e;if(this.scene.traverse((function(e){var t=e;t.matrixWorldFusedFalse&&(t.matrixWorldFusedFalse=void 0),t.rigidBody&&(t.rigidBody=void 0),t.position0&&(t.position0=void 0),t.rotation0&&(t.rotation0=void 0)})),null!==(e=this.sharedGameControlGlobals.rapierWorld)&&void 0!==e&&e.free(),this.sharedGameControlGlobals.staticMeshBVH=void 0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.gameControls.forEach((function(e){e.reset(),e.dispose()})),this.gameControls=[],this.joysticks.forEach((function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];null!==n&&void 0!==n&&n.destroy(),r.remove()})),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls){var t=this.orbitControls.object;t.removeEventListener("beginState",this.onBeginState),t.removeEventListener("completeState",this.onCompleteState),this.orbitControls.dispose(),this.orbitControls=void 0}for(var n=0,r=Object.values(this.sharedGameControlGlobals.eventsPerObjects);n<r.length;n++){r[n].forEach((function(e){return e.disconnect()}))}this.sharedGameControlGlobals.eventsPerObjects={},this.scene.updateMatrixWorld(!0)}},{key:"update",value:function(e,t,n){var r=!0;if(void 0!==this.orbitControls&&this.orbitControlsNeedsUpdate&&(r=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2)this.initializationCounter++,r=!1;else if(2===this.initializationCounter){var i,a=Object(j.a)(this.gameControls);try{for(a.s();!(i=a.n()).done;){r=!i.value.update(e,t,n)&&r}}catch(h){a.e(h)}finally{a.f()}}if(this.usePhysics){var o,s,u=Object(j.a)(this.sharedGameControlGlobals.entitiesWithTransformAnim);try{for(u.s();!(s=u.n()).done;){var c=s.value;(c.hasNonUniformScale?c.matrixWorldRigid:c.matrixWorld).decompose(vR,mR,gR),yR.setFromQuaternion(mR);var l=c;void 0===l.prevR?(l.prevR=yR.clone(),l.prevT=vR.clone()):(l.prevR.copy(yR),l.prevT.copy(vR)),c.rigidBody.setNextKinematicTranslation(vR.divideScalar(this.pixelsPerMeter)),c.rigidBody.setNextKinematicRotation(mR)}}catch(h){u.e(h)}finally{u.f()}this.sharedGameControlGlobals.rapierWorld.step(this.events),null!==(o=this.events)&&void 0!==o&&o.drainCollisionEvents(this.handleCollisionEvents),r=!this.updatePositions()&&r}return r}},{key:"dispatchCollisionEvent",value:function(e,t){t.dispatchEvent(wR),e.dispatch()}}]),e}(),SR={type:"change"},ER={type:"lock"},AR={type:"unlock"},jR=(new tr,new tr),TR=new tr,MR=new tr,CR=new tr,DR=new tr,IR=new tr,PR=new Dr,RR=new Dr,LR=new Dr,NR=(new Dr,new er),BR=new er,FR=new Vr(0,0,0,"YXZ"),UR=new tr(1,0,0),zR=new tr(0,1,0),VR=new tr(0,0,1),GR=new tr(1,1,1),HR=1,WR=.025,qR=16e-6,YR=12,XR=20,KR=new Ml,QR=new ir,ZR={type:"requestRender"},JR=Math.PI/6,$R=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a,o,s,u,c,l){var h,d,f,p,m,y,b,w,x,O,k,_,S,A,T,M,C,D,I,P,R,L;Object(E.a)(this,n),(L=t.call(this)).object=e,L.domElement=r,L.sharedGameControlGlobals=o,L.cameraFollow=s,L.camera=u,L.scene=c,L.sharedAssets=l,L.enableDamping=!0,L.position0=new tr,L.rotation0=new Vr(0,0,0,"XYZ"),L.scale0=new tr,L.hiddenMatrix0=new Dr,L.target0=new tr,L.zoom0=1,L.rotForce=1,L.moveForce=1,L.euler0=new Vr(0,0,0,"YXZ"),L.position0Cam=new tr,L.quat0Cam=new er,L.scale0Cam=new tr,L.hiddenMatrix0Cam=new Dr,L.threshEndTranslate=.01,L.threshEndRotate=1e-8,L.threshEndRotVel=.005,L.collider={type:"capsule",radius:40,segment:new Ml(new tr(0,-40,0),new tr(0,40,0)),matrix:new Dr,position:new tr,rotation:new er},L.euler=new Vr(0,0,0,"YXZ"),L.eulerDelta=new tr,L.lastPosition=new tr,L.lastCameraQuaternion=new er,L.lastCameraPosition=new tr,L.PI_2=Math.PI/2,L.prevMouse=new An,L.velocityTarget=new tr,L.velocity=new tr,L.directionXZ=new tr,L.rotVelocityStick=new tr,L.rotVelocityTarget=new tr,L.rotVelocity=new tr,L.rotDirection=new tr,L.nonColliderRotOffset=new Dr,L.nonColliderPosOffset=new Dr,L.firstPointerId=-1,L.rot=new tr,L.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0},L.vrEulerYOffset=0,L.onObject=!1,L.actionState={},L.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],L.collisionEnabled=!0,L.offsetMatrix=new Dr,L.objectToTarget=new tr,L.objectToTarget0=new tr,L.objectToCamXZ=new tr,L.objectToCamXZ0=new tr,L.targetToCamera=new tr,L.targetToCamera0=new tr,L.cameraPolarAxis0=new tr,L.targetPos=new tr,L.targetQuat=new er,L.lerpFactorPos=(new tr).setScalar(.3),L.lerpFactorPosStart=.3,L.lerpFactorPosEnd=.3,L.lerpFactorRotStart=.3,L.lerpFactorRotEnd=.3,L.lerpFactorPosCamera=.3,L.lerpFactorRotCamera=.3,L.objXZQuat=new er,L.objXZQuatInv=new er,L.objXZRotMat=new Dr,L.isFirstPerson=!1,L.actions={},L.didHit=!1,L.groundVelocity=new tr,L.pushedVelocity=new tr,L.groundYRotation=0,L.objectRealQuat=new er,L.colliderWorldQuat=new er,L.groundNormal=new tr,L.groundTilt=new er,L.groundTiltInv=new er,L.lastHitObj=null,L.isFirstFrame=!0,L.rotationAccumWhenOrientWithCamera=0,L.onPointerDown=function(e){e.target!==L.domElement||-1!==L.firstPointerId||(L.firstPointerId=e.pointerId,L.domElement.ownerDocument.addEventListener("pointermove",L.onPointerMove),L.domElement.ownerDocument.addEventListener("pointerup",L.onPointerUp),"keys"!==L.rotBy&&!kx&&(!_x||Sx>=15.5)&&L.domElement.requestPointerLock(),L.prevMouse.set(e.clientX,e.clientY))},L.onPointerUp=function(e){L.firstPointerId=-1,L.domElement.ownerDocument.removeEventListener("pointermove",L.onPointerMove),L.domElement.ownerDocument.removeEventListener("pointerup",L.onPointerUp),"mouse"===e.pointerType&&L.domElement.ownerDocument.exitPointerLock()},L.onPointerMove=function(e){if(e.pointerId===L.firstPointerId){var t=e.clientX-L.prevMouse.x,n=e.clientY-L.prevMouse.y;L.prevMouse.set(e.clientX,e.clientY),"mouse"===e.pointerType&&"keys"!==L.rotBy&&(_x&&Sx<15.5&&!kx?(L.eulerDelta.y=-t*L.mouseOrbitSensitivity,L.eulerDelta.x=-n*L.mouseOrbitSensitivity):(L.eulerDelta.y=-e.movementX*L.mouseOrbitSensitivity,L.eulerDelta.x=-e.movementY*L.mouseOrbitSensitivity)),"mouse"!==e.pointerType&&"drag"===L.rotByTouch&&(L.eulerDelta.y=-t*L.mouseOrbitSensitivity*5,L.eulerDelta.x=-n*L.mouseOrbitSensitivity*5),L.dispatchEvent(SR)}},L.onPointerlockChange=function(e){L.domElement.ownerDocument.pointerLockElement===L.domElement?(L.dispatchEvent(ER),n.isLocked=!0):(L.dispatchEvent(AR),n.isLocked=!1)},L.onPointerlockError=function(){console.error("SPE.GameControls: Unable to use Pointer Lock API")},L.onKeyDown=function(e){!(e.target instanceof HTMLInputElement)&&("ArrowLeft"===e.code||"ArrowUp"===e.code||"ArrowRight"===e.code||"ArrowDown"===e.code||"Space"===e.code)&&e.preventDefault();var t,n=Object(j.a)(L.keyAssignments);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(e.key.toUpperCase()===r[1]||e.key===r[1]){L.movementState[r[0]]=1;break}}}catch(i){n.e(i)}finally{n.f()}L.dispatchEvent(SR)},L.onKeyUp=function(e){var t,n=Object(j.a)(L.keyAssignments);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(e.key.toUpperCase()===r[1]||e.key===r[1]||e.code.slice(3,e.code.length).toUpperCase()===r[1]){L.movementState[r[0]]=0;break}}}catch(i){n.e(i)}finally{n.f()}},L.copyVRGamePadValues=function(e,t){for(var n=2;n<4;n++){var r=e.axes[n];0===t?2===n?L.movementState.movePosX=r:L.movementState.movePosZ=r:(e.buttons[3].pressed?L.movementState.jump=1:L.movementState.jump=0,2===n?(Math.abs(L.movementState.rotPosY)<.3&&Math.abs(r)>=.3&&(L.vrEulerYOffset+=r<0?1:-1),L.movementState.rotPosY=r):"fly"===L.moveMode&&(L.movementState.moveNegY=r))}},e===u&&(L.isFirstPerson=!0),L.position0.copy(L.object.position),L.rotation0.copy(L.object.rotation),L.scale0.copy(L.object.scale),L.hiddenMatrix0.copy(L.object.hiddenMatrix),L.object.parent?L.object.hiddenMatrix.copy(L.object.parent.matrixWorld).invert():L.object.hiddenMatrix.identity(),L.object.matrix.copy(L.object.matrixWorld),L.object.matrix.decompose(L.object.position,L.object.quaternion,L.object.scale),L.object.rotation.reorder("YXZ"),L.euler0.copy(L.object.rotation);var N,B=L.object.rotation.y;if(L.objectRealQuat.copy(L.object.quaternion),L.object.rotation.y=0,L.objXZQuat.copy(L.object.quaternion),L.objXZQuatInv.copy(L.objXZQuat).invert(),L.objXZRotMat.makeRotationFromQuaternion(L.object.quaternion),L.object.rotation.set(0,B,0),L.rot.setFromEuler(L.object.rotation),L.object.matrixAutoUpdate=!1,(L.isFirstPerson||!0===L.cameraFollow)&&(L.target0.copy(L.camera.getTarget()),L.zoom0=L.camera.zoom),!0===L.cameraFollow){var F,U;if(L.position0Cam.copy(L.camera.position),L.quat0Cam.copy(L.camera.quaternion),L.scale0Cam.copy(L.camera.scale),L.hiddenMatrix0Cam.copy(L.camera.hiddenMatrix),null!==(F=L.camera)&&void 0!==F&&null!==(U=F.parent)&&void 0!==U&&U.parent){var z=L.camera.matrix.clone().invert().premultiply(L.camera.matrixWorld),V=z.clone().invert();L.camera.hiddenMatrix.multiply(V),L.camera.matrix.premultiply(z),L.camera.matrixWorld.decompose(L.camera.position,L.camera.quaternion,L.camera.scale)}L.camera.matrixAutoUpdate=!1,L.offsetMatrix.copy(L.object.matrix).invert().multiply(L.camera.matrix);var G,H=new tr(0,0,-1).applyQuaternion(L.camera.quaternion),W=(new tr).subVectors(L.object.position,L.camera.position);if(L.objectToCamXZ.copy(W),L.objectToCamXZ.y=0,L.objectToCamXZ0.copy(L.objectToCamXZ),Math.abs(H.y)<1e-6){W.y=0,H.y=0;var q=W.projectOnVector(H);L.targetToCamera0.copy(q).negate(),G=L.camera.position.clone().add(q)}else{var Y=H.multiplyScalar(W.y/H.y);L.targetToCamera0.copy(Y).negate(),G=Y.clone().add(L.camera.position)}L.objectToTarget0.subVectors(G,L.object.position);var X=(new Vr).setFromQuaternion(L.camera.quaternion,"YXZ");L.cameraPolarOffset=-X.x,X.x=0,X.z=0,X.y-=Math.PI/2,L.cameraPolarAxis0.set(0,0,-1).applyEuler(X)}(L.object instanceof qM&&(L.object.matrixAutoUpdate=!1),L.euler.setFromQuaternion(L.object.quaternion,"YXZ"),L.connect(),L.rotByTouch=null!==(h=i.rotByTouch)&&void 0!==h?h:"joystick",L.rotBy=null!==(d=i.rotBy)&&void 0!==d?d:"keys",L.rotationMode=null!==(f=i.rotationMode)&&void 0!==f?f:"normal",L.moveMode=null!==(p=i.moveMode)&&void 0!==p?p:"walk",L.collisionEnabled=i.collisionEnabled,L.speedTranslate=(null!==(m=i.speedTranslate)&&void 0!==m?m:250)*HR,L.speedOrbit=(null!==(y=i.speedRotate)&&void 0!==y?y:100)*WR,L.mouseOrbitSensitivity=(null!==(b=i.speedRotate)&&void 0!==b?b:100)*qR,L.keyAssignments=i.keyAssignments.map((function(e){var t=[e[0],e[1]];return"\u25b2"===t[1]?t[1]="ArrowUp":"\u25c0"===t[1]?t[1]="ArrowLeft":"\u25bc"===t[1]?t[1]="ArrowDown":"\u25b6"===t[1]?t[1]="ArrowRight":"\u21e7"===t[1]?t[1]="Shift":"\u21b5"===t[1]?t[1]="Enter":"Space"===t[1]?t[1]=" ":"\u2318"===t[1]?t[1]="Meta":"Ctrl"===t[1]?t[1]="Control":"Esc"===t[1]&&(t[1]="Escape"),t})),"mouse"===i.rotBy)&&(N=L.keyAssignments.findIndex((function(e){return"rotNegX"===e[0]})),-1!==N&&(L.keyAssignments[N][1]=""),N=L.keyAssignments.findIndex((function(e){return"rotPosX"===e[0]})),-1!==N&&(L.keyAssignments[N][1]=""),N=L.keyAssignments.findIndex((function(e){return"rotPosY"===e[0]})),-1!==N&&(L.keyAssignments[N][1]=""),N=L.keyAssignments.findIndex((function(e){return"rotNegY"===e[0]})),-1!==N&&(L.keyAssignments[N][1]=""));L.lerpFactorPosStart=1-Math.pow(.02,1/(60*(null!==(w=i.delayPos[0])&&void 0!==w?w:.3))),L.lerpFactorPosEnd=1-Math.pow(.02,1/(60*(null!==(x=i.delayPos[1])&&void 0!==x?x:.3))),L.lerpFactorPos.setScalar(L.lerpFactorPosStart),L.lerpFactorRotStart=1-Math.pow(.02,1/(60*(null!==(O=i.delayRot[0])&&void 0!==O?O:.3))),L.lerpFactorRotEnd=1-Math.pow(.02,1/(60*(null!==(k=i.delayRot[1])&&void 0!==k?k:.3))),L.lerpFactorPosCamera=1-Math.pow(.02,1/(60*(null!==(_=i.delayPosCamera)&&void 0!==_?_:.3))),L.lerpFactorRotCamera=1-Math.pow(.02,1/(60*(null!==(S=i.delayRotCamera)&&void 0!==S?S:.3))),L.gravity=(null!==(A=a.gravity)&&void 0!==A?A:jx.defaultData.gravity)*YR,L.pixelsPerMeter=null!==(T=a.pixelsPerMeter)&&void 0!==T?T:jx.defaultData.pixelsPerMeter,L.usePhysics=null!==(M=a.usePhysics)&&void 0!==M?M:jx.defaultData.usePhysics,L.jumpPower=i.jumpPower*XR,L.resetYPosition=i.resetYPosition,L.alignToGround=null!==(C=i.alignToGround)&&void 0!==C&&C,L.orientMode=i.autoOrientMove?i.orientMode:"none",L.orientWith=null!==(D=i.orientWith)&&void 0!==D?D:Zx.defaultDataThirdPerson.orientWith;var K=null!==(I=a.skinWidthRelative)&&void 0!==I?I:jx.defaultData.skinWidthRelative,Q=null!==(P=a.stepThreshRelative)&&void 0!==P?P:jx.defaultData.stepThreshRelative;L.slopeThresh=(null!==(R=a.slopeThresh)&&void 0!==R?R:jx.defaultData.slopeThresh)*Math.PI/180,"capsule"===i.collider.type?(L.collider.radius=i.collider.radius,L.collider.segment.start.y=i.collider.height/2-i.collider.radius,L.collider.segment.end.y=-L.collider.segment.start.y,L.offset=i.collider.height*K/L.pixelsPerMeter,L.stepThresh=i.collider.height*Q/L.pixelsPerMeter):"sphere"===i.collider.type?(L.collider.radius=i.collider.radius,L.collider.segment.start.y=0,L.collider.segment.end.y=0,L.offset=2*i.collider.radius*K/L.pixelsPerMeter,L.stepThresh=2*i.collider.radius*Q/L.pixelsPerMeter):(L.offset=i.collider.height*K/L.pixelsPerMeter,L.stepThresh=i.collider.height*Q/L.pixelsPerMeter),L.collider.type=i.collider.type;var Z=(new tr).fromArray(i.collider.position),J=(new er).setFromEuler((new Vr).fromArray([].concat(Object(v.a)(i.collider.rotation),["XYZ"])));return L.collider.position.copy(Z).multiply(L.object.scale),L.collider.rotation.copy(J),L.collider.matrix.compose(Z,J,GR),void 0!==i.cameraXAxis&&(L.cameraXAxis=i.cameraXAxis,L.cameraYAxis=i.cameraYAxis,L.minPolarAngle=i.cameraRotXLimits[0],L.maxPolarAngle=i.cameraRotXLimits[1],L.minAzimuthAngleRel=i.cameraRotYLimits[0],L.maxAzimuthAngleRel=i.cameraRotYLimits[1]),void 0!==i.gameActions&&Object.entries(i.gameActions).forEach((function(t,n){var r=Object(g.a)(t,2),i=r[0];r[1].forEach((function(t){var n=t.id,r=t.data;try{void 0===L.actions[i]&&(L.actions[i]=[]),"Transition"===r.type?L.actions[i].push(new bP(r,c,l)):"Audio"===r.type?L.actions[i].push(new RD(n,r,e,l)):"Video"===r.type&&L.actions[i].push(new UD(n,r,e))}catch(a){}}))})),L.dispatchStopEvent("move"),L.dispatchStopEvent("jump"),L.dispatchStartEvent("idle"),L}return Object(A.a)(n,[{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.object.rotation.copy(this.rotation0),this.object.position.copy(this.position0),this.object.scale.copy(this.scale0),this.object.hiddenMatrix.copy(this.hiddenMatrix0),!0===e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.rotation.reorder("YXZ");var t=this.object.rotation.y;this.object.rotation.y=0,this.objXZQuat.copy(this.object.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.object.quaternion),this.object.rotation.set(0,t,0),this.rot.setFromEuler(this.object.rotation),this.euler.setFromQuaternion(this.object.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}!1===e&&(this.object instanceof qM?this.object.matrixAutoUpdate=!0:this.object.updateMatrix()),!0===this.cameraFollow&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.dispatchEvent(SR)}},{key:"connect",value:function(){this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError)}},{key:"disconnect",value:function(){this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError)}},{key:"dispose",value:function(){this.disconnect(),Object.values(this.actions).forEach((function(e){e.forEach((function(e){(e instanceof bP||e instanceof RD||e instanceof UD)&&e.dispose()}))}))}},{key:"resetTo",value:function(e,t,n){}},{key:"dispatchStartEvent",value:function(e){void 0!==this.actions[e]&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].forEach((function(e){e instanceof bP?e.play():e instanceof RD&&e.dispatchGameControl("start")}))))}},{key:"dispatchStopEvent",value:function(e){var t=this;void 0!==this.actions[e]&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].forEach((function(e){e instanceof bP?e.stop():e instanceof RD&&e.dispatchGameControl("stop")})),this.object.traverseEntity((function(e){null!==e.currentState&&e.changeSelectedState(null,{scene:t.scene,shared:t.sharedAssets})}))))}},{key:"update",value:function(e,t,n){if(this.gravity<0?this.object.position.y<this.resetYPosition:this.object.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);var r=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);var i=60*r,a=!1;if(this.usePhysics&&this.collisionEnabled){var o,s=DR.set(0,(0===this.velocity.y?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/10,1)*(this.gravity>0?1:-1):this.velocity.y)*r,0).divideScalar(this.pixelsPerMeter),u=this.sharedGameControlGlobals.rapierWorld.castShape(CR.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.object.position).divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,s,null===(o=this.object.rigidBody)||void 0===o?void 0:o.collider(0).shape,1,8,void 0,void 0,this.object.rigidBody);if(u){this.onObject=!0,this.groundNormal.set(u.normal2.x,u.normal2.y,u.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(a=!0);var c=u.collider._parent;this.groundYRotation=0,this.groundVelocity.set(0,0,0);var l,h=Object(j.a)(this.sharedGameControlGlobals.entitiesWithTransformAnim);try{for(h.s();!(l=h.n()).done;){var d=l.value;if(d.rigidBody===c){(d.hasNonUniformScale?d.matrixWorldRigid:d.matrixWorld).decompose(CR,BR,DR),this.groundVelocity.subVectors(CR,d.prevT),this.object.getWorldPosition(DR).add(this.collider.position).sub(d.position),this.groundYRotation=FR.setFromQuaternion(BR).y-d.prevR.y,IR.copy(DR).applyAxisAngle(zR,this.groundYRotation),this.groundVelocity.add(IR.sub(DR)).divideScalar(r);break}}}catch(re){h.e(re)}finally{h.f()}}else this.onObject=!1}"walk"===this.moveMode&&this.collisionEnabled&&(1===this.movementState.jump&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.velocityTarget.y+=this.onObject?0:this.gravity*i),"fly"===this.moveMode&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.directionXZ.normalize(),this.movementState.moveNegZ||this.movementState.movePosZ?this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce:this.velocityTarget.z=0,this.movementState.moveNegX||this.movementState.movePosX?this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce:this.velocityTarget.x=0,("walk"===this.moveMode?this.velocityTarget.x+this.velocityTarget.z===0:0===this.velocityTarget.manhattanLength())?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),"walk"===this.moveMode&&(this.lerpFactorPos.y=1),!1===this.didHit&&0===this.pushedVelocity.manhattanLength()||!1===this.usePhysics?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-Math.pow(1-this.lerpFactorPos.x,i)),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-Math.pow(1-this.lerpFactorPos.y,i)),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-Math.pow(1-this.lerpFactorPos.z,i))):this.velocity.copy(this.velocityTarget),("walk"===this.moveMode?Math.pow(this.velocity.x,2)+Math.pow(this.velocity.z,2)<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("move")));var f=MR.copy(this.velocity);if("none"!==this.orientMode&&!1===this.isFirstPerson){var p=DR.copy(f);p.y=0,f.set(0,f.y,-1*p.length())}if(FR.setFromVector3(this.rot),"walk"===this.moveMode&&(FR.x=0),f.applyEuler(FR),a&&(BR.setFromUnitVectors(zR,this.groundNormal),f.applyQuaternion(BR)),n){var v=FR.set(0,this.vrEulerYOffset*JR,0);n.applyEuler(v),f.x+=n.x,f.z+=n.z,this.nonColliderPosOffset.elements[13]+=n.y*r}if(!0===this.usePhysics){var m=DR;this.pushedVelocity.set(0,0,0);var g,y=Object(j.a)(this.sharedGameControlGlobals.entitiesWithTransformAnim);try{for(y.s();!(g=y.n()).done;){var b=g.value,w=IR.setFromMatrixPosition(b.matrixWorld).sub(b.prevT).divideScalar(r).divideScalar(this.pixelsPerMeter),x=b.rigidBody.collider(0).castCollider(w,this.object.rigidBody.collider(0),CR.copy(f).divideScalar(this.pixelsPerMeter),r);if(w.multiplyScalar(this.pixelsPerMeter),null!==x){this.pushedVelocity.copy(w),m.copy(x.normal1).applyQuaternion(b.quaternion);break}}}catch(re){y.e(re)}finally{y.f()}if(0!==this.pushedVelocity.manhattanLength()){var O=m.dot(f);O<0&&f.addScaledVector(m,-O),f.add(this.pushedVelocity)}else f.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),"normal"===this.rotationMode&&(this.movementState.rotPosX||this.movementState.rotNegX)||"steer"===this.rotationMode&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||"walk"===this.moveMode)?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,"normal"===this.rotationMode&&(this.movementState.rotPosY||this.movementState.rotNegY)||"steer"===this.rotationMode&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(r),this.rotVelocityStick),0===this.rotVelocityTarget.manhattanLength()?this.rotVelocity.lerp(this.rotVelocityTarget,1-Math.pow(1-this.lerpFactorRotEnd,i)):this.rotVelocity.lerp(this.rotVelocityTarget,1-Math.pow(1-this.lerpFactorRotStart,i)),this.euler.x+=this.rotVelocity.x*r,this.euler.y+=this.rotVelocity.y*r+this.groundYRotation,0===this.rotVelocityTarget.y&&0===this.directionXZ.manhattanLength()?this.rotationAccumWhenOrientWithCamera=0:(!1===this.cameraFollow||"Locked"===this.cameraYAxis)&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*r),!1===this.isFirstPerson&&"none"!==this.orientMode&&this.directionXZ.manhattanLength()>0){var k=CR,_=DR.copy(this.directionXZ);_.x*=-1,this.camera.getWorldDirection(k);var S=IR.copy(zR).multiplyScalar(k.dot(zR));if(k.sub(S),"camera"===this.orientWith?this.rot.y=k.angleTo(_)*(k.cross(_).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera:this.rot.y=this.euler.y+Math.atan2(-this.directionXZ.z,this.directionXZ.x)-Math.PI/2,"radial"===this.orientMode){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(zR,this.euler.y-this.euler0.y);var E=DR.copy(this.objectToCamXZ).normalize(),A=IR.copy(f).multiplyScalar(r);A.y=0;var T=A.sub(CR.copy(E).multiplyScalar(A.dot(E))).cross(E).y;this.euler.y-=Math.atan2(T,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*r+this.groundYRotation,0!==this.rotVelocityTarget.y&&(!1===this.cameraFollow||"Locked"===this.cameraYAxis)&&(this.euler.y=this.rot.y);if(!0===this.cameraFollow&&("walk"===this.moveMode?"Limit"===this.cameraXAxis?this.euler.x=En.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=En.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):"Limit"===this.cameraXAxis&&(this.euler.x=En.clamp(this.euler.x,-this.PI_2,this.PI_2))),"fly"===this.moveMode?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(FR.copy(t),FR.y=0):(FR.copy(this.euler),FR.y=0),this.nonColliderRotOffset.makeRotationFromEuler(FR)),t&&("walk"===this.moveMode?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*JR),NR.setFromAxisAngle(UR,this.rot.x),BR.setFromAxisAngle(zR,this.rot.y),BR.multiply(NR),NR.setFromAxisAngle(VR,this.rot.z),BR.multiply(NR),this.object.quaternion.copy(BR),this.objectRealQuat.multiplyQuaternions(this.object.quaternion,this.objXZQuat),this.objectRealQuat.multiply(this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){var M,C,D,I=DR.copy(f).multiplyScalar(r/this.pixelsPerMeter);this.didHit=!1;for(var P=new tr,R=0;R<5;R++){var L,N=I.length(),B=IR.copy(I).normalize();if(null===(D=this.sharedGameControlGlobals.rapierWorld.castShape(CR.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.object.position).divideScalar(this.pixelsPerMeter).add(P),this.colliderWorldQuat,B,null===(L=this.object.rigidBody)||void 0===L?void 0:L.collider(0).shape,N,8,void 0,void 0,this.object.rigidBody))){0===R&&0!==this.directionXZ.manhattanLength()&&(this.lastHitObj=null),P.add(I);break}this.didHit=!0;var F=this.sharedGameControlGlobals.colliderToEntity[D.collider.handle];if(F!==this.lastHitObj&&0===R){this.lastHitObj=F;var U=this.sharedGameControlGlobals.eventsPerObjects[null===F||void 0===F?void 0:F.uuid];if(U){var z,V=Object(j.a)(U);try{for(V.s();!(z=V.n()).done;){var G=z.value;"character"===G.data.target&&(F.dispatchEvent(wR),G.dispatch())}}catch(re){V.e(re)}finally{V.f()}}}var H=jR.set(D.normal2.x,D.normal2.y,D.normal2.z).applyQuaternion(this.colliderWorldQuat),W=TR.copy(B).multiplyScalar(D.toi).dot(H),q=D.toi;if(0===q&&(this.object.position.y+=this.offset*this.pixelsPerMeter),W>this.offset&&(q=D.toi*(W-this.offset)/W,P.addScaledVector(B,q)),I.copy(B).multiplyScalar(N-q),Math.acos(-H.y)>this.slopeThresh){var Y,X=CR.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.object.position).divideScalar(this.pixelsPerMeter).add(P),K=IR.copy(D.witness2).applyQuaternion(this.colliderWorldQuat);K.y=0;var Q=X.add(K);Q.y+=this.stepThresh;var Z=this.sharedGameControlGlobals.rapierWorld.castShape(Q,this.colliderWorldQuat,I,null===(Y=this.object.rigidBody)||void 0===Y?void 0:Y.collider(0).shape,1,8,void 0,void 0,this.object.rigidBody);null!==Z&&0===Z.toi&&(H.y=0,H.normalize())}I.addScaledVector(H,-I.dot(H))}this.object.position.addScaledVector(P,this.pixelsPerMeter),null!==(M=this.object.rigidBody)&&void 0!==M&&M.setTranslation(CR.copy(this.object.position).divideScalar(this.pixelsPerMeter),!0),null===(C=this.object.rigidBody)||void 0===C||C.setRotation(NR.copy(this.object.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else for(var J=this.onObject?1:5,$=f.multiplyScalar(r/J),ee=0;ee<J;ee++)this.object.position.add($),this.collisionAdjustment(r/J);else this.object.position.addScaledVector(f,r);if("walk"===this.moveMode&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.object.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.updateMatrix(),this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.object.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),!0===this.cameraFollow){this.updateFollowArms();var te=this.objectToTarget.add(this.object.position),ne=this.targetToCamera.add(te);PR.lookAt(ne,te,zR).setPosition(ne),PR.decompose(this.targetPos,this.targetQuat,CR),this.camera.quaternion.slerp(this.targetQuat,1-Math.pow(1-this.lerpFactorRotCamera,i)),this.camera.position.lerp(this.targetPos,1-Math.pow(1-this.lerpFactorPosCamera,i)),this.camera.updateMatrix(),this.camera.matrixWorldNeedsUpdate=!0,"Limit"===this.cameraYAxis&&"cartesian"===this.orientMode&&(this.euler.y=En.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=En.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),(!(this.lastPosition.distanceToSquared(this.object.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(void 0===this.camera||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate))||"fly"!==this.moveMode&&!0!==this.onObject&&!1!==this.collisionEnabled)&&(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.object.position),this.object.dispatchEvent(ZR),!0)}},{key:"updateFollowArms",value:function(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);var e,t=NR.setFromAxisAngle(zR,"Limit"===this.cameraYAxis&&"radial"!==this.orientMode?En.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);("Locked"!==this.cameraYAxis||"radial"===this.orientMode)&&this.objectToTarget.applyQuaternion(t),e="Limit"===this.cameraXAxis?En.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):En.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);var n=CR.copy(this.cameraPolarAxis0);("Locked"!==this.cameraYAxis||"radial"===this.orientMode)&&n.applyQuaternion(t);var r=BR.setFromAxisAngle(n,e);"Locked"!==this.cameraYAxis&&this.targetToCamera.applyQuaternion(t),"Locked"!==this.cameraXAxis&&this.targetToCamera.applyQuaternion(r)}},{key:"groundTiltAdjustment",value:function(e){180*zR.angleTo(e)/Math.PI<15||180*zR.angleTo(e)/Math.PI>85?NR.identity():NR.setFromUnitVectors(zR,e),this.groundTilt.slerp(NR,.06),this.groundTiltInv.copy(this.groundTilt).invert()}},{key:"collisionAdjustment",value:function(e){var t,n=this,r=TR.set(0,0,0);this.object.updateMatrix();var i=PR.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(CR,NR,DR).compose(CR,NR,GR);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach((function(e){if(e!==n.object&&!e.isDescendantOf(n.object)){QR.makeEmpty(),e.updateMatrixWorldSVD();var t=e.matrixWorldRigid,a=RR.copy(t).invert(),o=LR.copy(RR).multiply(i);KR.copy(n.collider.segment),KR.start.applyMatrix4(o),KR.end.applyMatrix4(o);var s=jR.copy(n.object.position).applyMatrix4(a);QR.expandByPoint(KR.start),QR.expandByPoint(KR.end),QR.min.addScalar(-n.collider.radius),QR.max.addScalar(n.collider.radius),e.boundsTree.shapecast({intersectsBounds:function(e){return e.intersectsBox(QR)},intersectsTriangle:function(e){var i=CR,a=DR,o=e.closestPointToSegment(KR,i,a);if(o<n.collider.radius){var u=n.collider.radius-o,c=a.sub(i).normalize(),l=IR.copy(s);l.addScaledVector(c,u);var h=l.applyMatrix4(t).sub(n.object.position);r.add(h),KR.start.addScaledVector(c,u),KR.end.addScaledVector(c,u)}}})}})),QR.makeEmpty(),KR.copy(this.collider.segment),KR.start.applyMatrix4(i),KR.end.applyMatrix4(i),QR.expandByPoint(KR.start),QR.expandByPoint(KR.end),QR.min.addScalar(-this.collider.radius),QR.max.addScalar(this.collider.radius),null!==(t=this.sharedGameControlGlobals.staticMeshBVH)&&void 0!==t&&t.shapecast({intersectsBounds:function(e){return e.intersectsBox(QR)},intersectsTriangle:function(e){var t=CR,i=DR,a=e.closestPointToSegment(KR,t,i);if(a<n.collider.radius){var o=n.collider.radius-a,s=i.sub(t).normalize();n.alignToGround&&n.groundTiltAdjustment(s),r.addScaledVector(s,o),KR.start.addScaledVector(s,o),KR.end.addScaledVector(s,o)}}}),this.onObject=r.y>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");var a=Math.max(0,r.length()-1e-5);r.normalize().multiplyScalar(a),this.object.position.add(r)}}]),n}(vn),eL=$R;eL.isLocked=!1;var tL={type:"change"},nL={type:"changeZoom"},rL={type:"changePan"},iL={type:"start"},aL={type:"end",changed:!0},oL={type:"end",changed:!1},sL=new er,uL=new An,cL=2*Math.PI,lL=1e-8,hL=.01,dL=2,fL=.125,pL=1,vL=1,mL=.1,gL=new tr,yL=new An,bL=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(E.a)(this,n),(i=t.call(this)).object=e,i.domElement=r,i.isExport=a,i.enabled=!0,i.useKeyEvents=!0,i.enableDamping=!1,i.enableZoom=!0,i.enableRotate=!0,i.enablePan=!0,i.autoRotate=!1,i.rotationLimitsMode=0,i.panLimitsMode=0,i.rotationSoftLimit=2,i.panSoftLimit=2,i.hoverRotatePanMode=0,i.zoomLimitsEnabled=!1,i.mouseButtons=[0,5],i.mouseButtonsPlay=[3,4,5],i.touches=[null,q.DOLLY_ROTATE,q.PAN],i.offset=new tr,i.eye=new tr,i.lastPosition=new tr,i.lastQuaternion=new er,i.current=new An,i.overShoot=new An,i.overRatio=new An,i.spherical=new Sl,i.sphericalDelta=new Sl,i.panOffset=new tr,i.panLeftV=new tr,i.panUpV=new tr,i.panV=new tr,i.rotateStart=new An,i.rotateEnd=new An,i.rotateDelta=new An,i.panStart=new An,i.panEnd=new An,i.panDelta=new An,i.dollyStart=new An,i.dollyEnd=new An,i.dollyDelta=new An,i.rotationRangeFactor=new An,i.panRangeFactor=new An,i.state=-1,i.zoomChanged=!1,i.isPointerDown=!1,i.isThetaFlipped=!1,i.prevScale=0,i.scale=1,i.gesture=!1,i.timer=-1,i.timerHover=-1,i.minDistance=0,i.maxDistance=1/0,i.minZoom=0,i.maxZoom=1/0,i.minPhi=0,i.maxPhi=Math.PI,i.minTheta=-1/0,i.maxTheta=1/0,i.minH=0,i.maxH=Math.PI,i.minV=-1/0,i.maxV=1/0,i.autoRotateClockwise=!0,i.isPanOverShoot=!1,i.isRotateOverShoot=!1,i.resetHoverEffectOnPointerLeave=!1,i.hasChange=!1,i.update=function(){var e=i.object.position;i.offset.copy(e).sub(i.target),i.spherical.setFromVector3(i.offset),i.object.isUpVectorFlipped&&(i.spherical.phi*=-1,i.spherical.theta-=Math.PI),i.autoRotate&&-1===i.state&&i.rotateLeft((!0===i.autoRotateClockwise?1:-1)*i.getAutoRotationAngle()),0!==i.rotationLimitsMode&&i.applyLimits(i.sphericalDelta,i.rotationLimitsMode,i.rotationSoftLimit,i.maxTheta,i.minTheta,i.maxPhi,i.minPhi,i.rotationRangeFactor),2!==i.rotationLimitsMode&&(i.spherical.phi+=i.sphericalDelta.phi),(1!==i.rotationLimitsMode||!0===i.autoRotate)&&(i.spherical.theta+=i.sphericalDelta.theta),i.spherical.radius*=i.scale,i.zoomLimitsEnabled&&(i.spherical.radius=Math.max(i.minDistance,Math.min(i.maxDistance,i.spherical.radius))),0!==i.panLimitsMode&&(i.target.applyQuaternion(sL.copy(i.object.quaternion).invert()),i.panOffset.applyQuaternion(sL),i.applyLimits(i.panOffset,i.panLimitsMode,i.panSoftLimit,i.maxH,i.minH,i.maxV,i.minV,i.panRangeFactor),i.target.applyQuaternion(i.object.quaternion),i.panOffset.applyQuaternion(i.object.quaternion)),2===i.panLimitsMode&&(i.panOffset.y=0),1===i.panLimitsMode&&(i.panOffset.x=0),-1!==i.state||i.gesture?(i.target.add(i.panOffset),i.panOffset.set(0,0,0)):(i.panOffset.multiplyScalar(1-fL),i.target.add(i.panOffset)),i.offset.setFromSpherical(i.spherical),e.copy(i.target).add(i.offset);var t=i.spherical.phi%cL;return i.eye.copy(i.offset).normalize(),i.object.up.copy(ri.DefaultUp).applyAxisAngle(i.eye,i.object.angleOffsetFromUp),t>0&&t>Math.PI||t<0&&t>-Math.PI?(i.object.up.negate(),i.object.lookAt(i.target),i.object.isUpVectorFlipped=!0):(i.object.lookAt(i.target),i.object.isUpVectorFlipped=!1),-1===i.state||!0===i.enableDamping?(i.sphericalDelta.theta*=1-fL,i.sphericalDelta.phi*=1-fL):i.sphericalDelta.set(0,0,0),i.scale=1,i.zoomChanged||i.lastPosition.distanceToSquared(i.object.position)>hL||8*(1-i.lastQuaternion.dot(i.object.quaternion))>lL?(i.dispatchEvent(tL),i.lastPosition.copy(i.object.position),i.lastQuaternion.copy(i.object.quaternion),i.zoomChanged=!1,!0):(i.isPanOverShoot=!1,i.isRotateOverShoot=!1,i.sphericalDelta.set(0,0,0),i.panOffset.set(0,0,0),!1)},i.onPointerDown=function(e){!1!==i.enabled&&("touch"===e.pointerType||"pen"===e.pointerType&&kx?i.onPointerDownTouch(e):i.onPointerDownMouse(e),-1!==i.state&&(i.isPointerDown=!0,i.dispatchEvent(iL),i.domElement.addEventListener("pointermove",i.onPointerMove),i.domElement.addEventListener("pointerup",i.onPointerUp),e.stopPropagation(),"touch"===e.pointerType||"pen"===e.pointerType&&kx||i.domElement.setPointerCapture(e.pointerId)))},i.onPointerLeave=function(e){i.resetHoverEffectOnPointerLeave?(1===i.hoverRotatePanMode?(i.sphericalDelta.theta=-i.spherical.theta,i.sphericalDelta.phi=-i.spherical.phi,gL.subVectors(i.position0,i.target0),i.spherical.setFromVector3(gL),i.sphericalDelta.theta+=i.spherical.theta,i.sphericalDelta.phi+=i.spherical.phi,i.sphericalDelta.theta/=8,i.sphericalDelta.phi/=8):2===i.hoverRotatePanMode&&i.panOffset.subVectors(i.target0,i.target).divideScalar(8),i.update()):i.pointerLeaveEvent=e},i.onPointerEnter=function(e){i.resetHoverEffectOnPointerLeave||void 0===i.pointerLeaveEvent?yL.set(e.clientX-i.domElement.clientWidth/2,e.clientY-i.domElement.clientHeight/2):yL.set(e.clientX-i.pointerLeaveEvent.clientX,e.clientY-i.pointerLeaveEvent.clientY),1===i.hoverRotatePanMode?(i.rotateDelta.copy(yL).multiplyScalar(pL*mL).rotateAround(uL,-i.object.angleOffsetFromUp),i.rotateLeft(2*Math.PI*i.rotateDelta.x/i.domElement.clientHeight),i.rotateUp(2*Math.PI*i.rotateDelta.y/i.domElement.clientHeight),i.rotateStart.set(e.clientX,e.clientY)):2===i.hoverRotatePanMode&&(i.panDelta.copy(yL).multiplyScalar(vL*mL),i.pan(i.panDelta.x,i.panDelta.y),i.panStart.set(e.clientX,e.clientY)),i.update()},i.onPointerMove=function(e){!1!==i.enabled&&("touch"===e.pointerType||"pen"===e.pointerType&&kx?i.onPointerMoveTouch(e):i.onPointerMoveMouse(e),e.stopPropagation())},i.onPointerUp=function(e){i.isPointerDown=!1,0===Cx.length&&(i.domElement.removeEventListener("pointermove",i.onPointerMove),i.domElement.removeEventListener("pointerup",i.onPointerUp)),i.hasChange?i.dispatchEvent(aL):i.dispatchEvent(oL),i.state=-1,e&&(e.stopPropagation(),"touch"===e.pointerType||"pen"===e.pointerType&&kx||i.domElement.releasePointerCapture(e.pointerId))},i.onPointerDownMouse=function(e){switch(i.useKeyEvents?i.mouseButtons[e.button]:i.mouseButtonsPlay[e.button]){case 0:if(!0!==e.altKey||e.shiftKey||Ax(e)){if(" "===i.key){if(!1===i.enablePan)return;i.handleMouseDownPan(e),i.state=2}}else{if(!1===i.enableRotate)return;i.handleMouseDownRotate(e),i.state=0}break;case 4:if(!1===i.enablePan)return;i.handleMouseDownPan(e),i.state=2;break;case 3:if(Ax(e)||e.shiftKey){if(!1===i.enablePan)return;i.handleMouseDownPan(e),i.state=2}else{if(!1===i.enableRotate)return;i.handleMouseDownRotate(e),i.state=0}break;case 5:if(Ax(e)||e.shiftKey){if(!1===i.enableRotate)return;i.handleMouseDownRotate(e),i.state=0}else{if(!1===i.enablePan)return;i.handleMouseDownPan(e),i.state=2}break;default:i.state=-1}},i.onPointerMoveMouse=function(e){switch(i.state){case 0:if(!1===i.enableRotate)return;i.handleMouseMoveRotate(e);break;case 1:if(!1===i.enableZoom)return;i.handleMouseMoveDolly(e);break;case 2:if(!1===i.enablePan)return;i.handleMouseMovePan(e)}},i.onPointerDownTouch=function(e){switch(i.touches[Cx.length-1]){case q.ROTATE:if(!1===i.enableRotate)return void(i.state=-1);i.handleTouchStartRotate(),i.state=3;break;case q.PAN:if(!1===i.enablePan)return void(i.state=-1);i.handleTouchStartPan(),i.state=4;break;case q.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.handleTouchStartDollyPan(),i.state=5;break;case q.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.handleTouchStartDollyRotate(),i.state=6;break;default:i.state=-1}},i.onPointerMoveTouch=function(e){switch(i.state){case 3:if(!1===i.enableRotate)return;i.handleTouchMoveRotate(e),i.update();break;case 4:if(!1===i.enablePan)return;i.handleTouchMovePan(e),i.update();break;case 5:if(!1===i.enableZoom&&!1===i.enablePan)return;i.handleTouchMoveDollyPan(e),i.update();break;case 6:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.handleTouchMoveDollyRotate(e),i.update();break;default:i.state=-1}},i.dispatchEndDebounced=jg((function(){return i.dispatchEvent(aL)}),33),i.onMouseWheel=function(e){!1===i.enabled||!1===i.enableZoom&&!1===i.enablePan||(!1===i.isExport&&i.domElement.clientHeight===document.body.clientHeight&&i.domElement.clientWidth===document.body.clientWidth&&e.preventDefault(),i.dispatchEvent(iL),i.handleMouseWheel(e),i.dispatchEndDebounced())},i.onGesture=function(e){if(!1!==i.enabled)if(e.preventDefault(),"gesturechange"===e.type){if(!1===i.enableZoom)return;i.dispatchEvent(iL),e.scale>i.prevScale?i.dollyIn(i.getZoomScale()):e.scale<i.prevScale&&i.dollyOut(i.getZoomScale()),i.prevScale=e.scale,i.update()}else i.dispatchEvent(aL)},i.onContextMenu=function(e){!1!==i.enabled&&e.preventDefault()},i.onTouchEnd=function(e){e.preventDefault()},i.onKeyDown=function(e){!1!==i.enabled&&(i.key=e.key)},i.onKeyUp=function(){!1!==i.enabled&&(i.key=void 0,-1!==i.state&&i.onPointerUp(Cx[0]))},i.onPointerHover=function(e){"mouse"!==e.pointerType||!1===i.enabled||-1!==i.state||2===i.hoverRotatePanMode&&i.isPanOverShoot||1===i.hoverRotatePanMode&&i.isRotateOverShoot||(i.isPointerDown=!0,2===i.hoverRotatePanMode?i.handleMouseMovePan(e,mL):1===i.hoverRotatePanMode&&i.handleMouseMoveRotate(e,mL))},i.target=i.object.getTarget(),i.target0=i.target.clone(),i.position0=i.object.position.clone(),i.zoom0=i.object.zoom,i.isUpVectorFlipped0=i.object.isUpVectorFlipped,i.offset.copy(i.object.position).sub(i.target),i.spherical.setFromVector3(i.offset),i}return Object(A.a)(n,[{key:"dispatchEvent",value:function(e){"start"===e.type?this.hasChange=!1:this.hasChange=!0,Object(b.a)(Object(w.a)(n.prototype),"dispatchEvent",this).call(this,e)}},{key:"reset",value:function(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.isUpVectorFlipped=this.isUpVectorFlipped0,this.object.updateProjectionMatrix(),this.dispatchEvent(tL),this.update(),this.state=-1,this.pointerLeaveEvent=void 0}},{key:"resetTo",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.target.copy(e),this.object.position.copy(t),this.object.zoom=n,this.object.isUpVectorFlipped=r,this.object.updateProjectionMatrix(),this.dispatchEvent(tL),this.update(),this.state=-1}},{key:"fromJSON",value:function(e){var t;this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,0!==this.hoverRotatePanMode&&this.domElement.addEventListener("pointermove",this.onPointerHover),mL=Math.pow(e.hoverRotatePanStrength/100,2),this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/e.zoomLimits.max,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,dL=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;var n=this.object.getTarget().applyQuaternion(sL.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+n.y,this.maxV=e.panVerticalOffset.max+n.y,this.minH=-e.panHorizontalOffset.min+n.x,this.maxH=e.panHorizontalOffset.max+n.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=wL(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=wL(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=wL(this.spherical.theta-e.rotationHorizontalOffset.min),this.maxTheta=wL(this.spherical.theta+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,1===e.orbitTouches&&(this.touches[0]=q.ROTATE),1===e.panTouches&&(this.touches[0]=q.PAN),2===e.orbitTouches&&(this.touches[1]=q.DOLLY_ROTATE),2===e.panTouches&&(this.touches[1]=q.DOLLY_PAN),3===e.orbitTouches&&(this.touches[2]=q.ROTATE),3===e.panTouches&&(this.touches[2]=q.PAN),this.resetHoverEffectOnPointerLeave=null!==(t=e.resetHoverEffectOnPointerLeave)&&void 0!==t&&t}},{key:"connect",value:function(){this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),xx||(this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture)),this.domElement.addEventListener("touchend",this.onTouchEnd),0!==this.hoverRotatePanMode&&(this.domElement.addEventListener("pointerleave",this.onPointerLeave),this.domElement.addEventListener("pointerenter",this.onPointerEnter)),this.pointerLeaveEvent=void 0}},{key:"dispose",value:function(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),xx||(this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture)),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}},{key:"applyLimits",value:function(e,t,n,r,i,a,o,s){var u,c,l;this.overShoot.set(0,0),e instanceof tr?(u=e.x,c=e.y,this.current.set(this.target.x,this.target.y),l=!0):(u=e.theta,c=e.phi,this.current.set(wL(this.spherical.theta),wL(this.spherical.phi)),l=!1),0===n&&(this.current.x+=u,this.current.y+=c),(3===t||2===t)&&(!l&&this.isThetaFlipped?this.current.x>r&&this.current.x<0?this.overShoot.x=r-this.current.x:this.current.x<i&&this.current.x>0&&(this.overShoot.x=i-this.current.x):this.current.x>r?this.overShoot.x=r-this.current.x:this.current.x<i&&(this.overShoot.x=i-this.current.x),r===i&&(u=0)),(3===t||1===t)&&(this.current.y>a?this.overShoot.y=a-this.current.y:this.current.y<o&&(this.overShoot.y=o-this.current.y),a===o&&(c=0)),l||(this.overShoot.x=wL(this.overShoot.x),this.overShoot.y=wL(this.overShoot.y)),0!==n?(this.overRatio.copy(this.overShoot).divide(s),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),1===n&&(this.overRatio.x=xL(Math.abs(this.overRatio.x)),this.overRatio.y=xL(Math.abs(this.overRatio.y))),this.isPointerDown||1===n?2===n&&(this.overRatio.x>.9||this.overRatio.y>.9)?this.isPointerDown=!1:(u*this.overShoot.x<0&&(u*=1-this.overRatio.x),c*this.overShoot.y<0&&(c*=1-this.overRatio.y)):2===n&&(!l&&(this.overRatio.x>.002||this.overRatio.y>.002)||l&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(u=.05*this.overShoot.x,c=.05*this.overShoot.y,l?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):l?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(u+=this.overShoot.x,c+=this.overShoot.y),e instanceof tr?(e.x=u,e.y=c):(e.theta=u,e.phi=c)}},{key:"setEnableDampingSpeed",value:function(e){this.enableDamping=e,pL=!0===e?.2:1}},{key:"stopDamping",value:function(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}},{key:"getAutoRotationAngle",value:function(){return 2*Math.PI/60/60*dL}},{key:"getZoomScale",value:function(){return Math.pow(.95,2)}},{key:"rotateLeft",value:function(e){this.sphericalDelta.theta-=e}},{key:"rotateUp",value:function(e){this.sphericalDelta.phi-=e}},{key:"panLeft",value:function(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}},{key:"panUp",value:function(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}},{key:"pan",value:function(e,t){var n=this.domElement;if(n&&this.object.isPerspectiveCamera){var r=this.object.position;this.panV.copy(r).sub(this.target);var i=this.panV.length();i*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*i/n.clientHeight,this.object.matrix),this.panUp(2*t*i/n.clientHeight,this.object.matrix)}else n&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix));this.dispatchEvent(rL)}},{key:"dollyOut",value:function(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(nL)}},{key:"dollyIn",value:function(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(nL)}},{key:"zoomOut",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getZoomScale();this.dispatchEvent(iL),this.dollyOut(e),this.dispatchEvent(aL)}},{key:"zoomIn",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getZoomScale();this.dispatchEvent(iL),this.dollyIn(e),this.dispatchEvent(aL)}},{key:"handleMouseDownRotate",value:function(e){this.rotateStart.set(e.clientX,e.clientY)}},{key:"handleMouseDownDolly",value:function(e){this.dollyStart.set(e.clientX,e.clientY)}},{key:"handleMouseDownPan",value:function(e){this.panStart.set(e.clientX,e.clientY)}},{key:"handleMouseMoveRotate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;_x&&Sx<15.5&&!kx?(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)):this.rotateDelta.set(e.movementX,e.movementY),this.rotateDelta.multiplyScalar(pL*t).rotateAround(uL,-this.object.angleOffsetFromUp);var n=this.domElement;this.rotateLeft(2*Math.PI*this.rotateDelta.x/n.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/n.clientHeight),this.update()}},{key:"handleMouseMoveDolly",value:function(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}},{key:"handleMouseMovePan",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;_x&&Sx<15.5&&!kx?(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)):this.panDelta.set(e.movementX,e.movementY),this.panDelta.multiplyScalar(vL*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}},{key:"handleMouseWheel",value:function(e){var t=this;if(!1===Ox&&!1===Ax(e)&&!0===function(e){return 0===e.wheelDeltaY||0===e.deltaY?!(wx&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120)&&(e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX:0===e.deltaMode):e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY:0===e.deltaMode}(e)){if(!1===this.enablePan)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(vL),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout((function(){t.gesture=!1,t.isPointerDown=!1}),30)}else{if(!1===this.enableZoom)return;0===e.deltaY?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}},{key:"handleTouchStartRotate",value:function(){if(2===Cx.length){var e=.5*(Cx[0].pageX+Cx[1].pageX),t=.5*(Cx[0].pageY+Cx[1].pageY);this.rotateStart.set(e,t)}else this.rotateStart.set(Cx[0].pageX,Cx[0].pageY)}},{key:"handleTouchStartPan",value:function(){if(2===Cx.length){var e=.5*(Cx[0].pageX+Cx[1].pageX),t=.5*(Cx[0].pageY+Cx[1].pageY);this.panStart.set(e,t)}else this.panStart.set(Cx[0].pageX,Cx[0].pageY)}},{key:"handleTouchStartDolly",value:function(){var e=Cx[0].pageX-Cx[1].pageX,t=Cx[0].pageY-Cx[1].pageY,n=Math.sqrt(e*e+t*t);this.dollyStart.set(0,n)}},{key:"handleTouchStartDollyPan",value:function(){this.enableZoom&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}},{key:"handleTouchStartDollyRotate",value:function(){this.enableZoom&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}},{key:"handleTouchMoveRotate",value:function(e){if(2===Cx.length){var t=Bx(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this.rotateEnd.set(n,r)}else{if(e.pointerId!==Cx[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(pL);var i=this.domElement;i&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/i.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/i.clientHeight)),this.rotateStart.copy(this.rotateEnd)}},{key:"handleTouchMovePan",value:function(e){if(2===Cx.length){var t=Bx(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this.panEnd.set(n,r)}else{if(e.pointerId!==Cx[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(vL),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}},{key:"handleTouchMoveDolly",value:function(e){var t=Bx(e),n=e.pageX-t.x,r=e.pageY-t.y,i=Math.sqrt(n*n+r*r);this.dollyEnd.set(0,i),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,2)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}},{key:"handleTouchMoveDollyPan",value:function(e){this.enableZoom&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}},{key:"handleTouchMoveDollyRotate",value:function(e){this.enableZoom&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}}]),n}(vn);function wL(e){for(var t=2*Math.PI;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function xL(e){return 1-Math.pow(1-e,4)}var OL,kL=new WeakMap,_L=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,e)).decoderPath="",r.decoderConfig={},r.decoderBinary=null,r.decoderPending=null,r.workerLimit=4,r.workerPool=[],r.workerNextTaskID=1,r.workerSourceURL="",r.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},r.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"},r}return Object(A.a)(n,[{key:"setDecoderPath",value:function(e){return this.decoderPath=e,this}},{key:"setDecoderConfig",value:function(e){return this.decoderConfig=e,this}},{key:"setWorkerLimit",value:function(e){return this.workerLimit=e,this}},{key:"load",value:function(e,t,n,r){var i=this,a=new Gc(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(e){var n={attributeIDs:i.defaultAttributeIDs,attributeTypes:i.defaultAttributeTypes,useUniqueIDs:!1};i.decodeGeometry(e,n).then(t).catch(r)}),n,r)}},{key:"decodeDracoFile",value:function(e,t,n,r){var i={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,i).then(t)}},{key:"decodeGeometry",value:function(e,t){var n=this;for(var r in t.attributeTypes){var i=t.attributeTypes[r];void 0!==i.BYTES_PER_ELEMENT&&(t.attributeTypes[r]=i.name)}var a=JSON.stringify(t);if(kL.has(e)){var o=kL.get(e);if(o.key===a)return o.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var s,u=this.workerNextTaskID++,c=e.byteLength,l=this._getWorker(u,c).then((function(n){return s=n,new Promise((function(n,r){s._callbacks[u]={resolve:n,reject:r},s.postMessage({type:"decode",id:u,taskConfig:t,buffer:e},[e])}))})).then((function(e){return n._createGeometry(e.geometry)}));return l.catch((function(){return!0})).then((function(){s&&u&&n._releaseTask(s,u)})),kL.set(e,{key:a,promise:l}),l}},{key:"_createGeometry",value:function(e){var t=new Di;e.index&&t.setIndex(new wi(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var r=e.attributes[n],i=r.name,a=r.array,o=r.itemSize;t.setAttribute(i,new wi(a,o))}return t}},{key:"_loadLibrary",value:function(e,t){var n=new Gc(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((function(t,r){n.load(e,t,void 0,r)}))}},{key:"preload",value:function(){return this._initDecoder(),this}},{key:"_initDecoder",value:function(){var e=this;if(this.decoderPending)return this.decoderPending;var t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,n=[];return t?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then((function(n){var r=n[0];t||(e.decoderConfig.wasmBinary=n[1]);var i=SL.toString(),a=["/* draco decoder */",r,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([a]))})),this.decoderPending}},{key:"_getWorker",value:function(e,t){var n=this;return this._initDecoder().then((function(){if(n.workerPool.length<n.workerLimit){var r=new Worker(n.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:n.decoderConfig}),r.onmessage=function(e){var t=e.data;switch(t.type){case"decode":r._callbacks[t.id].resolve(t);break;case"error":r._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},n.workerPool.push(r)}else n.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));var i=n.workerPool[n.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i}))}},{key:"_releaseTask",value:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}},{key:"debug",value:function(){console.log("Task load: ",this.workerPool.map((function(e){return e._taskLoad})))}},{key:"dispose",value:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}]),n}(zc);function SL(){var e,t;function n(e,t,n,r,i,a){var o=a.num_components(),s=n.num_points()*o,u=s*i.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),l=e._malloc(u);t.GetAttributeDataArrayForAllPoints(n,a,c,u,l);var h=new i(e.HEAPF32.buffer,l,s).slice();return e._free(l),{name:r,array:h,itemSize:o}}onmessage=function(r){var i=r.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var a=i.buffer,o=i.taskConfig;t.then((function(e){var t=e.draco,r=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(a),a.byteLength);try{var u=function(e,t,r,i){var a,o,s=i.attributeIDs,u=i.attributeTypes,c=t.GetEncodedGeometryType(r);if(c===e.TRIANGULAR_MESH)a=new e.Mesh,o=t.DecodeBufferToMesh(r,a);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,o=t.DecodeBufferToPointCloud(r,a)}if(!o.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+o.error_msg());var l={index:null,attributes:[]};for(var h in s){var d=self[u[h]],f=void 0,p=void 0;if(i.useUniqueIDs)p=s[h],f=t.GetAttributeByUniqueId(a,p);else{if(-1===(p=t.GetAttributeId(a,e[s[h]])))continue;f=t.GetAttribute(a,p)}l.attributes.push(n(e,t,a,h,d,f))}return c===e.TRIANGULAR_MESH&&(l.index=function(e,t,n){var r=3*n.num_faces(),i=4*r,a=e._malloc(i);t.GetTrianglesUInt32Array(n,i,a);var o=new Uint32Array(e.HEAPF32.buffer,a,r).slice();return e._free(a),{array:o,itemSize:1}}(e,t,a)),e.destroy(a),l}(t,r,s,o),c=u.attributes.map((function(e){return e.array.buffer}));u.index&&c.push(u.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:u},c)}catch(u){console.error(u),self.postMessage({type:"error",id:i.id,error:u.message})}finally{t.destroy(s),t.destroy(r)}}))}}}function EL(e){return AL.apply(this,arguments)}function AL(){return AL=Object(m.a)(Object(S.a)().mark((function e(t){var n,r;return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!OL){e.next=13;break}return n={attributeIDs:OL.defaultAttributeIDs,attributeTypes:OL.defaultAttributeTypes,useUniqueIDs:!1},e.prev=2,e.next=5,OL.decodeGeometry(new Int8Array(t).buffer,n);case 5:r=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.error(e.t0);case 11:if(!r){e.next=13;break}return e.abrupt("return",{index:r.index?{array:r.index.array}:void 0,attributes:Object.entries(r.attributes).map((function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];return{name:n,itemSize:r.itemSize,array:r.array}}))});case 13:return e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[2,8]])}))),AL.apply(this,arguments)}function jL(e,t){return TL.apply(this,arguments)}function TL(){return TL=Object(m.a)(Object(S.a)().mark((function e(t,n){var r,i,a,o,s,u,c,l;return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Iy(tw.deserialize(new Uint8Array(t))),i=Object(g.a)(r,2),a=i[0],o=i[1],$x(a),s=[],a.scene.objects.traverse((function(e,t){"Mesh"===t.type&&"NonParametricGeometry"===t.geometry.type&&void 0!==t.geometry.data.draco&&s.push(t)})),e.t0=s.length,!e.t0){e.next=8;break}return e.next=8,OL||(OL=new _L).setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload(),OL.decoderPending;case 8:u=Object(S.a)().mark((function e(){var t,n,r;return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l[c],e.next=3,EL(Ry(t.geometry.data.draco));case 3:(n=e.sent)&&(n.index&&(t.geometry.data.index={array:n.index.array,itemSize:1,normalized:!1,type:"Uint32Array"}),r={},n.attributes.forEach((function(e){var t=e.name,n=e.array,i=e.itemSize;r[t]={array:n,itemSize:i,type:"Float32Array",normalized:!1}})),t.geometry.data.attributes=r,t.geometry.data.draco=void 0);case 5:case"end":return e.stop()}}),e)})),c=0,l=s;case 10:if(!(c<l.length)){e.next=15;break}return e.delegateYield(u(),"t1",12);case 12:c++,e.next=10;break;case 15:return e.abrupt("return",(n&&n(a),o.result().data));case 16:case"end":return e.stop()}}),e)}))),TL.apply(this,arguments)}var ML=Object.keys(TD).filter((function(e){return isNaN(Number(e))})),CL=function(){function e(t,n,r,i,a,o,s,u,c,l){var h,d=this;Object(E.a)(this,e),this.preventScroll=a,this.hideCursor=o,this.requestRender=u,this.isEnable=!1,this.onResetRaycaster=function(){d.eventContext.raycasterNeedsUpdate=!0},this.onTouchMovePreventScroll=function(e){(e.touches.length>1||d.preventScroll)&&e.preventDefault()},this.onMouseWheelPreventScroll=function(e){d.preventScroll&&e.preventDefault()},this.eventContext=new jD(t,n,r,s,i,null!==l&&void 0!==l&&l),this.handlers=(h={Spline:new AP(this.eventContext)},Object(_.a)(h,"Conditional",new RP(this.eventContext)),Object(_.a)(h,"Start",new fR(this.eventContext)),Object(_.a)(h,"Basic",new TP(this.eventContext,c,this)),Object(_.a)(h,"MouseHover",new cR(this.eventContext)),Object(_.a)(h,"Scroll",new hR(this.eventContext)),Object(_.a)(h,"Follow",new WP(this.eventContext)),Object(_.a)(h,"LookAt",new sR(this.eventContext)),h)}return Object(A.a)(e,[{key:"activate",value:function(){var e=this,t=this.eventContext,n=t.scene,r=t.domElement;this.hideCursor&&(r.style.cursor="none"),this.isEnable=!0,n.traverseEntity((function(t){t.addEventListener("requestRender",e.requestRender)})),Object.values(this.handlers).forEach((function(e){return e.connect()})),this.resize(),ML.forEach((function(t){Object.values(e.handlers).some((function(e){return e.domEventsNeeded.has(t)}))&&r.addEventListener(t,e.onResetRaycaster)})),r.addEventListener("wheel",this.onMouseWheelPreventScroll),r.addEventListener("touchmove",this.onTouchMovePreventScroll)}},{key:"deactivate",value:function(){var e=this,t=this.eventContext,n=t.scene,r=t.domElement;this.isEnable=!1,r.style.cursor="",Object.values(this.handlers).forEach((function(e){return e.disconnect()})),n.traverseEntity((function(t){t.removeEventListener("requestRender",e.requestRender)})),ML.forEach((function(t){r.removeEventListener(t,e.onResetRaycaster)})),r.removeEventListener("touchmove",this.onTouchMovePreventScroll),r.removeEventListener("wheel",this.onMouseWheelPreventScroll)}},{key:"reset",value:function(){this.deactivate(),this.activate()}},{key:"resize",value:function(){this.eventContext.updaterRect()}}]),e}(),DL=function(){function e(t,n,r,i,a){Object(E.a)(this,e),this._aspect=1,this._renderer=t,this._camera=n,this._frameSize=(new An).copy(r),this._editorSize=(new An).copy(i),this._aspect=n.aspect,this._fov=null!==a&&void 0!==a?a:n.fov}return Object(A.a)(e,[{key:"frameSize",set:function(e){this._frameSize.copy(e)}},{key:"updateRenderer",value:function(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}},{key:"updateViewportForImageExport",value:function(){if(this._renderer&&this._camera&&"PerspectiveCamera"===this._camera.cameraType){var e=this._frameSize.x,t=this._frameSize.y,n=this._editorSize.x,r=this._editorSize.y;this._aspect=e/t,this._camera.zoom*=Math.min(n/e,r/t),this._renderer.setViewport(0,0,e,t)}}},{key:"updateViewport",value:function(){if(this._renderer&&this._camera&&"PerspectiveCamera"===this._camera.cameraType){var e=this._frameSize.x,t=this._frameSize.y,n=this._editorSize.x,r=this._editorSize.y,i=0,a=0,o=e,s=t;e<n&&(i=-(i=.5*(n-e)),o=n),t<r&&(a=-(a=.5*(r-t)),s=r),this._aspect=o/s,this._renderer.setViewport(i,a,o,s)}}},{key:"updateCamera",value:function(){if(this._camera)if("PerspectiveCamera"===this._camera.cameraType){var e=this._frameSize.y,t=this._editorSize.y,n=this._fov;if(e>t){var r=function(e,t,n,r,i){return(e-t)/(n-t)*(i-r)+r}(e,1080,2160,1,15)/100;n*=e/t,n*=1-r}this._camera.aspect=this._aspect,this._camera.fov=n,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y)}},{key:"setCamera",value:function(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}},{key:"revert",value:function(){var e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t),this._camera.updateProjectionMatrix())}}]),e}();var IL={RED:0,GREEN:1,BLUE:2,ALPHA:3},PL="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",RL="#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;\n#if PASS == 1\nuniform vec4 kernel64[32];\n#else\nuniform vec4 kernel16[8];\n#endif\nvarying vec2 vUv;void main(){\n#ifdef FOREGROUND\nvec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;\n#else\nfloat CoC=texture2D(cocBuffer,vUv).g*scale;\n#endif\nif(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{\n#ifdef FOREGROUND\nvec2 step=texelSize*max(CoC,CoCNearFar.g*scale);\n#else\nvec2 step=texelSize*CoC;\n#endif\n#if PASS == 1\nvec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;\n#else\nvec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;\n#endif\n}}",LL=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(E.a)(this,n),(e=t.call(this,{name:"BokehMaterial",defines:{PASS:r?"2":"1"},uniforms:{kernel64:new xl(null),kernel16:new xl(null),inputBuffer:new xl(null),cocBuffer:new xl(null),texelSize:new xl(new An),scale:new xl(1)},blending:ne,depthWrite:!1,depthTest:!1,fragmentShader:RL,vertexShader:PL})).toneMapped=!1,i&&(e.defines.FOREGROUND="1"),e.generateKernel(),e}return Object(A.a)(n,[{key:"inputBuffer",set:function(e){this.uniforms.inputBuffer.value=e}},{key:"setInputBuffer",value:function(e){this.uniforms.inputBuffer.value=e}},{key:"cocBuffer",set:function(e){this.uniforms.cocBuffer.value=e}},{key:"setCoCBuffer",value:function(e){this.uniforms.cocBuffer.value=e}},{key:"scale",get:function(){return this.uniforms.scale.value},set:function(e){this.uniforms.scale.value=e}},{key:"getScale",value:function(e){return this.uniforms.scale.value=e}},{key:"setScale",value:function(e){this.uniforms.scale.value=e}},{key:"generateKernel",value:function(){for(var e=new Float32Array(128),t=new Float32Array(32),n=0,r=0,i=0;i<80;++i){var a=2.39996323*i,o=Math.sqrt(i)/Math.sqrt(80),s=o*Math.cos(a),u=o*Math.sin(a);i%5===0?(t[r++]=s,t[r++]=u):(e[n++]=s,e[n++]=u)}for(var c=[],l=[],h=0;h<128;)c.push(new Qn(e[h++],e[h++],e[h++],e[h++]));for(var d=0;d<32;)l.push(new Qn(t[d++],t[d++],t[d++],t[d++]));this.uniforms.kernel64.value=c,this.uniforms.kernel16.value=l}},{key:"setTexelSize",value:function(e,t){this.uniforms.texelSize.value.set(e,t)}},{key:"setSize",value:function(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}}]),n}(ia);function NL(e,t,n){return e*(t-n)-t}function BL(e,t,n){return Math.min(Math.max((e+t)/(t-n),0),1)}var FL="#include <common>\n#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}void main(){float depth=readDepth(vUv);\n#ifdef PERSPECTIVE_CAMERA\nfloat viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);\n#else\nfloat linearDepth=depth;\n#endif\nfloat signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}",UL=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,{name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new xl(null),focusDistance:new xl(0),focusRange:new xl(0),cameraNear:new xl(.3),cameraFar:new xl(1e3)},blending:ne,depthWrite:!1,depthTest:!1,fragmentShader:FL,vertexShader:PL})).toneMapped=!1,r.uniforms.focalLength=r.uniforms.focusRange,r.adoptCameraSettings(e),r}return Object(A.a)(n,[{key:"near",get:function(){return this.uniforms.cameraNear.value}},{key:"far",get:function(){return this.uniforms.cameraFar.value}},{key:"depthBuffer",set:function(e){this.uniforms.depthBuffer.value=e}},{key:"depthPacking",set:function(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}},{key:"setDepthBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rn;this.depthBuffer=e,this.depthPacking=t}},{key:"focusDistance",get:function(){return this.uniforms.focusDistance.value},set:function(e){this.uniforms.focusDistance.value=e}},{key:"worldFocusDistance",get:function(){return-NL(this.focusDistance,this.near,this.far)},set:function(e){this.focusDistance=BL(-e,this.near,this.far)}},{key:"getFocusDistance",value:function(e){this.uniforms.focusDistance.value=e}},{key:"setFocusDistance",value:function(e){this.uniforms.focusDistance.value=e}},{key:"focalLength",get:function(){return this.focusRange},set:function(e){this.focusRange=e}},{key:"focusRange",get:function(){return this.uniforms.focusRange.value},set:function(e){this.uniforms.focusRange.value=e}},{key:"worldFocusRange",get:function(){return-NL(this.focusRange,this.near,this.far)},set:function(e){this.focusRange=BL(-e,this.near,this.far)}},{key:"getFocalLength",value:function(e){return this.focusRange}},{key:"setFocalLength",value:function(e){this.focusRange=e}},{key:"adoptCameraSettings",value:function(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof oa?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}}]),n}(ia),zL="#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <encodings_fragment>\n#include <dithering_fragment>\n}",VL="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",GL=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new An;return Object(E.a)(this,n),(e=t.call(this,{name:"KawaseBlurMaterial",uniforms:{inputBuffer:new xl(null),texelSize:new xl(new An),halfTexelSize:new xl(new An),kernel:new xl(0),scale:new xl(1)},blending:ne,depthWrite:!1,depthTest:!1,fragmentShader:zL,vertexShader:VL})).toneMapped=!1,e.setTexelSize(r.x,r.y),e}return Object(A.a)(n,[{key:"inputBuffer",set:function(e){this.uniforms.inputBuffer.value=e}},{key:"setInputBuffer",value:function(e){this.inputBuffer=e}},{key:"scale",get:function(){return this.uniforms.scale.value},set:function(e){this.uniforms.scale.value=e}},{key:"getScale",value:function(){return this.uniforms.scale.value}},{key:"setScale",value:function(e){this.uniforms.scale.value=e}},{key:"getKernel",value:function(){return null}},{key:"kernel",get:function(){return this.uniforms.kernel.value},set:function(e){this.uniforms.kernel.value=e}},{key:"setKernel",value:function(e){this.kernel=e}},{key:"setTexelSize",value:function(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}},{key:"setSize",value:function(e,t){var n=this.uniforms;n.texelSize.value.set(1/e,1/t),n.halfTexelSize.value.copy(n.texelSize.value).multiplyScalar(.5)}}]),n}(ia),HL="#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;\n#include <encodings_fragment>\n}",WL=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this,{name:"CopyMaterial",uniforms:{inputBuffer:new xl(null),opacity:new xl(1)},blending:ne,depthWrite:!1,depthTest:!1,fragmentShader:HL,vertexShader:PL})).toneMapped=!1,e}return Object(A.a)(n,[{key:"inputBuffer",set:function(e){this.uniforms.inputBuffer.value=e}},{key:"setInputBuffer",value:function(e){this.uniforms.inputBuffer.value=e}},{key:"getOpacity",value:function(e){return this.uniforms.opacity.value}},{key:"setOpacity",value:function(e){this.uniforms.opacity.value=e}}]),n}(ia),qL="varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\n#if EDGE_DETECTION_MODE == 1\n#include <common>\n#endif\n#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}\n#elif PREDICATION_MODE == 2\nuniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}\n#endif\n#if PREDICATION_MODE != 0\nvec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}\n#endif\n#if EDGE_DETECTION_MODE != 0\nuniform sampler2D inputBuffer;\n#endif\nvoid main(){\n#if EDGE_DETECTION_MODE == 0\nconst vec2 threshold=vec2(DEPTH_THRESHOLD);\n#elif PREDICATION_MODE != 0\nvec2 threshold=calculatePredicatedThreshold();\n#else\nconst vec2 threshold=vec2(EDGE_THRESHOLD);\n#endif\n#if EDGE_DETECTION_MODE == 0\nvec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 1\nfloat l=linearToRelativeLuminance(texture2D(inputBuffer,vUv).rgb);float lLeft=linearToRelativeLuminance(texture2D(inputBuffer,vUv0).rgb);float lTop=linearToRelativeLuminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=linearToRelativeLuminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=linearToRelativeLuminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=linearToRelativeLuminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=linearToRelativeLuminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 2\nvec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#endif\n}",YL="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\nvoid main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);\n#if EDGE_DETECTION_MODE != 0\nvUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);\n#endif\ngl_Position=vec4(position.xy,1.0,1.0);}",XL={DEPTH:0,LUMA:1,COLOR:2},KL={DISABLED:0,DEPTH:1,CUSTOM:2},QL=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new An,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:XL.COLOR;return Object(E.a)(this,n),(e=t.call(this,{name:"EdgeDetectionMaterial",defines:{LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new xl(null),depthBuffer:new xl(null),predicationBuffer:new xl(null),texelSize:new xl(r)},blending:ne,depthWrite:!1,depthTest:!1,fragmentShader:qL,vertexShader:YL})).toneMapped=!1,e.edgeDetectionMode=i,e}return Object(A.a)(n,[{key:"depthBuffer",set:function(e){this.uniforms.depthBuffer.value=e}},{key:"depthPacking",set:function(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}},{key:"setDepthBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rn;this.depthBuffer=e,this.depthPacking=t}},{key:"edgeDetectionMode",get:function(){return Number(this.defines.EDGE_DETECTION_MODE)},set:function(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}},{key:"getEdgeDetectionMode",value:function(){return this.edgeDetectionMode}},{key:"setEdgeDetectionMode",value:function(e){this.edgeDetectionMode=e}},{key:"localContrastAdaptationFactor",get:function(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)},set:function(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}},{key:"getLocalContrastAdaptationFactor",value:function(){return this.localContrastAdaptationFactor}},{key:"setLocalContrastAdaptationFactor",value:function(e){this.localContrastAdaptationFactor=e}},{key:"edgeDetectionThreshold",get:function(){return Number(this.defines.EDGE_THRESHOLD)},set:function(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(.1*e).toFixed("6"),this.needsUpdate=!0}},{key:"getEdgeDetectionThreshold",value:function(){return this.edgeDetectionThreshold}},{key:"setEdgeDetectionThreshold",value:function(e){this.edgeDetectionThreshold=e}},{key:"predicationMode",get:function(){return Number(this.defines.PREDICATION_MODE)},set:function(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}},{key:"getPredicationMode",value:function(){return this.predicationMode}},{key:"setPredicationMode",value:function(e){this.predicationMode=e}},{key:"predicationBuffer",set:function(e){this.uniforms.predicationBuffer.value=e}},{key:"setPredicationBuffer",value:function(e){this.uniforms.predicationBuffer.value=e}},{key:"predicationThreshold",get:function(){return Number(this.defines.PREDICATION_THRESHOLD)},set:function(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}},{key:"getPredicationThreshold",value:function(){return this.predicationThreshold}},{key:"setPredicationThreshold",value:function(e){this.predicationThreshold=e}},{key:"predicationScale",get:function(){return Number(this.defines.PREDICATION_SCALE)},set:function(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}},{key:"getPredicationScale",value:function(){return this.predicationScale}},{key:"setPredicationScale",value:function(e){this.predicationScale=e}},{key:"predicationStrength",get:function(){return Number(this.defines.PREDICATION_STRENGTH)},set:function(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}},{key:"getPredicationStrength",value:function(){return this.predicationStrength}},{key:"setPredicationStrength",value:function(e){this.predicationStrength=e}},{key:"setSize",value:function(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}}]),n}(ia),ZL={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},JL=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i,a){var o,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return Object(E.a)(this,n),(o=t.call(this,{name:"EffectMaterial",defines:{THREE_REVISION:W.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new xl(null),depthBuffer:new xl(null),resolution:new xl(new An),texelSize:new xl(new An),cameraNear:new xl(.3),cameraFar:new xl(1e3),aspect:new xl(1),time:new xl(0)},blending:ne,depthWrite:!1,depthTest:!1,dithering:s})).toneMapped=!1,e&&o.setShaderParts(e),r&&o.setDefines(r),i&&o.setUniforms(i),o.adoptCameraSettings(a),o}return Object(A.a)(n,[{key:"inputBuffer",set:function(e){this.uniforms.inputBuffer.value=e}},{key:"setInputBuffer",value:function(e){this.uniforms.inputBuffer.value=e}},{key:"depthBuffer",get:function(){return this.uniforms.depthBuffer.value},set:function(e){this.uniforms.depthBuffer.value=e}},{key:"depthPacking",get:function(){return Number(this.defines.DEPTH_PACKING)},set:function(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}},{key:"setDepthBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rn;this.depthBuffer=e,this.depthPacking=t}},{key:"setShaderParts",value:function(e){return this.fragmentShader="#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;\n#if THREE_REVISION >= 137\nvec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;\n#ifdef ENCODE_OUTPUT\n#include <encodings_fragment>\n#endif\n#include <dithering_fragment>\n}".replace(ZL.FRAGMENT_HEAD,e.get(ZL.FRAGMENT_HEAD)).replace(ZL.FRAGMENT_MAIN_UV,e.get(ZL.FRAGMENT_MAIN_UV)).replace(ZL.FRAGMENT_MAIN_IMAGE,e.get(ZL.FRAGMENT_MAIN_IMAGE)),this.vertexShader="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}".replace(ZL.VERTEX_HEAD,e.get(ZL.VERTEX_HEAD)).replace(ZL.VERTEX_MAIN_SUPPORT,e.get(ZL.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}},{key:"setDefines",value:function(e){var t,n=Object(j.a)(e.entries());try{for(n.s();!(t=n.n()).done;){var r=t.value;this.defines[r[0]]=r[1]}}catch(i){n.e(i)}finally{n.f()}return this.needsUpdate=!0,this}},{key:"setUniforms",value:function(e){var t,n=Object(j.a)(e.entries());try{for(n.s();!(t=n.n()).done;){var r=t.value;this.uniforms[r[0]]=r[1]}}catch(i){n.e(i)}finally{n.f()}return this}},{key:"setExtensions",value:function(e){this.extensions={};var t,n=Object(j.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.extensions[r]=!0}}catch(i){n.e(i)}finally{n.f()}return this}},{key:"encodeOutput",get:function(){return void 0!==this.defines.ENCODE_OUTPUT},set:function(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}},{key:"isOutputEncodingEnabled",value:function(e){return this.encodeOutput}},{key:"setOutputEncodingEnabled",value:function(e){this.encodeOutput=e}},{key:"time",get:function(){return this.uniforms.time.value},set:function(e){this.uniforms.time.value=e}},{key:"setDeltaTime",value:function(e){this.uniforms.time.value+=e}},{key:"adoptCameraSettings",value:function(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof oa?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},{key:"setSize",value:function(e,t){var n=this.uniforms;n.resolution.value.set(e,t),n.texelSize.value.set(1/e,1/t),n.aspect.value=e/t}}],[{key:"Section",get:function(){return ZL}}]),n}(ia),$L="#include <common>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef RANGE\nuniform vec2 range;\n#elif defined(THRESHOLD)\nuniform float threshold;uniform float smoothing;\n#endif\nvarying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=linearToRelativeLuminance(texel.rgb);\n#ifdef RANGE\nfloat low=step(range.x,l);float high=step(l,range.y);l*=low*high;\n#elif defined(THRESHOLD)\nl=smoothstep(threshold,threshold+smoothing,l);\n#endif\n#ifdef COLOR\ngl_FragColor=vec4(texel.rgb*l,l);\n#else\ngl_FragColor=vec4(l);\n#endif\n}",eN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Object(E.a)(this,n),(e=t.call(this,{name:"LuminanceMaterial",uniforms:{inputBuffer:new xl(null),threshold:new xl(0),smoothing:new xl(1),range:new xl(null)},blending:ne,depthWrite:!1,depthTest:!1,fragmentShader:$L,vertexShader:PL})).toneMapped=!1,e.colorOutput=r,e.luminanceRange=i,e}return Object(A.a)(n,[{key:"inputBuffer",set:function(e){this.uniforms.inputBuffer.value=e}},{key:"setInputBuffer",value:function(e){this.uniforms.inputBuffer.value=e}},{key:"threshold",get:function(){return this.uniforms.threshold.value},set:function(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}},{key:"getThreshold",value:function(){return this.threshold}},{key:"setThreshold",value:function(e){this.threshold=e}},{key:"smoothing",get:function(){return this.uniforms.smoothing.value},set:function(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}},{key:"getSmoothingFactor",value:function(){return this.smoothing}},{key:"setSmoothingFactor",value:function(e){this.smoothing=e}},{key:"useThreshold",get:function(){return this.threshold>0||this.smoothing>0},set:function(e){}},{key:"colorOutput",get:function(){return void 0!==this.defines.COLOR},set:function(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}},{key:"isColorOutputEnabled",value:function(e){return this.colorOutput}},{key:"setColorOutputEnabled",value:function(e){this.colorOutput=e}},{key:"useRange",get:function(){return null!==this.luminanceRange},set:function(e){this.luminanceRange=null}},{key:"luminanceRange",get:function(){return this.uniforms.range.value},set:function(e){null!==e?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}},{key:"getLuminanceRange",value:function(){return this.luminanceRange}},{key:"setLuminanceRange",value:function(e){this.luminanceRange=e}}]),n}(ia),tN="#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef MASK_PRECISION_HIGH\nuniform mediump sampler2D maskTexture;\n#else\nuniform lowp sampler2D maskTexture;\n#endif\n#if MASK_FUNCTION != 0\nuniform float strength;\n#endif\nvarying vec2 vUv;void main(){\n#if COLOR_CHANNEL == 0\nfloat mask=texture2D(maskTexture,vUv).r;\n#elif COLOR_CHANNEL == 1\nfloat mask=texture2D(maskTexture,vUv).g;\n#elif COLOR_CHANNEL == 2\nfloat mask=texture2D(maskTexture,vUv).b;\n#else\nfloat mask=texture2D(maskTexture,vUv).a;\n#endif\n#if MASK_FUNCTION == 0\n#ifdef INVERTED\nmask=step(mask,0.0);\n#else\nmask=1.0-step(mask,0.0);\n#endif\n#else\nmask=clamp(mask*strength,0.0,1.0);\n#ifdef INVERTED\nmask=1.0-mask;\n#endif\n#endif\n#if MASK_FUNCTION == 2\ngl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);\n#else\ngl_FragColor=mask*texture2D(inputBuffer,vUv);\n#endif\n}",nN={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2},rN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return Object(E.a)(this,n),(e=t.call(this,{name:"MaskMaterial",uniforms:{maskTexture:new xl(r),inputBuffer:new xl(null),strength:new xl(1)},blending:ne,depthWrite:!1,depthTest:!1,fragmentShader:tN,vertexShader:PL})).toneMapped=!1,e.setColorChannel(IL.RED),e.setMaskFunction(nN.DISCARD),e}return Object(A.a)(n,[{key:"inputBuffer",set:function(e){this.uniforms.inputBuffer.value=e}},{key:"setInputBuffer",value:function(e){this.uniforms.inputBuffer.value=e}},{key:"maskTexture",set:function(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==tt&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}},{key:"setMaskTexture",value:function(e){this.maskTexture=e}},{key:"colorChannel",set:function(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}},{key:"setColorChannel",value:function(e){this.colorChannel=e}},{key:"maskFunction",set:function(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}},{key:"setMaskFunction",value:function(e){this.maskFunction=e}},{key:"inverted",get:function(){return void 0!==this.defines.INVERTED},set:function(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}},{key:"isInverted",value:function(){return this.inverted}},{key:"setInverted",value:function(e){this.inverted=e}},{key:"strength",get:function(){return this.uniforms.strength.value},set:function(e){this.uniforms.strength.value=e}},{key:"getStrength",value:function(){return this.strength}},{key:"setStrength",value:function(e){this.strength=e}}]),n}(ia),iN="#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)\n#if __VERSION__ < 300\n#define round(v) floor(v + 0.5)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);\n#endif\n}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);\n#endif\n}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){\n#if !defined(DISABLE_DIAG_DETECTION)\nweights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){\n#endif\nvec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);\n#if !defined(DISABLE_DIAG_DETECTION)\n}else{e.r=0.0;}\n#endif\n}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}",aN="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",oN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new An,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An;return Object(E.a)(this,n),(e=t.call(this,{name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new xl(null),searchTexture:new xl(null),areaTexture:new xl(null),resolution:new xl(i),texelSize:new xl(r)},blending:ne,depthWrite:!1,depthTest:!1,fragmentShader:iN,vertexShader:aN})).toneMapped=!1,e}return Object(A.a)(n,[{key:"inputBuffer",set:function(e){this.uniforms.inputBuffer.value=e}},{key:"setInputBuffer",value:function(e){this.uniforms.inputBuffer.value=e}},{key:"searchTexture",get:function(){return this.uniforms.searchTexture.value},set:function(e){this.uniforms.searchTexture.value=e}},{key:"areaTexture",get:function(){return this.uniforms.areaTexture.value},set:function(e){this.uniforms.areaTexture.value=e}},{key:"setLookupTextures",value:function(e,t){this.searchTexture=e,this.areaTexture=t}},{key:"orthogonalSearchSteps",get:function(){return Number(this.defines.MAX_SEARCH_STEPS_INT)},set:function(e){var t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}},{key:"setOrthogonalSearchSteps",value:function(e){this.orthogonalSearchSteps=e}},{key:"diagonalSearchSteps",get:function(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)},set:function(e){var t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}},{key:"setDiagonalSearchSteps",value:function(e){this.diagonalSearchSteps=e}},{key:"diagonalDetection",get:function(){return void 0===this.defines.DISABLE_DIAG_DETECTION},set:function(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}},{key:"isDiagonalDetectionEnabled",value:function(){return this.diagonalDetection}},{key:"setDiagonalDetectionEnabled",value:function(e){this.diagonalDetection=e}},{key:"cornerRounding",get:function(){return Number(this.defines.CORNER_ROUNDING)},set:function(e){var t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}},{key:"setCornerRounding",value:function(e){this.cornerRounding=e}},{key:"cornerDetection",get:function(){return void 0===this.defines.DISABLE_CORNER_DETECTION},set:function(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}},{key:"isCornerRoundingEnabled",value:function(){return this.cornerDetection}},{key:"setCornerRoundingEnabled",value:function(e){this.cornerDetection=e}},{key:"setSize",value:function(e,t){var n=this.uniforms;n.texelSize.value.set(1/e,1/t),n.resolution.value.set(e,t)}}]),n}(ia),sN=new aa,uN=null;var cN=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Pass",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new iu,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:sN;Object(E.a)(this,e),this.name=t,this.renderer=null,this.scene=n,this.camera=r,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}return Object(A.a)(e,[{key:"renderToScreen",get:function(){return!this.rtt},set:function(e){if(this.rtt===e){var t=this.getFullscreenMaterial();null!==t&&(t.needsUpdate=!0),this.rtt=!e}}},{key:"setRenderer",value:function(e){this.renderer=e}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(e){this.enabled=e}},{key:"fullscreenMaterial",get:function(){return null!==this.screen?this.screen.material:null},set:function(e){var t=this.screen;null!==t?t.material=e:((t=new Qi(function(){if(null===uN){var e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);void 0!==(uN=new Di).setAttribute?(uN.setAttribute("position",new wi(e,3)),uN.setAttribute("uv",new wi(t,2))):(uN.addAttribute("position",new wi(e,3)),uN.addAttribute("uv",new wi(t,2)))}return uN}(),e)).frustumCulled=!1,null===this.scene&&(this.scene=new iu),this.scene.add(t),this.screen=t)}},{key:"getFullscreenMaterial",value:function(){return this.fullscreenMaterial}},{key:"setFullscreenMaterial",value:function(e){this.fullscreenMaterial=e}},{key:"getDepthTexture",value:function(){return null}},{key:"setDepthTexture",value:function(e){}},{key:"render",value:function(e,t,n,r,i){throw new Error("Render method not implemented!")}},{key:"setSize",value:function(e,t){}},{key:"initialize",value:function(e,t,n){}},{key:"dispose",value:function(){for(var e=0,t=Object.keys(this);e<t.length;e++){var n=t[e],r=this[n];if(null!==r&&"function"==typeof r.dispose){if(r instanceof iu||r===this.renderer)continue;this[n].dispose()}}}}]),e}(),lN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object(E.a)(this,n),(r=t.call(this,"CopyPass")).fullscreenMaterial=new WL,r.needsSwap=!1,r.renderTarget=e,void 0===e&&(r.renderTarget=new Zn(1,1,{minFilter:Je,magFilter:Je,stencilBuffer:!1,depthBuffer:!1}),r.renderTarget.texture.name="CopyPass.Target"),r.autoResize=i,r}return Object(A.a)(n,[{key:"resize",get:function(){return this.autoResize},set:function(e){this.autoResize=e}},{key:"texture",get:function(){return this.renderTarget.texture}},{key:"getTexture",value:function(){return this.renderTarget.texture}},{key:"setAutoResizeEnabled",value:function(e){this.autoResize=e}},{key:"render",value:function(e,t,n,r,i){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}},{key:"setSize",value:function(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}},{key:"initialize",value:function(e,t,n){void 0!==n&&(this.renderTarget.texture.type=n,n!==tt?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===nn&&(this.renderTarget.texture.encoding=nn))}}]),n}(cN),hN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this,"ClearMaskPass",null,null)).needsSwap=!1,e}return Object(A.a)(n,[{key:"render",value:function(e,t,n,r,i){var a=e.state.buffers.stencil;a.setLocked(!1),a.setTest(!1)}}]),n}(cN),dN=new Gn,fN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(E.a)(this,n),(e=t.call(this,"ClearPass",null,null)).needsSwap=!1,e.color=r,e.depth=i,e.stencil=a,e.overrideClearColor=null,e.overrideClearAlpha=-1,e}return Object(A.a)(n,[{key:"setClearFlags",value:function(e,t,n){this.color=e,this.depth=t,this.stencil=n}},{key:"getOverrideClearColor",value:function(){return this.overrideClearColor}},{key:"setOverrideClearColor",value:function(e){this.overrideClearColor=e}},{key:"getOverrideClearAlpha",value:function(){return this.overrideClearAlpha}},{key:"setOverrideClearAlpha",value:function(e){this.overrideClearAlpha=e}},{key:"render",value:function(e,t,n,r,i){var a=this.overrideClearColor,o=this.overrideClearAlpha,s=e.getClearAlpha(),u=null!==a,c=o>=0;u?(dN.copy(e.getClearColor(dN)),e.setClearColor(a,c?o:s)):c&&e.setClearAlpha(o),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),u?e.setClearColor(dN,s):c&&e.setClearAlpha(s)}}]),n}(cN),pN=-1,vN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pN,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:pN,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Object(E.a)(this,n),(r=t.call(this)).resizable=e,r.base=new An(1,1),r.preferred=new An(i,a),r.target=r.preferred,r.s=o,r}return Object(A.a)(n,[{key:"width",get:function(){var e=this.base,t=this.preferred,n=this.scale;return t.width!==pN?t.width:t.height!==pN?Math.round(t.height*(e.width/Math.max(e.height,1))):Math.round(e.width*n)},set:function(e){this.preferredWidth=e}},{key:"height",get:function(){var e=this.base,t=this.preferred,n=this.scale;return t.height!==pN?t.height:t.width!==pN?Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):Math.round(e.height*n)},set:function(e){this.preferredHeight=e}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"scale",get:function(){return this.s},set:function(e){this.s!==e&&(this.s=e,this.preferred.setScalar(pN),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}},{key:"getScale",value:function(){return this.scale}},{key:"setScale",value:function(e){this.scale=e}},{key:"baseWidth",get:function(){return this.base.width},set:function(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}},{key:"getBaseWidth",value:function(){return this.base.width}},{key:"setBaseWidth",value:function(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}},{key:"baseHeight",get:function(){return this.base.height},set:function(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}},{key:"getBaseHeight",value:function(){return this.baseHeight}},{key:"setBaseHeight",value:function(e){this.baseHeight=e}},{key:"setBaseSize",value:function(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}},{key:"preferredWidth",get:function(){return this.preferred.width},set:function(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}},{key:"getPreferredWidth",value:function(){return this.preferredWidth}},{key:"setPreferredWidth",value:function(e){this.preferredWidth=e}},{key:"preferredHeight",get:function(){return this.preferred.height},set:function(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}},{key:"getPreferredHeight",value:function(){return this.preferredHeight}},{key:"setPreferredHeight",value:function(e){this.preferredHeight=e}},{key:"setPreferredSize",value:function(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}},{key:"copy",value:function(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}}],[{key:"AUTO_SIZE",get:function(){return pN}}]),n}(vn),mN=!1,gN=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object(E.a)(this,e),this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=function(e){if(e.isMesh){var n;if(e.material.flatShading)switch(e.material.side){case te:n=t.materialsFlatShadedDoubleSide;break;case ee:n=t.materialsFlatShadedBackSide;break;default:n=t.materialsFlatShaded}else switch(e.material.side){case te:n=t.materialsDoubleSide;break;case ee:n=t.materialsBackSide;break;default:n=t.materials}t.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=n[2]:e.isInstancedMesh?e.material=n[1]:e.material=n[0],++t.meshCount}}}return Object(A.a)(e,[{key:"setMaterial",value:function(e){if(this.disposeMaterials(),this.material=e,null!==e){for(var t=this.materials=[e.clone(),e.clone(),e.clone()],n=0,r=t;n<r.length;n++){var i=r[n];i.uniforms=Object.assign({},e.uniforms),i.side=$}t[2].skinning=!0,this.materialsBackSide=t.map((function(t){var n=t.clone();return n.uniforms=Object.assign({},e.uniforms),n.side=ee,n})),this.materialsDoubleSide=t.map((function(t){var n=t.clone();return n.uniforms=Object.assign({},e.uniforms),n.side=te,n})),this.materialsFlatShaded=t.map((function(t){var n=t.clone();return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n})),this.materialsFlatShadedBackSide=t.map((function(t){var n=t.clone();return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=ee,n})),this.materialsFlatShadedDoubleSide=t.map((function(t){var n=t.clone();return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=te,n}))}}},{key:"render",value:function(e,t,n){var r=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,mN){var i=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,n);var a,o=Object(j.a)(i);try{for(o.s();!(a=o.n()).done;){var s=a.value;s[0].material=s[1]}}catch(c){o.e(c)}finally{o.f()}this.meshCount!==i.size&&i.clear()}else{var u=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,n),t.overrideMaterial=u}e.shadowMap.enabled=r}},{key:"disposeMaterials",value:function(){if(null!==this.material){var e,t=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide),n=Object(j.a)(t);try{for(n.s();!(e=n.n()).done;){e.value.dispose()}}catch(r){n.e(r)}finally{n.f()}}}},{key:"dispose",value:function(){this.originalMaterials.clear(),this.disposeMaterials()}}],[{key:"workaroundEnabled",get:function(){return mN},set:function(e){mN=e}}]),e}(),yN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(E.a)(this,n),(i=t.call(this,"RenderPass",e,r)).needsSwap=!1,i.clearPass=new fN,i.overrideMaterialManager=null===a?null:new gN(a),i.ignoreBackground=!1,i.skipShadowMapUpdate=!1,i.selection=null,i}return Object(A.a)(n,[{key:"renderToScreen",get:function(){return Object(b.a)(Object(w.a)(n.prototype),"renderToScreen",this)},set:function(e){Object(u.a)(Object(w.a)(n.prototype),"renderToScreen",e,this,!0),this.clearPass.renderToScreen=e}},{key:"overrideMaterial",get:function(){var e=this.overrideMaterialManager;return null!==e?e.material:null},set:function(e){var t=this.overrideMaterialManager;null!==e?null!==t?t.setMaterial(e):this.overrideMaterialManager=new gN(e):null!==t&&(t.dispose(),this.overrideMaterialManager=null)}},{key:"getOverrideMaterial",value:function(){return this.overrideMaterial}},{key:"setOverrideMaterial",value:function(e){this.overrideMaterial=e}},{key:"clear",get:function(){return this.clearPass.enabled},set:function(e){this.clearPass.enabled=e}},{key:"getSelection",value:function(){return this.selection}},{key:"setSelection",value:function(e){this.selection=e}},{key:"isBackgroundDisabled",value:function(){return this.ignoreBackground}},{key:"setBackgroundDisabled",value:function(e){this.ignoreBackground=e}},{key:"isShadowMapDisabled",value:function(){return this.skipShadowMapUpdate}},{key:"setShadowMapDisabled",value:function(e){this.skipShadowMapUpdate=e}},{key:"getClearPass",value:function(){return this.clearPass}},{key:"render",value:function(e,t,n,r,i){var a=this.scene,o=this.camera,s=this.selection,u=o.layers.mask,c=a.background,l=e.shadowMap.autoUpdate,h=this.renderToScreen?null:t;null!==s&&o.layers.set(s.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||null!==this.clearPass.overrideClearColor)&&(a.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(h),null!==this.overrideMaterialManager?this.overrideMaterialManager.render(e,a,o):e.render(a,o),o.layers.mask=u,a.background=c,e.shadowMap.autoUpdate=l}}]),n}(cN),bN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=a.resolutionScale,s=void 0===o?1:o,u=a.width,c=void 0===u?vN.AUTO_SIZE:u,l=a.height,h=void 0===l?vN.AUTO_SIZE:l,d=a.renderTarget;Object(E.a)(this,n),(i=t.call(this,"DepthPass")).needsSwap=!1,i.renderPass=new yN(e,r,new Us({depthPacking:an}));var f=i.renderPass;f.skipShadowMapUpdate=!0,f.ignoreBackground=!0;var p=f.getClearPass();p.overrideClearColor=new Gn(16777215),p.overrideClearAlpha=1,i.renderTarget=d,void 0===i.renderTarget&&(i.renderTarget=new Zn(1,1,{minFilter:Ke,magFilter:Ke,stencilBuffer:!1}),i.renderTarget.texture.name="DepthPass.Target");var v=i.resolution=new vN(Object(x.a)(i),c,h,s);return v.addEventListener("change",(function(e){return i.setSize(v.baseWidth,v.baseHeight)})),i}return Object(A.a)(n,[{key:"texture",get:function(){return this.renderTarget.texture}},{key:"getTexture",value:function(){return this.renderTarget.texture}},{key:"getResolution",value:function(){return this.resolution}},{key:"getResolutionScale",value:function(){return this.resolution.scale}},{key:"setResolutionScale",value:function(e){this.resolution.scale=e}},{key:"render",value:function(e,t,n,r,i){var a=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,a)}},{key:"setSize",value:function(e,t){var n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height)}}]),n}(cN),wN=(new Float32Array([255/256/Math.pow(256,3),255/256/Math.pow(256,2),255/256/256,255/256]),{SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18}),xN=new Map([[wN.SKIP,null],[wN.ADD,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}"],[wN.ALPHA,"vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}"],[wN.AVERAGE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}"],[wN.COLOR_BURN,"float blend(const in float x,const in float y){return(y==0.0)? y : max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[wN.COLOR_DODGE,"float blend(const in float x,const in float y){return(y==1.0)? y : min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[wN.DARKEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}"],[wN.DIFFERENCE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}"],[wN.EXCLUSION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}"],[wN.LIGHTEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}"],[wN.MULTIPLY,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}"],[wN.DIVIDE,"float blend(const in float x,const in float y){return(y>0.0)? min(x/y,1.0): 1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[wN.NEGATION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}"],[wN.NORMAL,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}"],[wN.OVERLAY,"float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[wN.REFLECT,"float blend(const in float x,const in float y){return(y==1.0)? y : min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[wN.SCREEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}"],[wN.SOFT_LIGHT,"float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[wN.SUBTRACT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}"]]),ON=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Object(E.a)(this,n),(r=t.call(this)).f=e,r.opacity=new xl(i),r}return Object(A.a)(n,[{key:"getOpacity",value:function(){return this.opacity.value}},{key:"setOpacity",value:function(e){this.opacity.value=e}},{key:"blendFunction",get:function(){return this.f},set:function(e){this.f=e,this.dispatchEvent({type:"change"})}},{key:"getBlendFunction",value:function(){return this.blendFunction}},{key:"setBlendFunction",value:function(e){this.blendFunction=e}},{key:"getShaderCode",value:function(){return xN.get(this.blendFunction)}}]),n}(vn),kN={NONE:0,DEPTH:1,CONVOLUTION:2},_N=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=a.attributes,s=void 0===o?kN.NONE:o,u=a.blendFunction,c=void 0===u?wN.SCREEN:u,l=a.defines,h=void 0===l?new Map:l,d=a.uniforms,f=void 0===d?new Map:d,p=a.extensions,v=void 0===p?null:p,m=a.vertexShader,g=void 0===m?null:m;return Object(E.a)(this,n),(i=t.call(this)).name=e,i.renderer=null,i.attributes=s,i.fragmentShader=r,i.vertexShader=g,i.defines=h,i.uniforms=f,i.extensions=v,i.blendMode=new ON(c),i.blendMode.addEventListener("change",(function(e){return i.setChanged()})),i}return Object(A.a)(n,[{key:"getName",value:function(){return this.name}},{key:"setRenderer",value:function(e){this.renderer=e}},{key:"getDefines",value:function(){return this.defines}},{key:"getUniforms",value:function(){return this.uniforms}},{key:"getExtensions",value:function(){return this.extensions}},{key:"getBlendMode",value:function(){return this.blendMode}},{key:"getAttributes",value:function(){return this.attributes}},{key:"setAttributes",value:function(e){this.attributes=e,this.setChanged()}},{key:"getFragmentShader",value:function(){return this.fragmentShader}},{key:"setFragmentShader",value:function(e){this.fragmentShader=e,this.setChanged()}},{key:"getVertexShader",value:function(){return this.vertexShader}},{key:"setVertexShader",value:function(e){this.vertexShader=e,this.setChanged()}},{key:"setChanged",value:function(){this.dispatchEvent({type:"change"})}},{key:"setDepthTexture",value:function(e){}},{key:"update",value:function(e,t,n){}},{key:"setSize",value:function(e,t){}},{key:"initialize",value:function(e,t,n){}},{key:"dispose",value:function(){for(var e=0,t=Object.keys(this);e<t.length;e++){var n=t[e],r=this[n];if(null!==r&&"function"==typeof r.dispose){if(r instanceof iu||r===this.renderer)continue;this[n].dispose()}}}}]),n}(vn);function SN(e,t,n){var r,i=Object(j.a)(t);try{for(i.s();!(r=i.n()).done;){var a,o=r.value,s="$1"+e+o.charAt(0).toUpperCase()+o.slice(1),u=new RegExp("([^\\.])(\\b"+o+"\\b)","g"),c=Object(j.a)(n.entries());try{for(c.s();!(a=c.n()).done;){var l=a.value;null!==l[1]&&n.set(l[0],l[1].replace(u,s))}}catch(h){c.e(h)}finally{c.f()}}}catch(h){i.e(h)}finally{i.f()}}function EN(e,t,n,r,i,a,o){var s=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),u=void 0!==s.get("fragment")&&/mainImage/.test(s.get("fragment")),c=void 0!==s.get("fragment")&&/mainUv/.test(s.get("fragment")),l=[],h=[],d=!1,f=!1;if(void 0===s.get("fragment"))console.error("Missing fragment shader",t);else if(c&&0!==(o&kN.CONVOLUTION))console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(u||c){var p=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,m=JL.Section;if(c){var g="\t".concat(e,"MainUv(UV);\n");n.set(m.FRAGMENT_MAIN_UV,n.get(m.FRAGMENT_MAIN_UV)+g),d=!0}if(null!==s.get("vertex")&&/mainSupport/.test(s.get("vertex"))){var y="\t".concat(e,"MainSupport(");y+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(s.get("vertex"))?"vUv);\n":");\n",n.set(m.VERTEX_MAIN_SUPPORT,n.get(m.VERTEX_MAIN_SUPPORT)+y),l=l.concat(Object(v.a)(s.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)).map((function(e){return e[1]}))),h=h.concat(l).concat(Object(v.a)(s.get("vertex").matchAll(p)).map((function(e){return e[1]})))}h=h.concat(Object(v.a)(s.get("fragment").matchAll(p)).map((function(e){return e[1]}))),h=h.concat(Object(v.a)(t.defines.keys()).map((function(e){return e.replace(/\([\w\s,]*\)/g,"")}))),h=h.concat(Object(v.a)(t.uniforms.keys())),t.uniforms.forEach((function(t,n){return a.set(e+n.charAt(0).toUpperCase()+n.slice(1),t)})),t.defines.forEach((function(t,n){return i.set(e+n.charAt(0).toUpperCase()+n.slice(1),t)})),SN(e,h,i),SN(e,h,s);var b=t.blendMode;if(r.set(b.blendFunction,b),u){var w="".concat(e,"MainImage(color0, UV, ");0!==(o&kN.DEPTH)&&/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/.test(s.get("fragment"))&&(w+="depth, ",f=!0),w+="color1);\n\t";var x=e+"BlendOpacity";a.set(x,b.opacity),w+="color0 = blend".concat(b.blendFunction,"(color0, color1, ").concat(x,");\n\n\t"),n.set(m.FRAGMENT_MAIN_IMAGE,n.get(m.FRAGMENT_MAIN_IMAGE)+w),w="uniform float ".concat(x,";\n\n"),n.set(m.FRAGMENT_HEAD,n.get(m.FRAGMENT_HEAD)+w)}n.set(m.FRAGMENT_HEAD,n.get(m.FRAGMENT_HEAD)+s.get("fragment")+"\n"),null!==s.get("vertex")&&n.set(m.VERTEX_HEAD,n.get(m.VERTEX_HEAD)+s.get("vertex")+"\n")}else console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);return{varyings:l,transformedUv:d,readDepth:f}}var AN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;Object(E.a)(this,n);for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return(r=t.call(this,"EffectPass")).fullscreenMaterial=new JL(null,null,null,e),r.effects=a.sort((function(e,t){return t.attributes-e.attributes})),r.skipRendering=!1,r.uniformCount=0,r.varyingCount=0,r.minTime=1,r.maxTime=Number.POSITIVE_INFINITY,r}return Object(A.a)(n,[{key:"encodeOutput",get:function(){return this.fullscreenMaterial.encodeOutput},set:function(e){this.fullscreenMaterial.encodeOutput=e}},{key:"dithering",get:function(){return this.fullscreenMaterial.dithering},set:function(e){var t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}},{key:"verifyResources",value:function(){var e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}},{key:"updateMaterial",value:function(){var e,t=JL.Section,n=new Map([[t.FRAGMENT_HEAD,""],[t.FRAGMENT_MAIN_UV,""],[t.FRAGMENT_MAIN_IMAGE,""],[t.VERTEX_HEAD,""],[t.VERTEX_MAIN_SUPPORT,""]]),r=new Map,i=new Map,a=new Map,o=new Set,s=0,u=0,c=0,l=!1,h=!1,d=Object(j.a)(this.effects);try{for(d.s();!(e=d.n()).done;){var f=e.value;if(f.blendMode.blendFunction===wN.SKIP)c|=f.getAttributes()&kN.DEPTH;else if(0!==(c&f.getAttributes()&kN.CONVOLUTION))console.error("Convolution effects cannot be merged",f);else{c|=f.getAttributes();var p=EN("e"+s++,f,n,r,i,a,c);if(u+=p.varyings.length,l=l||p.transformedUv,h=h||p.readDepth,null!==f.extensions){var v,m=Object(j.a)(f.extensions);try{for(m.s();!(v=m.n()).done;){var g=v.value;o.add(g)}}catch(k){m.e(k)}finally{m.f()}}}}}catch(k){d.e(k)}finally{d.f()}var y,b=/\bblend\b/g,w=Object(j.a)(r.values());try{for(w.s();!(y=w.n()).done;){var x=y.value,O=x.getShaderCode().replace(b,"blend".concat(x.blendFunction));n.set(t.FRAGMENT_HEAD,n.get(t.FRAGMENT_HEAD)+O+"\n")}}catch(k){w.e(k)}finally{w.f()}if(0!==(c&kN.DEPTH)){if(h){n.set(t.FRAGMENT_MAIN_IMAGE,"float depth = readDepth(UV);\n\n\t"+n.get(t.FRAGMENT_MAIN_IMAGE))}this.needsDepthTexture=null===this.getDepthTexture()}else this.needsDepthTexture=!1;if(l){n.set(t.FRAGMENT_MAIN_UV,"vec2 transformedUv = vUv;\n"+n.get(t.FRAGMENT_MAIN_UV)),i.set("UV","transformedUv")}else i.set("UV","vUv");n.forEach((function(e,t,n){return n.set(t,e.trim().replace(/^#/,"\n#"))})),this.uniformCount=a.size,this.varyingCount=u,this.skipRendering=0===s,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(n).setExtensions(o).setUniforms(a).setDefines(i)}},{key:"recompile",value:function(){this.updateMaterial(),this.verifyResources()}},{key:"getDepthTexture",value:function(){return this.fullscreenMaterial.depthBuffer}},{key:"setDepthTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rn;this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;var n,r=Object(j.a)(this.effects);try{for(r.s();!(n=r.n()).done;){n.value.setDepthTexture(e,t)}}catch(i){r.e(i)}finally{r.f()}}},{key:"render",value:function(e,t,n,r,i){var a,o=Object(j.a)(this.effects);try{for(o.s();!(a=o.n()).done;){a.value.update(e,t,r)}}catch(u){o.e(u)}finally{o.f()}if(!this.skipRendering||this.renderToScreen){var s=this.fullscreenMaterial;s.inputBuffer=t.texture,s.time+=r,e.setRenderTarget(this.renderToScreen?null:n),e.render(this.scene,this.camera)}}},{key:"setSize",value:function(e,t){this.fullscreenMaterial.setSize(e,t);var n,r=Object(j.a)(this.effects);try{for(r.s();!(n=r.n()).done;){n.value.setSize(e,t)}}catch(i){r.e(i)}finally{r.f()}}},{key:"initialize",value:function(e,t,n){var r=this;this.renderer=e;var i,a=Object(j.a)(this.effects);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.initialize(e,t,n),o.addEventListener("change",(function(e){return r.handleEvent(e)}))}}catch(s){a.e(s)}finally{a.f()}this.updateMaterial(),this.verifyResources(),void 0!==n&&n!==tt&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},{key:"dispose",value:function(){Object(b.a)(Object(w.a)(n.prototype),"dispose",this).call(this);var e,t=Object(j.a)(this.effects);try{for(t.s();!(e=t.n()).done;){e.value.dispose()}}catch(r){t.e(r)}finally{t.f()}}},{key:"handleEvent",value:function(e){if("change"===e.type)this.recompile()}}]),n}(cN),jN=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],TN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=r.resolutionScale,a=void 0===i?.5:i,o=r.width,s=void 0===o?vN.AUTO_SIZE:o,u=r.height,c=void 0===u?vN.AUTO_SIZE:u,l=r.kernelSize,h=void 0===l?LN.LARGE:l;Object(E.a)(this,n),(e=t.call(this,"KawaseBlurPass")).renderTargetA=new Zn(1,1,{minFilter:Je,magFilter:Je,stencilBuffer:!1,depthBuffer:!1}),e.renderTargetA.texture.name="Blur.Target.A",e.renderTargetB=e.renderTargetA.clone(),e.renderTargetB.texture.name="Blur.Target.B";var d=e.resolution=new vN(Object(x.a)(e),s,c,a);return d.addEventListener("change",(function(t){return e.setSize(d.baseWidth,d.baseHeight)})),e.blurMaterial=new GL,e.ditheredBlurMaterial=new GL,e.ditheredBlurMaterial.uniforms.scale=e.blurMaterial.uniforms.scale,e.ditheredBlurMaterial.dithering=!0,e.dithering=!1,e.kernelSize=h,e}return Object(A.a)(n,[{key:"getResolution",value:function(){return this.resolution}},{key:"width",get:function(){return this.resolution.width},set:function(e){this.resolution.preferredWidth=e}},{key:"height",get:function(){return this.resolution.height},set:function(e){this.resolution.preferredHeight=e}},{key:"scale",get:function(){return this.blurMaterial.scale},set:function(e){this.blurMaterial.scale=e}},{key:"getScale",value:function(){return this.blurMaterial.scale}},{key:"setScale",value:function(e){this.blurMaterial.scale=e}},{key:"getKernelSize",value:function(){return this.kernelSize}},{key:"setKernelSize",value:function(e){this.kernelSize=e}},{key:"getResolutionScale",value:function(){return this.resolution.scale}},{key:"setResolutionScale",value:function(e){this.resolution.scale=e}},{key:"render",value:function(e,t,n,r,i){var a,o,s=this.scene,u=this.camera,c=this.renderTargetA,l=this.renderTargetB,h=jN[this.kernelSize],d=this.blurMaterial,f=t;for(this.fullscreenMaterial=d,a=0,o=h.length-1;a<o;++a){var p=0===(1&a)?c:l;d.kernel=h[a],d.inputBuffer=f.texture,e.setRenderTarget(p),e.render(s,u),f=p}this.dithering&&(d=this.ditheredBlurMaterial,this.fullscreenMaterial=d),d.kernel=h[a],d.inputBuffer=f.texture,e.setRenderTarget(this.renderToScreen?null:n),e.render(s,u)}},{key:"setSize",value:function(e,t){var n=this.resolution;n.setBaseSize(e,t);var r=n.width,i=n.height;this.renderTargetA.setSize(r,i),this.renderTargetB.setSize(r,i),this.blurMaterial.setSize(r,i),this.ditheredBlurMaterial.setSize(r,i)}},{key:"initialize",value:function(e,t,n){void 0!==n&&(this.renderTargetA.texture.type=n,this.renderTargetB.texture.type=n,n!==tt?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===nn&&(this.renderTargetA.texture.encoding=nn,this.renderTargetB.texture.encoding=nn))}}],[{key:"AUTO_SIZE",get:function(){return vN.AUTO_SIZE}}]),n}(cN),MN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=r.width,a=void 0===i?vN.AUTO_SIZE:i,o=r.height,s=void 0===o?vN.AUTO_SIZE:o,u=r.renderTarget,c=r.luminanceRange,l=r.colorOutput;Object(E.a)(this,n),(e=t.call(this,"LuminancePass")).fullscreenMaterial=new eN(l,c),e.needsSwap=!1,e.renderTarget=u,void 0===e.renderTarget&&(e.renderTarget=new Zn(1,1,{minFilter:Je,magFilter:Je,stencilBuffer:!1,depthBuffer:!1}),e.renderTarget.texture.name="LuminancePass.Target",e.renderTarget.texture.generateMipmaps=!1);var h=e.resolution=new vN(Object(x.a)(e),a,s);return h.addEventListener("change",(function(t){return e.setSize(h.baseWidth,h.baseHeight)})),e}return Object(A.a)(n,[{key:"texture",get:function(){return this.renderTarget.texture}},{key:"getTexture",value:function(){return this.renderTarget.texture}},{key:"getResolution",value:function(){return this.resolution}},{key:"render",value:function(e,t,n,r,i){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}},{key:"setSize",value:function(e,t){var n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height)}},{key:"initialize",value:function(e,t,n){void 0!==n&&n!==tt&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}}]),n}(cN),CN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;return Object(E.a)(this,n),(i=t.call(this,"MaskPass",e,r)).needsSwap=!1,i.clearPass=new fN(!1,!1,!0),i.inverse=!1,i}return Object(A.a)(n,[{key:"inverted",get:function(){return this.inverse},set:function(e){this.inverse=e}},{key:"clear",get:function(){return this.clearPass.enabled},set:function(e){this.clearPass.enabled=e}},{key:"getClearPass",value:function(){return this.clearPass}},{key:"isInverted",value:function(){return this.inverted}},{key:"setInverted",value:function(e){this.inverted=e}},{key:"render",value:function(e,t,n,r,i){var a=e.getContext(),o=e.state.buffers,s=this.scene,u=this.camera,c=this.clearPass,l=this.inverted?0:1,h=1-l;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),o.stencil.setFunc(a.ALWAYS,l,4294967295),o.stencil.setClear(h),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,n))),this.renderToScreen?(e.setRenderTarget(null),e.render(s,u)):(e.setRenderTarget(t),e.render(s,u),e.setRenderTarget(n),e.render(s,u)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(a.EQUAL,1,4294967295),o.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),o.stencil.setLocked(!0)}}]),n}(cN),DN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"inputBuffer";return Object(E.a)(this,n),(r=t.call(this,"ShaderPass")).fullscreenMaterial=e,r.inputBufferUniform=null,r.setInput(i),r}return Object(A.a)(n,[{key:"setInput",value:function(e){if(this.inputBufferUniform=null,null!==this.fullscreenMaterial){var t=this.fullscreenMaterial.uniforms;void 0!==t&&void 0!==t[e]&&(this.inputBufferUniform=t[e])}}},{key:"render",value:function(e,t,n,r,i){null!==this.inputBufferUniform&&null!==t&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:n),e.render(this.scene,this.camera)}},{key:"initialize",value:function(e,t,n){void 0!==n&&n!==tt&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}}]),n}(cN),IN=.001,PN=function(){function e(){Object(E.a)(this,e),this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}return Object(A.a)(e,[{key:"setFixedDeltaEnabled",value:function(e){return this.fixedDeltaEnabled=e,this}},{key:"isAutoResetEnabled",value:function(e){return this.autoReset}},{key:"setAutoResetEnabled",value:function(e){return typeof document<"u"&&void 0!==document.hidden&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}},{key:"getDelta",value:function(){return this.delta*IN}},{key:"getFixedDelta",value:function(){return this.fixedDelta*IN}},{key:"setFixedDelta",value:function(e){return this.fixedDelta=1e3*e,this}},{key:"getElapsed",value:function(){return this.elapsed*IN}},{key:"getTimescale",value:function(){return this.timescale}},{key:"setTimescale",value:function(e){return this.timescale=e,this}},{key:"update",value:function(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=void 0!==e?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}},{key:"reset",value:function(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}},{key:"handleEvent",value:function(e){document.hidden||(this.currentTime=performance.now())}},{key:"dispose",value:function(){this.setAutoResetEnabled(!1)}}]),e}(),RN=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.depthBuffer,i=void 0===r||r,a=n.stencilBuffer,o=void 0!==a&&a,s=n.multisampling,u=void 0===s?0:s,c=n.frameBufferType;Object(E.a)(this,e),this.renderer=null,this.inputBuffer=this.createBuffer(i,o,c,u),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new lN,this.depthTexture=null,this.passes=[],this.timer=new PN,this.autoRenderToScreen=!0,this.setRenderer(t)}return Object(A.a)(e,[{key:"multisampling",get:function(){return this.inputBuffer.samples||0},set:function(e){var t=this.inputBuffer,n=this.multisampling;n>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):n!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}},{key:"getTimer",value:function(){return this.timer}},{key:"getRenderer",value:function(){return this.renderer}},{key:"setRenderer",value:function(e){if(this.renderer=e,null!==e){var t=e.getSize(new An),n=e.getContext().getContextAttributes().alpha,r=this.inputBuffer.texture.type;r===tt&&e.outputEncoding===nn&&(this.inputBuffer.texture.encoding=nn,this.outputBuffer.texture.encoding=nn,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);var i,a=Object(j.a)(this.passes);try{for(a.s();!(i=a.n()).done;){i.value.initialize(e,n,r)}}catch(o){a.e(o)}finally{a.f()}}}},{key:"replaceRenderer",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.renderer,r=n.domElement.parentNode;return this.setRenderer(e),t&&null!==r&&(r.removeChild(n.domElement),r.appendChild(e.domElement)),n}},{key:"createDepthTexture",value:function(){var e=this.depthTexture=new Js;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=yt,e.type=ht):e.type=ot,e}},{key:"deleteDepthTexture",value:function(){if(null!==this.depthTexture){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();var e,t=Object(j.a)(this.passes);try{for(t.s();!(e=t.n()).done;){e.value.setDepthTexture(null)}}catch(n){t.e(n)}finally{t.f()}}}},{key:"createBuffer",value:function(e,t,n,r){var i,a=this.renderer,o=null===a?new An:a.getDrawingBufferSize(new An),s={minFilter:Je,magFilter:Je,stencilBuffer:t,depthBuffer:e,type:n};return r>0?((i=Number(W.replace(/\D+/g,""))<138?new Wl(o.width,o.height,s):new Zn(o.width,o.height,s)).ignoreDepthForMultisampleCopy=!1,i.samples=r):i=new Zn(o.width,o.height,s),n===tt&&null!==a&&a.outputEncoding===nn&&(i.texture.encoding=nn),i.texture.name="EffectComposer.Buffer",i.texture.generateMipmaps=!1,i}},{key:"addPass",value:function(e,t){var n=this.passes,r=this.renderer,i=r.getDrawingBufferSize(new An),a=r.getContext().getContextAttributes().alpha,o=this.inputBuffer.texture.type;if(e.setRenderer(r),e.setSize(i.width,i.height),e.initialize(r,a,o),this.autoRenderToScreen&&(n.length>0&&(n[n.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),void 0!==t?n.splice(t,0,e):n.push(e),this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!0),e.needsDepthTexture||null!==this.depthTexture)if(null===this.depthTexture){var s,u=this.createDepthTexture(),c=Object(j.a)(n);try{for(c.s();!(s=c.n()).done;)(e=s.value).setDepthTexture(u)}catch(l){c.e(l)}finally{c.f()}}else e.setDepthTexture(this.depthTexture)}},{key:"removePass",value:function(e){var t=this.passes,n=t.indexOf(e);if(-1!==n&&t.splice(n,1).length>0){if(null!==this.depthTexture){t.reduce((function(e,t){return e||t.needsDepthTexture}),!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&n===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}},{key:"removeAllPasses",value:function(){var e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}},{key:"render",value:function(e){var t,n,r,i=this.renderer,a=this.copyPass,o=this.inputBuffer,s=this.outputBuffer,u=!1;void 0===e&&(e=this.timer.update().getDelta());var c,l=Object(j.a)(this.passes);try{for(l.s();!(c=l.n()).done;){var h=c.value;h.enabled&&(h.render(i,o,s,e,u),h.needsSwap&&(u&&(a.renderToScreen=h.renderToScreen,t=i.getContext(),(n=i.state.buffers.stencil).setFunc(t.NOTEQUAL,1,4294967295),a.render(i,o,s,e,u),n.setFunc(t.EQUAL,1,4294967295)),r=o,o=s,s=r),h instanceof CN?u=!0:h instanceof hN&&(u=!1))}}catch(d){l.e(d)}finally{l.f()}}},{key:"setSize",value:function(e,t,n){var r=this.renderer;if(void 0===e||void 0===t){var i=r.getSize(new An);e=i.width,t=i.height}r.setSize(e,t,n);var a=r.getDrawingBufferSize(new An);this.inputBuffer.setSize(a.width,a.height),this.outputBuffer.setSize(a.width,a.height);var o,s=Object(j.a)(this.passes);try{for(s.s();!(o=s.n()).done;){o.value.setSize(a.width,a.height)}}catch(u){s.e(u)}finally{s.f()}}},{key:"reset",value:function(){var e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}},{key:"dispose",value:function(){var e,t=Object(j.a)(this.passes);try{for(t.s();!(e=t.n()).done;){e.value.dispose()}}catch(n){t.e(n)}finally{t.f()}this.passes=[],null!==this.inputBuffer&&this.inputBuffer.dispose(),null!==this.outputBuffer&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}}]),e}(),LN={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},NN="#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nuniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}",BN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=r.blendFunction,a=void 0===i?wN.SCREEN:i,o=r.luminanceThreshold,s=void 0===o?.9:o,u=r.luminanceSmoothing,c=void 0===u?.025:u,l=r.resolutionScale,h=void 0===l?.5:l,d=r.intensity,f=void 0===d?1:d,p=r.width,v=void 0===p?vN.AUTO_SIZE:p,m=r.height,g=void 0===m?vN.AUTO_SIZE:m,y=r.kernelSize,b=void 0===y?LN.LARGE:y;Object(E.a)(this,n),(e=t.call(this,"BloomEffect",NN,{blendFunction:a,uniforms:new Map([["map",new xl(null)],["intensity",new xl(f)]])})).renderTarget=new Zn(1,1,{minFilter:Je,magFilter:Je,stencilBuffer:!1,depthBuffer:!1}),e.renderTarget.texture.name="Bloom.Target",e.renderTarget.texture.generateMipmaps=!1,e.uniforms.get("map").value=e.renderTarget.texture,e.luminancePass=new MN({renderTarget:e.renderTarget,colorOutput:!0}),e.luminanceMaterial.threshold=s,e.luminanceMaterial.smoothingFactor=c,e.blurPass=new TN({resolutionScale:h,width:v,height:g,kernelSize:b});var w=e.blurPass.getResolution();return w.addEventListener("change",(function(t){return e.setSize(w.baseWidth,w.baseHeight)})),e}return Object(A.a)(n,[{key:"texture",get:function(){return this.renderTarget.texture}},{key:"getTexture",value:function(){return this.renderTarget.texture}},{key:"resolution",get:function(){return this.blurPass.resolution}},{key:"getResolution",value:function(){return this.blurPass.resolution}},{key:"getBlurPass",value:function(){return this.blurPass}},{key:"getLuminancePass",value:function(){return this.luminancePass}},{key:"luminanceMaterial",get:function(){return this.luminancePass.fullscreenMaterial}},{key:"getLuminanceMaterial",value:function(){return this.luminancePass.fullscreenMaterial}},{key:"width",get:function(){return this.resolution.width},set:function(e){this.resolution.preferredWidth=e}},{key:"height",get:function(){return this.resolution.height},set:function(e){this.resolution.preferredHeight=e}},{key:"dithering",get:function(){return this.blurPass.dithering},set:function(e){this.blurPass.dithering=e}},{key:"kernelSize",get:function(){return this.blurPass.kernelSize},set:function(e){this.blurPass.kernelSize=e}},{key:"distinction",get:function(){return console.warn(this.name,"distinction was removed"),1},set:function(e){console.warn(this.name,"distinction was removed")}},{key:"intensity",get:function(){return this.uniforms.get("intensity").value},set:function(e){this.uniforms.get("intensity").value=e}},{key:"getIntensity",value:function(){return this.intensity}},{key:"setIntensity",value:function(e){this.intensity=e}},{key:"getResolutionScale",value:function(){return this.resolution.scale}},{key:"setResolutionScale",value:function(e){this.resolution.scale=e}},{key:"update",value:function(e,t,n){var r=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,r),this.blurPass.render(e,r,r)):this.blurPass.render(e,t,r)}},{key:"setSize",value:function(e,t){var n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height),this.luminancePass.resolution.copy(n)}},{key:"initialize",value:function(e,t,n){this.blurPass.initialize(e,t,n),void 0!==n&&(this.renderTarget.texture.type=n,e.outputEncoding===nn&&(this.renderTarget.texture.encoding=nn))}}]),n}(_N),FN="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",UN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.blendFunction,i=void 0===r?wN.NORMAL:r,a=e.brightness,o=void 0===a?0:a,s=e.contrast,u=void 0===s?0:s;return Object(E.a)(this,n),t.call(this,"BrightnessContrastEffect",FN,{blendFunction:i,uniforms:new Map([["brightness",new xl(o)],["contrast",new xl(u)]])})}return Object(A.a)(n,[{key:"brightness",get:function(){return this.uniforms.get("brightness").value},set:function(e){this.uniforms.get("brightness").value=e}},{key:"getBrightness",value:function(e){return this.brightness}},{key:"setBrightness",value:function(e){this.brightness=e}},{key:"contrast",get:function(){return this.uniforms.get("contrast").value},set:function(e){this.uniforms.get("contrast").value=e}},{key:"getContrast",value:function(e){return this.contrast}},{key:"setContrast",value:function(e){this.contrast=e}}]),n}(_N),zN="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",VN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wN.NORMAL;return Object(E.a)(this,n),t.call(this,"ColorAverageEffect",zN,{blendFunction:e})}return Object(A.a)(n)}(_N),GN="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",HN="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",WN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.blendFunction,i=void 0===r?wN.NORMAL:r,a=e.offset,o=void 0===a?new An(.001,5e-4):a;return Object(E.a)(this,n),t.call(this,"ChromaticAberrationEffect",GN,{vertexShader:HN,blendFunction:i,attributes:kN.CONVOLUTION,uniforms:new Map([["offset",new xl(o)]])})}return Object(A.a)(n,[{key:"offset",get:function(){return this.uniforms.get("offset").value},set:function(e){this.uniforms.get("offset").value=e}},{key:"getOffset",value:function(){return this.offset}},{key:"setOffset",value:function(e){this.offset=e}}]),n}(_N),qN="#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;\n#else\nuniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;\n#endif\nuniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}",YN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.blendFunction,o=void 0===a?wN.NORMAL:a,s=i.worldFocusDistance,u=i.worldFocusRange,c=i.focusDistance,l=void 0===c?0:c,h=i.focalLength,d=void 0===h?.1:h,f=i.focusRange,p=void 0===f?d:f,v=i.bokehScale,m=void 0===v?1:v,g=i.width,y=void 0===g?vN.AUTO_SIZE:g,b=i.height,w=void 0===b?vN.AUTO_SIZE:b;Object(E.a)(this,n),(r=t.call(this,"DepthOfFieldEffect",qN,{blendFunction:o,attributes:kN.DEPTH,uniforms:new Map([["nearColorBuffer",new xl(null)],["farColorBuffer",new xl(null)],["nearCoCBuffer",new xl(null)],["scale",new xl(1)]])})).camera=e,r.renderTarget=new Zn(1,1,{minFilter:Je,magFilter:Je,stencilBuffer:!1,depthBuffer:!1}),r.renderTarget.texture.name="DoF.Intermediate",r.renderTarget.texture.generateMipmaps=!1,r.renderTargetMasked=r.renderTarget.clone(),r.renderTargetMasked.texture.name="DoF.Masked.Far",r.renderTargetNear=r.renderTarget.clone(),r.renderTargetNear.texture.name="DoF.Bokeh.Near",r.uniforms.get("nearColorBuffer").value=r.renderTargetNear.texture,r.renderTargetFar=r.renderTarget.clone(),r.renderTargetFar.texture.name="DoF.Bokeh.Far",r.uniforms.get("farColorBuffer").value=r.renderTargetFar.texture,r.renderTargetCoC=r.renderTarget.clone(),r.renderTargetCoC.texture.name="DoF.CoC",r.renderTargetCoCBlurred=r.renderTargetCoC.clone(),r.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",r.uniforms.get("nearCoCBuffer").value=r.renderTargetCoCBlurred.texture,r.cocPass=new DN(new UL(e));var x=r.cocMaterial;x.focusDistance=l,x.focusRange=p,void 0!==s&&(x.worldFocusDistance=s),void 0!==u&&(x.worldFocusRange=u),r.blurPass=new TN({kernelSize:LN.MEDIUM,width:y,height:w});var O=r.blurPass.getResolution();O.addEventListener("change",(function(e){return r.setSize(O.getBaseWidth(),O.getBaseHeight())})),r.maskPass=new DN(new rN(r.renderTargetCoC.texture));var k=r.maskPass.fullscreenMaterial;return k.maskFunction=nN.MULTIPLY,k.colorChannel=IL.GREEN,r.bokehNearBasePass=new DN(new LL(!1,!0)),r.bokehNearBasePass.fullscreenMaterial.cocBuffer=r.renderTargetCoCBlurred.texture,r.bokehNearFillPass=new DN(new LL(!0,!0)),r.bokehNearFillPass.fullscreenMaterial.cocBuffer=r.renderTargetCoCBlurred.texture,r.bokehFarBasePass=new DN(new LL(!1,!1)),r.bokehFarBasePass.fullscreenMaterial.cocBuffer=r.renderTargetCoC.texture,r.bokehFarFillPass=new DN(new LL(!0,!1)),r.bokehFarFillPass.fullscreenMaterial.cocBuffer=r.renderTargetCoC.texture,r.target=null,r.bokehScale=m,r}return Object(A.a)(n,[{key:"cocTexture",get:function(){return this.renderTargetCoC.texture}},{key:"cocMaterial",get:function(){return this.cocPass.fullscreenMaterial}},{key:"circleOfConfusionMaterial",get:function(){return this.cocMaterial}},{key:"getCircleOfConfusionMaterial",value:function(){return this.circleOfConfusionMaterial}},{key:"getBlurPass",value:function(){return this.blurPass}},{key:"resolution",get:function(){return this.blurPass.getResolution()}},{key:"getResolution",value:function(){return this.blurPass.getResolution()}},{key:"bokehScale",get:function(){return this.uniforms.get("scale").value},set:function(e){for(var t=0,n=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];t<n.length;t++){n[t].fullscreenMaterial.setScale(e)}this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}},{key:"getBokehScale",value:function(){return this.bokehScale}},{key:"setBokehScale",value:function(e){this.bokehScale=e}},{key:"getTarget",value:function(){return this.target}},{key:"setTarget",value:function(e){this.target=e}},{key:"calculateFocusDistance",value:function(e){var t=this.camera;return BL(-t.position.distanceTo(e),t.near,t.far)}},{key:"setDepthTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rn;this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}},{key:"update",value:function(e,t,n){var r=this.renderTarget,i=this.renderTargetCoC,a=this.renderTargetCoCBlurred,o=this.renderTargetMasked;if(null!==this.target){var s=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=s}this.cocPass.render(e,null,i),this.blurPass.render(e,i,a),this.maskPass.render(e,t,o),this.bokehFarBasePass.render(e,o,r),this.bokehFarFillPass.render(e,r,this.renderTargetFar),this.bokehNearBasePass.render(e,t,r),this.bokehNearFillPass.render(e,r,this.renderTargetNear)}},{key:"setSize",value:function(e,t){var n=this.resolution;n.setBaseSize(e,t);var r=n.width,i=n.height,a=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];a.push(this.renderTargetCoC,this.renderTargetMasked),a.forEach((function(n){return n.setSize(e,t)})),(a=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred]).forEach((function(e){return e.setSize(r,i)})),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach((function(e){return e.fullscreenMaterial.setSize(r,i)}))}},{key:"initialize",value:function(e,t,n){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach((function(r){return r.initialize(e,t,n)})),this.blurPass.initialize(e,t,tt),void 0!==n&&(this.renderTarget.texture.type=n,this.renderTargetNear.texture.type=n,this.renderTargetFar.texture.type=n,this.renderTargetMasked.texture.type=n,e.outputEncoding===nn&&(this.renderTarget.texture.encoding=nn,this.renderTargetNear.texture.encoding=nn,this.renderTargetFar.texture.encoding=nn,this.renderTargetMasked.texture.encoding=nn))}}]),n}(_N),XN=(new tr,new Dr,"uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}"),KN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=r.blendFunction,a=void 0===i?wN.NORMAL:i,o=r.hue,s=void 0===o?0:o,u=r.saturation,c=void 0===u?0:u;return Object(E.a)(this,n),(e=t.call(this,"HueSaturationEffect",XN,{blendFunction:a,uniforms:new Map([["hue",new xl(new tr)],["saturation",new xl(c)]])})).hue=s,e}return Object(A.a)(n,[{key:"saturation",get:function(){return this.uniforms.get("saturation").value},set:function(e){this.uniforms.get("saturation").value=e}},{key:"getSaturation",value:function(){return this.saturation}},{key:"setSaturation",value:function(e){this.saturation=e}},{key:"hue",get:function(){var e=this.uniforms.get("hue").value;return Math.acos((3*e.x-1)/2)},set:function(e){var t=Math.sin(e),n=Math.cos(e);this.uniforms.get("hue").value.set((2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3)}},{key:"getHue",value:function(){return this.hue}},{key:"setHue",value:function(e){this.hue=e}}]),n}(_N),QN=(new Gn,"void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));\n#ifdef PREMULTIPLY\noutputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);\n#else\noutputColor=vec4(noise,inputColor.a);\n#endif\n}"),ZN=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=r.blendFunction,a=void 0===i?wN.SCREEN:i,o=r.premultiply,s=void 0!==o&&o;return Object(E.a)(this,n),(e=t.call(this,"NoiseEffect",QN,{blendFunction:a})).premultiply=s,e}return Object(A.a)(n,[{key:"premultiply",get:function(){return this.defines.has("PREMULTIPLY")},set:function(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}},{key:"isPremultiplied",value:function(){return this.premultiply}},{key:"setPremultiplied",value:function(e){this.premultiply=e}}]),n}(_N),JN="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",$N=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;return Object(E.a)(this,n),(e=t.call(this,"PixelationEffect",JN,{uniforms:new Map([["active",new xl(!1)],["d",new xl(new An)]])})).resolution=new An,e.d=0,e.granularity=r,e}return Object(A.a)(n,[{key:"granularity",get:function(){return this.d},set:function(e){var t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}},{key:"getGranularity",value:function(){return this.granularity}},{key:"setGranularity",value:function(e){this.granularity=e}},{key:"setSize",value:function(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}}]),n}(_N),eB=(Math.PI,new tr,new tr,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC"),tB="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",nB="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",rB="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",iB={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},aB=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e,r,i,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=a.preset,s=void 0===o?iB.MEDIUM:o,u=a.edgeDetectionMode,c=void 0===u?XL.COLOR:u,l=a.predicationMode,h=void 0===l?KL.DISABLED:l;Object(E.a)(this,n),e=t.call(this,"SMAAEffect",nB,{vertexShader:rB,blendFunction:wN.NORMAL,attributes:kN.CONVOLUTION|kN.DEPTH,uniforms:new Map([["weightMap",new xl(null)]])}),arguments.length>1&&(r=arguments[0],i=arguments[1],arguments.length>2&&(s=arguments[2]),arguments.length>3&&(c=arguments[3])),e.renderTargetEdges=new Zn(1,1,{minFilter:Je,stencilBuffer:!1,depthBuffer:!1}),e.renderTargetEdges.texture.name="SMAA.Edges",e.renderTargetWeights=e.renderTargetEdges.clone(),e.renderTargetWeights.texture.name="SMAA.Weights",e.uniforms.get("weightMap").value=e.renderTargetWeights.texture,e.clearPass=new fN(!0,!1,!1),e.clearPass.overrideClearColor=new Gn(0),e.clearPass.overrideClearAlpha=1,e.edgeDetectionPass=new DN(new QL),e.edgeDetectionMaterial.edgeDetectionMode=c,e.edgeDetectionMaterial.predicationMode=h,e.weightsPass=new DN(new oN);var d=new Fc;return d.onLoad=function(){var t=new Kn(r);t.name="SMAA.Search",t.magFilter=Ke,t.minFilter=Ke,t.generateMipmaps=!1,t.needsUpdate=!0,t.flipY=!0,e.weightsMaterial.searchTexture=t;var n=new Kn(i);n.name="SMAA.Area",n.magFilter=Je,n.minFilter=Je,n.generateMipmaps=!1,n.needsUpdate=!0,n.flipY=!1,e.weightsMaterial.areaTexture=n,e.dispatchEvent({type:"load"})},d.itemStart("search"),d.itemStart("area"),void 0!==r&&void 0!==i?(d.itemEnd("search"),d.itemEnd("area")):typeof Image<"u"&&(r=new Image,i=new Image,r.addEventListener("load",(function(){return d.itemEnd("search")})),i.addEventListener("load",(function(){return d.itemEnd("area")})),r.src=eB,i.src=tB),e.applyPreset(s),e}return Object(A.a)(n,[{key:"edgesTexture",get:function(){return this.renderTargetEdges.texture}},{key:"getEdgesTexture",value:function(){return this.edgesTexture}},{key:"weightsTexture",get:function(){return this.renderTargetWeights.texture}},{key:"getWeightsTexture",value:function(){return this.weightsTexture}},{key:"edgeDetectionMaterial",get:function(){return this.edgeDetectionPass.fullscreenMaterial}},{key:"colorEdgesMaterial",get:function(){return this.edgeDetectionMaterial}},{key:"getEdgeDetectionMaterial",value:function(){return this.edgeDetectionMaterial}},{key:"weightsMaterial",get:function(){return this.weightsPass.fullscreenMaterial}},{key:"getWeightsMaterial",value:function(){return this.weightsMaterial}},{key:"setEdgeDetectionThreshold",value:function(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}},{key:"setOrthogonalSearchSteps",value:function(e){this.weightsMaterial.orthogonalSearchSteps=e}},{key:"applyPreset",value:function(e){var t=this.edgeDetectionMaterial,n=this.weightsMaterial;switch(e){case iB.LOW:t.edgeDetectionThreshold=.15,n.orthogonalSearchSteps=4,n.diagonalDetection=!1,n.cornerDetection=!1;break;case iB.MEDIUM:t.edgeDetectionThreshold=.1,n.orthogonalSearchSteps=8,n.diagonalDetection=!1,n.cornerDetection=!1;break;case iB.HIGH:t.edgeDetectionThreshold=.1,n.orthogonalSearchSteps=16,n.diagonalSearchSteps=8,n.cornerRounding=25,n.diagonalDetection=!0,n.cornerDetection=!0;break;case iB.ULTRA:t.edgeDetectionThreshold=.05,n.orthogonalSearchSteps=32,n.diagonalSearchSteps=16,n.cornerRounding=25,n.diagonalDetection=!0,n.cornerDetection=!0}}},{key:"setDepthTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rn;this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}},{key:"update",value:function(e,t,n){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}},{key:"setSize",value:function(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}},{key:"dispose",value:function(){var e=this.weightsMaterial,t=e.searchTexture,r=e.areaTexture;null!==t&&null!==r&&(t.dispose(),r.dispose()),Object(b.a)(Object(w.a)(n.prototype),"dispose",this).call(this)}}],[{key:"searchImageDataURL",get:function(){return eB}},{key:"areaImageDataURL",get:function(){return tB}}]),n}(_N),oB="uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;\n#if VIGNETTE_TECHNIQUE == 0\nfloat d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));\n#else\nvec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));\n#endif\noutputColor=vec4(color,inputColor.a);}",sB={DEFAULT:0,ESKIL:1},uB=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.blendFunction,i=void 0===r?wN.NORMAL:r,a=e.technique,o=void 0===a?sB.DEFAULT:a,s=(e.eskil,e.offset),u=void 0===s?.5:s,c=e.darkness,l=void 0===c?.5:c;return Object(E.a)(this,n),t.call(this,"VignetteEffect",oB,{blendFunction:i,defines:new Map([["VIGNETTE_TECHNIQUE",o.toFixed(0)]]),uniforms:new Map([["offset",new xl(u)],["darkness",new xl(l)]])})}return Object(A.a)(n,[{key:"technique",get:function(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))},set:function(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}},{key:"eskil",get:function(){return this.technique===sB.ESKIL},set:function(e){this.technique=e?sB.ESKIL:sB.DEFAULT}},{key:"getTechnique",value:function(){return this.technique}},{key:"setTechnique",value:function(e){this.technique=e}},{key:"offset",get:function(){return this.uniforms.get("offset").value},set:function(e){this.uniforms.get("offset").value=e}},{key:"getOffset",value:function(){return this.offset}},{key:"setOffset",value:function(e){this.offset=e}},{key:"darkness",get:function(){return this.uniforms.get("darkness").value},set:function(e){this.uniforms.get("darkness").value=e}},{key:"getDarkness",value:function(){return this.darkness}},{key:"setDarkness",value:function(e){this.darkness=e}}]),n}(_N);new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array(2),new Float32Array(2),new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125]),new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4]),new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3]),new Map([[lB(0,0,0,0),new Float32Array([0,0,0,0])],[lB(0,0,0,1),new Float32Array([0,0,0,1])],[lB(0,0,1,0),new Float32Array([0,0,1,0])],[lB(0,0,1,1),new Float32Array([0,0,1,1])],[lB(0,1,0,0),new Float32Array([0,1,0,0])],[lB(0,1,0,1),new Float32Array([0,1,0,1])],[lB(0,1,1,0),new Float32Array([0,1,1,0])],[lB(0,1,1,1),new Float32Array([0,1,1,1])],[lB(1,0,0,0),new Float32Array([1,0,0,0])],[lB(1,0,0,1),new Float32Array([1,0,0,1])],[lB(1,0,1,0),new Float32Array([1,0,1,0])],[lB(1,0,1,1),new Float32Array([1,0,1,1])],[lB(1,1,0,0),new Float32Array([1,1,0,0])],[lB(1,1,0,1),new Float32Array([1,1,0,1])],[lB(1,1,1,0),new Float32Array([1,1,1,0])],[lB(1,1,1,1),new Float32Array([1,1,1,1])]]);function cB(e,t,n){return e+(t-e)*n}function lB(e,t,n,r){var i=cB(e,t,.75),a=cB(n,r,.75);return cB(i,a,.875)}var hB=Object(A.a)((function e(t,n){Object(E.a)(this,e),this.enabled=!1,this.effect=new t(n),Object.defineProperty(this,"opacity",{enumerable:!0,set:function(e){this.effect.blendMode.opacity.value=e},get:function(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set:function(e){this.effect.blendMode.setBlendFunction(Number(e))},get:function(){return this.effect.blendMode.blendFunction}}),this.blendFunction=wN.NORMAL})),dB=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this,BN)).blendFunction=wN.SCREEN,e}return Object(A.a)(n,[{key:"intensity",get:function(){return this.effect.intensity},set:function(e){this.effect.intensity=e}},{key:"luminanceThreshold",get:function(){return this.effect.luminanceMaterial.threshold},set:function(e){this.effect.luminanceMaterial.threshold=e}},{key:"luminanceSmoothing",get:function(){return this.effect.luminanceMaterial.smoothing},set:function(e){this.effect.luminanceMaterial.smoothing=e}},{key:"blurScale",get:function(){return this.effect.blurPass.scale},set:function(e){this.effect.blurPass.scale=e}},{key:"kernelSize",get:function(){return this.effect.blurPass.kernelSize},set:function(e){this.effect.blurPass.kernelSize=e}}]),n}(hB),fB=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.call(this,UN)}return Object(A.a)(n,[{key:"contrast",get:function(){return this.effect.uniforms.get("contrast").value},set:function(e){this.effect.uniforms.get("contrast").value=e}},{key:"brightness",get:function(){return this.effect.uniforms.get("brightness").value},set:function(e){this.effect.uniforms.get("brightness").value=e}}]),n}(hB),pB=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this,WN)).effect.offset=new An(.01,.01),e}return Object(A.a)(n,[{key:"offset",get:function(){return[1e3*this.effect.offset.x,1e3*this.effect.offset.y]},set:function(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}}]),n}(hB),vB=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.call(this,VN)}return Object(A.a)(n)}(hB),mB=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this,KN))._hue=0,e}return Object(A.a)(n,[{key:"hue",get:function(){return this._hue},set:function(e){this._hue=e,this.effect.setHue(e)}},{key:"saturation",get:function(){return this.effect.uniforms.get("saturation").value},set:function(e){this.effect.uniforms.get("saturation").value=e}}]),n}(hB),gB=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this,ZN)).blendFunction=wN.OVERLAY,e}return Object(A.a)(n)}(hB),yB=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.call(this,uB)}return Object(A.a)(n,[{key:"eskil",get:function(){return this.effect.eskil},set:function(e){this.effect.eskil=e}},{key:"darkness",get:function(){return this.effect.uniforms.get("darkness").value},set:function(e){this.effect.uniforms.get("darkness").value=e}},{key:"offset",get:function(){return this.effect.uniforms.get("offset").value},set:function(e){this.effect.uniforms.get("offset").value=e}}]),n}(hB),bB=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){return Object(E.a)(this,n),t.call(this,YN,e)}return Object(A.a)(n,[{key:"focalLength",get:function(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value},set:function(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e}},{key:"focusDistance",get:function(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value},set:function(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=e}},{key:"bokehScale",get:function(){return this.effect.bokehScale},set:function(e){this.effect.bokehScale=e}}]),n}(hB),wB=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(){return Object(E.a)(this,n),t.call(this,$N)}return Object(A.a)(n,[{key:"granularity",get:function(){return this.effect.getGranularity()},set:function(e){this.effect.setGranularity(e)}}]),n}(hB),xB=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r,i){var a;return Object(E.a)(this,n),(a=t.call(this,"TransmissionPass",e,r)).copyPass=new lN(i.transmissionRenderTarget),a.depthPass=new bN(e,r,{renderTarget:i.transmissionDepthTarget}),a.needsSwap=!1,a}return Object(A.a)(n,[{key:"updatePasses",value:function(e){this.copyPass=new lN(e.transmissionRenderTarget),this.depthPass=new bN(this.scene,this.camera,{renderTarget:e.transmissionDepthTarget})}},{key:"setCamera",value:function(e){this.camera=e}},{key:"setScene",value:function(e){this.scene=e}},{key:"render",value:function(e,t,n){var r=this.camera.layers.mask;this.copyPass.render(e,t,n),this.camera.layers.disable(3),this.depthPass.render(e,t,n),e.shadowMap.needsUpdate=!1,e.shadowMap.autoUpdate=!1;var i=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(i),e.render(this.scene,this.camera),this.camera.layers.mask=r}}]),n}(cN),OB=new iu,kB=new ia({transparent:!0,vertexShader:"\n        void main() {\n            gl_Position = vec4(0.0);\n        }\n    ",fragmentShader:"\n        void main() {\n            gl_FragColor = vec4(0.0);\n        }\n    "}),_B=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e,r){var i;return Object(E.a)(this,n),(i=t.call(this,"OpaquePass",null!==e&&void 0!==e?e:OB,r)).hasTransmissionPass=!1,i.clear=!0,i.needsSwap=!1,i.originalMaterials=new Map,i}return Object(A.a)(n,[{key:"setCamera",value:function(e){this.camera=e}},{key:"setScene",value:function(e){this.scene=null!==e&&void 0!==e?e:OB}},{key:"getScene",value:function(){return this.scene}},{key:"render",value:function(e,t){var n=this;this.originalMaterials.clear(),this.camera.layers.enable(3),this.hasTransmissionPass&&this.scene.traverse((function(e){e.layers.isEnabled(3)&&e instanceof rA&&(n.originalMaterials.set(e.id,e.material),e.material=kB)})),this.camera.layers.enable(8),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0;var r=this.renderToScreen?null:t;e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),this.hasTransmissionPass&&this.originalMaterials.forEach((function(e,t){var r=n.scene.getObjectById(t);r&&(r.material=e)}))}}]),n}(cN);function SB(e,t){return t&&t.enabled&&e.push(t.effect),e}var EB=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this)).postprocessingState=Lw.defaultData,r._scene=new iu,r._camera=new qM,r.effects=new Map,r._renderToScreen=!0,r.clock=new sl,r.renderer=e,r.debug=!1,r.effects.set("bloom",new dB),r.effects.set("chromaticAberration",new pB),r.effects.set("vignette",new yB),r.effects.set("noise",new gB),r.effects.set("colorAverage",new vB),r.effects.set("hueSaturation",new mB),r.effects.set("brightnessContrast",new fB),r.effects.set("depthOfField",new bB),r.effects.set("pixelation",new wB),r.effectComposer=new RN(r.renderer),r.opaquePass=new _B(r.scene,r.camera),r.transmissionPass=new xB(r.scene,r.camera,r.renderer),r.helperPass=new _B(void 0,r.camera),r.helperPass.hasTransmissionPass=!1,r.helperPass.clear=!1,r.helperClearPass=new fN(!1,!0,!1),r.helperPassOnTop=new _B(void 0,r.camera),r.helperPassOnTop.hasTransmissionPass=!1,r.helperPassOnTop.clear=!1,r._initCopyPass(),r._initSmaa(),r._initPasses(),r}return Object(A.a)(n,[{key:"scene",get:function(){return this._scene},set:function(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e)}},{key:"sceneHelpers",get:function(){return this.helperPass.getScene()},set:function(e){this.helperPass.setScene(e)}},{key:"sceneHelpersOnTop",get:function(){return this.helperPassOnTop.getScene()},set:function(e){this.helperPassOnTop.setScene(e)}},{key:"camera",get:function(){return this._camera},set:function(e){this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}},{key:"setTransmissionPassEnabled",value:function(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}},{key:"disableHelpers",value:function(){this.helperPass.enabled=!1,this.helperClearPass.enabled=!1,this.helperPassOnTop.enabled=!1}},{key:"enableHelpers",value:function(){this.helperPass.enabled=!0,this.helperClearPass.enabled=!0,this.helperPassOnTop.enabled=!0}},{key:"_initSmaa",value:function(){var e=this,t=new aB({preset:iB.ULTRA,edgeDetectionMode:XL.COLOR});t.addEventListener("load",(function n(){t.removeEventListener("load",n),e.dispatchEvent({type:"smaaloaded"})})),t.edgeDetectionMaterial.predicationMode=KL.DEPTH,t.edgeDetectionMaterial.edgeDetectionThreshold=.05,t.edgeDetectionMaterial.predicationThreshold=.002,t.edgeDetectionMaterial.predicationScale=1,this.smaaPass=new AN(this.camera,t)}},{key:"_initPasses",value:function(){var e,t;if(null!==(e=this.uvEffectPass)&&void 0!==e&&e.dispose(),null!==(t=this.effectPass)&&void 0!==t&&t.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.postprocessingState.enabled){var n=[this.effects.get("pixelation")].reduce(SB,[]);n.length>0&&(this.uvEffectPass=Object(l.a)(AN,[this.camera].concat(Object(v.a)(n))),this.effectComposer.addPass(this.uvEffectPass));var r=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(SB,[]);r.length>0&&(this.effectPass=Object(l.a)(AN,[this.camera].concat(Object(v.a)(r))),this.effectComposer.addPass(this.effectPass))}this.effectComposer.addPass(this.helperPass),this.effectComposer.addPass(this.helperClearPass),this.effectComposer.addPass(this.helperPassOnTop),this.effectComposer.addPass(this.smaaPass)}},{key:"_initCopyPass",value:function(){if(!this._savePass){var e=new An;this.renderer.getDrawingBufferSize(e),this._rt=new Zn(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:qe,wrapT:qe}),this._rt.samples=0,this._savePass=new lN(this._rt,!1),this._savePass.renderToScreen=!1}}},{key:"renderToScreen",get:function(){return this._renderToScreen},set:function(e){if(this._renderToScreen!==e){var t=this.effectComposer;!t||(!0===e?(t.removePass(this._savePass),t.passes[t.passes.length-1].renderToScreen=!0,t.autoRenderToScreen=!0):(t.autoRenderToScreen=!1,t.passes[t.passes.length-1].renderToScreen=!1,this._savePass.renderToScreen=!1,this.postprocessingState.enabled||(this._savePass.needsDepthTexture=!0),t.addPass(this._savePass)),this._renderToScreen=e)}}},{key:"texture",get:function(){return this._rt&&this._rt.texture}},{key:"renderTarget",get:function(){return this._rt}},{key:"updatePostprocessing",value:function(e){var t=e.enabled,n=Object(h.a)(e,I),r=!1;t!==this.postprocessingState.enabled&&(r=!0);for(var i=0,a=Object.entries(n);i<a.length;i++){var o=a[i],s=o[1],u=this.effects.get(o[0]);if(u){u.enabled!==s.enabled&&(r=!0),u.enabled=s.enabled;for(var c=0,l=Object.entries(s);c<l.length;c++){var d=Object(g.a)(l[c],2),f=d[0],p=d[1];u[f]=p}}}this.postprocessingState=e,r&&this._initPasses()}},{key:"render",value:function(){this.effectComposer.render(this.clock.getDelta())}},{key:"setScissor",value:function(e,t,n,r){e instanceof Qn?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,n,r),this.effectComposer.outputBuffer.scissor.set(e,t,n,r));var i=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(i),this.effectComposer.outputBuffer.scissor.multiplyScalar(i),this.renderer.setScissor(e,t,n,r)}},{key:"setScissorTest",value:function(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}},{key:"setViewport",value:function(e,t,n,r){e instanceof Qn?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,n,r),this.effectComposer.outputBuffer.viewport.set(e,t,n,r))}},{key:"resize",value:function(e,t,n){if(this.effectComposer.setSize(e,t,n),this._rt){var r=this.renderer.getPixelRatio();this._rt.setSize(e*r,t*r)}}},{key:"dispose",value:function(){var e,t;null!==(e=this.uvEffectPass)&&void 0!==e&&e.dispose(),null!==(t=this.effectPass)&&void 0!==t&&t.dispose(),this.effectComposer.dispose()}}]),n}(vn),AB=new Kn,jB=function(e){Object(O.a)(n,e);var t=Object(k.a)(n);function n(e){var r;Object(E.a)(this,n),(r=t.call(this,e))._pixelRatio=r.getPixelRatio(),r.viewportWidth=1,r.viewportHeight=1,r.resolution=new An,r.pipeline=new EB(Object(x.a)(r)),r.overrideTransmission=null===e||void 0===e?void 0:e.overrideTransmission,r.autoClear=!1;var i=r.setPixelRatio.bind(Object(x.a)(r)),a=r.setSize.bind(Object(x.a)(r));return r.setPixelRatio=function(e){r._pixelRatio=e,i(e)},r.setSize=function(e,t){var n,i,o,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];(r.viewportWidth!==e||r.viewportHeight!==t)&&(r.viewportWidth=e,r.viewportHeight=t,a(e,t,s),null!==(n=r.normalRenderTarget)&&void 0!==n&&n.setSize(e*r._pixelRatio,t*r._pixelRatio),null!==(i=r.transmissionRenderTarget)&&void 0!==i&&i.setSize(e*r._pixelRatio/2,t*r._pixelRatio/2),null!==(o=r.transmissionDepthTarget)&&void 0!==o&&o.setSize(e*r._pixelRatio/2,t*r._pixelRatio/2),r.pipeline.resize(e,t,s))},r._superDispose=r.dispose,r.dispose=r._currentDispose,r}return Object(A.a)(n,[{key:"createTransmissionRenderTarget",value:function(){void 0===this.transmissionRenderTarget&&(this.transmissionRenderTarget=new Zn(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{generateMipmaps:!0,minFilter:et,magFilter:Je,wrapS:Ye,wrapT:Ye,depthBuffer:!1}),this.transmissionDepthTarget=new Zn(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:Ke,magFilter:Ke,depthBuffer:!1}))}},{key:"createNormalRenderTarget",value:function(){void 0===this.normalRenderTarget&&(this.normalRenderTarget=new Zn(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Ke,magFilter:Ke,type:st,depthTexture:new Js(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}},{key:"renderNormal",value:function(e,t){this.normalRenderTarget&&(this.setClearColor(0),t.layers.enable(8),t.layers.disable(0),t.layers.disable(3),this.setRenderTarget(this.normalRenderTarget),this.clear(),IC.uniforms.depthContrast.value=t instanceof qM?(t.far-t.near)/1e4:1,e.overrideMaterial=IC,this.render(e,t),this.setClearColor(e.bgColor,e.bgColor.a),this.setRenderTarget(null),e.overrideMaterial=e.wireframeState?PC:null,t.layers.enable(0),t.layers.enable(3))}},{key:"renderSplineScene",value:function(e,t,n,r,i){this.setClearColor(e.bgColor,e.bgColor.a),n.penumbraSize.forEach((function(e,t){$A.penumbraSize.value[t]=e})),$A.pixelRatioNode.value=this.getPixelRatio(),0!==this.resolution.x&&0!==this.resolution.y?$A.resolution.value.set(this.resolution.x,this.resolution.y):$A.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),void 0!==this.overrideNormal?($A.normalRenderTarget.value=this.overrideNormal,$A.normalRenderTargetDepth.value=AB):e.needsNormal()&&(this.createNormalRenderTarget(),$A.normalRenderTarget.value=this.normalRenderTarget.texture,$A.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(e,t));var a=!1;if(void 0!==this.overrideTransmission)$A.transmissionRenderTarget.value=this.overrideTransmission,$A.transmissionRenderTargetDepth.value=AB,this.pipeline.setTransmissionPassEnabled(!1);else{var o=e.needsTransmission();o&&(void 0===this.transmissionRenderTarget&&(a=!0),this.createTransmissionRenderTarget(),$A.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,$A.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(o)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=r,this.pipeline.sceneHelpersOnTop=i,this.pipeline.scene=e,this.pipeline.camera=t,a&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==e.postprocessing&&this.pipeline.updatePostprocessing(e.postprocessing),void 0!==this.clearAlphaOverride&&this.setClearAlpha(this.clearAlphaOverride),e.overrideMaterial=e.wireframeState?PC:null,this.pipeline.render()}},{key:"_currentDispose",value:function(){var e,t,n,r,i;this._superDispose(),this.pipeline.dispose(),null!==(e=this.transmissionRenderTarget)&&void 0!==e&&e.dispose(),null!==(t=this.transmissionDepthTarget)&&void 0!==t&&t.dispose(),null!==(n=this.normalRenderTarget)&&void 0!==n&&n.dispose(),null===(r=this.normalRenderTarget)||void 0===r||null===(i=r.depthTexture)||void 0===i||i.dispose()}}]),n}(tu),TB=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(E.a)(this,e),this.shared=new LT(t.shared,n),this.scene=new NC(t.scene,this.sharedAssets),this.scene.switchActiveCamera(this.scene.activeCamera)}return Object(A.a)(e,[{key:"sharedAssets",get:function(){return this.shared}},{key:"reset",value:function(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}},{key:"dispose",value:function(){this.scene.dispose(),this.shared.dispose()}},{key:"gc",value:function(){var e=this;this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity((function(t){t instanceof BT&&t.markGeometryAsReachable(e.shared)})),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}}]),e}(),MB=function(){function e(t){var n=t.x,r=void 0===n?10:n,i=t.y,a=void 0===i?10:i;Object(E.a)(this,e),this._startTime=0;var o=document.getElementById("spe-perfs");o?this.element=o:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left="".concat(r,"px"),this.element.style.top="".concat(a,"px")}return Object(A.a)(e,[{key:"dispose",value:function(){var e;null===(e=this.element.parentElement)||void 0===e||e.removeChild(this.element)}},{key:"start",value:function(){this._startTime=performance.now()}},{key:"end",value:function(){var e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}}]),e}();function CB(e){var t;if(e.index)for(var n=0;n<e.index.array.length;n+=3)t=e.index.array[n],e.index.array[n]=e.index.array[n+2],e.index.array[n+2]=t}function DB(e){return e instanceof HT?"SubdivObject":"NonParametricGeometry"===e.geometry.type?"NonParametric":"Mesh"}function IB(e,t){for(var n=function(e,t){var n={};return e.traverseEntity((function(e){if(e.visible&&e instanceof rA&&"Mesh"===e.type&&!Array.isArray(e.material)&&(!e.states||!Object.keys(e.states).length)){for(var r=e.parent;r;){if(r instanceof rA&&e.states&&Object.keys(e.states).length)return;r=r.parent}var i=e.material.uuid,a=t.shared.materials[i];if(a){if(!Qw.isMergable(a))return}else{var o,s=null===(o=t.scene.objects.get(e.uuid))||void 0===o?void 0:o.data;if(s&&"material"in s&&"string"!=typeof s.material){if(!Qw.isMergable(s.material))return;i=Qw.getHash(s.material)}}n[i]||(n[i]={});var u=n[i][DB(e)];if(u){if(u.push(e),e.cloner){var c,l=Object(j.a)(e.cloner.children);try{for(l.s();!(c=l.n()).done;){var h=c.value;u.push(h)}}catch(v){l.e(v)}finally{l.f()}}}else if(n[i][DB(e)]=[e],e.cloner){var d,f=Object(j.a)(e.cloner.children);try{for(f.s();!(d=f.n()).done;){var p=d.value;n[i][DB(e)].push(p)}}catch(v){f.e(v)}finally{f.f()}}}})),n}(t,e),r=function(e){var t=0;return Object.values(e).forEach((function(e){Object.values(e).forEach((function(e){var n=e.length;n>t&&(t=n)}))})),t}(n),i=new Array(r),a=0,o=new Array(r),s=0,u=new Array(r),c=0,l=new Array(r),h=0,d=0,f=Object.entries(n);d<f.length;d++)for(var p=Object(g.a)(f[d],2),v=p[0],m=p[1],y=function(){var e=w[b];if(s=0,c=0,e.forEach((function(e){e instanceof rA&&(o[s++]=e.geometry.clone(),u[c++]=e)})),c<2)return"continue";for(var r=0;r<c;r++)u[r].updateWorldMatrix(!0,!1),o[r].applyMatrix4(u[r].matrixWorld),u[r].matrixWorld.determinant()<0&&CB(o[r]);var d=eO(o.slice(0,s),!1);if(d){var f;if("SubdivObject"===v)console.warn("Turning subdiv object into mesh"),f=new Qi(d,u[0].material);else f=new Qi(d,u[0].material);f.castShadow=u[0].castShadow,f.receiveShadow=u[0].receiveShadow,t.add(f);for(var p=function e(r){h=0;var i,a=Object(j.a)(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.children&&e(o.children),o instanceof rA&&(Array.isArray(o.material)||n[o.material.uuid]&&n[o.material.uuid][DB(o)]&&n[o.material.uuid][DB(o)].length>1||(l[h++]=o))}}catch(u){a.e(u)}finally{a.f()}for(var s=0;s<h;s++)t.attach(l[s])},m=0;m<c;m++){var g=u[m];p(g.children),i[a++]=g}}},b=0,w=Object.values(m);b<w.length;b++)y();for(var x=0;x<a;x++)i[x].removeFromParent()}var PB=new An;function RB(e){var t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)}var LB=function(){function e(t){var n=this,r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).renderOnDemand,i=void 0===r||r;Object(E.a)(this,e),this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._lastTime=performance.now(),this.time=performance.now(),this.dt=0,this._skipRender=!1,this.renderOnDemand=!0,this.disposed=!1,this.requestRender=function(){n._skipRender=!1},this.render=function(e){var t,r,i,a;!n._renderer||(n._rafId=requestAnimationFrame(n.render),n.time=e,n.dt=n.time-n._lastTime,n._lastTime=n.time,null!==(t=n._perfs)&&void 0!==t&&t.start(),(!n.renderOnDemand||!n._skipRender)&&(n._skipRender=null===(r=null===(i=n._controls)||void 0===i?void 0:i.update(n.dt))||void 0===r||r,n._eventManager&&(n._eventManager.isEnable||n._eventManager.activate(),n._eventManager.handlers.Follow.onAnimationFrameDamping(),n._eventManager.handlers.LookAt.onAnimationFrameDamping(),(n._eventManager.handlers.Start.hasVideoAction||n._eventManager.handlers.Basic.hasVideoAction||n._eventManager.handlers.Conditional.hasVideoAction)&&(n._skipRender=!1)),n._scene&&n._camera&&n._renderer.renderSplineScene(n._scene,n._camera,n._sharedAssetsManager),null===(a=n._perfs)||void 0===a||a.end()))},this._resize=jg((function(){var e,t,r;!n._renderer||(1===n._viewportMode&&n._frameView&&(n._frameView.frameSize=PB.set(n._viewportWidth,n._viewportHeight)),n._renderer.setSize(n._viewportWidth,n._viewportHeight,!1),1!==n._viewportMode&&null!==(e=n._frameView)&&void 0!==e&&e.updateViewport(),n._camera&&(null!==(t=n._frameView)&&void 0!==t&&t.updateCamera(),"PerspectiveCamera"===n._camera.cameraType&&1===n._viewportMode&&(n._camera.aspect=n._viewportWidth/n._viewportHeight),n._camera.updateProjectionMatrix()),null!==(r=n._eventManager)&&void 0!==r&&r.resize(),n.requestRender())}),10),this.canvas=t,this.renderOnDemand=i,window.location.search.includes("perfs")&&(this._perfs=new MB({x:10,y:10})),function(e){e.addEventListener("pointerdown",Rx,!0),e.addEventListener("pointerdown",Nx,!0),e.addEventListener("pointermove",Nx,!0),e.addEventListener("pointerup",Lx,!0),e.addEventListener("pointercancel",Lx,!0),e.addEventListener("pointerleave",Lx,!0),window.addEventListener("keydown",Fx,!0),window.addEventListener("keyup",Ux,!0)}(t)}return Object(A.a)(e,[{key:"load",value:function(){var e=Object(m.a)(Object(S.a)().mark((function e(t,n){var r;return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return RB(t),e.next=3,fetch(t,n);case 3:return e.next=5,e.sent.arrayBuffer();case 5:return r=e.sent,e.next=8,this.start(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"start",value:function(){var e=Object(m.a)(Object(S.a)().mark((function e(t){var n,r,i,a,o,s,u,c,l,h,d,f,p,v=this,m=arguments;return Object(S.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(m.length>1&&void 0!==m[1]?m[1]:{}).interactive,i=void 0===r||r,!this.disposed){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,jL(t);case 5:return a=e.sent,e.next=8,Promise.all([XM(a)&&UE(),GT(a)&&vE(),a.scene.environment.usePhysics&&Hg(),dM(a)&&OT()].filter(Boolean));case 8:if(this._eventManager&&this._eventManager.deactivate(),this._controls&&this._controls.dispose(),null===(n=this._scene)||void 0===n||n.dispose(),o=new TB(a),this._scene=o.scene,this._sharedAssetsManager=o.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")&&(s=performance.now(),IB(a,o.scene),u=performance.now(),console.log("Merged geometries in ",u-s," ms")),XM(a)&&this._scene.traverse((function(e){$M(e)&&e.recomputeBoolean()})),this._sharedAssetsManager.setRequestRender((function(){var e;v.requestRender(),null===(e=v._scene)||void 0===e||e.traverse((function(e){e instanceof MM&&e.pendingMediaLoad&&e.update()}))})),!dM(a)||!xR(a)){e.next=17;break}return c=Object.keys(a.shared.fonts).map((function(e){return v._sharedAssetsManager.getFont(e)})).map((function(e){return e.loadingPromise})),e.next=17,Promise.all(c);case 17:this._scene.rewriteEventsBeforeGoToPlayMode(),gP(a.scene,this._scene,this._sharedAssetsManager),this._renderer||(this._renderer=new jB({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.addEventListener("smaaloaded",this.requestRender),this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=a.scene.environment.ambientLight.softShadows?Q:Z,DC(a.scene.environment.ambientLight.softShadowQuality)),this._frameView?this._frameView.setCamera(this._camera):("fullscreen"===(l=Object.values(a.frames)[0]).preset?(this._viewportMode=1,h=window.getComputedStyle(this.canvas),d=h.width,f=h.height,!this.canvas.parentElement||"300px"!==d&&"auto"!==d?this._viewportWidth=this.canvas.clientWidth:(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),!this.canvas.parentElement||"150px"!==f&&"auto"!==f?this._viewportHeight=this.canvas.clientHeight:(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=l.size[0],this._viewportHeight=l.size[1],this.canvas.style.width="".concat(this._viewportWidth,"px"),this.canvas.style.height="".concat(this._viewportHeight,"px")),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new DL(this._renderer,this._camera,new An(this._viewportWidth,this._viewportHeight),new An(window.innerWidth,window.innerHeight))),i&&(this._scene.updateMatrixWorld(!0),this._controls=new _R(a,this._scene,this._renderer,this.requestRender,this._sharedAssetsManager,!0),this._eventManager=new CL(this._renderer,this._scene,this._camera,a.scene.publish.stopRaycast,a.scene.publish.preventScroll,a.scene.publish.hideCursor,this._sharedAssetsManager,this.requestRender,this._controls,!0)),this._resize(),!this._resizeObserver&&this.canvas.parentElement&&(p=!0,this._resizeObserver=new ResizeObserver((function(){p?p=!1:(v._viewportWidth=v.canvas.clientWidth,v._viewportHeight=v.canvas.clientHeight,v._resize())})),this._resizeObserver.observe(this.canvas.parentElement)),void 0===this._rafId?this.render(performance.now()):this.requestRender();case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"findObjectById",value:function(e){var t,n=null===(t=this._scene)||void 0===t?void 0:t.getObjectByProperty("uuid",e);return this._createProxyObject(n)}},{key:"findObjectByName",value:function(e){var t,n=null===(t=this._scene)||void 0===t?void 0:t.getObjectByName(e);return this._createProxyObject(n)}},{key:"getSplineEvents",value:function(){var e;return(null===(e=this._eventManager)||void 0===e?void 0:e.handlers.Spline).splineEvents}},{key:"emitEvent",value:function(e,t){var n;null===(n=this.findObjectById(t)||this.findObjectByName(t))||void 0===n||n.emitEvent(e)}},{key:"emitEventReverse",value:function(e,t){var n;null===(n=this.findObjectById(t)||this.findObjectByName(t))||void 0===n||n.emitEventReverse(e)}},{key:"addEventListener",value:function(e,t){this.canvas.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this.canvas.removeEventListener(e,t)}},{key:"setZoom",value:function(e){var t,n;(null===(t=this._controls)||void 0===t?void 0:t.orbitControls)instanceof bL&&(null===(n=this._controls)||void 0===n||n.orbitControls.zoomOut(e))}},{key:"setSize",value:function(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}},{key:"dispose",value:function(){var e,t,n,r,i,a;this.disposed=!0,null!==(e=this._eventManager)&&void 0!==e&&e.deactivate(),null!==(t=this._scene)&&void 0!==t&&t.dispose(),null!==(n=this._sharedAssetsManager)&&void 0!==n&&n.dispose(),this._rafId&&cancelAnimationFrame(this._rafId),this._proxyObjectCache.forEach((function(e){jh.unsubscribe(e)})),null!==(r=this._renderer)&&void 0!==r&&r.dispose(),null!==(i=this._sharedAssetsManager)&&void 0!==i&&i.dispose(),this._resizeObserver&&this._resizeObserver.disconnect(),this.canvas.style.width="",this.canvas.style.height="",null!==(a=this._controls)&&void 0!==a&&a.dispose(),function(e){e.removeEventListener("pointerdown",Rx,!0),e.removeEventListener("pointerdown",Nx,!0),e.removeEventListener("pointermove",Nx,!0),e.removeEventListener("pointerup",Lx,!0),e.removeEventListener("pointercancel",Lx,!0),e.removeEventListener("pointerleave",Lx,!0),window.removeEventListener("keydown",Fx,!0),window.removeEventListener("keyup",Ux,!0)}(this.canvas)}},{key:"_createProxyObject",value:function(e){var t=this;if(null!=e){if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);var n={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,emitEvent:function(t){e.dispatchEvent({type:"userEvent",eventName:t})},emitEventReverse:function(t){e.dispatchEvent({type:"userEvent",eventName:t,reverse:!0})}},r=jh(n,(function(n,r){var i;"object"!=typeof e[n]&&null!==(i=Object.getOwnPropertyDescriptor(e,n))&&void 0!==i&&i.writable&&(e[n]=r),t.requestRender(),e.updateMatrix()}));return this._proxyObjectCache.set(e.uuid,r),r}}}]),e}()}).call(this,n(37),n(66)(e),n(38),n(59).Buffer)},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(44),i=n(8);function a(e,t,n,o){return a="undefined"!==typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,a){var o,s=Object(r.a)(e,t);if(s){if((o=Object.getOwnPropertyDescriptor(s,t)).set)return o.set.call(a,n),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(a,t)){if(!o.writable)return!1;o.value=n,Object.defineProperty(a,t,o)}else Object(i.a)(a,t,n);return!0},a(e,t,n,o)}function o(e,t,n,r,i){if(!a(e,t,n,r||e)&&i)throw new TypeError("failed to set property");return n}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(27),i=n(30),a=n(4);function o(){o=function(e,t){return new n(e,void 0,t)};var e=RegExp.prototype,t=new WeakMap;function n(e,r,a){var o=new RegExp(e,r);return t.set(o,a||t.get(e)),Object(i.a)(o,n.prototype)}function s(e,n){var r=t.get(n);return Object.keys(r).reduce((function(t,n){var i=r[n];if("number"==typeof i)t[n]=e[i];else{for(var a=0;void 0===e[i[a]]&&a+1<i.length;)a++;t[n]=e[i[a]]}return t}),Object.create(null))}return Object(a.a)(n,RegExp),n.prototype.exec=function(t){var n=e.exec.call(this,t);if(n){n.groups=s(n,this);var r=n.indices;r&&(r.groups=s(r,this))}return n},n.prototype[Symbol.replace]=function(n,i){if("string"==typeof i){var a=t.get(this);return e[Symbol.replace].call(this,n,i.replace(/\$<([^>]+)>/g,(function(e,t){var n=a[t];return"$"+(Array.isArray(n)?n.join("$"):n)})))}if("function"==typeof i){var o=this;return e[Symbol.replace].call(this,n,(function(){var e=arguments;return"object"!=Object(r.a)(e[e.length-1])&&(e=[].slice.call(e)).push(s(e,o)),i.apply(this,e)}))}return e[Symbol.replace].call(this,n,i)},o.apply(this,arguments)}},function(e,t,n){"use strict";(function(e){var r=n(67),i=n(68),a=n(69);function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!u.TYPED_ARRAY_SUPPORT&&!(this instanceof u))return new u(e,t,n);if("number"===typeof e){if("string"===typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return c(this,e,t,n)}function c(e,t,n,r){if("number"===typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=d(e,t);return e}(e,t,n,r):"string"===typeof t?function(e,t,n){"string"===typeof n&&""!==n||(n="utf8");if(!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n);e=s(e,r);var i=e.write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(u.isBuffer(t)){var n=0|f(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!==typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!==typeof t.length||(r=t.length)!==r?s(e,0):d(e,t);if("Buffer"===t.type&&a(t.data))return d(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!==typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(l(t),e=s(e,t<0?0:0|f(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function d(e,t){var n=t.length<0?0:0|f(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(u.isBuffer(e))return e.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!==typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return z(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return V(e).length;default:if(r)return z(e).length;t=(""+t).toLowerCase(),r=!0}}function v(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return M(this,t,n);case"utf8":case"utf-8":return E(this,t,n);case"ascii":return j(this,t,n);case"latin1":case"binary":return T(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){if(0===e.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"===typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"===typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var a,o=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,u/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var l=-1;for(a=n;a<s;a++)if(c(e,a)===c(t,-1===l?0:a-l)){if(-1===l&&(l=a),a-l+1===u)return l*o}else-1!==l&&(a-=a-l),l=-1}else for(n+u>s&&(n=s-u),a=n;a>=0;a--){for(var h=!0,d=0;d<u;d++)if(c(e,a+d)!==c(t,d)){h=!1;break}if(h)return a}return-1}function b(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!==0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function w(e,t,n,r){return G(z(t,e.length-n),e,n,r)}function x(e,t,n,r){return G(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function O(e,t,n,r){return x(e,t,n,r)}function k(e,t,n,r){return G(V(t),e,n,r)}function _(e,t,n,r){return G(function(e,t){for(var n,r,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function S(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function E(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,u,c=e[i],l=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=n)switch(h){case 1:c<128&&(l=c);break;case 2:128===(192&(a=e[i+1]))&&(u=(31&c)<<6|63&a)>127&&(l=u);break;case 3:a=e[i+1],o=e[i+2],128===(192&a)&&128===(192&o)&&(u=(15&c)<<12|(63&a)<<6|63&o)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128===(192&a)&&128===(192&o)&&128===(192&s)&&(u=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=h}return function(e){var t=e.length;if(t<=A)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=A));return n}(r)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"===typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}(),t.kMaxLength=o(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return c(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?s(e,t):void 0!==n?"string"===typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},u.allocUnsafe=function(e){return h(null,e)},u.allocUnsafeSlow=function(e){return h(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?E(this,0,e):v.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,r,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(a,o),c=this.slice(r,i),l=e.slice(t,n),h=0;h<s;++h)if(c[h]!==l[h]){a=c[h],o=l[h];break}return a<o?-1:o<a?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":return x(this,e,t,n);case"latin1":case"binary":return O(this,e,t,n);case"base64":return k(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var A=4096;function j(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function T(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function M(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=U(e[a]);return i}function C(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function D(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function I(e,t,n,r,i,a){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function P(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);i<a;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function R(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);i<a;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function L(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function N(e,t,n,r,a){return a||L(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function B(e,t,n,r,a){return a||L(e,0,n,8),i.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var i=t-e;n=new u(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUInt8=function(e,t){return t||D(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||D(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||D(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},u.prototype.readInt8=function(e,t){return t||D(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||D(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||D(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||I(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||I(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):P(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):P(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):R(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):R(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);I(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);I(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):P(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):P(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):R(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):R(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return N(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return N(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return B(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return B(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(a<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},u.prototype.fill=function(e,t,n,r){if("string"===typeof e){if("string"===typeof t?(r=t,t=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"===typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=u.isBuffer(e)?e:z(new u(e,r).toString()),s=o.length;for(a=0;a<n-t;++a)this[a+t]=o[a%s]}return this};var F=/[^+\/0-9A-Za-z-_]/g;function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function z(e,t){var n;t=t||1/0;for(var r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function V(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(F,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function G(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(37))},function(e,t,n){"use strict";var r=n(49),i=60103,a=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var o=60109,s=60110,u=60112;t.Suspense=60113;var c=60115,l=60116;if("function"===typeof Symbol&&Symbol.for){var h=Symbol.for;i=h("react.element"),a=h("react.portal"),t.Fragment=h("react.fragment"),t.StrictMode=h("react.strict_mode"),t.Profiler=h("react.profiler"),o=h("react.provider"),s=h("react.context"),u=h("react.forward_ref"),t.Suspense=h("react.suspense"),c=h("react.memo"),l=h("react.lazy")}var d="function"===typeof Symbol&&Symbol.iterator;function f(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v={};function m(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||p}function g(){}function y(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||p}m.prototype.isReactComponent={},m.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error(f(85));this.updater.enqueueSetState(this,e,t,"setState")},m.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},g.prototype=m.prototype;var b=y.prototype=new g;b.constructor=y,r(b,m.prototype),b.isPureReactComponent=!0;var w={current:null},x=Object.prototype.hasOwnProperty,O={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,n){var r,a={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)x.call(t,r)&&!O.hasOwnProperty(r)&&(a[r]=t[r]);var u=arguments.length-2;if(1===u)a.children=n;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];a.children=c}if(e&&e.defaultProps)for(r in u=e.defaultProps)void 0===a[r]&&(a[r]=u[r]);return{$$typeof:i,type:e,key:o,ref:s,props:a,_owner:w.current}}function _(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var S=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function A(e,t,n,r,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case i:case a:u=!0}}if(u)return o=o(u=e),e=""===r?"."+E(u,0):r,Array.isArray(o)?(n="",null!=e&&(n=e.replace(S,"$&/")+"/"),A(o,t,n,"",(function(e){return e}))):null!=o&&(_(o)&&(o=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,n+(!o.key||u&&u.key===o.key?"":(""+o.key).replace(S,"$&/")+"/")+e)),t.push(o)),1;if(u=0,r=""===r?".":r+":",Array.isArray(e))for(var c=0;c<e.length;c++){var l=r+E(s=e[c],c);u+=A(s,t,n,l,o)}else if(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=d&&e[d]||e["@@iterator"])?e:null}(e),"function"===typeof l)for(e=l.call(e),c=0;!(s=e.next()).done;)u+=A(s=s.value,t,n,l=r+E(s,c++),o);else if("object"===s)throw t=""+e,Error(f(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return u}function j(e,t,n){if(null==e)return e;var r=[],i=0;return A(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function T(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var M={current:null};function C(){var e=M.current;if(null===e)throw Error(f(321));return e}var D={ReactCurrentDispatcher:M,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:w,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:j,forEach:function(e,t,n){j(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return j(e,(function(){t++})),t},toArray:function(e){return j(e,(function(e){return e}))||[]},only:function(e){if(!_(e))throw Error(f(143));return e}},t.Component=m,t.PureComponent=y,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error(f(267,e));var a=r({},e.props),o=e.key,s=e.ref,u=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,u=w.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)x.call(t,l)&&!O.hasOwnProperty(l)&&(a[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)a.children=n;else if(1<l){c=Array(l);for(var h=0;h<l;h++)c[h]=arguments[h+2];a.children=c}return{$$typeof:i,type:e.type,key:o,ref:s,props:a,_owner:u}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:s,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=k,t.createFactory=function(e){var t=k.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=_,t.lazy=function(e){return{$$typeof:l,_payload:{_status:-1,_result:e},_init:T}},t.memo=function(e,t){return{$$typeof:c,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return C().useCallback(e,t)},t.useContext=function(e,t){return C().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return C().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return C().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return C().useLayoutEffect(e,t)},t.useMemo=function(e,t){return C().useMemo(e,t)},t.useReducer=function(e,t,n){return C().useReducer(e,t,n)},t.useRef=function(e){return C().useRef(e)},t.useState=function(e){return C().useState(e)},t.version="17.0.2"},function(e,t,n){"use strict";var r=n(12),i=n(49),a=n(62);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(o(227));var s=new Set,u={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(u[e]=t,e=0;e<t.length;e++)s.add(t[e])}var h=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f=Object.prototype.hasOwnProperty,p={},v={};function m(e,t,n,r,i,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function w(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0===i.type:!r&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!f.call(v,e)||!f.call(p,e)&&(d.test(e)?v[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,b);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,b);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,b);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,O=60103,k=60106,_=60107,S=60108,E=60114,A=60109,j=60110,T=60112,M=60113,C=60120,D=60115,I=60116,P=60121,R=60128,L=60129,N=60130,B=60131;if("function"===typeof Symbol&&Symbol.for){var F=Symbol.for;O=F("react.element"),k=F("react.portal"),_=F("react.fragment"),S=F("react.strict_mode"),E=F("react.profiler"),A=F("react.provider"),j=F("react.context"),T=F("react.forward_ref"),M=F("react.suspense"),C=F("react.suspense_list"),D=F("react.memo"),I=F("react.lazy"),P=F("react.block"),F("react.scope"),R=F("react.opaque.id"),L=F("react.debug_trace_mode"),N=F("react.offscreen"),B=F("react.legacy_hidden")}var U,z="function"===typeof Symbol&&Symbol.iterator;function V(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=z&&e[z]||e["@@iterator"])?e:null}function G(e){if(void 0===U)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);U=t&&t[1]||""}return"\n"+U+e}var H=!1;function W(e,t){if(!e||H)return"";H=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){r=u}e.call(t.prototype)}else{try{throw Error()}catch(u){r=u}e()}}catch(u){if(u&&r&&"string"===typeof u.stack){for(var i=u.stack.split("\n"),a=r.stack.split("\n"),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||i[o]!==a[s])return"\n"+i[o].replace(" at new "," at ")}while(1<=o&&0<=s);break}}}finally{H=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?G(e):""}function q(e){switch(e.tag){case 5:return G(e.type);case 16:return G("Lazy");case 13:return G("Suspense");case 19:return G("SuspenseList");case 0:case 2:case 15:return e=W(e.type,!1);case 11:return e=W(e.type.render,!1);case 22:return e=W(e.type._render,!1);case 1:return e=W(e.type,!0);default:return""}}function Y(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case _:return"Fragment";case k:return"Portal";case E:return"Profiler";case S:return"StrictMode";case M:return"Suspense";case C:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case j:return(e.displayName||"Context")+".Consumer";case A:return(e._context.displayName||"Context")+".Provider";case T:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case D:return Y(e.type);case P:return Y(e._render);case I:t=e._payload,e=e._init;try{return Y(e(t))}catch(n){}}return null}function X(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function K(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Q(e){e._valueTracker||(e._valueTracker=function(e){var t=K(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Z(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=K(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function J(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function $(e,t){var n=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function ee(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=X(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&w(e,"checked",t,!1)}function ne(e,t){te(e,t);var n=X(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ie(e,t.type,n):t.hasOwnProperty("defaultValue")&&ie(e,t.type,X(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function re(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ie(e,t,n){"number"===t&&J(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function ae(e,t){return e=i({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function oe(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+X(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function se(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return i({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ue(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:X(n)}}function ce(e,t){var n=X(t.value),r=X(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function le(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var he={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function de(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fe(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?de(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var pe,ve,me=(ve=function(e,t){if(e.namespaceURI!==he.svg||"innerHTML"in e)e.innerHTML=t;else{for((pe=pe||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=pe.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ve(e,t)}))}:ve);function ge(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var ye={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},be=["Webkit","ms","Moz","O"];function we(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||ye.hasOwnProperty(e)&&ye[e]?(""+t).trim():t+"px"}function xe(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=we(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(ye).forEach((function(e){be.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ye[t]=ye[e]}))}));var Oe=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ke(e,t){if(t){if(Oe[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function _e(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Se(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ee=null,Ae=null,je=null;function Te(e){if(e=ni(e)){if("function"!==typeof Ee)throw Error(o(280));var t=e.stateNode;t&&(t=ii(t),Ee(e.stateNode,e.type,t))}}function Me(e){Ae?je?je.push(e):je=[e]:Ae=e}function Ce(){if(Ae){var e=Ae,t=je;if(je=Ae=null,Te(e),t)for(e=0;e<t.length;e++)Te(t[e])}}function De(e,t){return e(t)}function Ie(e,t,n,r,i){return e(t,n,r,i)}function Pe(){}var Re=De,Le=!1,Ne=!1;function Be(){null===Ae&&null===je||(Pe(),Ce())}function Fe(e,t){var n=e.stateNode;if(null===n)return null;var r=ii(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Ue=!1;if(h)try{var ze={};Object.defineProperty(ze,"passive",{get:function(){Ue=!0}}),window.addEventListener("test",ze,ze),window.removeEventListener("test",ze,ze)}catch(ve){Ue=!1}function Ve(e,t,n,r,i,a,o,s,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}var Ge=!1,He=null,We=!1,qe=null,Ye={onError:function(e){Ge=!0,He=e}};function Xe(e,t,n,r,i,a,o,s,u){Ge=!1,He=null,Ve.apply(Ye,arguments)}function Ke(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Qe(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ze(e){if(Ke(e)!==e)throw Error(o(188))}function Je(e){if(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ke(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return Ze(i),e;if(a===r)return Ze(i),t;a=a.sibling}throw Error(o(188))}if(n.return!==r.return)n=i,r=a;else{for(var s=!1,u=i.child;u;){if(u===n){s=!0,n=i,r=a;break}if(u===r){s=!0,r=i,n=a;break}u=u.sibling}if(!s){for(u=a.child;u;){if(u===n){s=!0,n=a,r=i;break}if(u===r){s=!0,r=a,n=i;break}u=u.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e),!e)return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function $e(e,t){for(var n=e.alternate;null!==t;){if(t===e||t===n)return!0;t=t.return}return!1}var et,tt,nt,rt,it=!1,at=[],ot=null,st=null,ut=null,ct=new Map,lt=new Map,ht=[],dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ft(e,t,n,r,i){return{blockedOn:e,domEventName:t,eventSystemFlags:16|n,nativeEvent:i,targetContainers:[r]}}function pt(e,t){switch(e){case"focusin":case"focusout":ot=null;break;case"dragenter":case"dragleave":st=null;break;case"mouseover":case"mouseout":ut=null;break;case"pointerover":case"pointerout":ct.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":lt.delete(t.pointerId)}}function vt(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e=ft(t,n,r,i,a),null!==t&&(null!==(t=ni(t))&&tt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function mt(e){var t=ti(e.target);if(null!==t){var n=Ke(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Qe(n)))return e.blockedOn=t,void rt(e.lanePriority,(function(){a.unstable_runWithPriority(e.priority,(function(){nt(n)}))}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function gt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Jt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ni(n))&&tt(t),e.blockedOn=n,!1;t.shift()}return!0}function yt(e,t,n){gt(e)&&n.delete(t)}function bt(){for(it=!1;0<at.length;){var e=at[0];if(null!==e.blockedOn){null!==(e=ni(e.blockedOn))&&et(e);break}for(var t=e.targetContainers;0<t.length;){var n=Jt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n){e.blockedOn=n;break}t.shift()}null===e.blockedOn&&at.shift()}null!==ot&&gt(ot)&&(ot=null),null!==st&&gt(st)&&(st=null),null!==ut&&gt(ut)&&(ut=null),ct.forEach(yt),lt.forEach(yt)}function wt(e,t){e.blockedOn===t&&(e.blockedOn=null,it||(it=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,bt)))}function xt(e){function t(t){return wt(t,e)}if(0<at.length){wt(at[0],e);for(var n=1;n<at.length;n++){var r=at[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==ot&&wt(ot,e),null!==st&&wt(st,e),null!==ut&&wt(ut,e),ct.forEach(t),lt.forEach(t),n=0;n<ht.length;n++)(r=ht[n]).blockedOn===e&&(r.blockedOn=null);for(;0<ht.length&&null===(n=ht[0]).blockedOn;)mt(n),null===n.blockedOn&&ht.shift()}function Ot(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var kt={animationend:Ot("Animation","AnimationEnd"),animationiteration:Ot("Animation","AnimationIteration"),animationstart:Ot("Animation","AnimationStart"),transitionend:Ot("Transition","TransitionEnd")},_t={},St={};function Et(e){if(_t[e])return _t[e];if(!kt[e])return e;var t,n=kt[e];for(t in n)if(n.hasOwnProperty(t)&&t in St)return _t[e]=n[t];return e}h&&(St=document.createElement("div").style,"AnimationEvent"in window||(delete kt.animationend.animation,delete kt.animationiteration.animation,delete kt.animationstart.animation),"TransitionEvent"in window||delete kt.transitionend.transition);var At=Et("animationend"),jt=Et("animationiteration"),Tt=Et("animationstart"),Mt=Et("transitionend"),Ct=new Map,Dt=new Map,It=["abort","abort",At,"animationEnd",jt,"animationIteration",Tt,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Mt,"transitionEnd","waiting","waiting"];function Pt(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],i=e[n+1];i="on"+(i[0].toUpperCase()+i.slice(1)),Dt.set(r,t),Ct.set(r,i),c(i,[r])}}(0,a.unstable_now)();var Rt=8;function Lt(e){if(0!==(1&e))return Rt=15,1;if(0!==(2&e))return Rt=14,2;if(0!==(4&e))return Rt=13,4;var t=24&e;return 0!==t?(Rt=12,t):0!==(32&e)?(Rt=11,32):0!==(t=192&e)?(Rt=10,t):0!==(256&e)?(Rt=9,256):0!==(t=3584&e)?(Rt=8,t):0!==(4096&e)?(Rt=7,4096):0!==(t=4186112&e)?(Rt=6,t):0!==(t=62914560&e)?(Rt=5,t):67108864&e?(Rt=4,67108864):0!==(134217728&e)?(Rt=3,134217728):0!==(t=805306368&e)?(Rt=2,t):0!==(1073741824&e)?(Rt=1,1073741824):(Rt=8,e)}function Nt(e,t){var n=e.pendingLanes;if(0===n)return Rt=0;var r=0,i=0,a=e.expiredLanes,o=e.suspendedLanes,s=e.pingedLanes;if(0!==a)r=a,i=Rt=15;else if(0!==(a=134217727&n)){var u=a&~o;0!==u?(r=Lt(u),i=Rt):0!==(s&=a)&&(r=Lt(s),i=Rt)}else 0!==(a=n&~o)?(r=Lt(a),i=Rt):0!==s&&(r=Lt(s),i=Rt);if(0===r)return 0;if(r=n&((0>(r=31-Gt(r))?0:1<<r)<<1)-1,0!==t&&t!==r&&0===(t&o)){if(Lt(t),i<=Rt)return t;Rt=i}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-Gt(t)),r|=e[n],t&=~i;return r}function Bt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Ft(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=Ut(24&~t))?Ft(10,t):e;case 10:return 0===(e=Ut(192&~t))?Ft(8,t):e;case 8:return 0===(e=Ut(3584&~t))&&(0===(e=Ut(4186112&~t))&&(e=512)),e;case 2:return 0===(t=Ut(805306368&~t))&&(t=268435456),t}throw Error(o(358,e))}function Ut(e){return e&-e}function zt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Vt(e,t,n){e.pendingLanes|=t;var r=t-1;e.suspendedLanes&=r,e.pingedLanes&=r,(e=e.eventTimes)[t=31-Gt(t)]=n}var Gt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(Ht(e)/Wt|0)|0},Ht=Math.log,Wt=Math.LN2;var qt=a.unstable_UserBlockingPriority,Yt=a.unstable_runWithPriority,Xt=!0;function Kt(e,t,n,r){Le||Pe();var i=Zt,a=Le;Le=!0;try{Ie(i,e,t,n,r)}finally{(Le=a)||Be()}}function Qt(e,t,n,r){Yt(qt,Zt.bind(null,e,t,n,r))}function Zt(e,t,n,r){var i;if(Xt)if((i=0===(4&t))&&0<at.length&&-1<dt.indexOf(e))e=ft(null,e,t,n,r),at.push(e);else{var a=Jt(e,t,n,r);if(null===a)i&&pt(e,r);else{if(i){if(-1<dt.indexOf(e))return e=ft(a,e,t,n,r),void at.push(e);if(function(e,t,n,r,i){switch(t){case"focusin":return ot=vt(ot,e,t,n,r,i),!0;case"dragenter":return st=vt(st,e,t,n,r,i),!0;case"mouseover":return ut=vt(ut,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return ct.set(a,vt(ct.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,lt.set(a,vt(lt.get(a)||null,e,t,n,r,i)),!0}return!1}(a,e,t,n,r))return;pt(e,r)}Pr(e,t,r,null,n)}}}function Jt(e,t,n,r){var i=Se(r);if(null!==(i=ti(i))){var a=Ke(i);if(null===a)i=null;else{var o=a.tag;if(13===o){if(null!==(i=Qe(a)))return i;i=null}else if(3===o){if(a.stateNode.hydrate)return 3===a.tag?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null)}}return Pr(e,t,r,i,n),null}var $t=null,en=null,tn=null;function nn(){if(tn)return tn;var e,t,n=en,r=n.length,i="value"in $t?$t.value:$t.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return tn=i.slice(e,1<t?1-t:void 0)}function rn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function an(){return!0}function on(){return!1}function sn(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?an:on,this.isPropagationStopped=on,this}return i(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=an)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=an)},persist:function(){},isPersistent:an}),t}var un,cn,ln,hn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dn=sn(hn),fn=i({},hn,{view:0,detail:0}),pn=sn(fn),vn=i({},fn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:An,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(un=e.screenX-ln.screenX,cn=e.screenY-ln.screenY):cn=un=0,ln=e),un)},movementY:function(e){return"movementY"in e?e.movementY:cn}}),mn=sn(vn),gn=sn(i({},vn,{dataTransfer:0})),yn=sn(i({},fn,{relatedTarget:0})),bn=sn(i({},hn,{animationName:0,elapsedTime:0,pseudoElement:0})),wn=i({},hn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),xn=sn(wn),On=sn(i({},hn,{data:0})),kn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_n={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function En(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function An(){return En}var jn=i({},fn,{key:function(e){if(e.key){var t=kn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=rn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?_n[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:An,charCode:function(e){return"keypress"===e.type?rn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?rn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Tn=sn(jn),Mn=sn(i({},vn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Cn=sn(i({},fn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:An})),Dn=sn(i({},hn,{propertyName:0,elapsedTime:0,pseudoElement:0})),In=i({},vn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=sn(In),Rn=[9,13,27,32],Ln=h&&"CompositionEvent"in window,Nn=null;h&&"documentMode"in document&&(Nn=document.documentMode);var Bn=h&&"TextEvent"in window&&!Nn,Fn=h&&(!Ln||Nn&&8<Nn&&11>=Nn),Un=String.fromCharCode(32),zn=!1;function Vn(e,t){switch(e){case"keyup":return-1!==Rn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Gn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Hn=!1;var Wn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Wn[e.type]:"textarea"===t}function Yn(e,t,n,r){Me(r),0<(t=Lr(t,"onChange")).length&&(n=new dn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Xn=null,Kn=null;function Qn(e){jr(e,0)}function Zn(e){if(Z(ri(e)))return e}function Jn(e,t){if("change"===e)return t}var $n=!1;if(h){var er;if(h){var tr="oninput"in document;if(!tr){var nr=document.createElement("div");nr.setAttribute("oninput","return;"),tr="function"===typeof nr.oninput}er=tr}else er=!1;$n=er&&(!document.documentMode||9<document.documentMode)}function rr(){Xn&&(Xn.detachEvent("onpropertychange",ir),Kn=Xn=null)}function ir(e){if("value"===e.propertyName&&Zn(Kn)){var t=[];if(Yn(t,Kn,e,Se(e)),e=Qn,Le)e(t);else{Le=!0;try{De(e,t)}finally{Le=!1,Be()}}}}function ar(e,t,n){"focusin"===e?(rr(),Kn=n,(Xn=t).attachEvent("onpropertychange",ir)):"focusout"===e&&rr()}function or(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Zn(Kn)}function sr(e,t){if("click"===e)return Zn(t)}function ur(e,t){if("input"===e||"change"===e)return Zn(t)}var cr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},lr=Object.prototype.hasOwnProperty;function hr(e,t){if(cr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!lr.call(t,n[r])||!cr(e[n[r]],t[n[r]]))return!1;return!0}function dr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function fr(e,t){var n,r=dr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=dr(r)}}function pr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?pr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function vr(){for(var e=window,t=J();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=J((e=t.contentWindow).document)}return t}function mr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var gr=h&&"documentMode"in document&&11>=document.documentMode,yr=null,br=null,wr=null,xr=!1;function Or(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;xr||null==yr||yr!==J(r)||("selectionStart"in(r=yr)&&mr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},wr&&hr(wr,r)||(wr=r,0<(r=Lr(br,"onSelect")).length&&(t=new dn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=yr)))}Pt("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Pt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Pt(It,2);for(var kr="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),_r=0;_r<kr.length;_r++)Dt.set(kr[_r],0);l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Sr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Er=new Set("cancel close invalid load scroll toggle".split(" ").concat(Sr));function Ar(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,a,s,u,c){if(Xe.apply(this,arguments),Ge){if(!Ge)throw Error(o(198));var l=He;Ge=!1,He=null,We||(We=!0,qe=l)}}(r,t,void 0,e),e.currentTarget=null}function jr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],u=s.instance,c=s.currentTarget;if(s=s.listener,u!==a&&i.isPropagationStopped())break e;Ar(i,s,c),a=u}else for(o=0;o<r.length;o++){if(u=(s=r[o]).instance,c=s.currentTarget,s=s.listener,u!==a&&i.isPropagationStopped())break e;Ar(i,s,c),a=u}}}if(We)throw e=qe,We=!1,qe=null,e}function Tr(e,t){var n=ai(t),r=e+"__bubble";n.has(r)||(Ir(t,e,2,!1),n.add(r))}var Mr="_reactListening"+Math.random().toString(36).slice(2);function Cr(e){e[Mr]||(e[Mr]=!0,s.forEach((function(t){Er.has(t)||Dr(t,!1,e,null),Dr(t,!0,e,null)})))}function Dr(e,t,n,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,a=n;if("selectionchange"===e&&9!==n.nodeType&&(a=n.ownerDocument),null!==r&&!t&&Er.has(e)){if("scroll"!==e)return;i|=2,a=r}var o=ai(a),s=e+"__"+(t?"capture":"bubble");o.has(s)||(t&&(i|=4),Ir(a,e,i,t),o.add(s))}function Ir(e,t,n,r){var i=Dt.get(t);switch(void 0===i?2:i){case 0:i=Kt;break;case 1:i=Qt;break;default:i=Zt}n=i.bind(null,t,n,e),i=void 0,!Ue||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Pr(e,t,n,r,i){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===o)for(o=r.return;null!==o;){var u=o.tag;if((3===u||4===u)&&((u=o.stateNode.containerInfo)===i||8===u.nodeType&&u.parentNode===i))return;o=o.return}for(;null!==s;){if(null===(o=ti(s)))return;if(5===(u=o.tag)||6===u){r=a=o;continue e}s=s.parentNode}}r=r.return}!function(e,t,n){if(Ne)return e(t,n);Ne=!0;try{Re(e,t,n)}finally{Ne=!1,Be()}}((function(){var r=a,i=Se(n),o=[];e:{var s=Ct.get(e);if(void 0!==s){var u=dn,c=e;switch(e){case"keypress":if(0===rn(n))break e;case"keydown":case"keyup":u=Tn;break;case"focusin":c="focus",u=yn;break;case"focusout":c="blur",u=yn;break;case"beforeblur":case"afterblur":u=yn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=mn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=Cn;break;case At:case jt:case Tt:u=bn;break;case Mt:u=Dn;break;case"scroll":u=pn;break;case"wheel":u=Pn;break;case"copy":case"cut":case"paste":u=xn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=Mn}var l=0!==(4&t),h=!l&&"scroll"===e,d=l?null!==s?s+"Capture":null:s;l=[];for(var f,p=r;null!==p;){var v=(f=p).stateNode;if(5===f.tag&&null!==v&&(f=v,null!==d&&(null!=(v=Fe(p,d))&&l.push(Rr(p,v,f)))),h)break;p=p.return}0<l.length&&(s=new u(s,c,null,n,i),o.push({event:s,listeners:l}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||0!==(16&t)||!(c=n.relatedTarget||n.fromElement)||!ti(c)&&!c[$r])&&(u||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(c=(c=n.relatedTarget||n.toElement)?ti(c):null)&&(c!==(h=Ke(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(u=null,c=r),u!==c)){if(l=mn,v="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(l=Mn,v="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==u?s:ri(u),f=null==c?s:ri(c),(s=new l(v,p+"leave",u,n,i)).target=h,s.relatedTarget=f,v=null,ti(i)===r&&((l=new l(d,p+"enter",c,n,i)).target=f,l.relatedTarget=h,v=l),h=v,u&&c)e:{for(d=c,p=0,f=l=u;f;f=Nr(f))p++;for(f=0,v=d;v;v=Nr(v))f++;for(;0<p-f;)l=Nr(l),p--;for(;0<f-p;)d=Nr(d),f--;for(;p--;){if(l===d||null!==d&&l===d.alternate)break e;l=Nr(l),d=Nr(d)}l=null}else l=null;null!==u&&Br(o,s,u,l,!1),null!==c&&null!==h&&Br(o,h,c,l,!0)}if("select"===(u=(s=r?ri(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var m=Jn;else if(qn(s))if($n)m=ur;else{m=or;var g=ar}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(m=sr);switch(m&&(m=m(e,r))?Yn(o,m,n,i):(g&&g(e,s,r),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ie(s,"number",s.value)),g=r?ri(r):window,e){case"focusin":(qn(g)||"true"===g.contentEditable)&&(yr=g,br=r,wr=null);break;case"focusout":wr=br=yr=null;break;case"mousedown":xr=!0;break;case"contextmenu":case"mouseup":case"dragend":xr=!1,Or(o,n,i);break;case"selectionchange":if(gr)break;case"keydown":case"keyup":Or(o,n,i)}var y;if(Ln)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Hn?Vn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Fn&&"ko"!==n.locale&&(Hn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Hn&&(y=nn()):(en="value"in($t=i)?$t.value:$t.textContent,Hn=!0)),0<(g=Lr(r,b)).length&&(b=new On(b,e,null,n,i),o.push({event:b,listeners:g}),y?b.data=y:null!==(y=Gn(n))&&(b.data=y))),(y=Bn?function(e,t){switch(e){case"compositionend":return Gn(t);case"keypress":return 32!==t.which?null:(zn=!0,Un);case"textInput":return(e=t.data)===Un&&zn?null:e;default:return null}}(e,n):function(e,t){if(Hn)return"compositionend"===e||!Ln&&Vn(e,t)?(e=nn(),tn=en=$t=null,Hn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Lr(r,"onBeforeInput")).length&&(i=new On("onBeforeInput","beforeinput",null,n,i),o.push({event:i,listeners:r}),i.data=y))}jr(o,t)}))}function Rr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Lr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=Fe(e,n))&&r.unshift(Rr(e,a,i)),null!=(a=Fe(e,t))&&r.push(Rr(e,a,i))),e=e.return}return r}function Nr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Br(e,t,n,r,i){for(var a=t._reactName,o=[];null!==n&&n!==r;){var s=n,u=s.alternate,c=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==c&&(s=c,i?null!=(u=Fe(n,a))&&o.unshift(Rr(n,u,s)):i||null!=(u=Fe(n,a))&&o.push(Rr(n,u,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}function Fr(){}var Ur=null,zr=null;function Vr(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Gr(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Hr="function"===typeof setTimeout?setTimeout:void 0,Wr="function"===typeof clearTimeout?clearTimeout:void 0;function qr(e){1===e.nodeType?e.textContent="":9===e.nodeType&&(null!=(e=e.body)&&(e.textContent=""))}function Yr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function Xr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var Kr=0;var Qr=Math.random().toString(36).slice(2),Zr="__reactFiber$"+Qr,Jr="__reactProps$"+Qr,$r="__reactContainer$"+Qr,ei="__reactEvents$"+Qr;function ti(e){var t=e[Zr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[$r]||n[Zr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Xr(e);null!==e;){if(n=e[Zr])return n;e=Xr(e)}return t}n=(e=n).parentNode}return null}function ni(e){return!(e=e[Zr]||e[$r])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ri(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function ii(e){return e[Jr]||null}function ai(e){var t=e[ei];return void 0===t&&(t=e[ei]=new Set),t}var oi=[],si=-1;function ui(e){return{current:e}}function ci(e){0>si||(e.current=oi[si],oi[si]=null,si--)}function li(e,t){si++,oi[si]=e.current,e.current=t}var hi={},di=ui(hi),fi=ui(!1),pi=hi;function vi(e,t){var n=e.type.contextTypes;if(!n)return hi;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function mi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function gi(){ci(fi),ci(di)}function yi(e,t,n){if(di.current!==hi)throw Error(o(168));li(di,t),li(fi,n)}function bi(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in e))throw Error(o(108,Y(t)||"Unknown",a));return i({},n,r)}function wi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||hi,pi=di.current,li(di,e),li(fi,fi.current),!0}function xi(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=bi(e,t,pi),r.__reactInternalMemoizedMergedChildContext=e,ci(fi),ci(di),li(di,e)):ci(fi),li(fi,n)}var Oi=null,ki=null,_i=a.unstable_runWithPriority,Si=a.unstable_scheduleCallback,Ei=a.unstable_cancelCallback,Ai=a.unstable_shouldYield,ji=a.unstable_requestPaint,Ti=a.unstable_now,Mi=a.unstable_getCurrentPriorityLevel,Ci=a.unstable_ImmediatePriority,Di=a.unstable_UserBlockingPriority,Ii=a.unstable_NormalPriority,Pi=a.unstable_LowPriority,Ri=a.unstable_IdlePriority,Li={},Ni=void 0!==ji?ji:function(){},Bi=null,Fi=null,Ui=!1,zi=Ti(),Vi=1e4>zi?Ti:function(){return Ti()-zi};function Gi(){switch(Mi()){case Ci:return 99;case Di:return 98;case Ii:return 97;case Pi:return 96;case Ri:return 95;default:throw Error(o(332))}}function Hi(e){switch(e){case 99:return Ci;case 98:return Di;case 97:return Ii;case 96:return Pi;case 95:return Ri;default:throw Error(o(332))}}function Wi(e,t){return e=Hi(e),_i(e,t)}function qi(e,t,n){return e=Hi(e),Si(e,t,n)}function Yi(){if(null!==Fi){var e=Fi;Fi=null,Ei(e)}Xi()}function Xi(){if(!Ui&&null!==Bi){Ui=!0;var e=0;try{var t=Bi;Wi(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Bi=null}catch(n){throw null!==Bi&&(Bi=Bi.slice(e+1)),Si(Ci,Yi),n}finally{Ui=!1}}}var Ki=x.ReactCurrentBatchConfig;function Qi(e,t){if(e&&e.defaultProps){for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var Zi=ui(null),Ji=null,$i=null,ea=null;function ta(){ea=$i=Ji=null}function na(e){var t=Zi.current;ci(Zi),e.type._context._currentValue=t}function ra(e,t){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)===t){if(null===n||(n.childLanes&t)===t)break;n.childLanes|=t}else e.childLanes|=t,null!==n&&(n.childLanes|=t);e=e.return}}function ia(e,t){Ji=e,ea=$i=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Lo=!0),e.firstContext=null)}function aa(e,t){if(ea!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(ea=e,t=1073741823),t={context:e,observedBits:t,next:null},null===$i){if(null===Ji)throw Error(o(308));$i=t,Ji.dependencies={lanes:0,firstContext:t,responders:null}}else $i=$i.next=t;return e._currentValue}var oa=!1;function sa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function ua(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ca(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function la(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function ha(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function da(e,t,n,r){var a=e.updateQueue;oa=!1;var o=a.firstBaseUpdate,s=a.lastBaseUpdate,u=a.shared.pending;if(null!==u){a.shared.pending=null;var c=u,l=c.next;c.next=null,null===s?o=l:s.next=l,s=c;var h=e.alternate;if(null!==h){var d=(h=h.updateQueue).lastBaseUpdate;d!==s&&(null===d?h.firstBaseUpdate=l:d.next=l,h.lastBaseUpdate=c)}}if(null!==o){for(d=a.baseState,s=0,h=l=c=null;;){u=o.lane;var f=o.eventTime;if((r&u)===u){null!==h&&(h=h.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=e,v=o;switch(u=t,f=n,v.tag){case 1:if("function"===typeof(p=v.payload)){d=p.call(f,d,u);break e}d=p;break e;case 3:p.flags=-4097&p.flags|64;case 0:if(null===(u="function"===typeof(p=v.payload)?p.call(f,d,u):p)||void 0===u)break e;d=i({},d,u);break e;case 2:oa=!0}}null!==o.callback&&(e.flags|=32,null===(u=a.effects)?a.effects=[o]:u.push(o))}else f={eventTime:f,lane:u,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===h?(l=h=f,c=d):h=h.next=f,s|=u;if(null===(o=o.next)){if(null===(u=a.shared.pending))break;o=u.next,u.next=null,a.lastBaseUpdate=u,a.shared.pending=null}}null===h&&(c=d),a.baseState=c,a.firstBaseUpdate=l,a.lastBaseUpdate=h,zs|=s,e.lanes=s,e.memoizedState=d}}function fa(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(o(191,i));i.call(r)}}}var pa=(new r.Component).refs;function va(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:i({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ma={isMounted:function(e){return!!(e=e._reactInternals)&&Ke(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=du(),i=fu(e),a=ca(r,i);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),la(e,a),pu(e,i,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=du(),i=fu(e),a=ca(r,i);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),la(e,a),pu(e,i,r)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=du(),r=fu(e),i=ca(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),la(e,i),pu(e,r,n)}};function ga(e,t,n,r,i,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!hr(n,r)||!hr(i,a))}function ya(e,t,n){var r=!1,i=hi,a=t.contextType;return"object"===typeof a&&null!==a?a=aa(a):(i=mi(t)?pi:di.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?vi(e,i):hi),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ma,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function ba(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ma.enqueueReplaceState(t,t.state,null)}function wa(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=pa,sa(e);var a=t.contextType;"object"===typeof a&&null!==a?i.context=aa(a):(a=mi(t)?pi:di.current,i.context=vi(e,a)),da(e,n,i,r),i.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(va(e,t,a,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&ma.enqueueReplaceState(i,i.state,null),da(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4)}var xa=Array.isArray;function Oa(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=r.refs;t===pa&&(t=r.refs={}),null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function ka(e,t){if("textarea"!==e.type)throw Error(o(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function _a(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=qu(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags=2,n):r:(t.flags=2,n):n}function s(t){return e&&null===t.alternate&&(t.flags=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Qu(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){return null!==t&&t.elementType===n.type?((r=i(t,n.props)).ref=Oa(e,t,n),r.return=e,r):((r=Yu(n.type,n.key,n.props,null,e.mode,r)).ref=Oa(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Zu(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function h(e,t,n,r,a){return null===t||7!==t.tag?((t=Xu(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t||"number"===typeof t)return(t=Qu(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case O:return(n=Yu(t.type,t.key,t.props,null,e.mode,n)).ref=Oa(e,null,t),n.return=e,n;case k:return(t=Zu(t,e.mode,n)).return=e,t}if(xa(t)||V(t))return(t=Xu(t,e.mode,n,null)).return=e,t;ka(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==i?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case O:return n.key===i?n.type===_?h(e,t,n.props.children,r,i):c(e,t,n,r):null;case k:return n.key===i?l(e,t,n,r):null}if(xa(n)||V(n))return null!==i?null:h(e,t,n,r,null);ka(e,n)}return null}function p(e,t,n,r,i){if("string"===typeof r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case O:return e=e.get(null===r.key?n:r.key)||null,r.type===_?h(t,e,r.props.children,i,r.key):c(t,e,r,i);case k:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i)}if(xa(r)||V(r))return h(t,e=e.get(n)||null,r,i,null);ka(t,r)}return null}function v(i,o,s,u){for(var c=null,l=null,h=o,v=o=0,m=null;null!==h&&v<s.length;v++){h.index>v?(m=h,h=null):m=h.sibling;var g=f(i,h,s[v],u);if(null===g){null===h&&(h=m);break}e&&h&&null===g.alternate&&t(i,h),o=a(g,o,v),null===l?c=g:l.sibling=g,l=g,h=m}if(v===s.length)return n(i,h),c;if(null===h){for(;v<s.length;v++)null!==(h=d(i,s[v],u))&&(o=a(h,o,v),null===l?c=h:l.sibling=h,l=h);return c}for(h=r(i,h);v<s.length;v++)null!==(m=p(h,i,v,s[v],u))&&(e&&null!==m.alternate&&h.delete(null===m.key?v:m.key),o=a(m,o,v),null===l?c=m:l.sibling=m,l=m);return e&&h.forEach((function(e){return t(i,e)})),c}function m(i,s,u,c){var l=V(u);if("function"!==typeof l)throw Error(o(150));if(null==(u=l.call(u)))throw Error(o(151));for(var h=l=null,v=s,m=s=0,g=null,y=u.next();null!==v&&!y.done;m++,y=u.next()){v.index>m?(g=v,v=null):g=v.sibling;var b=f(i,v,y.value,c);if(null===b){null===v&&(v=g);break}e&&v&&null===b.alternate&&t(i,v),s=a(b,s,m),null===h?l=b:h.sibling=b,h=b,v=g}if(y.done)return n(i,v),l;if(null===v){for(;!y.done;m++,y=u.next())null!==(y=d(i,y.value,c))&&(s=a(y,s,m),null===h?l=y:h.sibling=y,h=y);return l}for(v=r(i,v);!y.done;m++,y=u.next())null!==(y=p(v,i,m,y.value,c))&&(e&&null!==y.alternate&&v.delete(null===y.key?m:y.key),s=a(y,s,m),null===h?l=y:h.sibling=y,h=y);return e&&v.forEach((function(e){return t(i,e)})),l}return function(e,r,a,u){var c="object"===typeof a&&null!==a&&a.type===_&&null===a.key;c&&(a=a.props.children);var l="object"===typeof a&&null!==a;if(l)switch(a.$$typeof){case O:e:{for(l=a.key,c=r;null!==c;){if(c.key===l){if(7===c.tag){if(a.type===_){n(e,c.sibling),(r=i(c,a.props.children)).return=e,e=r;break e}}else if(c.elementType===a.type){n(e,c.sibling),(r=i(c,a.props)).ref=Oa(e,c,a),r.return=e,e=r;break e}n(e,c);break}t(e,c),c=c.sibling}a.type===_?((r=Xu(a.props.children,e.mode,u,a.key)).return=e,e=r):((u=Yu(a.type,a.key,a.props,null,e.mode,u)).ref=Oa(e,r,a),u.return=e,e=u)}return s(e);case k:e:{for(c=a.key;null!==r;){if(r.key===c){if(4===r.tag&&r.stateNode.containerInfo===a.containerInfo&&r.stateNode.implementation===a.implementation){n(e,r.sibling),(r=i(r,a.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=Zu(a,e.mode,u)).return=e,e=r}return s(e)}if("string"===typeof a||"number"===typeof a)return a=""+a,null!==r&&6===r.tag?(n(e,r.sibling),(r=i(r,a)).return=e,e=r):(n(e,r),(r=Qu(a,e.mode,u)).return=e,e=r),s(e);if(xa(a))return v(e,r,a,u);if(V(a))return m(e,r,a,u);if(l&&ka(e,a),"undefined"===typeof a&&!c)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(o(152,Y(e.type)||"Component"))}return n(e,r)}}var Sa=_a(!0),Ea=_a(!1),Aa={},ja=ui(Aa),Ta=ui(Aa),Ma=ui(Aa);function Ca(e){if(e===Aa)throw Error(o(174));return e}function Da(e,t){switch(li(Ma,t),li(Ta,e),li(ja,Aa),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:fe(null,"");break;default:t=fe(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ci(ja),li(ja,t)}function Ia(){ci(ja),ci(Ta),ci(Ma)}function Pa(e){Ca(Ma.current);var t=Ca(ja.current),n=fe(t,e.type);t!==n&&(li(Ta,e),li(ja,n))}function Ra(e){Ta.current===e&&(ci(ja),ci(Ta))}var La=ui(0);function Na(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Ba=null,Fa=null,Ua=!1;function za(e,t){var n=Hu(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Va(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);default:return!1}}function Ga(e){if(Ua){var t=Fa;if(t){var n=t;if(!Va(e,t)){if(!(t=Yr(n.nextSibling))||!Va(e,t))return e.flags=-1025&e.flags|2,Ua=!1,void(Ba=e);za(Ba,n)}Ba=e,Fa=Yr(t.firstChild)}else e.flags=-1025&e.flags|2,Ua=!1,Ba=e}}function Ha(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Ba=e}function Wa(e){if(e!==Ba)return!1;if(!Ua)return Ha(e),Ua=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Gr(t,e.memoizedProps))for(t=Fa;t;)za(e,t),t=Yr(t.nextSibling);if(Ha(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){Fa=Yr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}Fa=null}}else Fa=Ba?Yr(e.stateNode.nextSibling):null;return!0}function qa(){Fa=Ba=null,Ua=!1}var Ya=[];function Xa(){for(var e=0;e<Ya.length;e++)Ya[e]._workInProgressVersionPrimary=null;Ya.length=0}var Ka=x.ReactCurrentDispatcher,Qa=x.ReactCurrentBatchConfig,Za=0,Ja=null,$a=null,eo=null,to=!1,no=!1;function ro(){throw Error(o(321))}function io(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!cr(e[n],t[n]))return!1;return!0}function ao(e,t,n,r,i,a){if(Za=a,Ja=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Ka.current=null===e||null===e.memoizedState?Do:Io,e=n(r,i),no){a=0;do{if(no=!1,!(25>a))throw Error(o(301));a+=1,eo=$a=null,t.updateQueue=null,Ka.current=Po,e=n(r,i)}while(no)}if(Ka.current=Co,t=null!==$a&&null!==$a.next,Za=0,eo=$a=Ja=null,to=!1,t)throw Error(o(300));return e}function oo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===eo?Ja.memoizedState=eo=e:eo=eo.next=e,eo}function so(){if(null===$a){var e=Ja.alternate;e=null!==e?e.memoizedState:null}else e=$a.next;var t=null===eo?Ja.memoizedState:eo.next;if(null!==t)eo=t,$a=e;else{if(null===e)throw Error(o(310));e={memoizedState:($a=e).memoizedState,baseState:$a.baseState,baseQueue:$a.baseQueue,queue:$a.queue,next:null},null===eo?Ja.memoizedState=eo=e:eo=eo.next=e}return eo}function uo(e,t){return"function"===typeof t?t(e):t}function co(e){var t=so(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=$a,i=r.baseQueue,a=n.pending;if(null!==a){if(null!==i){var s=i.next;i.next=a.next,a.next=s}r.baseQueue=i=a,n.pending=null}if(null!==i){i=i.next,r=r.baseState;var u=s=a=null,c=i;do{var l=c.lane;if((Za&l)===l)null!==u&&(u=u.next={lane:0,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),r=c.eagerReducer===e?c.eagerState:e(r,c.action);else{var h={lane:l,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===u?(s=u=h,a=r):u=u.next=h,Ja.lanes|=l,zs|=l}c=c.next}while(null!==c&&c!==i);null===u?a=r:u.next=s,cr(r,t.memoizedState)||(Lo=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=u,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function lo(e){var t=so(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{a=e(a,s.action),s=s.next}while(s!==i);cr(a,t.memoizedState)||(Lo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function ho(e,t,n){var r=t._getVersion;r=r(t._source);var i=t._workInProgressVersionPrimary;if(null!==i?e=i===r:(e=e.mutableReadLanes,(e=(Za&e)===e)&&(t._workInProgressVersionPrimary=r,Ya.push(t))),e)return n(t._source);throw Ya.push(t),Error(o(350))}function fo(e,t,n,r){var i=Is;if(null===i)throw Error(o(349));var a=t._getVersion,s=a(t._source),u=Ka.current,c=u.useState((function(){return ho(i,t,n)})),l=c[1],h=c[0];c=eo;var d=e.memoizedState,f=d.refs,p=f.getSnapshot,v=d.source;d=d.subscribe;var m=Ja;return e.memoizedState={refs:f,source:t,subscribe:r},u.useEffect((function(){f.getSnapshot=n,f.setSnapshot=l;var e=a(t._source);if(!cr(s,e)){e=n(t._source),cr(h,e)||(l(e),e=fu(m),i.mutableReadLanes|=e&i.pendingLanes),e=i.mutableReadLanes,i.entangledLanes|=e;for(var r=i.entanglements,o=e;0<o;){var u=31-Gt(o),c=1<<u;r[u]|=e,o&=~c}}}),[n,t,r]),u.useEffect((function(){return r(t._source,(function(){var e=f.getSnapshot,n=f.setSnapshot;try{n(e(t._source));var r=fu(m);i.mutableReadLanes|=r&i.pendingLanes}catch(a){n((function(){throw a}))}}))}),[t,r]),cr(p,n)&&cr(v,t)&&cr(d,r)||((e={pending:null,dispatch:null,lastRenderedReducer:uo,lastRenderedState:h}).dispatch=l=Mo.bind(null,Ja,e),c.queue=e,c.baseQueue=null,h=ho(i,t,n),c.memoizedState=c.baseState=h),h}function po(e,t,n){return fo(so(),e,t,n)}function vo(e){var t=oo();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:uo,lastRenderedState:e}).dispatch=Mo.bind(null,Ja,e),[t.memoizedState,e]}function mo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=Ja.updateQueue)?(t={lastEffect:null},Ja.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function go(e){return e={current:e},oo().memoizedState=e}function yo(){return so().memoizedState}function bo(e,t,n,r){var i=oo();Ja.flags|=e,i.memoizedState=mo(1|t,n,void 0,void 0===r?null:r)}function wo(e,t,n,r){var i=so();r=void 0===r?null:r;var a=void 0;if(null!==$a){var o=$a.memoizedState;if(a=o.destroy,null!==r&&io(r,o.deps))return void mo(t,n,a,r)}Ja.flags|=e,i.memoizedState=mo(1|t,n,a,r)}function xo(e,t){return bo(516,4,e,t)}function Oo(e,t){return wo(516,4,e,t)}function ko(e,t){return wo(4,2,e,t)}function _o(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function So(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,wo(4,2,_o.bind(null,t,e),n)}function Eo(){}function Ao(e,t){var n=so();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&io(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function jo(e,t){var n=so();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&io(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function To(e,t){var n=Gi();Wi(98>n?98:n,(function(){e(!0)})),Wi(97<n?97:n,(function(){var n=Qa.transition;Qa.transition=1;try{e(!1),t()}finally{Qa.transition=n}}))}function Mo(e,t,n){var r=du(),i=fu(e),a={lane:i,action:n,eagerReducer:null,eagerState:null,next:null},o=t.pending;if(null===o?a.next=a:(a.next=o.next,o.next=a),t.pending=a,o=e.alternate,e===Ja||null!==o&&o===Ja)no=to=!0;else{if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,u=o(s,n);if(a.eagerReducer=o,a.eagerState=u,cr(u,s))return}catch(c){}pu(e,i,r)}}var Co={readContext:aa,useCallback:ro,useContext:ro,useEffect:ro,useImperativeHandle:ro,useLayoutEffect:ro,useMemo:ro,useReducer:ro,useRef:ro,useState:ro,useDebugValue:ro,useDeferredValue:ro,useTransition:ro,useMutableSource:ro,useOpaqueIdentifier:ro,unstable_isNewReconciler:!1},Do={readContext:aa,useCallback:function(e,t){return oo().memoizedState=[e,void 0===t?null:t],e},useContext:aa,useEffect:xo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,bo(4,2,_o.bind(null,t,e),n)},useLayoutEffect:function(e,t){return bo(4,2,e,t)},useMemo:function(e,t){var n=oo();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=oo();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Mo.bind(null,Ja,e),[r.memoizedState,e]},useRef:go,useState:vo,useDebugValue:Eo,useDeferredValue:function(e){var t=vo(e),n=t[0],r=t[1];return xo((function(){var t=Qa.transition;Qa.transition=1;try{r(e)}finally{Qa.transition=t}}),[e]),n},useTransition:function(){var e=vo(!1),t=e[0];return go(e=To.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,n){var r=oo();return r.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:n},fo(r,e,t,n)},useOpaqueIdentifier:function(){if(Ua){var e=!1,t=function(e){return{$$typeof:R,toString:e,valueOf:e}}((function(){throw e||(e=!0,n("r:"+(Kr++).toString(36))),Error(o(355))})),n=vo(t)[1];return 0===(2&Ja.mode)&&(Ja.flags|=516,mo(5,(function(){n("r:"+(Kr++).toString(36))}),void 0,null)),t}return vo(t="r:"+(Kr++).toString(36)),t},unstable_isNewReconciler:!1},Io={readContext:aa,useCallback:Ao,useContext:aa,useEffect:Oo,useImperativeHandle:So,useLayoutEffect:ko,useMemo:jo,useReducer:co,useRef:yo,useState:function(){return co(uo)},useDebugValue:Eo,useDeferredValue:function(e){var t=co(uo),n=t[0],r=t[1];return Oo((function(){var t=Qa.transition;Qa.transition=1;try{r(e)}finally{Qa.transition=t}}),[e]),n},useTransition:function(){var e=co(uo)[0];return[yo().current,e]},useMutableSource:po,useOpaqueIdentifier:function(){return co(uo)[0]},unstable_isNewReconciler:!1},Po={readContext:aa,useCallback:Ao,useContext:aa,useEffect:Oo,useImperativeHandle:So,useLayoutEffect:ko,useMemo:jo,useReducer:lo,useRef:yo,useState:function(){return lo(uo)},useDebugValue:Eo,useDeferredValue:function(e){var t=lo(uo),n=t[0],r=t[1];return Oo((function(){var t=Qa.transition;Qa.transition=1;try{r(e)}finally{Qa.transition=t}}),[e]),n},useTransition:function(){var e=lo(uo)[0];return[yo().current,e]},useMutableSource:po,useOpaqueIdentifier:function(){return lo(uo)[0]},unstable_isNewReconciler:!1},Ro=x.ReactCurrentOwner,Lo=!1;function No(e,t,n,r){t.child=null===e?Ea(t,null,n,r):Sa(t,e.child,n,r)}function Bo(e,t,n,r,i){n=n.render;var a=t.ref;return ia(t,i),r=ao(e,t,n,r,a,i),null===e||Lo?(t.flags|=1,No(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,as(e,t,i))}function Fo(e,t,n,r,i,a){if(null===e){var o=n.type;return"function"!==typeof o||Wu(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Yu(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Uo(e,t,o,r,i,a))}return o=e.child,0===(i&a)&&(i=o.memoizedProps,(n=null!==(n=n.compare)?n:hr)(i,r)&&e.ref===t.ref)?as(e,t,a):(t.flags|=1,(e=qu(o,r)).ref=t.ref,e.return=t,t.child=e)}function Uo(e,t,n,r,i,a){if(null!==e&&hr(e.memoizedProps,r)&&e.ref===t.ref){if(Lo=!1,0===(a&i))return t.lanes=e.lanes,as(e,t,a);0!==(16384&e.flags)&&(Lo=!0)}return Go(e,t,n,r,a)}function zo(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode||"unstable-defer-without-hiding"===r.mode)if(0===(4&t.mode))t.memoizedState={baseLanes:0},Ou(t,n);else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},Ou(t,e),null;t.memoizedState={baseLanes:0},Ou(t,null!==a?a.baseLanes:n)}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Ou(t,r);return No(e,t,i,n),t.child}function Vo(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=128)}function Go(e,t,n,r,i){var a=mi(n)?pi:di.current;return a=vi(t,a),ia(t,i),n=ao(e,t,n,r,a,i),null===e||Lo?(t.flags|=1,No(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,as(e,t,i))}function Ho(e,t,n,r,i){if(mi(n)){var a=!0;wi(t)}else a=!1;if(ia(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),ya(t,n,r),wa(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=aa(c):c=vi(t,c=mi(n)?pi:di.current);var l=n.getDerivedStateFromProps,h="function"===typeof l||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==c)&&ba(t,o,r,c),oa=!1;var d=t.memoizedState;o.state=d,da(t,r,o,i),u=t.memoizedState,s!==r||d!==u||fi.current||oa?("function"===typeof l&&(va(t,n,l,r),u=t.memoizedState),(s=oa||ga(t,n,s,r,d,u,c))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4)):("function"===typeof o.componentDidMount&&(t.flags|=4),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=c,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4),r=!1)}else{o=t.stateNode,ua(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:Qi(t.type,s),o.props=c,h=t.pendingProps,d=o.context,"object"===typeof(u=n.contextType)&&null!==u?u=aa(u):u=vi(t,u=mi(n)?pi:di.current);var f=n.getDerivedStateFromProps;(l="function"===typeof f||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||d!==u)&&ba(t,o,r,u),oa=!1,d=t.memoizedState,o.state=d,da(t,r,o,i);var p=t.memoizedState;s!==h||d!==p||fi.current||oa?("function"===typeof f&&(va(t,n,f,r),p=t.memoizedState),(c=oa||ga(t,n,c,r,d,p,u))?(l||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,u),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,u)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=u,r=c):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),r=!1)}return Wo(e,t,n,r,a,i)}function Wo(e,t,n,r,i,a){Vo(e,t);var o=0!==(64&t.flags);if(!r&&!o)return i&&xi(t,n,!1),as(e,t,a);r=t.stateNode,Ro.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=Sa(t,e.child,null,a),t.child=Sa(t,null,s,a)):No(e,t,s,a),t.memoizedState=r.state,i&&xi(t,n,!0),t.child}function qo(e){var t=e.stateNode;t.pendingContext?yi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&yi(0,t.context,!1),Da(e,t.containerInfo)}var Yo,Xo,Ko,Qo,Zo={dehydrated:null,retryLane:0};function Jo(e,t,n){var r,i=t.pendingProps,a=La.current,o=!1;return(r=0!==(64&t.flags))||(r=(null===e||null!==e.memoizedState)&&0!==(2&a)),r?(o=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===i.fallback||!0===i.unstable_avoidThisFallback||(a|=1),li(La,1&a),null===e?(void 0!==i.fallback&&Ga(t),e=i.children,a=i.fallback,o?(e=$o(t,e,a,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Zo,e):"number"===typeof i.unstable_expectedLoadTime?(e=$o(t,e,a,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Zo,t.lanes=33554432,e):((n=Ku({mode:"visible",children:e},t.mode,n,null)).return=t,t.child=n)):(e.memoizedState,o?(i=ts(e,t,i.children,i.fallback,n),o=t.child,a=e.child.memoizedState,o.memoizedState=null===a?{baseLanes:n}:{baseLanes:a.baseLanes|n},o.childLanes=e.childLanes&~n,t.memoizedState=Zo,i):(n=es(e,t,i.children,n),t.memoizedState=null,n))}function $o(e,t,n,r){var i=e.mode,a=e.child;return t={mode:"hidden",children:t},0===(2&i)&&null!==a?(a.childLanes=0,a.pendingProps=t):a=Ku(t,i,0,null),n=Xu(n,i,r,null),a.return=e,n.return=e,a.sibling=n,e.child=a,n}function es(e,t,n,r){var i=e.child;return e=i.sibling,n=qu(i,{mode:"visible",children:n}),0===(2&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=n}function ts(e,t,n,r,i){var a=t.mode,o=e.child;e=o.sibling;var s={mode:"hidden",children:n};return 0===(2&a)&&t.child!==o?((n=t.child).childLanes=0,n.pendingProps=s,null!==(o=n.lastEffect)?(t.firstEffect=n.firstEffect,t.lastEffect=o,o.nextEffect=null):t.firstEffect=t.lastEffect=null):n=qu(o,s),null!==e?r=qu(e,r):(r=Xu(r,a,i,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}function ns(e,t){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),ra(e.return,t)}function rs(e,t,n,r,i,a){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,lastEffect:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i,o.lastEffect=a)}function is(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(No(e,t,r.children,n),0!==(2&(r=La.current)))r=1&r|2,t.flags|=64;else{if(null!==e&&0!==(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ns(e,n);else if(19===e.tag)ns(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(li(La,r),0===(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Na(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),rs(t,!1,i,n,a,t.lastEffect);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Na(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}rs(t,!0,n,null,a,t.lastEffect);break;case"together":rs(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function as(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),zs|=t.lanes,0!==(n&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=qu(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=qu(e,e.pendingProps)).return=t;n.sibling=null}return t.child}return null}function os(e,t){if(!Ua)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function ss(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:case 17:return mi(t.type)&&gi(),null;case 3:return Ia(),ci(fi),ci(di),Xa(),(r=t.stateNode).pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Wa(t)?t.flags|=4:r.hydrate||(t.flags|=256)),Xo(t),null;case 5:Ra(t);var a=Ca(Ma.current);if(n=t.type,null!==e&&null!=t.stateNode)Ko(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=128);else{if(!r){if(null===t.stateNode)throw Error(o(166));return null}if(e=Ca(ja.current),Wa(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[Zr]=t,r[Jr]=s,n){case"dialog":Tr("cancel",r),Tr("close",r);break;case"iframe":case"object":case"embed":Tr("load",r);break;case"video":case"audio":for(e=0;e<Sr.length;e++)Tr(Sr[e],r);break;case"source":Tr("error",r);break;case"img":case"image":case"link":Tr("error",r),Tr("load",r);break;case"details":Tr("toggle",r);break;case"input":ee(r,s),Tr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Tr("invalid",r);break;case"textarea":ue(r,s),Tr("invalid",r)}for(var c in ke(n,s),e=null,s)s.hasOwnProperty(c)&&(a=s[c],"children"===c?"string"===typeof a?r.textContent!==a&&(e=["children",a]):"number"===typeof a&&r.textContent!==""+a&&(e=["children",""+a]):u.hasOwnProperty(c)&&null!=a&&"onScroll"===c&&Tr("scroll",r));switch(n){case"input":Q(r),re(r,s,!0);break;case"textarea":Q(r),le(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=Fr)}r=e,t.updateQueue=r,null!==r&&(t.flags|=4)}else{switch(c=9===a.nodeType?a:a.ownerDocument,e===he.html&&(e=de(n)),e===he.html?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=c.createElement(n,{is:r.is}):(e=c.createElement(n),"select"===n&&(c=e,r.multiple?c.multiple=!0:r.size&&(c.size=r.size))):e=c.createElementNS(e,n),e[Zr]=t,e[Jr]=r,Yo(e,t,!1,!1),t.stateNode=e,c=_e(n,r),n){case"dialog":Tr("cancel",e),Tr("close",e),a=r;break;case"iframe":case"object":case"embed":Tr("load",e),a=r;break;case"video":case"audio":for(a=0;a<Sr.length;a++)Tr(Sr[a],e);a=r;break;case"source":Tr("error",e),a=r;break;case"img":case"image":case"link":Tr("error",e),Tr("load",e),a=r;break;case"details":Tr("toggle",e),a=r;break;case"input":ee(e,r),a=$(e,r),Tr("invalid",e);break;case"option":a=ae(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=i({},r,{value:void 0}),Tr("invalid",e);break;case"textarea":ue(e,r),a=se(e,r),Tr("invalid",e);break;default:a=r}ke(n,a);var l=a;for(s in l)if(l.hasOwnProperty(s)){var h=l[s];"style"===s?xe(e,h):"dangerouslySetInnerHTML"===s?null!=(h=h?h.__html:void 0)&&me(e,h):"children"===s?"string"===typeof h?("textarea"!==n||""!==h)&&ge(e,h):"number"===typeof h&&ge(e,""+h):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(u.hasOwnProperty(s)?null!=h&&"onScroll"===s&&Tr("scroll",e):null!=h&&w(e,s,h,c))}switch(n){case"input":Q(e),re(e,r,!1);break;case"textarea":Q(e),le(e);break;case"option":null!=r.value&&e.setAttribute("value",""+X(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?oe(e,!!r.multiple,s,!1):null!=r.defaultValue&&oe(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=Fr)}Vr(n,r)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)Qo(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));n=Ca(Ma.current),Ca(ja.current),Wa(t)?(r=t.stateNode,n=t.memoizedProps,r[Zr]=t,r.nodeValue!==n&&(t.flags|=4)):((r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[Zr]=t,t.stateNode=r)}return null;case 13:return ci(La),r=t.memoizedState,0!==(64&t.flags)?(t.lanes=n,t):(r=null!==r,n=!1,null===e?void 0!==t.memoizedProps.fallback&&Wa(t):n=null!==e.memoizedState,r&&!n&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&La.current)?0===Bs&&(Bs=3):(0!==Bs&&3!==Bs||(Bs=4),null===Is||0===(134217727&zs)&&0===(134217727&Vs)||yu(Is,Rs))),(r||n)&&(t.flags|=4),null);case 4:return Ia(),Xo(t),null===e&&Cr(t.stateNode.containerInfo),null;case 10:return na(t),null;case 19:if(ci(La),null===(r=t.memoizedState))return null;if(s=0!==(64&t.flags),null===(c=r.rendering))if(s)os(r,!1);else{if(0!==Bs||null!==e&&0!==(64&e.flags))for(e=t.child;null!==e;){if(null!==(c=Na(e))){for(t.flags|=64,os(r,!1),null!==(s=c.updateQueue)&&(t.updateQueue=s,t.flags|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,null===(c=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,e=c.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return li(La,1&La.current|2),t.child}e=e.sibling}null!==r.tail&&Vi()>qs&&(t.flags|=64,s=!0,os(r,!1),t.lanes=33554432)}else{if(!s)if(null!==(e=Na(c))){if(t.flags|=64,s=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),os(r,!0),null===r.tail&&"hidden"===r.tailMode&&!c.alternate&&!Ua)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*Vi()-r.renderingStartTime>qs&&1073741824!==n&&(t.flags|=64,s=!0,os(r,!1),t.lanes=33554432);r.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=r.last)?n.sibling=c:t.child=c,r.last=c)}return null!==r.tail?(n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=Vi(),n.sibling=null,t=La.current,li(La,s?1&t|2:1&t),n):null;case 23:case 24:return ku(),null!==e&&null!==e.memoizedState!==(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==r.mode&&(t.flags|=4),null}throw Error(o(156,t.tag))}function us(e){switch(e.tag){case 1:mi(e.type)&&gi();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(Ia(),ci(fi),ci(di),Xa(),0!==(64&(t=e.flags)))throw Error(o(285));return e.flags=-4097&t|64,e;case 5:return Ra(e),null;case 13:return ci(La),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return ci(La),null;case 4:return Ia(),null;case 10:return na(e),null;case 23:case 24:return ku(),null;default:return null}}function cs(e,t){try{var n="",r=t;do{n+=q(r),r=r.return}while(r);var i=n}catch(a){i="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:i}}function ls(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}Yo=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Xo=function(){},Ko=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Ca(ja.current);var o,s=null;switch(n){case"input":a=$(e,a),r=$(e,r),s=[];break;case"option":a=ae(e,a),r=ae(e,r),s=[];break;case"select":a=i({},a,{value:void 0}),r=i({},r,{value:void 0}),s=[];break;case"textarea":a=se(e,a),r=se(e,r),s=[];break;default:"function"!==typeof a.onClick&&"function"===typeof r.onClick&&(e.onclick=Fr)}for(h in ke(n,r),n=null,a)if(!r.hasOwnProperty(h)&&a.hasOwnProperty(h)&&null!=a[h])if("style"===h){var c=a[h];for(o in c)c.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(u.hasOwnProperty(h)?s||(s=[]):(s=s||[]).push(h,null));for(h in r){var l=r[h];if(c=null!=a?a[h]:void 0,r.hasOwnProperty(h)&&l!==c&&(null!=l||null!=c))if("style"===h)if(c){for(o in c)!c.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&c[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(h,n)),n=l;else"dangerouslySetInnerHTML"===h?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(s=s||[]).push(h,l)):"children"===h?"string"!==typeof l&&"number"!==typeof l||(s=s||[]).push(h,""+l):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(u.hasOwnProperty(h)?(null!=l&&"onScroll"===h&&Tr("scroll",e),s||c===l||(s=[])):"object"===typeof l&&null!==l&&l.$$typeof===R?l.toString():(s=s||[]).push(h,l))}n&&(s=s||[]).push("style",n);var h=s;(t.updateQueue=h)&&(t.flags|=4)}},Qo=function(e,t,n,r){n!==r&&(t.flags|=4)};var hs="function"===typeof WeakMap?WeakMap:Map;function ds(e,t,n){(n=ca(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Qs||(Qs=!0,Zs=r),ls(0,t)},n}function fs(e,t,n){(n=ca(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return ls(0,t),r(i)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){"function"!==typeof r&&(null===Js?Js=new Set([this]):Js.add(this),ls(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}var ps="function"===typeof WeakSet?WeakSet:Set;function vs(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){Uu(e,n)}else t.current=null}function ms(e,t){switch(t.tag){case 0:case 11:case 15:case 22:case 5:case 6:case 4:case 17:return;case 1:if(256&t.flags&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:Qi(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&qr(t.stateNode.containerInfo))}throw Error(o(163))}function gs(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3===(3&e.tag)){var r=e.create;e.destroy=r()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var i=e;r=i.next,0!==(4&(i=i.tag))&&0!==(1&i)&&(Nu(n,e),Lu(n,e)),e=r}while(e!==t)}return;case 1:return e=n.stateNode,4&n.flags&&(null===t?e.componentDidMount():(r=n.elementType===n.type?t.memoizedProps:Qi(n.type,t.memoizedProps),e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=n.updateQueue)&&fa(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:case 1:e=n.child.stateNode}fa(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.flags&&Vr(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:case 19:case 17:case 20:case 21:case 23:case 24:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&xt(n)))))}throw Error(o(163))}function ys(e,t){for(var n=e;;){if(5===n.tag){var r=n.stateNode;if(t)"function"===typeof(r=r.style).setProperty?r.setProperty("display","none","important"):r.display="none";else{r=n.stateNode;var i=n.memoizedProps.style;i=void 0!==i&&null!==i&&i.hasOwnProperty("display")?i.display:null,r.style.display=we("display",i)}}else if(6===n.tag)n.stateNode.nodeValue=t?"":n.memoizedProps;else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===e)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function bs(e,t){if(ki&&"function"===typeof ki.onCommitFiberUnmount)try{ki.onCommitFiberUnmount(Oi,t)}catch(a){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e=e.next;do{var r=n,i=r.destroy;if(r=r.tag,void 0!==i)if(0!==(4&r))Nu(t,n);else{r=t;try{i()}catch(a){Uu(r,a)}}n=n.next}while(n!==e)}break;case 1:if(vs(t),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(a){Uu(t,a)}break;case 5:vs(t);break;case 4:Ss(e,t)}}function ws(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function xs(e){return 5===e.tag||3===e.tag||4===e.tag}function Os(e){e:{for(var t=e.return;null!==t;){if(xs(t))break e;t=t.return}throw Error(o(160))}var n=t;switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(o(161))}16&n.flags&&(ge(t,""),n.flags&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||xs(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break e}}r?ks(e,n,t):_s(e,n,t)}function ks(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Fr));else if(4!==r&&null!==(e=e.child))for(ks(e,t,n),e=e.sibling;null!==e;)ks(e,t,n),e=e.sibling}function _s(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(_s(e,t,n),e=e.sibling;null!==e;)_s(e,t,n),e=e.sibling}function Ss(e,t){for(var n,r,i=t,a=!1;;){if(!a){a=i.return;e:for(;;){if(null===a)throw Error(o(160));switch(n=a.stateNode,a.tag){case 5:r=!1;break e;case 3:case 4:n=n.containerInfo,r=!0;break e}a=a.return}a=!0}if(5===i.tag||6===i.tag){e:for(var s=e,u=i,c=u;;)if(bs(s,c),null!==c.child&&4!==c.tag)c.child.return=c,c=c.child;else{if(c===u)break e;for(;null===c.sibling;){if(null===c.return||c.return===u)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}r?(s=n,u=i.stateNode,8===s.nodeType?s.parentNode.removeChild(u):s.removeChild(u)):n.removeChild(i.stateNode)}else if(4===i.tag){if(null!==i.child){n=i.stateNode.containerInfo,r=!0,i.child.return=i,i=i.child;continue}}else if(bs(e,i),null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;4===(i=i.return).tag&&(a=!1)}i.sibling.return=i.return,i=i.sibling}}function Es(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{3===(3&r.tag)&&(e=r.destroy,r.destroy=void 0,void 0!==e&&e()),r=r.next}while(r!==n)}return;case 1:case 12:case 17:return;case 5:if(null!=(n=t.stateNode)){r=t.memoizedProps;var i=null!==e?e.memoizedProps:r;e=t.type;var a=t.updateQueue;if(t.updateQueue=null,null!==a){for(n[Jr]=r,"input"===e&&"radio"===r.type&&null!=r.name&&te(n,r),_e(e,i),t=_e(e,r),i=0;i<a.length;i+=2){var s=a[i],u=a[i+1];"style"===s?xe(n,u):"dangerouslySetInnerHTML"===s?me(n,u):"children"===s?ge(n,u):w(n,s,u,t)}switch(e){case"input":ne(n,r);break;case"textarea":ce(n,r);break;case"select":e=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(a=r.value)?oe(n,!!r.multiple,a,!1):e!==!!r.multiple&&(null!=r.defaultValue?oe(n,!!r.multiple,r.defaultValue,!0):oe(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(o(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((n=t.stateNode).hydrate&&(n.hydrate=!1,xt(n.containerInfo)));case 13:return null!==t.memoizedState&&(Ws=Vi(),ys(t.child,!0)),void As(t);case 19:return void As(t);case 23:case 24:return void ys(t,null!==t.memoizedState)}throw Error(o(163))}function As(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new ps),t.forEach((function(t){var r=Vu.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function js(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&(null!==(t=t.memoizedState)&&null===t.dehydrated)}var Ts=Math.ceil,Ms=x.ReactCurrentDispatcher,Cs=x.ReactCurrentOwner,Ds=0,Is=null,Ps=null,Rs=0,Ls=0,Ns=ui(0),Bs=0,Fs=null,Us=0,zs=0,Vs=0,Gs=0,Hs=null,Ws=0,qs=1/0;function Ys(){qs=Vi()+500}var Xs,Ks=null,Qs=!1,Zs=null,Js=null,$s=!1,eu=null,tu=90,nu=[],ru=[],iu=null,au=0,ou=null,su=-1,uu=0,cu=0,lu=null,hu=!1;function du(){return 0!==(48&Ds)?Vi():-1!==su?su:su=Vi()}function fu(e){if(0===(2&(e=e.mode)))return 1;if(0===(4&e))return 99===Gi()?1:2;if(0===uu&&(uu=Us),0!==Ki.transition){0!==cu&&(cu=null!==Hs?Hs.pendingLanes:0),e=uu;var t=4186112&~cu;return 0===(t&=-t)&&(0===(t=(e=4186112&~e)&-e)&&(t=8192)),t}return e=Gi(),0!==(4&Ds)&&98===e?e=Ft(12,uu):e=Ft(e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),uu),e}function pu(e,t,n){if(50<au)throw au=0,ou=null,Error(o(185));if(null===(e=vu(e,t)))return null;Vt(e,t,n),e===Is&&(Vs|=t,4===Bs&&yu(e,Rs));var r=Gi();1===t?0!==(8&Ds)&&0===(48&Ds)?bu(e):(mu(e,n),0===Ds&&(Ys(),Yi())):(0===(4&Ds)||98!==r&&99!==r||(null===iu?iu=new Set([e]):iu.add(e)),mu(e,n)),Hs=e}function vu(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function mu(e,t){for(var n=e.callbackNode,r=e.suspendedLanes,i=e.pingedLanes,a=e.expirationTimes,s=e.pendingLanes;0<s;){var u=31-Gt(s),c=1<<u,l=a[u];if(-1===l){if(0===(c&r)||0!==(c&i)){l=t,Lt(c);var h=Rt;a[u]=10<=h?l+250:6<=h?l+5e3:-1}}else l<=t&&(e.expiredLanes|=c);s&=~c}if(r=Nt(e,e===Is?Rs:0),t=Rt,0===r)null!==n&&(n!==Li&&Ei(n),e.callbackNode=null,e.callbackPriority=0);else{if(null!==n){if(e.callbackPriority===t)return;n!==Li&&Ei(n)}15===t?(n=bu.bind(null,e),null===Bi?(Bi=[n],Fi=Si(Ci,Xi)):Bi.push(n),n=Li):14===t?n=qi(99,bu.bind(null,e)):(n=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(o(358,e))}}(t),n=qi(n,gu.bind(null,e))),e.callbackPriority=t,e.callbackNode=n}}function gu(e){if(su=-1,cu=uu=0,0!==(48&Ds))throw Error(o(327));var t=e.callbackNode;if(Ru()&&e.callbackNode!==t)return null;var n=Nt(e,e===Is?Rs:0);if(0===n)return null;var r=n,i=Ds;Ds|=16;var a=Eu();for(Is===e&&Rs===r||(Ys(),_u(e,r));;)try{Tu();break}catch(u){Su(e,u)}if(ta(),Ms.current=a,Ds=i,null!==Ps?r=0:(Is=null,Rs=0,r=Bs),0!==(Us&Vs))_u(e,0);else if(0!==r){if(2===r&&(Ds|=64,e.hydrate&&(e.hydrate=!1,qr(e.containerInfo)),0!==(n=Bt(e))&&(r=Au(e,n))),1===r)throw t=Fs,_u(e,0),yu(e,n),mu(e,Vi()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=n,r){case 0:case 1:throw Error(o(345));case 2:case 5:Du(e);break;case 3:if(yu(e,n),(62914560&n)===n&&10<(r=Ws+500-Vi())){if(0!==Nt(e,0))break;if(((i=e.suspendedLanes)&n)!==n){du(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=Hr(Du.bind(null,e),r);break}Du(e);break;case 4:if(yu(e,n),(4186112&n)===n)break;for(r=e.eventTimes,i=-1;0<n;){var s=31-Gt(n);a=1<<s,(s=r[s])>i&&(i=s),n&=~a}if(n=i,10<(n=(120>(n=Vi()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Ts(n/1960))-n)){e.timeoutHandle=Hr(Du.bind(null,e),n);break}Du(e);break;default:throw Error(o(329))}}return mu(e,Vi()),e.callbackNode===t?gu.bind(null,e):null}function yu(e,t){for(t&=~Gs,t&=~Vs,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Gt(t),r=1<<n;e[n]=-1,t&=~r}}function bu(e){if(0!==(48&Ds))throw Error(o(327));if(Ru(),e===Is&&0!==(e.expiredLanes&Rs)){var t=Rs,n=Au(e,t);0!==(Us&Vs)&&(n=Au(e,t=Nt(e,t)))}else n=Au(e,t=Nt(e,0));if(0!==e.tag&&2===n&&(Ds|=64,e.hydrate&&(e.hydrate=!1,qr(e.containerInfo)),0!==(t=Bt(e))&&(n=Au(e,t))),1===n)throw n=Fs,_u(e,0),yu(e,t),mu(e,Vi()),n;return e.finishedWork=e.current.alternate,e.finishedLanes=t,Du(e),mu(e,Vi()),null}function wu(e,t){var n=Ds;Ds|=1;try{return e(t)}finally{0===(Ds=n)&&(Ys(),Yi())}}function xu(e,t){var n=Ds;Ds&=-2,Ds|=8;try{return e(t)}finally{0===(Ds=n)&&(Ys(),Yi())}}function Ou(e,t){li(Ns,Ls),Ls|=t,Us|=t}function ku(){Ls=Ns.current,ci(Ns)}function _u(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,Wr(n)),null!==Ps)for(n=Ps.return;null!==n;){var r=n;switch(r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&gi();break;case 3:Ia(),ci(fi),ci(di),Xa();break;case 5:Ra(r);break;case 4:Ia();break;case 13:case 19:ci(La);break;case 10:na(r);break;case 23:case 24:ku()}n=n.return}Is=e,Ps=qu(e.current,null),Rs=Ls=Us=t,Bs=0,Fs=null,Gs=Vs=zs=0}function Su(e,t){for(;;){var n=Ps;try{if(ta(),Ka.current=Co,to){for(var r=Ja.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}to=!1}if(Za=0,eo=$a=Ja=null,no=!1,Cs.current=null,null===n||null===n.return){Bs=1,Fs=t,Ps=null;break}e:{var a=e,o=n.return,s=n,u=t;if(t=Rs,s.flags|=2048,s.firstEffect=s.lastEffect=null,null!==u&&"object"===typeof u&&"function"===typeof u.then){var c=u;if(0===(2&s.mode)){var l=s.alternate;l?(s.updateQueue=l.updateQueue,s.memoizedState=l.memoizedState,s.lanes=l.lanes):(s.updateQueue=null,s.memoizedState=null)}var h=0!==(1&La.current),d=o;do{var f;if(f=13===d.tag){var p=d.memoizedState;if(null!==p)f=null!==p.dehydrated;else{var v=d.memoizedProps;f=void 0!==v.fallback&&(!0!==v.unstable_avoidThisFallback||!h)}}if(f){var m=d.updateQueue;if(null===m){var g=new Set;g.add(c),d.updateQueue=g}else m.add(c);if(0===(2&d.mode)){if(d.flags|=64,s.flags|=16384,s.flags&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var y=ca(-1,1);y.tag=2,la(s,y)}s.lanes|=1;break e}u=void 0,s=t;var b=a.pingCache;if(null===b?(b=a.pingCache=new hs,u=new Set,b.set(c,u)):void 0===(u=b.get(c))&&(u=new Set,b.set(c,u)),!u.has(s)){u.add(s);var w=zu.bind(null,a,c,s);c.then(w,w)}d.flags|=4096,d.lanes=t;break e}d=d.return}while(null!==d);u=Error((Y(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==Bs&&(Bs=2),u=cs(u,s),d=o;do{switch(d.tag){case 3:a=u,d.flags|=4096,t&=-t,d.lanes|=t,ha(d,ds(0,a,t));break e;case 1:a=u;var x=d.type,O=d.stateNode;if(0===(64&d.flags)&&("function"===typeof x.getDerivedStateFromError||null!==O&&"function"===typeof O.componentDidCatch&&(null===Js||!Js.has(O)))){d.flags|=4096,t&=-t,d.lanes|=t,ha(d,fs(d,a,t));break e}}d=d.return}while(null!==d)}Cu(n)}catch(k){t=k,Ps===n&&null!==n&&(Ps=n=n.return);continue}break}}function Eu(){var e=Ms.current;return Ms.current=Co,null===e?Co:e}function Au(e,t){var n=Ds;Ds|=16;var r=Eu();for(Is===e&&Rs===t||_u(e,t);;)try{ju();break}catch(i){Su(e,i)}if(ta(),Ds=n,Ms.current=r,null!==Ps)throw Error(o(261));return Is=null,Rs=0,Bs}function ju(){for(;null!==Ps;)Mu(Ps)}function Tu(){for(;null!==Ps&&!Ai();)Mu(Ps)}function Mu(e){var t=Xs(e.alternate,e,Ls);e.memoizedProps=e.pendingProps,null===t?Cu(e):Ps=t,Cs.current=null}function Cu(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(2048&t.flags)){if(null!==(n=ss(n,t,Ls)))return void(Ps=n);if(24!==(n=t).tag&&23!==n.tag||null===n.memoizedState||0!==(1073741824&Ls)||0===(4&n.mode)){for(var r=0,i=n.child;null!==i;)r|=i.lanes|i.childLanes,i=i.sibling;n.childLanes=r}null!==e&&0===(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(n=us(t)))return n.flags&=2047,void(Ps=n);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Ps=t);Ps=t=e}while(null!==t);0===Bs&&(Bs=5)}function Du(e){var t=Gi();return Wi(99,Iu.bind(null,e,t)),null}function Iu(e,t){do{Ru()}while(null!==eu);if(0!==(48&Ds))throw Error(o(327));var n=e.finishedWork;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null;var r=n.lanes|n.childLanes,i=r,a=e.pendingLanes&~i;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=i,e.mutableReadLanes&=i,e.entangledLanes&=i,i=e.entanglements;for(var s=e.eventTimes,u=e.expirationTimes;0<a;){var c=31-Gt(a),l=1<<c;i[c]=0,s[c]=-1,u[c]=-1,a&=~l}if(null!==iu&&0===(24&r)&&iu.has(e)&&iu.delete(e),e===Is&&(Ps=Is=null,Rs=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,null!==r){if(i=Ds,Ds|=32,Cs.current=null,Ur=Xt,mr(s=vr())){if("selectionStart"in s)u={start:s.selectionStart,end:s.selectionEnd};else e:if(u=(u=s.ownerDocument)&&u.defaultView||window,(l=u.getSelection&&u.getSelection())&&0!==l.rangeCount){u=l.anchorNode,a=l.anchorOffset,c=l.focusNode,l=l.focusOffset;try{u.nodeType,c.nodeType}catch(E){u=null;break e}var h=0,d=-1,f=-1,p=0,v=0,m=s,g=null;t:for(;;){for(var y;m!==u||0!==a&&3!==m.nodeType||(d=h+a),m!==c||0!==l&&3!==m.nodeType||(f=h+l),3===m.nodeType&&(h+=m.nodeValue.length),null!==(y=m.firstChild);)g=m,m=y;for(;;){if(m===s)break t;if(g===u&&++p===a&&(d=h),g===c&&++v===l&&(f=h),null!==(y=m.nextSibling))break;g=(m=g).parentNode}m=y}u=-1===d||-1===f?null:{start:d,end:f}}else u=null;u=u||{start:0,end:0}}else u=null;zr={focusedElem:s,selectionRange:u},Xt=!1,lu=null,hu=!1,Ks=r;do{try{Pu()}catch(E){if(null===Ks)throw Error(o(330));Uu(Ks,E),Ks=Ks.nextEffect}}while(null!==Ks);lu=null,Ks=r;do{try{for(s=e;null!==Ks;){var b=Ks.flags;if(16&b&&ge(Ks.stateNode,""),128&b){var w=Ks.alternate;if(null!==w){var x=w.ref;null!==x&&("function"===typeof x?x(null):x.current=null)}}switch(1038&b){case 2:Os(Ks),Ks.flags&=-3;break;case 6:Os(Ks),Ks.flags&=-3,Es(Ks.alternate,Ks);break;case 1024:Ks.flags&=-1025;break;case 1028:Ks.flags&=-1025,Es(Ks.alternate,Ks);break;case 4:Es(Ks.alternate,Ks);break;case 8:Ss(s,u=Ks);var O=u.alternate;ws(u),null!==O&&ws(O)}Ks=Ks.nextEffect}}catch(E){if(null===Ks)throw Error(o(330));Uu(Ks,E),Ks=Ks.nextEffect}}while(null!==Ks);if(x=zr,w=vr(),b=x.focusedElem,s=x.selectionRange,w!==b&&b&&b.ownerDocument&&pr(b.ownerDocument.documentElement,b)){null!==s&&mr(b)&&(w=s.start,void 0===(x=s.end)&&(x=w),"selectionStart"in b?(b.selectionStart=w,b.selectionEnd=Math.min(x,b.value.length)):(x=(w=b.ownerDocument||document)&&w.defaultView||window).getSelection&&(x=x.getSelection(),u=b.textContent.length,O=Math.min(s.start,u),s=void 0===s.end?O:Math.min(s.end,u),!x.extend&&O>s&&(u=s,s=O,O=u),u=fr(b,O),a=fr(b,s),u&&a&&(1!==x.rangeCount||x.anchorNode!==u.node||x.anchorOffset!==u.offset||x.focusNode!==a.node||x.focusOffset!==a.offset)&&((w=w.createRange()).setStart(u.node,u.offset),x.removeAllRanges(),O>s?(x.addRange(w),x.extend(a.node,a.offset)):(w.setEnd(a.node,a.offset),x.addRange(w))))),w=[];for(x=b;x=x.parentNode;)1===x.nodeType&&w.push({element:x,left:x.scrollLeft,top:x.scrollTop});for("function"===typeof b.focus&&b.focus(),b=0;b<w.length;b++)(x=w[b]).element.scrollLeft=x.left,x.element.scrollTop=x.top}Xt=!!Ur,zr=Ur=null,e.current=n,Ks=r;do{try{for(b=e;null!==Ks;){var k=Ks.flags;if(36&k&&gs(b,Ks.alternate,Ks),128&k){w=void 0;var _=Ks.ref;if(null!==_){var S=Ks.stateNode;Ks.tag,w=S,"function"===typeof _?_(w):_.current=w}}Ks=Ks.nextEffect}}catch(E){if(null===Ks)throw Error(o(330));Uu(Ks,E),Ks=Ks.nextEffect}}while(null!==Ks);Ks=null,Ni(),Ds=i}else e.current=n;if($s)$s=!1,eu=e,tu=t;else for(Ks=r;null!==Ks;)t=Ks.nextEffect,Ks.nextEffect=null,8&Ks.flags&&((k=Ks).sibling=null,k.stateNode=null),Ks=t;if(0===(r=e.pendingLanes)&&(Js=null),1===r?e===ou?au++:(au=0,ou=e):au=0,n=n.stateNode,ki&&"function"===typeof ki.onCommitFiberRoot)try{ki.onCommitFiberRoot(Oi,n,void 0,64===(64&n.current.flags))}catch(E){}if(mu(e,Vi()),Qs)throw Qs=!1,e=Zs,Zs=null,e;return 0!==(8&Ds)||Yi(),null}function Pu(){for(;null!==Ks;){var e=Ks.alternate;hu||null===lu||(0!==(8&Ks.flags)?$e(Ks,lu)&&(hu=!0):13===Ks.tag&&js(e,Ks)&&$e(Ks,lu)&&(hu=!0));var t=Ks.flags;0!==(256&t)&&ms(e,Ks),0===(512&t)||$s||($s=!0,qi(97,(function(){return Ru(),null}))),Ks=Ks.nextEffect}}function Ru(){if(90!==tu){var e=97<tu?97:tu;return tu=90,Wi(e,Bu)}return!1}function Lu(e,t){nu.push(t,e),$s||($s=!0,qi(97,(function(){return Ru(),null})))}function Nu(e,t){ru.push(t,e),$s||($s=!0,qi(97,(function(){return Ru(),null})))}function Bu(){if(null===eu)return!1;var e=eu;if(eu=null,0!==(48&Ds))throw Error(o(331));var t=Ds;Ds|=32;var n=ru;ru=[];for(var r=0;r<n.length;r+=2){var i=n[r],a=n[r+1],s=i.destroy;if(i.destroy=void 0,"function"===typeof s)try{s()}catch(c){if(null===a)throw Error(o(330));Uu(a,c)}}for(n=nu,nu=[],r=0;r<n.length;r+=2){i=n[r],a=n[r+1];try{var u=i.create;i.destroy=u()}catch(c){if(null===a)throw Error(o(330));Uu(a,c)}}for(u=e.current.firstEffect;null!==u;)e=u.nextEffect,u.nextEffect=null,8&u.flags&&(u.sibling=null,u.stateNode=null),u=e;return Ds=t,Yi(),!0}function Fu(e,t,n){la(e,t=ds(0,t=cs(n,t),1)),t=du(),null!==(e=vu(e,1))&&(Vt(e,1,t),mu(e,t))}function Uu(e,t){if(3===e.tag)Fu(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){Fu(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Js||!Js.has(r))){var i=fs(n,e=cs(t,e),1);if(la(n,i),i=du(),null!==(n=vu(n,1)))Vt(n,1,i),mu(n,i);else if("function"===typeof r.componentDidCatch&&(null===Js||!Js.has(r)))try{r.componentDidCatch(t,e)}catch(a){}break}}n=n.return}}function zu(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=du(),e.pingedLanes|=e.suspendedLanes&n,Is===e&&(Rs&n)===n&&(4===Bs||3===Bs&&(62914560&Rs)===Rs&&500>Vi()-Ws?_u(e,0):Gs|=n),mu(e,t)}function Vu(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(0===(2&(t=e.mode))?t=1:0===(4&t)?t=99===Gi()?1:2:(0===uu&&(uu=Us),0===(t=Ut(62914560&~uu))&&(t=4194304))),n=du(),null!==(e=vu(e,t))&&(Vt(e,t,n),mu(e,n))}function Gu(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Hu(e,t,n,r){return new Gu(e,t,n,r)}function Wu(e){return!(!(e=e.prototype)||!e.isReactComponent)}function qu(e,t){var n=e.alternate;return null===n?((n=Hu(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Yu(e,t,n,r,i,a){var s=2;if(r=e,"function"===typeof e)Wu(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case _:return Xu(n.children,i,a,t);case L:s=8,i|=16;break;case S:s=8,i|=1;break;case E:return(e=Hu(12,n,t,8|i)).elementType=E,e.type=E,e.lanes=a,e;case M:return(e=Hu(13,n,t,i)).type=M,e.elementType=M,e.lanes=a,e;case C:return(e=Hu(19,n,t,i)).elementType=C,e.lanes=a,e;case N:return Ku(n,i,a,t);case B:return(e=Hu(24,n,t,i)).elementType=B,e.lanes=a,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case A:s=10;break e;case j:s=9;break e;case T:s=11;break e;case D:s=14;break e;case I:s=16,r=null;break e;case P:s=22;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Hu(s,n,t,i)).elementType=e,t.type=r,t.lanes=a,t}function Xu(e,t,n,r){return(e=Hu(7,e,r,t)).lanes=n,e}function Ku(e,t,n,r){return(e=Hu(23,e,r,t)).elementType=N,e.lanes=n,e}function Qu(e,t,n){return(e=Hu(6,e,null,t)).lanes=n,e}function Zu(e,t,n){return(t=Hu(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Ju(e,t,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=zt(0),this.expirationTimes=zt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zt(0),this.mutableSourceEagerHydrationData=null}function $u(e,t,n,r){var i=t.current,a=du(),s=fu(i);e:if(n){t:{if(Ke(n=n._reactInternals)!==n||1!==n.tag)throw Error(o(170));var u=n;do{switch(u.tag){case 3:u=u.stateNode.context;break t;case 1:if(mi(u.type)){u=u.stateNode.__reactInternalMemoizedMergedChildContext;break t}}u=u.return}while(null!==u);throw Error(o(171))}if(1===n.tag){var c=n.type;if(mi(c)){n=bi(n,c,u);break e}}n=u}else n=hi;return null===t.context?t.context=n:t.pendingContext=n,(t=ca(a,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),la(i,t),pu(i,s,a),s}function ec(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function tc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function nc(e,t){tc(e,t),(e=e.alternate)&&tc(e,t)}function rc(e,t,n){var r=null!=n&&null!=n.hydrationOptions&&n.hydrationOptions.mutableSources||null;if(n=new Ju(e,t,null!=n&&!0===n.hydrate),t=Hu(3,null,null,2===t?7:1===t?3:0),n.current=t,t.stateNode=n,sa(t),e[$r]=n.current,Cr(8===e.nodeType?e.parentNode:e),r)for(e=0;e<r.length;e++){var i=(t=r[e])._getVersion;i=i(t._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[t,i]:n.mutableSourceEagerHydrationData.push(t,i)}this._internalRoot=n}function ic(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function ac(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a._internalRoot;if("function"===typeof i){var s=i;i=function(){var e=ec(o);s.call(e)}}$u(t,o,e,i)}else{if(a=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new rc(e,0,t?{hydrate:!0}:void 0)}(n,r),o=a._internalRoot,"function"===typeof i){var u=i;i=function(){var e=ec(o);u.call(e)}}xu((function(){$u(t,o,e,i)}))}return ec(o)}function oc(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!ic(t))throw Error(o(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:k,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)}Xs=function(e,t,n){var r=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||fi.current)Lo=!0;else{if(0===(n&r)){switch(Lo=!1,t.tag){case 3:qo(t),qa();break;case 5:Pa(t);break;case 1:mi(t.type)&&wi(t);break;case 4:Da(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value;var i=t.type._context;li(Zi,i._currentValue),i._currentValue=r;break;case 13:if(null!==t.memoizedState)return 0!==(n&t.child.childLanes)?Jo(e,t,n):(li(La,1&La.current),null!==(t=as(e,t,n))?t.sibling:null);li(La,1&La.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(64&e.flags)){if(r)return is(e,t,n);t.flags|=64}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),li(La,La.current),r)break;return null;case 23:case 24:return t.lanes=0,zo(e,t,n)}return as(e,t,n)}Lo=0!==(16384&e.flags)}else Lo=!1;switch(t.lanes=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=vi(t,di.current),ia(t,n),i=ao(null,t,r,e,i,n),t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,mi(r)){var a=!0;wi(t)}else a=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,sa(t);var s=r.getDerivedStateFromProps;"function"===typeof s&&va(t,r,s,e),i.updater=ma,t.stateNode=i,i._reactInternals=t,wa(t,r,e,n),t=Wo(null,t,r,!0,a,n)}else t.tag=0,No(null,t,i,n),t=t.child;return t;case 16:i=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=(a=i._init)(i._payload),t.type=i,a=t.tag=function(e){if("function"===typeof e)return Wu(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===T)return 11;if(e===D)return 14}return 2}(i),e=Qi(i,e),a){case 0:t=Go(null,t,i,e,n);break e;case 1:t=Ho(null,t,i,e,n);break e;case 11:t=Bo(null,t,i,e,n);break e;case 14:t=Fo(null,t,i,Qi(i.type,e),r,n);break e}throw Error(o(306,i,""))}return t;case 0:return r=t.type,i=t.pendingProps,Go(e,t,r,i=t.elementType===r?i:Qi(r,i),n);case 1:return r=t.type,i=t.pendingProps,Ho(e,t,r,i=t.elementType===r?i:Qi(r,i),n);case 3:if(qo(t),r=t.updateQueue,null===e||null===r)throw Error(o(282));if(r=t.pendingProps,i=null!==(i=t.memoizedState)?i.element:null,ua(e,t),da(t,r,null,n),(r=t.memoizedState.element)===i)qa(),t=as(e,t,n);else{if((a=(i=t.stateNode).hydrate)&&(Fa=Yr(t.stateNode.containerInfo.firstChild),Ba=t,a=Ua=!0),a){if(null!=(e=i.mutableSourceEagerHydrationData))for(i=0;i<e.length;i+=2)(a=e[i])._workInProgressVersionPrimary=e[i+1],Ya.push(a);for(n=Ea(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else No(e,t,r,n),qa();t=t.child}return t;case 5:return Pa(t),null===e&&Ga(t),r=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,s=i.children,Gr(r,i)?s=null:null!==a&&Gr(r,a)&&(t.flags|=16),Vo(e,t),No(e,t,s,n),t.child;case 6:return null===e&&Ga(t),null;case 13:return Jo(e,t,n);case 4:return Da(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Sa(t,null,r,n):No(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Bo(e,t,r,i=t.elementType===r?i:Qi(r,i),n);case 7:return No(e,t,t.pendingProps,n),t.child;case 8:case 12:return No(e,t,t.pendingProps.children,n),t.child;case 10:e:{r=t.type._context,i=t.pendingProps,s=t.memoizedProps,a=i.value;var u=t.type._context;if(li(Zi,u._currentValue),u._currentValue=a,null!==s)if(u=s.value,0===(a=cr(u,a)?0:0|("function"===typeof r._calculateChangedBits?r._calculateChangedBits(u,a):1073741823))){if(s.children===i.children&&!fi.current){t=as(e,t,n);break e}}else for(null!==(u=t.child)&&(u.return=t);null!==u;){var c=u.dependencies;if(null!==c){s=u.child;for(var l=c.firstContext;null!==l;){if(l.context===r&&0!==(l.observedBits&a)){1===u.tag&&((l=ca(-1,n&-n)).tag=2,la(u,l)),u.lanes|=n,null!==(l=u.alternate)&&(l.lanes|=n),ra(u.return,n),c.lanes|=n;break}l=l.next}}else s=10===u.tag&&u.type===t.type?null:u.child;if(null!==s)s.return=u;else for(s=u;null!==s;){if(s===t){s=null;break}if(null!==(u=s.sibling)){u.return=s.return,s=u;break}s=s.return}u=s}No(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=(a=t.pendingProps).children,ia(t,n),r=r(i=aa(i,a.unstable_observedBits)),t.flags|=1,No(e,t,r,n),t.child;case 14:return a=Qi(i=t.type,t.pendingProps),Fo(e,t,i,a=Qi(i.type,a),r,n);case 15:return Uo(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Qi(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,mi(r)?(e=!0,wi(t)):e=!1,ia(t,n),ya(t,r,i),wa(t,r,i,n),Wo(null,t,r,!0,e,n);case 19:return is(e,t,n);case 23:case 24:return zo(e,t,n)}throw Error(o(156,t.tag))},rc.prototype.render=function(e){$u(e,this._internalRoot,null,null)},rc.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;$u(null,e,null,(function(){t[$r]=null}))},et=function(e){13===e.tag&&(pu(e,4,du()),nc(e,4))},tt=function(e){13===e.tag&&(pu(e,67108864,du()),nc(e,67108864))},nt=function(e){if(13===e.tag){var t=du(),n=fu(e);pu(e,n,t),nc(e,n)}},rt=function(e,t){return t()},Ee=function(e,t,n){switch(t){case"input":if(ne(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=ii(r);if(!i)throw Error(o(90));Z(r),ne(r,i)}}}break;case"textarea":ce(e,n);break;case"select":null!=(t=n.value)&&oe(e,!!n.multiple,t,!1)}},De=wu,Ie=function(e,t,n,r,i){var a=Ds;Ds|=4;try{return Wi(98,e.bind(null,t,n,r,i))}finally{0===(Ds=a)&&(Ys(),Yi())}},Pe=function(){0===(49&Ds)&&(function(){if(null!==iu){var e=iu;iu=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,mu(e,Vi())}))}Yi()}(),Ru())},Re=function(e,t){var n=Ds;Ds|=2;try{return e(t)}finally{0===(Ds=n)&&(Ys(),Yi())}};var sc={Events:[ni,ri,ii,Me,Ce,Ru,{current:!1}]},uc={findFiberByHostInstance:ti,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},cc={bundleType:uc.bundleType,version:uc.version,rendererPackageName:uc.rendererPackageName,rendererConfig:uc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Je(e))?null:e.stateNode},findFiberByHostInstance:uc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var lc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lc.isDisabled&&lc.supportsFiber)try{Oi=lc.inject(cc),ki=lc}catch(ve){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sc,t.createPortal=oc,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw Error(o(268,Object.keys(e)))}return e=null===(e=Je(t))?null:e.stateNode},t.flushSync=function(e,t){var n=Ds;if(0!==(48&n))return e(t);Ds|=1;try{if(e)return Wi(99,e.bind(null,t))}finally{Ds=n,Yi()}},t.hydrate=function(e,t,n){if(!ic(t))throw Error(o(200));return ac(null,e,t,!0,n)},t.render=function(e,t,n){if(!ic(t))throw Error(o(200));return ac(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!ic(e))throw Error(o(40));return!!e._reactRootContainer&&(xu((function(){ac(null,null,e,!1,(function(){e._reactRootContainer=null,e[$r]=null}))})),!0)},t.unstable_batchedUpdates=wu,t.unstable_createPortal=function(e,t){return oc(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!ic(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return ac(e,t,n,!1,r)},t.version="17.0.2"},function(e,t,n){"use strict";e.exports=n(63)},function(e,t,n){"use strict";var r,i,a,o;if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var u=Date,c=u.now();t.unstable_now=function(){return u.now()-c}}if("undefined"===typeof window||"function"!==typeof MessageChannel){var l=null,h=null,d=function e(){if(null!==l)try{var n=t.unstable_now();l(!0,n),l=null}catch(r){throw setTimeout(e,0),r}};r=function(e){null!==l?setTimeout(r,0,e):(l=e,setTimeout(d,0))},i=function(e,t){h=setTimeout(e,t)},a=function(){clearTimeout(h)},t.unstable_shouldYield=function(){return!1},o=t.unstable_forceFrameRate=function(){}}else{var f=window.setTimeout,p=window.clearTimeout;if("undefined"!==typeof console){var v=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!==typeof v&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var m=!1,g=null,y=-1,b=5,w=0;t.unstable_shouldYield=function(){return t.unstable_now()>=w},o=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):b=0<e?Math.floor(1e3/e):5};var x=new MessageChannel,O=x.port2;x.port1.onmessage=function(){if(null!==g){var e=t.unstable_now();w=e+b;try{g(!0,e)?O.postMessage(null):(m=!1,g=null)}catch(n){throw O.postMessage(null),n}}else m=!1},r=function(e){g=e,m||(m=!0,O.postMessage(null))},i=function(e,n){y=f((function(){e(t.unstable_now())}),n)},a=function(){p(y),y=-1}}function k(e,t){var n=e.length;e.push(t);e:for(;;){var r=n-1>>>1,i=e[r];if(!(void 0!==i&&0<E(i,t)))break e;e[r]=t,e[n]=i,n=r}}function _(e){return void 0===(e=e[0])?null:e}function S(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length;r<i;){var a=2*(r+1)-1,o=e[a],s=a+1,u=e[s];if(void 0!==o&&0>E(o,n))void 0!==u&&0>E(u,o)?(e[r]=u,e[s]=n,r=s):(e[r]=o,e[a]=n,r=a);else{if(!(void 0!==u&&0>E(u,n)))break e;e[r]=u,e[s]=n,r=s}}}return t}return null}function E(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var A=[],j=[],T=1,M=null,C=3,D=!1,I=!1,P=!1;function R(e){for(var t=_(j);null!==t;){if(null===t.callback)S(j);else{if(!(t.startTime<=e))break;S(j),t.sortIndex=t.expirationTime,k(A,t)}t=_(j)}}function L(e){if(P=!1,R(e),!I)if(null!==_(A))I=!0,r(N);else{var t=_(j);null!==t&&i(L,t.startTime-e)}}function N(e,n){I=!1,P&&(P=!1,a()),D=!0;var r=C;try{for(R(n),M=_(A);null!==M&&(!(M.expirationTime>n)||e&&!t.unstable_shouldYield());){var o=M.callback;if("function"===typeof o){M.callback=null,C=M.priorityLevel;var s=o(M.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?M.callback=s:M===_(A)&&S(A),R(n)}else S(A);M=_(A)}if(null!==M)var u=!0;else{var c=_(j);null!==c&&i(L,c.startTime-n),u=!1}return u}finally{M=null,C=r,D=!1}}var B=o;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){I||D||(I=!0,r(N))},t.unstable_getCurrentPriorityLevel=function(){return C},t.unstable_getFirstCallbackNode=function(){return _(A)},t.unstable_next=function(e){switch(C){case 1:case 2:case 3:var t=3;break;default:t=C}var n=C;C=t;try{return e()}finally{C=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=B,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=C;C=e;try{return t()}finally{C=n}},t.unstable_scheduleCallback=function(e,n,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var u=-1;break;case 2:u=250;break;case 5:u=1073741823;break;case 4:u=1e4;break;default:u=5e3}return e={id:T++,callback:n,priorityLevel:e,startTime:o,expirationTime:u=o+u,sortIndex:-1},o>s?(e.sortIndex=o,k(j,e),null===_(A)&&e===_(j)&&(P?a():P=!0,i(L,o-s))):(e.sortIndex=u,k(A,e),I||D||(I=!0,r(N))),e},t.unstable_wrapCallback=function(e){var t=C;return function(){var n=C;C=t;try{return e.apply(this,arguments)}finally{C=n}}}},,,function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=c(e),o=r[0],s=r[1],u=new a(function(e,t,n){return 3*(t+n)/4-n}(0,o,s)),l=0,h=s>0?o-4:o;for(n=0;n<h;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;2===s&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,u[l++]=255&t);1===s&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t);return u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a=[],o=16383,s=0,u=n-i;s<u;s+=o)a.push(l(e,s,s+o>u?u:s+o));1===i?(t=e[n-1],a.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],a.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return a.join("")};for(var r=[],i=[],a="undefined"!==typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=o.length;s<u;++s)r[s]=o[s],i[o.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var i,a,o=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(r[(a=i)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,h=n?i-1:0,d=n?-1:1,f=e[t+h];for(h+=d,a=f&(1<<-l)-1,f>>=-l,l+=s;l>0;a=256*a+e[t+h],h+=d,l-=8);for(o=a&(1<<-l)-1,a>>=-l,l+=r;l>0;o=256*o+e[t+h],h+=d,l-=8);if(0===a)a=1-c;else{if(a===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),a-=c}return(f?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,u,c=8*a-i-1,l=(1<<c)-1,h=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:a-1,p=r?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+h>=1?d/u:d*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=l?(s=0,o=l):o+h>=1?(s=(t*u-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[n+f]=255&o,f+=p,o/=256,c-=8);e[n+f-p]|=128*v}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";n(49);var r=n(12),i=60103;if(t.Fragment=60107,"function"===typeof Symbol&&Symbol.for){var a=Symbol.for;i=a("react.element"),t.Fragment=a("react.fragment")}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s=Object.prototype.hasOwnProperty,u={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,a={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)s.call(t,r)&&!u.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:l,props:a,_owner:o.current}}t.jsx=c,t.jsxs=c},function(e,t,n){"use strict";n(72)},function(e,t,n){"use strict";(function(e){var t=n(0),r=n(1),i=n(2),a=n(3),o=n(28),s=n(17),u=n(24),c=n(11),l="@firebase/auth-compat",h="0.3.3",d=1e3;function f(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(c.q)();return!("file:"!==f()&&"ionic:"!==f()&&"capacitor:"!==f()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(c.q)();return Object(c.u)()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(c.q)();return/Edge\/\d+/.test(e)}(e)}function m(){try{var e=self.localStorage,t=s.s();if(e)return e.setItem(t,"1"),e.removeItem(t),!v()||Object(c.v)()}catch(n){return g()&&Object(c.v)()}return!1}function g(){return"undefined"!==typeof e&&"WorkerGlobalScope"in e&&"importScripts"in e}function y(){return("http:"===f()||"https:"===f()||Object(c.s)()||p())&&!(Object(c.y)()||Object(c.x)())&&m()&&!g()}function b(){return p()&&"undefined"!==typeof document}function w(){return x.apply(this,arguments)}function x(){return(x=Object(a.a)(Object(t.a)().mark((function e(){return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b()){e.next=2;break}return e.abrupt("return",!1);case 2:return e.abrupt("return",new Promise((function(e){var t=setTimeout((function(){e(!1)}),d);document.addEventListener("deviceready",(function(){clearTimeout(t),e(!0)}))})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var O={LOCAL:"local",NONE:"none",SESSION:"session"},k=s.p,_="persistence";function S(e,t){k(Object.values(O).includes(t),e,"invalid-persistence-type"),Object(c.y)()?k(t!==O.SESSION,e,"unsupported-persistence-type"):Object(c.x)()?k(t===O.NONE,e,"unsupported-persistence-type"):g()?k(t===O.NONE||t===O.LOCAL&&Object(c.v)(),e,"unsupported-persistence-type"):k(t===O.NONE||m(),e,"unsupported-persistence-type")}function E(e){return A.apply(this,arguments)}function A(){return(A=Object(a.a)(Object(t.a)().mark((function e(n){var r,i;return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._initializationPromise;case 2:r=j(),i=s.w(_,n.config.apiKey,n.name),r&&r.setItem(i,n._getPersistence());case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(){var e;try{return(null===(e="undefined"!==typeof window?window:null)||void 0===e?void 0:e.sessionStorage)||null}catch(t){return null}}var T=s.p,M=function(){function e(){Object(r.a)(this,e),this.browserResolver=s.t(s.A),this.cordovaResolver=s.t(s.F),this.underlyingResolver=null,this._redirectPersistence=s.B,this._completeRedirectFn=s.u,this._overrideRedirectResult=s.v}return Object(i.a)(e,[{key:"_initialize",value:function(){var e=Object(a.a)(Object(t.a)().mark((function e(n){return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.selectUnderlyingResolver();case 2:return e.abrupt("return",this.assertedUnderlyingResolver._initialize(n));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_openPopup",value:function(){var e=Object(a.a)(Object(t.a)().mark((function e(n,r,i,a){return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.selectUnderlyingResolver();case 2:return e.abrupt("return",this.assertedUnderlyingResolver._openPopup(n,r,i,a));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_openRedirect",value:function(){var e=Object(a.a)(Object(t.a)().mark((function e(n,r,i,a){return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.selectUnderlyingResolver();case 2:return e.abrupt("return",this.assertedUnderlyingResolver._openRedirect(n,r,i,a));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_isIframeWebStorageSupported",value:function(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}},{key:"_originValidation",value:function(e){return this.assertedUnderlyingResolver._originValidation(e)}},{key:"_shouldInitProactively",get:function(){return b()||this.browserResolver._shouldInitProactively}},{key:"assertedUnderlyingResolver",get:function(){return T(this.underlyingResolver,"internal-error"),this.underlyingResolver}},{key:"selectUnderlyingResolver",value:function(){var e=Object(a.a)(Object(t.a)().mark((function e(){var n;return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.underlyingResolver){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,w();case 4:n=e.sent,this.underlyingResolver=n?this.cordovaResolver:this.browserResolver;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function C(e){return e.unwrap()}function D(e){var t=(e instanceof c.c?e.customData:e)._tokenResponse;if(!t)return null;if(!(e instanceof c.c)&&"temporaryProof"in t&&"phoneNumber"in t)return s.i.credentialFromResult(e);var n,r=t.providerId;if(!r||r===s.k.PASSWORD)return null;switch(r){case s.k.GOOGLE:n=s.f;break;case s.k.FACEBOOK:n=s.d;break;case s.k.GITHUB:n=s.e;break;case s.k.TWITTER:n=s.o;break;default:var i=t.oauthIdToken,a=t.oauthAccessToken,o=t.oauthTokenSecret,u=t.pendingToken,l=t.nonce;return a||o||i||u?u?r.startsWith("saml.")?s.m._create(r,u):s.g._fromParams({providerId:r,signInMethod:r,pendingToken:u,idToken:i,accessToken:a}):new s.h(r).credential({idToken:i,accessToken:a,rawNonce:l}):null}return e instanceof c.c?n.credentialFromError(e):n.credentialFromResult(e)}function I(e,t){return t.catch((function(t){throw t instanceof c.c&&function(e,t){var n,r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===(null===t||void 0===t?void 0:t.code))t.resolver=new L(e,s.K(e,t));else if(r){var i=D(t),a=t;i&&(a.credential=i,a.tenantId=r.tenantId||void 0,a.email=r.email||void 0,a.phoneNumber=r.phoneNumber||void 0)}}(e,t),t})).then((function(e){var t,n=e.operationType,r=e.user;return{operationType:n,credential:(t=e,D(t)),additionalUserInfo:s.J(e),user:N.getOrCreate(r)}}))}function P(e,t){return R.apply(this,arguments)}function R(){return(R=Object(a.a)(Object(t.a)().mark((function e(n,r){var i;return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r;case 2:return i=e.sent,e.abrupt("return",{verificationId:i.verificationId,confirm:function(e){return I(n,i.confirm(e))}});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var L=function(){function e(t,n){Object(r.a)(this,e),this.resolver=n,this.auth=t.wrapped()}return Object(i.a)(e,[{key:"session",get:function(){return this.resolver.session}},{key:"hints",get:function(){return this.resolver.hints}},{key:"resolveSignIn",value:function(e){return I(C(this.auth),this.resolver.resolveSignIn(e))}}]),e}(),N=function(){function e(t){Object(r.a)(this,e),this._delegate=t,this.multiFactor=s.T(t)}return Object(i.a)(e,[{key:"delete",value:function(){return this._delegate.delete()}},{key:"reload",value:function(){return this._delegate.reload()}},{key:"toJSON",value:function(){return this._delegate.toJSON()}},{key:"getIdTokenResult",value:function(e){return this._delegate.getIdTokenResult(e)}},{key:"getIdToken",value:function(e){return this._delegate.getIdToken(e)}},{key:"linkAndRetrieveDataWithCredential",value:function(e){return this.linkWithCredential(e)}},{key:"linkWithCredential",value:function(){var e=Object(a.a)(Object(t.a)().mark((function e(n){return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",I(this.auth,s.P(this._delegate,n)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"linkWithPhoneNumber",value:function(){var e=Object(a.a)(Object(t.a)().mark((function e(n,r){return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",P(this.auth,s.Q(this._delegate,n,r)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"linkWithPopup",value:function(){var e=Object(a.a)(Object(t.a)().mark((function e(n){return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",I(this.auth,s.R(this._delegate,n,M)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"linkWithRedirect",value:function(){var e=Object(a.a)(Object(t.a)().mark((function e(n){return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(s.q(this.auth));case 2:return e.abrupt("return",s.S(this._delegate,n,M));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"reauthenticateAndRetrieveDataWithCredential",value:function(e){return this.reauthenticateWithCredential(e)}},{key:"reauthenticateWithCredential",value:function(){var e=Object(a.a)(Object(t.a)().mark((function e(n){return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",I(this.auth,s.U(this._delegate,n)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"reauthenticateWithPhoneNumber",value:function(e,t){return P(this.auth,s.V(this._delegate,e,t))}},{key:"reauthenticateWithPopup",value:function(e){return I(this.auth,s.W(this._delegate,e,M))}},{key:"reauthenticateWithRedirect",value:function(){var e=Object(a.a)(Object(t.a)().mark((function e(n){return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(s.q(this.auth));case 2:return e.abrupt("return",s.X(this._delegate,n,M));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendEmailVerification",value:function(e){return s.Y(this._delegate,e)}},{key:"unlink",value:function(){var e=Object(a.a)(Object(t.a)().mark((function e(n){return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.jb(this._delegate,n);case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateEmail",value:function(e){return s.kb(this._delegate,e)}},{key:"updatePassword",value:function(e){return s.lb(this._delegate,e)}},{key:"updatePhoneNumber",value:function(e){return s.mb(this._delegate,e)}},{key:"updateProfile",value:function(e){return s.nb(this._delegate,e)}},{key:"verifyBeforeUpdateEmail",value:function(e,t){return s.ob(this._delegate,e,t)}},{key:"emailVerified",get:function(){return this._delegate.emailVerified}},{key:"isAnonymous",get:function(){return this._delegate.isAnonymous}},{key:"metadata",get:function(){return this._delegate.metadata}},{key:"phoneNumber",get:function(){return this._delegate.phoneNumber}},{key:"providerData",get:function(){return this._delegate.providerData}},{key:"refreshToken",get:function(){return this._delegate.refreshToken}},{key:"tenantId",get:function(){return this._delegate.tenantId}},{key:"displayName",get:function(){return this._delegate.displayName}},{key:"email",get:function(){return this._delegate.email}},{key:"photoURL",get:function(){return this._delegate.photoURL}},{key:"providerId",get:function(){return this._delegate.providerId}},{key:"uid",get:function(){return this._delegate.uid}},{key:"auth",get:function(){return this._delegate.auth}}],[{key:"getOrCreate",value:function(t){return e.USER_MAP.has(t)||e.USER_MAP.set(t,new e(t)),e.USER_MAP.get(t)}}]),e}();N.USER_MAP=new WeakMap;var B=s.p,F=function(){function e(t,n){if(Object(r.a)(this,e),this.app=t,n.isInitialized())return this._delegate=n.getImmediate(),void this.linkUnderlyingAuth();var i=t.options.apiKey;B(i,"invalid-api-key",{appName:t.name}),B(i,"invalid-api-key",{appName:t.name});var a="undefined"!==typeof window?M:void 0;this._delegate=n.initialize({options:{persistence:z(i,t.name),popupRedirectResolver:a}}),this._delegate._updateErrorMap(s.H),this.linkUnderlyingAuth()}return Object(i.a)(e,[{key:"emulatorConfig",get:function(){return this._delegate.emulatorConfig}},{key:"currentUser",get:function(){return this._delegate.currentUser?N.getOrCreate(this._delegate.currentUser):null}},{key:"languageCode",get:function(){return this._delegate.languageCode},set:function(e){this._delegate.languageCode=e}},{key:"settings",get:function(){return this._delegate.settings}},{key:"tenantId",get:function(){return this._delegate.tenantId},set:function(e){this._delegate.tenantId=e}},{key:"useDeviceLanguage",value:function(){this._delegate.useDeviceLanguage()}},{key:"signOut",value:function(){return this._delegate.signOut()}},{key:"useEmulator",value:function(e,t){s.E(this._delegate,e,t)}},{key:"applyActionCode",value:function(e){return s.y(this._delegate,e)}},{key:"checkActionCode",value:function(e){return s.C(this._delegate,e)}},{key:"confirmPasswordReset",value:function(e,t){return s.D(this._delegate,e,t)}},{key:"createUserWithEmailAndPassword",value:function(){var e=Object(a.a)(Object(t.a)().mark((function e(n,r){return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",I(this._delegate,s.G(this._delegate,n,r)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchProvidersForEmail",value:function(e){return this.fetchSignInMethodsForEmail(e)}},{key:"fetchSignInMethodsForEmail",value:function(e){return s.I(this._delegate,e)}},{key:"isSignInWithEmailLink",value:function(e){return s.O(this._delegate,e)}},{key:"getRedirectResult",value:function(){var e=Object(a.a)(Object(t.a)().mark((function e(){var n;return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return B(y(),this._delegate,"operation-not-supported-in-this-environment"),e.next=3,s.L(this._delegate,M);case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return",{credential:null,user:null});case 6:return e.abrupt("return",I(this._delegate,Promise.resolve(n)));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addFrameworkForLogging",value:function(e){s.x(this._delegate,e)}},{key:"onAuthStateChanged",value:function(e,t,n){var r=U(e,t,n),i=r.next,a=r.error,o=r.complete;return this._delegate.onAuthStateChanged(i,a,o)}},{key:"onIdTokenChanged",value:function(e,t,n){var r=U(e,t,n),i=r.next,a=r.error,o=r.complete;return this._delegate.onIdTokenChanged(i,a,o)}},{key:"sendSignInLinkToEmail",value:function(e,t){return s.ab(this._delegate,e,t)}},{key:"sendPasswordResetEmail",value:function(e,t){return s.Z(this._delegate,e,t||void 0)}},{key:"setPersistence",value:function(){var e=Object(a.a)(Object(t.a)().mark((function e(n){var r,i;return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:S(this._delegate,n),e.t0=n,e.next=e.t0===O.SESSION?4:e.t0===O.LOCAL?6:e.t0===O.NONE?11:13;break;case 4:return r=s.B,e.abrupt("break",14);case 6:return e.next=8,s.t(s.N)._isAvailable();case 8:return i=e.sent,r=i?s.N:s.z,e.abrupt("break",14);case 11:return r=s.M,e.abrupt("break",14);case 13:return e.abrupt("return",s.r("argument-error",{appName:this._delegate.name}));case 14:return e.abrupt("return",this._delegate.setPersistence(r));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signInAndRetrieveDataWithCredential",value:function(e){return this.signInWithCredential(e)}},{key:"signInAnonymously",value:function(){return I(this._delegate,s.bb(this._delegate))}},{key:"signInWithCredential",value:function(e){return I(this._delegate,s.cb(this._delegate,e))}},{key:"signInWithCustomToken",value:function(e){return I(this._delegate,s.db(this._delegate,e))}},{key:"signInWithEmailAndPassword",value:function(e,t){return I(this._delegate,s.eb(this._delegate,e,t))}},{key:"signInWithEmailLink",value:function(e,t){return I(this._delegate,s.fb(this._delegate,e,t))}},{key:"signInWithPhoneNumber",value:function(e,t){return P(this._delegate,s.gb(this._delegate,e,t))}},{key:"signInWithPopup",value:function(){var e=Object(a.a)(Object(t.a)().mark((function e(n){return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return B(y(),this._delegate,"operation-not-supported-in-this-environment"),e.abrupt("return",I(this._delegate,s.hb(this._delegate,n,M)));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signInWithRedirect",value:function(){var e=Object(a.a)(Object(t.a)().mark((function e(n){return Object(t.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return B(y(),this._delegate,"operation-not-supported-in-this-environment"),e.next=3,E(this._delegate);case 3:return e.abrupt("return",s.ib(this._delegate,n,M));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateCurrentUser",value:function(e){return this._delegate.updateCurrentUser(e)}},{key:"verifyPasswordResetCode",value:function(e){return s.pb(this._delegate,e)}},{key:"unwrap",value:function(){return this._delegate}},{key:"_delete",value:function(){return this._delegate._delete()}},{key:"linkUnderlyingAuth",value:function(){var e=this;this._delegate.wrapped=function(){return e}}}]),e}();function U(e,t,n){var r=e;"function"!==typeof e&&(r=e.next,t=e.error,n=e.complete);var i=r;return{next:function(e){return i(e&&N.getOrCreate(e))},error:t,complete:n}}function z(e,t){var n=function(e,t){var n=j();if(!n)return[];var r=s.w(_,e,t);switch(n.getItem(r)){case O.NONE:return[s.M];case O.LOCAL:return[s.N,s.B];case O.SESSION:return[s.B];default:return[]}}(e,t);if("undefined"===typeof self||n.includes(s.N)||n.push(s.N),"undefined"!==typeof window)for(var r=0,i=[s.z,s.B];r<i.length;r++){var a=i[r];n.includes(a)||n.push(a)}return n.includes(s.M)||n.push(s.M),n}F.Persistence=O;var V=function(){function e(){Object(r.a)(this,e),this.providerId="phone",this._delegate=new s.i(C(o.a.auth()))}return Object(i.a)(e,[{key:"verifyPhoneNumber",value:function(e,t){return this._delegate.verifyPhoneNumber(e,t)}},{key:"unwrap",value:function(){return this._delegate}}],[{key:"credential",value:function(e,t){return s.i.credential(e,t)}}]),e}();V.PHONE_SIGN_IN_METHOD=s.i.PHONE_SIGN_IN_METHOD,V.PROVIDER_ID=s.i.PROVIDER_ID;var G,H=s.p,W=function(){function e(t,n){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.a.app();Object(r.a)(this,e),H(null===(i=a.options)||void 0===i?void 0:i.apiKey,"invalid-api-key",{appName:a.name}),this._delegate=new s.l(t,n,a.auth()),this.type=this._delegate.type}return Object(i.a)(e,[{key:"clear",value:function(){this._delegate.clear()}},{key:"render",value:function(){return this._delegate.render()}},{key:"verify",value:function(){return this._delegate.verify()}}]),e}(),q="auth-compat";(G=o.a).INTERNAL.registerComponent(new u.a(q,(function(e){var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new F(t,n)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:s.a.EMAIL_SIGNIN,PASSWORD_RESET:s.a.PASSWORD_RESET,RECOVER_EMAIL:s.a.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:s.a.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:s.a.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:s.a.VERIFY_EMAIL}},EmailAuthProvider:s.c,FacebookAuthProvider:s.d,GithubAuthProvider:s.e,GoogleAuthProvider:s.f,OAuthProvider:s.h,SAMLAuthProvider:s.n,PhoneAuthProvider:V,PhoneMultiFactorGenerator:s.j,RecaptchaVerifier:W,TwitterAuthProvider:s.o,Auth:F,AuthCredential:s.b,Error:c.c}).setInstantiationMode("LAZY").setMultipleInstances(!1)),G.registerVersion(l,h)}).call(this,n(37))},function(e,t,n){(function(t){var r=n(74),i=n(75);function a(e){console.log("[dotenv][DEBUG] ".concat(e))}var o="\n",s=/^\s*([\w.-]+)\s*=\s*(.*)?\s*$/,u=/\\n/g,c=/\n|\r|\r\n/;function l(e,t){var n=Boolean(t&&t.debug),r={};return e.toString().split(c).forEach((function(e,t){var i=e.match(s);if(null!=i){var c=i[1],l=i[2]||"",h=l.length-1,d='"'===l[0]&&'"'===l[h];"'"===l[0]&&"'"===l[h]||d?(l=l.substring(1,h),d&&(l=l.replace(u,o))):l=l.trim(),r[c]=l}else n&&a("did not match key and value when parsing line ".concat(t+1,": ").concat(e))})),r}e.exports.config=function(e){var n=i.resolve(t.cwd(),".env"),o="utf8",s=!1;e&&(null!=e.path&&(n=e.path),null!=e.encoding&&(o=e.encoding),null!=e.debug&&(s=!0));try{var u=l(r.readFileSync(n,{encoding:o}),{debug:s});return Object.keys(u).forEach((function(e){Object.prototype.hasOwnProperty.call(Object({NODE_ENV:"production",PUBLIC_URL:"/CCPortfolio",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_API_KEY:"AIzaSyA3lsHu2D92yOvSdqZIXJgJNjoUT0VzY6E",REACT_APP_FIREBASE_APP_ID:"1:419198628817:web:40a35523550576fe4de6f0",REACT_APP_FIREBASE_AUTH_DOMAIN:"dev-1-263119.firebaseapp.com",REACT_APP_FIREBASE_DATABASE_URL:"https://dev-1-263119.firebaseio.com",REACT_APP_FIREBASE_PROJECT_ID:"dev-1-263119",REACT_APP_FIREBASE_SENDER_ID:"419198628817",REACT_APP_FIREBASE_STORAGE_BUCKET:"dev-1-263119.appspot.com"}),e)?s&&a('"'.concat(e,'" is already defined in `process.env` and will not be overwritten')):Object({NODE_ENV:"production",PUBLIC_URL:"/CCPortfolio",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_API_KEY:"AIzaSyA3lsHu2D92yOvSdqZIXJgJNjoUT0VzY6E",REACT_APP_FIREBASE_APP_ID:"1:419198628817:web:40a35523550576fe4de6f0",REACT_APP_FIREBASE_AUTH_DOMAIN:"dev-1-263119.firebaseapp.com",REACT_APP_FIREBASE_DATABASE_URL:"https://dev-1-263119.firebaseio.com",REACT_APP_FIREBASE_PROJECT_ID:"dev-1-263119",REACT_APP_FIREBASE_SENDER_ID:"419198628817",REACT_APP_FIREBASE_STORAGE_BUCKET:"dev-1-263119.appspot.com"})[e]=u[e]})),{parsed:u}}catch(c){return{error:c}}},e.exports.parse=l}).call(this,n(38))},function(e,t){},function(e,t,n){(function(e){function n(e,t){for(var n=0,r=e.length-1;r>=0;r--){var i=e[r];"."===i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}t.resolve=function(){for(var t="",i=!1,a=arguments.length-1;a>=-1&&!i;a--){var o=a>=0?arguments[a]:e.cwd();if("string"!==typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(t=o+"/"+t,i="/"===o.charAt(0))}return(i?"/":"")+(t=n(r(t.split("/"),(function(e){return!!e})),!i).join("/"))||"."},t.normalize=function(e){var a=t.isAbsolute(e),o="/"===i(e,-1);return(e=n(r(e.split("/"),(function(e){return!!e})),!a).join("/"))||a||(e="."),e&&o&&(e+="/"),(a?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(r(e,(function(e,t){if("string"!==typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,n){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var i=r(e.split("/")),a=r(n.split("/")),o=Math.min(i.length,a.length),s=o,u=0;u<o;u++)if(i[u]!==a[u]){s=u;break}var c=[];for(u=s;u<i.length;u++)c.push("..");return(c=c.concat(a.slice(s))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!==typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,i=!0,a=e.length-1;a>=1;--a)if(47===(t=e.charCodeAt(a))){if(!i){r=a;break}}else i=!1;return-1===r?n?"/":".":n&&1===r?"/":e.slice(0,r)},t.basename=function(e,t){var n=function(e){"string"!==typeof e&&(e+="");var t,n=0,r=-1,i=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!i){n=t+1;break}}else-1===r&&(i=!1,r=t+1);return-1===r?"":e.slice(n,r)}(e);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){"string"!==typeof e&&(e+="");for(var t=-1,n=0,r=-1,i=!0,a=0,o=e.length-1;o>=0;--o){var s=e.charCodeAt(o);if(47!==s)-1===r&&(i=!1,r=o+1),46===s?-1===t?t=o:1!==a&&(a=1):-1!==t&&(a=-1);else if(!i){n=o+1;break}}return-1===t||-1===r||0===a||1===a&&t===r-1&&t===n+1?"":e.slice(t,r)};var i="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,n(38))},,,,,,function(e,t,n){"use strict";var r=n(23),i=n(4),a=n(5),o=n(7),s=n(1),u=n(2),c=n(28),l=n(18),h=n(11),d=n(24),f="@firebase/firestore-compat",p="0.3.3";function v(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new l.g("invalid-argument","Invalid options passed to function ".concat(e,"(): You cannot ")+'specify both "merge" and "mergeFields".');return t}function m(){if("undefined"===typeof Uint8Array)throw new l.g("unimplemented","Uint8Arrays are not available in this environment.")}function g(){if(!Object(l.r)())throw new l.g("unimplemented","Blobs are unavailable in Firestore in this environment.")}var y=function(){function e(t){Object(s.a)(this,e),this._delegate=t}return Object(u.a)(e,[{key:"toBase64",value:function(){return g(),this._delegate.toBase64()}},{key:"toUint8Array",value:function(){return m(),this._delegate.toUint8Array()}},{key:"isEqual",value:function(e){return this._delegate.isEqual(e._delegate)}},{key:"toString",value:function(){return"Blob(base64: "+this.toBase64()+")"}}],[{key:"fromBase64String",value:function(t){return g(),new e(l.b.fromBase64String(t))}},{key:"fromUint8Array",value:function(t){return m(),new e(l.b.fromUint8Array(t))}}]),e}();function b(e){return function(e,t){if("object"!==typeof e||null===e)return!1;var n,r=e,i=Object(o.a)(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in r&&"function"===typeof r[a])return!0}}catch(s){i.e(s)}finally{i.f()}return!1}(e,["next","error","complete"])}var w=function(){function e(){Object(s.a)(this,e)}return Object(u.a)(e,[{key:"enableIndexedDbPersistence",value:function(e,t){return Object(l.F)(e._delegate,{forceOwnership:t})}},{key:"enableMultiTabIndexedDbPersistence",value:function(e){return Object(l.G)(e._delegate)}},{key:"clearIndexedDbPersistence",value:function(e){return Object(l.x)(e._delegate)}}]),e}(),x=function(){function e(t,n,r){var i=this;Object(s.a)(this,e),this._delegate=n,this._persistenceProvider=r,this.INTERNAL={delete:function(){return i.terminate()}},t instanceof l.m||(this._appCompat=t)}return Object(u.a)(e,[{key:"_databaseId",get:function(){return this._delegate._databaseId}},{key:"settings",value:function(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||Object(l.s)("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}},{key:"useEmulator",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(l.A)(this._delegate,e,t,n)}},{key:"enableNetwork",value:function(){return Object(l.H)(this._delegate)}},{key:"disableNetwork",value:function(){return Object(l.D)(this._delegate)}},{key:"enablePersistence",value:function(e){var t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Object(l.t)("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}},{key:"clearPersistence",value:function(){return this._persistenceProvider.clearIndexedDbPersistence(this)}},{key:"terminate",value:function(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}},{key:"waitForPendingWrites",value:function(){return Object(l.lb)(this._delegate)}},{key:"onSnapshotsInSync",value:function(e){return Object(l.Y)(this._delegate,e)}},{key:"app",get:function(){if(!this._appCompat)throw new l.g("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}},{key:"collection",value:function(e){try{return new R(this,Object(l.y)(this._delegate,e))}catch(t){throw A(t,"collection()","Firestore.collection()")}}},{key:"doc",value:function(e){try{return new E(this,Object(l.E)(this._delegate,e))}catch(t){throw A(t,"doc()","Firestore.doc()")}}},{key:"collectionGroup",value:function(e){try{return new D(this,Object(l.z)(this._delegate,e))}catch(t){throw A(t,"collectionGroup()","Firestore.collectionGroup()")}}},{key:"runTransaction",value:function(e){var t=this;return Object(l.db)(this._delegate,(function(n){return e(new k(t,n))}))}},{key:"batch",value:function(){var e=this;return Object(l.K)(this._delegate),new _(new l.l(this._delegate,(function(t){return Object(l.L)(e._delegate,t)})))}},{key:"loadBundle",value:function(e){return Object(l.V)(this._delegate,e)}},{key:"namedQuery",value:function(e){var t=this;return Object(l.W)(this._delegate,e).then((function(e){return e?new D(t,e):null}))}}]),e}(),O=function(e){Object(i.a)(n,e);var t=Object(a.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this)).firestore=e,r}return Object(u.a)(n,[{key:"convertBytes",value:function(e){return new y(new l.b(e))}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return E.forKey(t,this.firestore,null)}}]),n}(l.a);var k=function(){function e(t,n){Object(s.a)(this,e),this._firestore=t,this._delegate=n,this._userDataWriter=new O(t)}return Object(u.a)(e,[{key:"get",value:function(e){var t=this,n=L(e);return this._delegate.get(n).then((function(e){return new M(t._firestore,new l.e(t._firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,n.converter))}))}},{key:"set",value:function(e,t,n){var r=L(e);return n?(v("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}},{key:"update",value:function(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),a=3;a<r;a++)i[a-3]=arguments[a];var o,s=L(e);2===arguments.length?this._delegate.update(s,t):(o=this._delegate).update.apply(o,[s,t,n].concat(i));return this}},{key:"delete",value:function(e){var t=L(e);return this._delegate.delete(t),this}}]),e}(),_=function(){function e(t){Object(s.a)(this,e),this._delegate=t}return Object(u.a)(e,[{key:"set",value:function(e,t,n){var r=L(e);return n?(v("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}},{key:"update",value:function(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),a=3;a<r;a++)i[a-3]=arguments[a];var o,s=L(e);2===arguments.length?this._delegate.update(s,t):(o=this._delegate).update.apply(o,[s,t,n].concat(i));return this}},{key:"delete",value:function(e){var t=L(e);return this._delegate.delete(t),this}},{key:"commit",value:function(){return this._delegate.commit()}}]),e}(),S=function(){function e(t,n,r){Object(s.a)(this,e),this._firestore=t,this._userDataWriter=n,this._delegate=r}return Object(u.a)(e,[{key:"fromFirestore",value:function(e,t){var n=new l.i(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new C(this._firestore,n),null!==t&&void 0!==t?t:{})}},{key:"toFirestore",value:function(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}}],[{key:"getInstance",value:function(t,n){var r=e.INSTANCES,i=r.get(t);i||(i=new WeakMap,r.set(t,i));var a=i.get(n);return a||(a=new e(t,new O(t),n),i.set(n,a)),a}}]),e}();S.INSTANCES=new WeakMap;var E=function(){function e(t,n){Object(s.a)(this,e),this.firestore=t,this._delegate=n,this._userDataWriter=new O(t)}return Object(u.a)(e,[{key:"id",get:function(){return this._delegate.id}},{key:"parent",get:function(){return new R(this.firestore,this._delegate.parent)}},{key:"path",get:function(){return this._delegate.path}},{key:"collection",value:function(e){try{return new R(this.firestore,Object(l.y)(this._delegate,e))}catch(t){throw A(t,"collection()","DocumentReference.collection()")}}},{key:"isEqual",value:function(e){return(e=Object(h.p)(e))instanceof l.d&&Object(l.cb)(this._delegate,e)}},{key:"set",value:function(e,t){t=v("DocumentReference.set",t);try{return t?Object(l.fb)(this._delegate,e,t):Object(l.fb)(this._delegate,e)}catch(n){throw A(n,"setDoc()","DocumentReference.set()")}}},{key:"update",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];try{return 1===arguments.length?Object(l.kb)(this._delegate,e):l.kb.apply(void 0,[this._delegate,e,t].concat(r))}catch(a){throw A(a,"updateDoc()","DocumentReference.update()")}}},{key:"delete",value:function(){return Object(l.B)(this._delegate)}},{key:"onSnapshot",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=j(n),a=T(n,(function(t){return new M(e.firestore,new l.e(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))}));return Object(l.X)(this._delegate,i,a)}},{key:"get",value:function(e){var t=this;return("cache"===(null===e||void 0===e?void 0:e.source)?Object(l.N)(this._delegate):"server"===(null===e||void 0===e?void 0:e.source)?Object(l.O)(this._delegate):Object(l.M)(this._delegate)).then((function(e){return new M(t.firestore,new l.e(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))}))}},{key:"withConverter",value:function(t){return new e(this.firestore,t?this._delegate.withConverter(S.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}],[{key:"forPath",value:function(t,n,r){if(t.length%2!==0)throw new l.g("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+"".concat(t.canonicalString()," has ").concat(t.length));return new e(n,new l.d(n._delegate,r,new l.n(t)))}},{key:"forKey",value:function(t,n,r){return new e(n,new l.d(n._delegate,r,t))}}]),e}();function A(e,t,n){return e.message=e.message.replace(t,n),e}function j(e){var t,n=Object(o.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if("object"===typeof r&&!b(r))return r}}catch(i){n.e(i)}finally{n.f()}return{}}function T(e,t){var n,r,i;return{next:function(e){i.next&&i.next(t(e))},error:null===(n=(i=b(e[0])?e[0]:b(e[1])?e[1]:"function"===typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var M=function(){function e(t,n){Object(s.a)(this,e),this._firestore=t,this._delegate=n}return Object(u.a)(e,[{key:"ref",get:function(){return new E(this._firestore,this._delegate.ref)}},{key:"id",get:function(){return this._delegate.id}},{key:"metadata",get:function(){return this._delegate.metadata}},{key:"exists",get:function(){return this._delegate.exists()}},{key:"data",value:function(e){return this._delegate.data(e)}},{key:"get",value:function(e,t){return this._delegate.get(e,t)}},{key:"isEqual",value:function(e){return Object(l.hb)(this._delegate,e._delegate)}}]),e}(),C=function(e){Object(i.a)(n,e);var t=Object(a.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"data",value:function(e){var t=this._delegate.data(e);return Object(l.q)(void 0!==t,"Document in a QueryDocumentSnapshot should exist"),t}}]),n}(M),D=function(){function e(t,n){Object(s.a)(this,e),this.firestore=t,this._delegate=n,this._userDataWriter=new O(t)}return Object(u.a)(e,[{key:"where",value:function(t,n,r){try{return new e(this.firestore,Object(l.ab)(this._delegate,Object(l.mb)(t,n,r)))}catch(i){throw A(i,/(orderBy|where)\(\)/,"Query.$1()")}}},{key:"orderBy",value:function(t,n){try{return new e(this.firestore,Object(l.ab)(this._delegate,Object(l.Z)(t,n)))}catch(r){throw A(r,/(orderBy|where)\(\)/,"Query.$1()")}}},{key:"limit",value:function(t){try{return new e(this.firestore,Object(l.ab)(this._delegate,Object(l.T)(t)))}catch(n){throw A(n,"limit()","Query.limit()")}}},{key:"limitToLast",value:function(t){try{return new e(this.firestore,Object(l.ab)(this._delegate,Object(l.U)(t)))}catch(n){throw A(n,"limitToLast()","Query.limitToLast()")}}},{key:"startAt",value:function(){try{return new e(this.firestore,Object(l.ab)(this._delegate,l.jb.apply(void 0,arguments)))}catch(t){throw A(t,"startAt()","Query.startAt()")}}},{key:"startAfter",value:function(){try{return new e(this.firestore,Object(l.ab)(this._delegate,l.ib.apply(void 0,arguments)))}catch(t){throw A(t,"startAfter()","Query.startAfter()")}}},{key:"endBefore",value:function(){try{return new e(this.firestore,Object(l.ab)(this._delegate,l.J.apply(void 0,arguments)))}catch(t){throw A(t,"endBefore()","Query.endBefore()")}}},{key:"endAt",value:function(){try{return new e(this.firestore,Object(l.ab)(this._delegate,l.I.apply(void 0,arguments)))}catch(t){throw A(t,"endAt()","Query.endAt()")}}},{key:"isEqual",value:function(e){return Object(l.bb)(this._delegate,e._delegate)}},{key:"get",value:function(e){var t=this;return("cache"===(null===e||void 0===e?void 0:e.source)?Object(l.Q)(this._delegate):"server"===(null===e||void 0===e?void 0:e.source)?Object(l.R)(this._delegate):Object(l.P)(this._delegate)).then((function(e){return new P(t.firestore,new l.j(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}))}},{key:"onSnapshot",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=j(n),a=T(n,(function(t){return new P(e.firestore,new l.j(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}));return Object(l.X)(this._delegate,i,a)}},{key:"withConverter",value:function(t){return new e(this.firestore,t?this._delegate.withConverter(S.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}]),e}(),I=function(){function e(t,n){Object(s.a)(this,e),this._firestore=t,this._delegate=n}return Object(u.a)(e,[{key:"type",get:function(){return this._delegate.type}},{key:"doc",get:function(){return new C(this._firestore,this._delegate.doc)}},{key:"oldIndex",get:function(){return this._delegate.oldIndex}},{key:"newIndex",get:function(){return this._delegate.newIndex}}]),e}(),P=function(){function e(t,n){Object(s.a)(this,e),this._firestore=t,this._delegate=n}return Object(u.a)(e,[{key:"query",get:function(){return new D(this._firestore,this._delegate.query)}},{key:"metadata",get:function(){return this._delegate.metadata}},{key:"size",get:function(){return this._delegate.size}},{key:"empty",get:function(){return this._delegate.empty}},{key:"docs",get:function(){var e=this;return this._delegate.docs.map((function(t){return new C(e._firestore,t)}))}},{key:"docChanges",value:function(e){var t=this;return this._delegate.docChanges(e).map((function(e){return new I(t._firestore,e)}))}},{key:"forEach",value:function(e,t){var n=this;this._delegate.forEach((function(r){e.call(t,new C(n._firestore,r))}))}},{key:"isEqual",value:function(e){return Object(l.hb)(this._delegate,e._delegate)}}]),e}(),R=function(e){Object(i.a)(n,e);var t=Object(a.a)(n);function n(e,r){var i;return Object(s.a)(this,n),(i=t.call(this,e,r)).firestore=e,i._delegate=r,i}return Object(u.a)(n,[{key:"id",get:function(){return this._delegate.id}},{key:"path",get:function(){return this._delegate.path}},{key:"parent",get:function(){var e=this._delegate.parent;return e?new E(this.firestore,e):null}},{key:"doc",value:function(e){try{return new E(this.firestore,void 0===e?Object(l.E)(this._delegate):Object(l.E)(this._delegate,e))}catch(t){throw A(t,"doc()","CollectionReference.doc()")}}},{key:"add",value:function(e){var t=this;return Object(l.u)(this._delegate,e).then((function(e){return new E(t.firestore,e)}))}},{key:"isEqual",value:function(e){return Object(l.cb)(this._delegate,e._delegate)}},{key:"withConverter",value:function(e){return new n(this.firestore,e?this._delegate.withConverter(S.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}]),n}(D);function L(e){return Object(l.p)(e,l.d)}var N=function(){function e(){Object(s.a)(this,e);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this._delegate=Object(r.a)(l.f,n)}return Object(u.a)(e,[{key:"isEqual",value:function(e){return(e=Object(h.p)(e))instanceof l.f&&this._delegate._internalPath.isEqual(e._internalPath)}}],[{key:"documentId",value:function(){return new e(l.o.keyField().canonicalString())}}]),e}(),B=function(){function e(t){Object(s.a)(this,e),this._delegate=t}return Object(u.a)(e,[{key:"isEqual",value:function(e){return this._delegate.isEqual(e._delegate)}}],[{key:"serverTimestamp",value:function(){var t=Object(l.eb)();return t._methodName="FieldValue.serverTimestamp",new e(t)}},{key:"delete",value:function(){var t=Object(l.C)();return t._methodName="FieldValue.delete",new e(t)}},{key:"arrayUnion",value:function(){var t=l.w.apply(void 0,arguments);return t._methodName="FieldValue.arrayUnion",new e(t)}},{key:"arrayRemove",value:function(){var t=l.v.apply(void 0,arguments);return t._methodName="FieldValue.arrayRemove",new e(t)}},{key:"increment",value:function(t){var n=Object(l.S)(t);return n._methodName="FieldValue.increment",new e(n)}}]),e}(),F={Firestore:x,GeoPoint:l.h,Timestamp:l.k,Blob:y,Transaction:k,WriteBatch:_,DocumentReference:E,DocumentSnapshot:M,Query:D,QueryDocumentSnapshot:C,QuerySnapshot:P,CollectionReference:R,FieldPath:N,FieldValue:B,setLogLevel:function(e){Object(l.gb)(e)},CACHE_SIZE_UNLIMITED:l.c};!function(e){var t;t=function(e,t){return new x(e,t,new w)},e.INTERNAL.registerComponent(new d.a("firestore-compat",(function(e){var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("firestore").getImmediate();return t(n,r)}),"PUBLIC").setServiceProps(Object.assign({},F))),e.registerVersion(f,p)}(c.a)}]]);
//# sourceMappingURL=2.a8732ffc.chunk.js.map